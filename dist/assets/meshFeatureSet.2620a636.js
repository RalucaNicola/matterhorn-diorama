import{cJ as m,t as D,r as g,g as I,aP as N,am as L,p0 as F,p1 as S,ct as p}from"./index.25dca4c3.js";var c,E;(function(e){e.featureGUID="featureGUID",e.assetName="assetName",e.hash="hash",e.type="type",e.conversionStatus="conversionStatus",e.flags="flags",e.complexity="complexity",e.size="size",e.seqNo="seqNo",e.sourceHash="sourceHash",e.assetURL="assetURL"})(c||(c={})),function(e){e.SUBMITTED="SUBMITTED",e.INPROGRESS="INPROGRESS",e.FAILED="FAILED",e.COMPLETED="COMPLETED"}(E||(E={}));function O(e,s,t){const a=t.features;t.features=[],delete t.geometryType;const n=m.fromJSON(t);n.geometryType="mesh";const o=n.spatialReference,r=D(e.outFields)||!e.outFields.length?()=>({}):h(e.outFields.includes("*")?null:new Set(e.outFields));for(const i of a){const l=P(i,o,s);g(l)&&n.features.push(new I({geometry:l,attributes:r(i)}))}return n}function h(e){return({attributes:s})=>{if(!s)return{};if(!e)return s;for(const t in s)e.has(t)||delete s[t];return s}}function P(e,s,t){const{status:a,source:n}=M(e);if(a===u.FAILED)return null;const o=R(e,s,t),r=L.fromJSON(e.geometry);r.spatialReference=s;const i=T(e,t);return a===u.PENDING?p.createIncomplete(o,{extent:r,transform:i}):p.createWithExternalSource(o,n,{extent:r,transform:i})}function R({attributes:e},s,{transformFieldRoles:t}){return new N({x:e[t.originX],y:e[t.originY],z:e[t.originZ],spatialReference:s})}function T({attributes:e,assetMappings:s},{transformFieldRoles:t}){var a;return new F({translation:[e[t.translationX],e[t.translationY],e[t.translationZ]],rotation:S([e[t.rotationX],e[t.rotationY],e[t.rotationZ]],e[t.rotationDeg]),scale:[e[t.scaleX],e[t.scaleY],e[t.scaleZ]],geographic:!((a=s[c.flags])!=null&&a.includes("PROJECT_VERTICES"))})}function M(e){if(!e.assetMappings)return{status:u.FAILED};const s=[],t=new Map;for(const a of e.assetMappings){const n=a[c.seqNo],o=a[c.assetName],r=a[c.assetURL],i=a[c.conversionStatus];if(i===E.FAILED)return{status:u.FAILED};if(i!==E.COMPLETED)return{status:u.PENDING};if(n==null)s.push({name:o,source:r});else{const l=t.get(o);let f;l?f=l.multipart:(f=[],s.push({name:o,source:{multipart:f}}),t.set(o,{multipart:f})),f[n]=r}}return{status:u.COMPLETED,source:s}}var u;(function(e){e[e.FAILED=0]="FAILED",e[e.PENDING=1]="PENDING",e[e.COMPLETED=2]="COMPLETED"})(u||(u={}));export{O as meshFeatureSetFromJSON};
