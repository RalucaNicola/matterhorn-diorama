var Rwe=Object.defineProperty,Owe=Object.defineProperties;var Mwe=Object.getOwnPropertyDescriptors;var CM=Object.getOwnPropertySymbols;var OX=Object.prototype.hasOwnProperty,MX=Object.prototype.propertyIsEnumerable;var RX=(e,t,i)=>t in e?Rwe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,L=(e,t)=>{for(var i in t||(t={}))OX.call(t,i)&&RX(e,i,t[i]);if(CM)for(var i of CM(t))MX.call(t,i)&&RX(e,i,t[i]);return e},ge=(e,t)=>Owe(e,Mwe(t));var O5=(e,t)=>{var i={};for(var r in e)OX.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&CM)for(var r of CM(e))t.indexOf(r)<0&&MX.call(e,r)&&(i[r]=e[r]);return i};const Pwe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}};Pwe();/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Hr(e,t,i,r){var s=arguments.length,n=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(n=(s<3?o(n):s>3?o(t,i,n):o(t,i))||n);return s>3&&n&&Object.defineProperty(t,i,n),n}function u(e,t,i,r){var s,n=arguments.length,o=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}function jdt(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function Hdt(e,t){for(const i of e)if(i!=null&&t(i))return i}function Kne(e){return e!=null&&typeof e[Symbol.iterator]=="function"}const i_=null;function _(e){return e!=null}function C(e){return e==null}function qdt(e){return e===void 0}function Ks(e,t){return _(e)?t(e):i_}function Wdt(e){return e}function Iwe(e,t){if(C(e))throw new Error(t);return e}function Tt(e,t){return _(e)?e:typeof t=="function"?t():t}function Xdt(e,t){return _(e)?e:t}function ct(e){return _(e)&&e.destroy(),null}function it(e){return _(e)&&e.dispose(),null}function mn(e){return _(e)&&e.remove(),null}function rh(e){return _(e)&&e.abort(),null}function $i(e){return _(e)&&e.release(),null}function Ydt(e,t){return _(e)&&_(t)?e.equals(t):e===t}function $we(e){return null}function Zdt(e,t){const i=new Array;return e.forEach(r=>{const s=t(r);_(s)&&i.push(s)}),i}function Qdt(e,t){const i=new Array;for(const r of e)i.push(Rc(r,null,t));return i}function Jdt(e,t){for(const i of e)Ks(i,t)}function Rc(e,t,i){return _(e)?i(e):t}function Bs(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}function Kdt(e){return e}function eS(e){return sh(()=>e.forEach(t=>_(t)&&t.remove()))}function sh(e){return{remove:()=>{e&&(e(),e=void 0)}}}function Dwe(e,t){const i=setTimeout(e,t);return sh(()=>clearTimeout(i))}class Uu{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*Uu._m:t}getInt(){return this._seed=(Uu._a*this._seed+Uu._c)%Uu._m,this._seed}getFloat(){return this.getInt()/(Uu._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/Uu._m*r}}Uu._m=2147483647,Uu._a=48271,Uu._c=0;function FN(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):e.filter((i,r,s)=>s.indexOf(i)===r)}function I0(e,t,i){if(C(e)&&C(t))return!0;if(C(e)||C(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function d7(e,t){let i=e.length!==t.length;e.length=t.length;for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function Lwe(e,t,i){let r,s;return i?(r=t.filter(n=>!e.some(o=>i(o,n))),s=e.filter(n=>!t.some(o=>i(o,n)))):(r=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:r,removed:s}}function Nwe(e){return e&&typeof e.length=="number"}function ept(e,t){const i=e.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const Fwe=!!Array.prototype.fill;function Uwe(e,t){if(Fwe)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function zwe(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function kwe(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return i?t>=e[r-1]?-1:o===t?s:s-1:o===t?s:-1}function tpt(e){return e.reduce((t,i)=>t.concat(i||[]),[])}class eoe{constructor(){this.last=0}}const toe=new eoe;function ioe(e,t,i,r){r=r||toe;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(e[o]===t)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(e[o]===t)return r.last=o,o;return-1}function UN(e,t,i,r){const s=i==null?e.length:i,n=ioe(e,t,s,r);if(n!==-1)return e[n]=e[s-1],i==null&&e.pop(),t}const vh=new Set;function Bwe(e,t,i=e.length,r=t.length,s,n){if(r===0||i===0)return i;vh.clear();for(let a=0;a<r;++a)vh.add(t[a]);s=s||toe;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(vh.has(e[a])&&(n&&n.push(e[a]),vh.delete(e[a]),e[a]=e[i-1],--i,--a,vh.size===0||i===0))return vh.clear(),i;for(let a=0;a<o;++a)if(vh.has(e[a])&&(n&&n.push(e[a]),vh.delete(e[a]),e[a]=e[i-1],--i,--a,vh.size===0||i===0))return vh.clear(),i;return vh.clear(),i}function Vwe(e){return e?(PX.seed=e,()=>PX.getFloat()):Math.random}function ipt(e,t){const i=Vwe(t);for(let r=e.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}return e}const PX=new Uu;function p7(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}var IX,$X;let Dm;var DX,LX;(IX=globalThis.dojoConfig)!=null&&IX.has||($X=globalThis.esriConfig)!=null&&$X.has?Dm=L(L({},(DX=globalThis.dojoConfig)==null?void 0:DX.has),(LX=globalThis.esriConfig)==null?void 0:LX.has):Dm={};function ue(e){return typeof Dm[e]=="function"?Dm[e]=Dm[e](globalThis):Dm[e]}ue.add=(e,t,i,r)=>((r||Dm[e]===void 0)&&(Dm[e]=t),i&&ue(e)),ue.cache=Dm,ue.add("esri-deprecation-warnings",!0),(()=>{var e;ue.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document;if(ue.add("host-browser",t),ue.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),ue.add("dom",t),ue("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(ue.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),ue.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),ue.add("khtml",s.includes("Konqueror")?n:void 0),ue.add("edge",parseFloat(r.split("Edge/")[1])||void 0),ue.add("opr",parseFloat(r.split("OPR/")[1])||void 0),ue.add("webkit",!ue("wp")&&!ue("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),ue.add("chrome",!ue("edge")&&!ue("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),ue.add("android",!ue("wp")&&parseFloat(r.split("Android ")[1])||void 0),ue.add("safari",!s.includes("Safari")||ue("wp")||ue("chrome")||ue("android")||ue("edge")||ue("opr")?void 0:parseFloat(s.split("Version/")[1])),ue.add("mac",s.includes("Macintosh")),!ue("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));ue.add(o,l),ue.add("ios",l)}ue.add("trident",parseFloat(s.split("Trident/")[1])||void 0),ue("webkit")||(!r.includes("Gecko")||ue("wp")||ue("khtml")||ue("trident")||ue("edge")||ue.add("mozilla",n),ue("mozilla")&&ue.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&ue.add("esri-mobile",t),i&&ue.add("esri-iPhone",i),ue.add("esri-geolocation",!!navigator.geolocation)}ue.add("esri-canvas-svg-support",!ue("trident")),ue.add("esri-wasm","WebAssembly"in globalThis),ue.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),ue.add("esri-atomics","Atomics"in globalThis),ue.add("esri-workers","Worker"in globalThis),ue.add("web-feat:cache","caches"in globalThis),ue.add("esri-workers-arraybuffer-transfer",!ue("safari")||Number(ue("safari"))>=12),ue.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ue.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ue.add("featurelayer-snapshot-enabled",!0),ue.add("featurelayer-snapshot-point-min-threshold",8e4),ue.add("featurelayer-snapshot-point-max-threshold",4e5),ue.add("featurelayer-snapshot-point-coverage",.1),ue.add("featurelayer-advanced-symbols",!1),ue.add("featurelayer-pbf",!0),ue.add("featurelayer-pbf-statistics",!1),ue.add("feature-layers-workers",!0),ue.add("feature-polyline-generalization-factor",1),ue.add("mapview-transitions-duration",200),ue.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ue.add("mapserver-pbf-enabled",!1),ue.add("mapimagelayer-popup-identify",!0),ue.add("mapimagelayer-popup-identify-max-tolerance",20),ue.add("heatmap-allow-raster-fallback",!0),ue.add("heatmap-force-raster",!1),ue.add("heatmap-kernel-density",!1),ue("host-webworker")||ue("host-browser")&&(ue.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ue.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{ue.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ue.add("esri-image-decode",!1,!0,!0)})}return!1}),ue.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();function Gwe(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function f7(e,t,i){if(e.slice)return e.slice(t,i);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),i===void 0?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new e.constructor(r);for(let n=0;n<r;n++)s[n]=e[t+n];return s}function H2(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function jwe(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function Z_(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function Hwe(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function qwe(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function gD(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function Wwe(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function yD(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function roe(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function soe(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function Xwe(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}function RM(e){return C(e)?0:128+e.buffer.byteLength+64}function noe(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&noe(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function re(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=coe(e);if(_(t))return t;if(ooe(e))return e.clone();if(aoe(e))return e.map(re);if(loe(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=re(e[r]);return i}function S6(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=coe(e);if(_(t))return t;if(aoe(e)){let i=!0;const r=e.map(s=>{const n=S6(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(ooe(e))return e.clone();if(!loe(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],n=S6(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function ooe(e){return typeof e.clone=="function"}function aoe(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function loe(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function coe(e){if(jwe(e)||Z_(e)||Hwe(e)||qwe(e)||gD(e)||Wwe(e)||yD(e)||roe(e)||soe(e))return f7(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((i,r)=>{t.set(r,re(i))}),t}if(e instanceof Set){const t=new Set;return e.forEach(i=>{t.add(re(i))}),t}return null}function zN(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function TI(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&I0(e,t):e instanceof Set?t instanceof Set&&Zwe(e,t):e instanceof Map?t instanceof Map&&Qwe(e,t):typeof e=="object"&&typeof t=="object"&&Ywe(e,t))}function Ywe(e,t){if(e===null||t===null)return!1;const i=Object.keys(e),r=i.length;if(t===null||Object.keys(t).length!==r)return!1;for(const s of i)if(e[s]!==t[s]||!Object.prototype.hasOwnProperty.call(t,s))return!1;return!0}function Zwe(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function Qwe(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const s=t.get(i);if(s!==r||s===void 0&&!t.has(i))return!1}return!0}function Ja(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function Jwe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function SI(e,t,i){return i?vD(e,t,{policy:i,path:""}):vD(e,t,null)}function vD(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace")return r[s]=t[s],r;if(r[s]===void 0)return r[s]=re(t[s]),r;let a=r[s],l=t[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=vD(a,l,i),i.path=c}else r[s]=vD(a,l,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=l);return r},e||{}):e}function uoe(e){return Array.isArray(e)?e:e.split(".")}function NX(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function Kwe(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...NX(i));return t}return NX(e)}function hoe(e,t,i,r){const s=Kwe(t);if(s.length!==1){const n=s.map(o=>r(e,o,i));return eS(n)}return r(e,s[0],i)}function m7(e){let t=!1;return()=>{t||(t=!0,e())}}function doe(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const r=Ja(t);return Jwe(r,i)?r.get(i):t[i]}function poe(e,t,i){if(e==null)return e;const r=doe(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:poe(r,t,i+1)}function RO(e,t,i=0){return typeof t!="string"||t.includes(".")?poe(e,uoe(t),i):doe(t,e)}function _D(e,t){return RO(e,t)}function FX(e,t){return RO(t,e)!==void 0}var Dp;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(Dp||(Dp={}));class UX{constructor(t){this.autoDestroy=!1,this.properties=t}}function OO(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const r=Object.create(t.properties),s=t.autoDestroy;for(const n in r)r[n]=re(r[n]);t=new UX(r),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new UX({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function exe(e){return OO(e).properties}function kN(e,t){const i=exe(e);let r=i[t];return r||(r=i[t]={}),r}function txe(e,t){return SI(e,t,rxe)}const ixe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function rxe(e){return ixe.test(e)?"replace":"merge"}function foe(e,t,i=!1){return goe(e,t,i)}function l2(e,t){if(t!=null)return t[e]||moe(e.split("."),!1,t)}function Gl(e,t,i){const r=e.split("."),s=r.pop(),n=moe(r,!0,i);n&&s&&(n[s]=t)}function moe(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function goe(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=r[s],o=t[s];return n===o?r:n===void 0?(r[s]=re(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=goe(n,o,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=o),r)},e||{}):e}const g7="20220420",yoe="77c80054a269e48ebe6f6957fce6979d7473560f";var zX;const rr={apiKey:void 0,applicationUrl:(zX=globalThis.location)==null?void 0:zX.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(foe(rr,globalThis.esriConfig,!0),delete rr.has),!rr.assetsPath){const e="4.24.0";rr.assetsPath=`https://cdn.jsdelivr.net/npm/@arcgis/core@${e}-next.${g7}/assets`}rr.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(rr,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),rr.request.corsEnabledServers=[],rr.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const sxe=/\{([^\}]+)\}/g;function kX(e){return e==null?"":e}function Zp(e,t){return e.replace(sxe,typeof t=="object"?(i,r)=>kX(l2(r,t)):(i,r)=>kX(t(r)))}function voe(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.includes(i)?i:`\\${i}`)}function y7(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function rpt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const BX={info:0,warn:1,error:2,none:3};class pe{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,pe._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=pe.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const i=pe._loggers;return pe._loggers=t,i},set throttlingDisabled(t){pe._throttlingDisabled=t}}}static getLogger(t){let i=pe._loggers[t];return i||(i=new pe({module:t})),i}_log(t,i,...r){if(!!this._matchLevel(t)){if(i!=="always"&&!pe._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[t].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=pe._tickCounter)return;this._loggedMessages[t].set(s,pe._tickCounter),pe._scheduleTickCounterIncrement()}for(const s of rr.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;_(r);){const s=r[t];if(_(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=rr.log.level?rr.log.level:"warn";return BX[this._parentWithMember("level",i)]<=BX[t]}_argsToKey(...t){const i=(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return y7(JSON.stringify(t,i))}static _scheduleTickCounterIncrement(){pe._tickCounterScheduled||(pe._tickCounterScheduled=!0,Promise.resolve().then(()=>{pe._tickCounter++,pe._tickCounterScheduled=!1}))}}pe._loggers={},pe._tickCounter=0,pe._tickCounterScheduled=!1,pe._throttlingDisabled=!1;function nxe(e){return e&&e.release&&typeof e.release=="function"}function oxe(e){return e&&e.acquire&&typeof e.acquire=="function"}class as{constructor(t,i,r,s=1,n=0){if(this.ctor=t,this.acquireFunction=i,this.releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let o=0;o<n;o++)this._pool[o]=new this.ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(as.test.disabled)i=new this.ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this.ctor}i=this._pool.pop()}return this.acquireFunction?this.acquireFunction(i,...t):oxe(i)&&i.acquire(...t),i}release(t){t&&!as.test.disabled&&(this.releaseFunction?this.releaseFunction(t):nxe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}as.test={disabled:!1};var wi;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(wi||(wi={}));const E6=wi.USER+1;function r0(e){switch(e){case"defaults":return wi.DEFAULTS;case"service":return wi.SERVICE;case"portal-item":return wi.PORTAL_ITEM;case"web-scene":return wi.WEB_SCENE;case"web-map":return wi.WEB_MAP;case"user":return wi.USER}}function bD(e){switch(e){case wi.DEFAULTS:return"defaults";case wi.SERVICE:return"service";case wi.PORTAL_ITEM:return"portal-item";case wi.WEB_SCENE:return"web-scene";case wi.WEB_MAP:return"web-map";case wi.USER:return"user"}return void 0}function axe(e){return bD(e)}var lr;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(lr||(lr={}));let wD,aA=[];const lxe=pe.getLogger("esri.core.Accessor");function ei(e){wD!==void 0&&wD.onObservableAccessed(e)}let EI=!1,AI=!1;function Zm(e,t,i){if(EI)return v7(e,t,i);_oe(e);const r=t.call(i);return boe(),r}function cxe(e,t){return Zm(void 0,e,t)}function v7(e,t,i){const r=EI;EI=!0,_oe(e);let s=null;try{s=t.call(i)}catch(n){AI&&lxe.error(n)}return boe(),EI=r,s}function _oe(e){wD=e,aA.push(e)}function boe(){const e=aA.pop();wD=aA.length>0?aA[aA.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function woe(e,t){if(t.flags&lr.DepTrackingInitialized)return;const i=AI;AI=!1,t.flags&lr.AutoTracked?v7(t,t.metadata.get,e):xoe(e,t),AI=i}const uxe=[];function xoe(e,t){t.flags&lr.ExplicitlyTracking||(t.flags|=lr.ExplicitlyTracking,v7(t,()=>{const i=t.metadata.dependsOn||uxe;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=uoe(r);for(let n=0,o=e;n<s.length&&o!=null&&typeof o=="object";++n)o=VX(o,s[n],n!==s.length-1)}else VX(e,r,!1)}),t.flags&=~lr.ExplicitlyTracking)}function VX(e,t,i){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=Ja(e),n=s==null?void 0:s.properties.get(r);return n&&(ei(n),woe(e,n)),i?e[r]:void 0}class Toe{constructor(t,i){this._observers=t,this._observer=i}remove(){p7(this._observers,this._observer)}}class GX{constructor(t,i,r){this.properties=t,this.propertyName=i,this.metadata=r,this._observers=null,this._accessed=null,this._handles=null,this.flags=lr.Dirty|(r.nonNullable?lr.NonNullable:0)|(r.hasOwnProperty("value")?lr.HasDefaultValue:0)|(r.get===void 0?lr.DepTrackingInitialized:0)|(r.dependsOn===void 0?lr.AutoTracked:0)}destroy(){if(this.flags&lr.Dirty&&this._observers){const t=this._observers.slice();for(const i of t)i.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){ei(this);const t=this.properties.store,i=this.propertyName,r=this.flags,s=t.get(i);if(r&lr.Computing||~r&lr.Dirty&&t.has(i))return s;this.flags|=lr.Computing;const n=this.properties.host;let o;r&lr.AutoTracked?o=Zm(this,this.metadata.get,n):(xoe(n,this),o=this.metadata.get.call(n)),t.set(i,o,wi.COMPUTED);const a=t.get(i);return a===s?this.flags&=~lr.Dirty:cxe(this.commit,this),this.flags&=~lr.Computing,a}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=lr.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let r=0;r<t.length;++r)i.push(t[r].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new Toe(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&lr.Overriden&&(this.flags|=lr.Dirty);const t=this._observers;if(t!==null)for(let i=0;i<t.length;++i)t[i].onInvalidated()}commit(){this.flags&=~lr.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let i=0;i<t.length;++i)t[i].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}}class _7{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new _7;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,re(r))}),i}get(t){return this._values.get(t)}originOf(){return wi.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function OM(e,t,i){return e!==void 0}function jX(e,t,i,r){return e!==void 0&&(!(i==null&&e.flags&lr.NonNullable)||(r.lifecycle,Dp.INITIALIZING,!1))}function hxe(e){return e&&typeof e.destroy=="function"}pe.getLogger("esri.core.accessorSupport.Properties");class dxe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Dp.INITIALIZING,this.store=new _7,this._origin=wi.USER;const i=this.host.constructor.__accessorMetadata__,r=i.properties;for(const s in r){const n=new GX(this,s,r[s]);this.properties.set(s,n)}this.metadatas=r,this._autoDestroy=i.autoDestroy}initialize(){this.lifecycle=Dp.CONSTRUCTING}constructed(){this.lifecycle=Dp.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,i]of this.properties){const r=this.internalGet(t);r&&hxe(r)&&(r.destroy(),~i.flags&lr.NonNullable&&this._internalSet(i,null)),i.destroy()}else for(const[t,i]of this.properties)i.destroy()}get initialized(){return this.lifecycle!==Dp.INITIALIZING}get(t){const i=this.properties.get(t);if(i.metadata.get)return i.getComputed();ei(i);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.properties.get(t);if(r!==void 0&&r.flags&lr.HasDefaultValue)return"defaults"}return bD(i)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const i=this.properties.get(t);if(OM(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.properties.get(t);OM(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.properties.get(i);if(!OM(s))return"";const n=new Set,o=Zm({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${r}${t.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof GX))continue;const c=l.properties.host,h=l.propertyName,p=Ja(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(t,i,r){const s=this.properties.get(t);if(OM(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.properties.get(t);return i!==void 0&&!!(i.flags&lr.Overriden)}clearOverride(t){const i=this.properties.get(t);i!==void 0&&i.flags&lr.Overriden&&(i.flags&=~lr.Overriden,i.notifyChange())}override(t,i){const r=this.properties.get(t);if(!jX(r,t,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(M5.release(n),!o)return;i=a}r.flags|=lr.Overriden,this._internalSet(r,i)}set(t,i){const r=this.properties.get(t);if(!jX(r,t,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(M5.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=r0(t)}getDefaultOrigin(){return bD(this._origin)}notifyChange(t){const i=this.properties.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.properties.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.properties.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==Dp.INITIALIZING?this._origin:wi.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,n=t.propertyName;s.has(n,r)&&zN(i,s.get(n))&&~t.flags&lr.Overriden&&r===s.originOf(n)||(t.invalidate(),s.set(n,i,r),t.commit(),woe(this.host,t))}_cast(t,i){const r=M5.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}}class pxe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const M5=new as(pxe);function fxe(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=l2(r,t),n=s==null?"":s;if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}class BN{constructor(t,i,r){this.name=t,this.details=r,this.message=void 0,this instanceof BN&&(this.message=i&&fxe(i,r)||"")}toString(){return"["+this.name+"]: "+this.message}}class Y extends BN{constructor(t,i,r){if(super(t,i,r),!(this instanceof Y))return new Y(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return re(i)}catch{return"[object]"}}))}}catch(t){throw pe.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new Y(t.name,t.message,t.details)}}Y.prototype.type="error";function xD(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))xD(e,r,t[r]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void xD(_D(e,s),n,i)}const r=e.__accessor__;r!=null&&mxe(t,r),e[t]=i}}function mxe(e,t){if(ue("esri-unknown-property-errors")&&!gxe(e,t))throw new Y("set:unknown-property",yxe(e,t))}function gxe(e,t){return t.metadatas[e]!=null}function yxe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}pe.getLogger("esri.core.accessorSupport.set");function vxe(e){e.length=0}class Dl{constructor(t=50,i=50){this._pool=new as(Array,void 0,vxe,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return P5.acquire()}static release(t){return P5.release(t)}static prune(){P5.prune()}}const P5=new Dl(100);class Soe extends as{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=$we(this._set)}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const MM=[];function tS(e){MM.push(e),MM.length===1&&queueMicrotask(()=>{const t=MM.slice();MM.length=0;for(const i of t)i()})}const _xe=29;class w0{constructor(t,i=_xe){this.name=t,this._counter=0,this._items=new Array(i)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,i)=>t-i)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,i)=>t+i,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var A6;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const g=n[h-1];if(l(g,f)<=0)break;n[c-1]=g,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=r,e.iterableSort=s})(A6||(A6={}));const HX=A6,bxe=1.5,wxe=1.1;class Vt{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new eoe,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>qX(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,i){const r=this.data.indexOf(t,i);return r!==-1&&r<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,qX(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=ioe(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){const i=UN(this.data,t,this.length,this._hint);return i!==void 0&&(this.length=this.length-1),this._shrink(),i}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=Bwe(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){t>=this.length||i>=this.length||t===i||([this.data[t],this.data[i]]=[this.data[i],this.data[t]])}sort(t){HX.sort(this.data,0,this.length,t)}iterableSort(t){return HX.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)t.call(i,s[n],n,s)}forEach(t,i){for(let r=0;r<this.length;++r)t.call(i,this.data[r],r,this.data)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}}function qX(e){e.data.length>bxe*e.length&&(e.data.length=Math.floor(e.length*wxe))}function xxe(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return{remove:()=>e.clearTimeout(r)}}}}const VN=xxe(globalThis),WX=new Set;function Txe(e,t,i=!1){i&&WX.has(t)||(i&&WX.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function b7(e,t,i={}){if(ue("esri-deprecation-warnings")){const{moduleName:r}=i;w7(e,`Function: ${(r?r+"::":"")+t+"()"}`,i)}}function spt(e,t,i={}){if(ue("esri-deprecation-warnings")){const{moduleName:r}=i;w7(e,`Property: ${(r?r+"::":"")+t}`,i)}}function w7(e,t,i={}){if(ue("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=t;r&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${r}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),Txe(e,a,o)}}function GN(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function MO(e,t,i){if(!GN(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const s of r)e.addEventListener(s,i);return{remove(){for(const s of r)e.removeEventListener(s,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function Eoe(e,t,i){if(!GN(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=MO(e,t,s=>{r.remove(),i.call(e,s)});return{remove(){r.remove()}}}const Sxe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Q_({key:e}){return Sxe[e]||e}const x7=pe.getLogger("esri.core.promiseUtils");function Exe(e){return b7(x7,"all()",{moduleName:"promiseUtils",replacement:"Promise.all()",version:"4.19"}),Promise.all(e)}function T7(e){return new Promise((t,i)=>{try{e(t,i)}catch(r){Promise.resolve().then(()=>i(r))}})}function gi(e="Aborted"){return new Y("AbortError",e)}function qt(e,t="Aborted"){if(Ts(e))throw gi(t)}function jN(e){return _(e)?"aborted"in e?e:e.signal:e}function Ts(e){const t=jN(e);return _(t)&&t.aborted}function hf(e){if(Tr(e))throw e}function C6(e){if(!Tr(e))throw e}function Lo(e,t){const i=jN(e);if(!C(i)){if(!i.aborted)return Eoe(i,"abort",()=>t());t()}}function HN(e,t){const i=jN(e);if(!C(i))return qt(i),Eoe(i,"abort",()=>t(gi()))}function qN(e,t){const i=jN(t);return C(i)?e:new Promise((r,s)=>{let n=Lo(t,()=>s(gi()));const o=()=>n=mn(n);e.then(o,o),e.then(r,s)})}function Tr(e){return e&&e.name==="AbortError"}async function R6(e){try{return await e}catch(t){if(!Tr(t))throw t}}async function npt(e,t=pe.getLogger("esri")){try{return await e}catch(i){Tr(i)||t.error(i)}}function $0(){let e=null;const t=new Promise((i,r)=>{e={promise:void 0,resolve:i,reject:r}});return e.promise=t,e}async function Ka(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e),r=i.map(o=>e[o]),s=await Ka(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const t=e;return T7(i=>{const r=[];let s=t.length;s===0&&i(r),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function Aoe(e){return(await Ka(e)).filter(t=>!!t.value).map(t=>t.value)}function XX(e){return b7(x7,"reject()",{moduleName:"promiseUtils",replacement:"Promise.reject()",version:"4.19"}),Promise.reject(e)}function lA(e){return b7(x7,"resolve()",{moduleName:"promiseUtils",replacement:"Promise.resolve()",version:"4.19"}),Promise.resolve(e)}function iS(e,t,i){const r=new AbortController;return Lo(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);Lo(r,()=>{o&&(clearTimeout(o),n(gi()))})})}function Jc(e){return e&&typeof e.then=="function"}function O6(e){return Jc(e)?e:Promise.resolve(e)}function Coe(e,t=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(gi()),n=$0();const f=n.promise;if(o){const g=o;o=null,g.abort()}return f}if(s=n||$0(),n=null,t>0){const f=new AbortController;i=O6(e(...l,f.signal));const g=i;iS(t).then(()=>{i===g&&(n?f.abort():o=f)})}else i=1,i=O6(e(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function Qm(){let e,t;const i=new Promise((s,n)=>{e=s,t=n}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,n)=>VN.setTimeout(()=>r.reject(n),s),r.promise=i,r}function opt(e,t){return e.then(t,t)}function PO(e,t){let i,r=new AbortController;const s=e(r.signal);let n={promise:s,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const o=()=>{n&&(n.finished=!0,n=null),_(i)&&(i.remove(),i=null),r=null};return s.then(o,o),i=Lo(t,()=>{_(n)&&n.abort()}),n}async function apt(e){await Promise.resolve(),qt(e)}function Roe(e){return 1e3*e}function S7(e){return .001*e}class Axe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class Cxe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let M6=0,P6=0;const q2={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},I6=["prepare","preRender","render","postRender","update","finish"],$6=[],X1=new Vt;class Rxe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const TD={frameTasks:X1,willDispatch:!1,clearFrameTasks:Oxe,dispatch:Poe,executeFrameTasks:Pxe};function IO(e){const t=new Cxe(e);return $6.push(t),TD.willDispatch||(TD.willDispatch=!0,tS(Poe)),t}function Y1(e){const t=new Axe(e);return X1.push(t),SD==null&&(M6=performance.now(),SD=requestAnimationFrame(Ooe)),new Rxe(t)}let SD=null;function Oxe(e=!1){X1.forAll(t=>{t.removed=!0}),e&&Moe()}function Mxe(e){P6=Math.max(0,e)}function Ooe(){const e=performance.now();SD=null,SD=X1.length>0?requestAnimationFrame(Ooe):null,TD.executeFrameTasks(e)}function Pxe(e){const t=e-M6;M6=e;const i=P6>0?P6:1e3/60,r=Math.max(0,t-i);for(let s=0;s<I6.length;s++){const n=performance.now(),o=I6[s];X1.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(q2.time=e,q2.deltaTime=a.ticks===0?0:t,q2.elapsedFrameTime=performance.now()-e,q2.frameDuration=i-r,(l=a.phases[o])==null||l.call(a,q2)))}),$xe[s].record(performance.now()-n)}Moe(),Dxe.record(performance.now()-e)}const PM=new Vt;function Moe(){X1.forAll(e=>{e.removed&&PM.push(e)}),X1.removeUnorderedMany(PM.data,PM.length),PM.clear()}function Poe(){for(;$6.length;){const e=$6.shift();e.isActive&&e.callback()}TD.willDispatch=!1}function Ixe(e=1,t){const i=Qm(),r=()=>{Ts(t)?i.reject(gi()):e===0?i():(--e,tS(()=>r()))};return r(),i.promise}const $xe=I6.map(e=>new w0(e)),Dxe=new w0("total");function CI(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}let Lxe=0;const Nxe=0;function Xa(){return++Lxe}class WN{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed;for(let r=0;r<i.length;++r)t.push(i[r].observe(this));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}let ST=!1;const ED=[];function Ioe(e,t){let i=new WN(n),r=null,s=!1;function n(){if(!i||s)return;if(ST)return void Loe(n);const a=r;i.clear(),ST=!0,s=!0,r=Zm(i,e),s=!1,ST=!1,t(r,a),Noe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=Zm(i,e),s=!1,{remove:o}}function $oe(e,t){let i=new WN(s),r=null;function s(){t(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=Zm(i,e),r):null}return o(),{remove:n}}function Doe(e){let t=new WN(r),i=!1;function r(){t&&!i&&(ST?Loe(r):(t.clear(),ST=!0,i=!0,Zm(t,e),i=!1,ST=!1,Noe()))}function s(){t&&(t.destroy(),t=null)}return i=!0,Zm(t,e),i=!1,{remove:s}}function Loe(e){ED.includes(e)||ED.unshift(e)}function Noe(){for(;ED.length;)ED.pop()()}var xC;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(xC||(xC={}));class cR{constructor(){this.uid=Xa(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,n){return this.pool.acquire(xC.Untracked,t,i,r,s,n,zN)}static acquireTracked(t,i,r,s){return this.pool.acquire(xC.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===xC.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i)}acquire(t,i,r,s,n,o,a){this.uid=Xa(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Xa(),this.removed=!0}}cR.pool=new Soe(cR);const RI=new Dl,km=new Set;let AD;function CD(e){km.delete(e),km.add(e),AD||(AD=IO(zxe))}function Fxe(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function Uxe(e){for(const t of km.values())t.target===e&&(t.removed=!0)}function zxe(){let e=10;for(;AD&&e--;){AD=null;const t=kxe(),i=RI.acquire();for(const r of t){const s=r.uid;Fxe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of km)r.removed&&(i.push(r),km.delete(r));for(const r of i)cR.pool.release(r);RI.release(i),RI.release(t),D6.forEach(r=>r())}}function kxe(){const e=RI.acquire();e.length=km.size;let t=0;for(const i of km)e[t]=i,++t;return km.clear(),e}const D6=new Set;function Foe(e){return D6.add(e),{remove(){D6.delete(e)}}}function Bxe(e,t,i){let r=hoe(e,t,i,(s,n,o)=>{let a,l,c=$oe(()=>RO(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=cR.acquireUntracked(h,o,p,s,n),l=a.uid),CD(a))});return{remove:m7(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,CD(a)),a=null),r=c=null})}});return r}function Vxe(e,t,i){const r=hoe(e,t,i,(s,n,o)=>{let a=!1;return Ioe(()=>RO(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,zN(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function Gxe(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?Vxe(e,t,i):Bxe(e,t,i)}function jxe(e,t,i){let r,s,n=$oe(e,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=cR.acquireTracked(o,t,a,i),s=r.uid),CD(r))});return{remove:m7(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,CD(r)),r=null),n=null})}}function Hxe(e,t,i){let r=!1;return Ioe(e,(s,n)=>{r||(r=!0,i(n,s)||t(s,n),r=!1)})}function qxe(e,t,i=!1,r=zN){return i?Hxe(e,t,r):jxe(e,t,r)}function YX(e){return CI(km,t=>t.oldValue===e)}function Us(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function lpt(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function Uoe(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}const ET=pe.getLogger("esri.core.Accessor");function Wxe(e){return e==null?e:new Date(e)}function Xxe(e){return e==null?e:!!e}function $O(e){return e==null?e:e.toString()}function zu(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function E7(e){return e==null?e:Math.round(parseFloat(e))}function zoe(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function RD(e,t){return t!=null&&e&&!(t instanceof e)}function koe(e){return e&&"isCollection"in e}function ZX(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function Yxe(e,t){if(!t||!t.constructor||!koe(t.constructor))return L6(e,t)?t:new e(t);const i=ZX(e.prototype.itemType),r=ZX(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(L6(e,t),t):new e(t):t}function L6(e,t){return!!zoe(t)&&(ET.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+XN(e)+"'"),!0)}function rS(e,t){return t==null?t:koe(e)?Yxe(e,t):RD(e,t)?L6(e,t)?t:new e(t):t}function XN(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const Zxe=new WeakMap;function Qxe(e){switch(e){case Number:return zu;case Dr:return E7;case Boolean:return Xxe;case String:return $O;case Date:return Wxe;default:return Uoe(Zxe,e,()=>rS.bind(null,e))}}function As(e,t){const i=Qxe(e);return arguments.length===1?i:i(t)}function uR(e,t,i){return arguments.length===1?uR.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function Jxe(e,t){return arguments.length===1?uR(As.bind(null,e)):uR(As.bind(null,e),t)}function Boe(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>Boe(e,t-1,r)):e(i)}function OD(e,t,i){if(arguments.length===2)return OD.bind(null,e,t);if(!i)return i;let r=t,s=i=Boe(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function Kxe(e,t,i){return arguments.length===2?OD(As.bind(null,e),t):OD(As.bind(null,e),t,i)}function Voe(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function N6(e,t){if(arguments.length===2)return N6(e).call(null,t);const i=new Set,r=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!RD(a,p))?a:(h&&r.length?(n||(n=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),ET.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>XN(p)).join(", ")),ET.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):ET.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function xd(e,t){if(arguments.length===2)return xd(e).call(null,t);const i={},r=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];i[l]=As(c),r.push(XN(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!RD(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=i[c];if(!h)return ET.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!RD(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!zoe(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return h(p)}return h(l)}}class Dr{}const cpt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function eTe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function Goe(e){switch(e.type){case"native":return As(e.value);case"array":return uR(Goe(e.value));case"one-of":return tTe(e);default:return null}}function tTe(e){let t=null;return(i,r)=>U6(i,e)?i:(t==null&&(t=F6(e)),ET.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function F6(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Dr:return"integer";case Date:return"date";default:return XN(e.value)}case"array":return`array of ${F6(e.value)}`;case"one-of":{const t=e.values.map(i=>F6(i));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function U6(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case Dr:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!U6(i,t.value));case"one-of":return t.values.some(i=>U6(e,i))}}function d(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=kN(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&pe.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=_D(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=_D(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){p!==void 0?this._override(i,p):this._clearOverride(i)}:function(p){xD(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=iTe(o):a&&(Array.isArray(a)?s.cast=uR(xd(a[0])):s.cast=xd(a))),e.range&&(s.cast=rTe(s.cast,e.range)),txe(s,e)}}function joe(e,t,i){const r=kN(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function iTe(e){let t=0,i=e;if(eTe(e))return Goe(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(Voe(r))return t===0?N6(r):OD(N6(r),t);if(t===1)return Jxe(r);if(t>1)return Kxe(r,t);const s=e;return s.from?s.from:As(s)}function rTe(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}function sTe(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(n=>{t[n]=s}),delete t[r]}}}class Hc extends BN{constructor(t,i,r){if(super(t,i,r),!(this instanceof Hc))return new Hc(t,i,r)}}Hc.prototype.type="warning";function Hoe(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const z6=pe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function QX(e,t,i){var r,s;e&&(!i&&!t.read||(r=t.read)!=null&&r.reader||((s=t.read)==null?void 0:s.enabled)===!1||aTe(e)&&Gl("read.reader",c2(e),t))}function c2(e){var t;const i=(t=e.ndimArray)!=null?t:0;if(i>1)return oTe(e);if(i===1)return JX(e);if("type"in e&&Woe(e.type)){var r,s;const n=(r=e.type.prototype)==null||(s=r.itemType)==null?void 0:s.Type,o=JX(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return A7(e)}function A7(e){return"type"in e?nTe(e.type):lTe(e.types)}function nTe(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void z6.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}function qoe(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>qoe(e,s,i,r-1)):e(t,void 0,i)}function oTe(e){var t;const i=A7(e),r=qoe.bind(null,i),s=(t=e.ndimArray)!=null?t:0;return(n,o,a)=>{if(n==null)return n;n=r(n,a,s);let l=s,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function JX(e){const t=A7(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(i,void 0,s);return n!==void 0?[n]:void 0}}function Woe(e){if(!Hoe(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?C7(t.Type):Xoe(t.Type))}function aTe(e){return"types"in e?Xoe(e.types):C7(e.type)}function C7(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||Woe(e))}function Xoe(e){for(const t in e.typeMap)if(!C7(e.typeMap[t]))return!1;return!0}function lTe(e){var t;let i=null;const r=(t=e.errorContext)!=null?t:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void z6.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);i||(i=cTe(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?i[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new Hc(`${r}:unsupported`,f,{definition:s,context:o})),void z6.error(f)}const p=new h;return p.read(s,o),p}}function cTe(e){const t={};for(const s in e.typeMap){var i,r;const n=e.typeMap[s],o=OO(n.prototype);if(typeof e.key=="function")continue;const a=o.properties[e.key];if(!a)continue;(i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function uTe(e){if(e.json||(e.json={}),eY(e.json),tY(e.json),KX(e.json),e.json.origins)for(const t in e.json.origins)eY(e.json.origins[t]),tY(e.json.origins[t]),KX(e.json.origins[t]);return!0}function KX(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function eY(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function tY(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const hTe=pe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function iY(e,t){var i;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const r=(i=e==null?void 0:e.ndimArray)!=null?i:0;e&&(r===1||"type"in e&&Hoe(e.type))?t.write.writer=fTe:r>1?t.write.writer=mTe(r):t.types?Array.isArray(t.types)?t.write.writer=pTe(t.types[0]):t.write.writer=dTe(t.types):t.write.writer=hR}function dTe(e){return(t,i,r,s)=>t?Yoe(t,e,s)?hR(t,i,r,s):void 0:hR(t,i,r,s)}function Yoe(e,t,i){for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(i!=null&&i.messages){var r,s;const n=(r=t.errorContext)!=null?r:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new Y(`${n}:unsupported`,o,{definition:e,context:i})),hTe.error(o)}return!1}function pTe(e){return(t,i,r,s)=>!t||!Array.isArray(t)?hR(t,i,r,s):hR(t.filter(n=>Yoe(n,e,s)),i,r,s)}function hR(e,t,i,r){Gl(i,MD(e,r),t)}function MD(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?PD(e):e}function PD(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function fTe(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>MD(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[MD(e,r)],Gl(i,s,t)}function Zoe(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>Zoe(r,t,i-1)):MD(e,t)}function mTe(e){return(t,i,r,s)=>{let n;if(t===null)n=null;else{n=Zoe(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Gl(r,n,i)}}function k6(e,t){return R7(e,"read",t)}function Qoe(e,t){return R7(e,"write",t)}function R7(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&(t==="any"||t in s)&&(r=s)}return r}function gTe(e){const t=yTe(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?vTe(r):t;QX(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write=L({},e.json.write)),iY(s,r)}QX(t,e.json,!0),iY(t,e.json)}function yTe(e){return e.json.types?B6(e.json):e.type?Joe(e):B6(e)}function vTe(e){return e.type?Joe(e):B6(e)}function Joe(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!Voe(i);)i=i[0],t++;return{type:i,ndimArray:t}}function B6(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function _Te(e){uTe(e)&&(sTe(e),gTe(e))}const I5=new Set,$5=new Set;function P(e){return t=>{t.prototype.declaredClass=e,wTe(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!I5.has(s.initialize)&&(I5.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!$5.has(s.destroy)&&($5.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);I5.clear(),$5.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<r.length;c++)r[c].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=OO(t.prototype),n.prototype.declaredClass=e,n}}function bTe(e,t){return t.get==null?function(){const i=this.__accessor__.properties.get(e);if(i===void 0)return;ei(i);const r=this.__accessor__.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const i=this.__accessor__.properties.get(e);if(i!==void 0)return i.getComputed()}}function wTe(e){const t=e.prototype,i=OO(t).properties,r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];_Te(n),r[s]={enumerable:!0,configurable:!0,get:bTe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===Dp.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,r)}var Koe;function xTe(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return(t=e.constructor)!=null&&t.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const cA=Symbol("Accessor-Handles");class be{constructor(...t){if(this[Koe]=null,this.constructor===be)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new dxe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}OO(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:t[a]}for(const a in i){const l=xTe(i[a]);d(l)(o.prototype,a)}return P(r)(o)}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(Ks(this[cA],t=>{t.forEach(i=>i.remove())}),this[cA]=null,Uxe(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===Dp.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return _D(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return xD(this,t,i),this}watch(t,i,r){return Gxe(this,t,i,r)}own(t){let i=this[cA];if(C(i)&&(i=this[cA]=new Set),Kne(t))for(const r of t)i.add(r);else i.add(t)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,i){return this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}}Koe=cA;pe.getLogger("esri.core.Clonable");const df=e=>{let t=class extends e{clone(){const i=Iwe(Ja(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==wi.USER&&p!==wi.DEFAULTS&&p!==wi.WEB_MAP&&p!==wi.WEB_SCENE)continue;const g=this[c];let y=null;y=typeof f=="function"?f(g):f==="reference"?g:S6(g),g!=null&&y==null||(p===wi.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){var l;const c=(l=Ja(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,wi.DEFAULTS)}return a}};return t=u([P("esri.core.Clonable")],t),t};let rY=class extends df(be){};rY=u([P("esri.core.Clonable")],rY);function M(){return[0,0,0]}function ts(e){return[e[0],e[1],e[2]]}function Le(e,t,i){return[e,t,i]}function za(e){const t=M(),i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function O7(e,t){return new Float64Array(e,t,3)}function eae(){return M()}function tae(){return Le(1,1,1)}function iae(){return Le(1,0,0)}function rae(){return Le(0,1,0)}function M7(){return Le(0,0,1)}const pa=eae(),kp=tae(),TTe=iae(),STe=rae(),sae=M7();Object.freeze(Object.defineProperty({__proto__:null,create:M,clone:ts,fromValues:Le,fromArray:za,createView:O7,zeros:eae,ones:tae,unitX:iae,unitY:rae,unitZ:M7,ZEROS:pa,ONES:kp,UNIT_X:TTe,UNIT_Y:STe,UNIT_Z:sae},Symbol.toStringTag,{value:"Module"}));const Rt=1e-6,cd=Math.random,ETe=Math.PI/180,ATe=180/Math.PI;function YN(e){return e*ETe}function CTe(e){return e*ATe}function RTe(e,t){return Math.abs(e-t)<=Rt*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:Rt,RANDOM:cd,toRadian:YN,toDegree:CTe,equals:RTe},Symbol.toStringTag,{value:"Module"}));function Ie(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function ne(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function se(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function fe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function de(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function P7(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function ID(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function OTe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function MTe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function nae(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function oae(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function PTe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function oe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function V6(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function Yi(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function fa(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function ua(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function Do(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function ITe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Te(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function Se(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function _t(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function Cs(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function $Te(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+s[0]*h,e[1]=t[1]*a+i[1]*l+r[1]*c+s[1]*h,e[2]=t[2]*a+i[2]*l+r[2]*c+s[2]*h,e}function DTe(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+i[0]*h+r[0]*p+s[0]*f,e[1]=t[1]*c+i[1]*h+r[1]*p+s[1]*f,e[2]=t[2]*c+i[2]*h+r[2]*p+s[2]*f,e}function LTe(e,t){t=t||1;const i=2*cd()*Math.PI,r=2*cd()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=r*t,e}function Fe(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function so(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function D0(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-r*c,f=r*l-s*a,g=s*f-n*p,y=n*h-r*f,v=r*p-s*h;const b=2*o;return h*=b,p*=b,f*=b,g*=2,y*=2,v*=2,e[0]=a+h+g,e[1]=l+p+y,e[2]=c+f+v,e}function NTe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function FTe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function UTe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function zTe(e,t){ne(IM,e),ne($M,t),Te(IM,IM),Te($M,$M);const i=Se(IM,$M);return i>1?0:i<-1?Math.PI:Math.acos(i)}const IM=M(),$M=M();function kTe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function da(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function sS(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=t[0],o=t[1],a=t[2];return Math.abs(i-n)<=Rt*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Rt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Rt*Math.max(1,Math.abs(s),Math.abs(a))}function dg(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const Qp=de,BTe=P7,VTe=ID,I7=Yi,$7=fa,D7=Ie,G6=ua,sY=Object.freeze(Object.defineProperty({__proto__:null,length:Ie,copy:ne,set:se,add:fe,subtract:de,multiply:P7,divide:ID,ceil:OTe,floor:MTe,min:nae,max:oae,round:PTe,scale:oe,scaleAndAdd:V6,distance:Yi,squaredDistance:fa,squaredLength:ua,negate:Do,inverse:ITe,normalize:Te,dot:Se,cross:_t,lerp:Cs,hermite:$Te,bezier:DTe,random:LTe,transformMat4:Fe,transformMat3:so,transformQuat:D0,rotateX:NTe,rotateY:FTe,rotateZ:UTe,angle:zTe,str:kTe,exactEquals:da,equals:sS,direction:dg,sub:Qp,mul:BTe,div:VTe,dist:I7,sqrDist:$7,len:D7,sqrLen:G6},Symbol.toStringTag,{value:"Module"}));function Dc(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Wi(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function L7(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function aae(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function lae(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function cae(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function GTe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function jTe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function HTe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function qTe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function WTe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function DO(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function XTe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function uae(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function $D(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function N7(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function F7(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function YTe(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ZTe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function hae(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function dae(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function U7(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function QTe(e,t){let i,r,s,n,o,a;t=t||1;do i=2*cd()-1,r=2*cd()-1,o=i*i+r*r;while(o>=1);do s=2*cd()-1,n=2*cd()-1,a=s*s+n*n;while(a>=1);const l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*s*l,e[3]=t*n*l,e}function Lc(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function JTe(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,p=c*s+l*r-o*n,f=c*n+o*s-a*r,g=-o*r-a*s-l*n;return e[0]=h*c+g*-o+p*-l-f*-a,e[1]=p*c+g*-a+f*-o-h*-l,e[2]=f*c+g*-l+h*-a-p*-o,e[3]=t[3],e}function KTe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Z1(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function pae(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Rt*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Rt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Rt*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Rt*Math.max(1,Math.abs(n),Math.abs(c))}const eSe=aae,tSe=lae,iSe=cae,rSe=uae,sSe=$D,nSe=N7,oSe=F7,fae=Object.freeze(Object.defineProperty({__proto__:null,copy:Dc,set:Wi,add:L7,subtract:aae,multiply:lae,divide:cae,ceil:GTe,floor:jTe,min:HTe,max:qTe,round:WTe,scale:DO,scaleAndAdd:XTe,distance:uae,squaredDistance:$D,length:N7,squaredLength:F7,negate:YTe,inverse:ZTe,normalize:hae,dot:dae,lerp:U7,random:QTe,transformMat4:Lc,transformQuat:JTe,str:KTe,exactEquals:Z1,equals:pae,sub:eSe,mul:tSe,div:iSe,dist:rSe,sqrDist:sSe,len:nSe,sqrLen:oSe},Symbol.toStringTag,{value:"Module"})),nY=new Float32Array(1);function nS(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function He(e,t,i){return Math.min(Math.max(e,t),i)}function oS(e){return(e&e-1)==0}function upt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function hpt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function ti(e,t,i){return e+(t-e)*i}function $t(e){return e*Math.PI/180}function el(e){return 180*e/Math.PI}function j6(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Hs(e){return Math.acos(He(e,-1,1))}function Td(e){return Math.asin(He(e,-1,1))}function aSe(e,t,i=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function AT(e,t,i=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=i}function lSe(e){return mae(Math.max(-H6,Math.min(e,H6)))}function mae(e){return nY[0]=e,nY[0]}function aS(e,t,i){const r=He((i-e)/(t-e),0,1);return r*r*(3-2*r)}function oY(e,t){const i=Ie(e),r=Td(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return se(t,i,r,s),t}function dpt(e,t,i){return Wi(e,t[0],t[1],t[2],t[3]*i)}function ppt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(AT(t,1)&&AT(i,1)&&AT(r,1))}const H6=mae(34028234663852886e22);class L0{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,n=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return He(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}}function z7(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const cSe=z7(new L0(0,2*Math.PI)),N0=z7(new L0(-Math.PI,Math.PI)),k7=z7(new L0(0,360));class B7{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new B7;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,re(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i,r;return(i=(r=this._values.get(t))==null?void 0:r.origin)!=null?i:wi.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===wi.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(t,new uSe(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===wi.DEFAULTS?t:wi.USER}}class uSe{constructor(t,i){this.value=t,this.origin=i}}function gae(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),wi.DEFAULTS)});const r=e.metadatas;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),wi.DEFAULTS)})}function hSe(e,t,i){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.includes(".")&&r.indexOf(t)===0&&FX(r,i))return!0}else for(const s of r)if(s===t||s.includes(".")&&s.indexOf(t)===0&&FX(s,i))return!0;return!1}function dSe(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function pSe(e,t,i,r,s){let n=k6(t[i],s);dSe(n)&&(e[i]=!0);for(const o of Object.getOwnPropertyNames(t))n=k6(t[o],s),hSe(n,i,r)&&(e[o]=!0)}function fSe(e,t,i,r){const s=i.metadatas,n=R7(s[t],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,r):o;a!==void 0&&i.set(t,a)}const yae={origin:"service"};function vae(e,t,i=yae){if(!t||typeof t!="object")return;const r=Ja(e),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))pSe(n,s,o,t,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=k6(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?RO(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||fSe(e,o,r,i)}r.setDefaultOrigin("user")}function mSe(e,t,i,r=yae){var s;const n=ge(L({},r),{messages:[]});i(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||e.loaded?r&&r.messages&&r.messages.push(o):e.loadWarnings.push(o)})}const gSe=pe.getLogger("esri.core.accessorSupport.write");function ySe(e,t,i,r,s){var n,o;const a={};return(n=t.write)==null||(o=n.writer)==null||o.call(e,r,a,i,s),a}function _ae(e,t,i,r,s,n){if(!r||!r.write)return!1;const o=e.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(e,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new Y("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&gSe.error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===wi.DEFAULTS)&&vSe(e,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<r0(n.origin))}function vSe(e,t,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,i);return I0(o,s)}return!1}return n===s}function _Se(e,t,i,r){const s=Ja(e),n=s.metadatas,o=Qoe(n[t],r);return!!o&&_ae(e,s,t,o,i,r)}function bae(e,t,i){if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return SI(t,e.toJSON());const r=Ja(e),s=r.metadatas;for(const a in s){const l=Qoe(s[a],i);if(!_ae(e,r,a,l,void 0,i))continue;const c=e.get(a),h=ySe(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);var n,o;Object.keys(h).length>0&&(t=SI(t,h),i!=null&&(n=i.resources)!=null&&(o=n.pendingOperations)!=null&&o.length&&Promise.all(i.resources.pendingOperations).then(()=>SI(t,h)),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:a,oldOrigin:axe(r.store.originOf(a)),newOrigin:i.origin}))}return t}const LO=e=>{let t=class extends e{constructor(...i){super(...i);const r=Ja(this),s=r.store,n=new B7;r.store=n,gae(r,s,n)}read(i,r){vae(this,i,r)}write(i={},r){return bae(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return bSe.call(this,i,r)}};return t=u([P("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function bSe(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let _e=class extends LO(be){};_e=u([P("esri.core.JSONSupport")],_e);const wSe=Object.prototype.toString;function xSe(e){const t="__accessorMetadata__"in e?As(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return TSe.apply(this,i)}}function TSe(e,t,i,r){kN(e,t).cast=r}function SSe(e){return(t,i)=>{kN(t,e).cast=t[i]}}function Bt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&wSe.call(e[0])==="[object Function]"?xSe(e[0]):e.length===1&&typeof e[0]=="string"?SSe(e[0]):void 0}function Ne(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=joe(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function Xe(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=joe(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}var qu;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(qu||(qu={}));let m;const D={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102962:0,102963:0,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(m=2e3;m<=2045;m++)D[m]=0;for(m=2056;m<=2065;m++)D[m]=0;for(m=2067;m<=2135;m++)D[m]=0;for(m=2137;m<=2154;m++)D[m]=0;for(m=2161;m<=2170;m++)D[m]=0;for(m=2172;m<=2193;m++)D[m]=0;for(m=2195;m<=2198;m++)D[m]=0;for(m=2200;m<=2203;m++)D[m]=0;for(m=2205;m<=2217;m++)D[m]=0;for(m=2222;m<=2224;m++)D[m]=1;for(m=2225;m<=2250;m++)D[m]=2;for(m=2251;m<=2253;m++)D[m]=1;for(m=2257;m<=2264;m++)D[m]=2;for(m=2274;m<=2279;m++)D[m]=2;for(m=2280;m<=2282;m++)D[m]=1;for(m=2283;m<=2289;m++)D[m]=2;for(m=2290;m<=2292;m++)D[m]=0;for(m=2308;m<=2313;m++)D[m]=0;for(m=2315;m<=2491;m++)D[m]=0;for(m=2494;m<=2866;m++)D[m]=0;for(m=2867;m<=2869;m++)D[m]=1;for(m=2870;m<=2888;m++)D[m]=2;for(m=2891;m<=2895;m++)D[m]=2;for(m=2896;m<=2898;m++)D[m]=1;for(m=2902;m<=2908;m++)D[m]=2;for(m=2915;m<=2920;m++)D[m]=2;for(m=2921;m<=2923;m++)D[m]=1;for(m=2924;m<=2930;m++)D[m]=2;for(m=2931;m<=2962;m++)D[m]=0;for(m=2964;m<=2968;m++)D[m]=2;for(m=2969;m<=2973;m++)D[m]=0;for(m=2975;m<=2991;m++)D[m]=0;for(m=2995;m<=3051;m++)D[m]=0;for(m=3054;m<=3079;m++)D[m]=0;for(m=3081;m<=3088;m++)D[m]=0;for(m=3092;m<=3101;m++)D[m]=0;for(m=3106;m<=3138;m++)D[m]=0;for(m=3146;m<=3151;m++)D[m]=0;for(m=3153;m<=3166;m++)D[m]=0;for(m=3168;m<=3172;m++)D[m]=0;for(m=3174;m<=3203;m++)D[m]=0;for(m=3294;m<=3358;m++)D[m]=0;for(m=3367;m<=3403;m++)D[m]=0;for(m=3408;m<=3416;m++)D[m]=0;for(m=3417;m<=3438;m++)D[m]=2;for(m=3441;m<=3446;m++)D[m]=2;for(m=3447;m<=3450;m++)D[m]=0;for(m=3451;m<=3459;m++)D[m]=2;for(m=3460;m<=3478;m++)D[m]=0;for(m=3554;m<=3559;m++)D[m]=0;for(m=3560;m<=3570;m++)D[m]=2;for(m=3571;m<=3581;m++)D[m]=0;for(m=3594;m<=3597;m++)D[m]=0;for(m=3601;m<=3604;m++)D[m]=0;for(m=3637;m<=3639;m++)D[m]=0;for(m=3665;m<=3667;m++)D[m]=0;for(m=3693;m<=3695;m++)D[m]=0;for(m=3701;m<=3727;m++)D[m]=0;for(m=3728;m<=3739;m++)D[m]=2;for(m=3740;m<=3751;m++)D[m]=0;for(m=3753;m<=3760;m++)D[m]=2;for(m=3761;m<=3773;m++)D[m]=0;for(m=3775;m<=3777;m++)D[m]=0;for(m=3779;m<=3781;m++)D[m]=0;for(m=3783;m<=3785;m++)D[m]=0;for(m=3788;m<=3791;m++)D[m]=0;for(m=3797;m<=3802;m++)D[m]=0;for(m=3814;m<=3816;m++)D[m]=0;for(m=3825;m<=3829;m++)D[m]=0;for(m=3832;m<=3841;m++)D[m]=0;for(m=3844;m<=3852;m++)D[m]=0;for(m=3873;m<=3885;m++)D[m]=0;for(m=3890;m<=3893;m++)D[m]=0;for(m=3907;m<=3912;m++)D[m]=0;for(m=3942;m<=3950;m++)D[m]=0;for(m=3968;m<=3970;m++)D[m]=0;for(m=3973;m<=3976;m++)D[m]=0;for(m=3986;m<=3989;m++)D[m]=0;for(m=3994;m<=3997;m++)D[m]=0;for(m=4048;m<=4051;m++)D[m]=0;for(m=4056;m<=4063;m++)D[m]=0;for(m=4093;m<=4096;m++)D[m]=0;for(m=4390;m<=4398;m++)D[m]=0;for(m=4399;m<=4413;m++)D[m]=2;for(m=4418;m<=4433;m++)D[m]=2;for(m=4455;m<=4457;m++)D[m]=2;for(m=4484;m<=4489;m++)D[m]=0;for(m=4491;m<=4554;m++)D[m]=0;for(m=4568;m<=4589;m++)D[m]=0;for(m=4652;m<=4656;m++)D[m]=0;for(m=4766;m<=4800;m++)D[m]=0;for(m=5014;m<=5016;m++)D[m]=0;for(m=5069;m<=5072;m++)D[m]=0;for(m=5105;m<=5130;m++)D[m]=0;for(m=5173;m<=5188;m++)D[m]=0;for(m=5253;m<=5259;m++)D[m]=0;for(m=5269;m<=5275;m++)D[m]=0;for(m=5292;m<=5311;m++)D[m]=0;for(m=5329;m<=5331;m++)D[m]=0;for(m=5343;m<=5349;m++)D[m]=0;for(m=5355;m<=5357;m++)D[m]=0;for(m=5387;m<=5389;m++)D[m]=0;for(m=5459;m<=5463;m++)D[m]=0;for(m=5479;m<=5482;m++)D[m]=0;for(m=5518;m<=5520;m++)D[m]=0;for(m=5530;m<=5539;m++)D[m]=0;for(m=5550;m<=5552;m++)D[m]=0;for(m=5562;m<=5583;m++)D[m]=0;for(m=5623;m<=5625;m++)D[m]=2;for(m=5631;m<=5639;m++)D[m]=0;for(m=5649;m<=5653;m++)D[m]=0;for(m=5663;m<=5680;m++)D[m]=0;for(m=5682;m<=5685;m++)D[m]=0;for(m=5875;m<=5877;m++)D[m]=0;for(m=5896;m<=5899;m++)D[m]=0;for(m=5921;m<=5940;m++)D[m]=0;for(m=6050;m<=6125;m++)D[m]=0;for(m=6244;m<=6275;m++)D[m]=0;for(m=6328;m<=6348;m++)D[m]=0;for(m=6350;m<=6356;m++)D[m]=0;for(m=6366;m<=6372;m++)D[m]=0;for(m=6381;m<=6387;m++)D[m]=0;for(m=6393;m<=6404;m++)D[m]=0;for(m=6480;m<=6483;m++)D[m]=0;for(m=6511;m<=6514;m++)D[m]=0;for(m=6579;m<=6581;m++)D[m]=0;for(m=6619;m<=6624;m++)D[m]=0;for(m=6625;m<=6627;m++)D[m]=2;for(m=6628;m<=6632;m++)D[m]=0;for(m=6634;m<=6637;m++)D[m]=0;for(m=6669;m<=6692;m++)D[m]=0;for(m=6707;m<=6709;m++)D[m]=0;for(m=6720;m<=6723;m++)D[m]=0;for(m=6732;m<=6738;m++)D[m]=0;for(m=6931;m<=6933;m++)D[m]=0;for(m=6956;m<=6959;m++)D[m]=0;for(m=7005;m<=7007;m++)D[m]=0;for(m=7057;m<=7070;m++)D[m]=2;for(m=7074;m<=7082;m++)D[m]=0;for(m=7109;m<=7118;m++)D[m]=0;for(m=7119;m<=7127;m++)D[m]=1;for(m=7374;m<=7376;m++)D[m]=0;for(m=7528;m<=7586;m++)D[m]=0;for(m=7587;m<=7645;m++)D[m]=2;for(m=7692;m<=7696;m++)D[m]=0;for(m=7755;m<=7787;m++)D[m]=0;for(m=7791;m<=7795;m++)D[m]=0;for(m=7799;m<=7801;m++)D[m]=0;for(m=7803;m<=7805;m++)D[m]=0;for(m=7825;m<=7831;m++)D[m]=0;for(m=7845;m<=7859;m++)D[m]=0;for(m=8013;m<=8032;m++)D[m]=0;for(m=8065;m<=8068;m++)D[m]=1;for(m=8518;m<=8529;m++)D[m]=2;for(m=8533;m<=8536;m++)D[m]=2;for(m=8538;m<=8540;m++)D[m]=2;for(m=8677;m<=8679;m++)D[m]=0;for(m=8836;m<=8840;m++)D[m]=0;for(m=8857;m<=8859;m++)D[m]=0;for(m=8908;m<=8910;m++)D[m]=0;for(m=9154;m<=9159;m++)D[m]=0;for(m=9205;m<=9218;m++)D[m]=0;for(m=9271;m<=9273;m++)D[m]=0;for(m=9295;m<=9297;m++)D[m]=0;for(m=9356;m<=9360;m++)D[m]=0;for(m=9404;m<=9407;m++)D[m]=0;for(m=9476;m<=9482;m++)D[m]=0;for(m=9487;m<=9494;m++)D[m]=0;for(m=9697;m<=9699;m++)D[m]=0;for(m=20002;m<=20032;m++)D[m]=0;for(m=20062;m<=20092;m++)D[m]=0;for(m=20135;m<=20138;m++)D[m]=0;for(m=20248;m<=20258;m++)D[m]=0;for(m=20348;m<=20358;m++)D[m]=0;for(m=20436;m<=20440;m++)D[m]=0;for(m=20822;m<=20824;m++)D[m]=0;for(m=20904;m<=20932;m++)D[m]=0;for(m=20934;m<=20936;m++)D[m]=0;for(m=21004;m<=21032;m++)D[m]=0;for(m=21035;m<=21037;m++)D[m]=0;for(m=21095;m<=21097;m++)D[m]=0;for(m=21148;m<=21150;m++)D[m]=0;for(m=21207;m<=21264;m++)D[m]=0;for(m=21307;m<=21364;m++)D[m]=0;for(m=21413;m<=21423;m++)D[m]=0;for(m=21453;m<=21463;m++)D[m]=0;for(m=21473;m<=21483;m++)D[m]=0;for(m=21780;m<=21782;m++)D[m]=0;for(m=21891;m<=21894;m++)D[m]=0;for(m=21896;m<=21899;m++)D[m]=0;for(m=22171;m<=22177;m++)D[m]=0;for(m=22181;m<=22187;m++)D[m]=0;for(m=22191;m<=22197;m++)D[m]=0;for(m=22234;m<=22236;m++)D[m]=0;for(m=22521;m<=22525;m++)D[m]=0;for(m=22991;m<=22994;m++)D[m]=0;for(m=23028;m<=23038;m++)D[m]=0;for(m=23830;m<=23853;m++)D[m]=0;for(m=23866;m<=23872;m++)D[m]=0;for(m=23877;m<=23884;m++)D[m]=0;for(m=23886;m<=23894;m++)D[m]=0;for(m=23946;m<=23948;m++)D[m]=0;for(m=24311;m<=24313;m++)D[m]=0;for(m=24342;m<=24347;m++)D[m]=0;for(m=24370;m<=24374;m++)D[m]=10;for(m=24375;m<=24381;m++)D[m]=0;for(m=24718;m<=24721;m++)D[m]=0;for(m=24817;m<=24821;m++)D[m]=0;for(m=24877;m<=24882;m++)D[m]=0;for(m=24891;m<=24893;m++)D[m]=0;for(m=25391;m<=25395;m++)D[m]=0;for(m=25828;m<=25838;m++)D[m]=0;for(m=26191;m<=26195;m++)D[m]=0;for(m=26391;m<=26393;m++)D[m]=0;for(m=26701;m<=26722;m++)D[m]=0;for(m=26729;m<=26799;m++)D[m]=2;for(m=26801;m<=26803;m++)D[m]=2;for(m=26811;m<=26813;m++)D[m]=2;for(m=26847;m<=26870;m++)D[m]=2;for(m=26891;m<=26899;m++)D[m]=0;for(m=26901;m<=26923;m++)D[m]=0;for(m=26929;m<=26946;m++)D[m]=0;for(m=26948;m<=26998;m++)D[m]=0;for(m=27037;m<=27040;m++)D[m]=0;for(m=27205;m<=27232;m++)D[m]=0;for(m=27258;m<=27260;m++)D[m]=0;for(m=27391;m<=27398;m++)D[m]=0;for(m=27561;m<=27564;m++)D[m]=0;for(m=27571;m<=27574;m++)D[m]=0;for(m=27581;m<=27584;m++)D[m]=0;for(m=27591;m<=27594;m++)D[m]=0;for(m=28191;m<=28193;m++)D[m]=0;for(m=28348;m<=28358;m++)D[m]=0;for(m=28402;m<=28432;m++)D[m]=0;for(m=28462;m<=28492;m++)D[m]=0;for(m=29118;m<=29122;m++)D[m]=0;for(m=29168;m<=29172;m++)D[m]=0;for(m=29177;m<=29185;m++)D[m]=0;for(m=29187;m<=29195;m++)D[m]=0;for(m=29900;m<=29903;m++)D[m]=0;for(m=30161;m<=30179;m++)D[m]=0;for(m=30491;m<=30494;m++)D[m]=0;for(m=30729;m<=30732;m++)D[m]=0;for(m=31251;m<=31259;m++)D[m]=0;for(m=31265;m<=31268;m++)D[m]=0;for(m=31275;m<=31279;m++)D[m]=0;for(m=31281;m<=31297;m++)D[m]=0;for(m=31461;m<=31469;m++)D[m]=0;for(m=31491;m<=31495;m++)D[m]=0;for(m=31917;m<=31922;m++)D[m]=0;for(m=31965;m<=32e3;m++)D[m]=0;for(m=32001;m<=32003;m++)D[m]=2;for(m=32005;m<=32031;m++)D[m]=2;for(m=32033;m<=32060;m++)D[m]=2;for(m=32064;m<=32067;m++)D[m]=2;for(m=32074;m<=32077;m++)D[m]=2;for(m=32081;m<=32086;m++)D[m]=0;for(m=32107;m<=32130;m++)D[m]=0;for(m=32133;m<=32158;m++)D[m]=0;for(m=32164;m<=32167;m++)D[m]=2;for(m=32180;m<=32199;m++)D[m]=0;for(m=32201;m<=32260;m++)D[m]=0;for(m=32301;m<=32360;m++)D[m]=0;for(m=32601;m<=32662;m++)D[m]=0;for(m=32664;m<=32667;m++)D[m]=2;for(m=32701;m<=32761;m++)D[m]=0;for(m=53001;m<=53004;m++)D[m]=0;for(m=53008;m<=53019;m++)D[m]=0;for(m=53021;m<=53032;m++)D[m]=0;for(m=53034;m<=53037;m++)D[m]=0;for(m=53042;m<=53046;m++)D[m]=0;for(m=53074;m<=53080;m++)D[m]=0;for(m=54001;m<=54004;m++)D[m]=0;for(m=54008;m<=54019;m++)D[m]=0;for(m=54021;m<=54032;m++)D[m]=0;for(m=54034;m<=54037;m++)D[m]=0;for(m=54042;m<=54046;m++)D[m]=0;for(m=54048;m<=54053;m++)D[m]=0;for(m=54074;m<=54080;m++)D[m]=0;for(m=54098;m<=54101;m++)D[m]=0;for(m=102001;m<=102040;m++)D[m]=0;for(m=102042;m<=102063;m++)D[m]=0;for(m=102065;m<=102067;m++)D[m]=0;for(m=102070;m<=102117;m++)D[m]=0;for(m=102122;m<=102216;m++)D[m]=0;for(m=102221;m<=102377;m++)D[m]=0;for(m=102382;m<=102388;m++)D[m]=0;for(m=102389;m<=102398;m++)D[m]=2;for(m=102399;m<=102444;m++)D[m]=0;for(m=102445;m<=102447;m++)D[m]=2;for(m=102448;m<=102458;m++)D[m]=0;for(m=102459;m<=102468;m++)D[m]=2;for(m=102469;m<=102499;m++)D[m]=0;for(m=102500;m<=102519;m++)D[m]=1;for(m=102520;m<=102524;m++)D[m]=0;for(m=102525;m<=102529;m++)D[m]=2;for(m=102530;m<=102588;m++)D[m]=0;for(m=102590;m<=102598;m++)D[m]=0;for(m=102601;m<=102603;m++)D[m]=0;for(m=102605;m<=102628;m++)D[m]=0;for(m=102629;m<=102646;m++)D[m]=2;for(m=102648;m<=102700;m++)D[m]=2;for(m=102701;m<=102703;m++)D[m]=0;for(m=102707;m<=102730;m++)D[m]=2;for(m=102733;m<=102758;m++)D[m]=2;for(m=102767;m<=102900;m++)D[m]=0;for(m=102901;m<=102933;m++)D[m]=2;for(m=102934;m<=102950;m++)D[m]=13;for(m=102951;m<=102960;m++)D[m]=0;for(m=102965;m<=102969;m++)D[m]=0;for(m=102971;m<=102973;m++)D[m]=0;for(m=102975;m<=102989;m++)D[m]=0;for(m=102990;m<=102992;m++)D[m]=1;for(m=102997;m<=103002;m++)D[m]=0;for(m=103003;m<=103008;m++)D[m]=2;for(m=103009;m<=103011;m++)D[m]=0;for(m=103012;m<=103014;m++)D[m]=2;for(m=103019;m<=103021;m++)D[m]=0;for(m=103022;m<=103024;m++)D[m]=2;for(m=103029;m<=103031;m++)D[m]=0;for(m=103032;m<=103034;m++)D[m]=2;for(m=103065;m<=103068;m++)D[m]=0;for(m=103074;m<=103076;m++)D[m]=0;for(m=103077;m<=103079;m++)D[m]=1;for(m=103080;m<=103082;m++)D[m]=0;for(m=103083;m<=103085;m++)D[m]=2;for(m=103090;m<=103093;m++)D[m]=0;for(m=103097;m<=103099;m++)D[m]=0;for(m=103100;m<=103102;m++)D[m]=2;for(m=103107;m<=103109;m++)D[m]=0;for(m=103110;m<=103112;m++)D[m]=2;for(m=103113;m<=103116;m++)D[m]=0;for(m=103117;m<=103120;m++)D[m]=2;for(m=103153;m<=103157;m++)D[m]=0;for(m=103158;m<=103162;m++)D[m]=2;for(m=103163;m<=103165;m++)D[m]=0;for(m=103166;m<=103168;m++)D[m]=1;for(m=103169;m<=103171;m++)D[m]=2;for(m=103186;m<=103188;m++)D[m]=0;for(m=103189;m<=103191;m++)D[m]=2;for(m=103192;m<=103195;m++)D[m]=0;for(m=103196;m<=103199;m++)D[m]=2;for(m=103200;m<=103224;m++)D[m]=0;for(m=103225;m<=103227;m++)D[m]=1;for(m=103232;m<=103237;m++)D[m]=0;for(m=103238;m<=103243;m++)D[m]=2;for(m=103244;m<=103246;m++)D[m]=0;for(m=103247;m<=103249;m++)D[m]=2;for(m=103254;m<=103256;m++)D[m]=0;for(m=103257;m<=103259;m++)D[m]=2;for(m=103264;m<=103266;m++)D[m]=0;for(m=103267;m<=103269;m++)D[m]=2;for(m=103300;m<=103375;m++)D[m]=0;for(m=103381;m<=103383;m++)D[m]=0;for(m=103384;m<=103386;m++)D[m]=1;for(m=103387;m<=103389;m++)D[m]=0;for(m=103390;m<=103392;m++)D[m]=2;for(m=103397;m<=103399;m++)D[m]=0;for(m=103400;m<=103471;m++)D[m]=2;for(m=103476;m<=103478;m++)D[m]=0;for(m=103479;m<=103481;m++)D[m]=2;for(m=103486;m<=103488;m++)D[m]=0;for(m=103489;m<=103491;m++)D[m]=2;for(m=103492;m<=103495;m++)D[m]=0;for(m=103496;m<=103499;m++)D[m]=2;for(m=103528;m<=103543;m++)D[m]=0;for(m=103544;m<=103548;m++)D[m]=2;for(m=103549;m<=103551;m++)D[m]=0;for(m=103552;m<=103554;m++)D[m]=1;for(m=103555;m<=103557;m++)D[m]=2;for(m=103558;m<=103560;m++)D[m]=0;for(m=103571;m<=103573;m++)D[m]=0;for(m=103574;m<=103576;m++)D[m]=2;for(m=103577;m<=103580;m++)D[m]=0;for(m=103581;m<=103583;m++)D[m]=2;for(m=103595;m<=103694;m++)D[m]=0;for(m=103696;m<=103699;m++)D[m]=0;for(m=103700;m<=103793;m++)D[m]=2;for(m=103794;m<=103872;m++)D[m]=0;for(m=103900;m<=103971;m++)D[m]=2;const ESe={102113:!0,102100:!0,3857:!0,3785:!0},ASe={102113:!0,102100:!0,3857:!0,3785:!0,4326:!0},aY='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',DM=[-20037508342788905e-9,20037508342788905e-9],LM=[-20037508342787e-6,20037508342787e-6],wae={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:DM,origin:LM,dx:1e-5},102100:{wkTemplate:aY,valid:DM,origin:LM,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:DM,origin:LM,dx:1e-5},3857:{wkTemplate:aY,valid:DM,origin:LM,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Kc(e,t){return!C(e)&&!C(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||Q1(e)&&Q1(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function x0(e){return qc(e)&&e.wkid?wae[e.wkid]:null}function xae(e){return!!qc(e)&&(e.wkid?D[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function dR(e){return!(pf(e)||ff(e))}function pR(e){return qc(e)&&e.wkid===4326}function Tae(e){return qc(e)&&e.wkid===qu.CGCS2000}function Q1(e){return qc(e)&&e.wkid!=null&&ESe[e.wkid]===!0}function Sae(e){return qc(e)&&e.wkid===32662}function V7(e){return e===qu.GCSMARS2000||e===qu.GCSMARS2000_SPHERE}function pf(e){return qc(e)&&e.wkid!=null&&V7(e.wkid)}function G7(e){return e===qu.GCSMOON2000}function ff(e){return qc(e)&&e.wkid!=null&&G7(e.wkid)}function CSe(e){return qc(e)&&e.wkid!=null&&ASe[e.wkid]===!0}function qc(e){return _(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const RSe={wkid:4326,wkt:Zp(wae[4326].wkTemplate,{Central_Meridian:"0.0"})},OSe={wkid:102100,latestWkid:3857},MSe={wkid:32662};var rp;let pr=rp=class extends _e{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return rp.WebMercator;if(e.wkid===4326)return rp.WGS84}const t=new rp;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return pR(this)}get isWebMercator(){return Q1(this)}get isGeographic(){return xae(this)}get isWrappable(){return CSe(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===rp.WGS84)return rp.WGS84;if(this===rp.WebMercator)return rp.WebMercator;const e=new rp;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=re(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return Kc(this,e)}toJSON(e){return this.write(void 0,e)}};pr.GCS_NAD_1927=null,pr.WGS84=null,pr.WebMercator=null,pr.PlateCarree=null,u([d({readOnly:!0})],pr.prototype,"isWGS84",null),u([d({readOnly:!0})],pr.prototype,"isWebMercator",null),u([d({readOnly:!0})],pr.prototype,"isGeographic",null),u([d({readOnly:!0})],pr.prototype,"isWrappable",null),u([d({type:Dr,json:{write:!0}})],pr.prototype,"latestWkid",void 0),u([d({type:Dr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],pr.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],pr.prototype,"wkt",void 0),u([Xe("wkt"),Xe("web-scene","wkt")],pr.prototype,"writeWkt",null),u([d({type:Dr,json:{write:!0}})],pr.prototype,"vcsWkid",void 0),u([d({type:Dr,json:{write:!0}})],pr.prototype,"latestVcsWkid",void 0),u([d()],pr.prototype,"imageCoordinateSystem",void 0),pr=rp=u([P("esri.geometry.SpatialReference")],pr),pr.prototype.toJSON.isDefaultToJSON=!0,pr.GCS_NAD_1927=new pr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),pr.WGS84=new pr(RSe),pr.WebMercator=new pr(OSe),pr.PlateCarree=new pr(MSe),Object.freeze&&(Object.freeze(pr.GCS_NAD_1927),Object.freeze(pr.WGS84),Object.freeze(pr.WebMercator));const Ke=pr;let sp=class extends _e{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ke.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof Ke)return e;if(e!=null){const i=new Ke;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([d()],sp.prototype,"type",void 0),u([d({readOnly:!0})],sp.prototype,"cache",null),u([d({readOnly:!0})],sp.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],sp.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],sp.prototype,"hasZ",void 0),u([d({type:Ke,json:{write:!0}})],sp.prototype,"spatialReference",void 0),u([Ne("spatialReference")],sp.prototype,"readSpatialReference",null),sp=u([P("esri.geometry.Geometry")],sp);const tl=sp;function PSe(e,t,i,r){var s;return e.x=e.x+t,e.y=e.y+i,r!=null&&(e.z=((s=e.z)!=null?s:0)+r),e}function ISe(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}class j7{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const ai=new j7(6378137,1/298.257223563,3e5,.006694379990137799),Gp=new j7(3396190,1/169.8944472236118,23e4),Jm=new j7(1737400,0,0),$Se=57.29577951308232,DSe=.017453292519943;function lY(e){return e*$Se}function cY(e){return e*DSe}function uY(e){return e/ai.radius}function DD(e){return Math.PI/2-2*Math.atan(Math.exp(-e/ai.radius))}function q6(e){return e.wkid!=null||e.wkt!=null}const D5=[0,0];function LD(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,D5,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,D5,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,D5,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function T0(e,t){const i=e&&(q6(e)?e:e.spatialReference),r=t&&(q6(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!Kc(r,i)||Q1(r)&&pR(i)||Q1(i)&&pR(r))}function Ub(e,t){if(C(e))return null;const i=e.spatialReference,r=t&&(q6(t)?t:t.spatialReference);return T0(i,r)?Kc(i,r)?re(e):Q1(r)?LD(e,Kx,Ke.WebMercator,!1,re(e)):pR(r)?LD(e,TC,Ke.WGS84,!1,re(e)):null:null}function Kx(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=cY(t);return i[0]=cY(e)*ai.radius,i[1]=ai.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function TC(e,t,i=[0,0],r=!1){const s=lY(e/ai.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=lY(Math.PI/2-2*Math.atan(Math.exp(-t/ai.radius))),i}function Bm(e,t=!1,i=re(e)){return LD(e,Kx,Ke.WebMercator,t,i)}function uA(e,t=!1,i=re(e)){return LD(e,TC,Ke.WGS84,t,i)}var OI;const W2=[0,0];function hY(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const NM=pe.getLogger("esri.geometry.Point");let Ma=OI=class extends tl{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ke(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)NM.warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)NM.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=Kx(n.longitude,n.latitude,W2);e=a[0],t=a[1]}}}else hY(i)?(s=i,i=null):hY(r)&&(s=r,r=null);const o={x:e,y:t};return o.x==null&&o.y!=null?NM.warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&NM.warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return TC(t,i,W2)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",Kx(i,e,W2)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return TC(e,t,W2)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",Kx(e,t,W2)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new OI;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return OI.copy(e,this),this}equals(e){if(C(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=Kx(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=TC(l,c),h=n}return t===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(e,t,i){return PSe(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=x0(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return ISe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],Ma.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ma.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ma.prototype,"hasZ",null),u([d({type:Number})],Ma.prototype,"latitude",null),u([d({type:Number})],Ma.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Bt(e=>isNaN(e)?e:zu(e))],Ma.prototype,"x",void 0),u([Xe("x")],Ma.prototype,"writeX",null),u([Ne("x")],Ma.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],Ma.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ma.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ma.prototype,"m",void 0),Ma=OI=u([P("esri.geometry.Point")],Ma),Ma.prototype.toJSON.isDefaultToJSON=!0;const We=Ma;let jf=class extends df(_e){constructor(...e){super(...e),this.position=new We([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=zu(e.x||0),s.y=zu(e.y||0),s.z=e.hasZ?zu(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new We;return i.read(e,t),i.x=zu(i.x||0),i.y=zu(i.y||0),i.z=i.hasZ?zu(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:We,json:{write:{isRequired:!0}}})],jf.prototype,"position",void 0),u([Xe("position")],jf.prototype,"writePosition",null),u([Ne("position")],jf.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Bt(e=>k7.normalize(zu(e)))],jf.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Bt(e=>He(zu(e),-180,180))],jf.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],jf.prototype,"fov",void 0),jf=u([P("esri.Camera")],jf);const il=jf;function xt(e,t){const i=t?ge(L({},t),{source:e}):e;return d({aliasOf:i})}class yi{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=i,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&Gl(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const i=this.apiToJSON[t];return this.options.useNumericKeys?+i:i}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}}function Uo(){return function(e,t){return new yi(e,L({ignoreUnknown:!0},t))}}function vt(e,t={}){var i;const r=e instanceof yi?e:new yi(e,t),s={type:(i=t==null?void 0:t.ignoreUnknown)==null||i?r.apiValues:String,json:{type:r.jsonValues,read:(t==null||!t.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(s.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(s.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(s.json.name=t.name),d(s)}function H7(e){return(t,i)=>{t[i]=e}}const L5=[0,0];function q7(e,t){return!!_(t)&&na(e,t.x,t.y,t.z)}function fpt(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!lS(e,i))return!1;return!0}function LSe(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?na(e,i,r,s)&&na(e,i,o,s)&&na(e,n,o,s)&&na(e,n,r,s)&&na(e,i,r,a)&&na(e,i,o,a)&&na(e,n,o,a)&&na(e,n,r,a):na(e,i,r)&&na(e,i,o)&&na(e,n,o)&&na(e,n,r)}function lS(e,t){return na(e,t[0],t[1])}function NSe(e,t){return na(e,t[0],t[1],t[2])}function na(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function FSe(e,t){return L5[1]=t.y,L5[0]=t.x,Eae(e,L5)}function Eae(e,t){return USe(e.rings,t)}function USe(e,t){if(!e)return!1;if(zSe(e))return dY(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=dY(i,e[r],t);return i}function zSe(e){return!Array.isArray(e[0][0])}function dY(e,t,i){const[r,s]=i;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,f]=t[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<r&&(n=!n)}return n}function kSe(e,t){return q7(e,t)}function BSe(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function VSe(e,t){const{points:i,hasZ:r}=t,s=r?NSe:lS;for(const n of i)if(s(e,n))return!0;return!1}const J1=[0,0],K1=[0,0],eb=[0,0],tb=[0,0],GSe=[J1,K1,eb,tb],Aae=[[eb,J1],[J1,K1],[K1,tb],[tb,eb]];function jSe(e,t){J1[0]=e.xmin,J1[1]=e.ymax,K1[0]=e.xmax,K1[1]=e.ymax,eb[0]=e.xmin,eb[1]=e.ymin,tb[0]=e.xmax,tb[1]=e.ymin;for(const i of GSe)if(Eae(t,i))return!0;for(const i of t.rings){if(!i.length)continue;let r=i[0];if(lS(e,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(lS(e,n)||Cae(r,n,Aae))return!0;r=n}}return!1}function HSe(e,t){J1[0]=e.xmin,J1[1]=e.ymax,K1[0]=e.xmax,K1[1]=e.ymax,eb[0]=e.xmin,eb[1]=e.ymin,tb[0]=e.xmax,tb[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(lS(e,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(lS(e,o)||Cae(s,o,Aae))return!0;s=o}}return!1}const qn=[0,0];function qSe(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(W6(n,o,c,h,qn)&&!(qn[0]===n[0]&&qn[1]===n[1]||qn[0]===c[0]&&qn[1]===c[1]||qn[0]===o[0]&&qn[1]===o[1]||qn[0]===h[0]&&qn[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(W6(o,a,c,h,qn)&&!(qn[0]===o[0]&&qn[1]===o[1]||qn[0]===c[0]&&qn[1]===c[1]||qn[0]===a[0]&&qn[1]===a[1]||qn[0]===h[0]&&qn[1]===h[1]))return!0}}}return!1}function Cae(e,t,i){for(let r=0;r<i.length;r++)if(W6(e,t,i[r][0],i[r][1]))return!0;return!1}function W6(e,t,i,r,s){const[n,o]=e,[a,l]=t,[c,h]=i,[p,f]=r,g=p-c,y=n-c,v=a-n,b=f-h,w=o-h,S=l-o,x=b*v-g*S;if(x===0)return!1;const E=(g*w-b*y)/x,R=(v*w-S*y)/x;return E>=0&&E<=1&&R>=0&&R<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function WSe(e){switch(e){case"esriGeometryEnvelope":case"extent":return BSe;case"esriGeometryMultipoint":case"multipoint":return VSe;case"esriGeometryPoint":case"point":return kSe;case"esriGeometryPolygon":case"polygon":return jSe;case"esriGeometryPolyline":case"polyline":return HSe}}var vu;function XSe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function Cg(e,t,i){return t==null?i:i==null?t:e(t,i)}let wn=vu=class extends tl{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return XSe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?Ke.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s==null?Ke.WGS84:s}}static fromBounds(e,t){return new vu({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new vu({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new We({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new vu;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&T0(t,i)&&(e=t.isWebMercator?Bm(e):uA(e,!0)),e.type==="point"?q7(this,e):e.type==="extent"&&LSe(this,e)}equals(e){if(this===e)return!0;if(C(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&T0(t,i)&&(e=t.isWebMercator?Bm(e):uA(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(C(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&T0(t,i)&&(e=t.isWebMercator?Bm(e):uA(e,!0)),WSe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Cg(Math.min,this.zmin,e.zmin),this.zmax=Cg(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Cg(Math.min,this.mmin,e.mmin),this.mmax=Cg(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:C(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Cg(Math.max,this.zmin,e.zmin),this.zmax=Cg(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Cg(Math.max,this.mmin,e.mmin),this.mmax=Cg(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=x0(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?uA(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new Ke(Zp(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||x0(r)))return this;const s=this._getParts(i).map(a=>a.extent);if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,o=!0;return s.forEach(a=>{a.hasZ||(n=!1),a.hasM||(o=!1)}),{rings:s.map(a=>{const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(n){const c=(a.zmax-a.zmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}if(o){const c=(a.mmax-a.mmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}return l}),hasZ:n,hasM:o,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||x0(o);const[p,f]=e.valid;h=this._normalizeX(this.xmin,e);const g=h.x,y=h.frameId;h=this._normalizeX(this.xmax,e);const v=h.x,b=h.frameId,w=g===v&&a>0;if(a>2*f){const S=new vu(l<c?g:v,s,f,n,o),x=new vu(p,s,l<c?v:g,n,o),E=new vu(0,s,f,n,o),R=new vu(p,s,0,n,o),O=[],I=[];S.contains(E)&&O.push(y),S.contains(R)&&I.push(y),x.contains(E)&&O.push(b),x.contains(R)&&I.push(b);for(let U=y+1;U<b;U++)O.push(U),I.push(U);t.push({extent:S,frameIds:[y]},{extent:x,frameIds:[b]},{extent:E,frameIds:O},{extent:R,frameIds:I})}else g>v||w?t.push({extent:new vu(g,s,f,n,o),frameIds:[y]},{extent:new vu(p,s,v,n,o),frameIds:[b]}):t.push({extent:new vu(g,s,v,n,o),frameIds:[y]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([d({readOnly:!0})],wn.prototype,"cache",null),u([d({readOnly:!0})],wn.prototype,"center",null),u([d({readOnly:!0})],wn.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],wn.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],wn.prototype,"hasZ",null),u([d({readOnly:!0})],wn.prototype,"height",null),u([d({readOnly:!0})],wn.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],wn.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],wn.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],wn.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],wn.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],wn.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],wn.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],wn.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],wn.prototype,"zmax",void 0),wn=vu=u([P("esri.geometry.Extent")],wn),wn.prototype.toJSON.isDefaultToJSON=!0;const ni=wn;function cS(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var X6;function pY(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function YSe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let ly=X6=class extends tl{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):YSe(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new ni,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=pY(Math.min),a=pY(Math.max);let l,c,h,p,[f,g]=n,[y,v]=n;for(let b=0,w=e.length;b<w;b++){const S=e[b],[x,E]=S;if(f=o(f,x),g=o(g,E),y=a(y,x),v=a(v,E),i&&S.length>2){const R=S[2];l=o(l,R),h=a(h,R)}if(r&&S.length>s){const R=S[s];c=o(c,R),p=a(p,R)}}return t.xmin=f,t.ymin=g,t.xmax=y,t.ymax=v,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=null,t.zmax=null),r?(t.mmin=c,t.mmax=p):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=re(this.points)}addPoint(e){return cS(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:re(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new X6(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new We(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new We(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(cS(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([d({readOnly:!0})],ly.prototype,"cache",null),u([d()],ly.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],ly.prototype,"points",void 0),u([Xe("points")],ly.prototype,"writePoints",null),ly=X6=u([P("esri.geometry.Multipoint")],ly),ly.prototype.toJSON.isDefaultToJSON=!0;const zb=ly;function W7(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function Rae(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function ZSe(e,t){return Rae(e,t,.5)}function Oae(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=W7(e[r],e[r+1]);return i}function Mae(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const n=W7(e[s],e[s+1]);if(t-r<n){const o=(t-r)/n;return Rae(e[s],e[s+1],o)}r+=n}return e[i-1]}function X7(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],c=e[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function mpt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function QSe(e){return e?Pae(e.rings,e.hasZ):null}function Pae(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=JSe(e[n],t,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=e[0]&&e[0].length?KSe(e[0],t):null;if(!n)return null;i[0]=n[0],i[1]=n[1],t&&n.length>2&&(i[2]=n[2])}return i}function JSe(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const g=e[f],y=e[(f+1)%e.length],[v,b,w]=g,S=v-l,x=b-c,E=t?w-h:void 0,[R,O,I]=y,U=R-l,N=O-c,V=t?I-h:void 0,j=S*N-U*x;if(o+=j,r+=(S+U)*j,s+=(x+N)*j,t&&g.length>2&&y.length>2){const H=S*V-U*E;n+=(E+V)*H,a+=H}v<i[0]&&(i[0]=v),v>i[1]&&(i[1]=v),b<i[2]&&(i[2]=b),b>i[3]&&(i[3]=b),t&&(w<i[4]&&(i[4]=w),w>i[5]&&(i[5]=w))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,s/(6*o)+c,o];return t&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function KSe(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],t&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const f=W7(i,r);if(f){s+=f;const g=ZSe(h,p);n+=f*g[0],o+=f*g[1],t&&g.length>2&&(a+=f*g[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}function Iae(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function $ae(e){return e.points!==void 0}function Dae(e){return e.x!==void 0&&e.y!==void 0}function Lae(e){return e.paths!==void 0}function Nae(e){return e.rings!==void 0}function Fae(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}const s0=Fae(Math.min),n0=Fae(Math.max);function gpt(e,t){return Lae(t)?uS(e,t.paths,!1,!1):Nae(t)?uS(e,t.rings,!1,!1):$ae(t)?Y7(e,t.points,!1,!1,!1,!1):Iae(t)?Uae(e,t):(Dae(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function ypt(e,t){return Lae(t)?uS(e,t.paths,!0,!1):Nae(t)?uS(e,t.rings,!0,!1):$ae(t)?Y7(e,t.points,!0,!1,!0,!1):Iae(t)?Uae(e,t,!0,!1,!0,!1):(Dae(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function uS(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,f]=t[0][0];for(let g=0;g<t.length;g++){const y=t[g];for(let v=0;v<y.length;v++){const b=y[v],[w,S]=b;if(c=s0(c,w),h=s0(h,S),p=n0(p,w),f=n0(f,S),i&&b.length>2){const x=b[2];n=s0(n,x),o=n0(o,x)}if(r&&b.length>s){const x=b[s];a=s0(n,x),l=n0(o,x)}}}return i?r?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):r?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function Uae(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,f=t.mmin,g=t.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,g=g||0,e[0]=o,e[1]=l,e[2]=h,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=g,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,g=g||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=g,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function Y7(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let c,h,p,f,[g,y]=t[0],[v,b]=t[0];for(let w=0;w<t.length;w++){const S=t[w],[x,E]=S;if(g=s0(g,x),y=s0(y,E),v=n0(v,x),b=n0(b,E),l&&S.length>2){const R=S[2];c=s0(c,R),h=n0(h,R)}if(a&&S.length>o){const R=S[o];p=s0(c,R),f=n0(h,R)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,e[0]=g,e[1]=y,e[2]=c,e[3]=p,e[4]=v,e[5]=b,e[6]=h,e[7]=f,e):(e[0]=g,e[1]=y,e[2]=c,e[3]=v,e[4]=b,e[5]=h,e)):n?(p=p||0,f=f||0,e[0]=g,e[1]=y,e[2]=p,e[3]=v,e[4]=b,e[5]=f,e):(e[0]=g,e[1]=y,e[2]=v,e[3]=b,e)}function e2e(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function t2e(e){return e.points!==void 0}function i2e(e){return e.x!==void 0&&e.y!==void 0}function r2e(e){return e.paths!==void 0}function s2e(e){return e.rings!==void 0}const Z7=[];function zae(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function kae(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function Bae(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function Vae(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function Q7(e,t=!1,i=!1){return t?i?Vae(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):kae(e[0],e[1],e[2],e[3],e[4],e[5]):i?Bae(e[0],e[1],e[2],e[3],e[4],e[5]):zae(e[0],e[1],e[2],e[3])}function vpt(e){return e?e2e(e)?e:i2e(e)?o2e(e):s2e(e)?Gae(e):r2e(e)?jae(e):t2e(e)?n2e(e):null:null}function n2e(e){const{hasZ:t,hasM:i,points:r}=e;return Q7(Y7(Z7,r,t,i),t,i)}function o2e(e){const{x:t,y:i,z:r,m:s}=e,n=s!=null;return r!=null?n?Vae(t,i,r,s,t,i,r,s):kae(t,i,r,t,i,r):n?Bae(t,i,s,t,i,s):zae(t,i,t,i)}function Gae(e){const{hasZ:t,hasM:i,rings:r}=e,s=uS(Z7,r,t,i);return s?Q7(s,t,i):null}function jae(e){const{hasZ:t,hasM:i,paths:r}=e,s=uS(Z7,r,t,i);return s?Q7(s,t,i):null}var MI;function fY(e){return!Array.isArray(e[0])}let np=MI=class extends tl{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const o of t)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new MI(n)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Ke.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=QSe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new We;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Gae(this);if(!t)return null;const i=new ni(t);return i.spatialReference=e,i}get isSelfIntersecting(){return qSe(this.rings)}writeRings(e,t){t.rings=re(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(fY(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new MI;return e.spatialReference=this.spatialReference,e.rings=re(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(C(e))return!1;const t=this.spatialReference,i=e.spatialReference;if(_(t)!==_(i)||_(t)&&_(i)&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!I0(n,o,r))return!1}return!0}contains(e){if(!e)return!1;const t=Ub(e,this.spatialReference);return FSe(this,_(t)?t:e)}isClockwise(e){let t;return t=fY(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,X7(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new We(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new We(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new We(i[0],i[1],i[2],i[3],this.spatialReference):new We(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(cS(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new We(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new We(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(cS(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],np.prototype,"cache",null),u([d({readOnly:!0})],np.prototype,"centroid",null),u([d({readOnly:!0})],np.prototype,"extent",null),u([d({readOnly:!0})],np.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],np.prototype,"rings",void 0),u([Xe("rings")],np.prototype,"writeRings",null),np=MI=u([P("esri.geometry.Polygon")],np),np.prototype.toJSON.isDefaultToJSON=!0;const jl=np;var Y6;function a2e(e){return!Array.isArray(e[0])}let cy=Y6=class extends tl{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Ke.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=jae(this);if(!t)return null;const i=new ni(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=re(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(a2e(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new Y6;return e.spatialReference=this.spatialReference,e.paths=re(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new We(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new We(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new We(i[0],i[1],i[2],i[3],this.spatialReference):new We(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(cS(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new We(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new We(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(cS(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],cy.prototype,"cache",null),u([d({readOnly:!0})],cy.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],cy.prototype,"paths",void 0),u([Xe("paths")],cy.prototype,"writePaths",null),cy=Y6=u([P("esri.geometry.Polyline")],cy),cy.prototype.toJSON.isDefaultToJSON=!0;const Nc=cy,Hae=Uo()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),mY=Uo()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function qae(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function J7(e){return e.points!==void 0}function K7(e){return e.x!==void 0&&e.y!==void 0}function ej(e){return e.paths!==void 0}function P1(e){return e.rings!==void 0}function Km(e){return C(e)?null:e instanceof tl?e:K7(e)?We.fromJSON(e):ej(e)?Nc.fromJSON(e):P1(e)?jl.fromJSON(e):J7(e)?zb.fromJSON(e):qae(e)?ni.fromJSON(e):null}function u2(e){return e?K7(e)?"esriGeometryPoint":ej(e)?"esriGeometryPolyline":P1(e)?"esriGeometryPolygon":qae(e)?"esriGeometryEnvelope":J7(e)?"esriGeometryMultipoint":null:null}const l2e={esriGeometryPoint:We,esriGeometryPolyline:Nc,esriGeometryPolygon:jl,esriGeometryEnvelope:ni,esriGeometryMultipoint:zb};function Wae(e){return e&&l2e[e]||null}const kb={base:tl,key:"type",typeMap:{extent:ni,multipoint:zb,point:We,polyline:Nc,polygon:jl}};xd(kb);class CT{constructor(){this._emitter=new CT.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this.target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this.target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return eS(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([P("esri.core.Evented")],s),s};let i=class extends be{constructor(){super(...arguments),this._emitter=new CT.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([P("esri.core.Evented")],i),e.EventedAccessor=i})(CT||(CT={}));const qr=CT;var Ui;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Ui||(Ui={}));class c2e{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new Toe(this._observers,t)}notify(){const t=this._observers.slice();for(let i=0;i<t.length;++i){const r=t[i];r.onInvalidated(),r.onCommitted()}}}var Cm;class u2e{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const nu=new as(u2e,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),h2e=()=>{};function N5(e){return e?e instanceof J_?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function F5(e){if(e&&e.length)return e[0]}function d2e(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function Xae(e,t,i,r){t&&t.forEach((s,n,o)=>{e.push(s),Xae(e,i.call(r,s,n,o),i,r)})}const Rg=new Set,Og=new Set,Mg=new Set,U5=new Map;let p2e=0,J_=Cm=class extends qr.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new c2e,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:p2e++})}static isCollection(e){return e!=null&&e instanceof Cm}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof Cm?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return ei(this._observable),this._items}set items(e){this._emitBeforeChanges(Ui.ADD)||(this._splice(0,this.length,N5(e)),this._emitAfterChanges(Ui.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=h2e,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(ei(this._observable),this._emitBeforeChanges(Ui.ADD))return this;const i=this.getNextIndex(t!=null?t:null);return this._splice(i,0,[e]),this._emitAfterChanges(Ui.ADD),this}addMany(e,t=this._items.length){if(ei(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Ui.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,N5(e)),this._emitAfterChanges(Ui.ADD),this}at(e){if(ei(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(ei(this._observable),!this.length||this._emitBeforeChanges(Ui.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(Ui.REMOVE),e}clone(){return ei(this._observable),this._createNewInstance({items:this._items.map(re)})}concat(...e){ei(this._observable);const t=e.map(N5);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(ei(this._observable),!this.length||this._emitBeforeChanges(Ui.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(Ui.REMOVE)}every(e,t){return ei(this._observable),this._items.every(e,t)}filter(e,t){let i;return ei(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return ei(this._observable),this._items.find(e,t)}findIndex(e,t){return ei(this._observable),this._items.findIndex(e,t)}flatten(e,t){ei(this._observable);const i=[];return Xae(i,this,e,t),new Cm(i)}forEach(e,t){return ei(this._observable),this._items.forEach(e,t)}getItemAt(e){return ei(this._observable),this._items[e]}getNextIndex(e){ei(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return ei(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return ei(this._observable),this._items.indexOf(e,t)}join(e=","){return ei(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return ei(this._observable),this._items.lastIndexOf(e,t)}map(e,t){ei(this._observable);const i=this._items.map(e,t);return new Cm({items:i})}reorder(e,t=this.length-1){ei(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(Ui.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(Ui.MOVE)}return e}}pop(){if(ei(this._observable),!this.length||this._emitBeforeChanges(Ui.REMOVE))return;const e=F5(this._splice(this.length-1,1));return this._emitAfterChanges(Ui.REMOVE),e}push(...e){return ei(this._observable),this._emitBeforeChanges(Ui.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Ui.ADD)),this.length}reduce(e,t){ei(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){ei(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return ei(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(ei(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Ui.REMOVE))return;const t=F5(this._splice(e,1));return this._emitAfterChanges(Ui.REMOVE),t}removeMany(e){if(ei(this._observable),!e||!e.length||this._emitBeforeChanges(Ui.REMOVE))return[];const t=e instanceof Cm?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=i.indexOf(o);if(a>-1){const l=1+d2e(t,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Ui.REMOVE),r}reverse(){if(ei(this._observable),this._emitBeforeChanges(Ui.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Ui.MOVE),this}shift(){if(ei(this._observable),!this.length||this._emitBeforeChanges(Ui.REMOVE))return;const e=F5(this._splice(0,1));return this._emitAfterChanges(Ui.REMOVE),e}slice(e=0,t=this.length){return ei(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return ei(this._observable),this._items.some(e,t)}sort(e){if(ei(this._observable),!this.length||this._emitBeforeChanges(Ui.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Ui.MOVE),this}splice(e,t,...i){ei(this._observable);const r=(t?Ui.REMOVE:0)|(i.length?Ui.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return ei(this._observable),this._items.slice()}toJSON(){return ei(this._observable),this.toArray()}toLocaleString(){return ei(this._observable),this._items.toLocaleString()}toString(){return ei(this._observable),this._items.toString()}unshift(...e){return ei(this._observable),!e.length||this._emitBeforeChanges(Ui.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Ui.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=IO(()=>this._dispatchChange())),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const a=nu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(e,0,n),e+=1,l-=1,c-=1);nu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=nu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);nu.release(a)}}if(i&&i.length){if(s){const h=[];for(const p of i){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=nu.acquire();h.target=this,h.cancellable=!0;const p=nu.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));nu.release(p),nu.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=nu.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,nu.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=nu.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),nu.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;Rg.clear(),Og.clear(),Mg.clear();for(const{added:l,removed:c}of i){if(l)if(Mg.size===0&&Og.size===0)for(const h of l)Rg.add(h);else for(const h of l)Og.has(h)?(Mg.add(h),Og.delete(h)):Mg.has(h)||Rg.add(h);if(c)if(Mg.size===0&&Rg.size===0)for(const h of c)Og.add(h);else for(const h of c)Rg.has(h)?Rg.delete(h):(Mg.delete(h),Og.add(h))}const r=Dl.acquire();Rg.forEach(l=>{r.push(l)});const s=Dl.acquire();Og.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=Dl.acquire();if(Mg.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}Dl.release(r),Dl.release(s),Dl.release(a)}Rg.clear(),Og.clear(),Mg.clear()}};J_.ofType=e=>{if(!e)return Cm;if(U5.has(e))return U5.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends Cm{};return u([H7({Type:e,ensureType:typeof e=="function"?As(e):xd(e)})],i.prototype,"itemType",void 0),i=u([P(`esri.core.Collection<${t}>`)],i),U5.set(e,i),i},u([d()],J_.prototype,"length",void 0),u([d()],J_.prototype,"items",null),J_=Cm=u([P("esri.core.Collection")],J_);const St=J_;var hS;function f2e(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return hS.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==t))return hS.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(hS||(hS={}));let z5;function Jp(){return z5||(z5=(async()=>{const e=await import("./arcadeUtils.65026d41.js").then(function(t){return t.q});return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),z5}const m2e=(e,t,i)=>NO.create(e,t,i,null,["$feature"]),g2e=(e,t,i)=>NO.create(e,t,i,null,["$feature","$view"]),y2e=(e,t,i,r)=>NO.create(e,t,i,r,["$feature","$view"]);class NO{constructor(t,i,r,s,n,o,a,l){this.script=t,this.evaluate=n;const c=Array.isArray(a)?a:a.fields;this.fields=c,this._syntaxTree=s,this._arcade=i,this._arcadeDictionary=r,this._arcadeFeature=o,this._spatialReference=l,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await Jp(),h=Ke.fromJSON(i),p=a.parseScript(t,o),f=n.reduce((R,O)=>ge(L({},R),{[O]:null}),{});let g=null;_(s)&&(g=new c(s),g.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p)&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(p)&&a.enableAsyncSupport(),w={vars:f,spatialReference:h,useAsync:!!b},S=new c;S.immutable=!1,S.setField("scale",0);const x=a.compileScript(p,w),E=R=>("$view"in R&&R.$view&&(S.setField("scale",R.$view.scale),R.$view=S),g&&(R.$config=g),x({vars:R,spatialReference:h}));return await Promise.all([y,v,b]),new NO(t,a,c,p,E,new l,r,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const v2e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],_2e=["field","normalizationField"];function gY(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if(yY(v2e,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)yY(_2e,r,t)}}function yY(e,t,i){if(e)for(const r of e){const s=l2(r,t),n=s&&typeof s!="function"&&i.get(s);n&&Gl(r,n.name,t)}}function Yae(e,t){if(e!=null&&t!=null&&t.fields.length)if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const k5=new Set;function Zae(e,t){return e&&t?(k5.clear(),fR(k5,e,t),Array.from(k5).sort()):[]}function fR(e,t,i){var r;if(i)if(t!=null&&(r=t.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)th(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)e.add(s)}}function th(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function _pt(e,t){return C(t)||C(e)?[]:t.includes("*")?e.fields.map(i=>i.name):t}async function Wc(e,t,i){var r;if(!i)return;const{arcadeUtils:s}=await Jp(),n=s.extractFieldNames(i,t==null||(r=t.fields)==null?void 0:r.map(o=>o.name));for(const o of n)th(e,t,o)}async function Qae(e,t,i){if(i&&i!=="1=1"){const r=(await import("./WhereClause.d10f799a.js")).WhereClause.create(i,t);if(!r.isStandardized)throw new Y("fieldUtils:collectFilterFields","Where clause is not standardized");fR(e,t,r.fieldNames)}}function b2e({displayField:e,fields:t}){return e||(t&&t.length?B5(t,"name-or-title")||B5(t,"unique-identifier")||B5(t,"type-or-category")||w2e(t):null)}function w2e(e){for(const t of e){if(!t||!t.name)continue;const i=t.name.toLowerCase();if(i.includes("name")||i.includes("title"))return t.name}return null}function B5(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function bpt(e,t){if(!t)return;const i=l2("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function x2e(e,t,i){i.outStatistic.onStatisticValueExpression?Wc(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}async function wpt(e,t,i){var r,s;if(!t||!i||i.type!=="cluster")return;const n=[];if((r=i.popupTemplate)!=null&&r.expressionInfos&&n.push(...i.popupTemplate.expressionInfos.map(o=>Wc(e,t.fieldsIndex,o.expression))),Array.isArray((s=i.popupTemplate)==null?void 0:s.content)){const o=i.popupTemplate.content;for(const a of o)a.type==="expression"&&a.expressionInfo&&n.push(Wc(e,t.fieldsIndex,a.expressionInfo.expression))}i.fields&&n.push(...i.fields.map(o=>x2e(e,t.fieldsIndex,o))),await Promise.all(n)}async function xpt(e,t,i){t&&(t.timeInfo&&_(i)&&i.timeExtent&&fR(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&fR(e,t.fieldsIndex,[t.floorInfo.floorField]),_(i)&&_(i.where)&&await Qae(e,t.fieldsIndex,i.where))}async function Tpt(e,t,i){t&&i&&await Promise.all(i.map(r=>T2e(e,t,r)))}async function T2e(e,t,i){t&&i&&(i.valueExpression?await Wc(e,t.fieldsIndex,i.valueExpression):i.field&&th(e,t.fieldsIndex,i.field))}function Spt(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?Zae(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function Ept(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map(s=>S2e(e,r,s)))}async function S2e(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Wc(e,t,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{th(e,t,o.slice(1,-1))})}await Qae(e,t,s)}function E2e(e){const t=e.defaultValue;return t!==void 0&&ele(e,t)?t:e.nullable?null:void 0}function Jae(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function A2e(e){return e===null||Jae(e)}const tj="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function C2e(e){return e===null||tj(e)}function Kae(e){return e!=null&&typeof e=="string"}function R2e(e){return e===null||Kae(e)}function O2e(){return!0}function ele(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?C2e:tj;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?A2e:Jae;break;case"string":case"esriFieldTypeString":i=e.nullable?R2e:Kae;break;default:i=O2e}return arguments.length===1?i:i(t)}const M2e=["integer","small-integer","single","double"],P2e=new Set([...M2e,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function ZN(e){return e!=null&&P2e.has(e.type)}function Apt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}var ND,FD;function Cpt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function Rpt(e,t){return e.nullable&&t===null?null:ZN(e)&&!I2e(e.type,Number(t))?ND.OUT_OF_RANGE:ele(e,t)?e.domain?f2e(e.domain,t):null:FD.INVALID_TYPE}function I2e(e,t){const i=typeof e=="string"?tle(e):e;return!!i&&(i.isInteger?tj(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}function tle(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return $2e;case"esriFieldTypeInteger":case"integer":return D2e;case"esriFieldTypeSingle":case"single":return L2e;case"esriFieldTypeDouble":case"double":return N2e}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(ND||(ND={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(FD||(FD={}));const $2e={min:-32768,max:32767,isInteger:!0},D2e={min:-2147483648,max:2147483647,isInteger:!0},L2e={min:-34e37,max:12e37,isInteger:!1},N2e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function Opt(e,t,i){switch(e){case hS.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case hS.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case FD.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case ND.OUT_OF_RANGE:{const{min:r,max:s}=tle(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function F2e(e,t){return!U2e(e,t,null)}function U2e(e,t,i){if(!t||!t.attributes||!e){if(_(i))for(const n of e)i.add(n);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!_(i))break;i.add(n)}return s}let PI=class extends _e{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],PI.prototype,"type",void 0),PI=u([P("esri.popup.content.Content")],PI);const Bb=PI;var Z6;let r_=Z6=class extends Bb{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new Z6({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],r_.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],r_.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],r_.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],r_.prototype,"type",void 0),r_=Z6=u([P("esri.popup.content.AttachmentsContent")],r_);const mR=r_;var Q6;let s_=Q6=class extends Bb{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new Q6({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?re(this.outFields):null})}};u([d()],s_.prototype,"creator",void 0),u([d()],s_.prototype,"destroyer",void 0),u([d()],s_.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],s_.prototype,"type",void 0),s_=Q6=u([P("esri.popup.content.CustomContent")],s_);const z2e=s_;var J6;let ux=J6=class extends _e{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new J6({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],ux.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],ux.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],ux.prototype,"returnType",void 0),ux=J6=u([P("esri.popup.ElementExpressionInfo")],ux);const ile=ux;var K6;let hA=K6=class extends Bb{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new K6({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([d({type:ile,json:{write:!0}})],hA.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],hA.prototype,"type",void 0),hA=K6=u([P("esri.popup.content.ExpressionContent")],hA);const ij=hA,gR=Uo()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});gR.toJSON.bind(gR);gR.fromJSON.bind(gR);var vY,_Y,bY;let k2e,SC;const wY=(vY=(_Y=globalThis.esriConfig)==null?void 0:_Y.locale)!=null?vY:(bY=globalThis.dojoConfig)==null?void 0:bY.locale;function rle(){var e,t;return(e=wY!=null?wY:(t=globalThis.navigator)==null?void 0:t.language)!=null?e:"en"}function Uc(){return SC===void 0&&(SC=rle()),SC}const EC=[];function B2e(e){return EC.push(e),{remove(){EC.splice(EC.indexOf(e),1)}}}const eB=[];function rj(e){return eB.push(e),{remove(){EC.splice(eB.indexOf(e),1)}}}function V2e(){var e;const t=(e=k2e)!=null?e:rle();SC!==t&&(SC=t,[...eB].forEach(i=>{i.call(null,t)}),[...EC].forEach(i=>{i.call(null,t)}))}globalThis.addEventListener==null||globalThis.addEventListener("languagechange",V2e);const Ud={year:"numeric",month:"numeric",day:"numeric"},X2={year:"numeric",month:"long",day:"numeric"},Y2={year:"numeric",month:"short",day:"numeric"},Z2={year:"numeric",month:"long",weekday:"long",day:"numeric"},_u={hour:"numeric",minute:"numeric"},_h=ge(L({},_u),{second:"numeric"}),sj={"short-date":Ud,"short-date-short-time":L(L({},Ud),_u),"short-date-short-time-24":ge(L(L({},Ud),_u),{hour12:!1}),"short-date-long-time":L(L({},Ud),_h),"short-date-long-time-24":ge(L(L({},Ud),_h),{hour12:!1}),"short-date-le":Ud,"short-date-le-short-time":L(L({},Ud),_u),"short-date-le-short-time-24":ge(L(L({},Ud),_u),{hour12:!1}),"short-date-le-long-time":L(L({},Ud),_h),"short-date-le-long-time-24":ge(L(L({},Ud),_h),{hour12:!1}),"long-month-day-year":X2,"long-month-day-year-short-time":L(L({},X2),_u),"long-month-day-year-short-time-24":ge(L(L({},X2),_u),{hour12:!1}),"long-month-day-year-long-time":L(L({},X2),_h),"long-month-day-year-long-time-24":ge(L(L({},X2),_h),{hour12:!1}),"day-short-month-year":Y2,"day-short-month-year-short-time":L(L({},Y2),_u),"day-short-month-year-short-time-24":ge(L(L({},Y2),_u),{hour12:!1}),"day-short-month-year-long-time":L(L({},Y2),_h),"day-short-month-year-long-time-24":ge(L(L({},Y2),_h),{hour12:!1}),"long-date":Z2,"long-date-short-time":L(L({},Z2),_u),"long-date-short-time-24":ge(L(L({},Z2),_u),{hour12:!1}),"long-date-long-time":L(L({},Z2),_h),"long-date-long-time-24":ge(L(L({},Z2),_h),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":_u,"long-time":_h},yR=Uo()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});yR.apiValues;yR.toJSON.bind(yR);yR.fromJSON.bind(yR);const G2e={ar:"ar-u-nu-latn-ca-gregory"};let II=new WeakMap,sle=sj["short-date-short-time"];function j2e(e){const t=e||sle;if(!II.has(t)){const i=Uc(),r=G2e[Uc()]||i;II.set(t,new Intl.DateTimeFormat(r,t))}return II.get(t)}function nj(e){return sj[e]||null}function eg(e,t){return j2e(t).format(e)}rj(()=>{II=new WeakMap,sle=sj["short-date-short-time"]});const H2e={ar:"ar-u-nu-latn"};let $I=new WeakMap,nle={};function q2e(e){const t=e||nle;if(!$I.has(t)){const i=Uc(),r=H2e[Uc()]||i;$I.set(t,new Intl.NumberFormat(r,e))}return $I.get(t)}function ole(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function tg(e,t){return q2e(t).format(e)}rj(()=>{$I=new WeakMap,nle={}});var tB;let n_=tB=class extends _e{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new tB({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?eg(e,L(L({},nj(this.dateFormat)),this.dateTimeFormatOptions)):tg(e,ole(this))}};u([vt(gR)],n_.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],n_.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],n_.prototype,"digitSeparator",void 0),u([d({type:Dr,json:{write:!0}})],n_.prototype,"places",void 0),n_=tB=u([P("esri.popup.support.FieldInfoFormat")],n_);const AC=n_;var iB;let Oh=iB=class extends _e{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new iB({fieldName:this.fieldName,format:this.format?re(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Oh.prototype,"fieldName",void 0),u([d({type:AC,json:{write:!0}})],Oh.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],Oh.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],Oh.prototype,"label",void 0),u([vt(new yi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Oh.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Oh.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],Oh.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],Oh.prototype,"visible",void 0),Oh=iB=u([P("esri.popup.FieldInfo")],Oh);const FO=Oh;var rB;let Hf=rB=class extends Bb{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new rB(re({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],Hf.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Hf.prototype,"description",void 0),u([d({type:[FO]})],Hf.prototype,"fieldInfos",void 0),u([Xe("fieldInfos")],Hf.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],Hf.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Hf.prototype,"type",void 0),Hf=rB=u([P("esri.popup.content.FieldsContent")],Hf);const dS=Hf;let o_=class extends _e{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],o_.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],o_.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],o_.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],o_.prototype,"type",void 0),o_=u([P("esri.popup.content.mixins.MediaInfo")],o_);const oj=o_;var sB;let dA=sB=class extends be{constructor(e){super(e),this.tooltip=null,this.value=null}clone(){return new sB({tooltip:this.tooltip,value:this.value})}};u([d()],dA.prototype,"tooltip",void 0),u([d()],dA.prototype,"value",void 0),dA=sB=u([P("esri.popup.content.support.ChartMediaInfoValueSeries")],dA);const ale=dA;var nB;let a_=nB=class extends _e{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new nB({fields:re(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],a_.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],a_.prototype,"normalizeField",void 0),u([d({type:[ale],json:{read:!1}})],a_.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],a_.prototype,"tooltipField",void 0),a_=nB=u([P("esri.popup.content.support.ChartMediaInfoValue")],a_);const W2e=a_;let pA=class extends oj{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],pA.prototype,"type",void 0),u([d({type:W2e,json:{write:!0}})],pA.prototype,"value",void 0),pA=u([P("esri.popup.content.mixins.ChartMediaInfo")],pA);const QN=pA,JN=Uo()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var oB;let DI=oB=class extends QN{constructor(e){super(e),this.type="bar-chart"}clone(){return new oB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:JN.write}})],DI.prototype,"type",void 0),DI=oB=u([P("esri.popup.content.BarChartMediaInfo")],DI);const lle=DI;var aB;let LI=aB=class extends QN{constructor(e){super(e),this.type="column-chart"}clone(){return new aB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:JN.write}})],LI.prototype,"type",void 0),LI=aB=u([P("esri.popup.content.ColumnChartMediaInfo")],LI);const cle=LI;var lB;let fA=lB=class extends _e{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new lB({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],fA.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],fA.prototype,"sourceURL",void 0),fA=lB=u([P("esri.popup.content.support.ImageMediaInfoValue")],fA);const X2e=fA;var cB;let hx=cB=class extends oj{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new cB({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],hx.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],hx.prototype,"type",void 0),u([d({type:X2e,json:{write:!0}})],hx.prototype,"value",void 0),hx=cB=u([P("esri.popup.content.ImageMediaInfo")],hx);const ule=hx;var uB;let NI=uB=class extends QN{constructor(e){super(e),this.type="line-chart"}clone(){return new uB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:JN.write}})],NI.prototype,"type",void 0),NI=uB=u([P("esri.popup.content.LineChartMediaInfo")],NI);const hle=NI;var hB;let FI=hB=class extends QN{constructor(e){super(e),this.type="pie-chart"}clone(){return new hB({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:JN.write}})],FI.prototype,"type",void 0),FI=hB=u([P("esri.popup.content.PieChartMediaInfo")],FI);const dle=FI,ple={base:oj,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":lle,"column-chart":cle,"line-chart":hle,"pie-chart":dle,image:ule}};var dB;let Mh=dB=class extends Bb{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?ule.fromJSON(t):t.type==="barchart"?lle.fromJSON(t):t.type==="columnchart"?cle.fromJSON(t):t.type==="linechart"?hle.fromJSON(t):t.type==="piechart"?dle.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new dB(re({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],Mh.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],Mh.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Mh.prototype,"description",void 0),u([d({types:[ple]})],Mh.prototype,"mediaInfos",void 0),u([Ne("mediaInfos")],Mh.prototype,"readMediaInfos",null),u([Xe("mediaInfos")],Mh.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],Mh.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Mh.prototype,"type",void 0),Mh=dB=u([P("esri.popup.content.MediaContent")],Mh);const vR=Mh;var pB;let mA=pB=class extends Bb{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new pB({text:this.text})}};u([d({type:String,json:{write:!0}})],mA.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],mA.prototype,"type",void 0),mA=pB=u([P("esri.popup.content.TextContent")],mA);const pS=mA,Y2e={base:null,key:"type",typeMap:{attachment:mR,media:vR,text:pS,expression:ij,field:dS}};var fB;let l_=fB=class extends _e{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new fB({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],l_.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],l_.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],l_.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],l_.prototype,"returnType",void 0),l_=fB=u([P("esri.popup.ExpressionInfo")],l_);const fle=l_;var mB;let gA=mB=class extends _e{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new mB({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],gA.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],gA.prototype,"showNoDataRecords",void 0),gA=mB=u([P("esri.popup.LayerOptions")],gA);const Z2e=gA;var gB;let yA=gB=class extends _e{constructor(e){super(e),this.field=null,this.order=null}clone(){return new gB({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],yA.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],yA.prototype,"order",void 0),yA=gB=u([P("esri.popup.support.RelatedRecordsInfoFieldOrder")],yA);const mle=yA;var yB;let vA=yB=class extends _e{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new yB({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?re(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],vA.prototype,"showRelatedRecords",void 0),u([d({type:[mle],json:{write:!0}})],vA.prototype,"orderByFields",void 0),vA=yB=u([P("esri.popup.RelatedRecordsInfo")],vA);const Q2e=vA;let J2e=0;const KN=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+J2e++})}};return t=u([P("esri.core.Identifiable")],t),t};let xY=class extends KN(class{}){};xY=u([P("esri.core.Identifiable")],xY);var vB;let Ph=vB=class extends KN(be){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new vB({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],Ph.prototype,"active",void 0),u([d()],Ph.prototype,"className",void 0),u([d()],Ph.prototype,"disabled",void 0),u([d()],Ph.prototype,"id",void 0),u([d()],Ph.prototype,"indicator",void 0),u([d()],Ph.prototype,"title",void 0),u([d()],Ph.prototype,"type",void 0),u([d()],Ph.prototype,"visible",void 0),Ph=vB=u([P("esri.support.actions.ActionBase")],Ph);const eF=Ph;var _B;let UI=_B=class extends eF{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new _B({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],UI.prototype,"image",void 0),UI=_B=u([P("esri.support.Action.ActionButton")],UI);const h2=UI;var bB;let _A=bB=class extends eF{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new bB({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],_A.prototype,"image",void 0),u([d()],_A.prototype,"value",void 0),_A=bB=u([P("esri.support.Action.ActionToggle")],_A);const gle=_A;var wB;const K2e=St.ofType({key:"type",defaultKeyValue:"button",base:eF,typeMap:{button:h2,toggle:gle}}),eEe={base:Bb,key:"type",typeMap:{media:vR,custom:z2e,text:pS,attachments:mR,fields:dS,expression:ij}},yle="esri.PopupTemplate",tEe=pe.getLogger(yle),iEe=["attachments","fields","media","text","expression"];let sn=wB=class extends _e{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>xd(eEe,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Jc(e)?e:(tEe.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>iEe.includes(s.type)).map(s=>s&&s.toJSON(r)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"&&this._writeTextContent(s,t)})):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(r);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,i,r){t[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?re(e.toArray()):[];return new wB({actions:t,content:Array.isArray(this.content)?re(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?re(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?re(this.fieldInfos):null,layerOptions:this.layerOptions?re(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?re(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?re(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),fR(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=re(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach(r=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===r.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(r)}):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=re(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!t||r.mediaInfos||(s.mediaInfos=t,r.mediaInfos=!0),vR.fromJSON(s)):s.type==="text"?(s.text||!e||r.description||(s.text=e,r.description=!0),pS.fromJSON(s)):s.type==="attachments"?mR.fromJSON(s):s.type==="fields"?dS.fromJSON(s):s.type==="expression"?ij.fromJSON(s):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new pS({text:e})):r.push(new dS),Array.isArray(t)&&t.length&&r.push(vR.fromJSON({mediaInfos:t})),i&&r.push(mR.fromJSON({displayType:"auto"})),r.length?r:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((r,s)=>[...r,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((i,r)=>[...i,...r.type==="expression"&&r.expressionInfo?[r.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,i)=>[...t,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map(r=>Wc(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.includes("relationships/")&&!t.includes("expression/")):[]}_getActionsFields(e){return e?e.toArray().reduce((t,i)=>[...t,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s=r==="button"||r==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,i=e.match(t);if(!i)return[];const r=/\{(\w+):.+\}/,s=i.filter(n=>!(n.indexOf("{relationships/")===0||n.indexOf("{expression/")===0)).map(n=>n.replace(r,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([d({type:K2e})],sn.prototype,"actions",void 0),u([d()],sn.prototype,"content",void 0),u([Bt("content")],sn.prototype,"castContent",null),u([Ne("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],sn.prototype,"readContent",null),u([Xe("content",{popupElements:{type:St.ofType(Y2e)},showAttachments:{type:Boolean},mediaInfos:{type:St.ofType(ple)},description:{type:String}})],sn.prototype,"writeContent",null),u([d({type:[fle],json:{write:!0}})],sn.prototype,"expressionInfos",void 0),u([d({type:[FO]})],sn.prototype,"fieldInfos",void 0),u([Xe("fieldInfos")],sn.prototype,"writeFieldInfos",null),u([d({type:Z2e})],sn.prototype,"layerOptions",void 0),u([Xe("layerOptions")],sn.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],sn.prototype,"lastEditInfoEnabled",void 0),u([d()],sn.prototype,"outFields",void 0),u([d()],sn.prototype,"overwriteActions",void 0),u([d()],sn.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],sn.prototype,"title",void 0),u([Xe("title")],sn.prototype,"writeTitle",null),u([d({type:Q2e,json:{write:!0}})],sn.prototype,"relatedRecordsInfo",void 0),sn=wB=u([P(yle)],sn);const tF=sn,UD={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function vle(e){return UD[e]||UD[e.toLowerCase()]}function aj(e){var t;return(t=UD[e])!=null?t:UD[e.toLowerCase()]}function rEe(e){return[...aj(e)]}function V5(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function _le(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(255*V5(o,n,s+1/3)),Math.round(255*V5(o,n,s)),Math.round(255*V5(o,n,s-1/3)),r]}function sEe(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function FM(e){return He(E7(e),0,255)}function UM(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class Qs{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,i,r,s=new Qs){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Qs.fromArray(a,i)}return Qs.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Qs.fromArray(_le(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new Qs){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const r=t.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(t,i=new Qs){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=vle(t)?aj(t):null;return r&&Qs.fromArray(r,i)||Qs.fromRgb(t,i)||Qs.fromHex(t,i)}static fromJSON(t){return t&&new Qs([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return _(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return _(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){if(typeof t=="string")Qs.fromString(t,this);else if(Array.isArray(t))Qs.fromArray(t,this);else{var i,r,s,n;this._set((i=t.r)!=null?i:0,(r=t.g)!=null?r:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof Qs||this._sanitize()}return this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=Qs.AlphaMode.ALWAYS){const i=FM(this.r),r=FM(this.g),s=FM(this.b);return t===Qs.AlphaMode.ALWAYS||this.a!==1?[i,r,s,FM(255*this.a)]:[i,r,s]}clone(){return new Qs(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return _(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(UM(this.r,0,255)),this.g=Math.round(UM(this.g,0,255)),this.b=Math.round(UM(this.b,0,255)),this.a=UM(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}}Qs.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(Qs||(Qs={}));const rt=Qs,TY=new yi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let nEe=0,dx=class extends _e{constructor(e){super(e),this.id="sym"+nEe++,this.type=null,this.color=new rt([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:TY.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:TY.write}}})],dx.prototype,"type",void 0),u([d({type:rt,json:{write:{allowNull:!0}}})],dx.prototype,"color",void 0),u([Ne("color")],dx.prototype,"readColor",null),dx=u([P("esri.symbols.Symbol")],dx);const Xl=dx;var xB;let uy=xB=class extends Xl{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return Wc(e,t,n.expression)});await Promise.all(r)}}}clone(){return new xB({data:re(this.data)})}hash(){return y7(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],uy.prototype,"color",void 0),u([d({json:{write:!0}})],uy.prototype,"data",void 0),u([Ne("data",["symbol"])],uy.prototype,"readData",null),u([Xe("data",{})],uy.prototype,"writeData",null),u([vt({CIMSymbolReference:"cim"},{readOnly:!0})],uy.prototype,"type",void 0),uy=xB=u([P("esri.symbols.CIMSymbol")],uy);const d2=uy;let px=class extends _e{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],px.prototype,"enabled",void 0),u([Xe("enabled")],px.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],px.prototype,"type",void 0),px=u([P("esri.symbols.Symbol3DLayer")],px);const mf=px,oEe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,aEe="screenUtils.toPt: input not recognized!",ble=96;function $o(e){return e?e/72*ble:0}function Sd(e){return e?72*e/ble:0}function sr(e){if(typeof e=="string"){const t=e.match(oEe);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=r==="px"?Sd(i):i;return s?-n:n}return console.warn(aEe),null}return e}function Ed(e=0,t=0){return{x:e,y:t}}function Vr(e=0,t=0){return[e,t]}function lEe(e=0,t=0){return[e,t]}function no(e=0,t=0,i=0){return[e,t,i]}function Mm(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function iF(e){const t=E7(100*(1-e));return Math.max(0,Math.min(t,100))}function _R(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function cEe(e,t){const i=t.transparency!=null?_R(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new rt([r[0]||0,r[1]||0,r[2]||0,i]):null}function uEe(e,t){t.color=e.toJSON().slice(0,3);const i=iF(e.a);i!==0&&(t.transparency=i)}const pg={type:rt,json:{type:[Dr],default:null,read:{source:["color","transparency"],reader:cEe},write:{target:{color:{type:[Dr]},transparency:{type:Dr}},writer:uEe}}},Kp={type:Number,cast:sr,json:{write:!0}};let c_=class extends _e{constructor(e){super(e),this.color=new rt([0,0,0,1]),this.extensionLength=0,this.size=Sd(1)}clone(){}cloneProperties(){return{color:re(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],c_.prototype,"type",void 0),u([d(pg)],c_.prototype,"color",void 0),u([d(ge(L({},Kp),{json:{write:{overridePolicy:e=>({enabled:!!e})}}}))],c_.prototype,"extensionLength",void 0),u([d(Kp)],c_.prototype,"size",void 0),c_=u([P("esri.symbols.edges.Edges3D")],c_);const lj=c_;var TB;let zI=TB=class extends lj{constructor(e){super(e),this.type="sketch"}clone(){return new TB(this.cloneProperties())}};u([vt({sketch:"sketch"},{readOnly:!0})],zI.prototype,"type",void 0),zI=TB=u([P("esri.symbols.edges.SketchEdges3D")],zI);const hEe=zI;var SB;let kI=SB=class extends lj{constructor(e){super(e),this.type="solid"}clone(){return new SB(this.cloneProperties())}};u([vt({solid:"solid"},{readOnly:!0})],kI.prototype,"type",void 0),kI=SB=u([P("esri.symbols.support.SolidEdges3D")],kI);const wle=kI,xle={types:{key:"type",base:lj,typeMap:{solid:wle,sketch:hEe}},json:{write:!0}};var EB;let zc=EB=class extends _e{constructor(e){super(e),this.color=null}clone(){const e={color:_(this.color)?this.color.clone():null};return new EB(e)}};u([d(pg)],zc.prototype,"color",void 0),zc=EB=u([P("esri.symbols.support.Symbol3DMaterial")],zc);var AB;let hy=AB=class extends mf{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new AB({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([vt({Extrude:"extrude"},{readOnly:!0})],hy.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],hy.prototype,"size",void 0),u([d({type:zc,json:{write:!0}})],hy.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],hy.prototype,"castShadows",void 0),u([d(xle)],hy.prototype,"edges",void 0),hy=AB=u([P("esri.symbols.ExtrudeSymbol3DLayer")],hy);const Tle=hy;let bA=class extends Xl{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([vt({esriSLS:"simple-line"},{readOnly:!0})],bA.prototype,"type",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],bA.prototype,"width",void 0),bA=u([P("esri.symbols.LineSymbol")],bA);const dEe=bA,pEe=["begin","end","begin-end"],Sle=["arrow","circle","square","diamond","cross","x"];var CB;let op=CB=class extends _e{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){(r==null?void 0:r.origin)==="web-map"?t[i]="arrow":t[i]=e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new CB({color:re(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],op.prototype,"placement",void 0),u([vt({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],op.prototype,"type",void 0),u([d({type:Sle})],op.prototype,"style",void 0),u([Xe("style")],op.prototype,"writeStyle",null),u([d({type:rt,value:null,json:{write:{allowNull:!0}}})],op.prototype,"color",null),u([Ne("color")],op.prototype,"readColor",null),u([Xe("color")],op.prototype,"writeColor",null),op=CB=u([P("esri.symbols.LineSymbolMarker")],op);const fEe=op;var RB;const G5=new yi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let qf=RB=class extends dEe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),i!=null&&(o.width=sr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=sr(n)),o}clone(){var e;return new RB({color:re(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([vt({esriSLS:"simple-line"},{readOnly:!0})],qf.prototype,"type",void 0),u([d({type:G5.apiValues,json:{read:G5.read,write:G5.write}})],qf.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],qf.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],qf.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":fEe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],qf.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],qf.prototype,"miterLimit",void 0),qf=RB=u([P("esri.symbols.SimpleLineSymbol")],qf);const Nd=qf;let wA=class extends Xl{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Nd}},json:{default:null,write:!0}})],wA.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],wA.prototype,"type",void 0),wA=u([P("esri.symbols.FillSymbol")],wA);const Ele=wA;let BI=class extends _e{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],BI.prototype,"type",void 0),BI=u([P("esri.symbols.patterns.LinePattern3D")],BI);const Ale=BI,mEe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var OB;const gEe=Uo()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let xA=OB=class extends Ale{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new OB(e)}};u([d({type:["style"]})],xA.prototype,"type",void 0),u([vt(gEe),d({type:mEe})],xA.prototype,"style",void 0),xA=OB=u([P("esri.symbols.patterns.LineStylePattern3D")],xA);const rF=xA;let VI=class extends _e{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],VI.prototype,"type",void 0),VI=u([P("esri.symbols.patterns.Pattern3D")],VI);const Cle=VI,yEe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var MB;let TA=MB=class extends Cle{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new MB(e)}};u([d({type:["style"]})],TA.prototype,"type",void 0),u([d({type:yEe,json:{read:!0,write:!0}})],TA.prototype,"style",void 0),TA=MB=u([P("esri.symbols.patterns.StylePattern3D")],TA);const Rle=TA,vEe={types:{key:"type",base:Cle,typeMap:{style:Rle}},json:{write:!0}},Ole={types:{key:"type",base:Ale,typeMap:{style:rF}},json:{write:!0}},CC=new rt("white");new rt("black");const _Ee=new rt([255,255,255,0]);function bEe(e){return e.r===0&&e.g===0&&e.b===0}var PB;let RC=PB=class extends zc{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:_(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new PB(e)}};u([vt({multiply:"multiply",replace:"replace",tint:"tint"})],RC.prototype,"colorMixMode",void 0),RC=PB=u([P("esri.symbols.support.Symbol3DFillMaterial")],RC);function Gt(e=AEe){return[e[0],e[1],e[2],e[3]]}function Mpt(e){return[e[0],e[1],e[2],e[3]]}function ig(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function wEe(e,t,i,r,s=Gt()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Mle(e,t=Gt()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function sF(e,t){return new ni({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function cj(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function S0(e,t,i){if(C(t))ig(i,e);else if("length"in t)$B(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function j5(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<r;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function IB(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function Lp(e){return C(e)||e[0]>=e[2]?0:e[2]-e[0]}function F0(e){return e[1]>=e[3]?0:e[3]-e[1]}function Ppt(e){return Lp(e)*F0(e)}function uj(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Ple(e,t){return hj(e,t[0],t[1])}function xEe(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function Ipt(e,t,i){const r=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=i,p=(b,w)=>(h-l)*b+(a-c)*w+(c*l-a*h)<0,f=p(r,o),g=p(n,o),y=p(n,s),v=p(r,s);return!(f===g&&g===y&&y===v&&v===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function $pt(e,t){return hj(e,t.x,t.y)}function hj(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function TEe(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function nF(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function SY(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function GI(e,t,i){if(C(t))return ig(i,e);const r=t[0],s=t[1],n=t[2],o=t[3];return i[0]=He(e[0],r,n),i[1]=He(e[1],s,o),i[2]=He(e[2],r,n),i[3]=He(e[3],s,o),i}function SEe(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-Lp(e)/2,0),n=Math.max(Math.abs(t[1]-r)-F0(e)/2,0);return Math.sqrt(s*s+n*n)}function zD(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function nh(e){return e?ig(e,DB):Gt(DB)}function $B(e){return e!=null&&e.length===4}function EEe(e){return!(Lp(e)!==0&&isFinite(e[0])||F0(e)!==0&&isFinite(e[1]))}function I1(e,t){return $B(e)&&$B(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const Dpt=[-1/0,-1/0,1/0,1/0],DB=[1/0,1/0,-1/0,-1/0],AEe=[0,0,0,0];function Rs(e=Lle){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function ib(e,t,i,r,s,n,o=Rs()){return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function fS(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function CEe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function ef(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Fc(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<r;h++)s=Math.min(s,t[i+3*h]),n=Math.min(n,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),l=Math.max(l,t[i+3*h+1]),c=Math.max(c,t[i+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function H5(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function REe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function p2(e){return e[0]>=e[3]?0:e[3]-e[0]}function f2(e){return e[1]>=e[4]?0:e[4]-e[1]}function Vb(e){return e[2]>=e[5]?0:e[5]-e[2]}function OEe(e){const t=p2(e),i=Vb(e),r=f2(e);return Math.sqrt(t*t+i*i+r*r)}function ud(e,t=[0,0,0]){return t[0]=e[0]+p2(e)/2,t[1]=e[1]+f2(e)/2,t[2]=e[2]+Vb(e)/2,t}function zM(e,t=[0,0,0]){return t[0]=p2(e),t[1]=f2(e),t[2]=Vb(e),t}function MEe(e){return Math.max(p2(e),Vb(e),f2(e))}function dj(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function Lpt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function PEe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function hd(e,t){return!!C(t)||PEe(e,t)}function Ile(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function $le(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function Dle(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function oF(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function ir(e){return e?oF(e,AY):Rs(AY)}function pj(e,t){return t||(t=Gt()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function Npt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function EY(e){return e.length===6}function aF(e){return p2(e)===0&&f2(e)===0&&Vb(e)===0}function Fpt(e,t,i){if(C(e)||C(t))return e===t;if(!EY(e)||!EY(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function IEe(e,t,i,r,s,n){return ib(e,t,i,r,s,n,$Ee)}const Upt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],AY=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Lle=[0,0,0,0,0,0],$Ee=Rs();function q5(e,{isPrimitive:t,width:i,depth:r,height:s}){const n=t?10:1;if(i==null&&s==null&&r==null)return[n*e[0],n*e[1],n*e[2]];const o=Le(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const DEe=ib(-.5,-.5,-.5,.5,.5,.5),LEe=ib(-.5,-.5,0,.5,.5,1),NEe=ib(-.5,-.5,0,.5,.5,.5);function FEe(e){switch(e){case"sphere":case"cube":case"diamond":return DEe;case"cylinder":case"cone":case"inverted-cone":return LEe;case"tetrahedron":return NEe;default:return}}const fj=["butt","square","round"],UEe=[...fj,"none"],Nle=["miter","bevel","round"];var LB;let u_=LB=class extends _e{constructor(e){super(e),this.color=new rt([0,0,0,1]),this.size=Sd(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size,pattern:_(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new LB(e)}};u([d(pg)],u_.prototype,"color",void 0),u([d(Kp)],u_.prototype,"size",void 0),u([d(Ole)],u_.prototype,"pattern",void 0),u([d({type:fj,json:{default:"butt",write:{overridePolicy(){return{enabled:_(this.pattern)}}}}})],u_.prototype,"patternCap",void 0),u_=LB=u([P("esri.symbols.support.Symbol3DOutline")],u_);var jI;let Wf=jI=class extends mf{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:_(this.edges)?this.edges.clone():null,enabled:this.enabled,material:_(this.material)?this.material.clone():null,pattern:_(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:_(this.outline)?this.outline.clone():null};return new jI(e)}static fromSimpleFillSymbol(e){var t,i,r,s,n,o;const a=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new rF({style:e.outline.style}):null,l={size:(t=(i=e.outline)==null?void 0:i.width)!=null?t:0,color:((r=(s=e.outline)==null?void 0:s.color)!=null?r:CC).clone(),pattern:a};return a&&(n=e.outline)!=null&&n.cap&&(l.patternCap=e.outline.cap),new jI({material:new RC({color:((o=e.color)!=null?o:_Ee).clone()}),pattern:e.style&&e.style!=="solid"?new Rle({style:e.style}):null,outline:l})}};u([vt({Fill:"fill"},{readOnly:!0})],Wf.prototype,"type",void 0),u([d({type:RC,json:{write:!0}})],Wf.prototype,"material",void 0),u([d(vEe)],Wf.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Wf.prototype,"castShadows",void 0),u([d({type:u_,json:{write:!0}})],Wf.prototype,"outline",void 0),u([d(xle)],Wf.prototype,"edges",void 0),Wf=jI=u([P("esri.symbols.FillSymbol3DLayer")],Wf);const mS=Wf,zEe=["none","underline","line-through"],kEe=["normal","italic","oblique"],BEe=["normal","lighter","bold","bolder"],Fle={type:Number,cast:e=>{const t=zu(e);return t===0?1:He(t,.1,4)},nonNullable:!0},VEe=["left","right","center"],GEe=["baseline","top","middle","bottom"],Ule={type:VEe,nonNullable:!0},zle={type:GEe,nonNullable:!0};var NB;let Xf=NB=class extends _e{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return sr(e)}clone(){return new NB({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:zEe,json:{default:"none",write:!0}})],Xf.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Xf.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],Xf.prototype,"size",void 0),u([Bt("size")],Xf.prototype,"castSize",null),u([d({type:kEe,json:{default:"normal",write:!0}})],Xf.prototype,"style",void 0),u([d({type:BEe,json:{default:"normal",write:!0}})],Xf.prototype,"weight",void 0),Xf=NB=u([P("esri.symbols.Font")],Xf);const lF=Xf,jEe=pe.getLogger("esri.core.urlUtils"),m2=rr.request,CY="esri/config: esriConfig.request.proxyUrl is not set.",kle=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Ble=/^\s*http:/i,HEe=/^\s*https:/i,qEe=/^\s*file:/i,WEe=/:\d+$/,XEe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,YEe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),ZEe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class RT{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(YEe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(ZEe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}}const kM={},QEe=new RT(rr.applicationUrl);let ha=QEe;const JEe=KEe();let mj=JEe;const Vle=()=>ha,zpt=()=>mj;function KEe(){const e=ha.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${ha.scheme}://${ha.host}${ha.port!=null?`:${ha.port}`:""}`}${t}`}function ya(e){const t={path:null,query:null},i=new RT(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=Gle(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function Gle(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function RY(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function rb(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>RY(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):RY(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function eAe(e=!1){let t,i=m2.proxyUrl;if(typeof e=="string"){t=oAe(e);const r=cF(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw jEe.warn(CY),new Y("urlutils:proxy-not-set",CY);return t&&FB()&&(i=_j(i)),ya(i)}function kpt(e){const t=cF(e);let i,r;if(t){const s=gj(t.proxyUrl);i=s.path,r=s.query?Gle(s.query):null}if(i){const s=ya(e);e=i+"?"+s.path;const n=rb(L(L({},r),s.query));n&&(e=`${e}?${n}`)}return e}const Q2={path:"",query:""};function gj(e){const t=e.indexOf("?");return t!==-1?(Q2.path=e.slice(0,t),Q2.query=e.slice(t+1)):(Q2.path=e,Q2.query=null),Q2}function jle(e){return e=(e=BD(e=hAe(e=gj(e).path),!0)).toLowerCase()}function tAe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:jle(e.urlPrefix)},i=m2.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,t),s}function cF(e){const t=m2.proxyRules,i=jle(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function Hle(e,t){return e=OY(e),t=OY(t),BD(e)===BD(t)}function OY(e){const t=(e=yd(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function qle(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=m2.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function kD(e,t,i=!1){const r=zB(e),s=zB(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function yj(e){if(typeof e=="string"){if(!kc(e))return!0;e=zB(e)}if(kD(e,ha))return!0;const t=m2.trustedServers||[];for(let i=0;i<t.length;i++){const r=iAe(t[i]);for(let s=0;s<r.length;s++)if(kD(e,r[s]))return!0}return!1}function iAe(e){return kM[e]||(vj(e)||tf(e)?kM[e]=[new RT(Qu(e))]:kM[e]=[new RT(`http://${e}`),new RT(`https://${e}`)]),kM[e]}function Qu(e,t=mj,i){return tf(e)?i&&i.preserveProtocolRelative?e:ha.scheme==="http"&&ha.authority===g2(e).slice(2)?`http:${e}`:`https:${e}`:vj(e)?e:sb(e[0]==="/"?uAe(t):t,e)}function uF(e,t=mj,i){if(!kc(e))return e;const r=yd(e),s=r.toLowerCase(),n=yd(t).toLowerCase().replace(/\/+$/,""),o=i?yd(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,g)=>(g=p.indexOf(f,g))===-1?p.length:g;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function yd(e){return e=fAe(e=pAe(e=dAe(e=Qu(e=e.trim()))))}function sb(...e){const t=e.filter(_);if(!t||!t.length)return;const i=[];if(kc(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),lAe(t[0])&&(i[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function g2(e,t=!1){if(gS(e)||gf(e))return null;let i=e.indexOf("://");if(i===-1&&tf(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=BD(e,!0)),e}function kc(e){return tf(e)||vj(e)}function gS(e){return e!=null&&e.slice(0,5)==="blob:"}function gf(e){return e.slice(0,5)==="data:"}function Wle(e){const t=hF(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function Bpt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const rAe=/^data:(.*?)(;base64)?,(.*)$/;function hF(e){const t=e.match(rAe);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function Xle(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function Vpt(e,t){sAe(e,t)||nAe(e,t)}function sAe(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function nAe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function tf(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function vj(e){return kle.test(e)}function oAe(e){return HEe.test(e)||ha.scheme==="https"&&tf(e)}function aAe(e){return Ble.test(e)||ha.scheme==="http"&&tf(e)}function lAe(e){return qEe.test(e)}function _j(e){return tf(e)?`https:${e}`:e.replace(Ble,"https:")}function cAe(){return ha.scheme==="http"}function FB(){return ha.scheme==="https"}function BD(e,t=!1){return tf(e)?e.slice(2):(e=e.replace(kle,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function uAe(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function Yle(e){let t=0;if(kc(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function Gpt(e,t){if(!e)return"";const i=ya(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(t==null||!t.length)return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function hAe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function Zle(e){return e.replace(/\/+$/,"")}function dAe(e){if(/^https?:\/\//i.test(e)){const t=gj(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function pAe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function fAe(e){const t=m2.httpsDomains;if(!aAe(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),WEe.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return cAe()&&r===ha.authority&&!XEe.test(e)||(FB()&&r===ha.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||FB()&&!cF(e))&&(e=_j(e)),e}function UB(e,t,i){if(!(t&&i&&e&&kc(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function zB(e){return typeof e=="string"?new RT(Qu(e)):(e.scheme||(e.scheme=ha.scheme),e)}function bj(e){return gAe.test(e)}function Qle(e,t){const i=ya(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function Jle(e,t,i){const r=ya(e),s=r.query||{};return s[t]=String(i),`${r.path}?${rb(s)}`}function MY(e,t){const i=ya(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=rb(r);return s?`${i.path}?${s}`:i.path}function jpt(e){if(C(e))return null;const t=e.match(mAe);return t?t[1]:null}const mAe=/.*?\.([^\/]*)$/,gAe=/(^data:image\/svg|\.svg$)/i;function y2(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=Qu(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=uF(e,t.portalItem.itemUrl);vAe.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return kB(e,t&&t.portal)}function nb(e,t,i=bR.YES){if(!e)return e;!kc(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=Qu(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=kB(s,t.portal);r=uF(kB(r,t.portal),n,n),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=bAe(r,t&&t.portal),kc(r)&&(r=yd(r)),t!=null&&t.resources&&t!=null&&t.portalItem&&!kc(r)&&!gf(r)&&i===bR.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function wj(e,t,i){return y2(e,i)}function U0(e,t,i,r){const s=nb(e,r);s!==void 0&&(t[i]=s)}const yAe=/\/items\/([^\/]+)\/resources\//,vAe=/^\.\/resources\//;function _Ae(e){const t=_(e)?e.match(yAe):null;return _(t)?t[1]:null}function bAe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?UB(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function kB(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=Vle();return kD(r,`${r.scheme}://${i}`)?UB(e,t.portalHostname,i):UB(e,i,t.portalHostname)}var bR;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(bR||(bR={}));const Hpt=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:y2,toJSON:nb,read:wj,write:U0,itemIdFromResourceUrl:_Ae,get MarkKeep(){return bR}},Symbol.toStringTag,{value:"Module"}));var BB;const wAe=Uo()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let h_=BB=class extends _e{constructor(e){super(e)}readHref(e,t,i){return e?y2(e,i):t.dataURI}writeHref(e,t,i,r){e&&(gf(e)?t.dataURI=e:(t.href=nb(e,r),kc(t.href)&&(t.href=yd(t.href))))}clone(){return new BB({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],h_.prototype,"href",void 0),u([Ne("href")],h_.prototype,"readHref",null),u([Xe("href",{href:{type:String},dataURI:{type:String}})],h_.prototype,"writeHref",null),u([vt(wAe)],h_.prototype,"primitive",void 0),h_=BB=u([P("esri.symbols.support.IconSymbol3DLayerResource")],h_);const xAe="circle";var VB;let eT=VB=class extends be{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new VB({x:this.x,y:this.y})}};u([d({type:Number})],eT.prototype,"x",void 0),u([d({type:Number})],eT.prototype,"y",void 0),eT=VB=u([P("esri.symbols.support.Symbol3DAnchorPosition2D")],eT);var GB;let SA=GB=class extends _e{constructor(e){super(e),this.color=new rt([0,0,0,1]),this.size=Sd(1)}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size};return new GB(e)}};u([d(pg)],SA.prototype,"color",void 0),u([d(Kp)],SA.prototype,"size",void 0),SA=GB=u([P("esri.symbols.support.Symbol3DIconOutline")],SA);var fx;const TAe=pe.getLogger("esri.symbols.IconSymbol3DLayer");let ap=fx=class extends mf{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new fx({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,outline:_(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||CC,i=PY(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||CC).clone()}:null;return new fx({size:e.size,resource:{primitive:EAe(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||bEe(e.color)?CC:e.color,i=PY(e);return new fx({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new fx({resource:{href:Xle({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function PY(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=IY(e.xoffset),s=IY(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function IY(e){return isFinite(e)?e:0}u([d({type:zc,json:{write:!0}})],ap.prototype,"material",void 0),u([d({type:h_,json:{write:!0}})],ap.prototype,"resource",void 0),u([vt({Icon:"icon"},{readOnly:!0})],ap.prototype,"type",void 0),u([d(Kp)],ap.prototype,"size",void 0),u([vt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],ap.prototype,"anchor",void 0),u([d({type:eT,json:{type:[Number],read:{reader:e=>new eT({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ap.prototype,"anchorPosition",void 0),u([d({type:SA,json:{write:!0}})],ap.prototype,"outline",void 0),ap=fx=u([P("esri.symbols.IconSymbol3DLayer")],ap);const SAe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function EAe(e){return SAe[e]||(TAe.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const Ic=ap;function ob(e,t,i=St){return t||(t=new i),t===e||(t.removeAll(),AAe(e)?t.addMany(e):e&&t.add(e)),t}function Kle(e){return e}function AAe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const ece="4.24",CAe={async request(e,t){var i;const{default:r}=await Promise.resolve().then(function(){return nce}),s=e.options,n=s.responseType;s.signal=t==null?void 0:t.signal,s.responseType=n==="native"||n==="native-request-init"?"native-request-init":["blob","json","text"].includes(n)&&(i=qle(e.url))!=null&&i.after?n:"array-buffer";const o=await r(e.url,s),a={data:o.data,ssl:o.ssl};switch(o.requestOptions.responseType){case"native-request-init":return delete a.data.signal,a;case"blob":a.data=await a.data.arrayBuffer();break;case"json":a.data=new TextEncoder().encode(JSON.stringify(a.data)).buffer;break;case"text":a.data=new TextEncoder().encode(a.data).buffer}return{result:a,transferList:[a.data]}}};let Vs;function qpt(e){Vs=e}function Wpt(e){const t=Vs&&Vs.findCredential(e);return t&&t.token?Jle(e,"token",t.token):e}ue("host-webworker")||(ue("edge")||ue("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const RAe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function tce(e){const t=g2(e,!0);return t&&t.endsWith(".arcgis.com")&&!RAe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function ice(e,t,i=!1,r){return new Promise((s,n)=>{if(Ts(r))return void n($Y());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n($Y())};const c=()=>{ue("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,_(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(t)};_(r)&&r.addEventListener("abort",l),ue("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function $Y(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}async function Pi(e,t){var i;const r=gf(e),s=gS(e);s||r||(e=yd(e));const n={url:e,requestOptions:L({},t)};let o=qle(e);if(o){const h=await NAe(o,n);if(h!=null)return{data:h,getHeader:xj,requestOptions:n.requestOptions,url:n.url};o.after||o.error||(o=null)}if(e=n.url,(t=n.requestOptions).responseType==="image"){if(ue("host-webworker")||ue("host-node"))throw dd("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n)}else if(r)throw dd("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),n);if(t.method==="head"){if(t.body)throw dd("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(r||s)throw dd("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await $Ae(),VD)return VD.execute(e,t);const a=new AbortController;Lo(t,()=>a.abort());const l={controller:a,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:o,params:n,redoRequest:!1,useIdentity:bm.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},c=await UAe(l);return(i=o)==null||i.after==null||i.after(c),c}let VD;const bm=rr.request,rce="FormData"in globalThis,OAe=[499,498,403,401],MAe=["COM_0056","COM_0057","SB_0008"],PAe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],xj=()=>null,jB=Symbol();function IAe(e){const t=g2(e);t&&!Pi._corsServers.includes(t)&&Pi._corsServers.push(t)}function DY(e){const t=g2(e);return!t||t.endsWith(".arcgis.com")||Pi._corsServers.includes(t)||yj(t)}function dd(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:xj,ssl:!1};if(t instanceof Y)return t.details?(t.details=re(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=jB in t?t[jB]:t}return Tr(t)?gi():new Y(e,s,n)}async function $Ae(){ue("host-webworker")?VD||(VD=await import("./request.fbc2dfb3.js")):Pi._abortableFetch||(Pi._abortableFetch=globalThis.fetch.bind(globalThis))}async function HB(){Vs||await import("./IdentityManager.59ff6392.js")}async function DAe(e){const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,o=null,a=null;if(rce&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(o=s,n=new FormData(o))),typeof s=="string"&&(a=s),e.fetchOptions={cache:i.cacheBust&&!Pi._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",redirect:"follow",signal:r},(n||a)&&(e.fetchOptions.body=n||a),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||i.query&&i.query.token||n&&n.get&&n.get("token")||o&&o.elements.token),!e.hasToken&&rr.apiKey&&tce(t)&&(i.query||(i.query={}),i.query.token=rr.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!sce(t)&&!Ts(r)){let l;i.authMode==="immediate"?(await HB(),l=await Vs.getCredential(t,{signal:r}),e.credential=l):i.authMode==="no-prompt"?(await HB(),l=await Vs.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=l):Vs&&(l=Vs.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function sce(e){return PAe.some(t=>t.test(e))}async function LAe(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,s=gS(t)||gf(t),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:bm.timeout;let a=!1;if(!s){e.useSSL&&(t=_j(t)),i.cacheBust&&r.cache==="default"&&(t=Jle(t,"request.preventCache",Date.now()));let f=L({},i.query);e.credentialToken&&(f.token=e.credentialToken);let g=rb(f);ue("esri-url-encodes-apostrophe")&&(g=g.replace(/'/g,"%27"));const y=t.length+1+g.length;let v;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||y>bm.maxUrlLength;const b=i.useProxy||!!cF(t);if(b){const w=eAe(t);v=w.path,!a&&v.length+1+y>bm.maxUrlLength&&(a=!0),w.query&&(f=L(L({},w.query),f))}if(r.method==="HEAD"&&(a||b)){if(a)throw y>bm.maxUrlLength?dd("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):dd("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(b)throw dd("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=MY(t,f):(r.body=rb(f),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=MY(t,f),b&&(e.useProxy=!0,t=`${v}?${t}`),f.token&&rce&&r.body instanceof FormData){const w=r.body;w.set?w.set("token",f.token):w.append("token",f.token)}if(i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!kD(t,Vle())){if(yj(t))e.withCredentials=!0;else if(Vs){const w=Vs.findServerInfo(t);w&&w.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include")}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||FAe(i.headers)||!s&&!e.useProxy&&bm.proxyUrl&&!DY(t)){if(l=await Pi._abortableFetch(t,r),e.useProxy||IAe(t),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=LY(c,"application/xml");break;case"document":c=LY(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const g=await new Response(c).json();g.error&&(c=g)}catch{}}n==="image"&&c instanceof Blob&&(c=await NY(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await NY(t,e)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):gi("Request canceled");if(!(!l&&f instanceof TypeError&&bm.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||DY(t))throw f;e.redoRequest=!0,tAe({proxyUrl:bm.proxyUrl,urlPrefix:g2(t)})}finally{h&&clearTimeout(h)}return[l,c]}async function NAe(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers=L(L({},t.requestOptions.headers),e.headers)),e.query&&(t.requestOptions.query=L(L({},t.requestOptions.query),e.query)),e.before){let i,r;try{r=await e.before(t)}catch(s){i=dd("request:interceptor",s,t)}if((r instanceof Error||r instanceof Y)&&(i=dd("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function FAe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function LY(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function UAe(e){var t,i;let r,s;await DAe(e);try{do[r,s]=await LAe(e);while(!await zAe(e,r,s))}catch(a){const l=dd("request:server",a,e.params,r);throw l.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(l),l}const n=e.params.url;if(/\/sharing\/rest\/(accounts|portals)\/self/i.test(n)&&!e.hasToken&&!e.credentialToken&&(t=s)!=null&&(i=t.user)!=null&&i.username&&!yj(n)){const a=g2(n,!0);a&&bm.trustedServers.push(a)}const o=e.credential;if(o&&Vs){const a=Vs.findServerInfo(o.server);let l=a&&a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Vs.findCredential(l,o.userId);c&&Vs._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:s,getHeader:r?a=>r.headers.get(a):xj,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function zAe(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n,o,a;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[jB]=i,s;i!=null&&i.error&&(s=i.error),s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a&&a.toUpperCase());const l=r.authMode;if(n===403&&(o===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&OAe.includes(n)&&!sce(e.params.url)&&(n!==403||!MAe.includes(a)&&(o==null||o===2&&e.credentialToken))){await HB();try{const c=await Vs.getCredential(e.params.url,{error:dd("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=null,e.credentialToken=null,!1;s=c}}if(s)throw s;return!0}function NY(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.src=e,ice(s,e,i,r)}Pi._abortableFetch=null,Pi._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var nce=Object.freeze(Object.defineProperty({__proto__:null,default:Pi},Symbol.toStringTag,{value:"Module"})),Fy;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(Fy||(Fy={}));class kAe{constructor(t){this.instance=t,this._resolver=$0(),this._status=Fy.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Fy.RESOLVED,this._cleanUp()},()=>{this._status=Fy.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===Fy.RESOLVED}isRejected(){return this._status===Fy.REJECTED}isFulfilled(){return this._status!==Fy.PENDING}abort(){this._resolver.reject(gi())}when(t,i){return this._resolver.promise.then(t,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=$0(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||Tr(s)||this._resolver.reject(s)}),t.resolve()}}const v2=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new kAe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=u([P("esri.core.Promise")],t),t};let GD=class extends v2(be){};GD=u([P("esri.core.Promise")],GD);const BAe="not-loaded",VAe="loading",GAe="failed",FY="loaded",oce=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=HN(n,l);this.destroyed&&l(new Y("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===BAe){this._set("loadStatus",VAe);const a=this._loadController=new AbortController;s({signal:a.signal}),Lo(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",FY),this._loadController=null},r=>{this._set("loadStatus",GAe),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===FY}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new Y("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([d({readOnly:!0})],t.prototype,"loaded",null),u([d({readOnly:!0})],t.prototype,"loadError",void 0),u([d({clonable:!1})],t.prototype,"loadStatus",void 0),u([d({type:[Hc],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([P("esri.core.Loadable")],t),t};let EA=class extends oce(GD){};EA=u([P("esri.core.Loadable")],EA),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=oce,e.isLoadable=t}(EA||(EA={}));const rf=EA;var qB;const jAe=new yi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let bu=qB=class extends be{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new qB({categories:this.categories?re(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o)),this.extent){const o=Ub(this.extent,Ke.WGS84);_(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>jAe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:L(L({},t),n)}}};u([d()],bu.prototype,"categories",void 0),u([d()],bu.prototype,"disableExtraQuery",void 0),u([d({type:ni})],bu.prototype,"extent",void 0),u([d()],bu.prototype,"filter",void 0),u([d()],bu.prototype,"num",void 0),u([d()],bu.prototype,"query",void 0),u([d()],bu.prototype,"sortField",void 0),u([d()],bu.prototype,"sortOrder",null),u([d()],bu.prototype,"start",void 0),bu=qB=u([P("esri.portal.PortalQueryParams")],bu);const Pm=bu;let d_=class extends be{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],d_.prototype,"nextQueryParams",void 0),u([d()],d_.prototype,"queryParams",void 0),u([d()],d_.prototype,"results",void 0),u([d()],d_.prototype,"total",void 0),d_=u([P("esri.portal.PortalQueryResult")],d_);const HAe=d_;let Yf=class extends _e{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new Y("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],Yf.prototype,"created",void 0),u([d()],Yf.prototype,"id",void 0),u([d()],Yf.prototype,"portal",void 0),u([d()],Yf.prototype,"title",void 0),u([d({readOnly:!0})],Yf.prototype,"url",null),u([d()],Yf.prototype,"username",void 0),Yf=u([P("esri.portal.PortalFolder")],Yf);const qAe=Yf;let xn=class extends _e{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new Y("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=As(Pm,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new Pm,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new Pm,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(i=>{const r=i.contentCategorySetsGroupQuery;if(r){const s=new Pm;return s.disableExtraQuery=!0,s.num=1,s.query=r,this.portal.queryGroups(s,t)}throw new Y("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const r=i.results[0],s=new Pm;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new Y("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(r=>{const s=r&&r.categorySchema;return s&&s.length?s:[]}):[])}};u([d()],xn.prototype,"access",void 0),u([d({type:Date})],xn.prototype,"created",void 0),u([d()],xn.prototype,"description",void 0),u([d()],xn.prototype,"id",void 0),u([d()],xn.prototype,"isInvitationOnly",void 0),u([d({type:Date})],xn.prototype,"modified",void 0),u([d()],xn.prototype,"owner",void 0),u([d()],xn.prototype,"portal",void 0),u([d()],xn.prototype,"snippet",void 0),u([d()],xn.prototype,"sortField",void 0),u([d()],xn.prototype,"sortOrder",void 0),u([d()],xn.prototype,"tags",void 0),u([d()],xn.prototype,"thumbnail",void 0),u([d({readOnly:!0})],xn.prototype,"thumbnailUrl",null),u([d()],xn.prototype,"title",void 0),u([d({readOnly:!0})],xn.prototype,"url",null),xn=u([P("esri.portal.PortalGroup")],xn);const WB=xn;var WAe=Object.freeze(Object.defineProperty({__proto__:null,default:WB},Symbol.toStringTag,{value:"Module"})),XB;let Fr=XB=class extends _e{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal._request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let i;return i=t&&t.folders?t.folders.map(r=>{const s=qAe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(i=>{const r=WB.fromJSON(i);return r.portal=this.portal,r}):[],t})}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),Promise.resolve().then(function(){return eme}).then(({default:r})=>{t=r;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:s})}).then(r=>{let s;return r&&r.items?(s=r.items.map(n=>{const o=t.fromJSON(n);return o.portal=this.portal,o}),Promise.all(s.map(n=>n.load())).catch(n=>n).then(()=>({items:s,nextStart:r.nextStart,total:r.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new WB({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new Y("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new Y("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new XB;return t.sourceJSON=e,t.read(e),t}};u([d()],Fr.prototype,"access",void 0),u([d({type:Date})],Fr.prototype,"created",void 0),u([d()],Fr.prototype,"culture",void 0),u([d()],Fr.prototype,"description",void 0),u([d()],Fr.prototype,"email",void 0),u([d()],Fr.prototype,"favGroupId",void 0),u([d()],Fr.prototype,"fullName",void 0),u([d({type:Date})],Fr.prototype,"modified",void 0),u([d()],Fr.prototype,"orgId",void 0),u([d()],Fr.prototype,"portal",void 0),u([d()],Fr.prototype,"preferredView",void 0),u([d()],Fr.prototype,"privileges",void 0),u([d()],Fr.prototype,"region",void 0),u([d()],Fr.prototype,"role",void 0),u([d()],Fr.prototype,"roleId",void 0),u([d()],Fr.prototype,"sourceJSON",void 0),u([d()],Fr.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Fr.prototype,"thumbnailUrl",null),u([d()],Fr.prototype,"units",void 0),u([d({readOnly:!0})],Fr.prototype,"userContentUrl",null),u([d({readOnly:!0})],Fr.prototype,"url",null),u([d()],Fr.prototype,"username",void 0),u([d()],Fr.prototype,"userType",void 0),Fr=XB=u([P("esri.portal.PortalUser")],Fr);const Tj=Fr;var XAe=Object.freeze(Object.defineProperty({__proto__:null,default:Tj},Symbol.toStringTag,{value:"Module"})),lc;let W5;const UY={PortalGroup:()=>Promise.resolve().then(function(){return WAe}),PortalItem:()=>Promise.resolve().then(function(){return eme}),PortalUser:()=>Promise.resolve().then(function(){return XAe})};let Be=lc=class extends LO(rf){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=rr.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)rr.request.trustedServers.includes(t)||rr.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=Tj.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(function(){return Yke}).then(({default:i})=>{qt(e),W5=i}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(i=>{if(Vs){const r=Vs;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==lc.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await Promise.resolve().then(function(){return Udt})).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}fetchBasemaps(e,t){const i=new Pm;return i.query=e||(rr.apiKey&&tce(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,t)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new W5({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):Ts(e)?Promise.reject(gi()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new Pm;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return Ts(e)?Promise.reject(gi()):Promise.resolve([])}fetchRegions(e){var t;const i=((t=this.user)==null?void 0:t.culture)||this.culture||Uc();return this._request(this.restUrl+"/portals/regions",ge(L({},e),{query:{culture:i}}))}fetchSettings(e){var t;const i=((t=this.user)==null?void 0:t.culture)||this.culture||Uc();return this._request(this.restUrl+"/portals/self/settings",ge(L({},e),{query:{culture:i}}))}static getDefault(){return lc._default&&!lc._default.destroyed||(lc._default=new lc),lc._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new Y("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new lc({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new Y("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new Y("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s=L({authMode:e,query:{culture:Uc().toLowerCase()}},i);return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=As(Pm,t),n=o=>this._request(this.restUrl+e,L(L({},s.toRequestOptions(this)),r)).then(a=>{const l=s.clone();return l.start=a.nextStart,new HAe({nextQueryParams:l,queryParams:s,total:a.total,results:lc._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(hf(l),a)));return i&&UY[i]?UY[i]().then(({default:o})=>(qt(r),n(o))):n()}_signIn(){if(this.authMode===lc.AUTH_MODE_ANONYMOUS)return Promise.reject(new Y("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Vs?Vs.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then(r=>{const s=lc._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=W5.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const i=L({f:"json"},t.query),{authMode:r=this.authMode===lc.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return Pi(this._normalizeSSL(e),c).then(h=>h.data)}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=_(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Be.AUTH_MODE_ANONYMOUS="anonymous",Be.AUTH_MODE_AUTO="auto",Be.AUTH_MODE_IMMEDIATE="immediate",u([d()],Be.prototype,"access",void 0),u([d()],Be.prototype,"allSSL",void 0),u([d()],Be.prototype,"authMode",void 0),u([d()],Be.prototype,"authorizedCrossOriginDomains",void 0),u([Ne("authorizedCrossOriginDomains")],Be.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],Be.prototype,"basemapGalleryGroupQuery",void 0),u([d()],Be.prototype,"bingKey",void 0),u([d()],Be.prototype,"canListApps",void 0),u([d()],Be.prototype,"canListData",void 0),u([d()],Be.prototype,"canListPreProvisionedItems",void 0),u([d()],Be.prototype,"canProvisionDirectPurchase",void 0),u([d()],Be.prototype,"canSearchPublic",void 0),u([d()],Be.prototype,"canShareBingPublic",void 0),u([d()],Be.prototype,"canSharePublic",void 0),u([d()],Be.prototype,"canSignInArcGIS",void 0),u([d()],Be.prototype,"canSignInIDP",void 0),u([d()],Be.prototype,"colorSetsGroupQuery",void 0),u([d()],Be.prototype,"commentsEnabled",void 0),u([d({type:Date})],Be.prototype,"created",void 0),u([d()],Be.prototype,"credential",void 0),u([d()],Be.prototype,"culture",void 0),u([d()],Be.prototype,"currentVersion",void 0),u([d()],Be.prototype,"customBaseUrl",void 0),u([d()],Be.prototype,"defaultBasemap",void 0),u([Ne("defaultBasemap")],Be.prototype,"readDefaultBasemap",null),u([d()],Be.prototype,"defaultDevBasemap",void 0),u([Ne("defaultDevBasemap")],Be.prototype,"readDefaultDevBasemap",null),u([d({type:ni})],Be.prototype,"defaultExtent",void 0),u([d()],Be.prototype,"defaultVectorBasemap",void 0),u([Ne("defaultVectorBasemap")],Be.prototype,"readDefaultVectorBasemap",null),u([d()],Be.prototype,"description",void 0),u([d()],Be.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],Be.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],Be.prototype,"extraQuery",null),u([d()],Be.prototype,"featuredGroups",void 0),u([d()],Be.prototype,"featuredItemsGroupQuery",void 0),u([d()],Be.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],Be.prototype,"livingAtlasGroupQuery",void 0),u([d()],Be.prototype,"hasCategorySchema",void 0),u([d()],Be.prototype,"helpBase",void 0),u([d()],Be.prototype,"helperServices",void 0),u([d()],Be.prototype,"helpMap",void 0),u([d()],Be.prototype,"homePageFeaturedContent",void 0),u([d()],Be.prototype,"homePageFeaturedContentCount",void 0),u([d()],Be.prototype,"httpPort",void 0),u([d()],Be.prototype,"httpsPort",void 0),u([d()],Be.prototype,"id",void 0),u([d()],Be.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],Be.prototype,"isOrganization",null),u([d()],Be.prototype,"isPortal",void 0),u([d()],Be.prototype,"isReadOnly",void 0),u([d()],Be.prototype,"layerTemplatesGroupQuery",void 0),u([d()],Be.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],Be.prototype,"modified",void 0),u([d()],Be.prototype,"name",void 0),u([d()],Be.prototype,"portalHostname",void 0),u([d()],Be.prototype,"portalMode",void 0),u([d()],Be.prototype,"portalProperties",void 0),u([d()],Be.prototype,"region",void 0),u([d({readOnly:!0})],Be.prototype,"restUrl",null),u([d()],Be.prototype,"rotatorPanels",void 0),u([d()],Be.prototype,"showHomePageDescription",void 0),u([d()],Be.prototype,"sourceJSON",void 0),u([d()],Be.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],Be.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],Be.prototype,"stylesGroupQuery3d",void 0),u([d()],Be.prototype,"supportsHostedServices",void 0),u([d()],Be.prototype,"symbolSetsGroupQuery",void 0),u([d()],Be.prototype,"templatesGroupQuery",void 0),u([d()],Be.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Be.prototype,"thumbnailUrl",null),u([d()],Be.prototype,"units",void 0),u([d()],Be.prototype,"url",void 0),u([d()],Be.prototype,"urlKey",void 0),u([Ne("urlKey")],Be.prototype,"readUrlKey",null),u([d()],Be.prototype,"user",void 0),u([Ne("user")],Be.prototype,"readUser",null),u([d()],Be.prototype,"useStandardizedQuery",void 0),u([d()],Be.prototype,"useVectorBasemaps",void 0),u([d()],Be.prototype,"vectorBasemapGalleryGroupQuery",void 0),Be=lc=u([P("esri.portal.Portal")],Be);const Hl=Be;let p_=class extends df(_e){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return _(e)&&e.placement===this.placement&&e.style===this.style&&(C(this.color)&&C(e.color)||_(this.color)&&_(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],p_.prototype,"type",void 0),u([d({type:pEe,json:{default:"begin-end",write:!0}})],p_.prototype,"placement",void 0),u([d({type:Sle,json:{default:"arrow",write:!0}})],p_.prototype,"style",void 0),u([d({type:rt,json:{type:[Dr],default:null,write:!0}})],p_.prototype,"color",void 0),p_=u([P("esri.symbols.LineStyleMarker3D")],p_);const YB=p_;var HI;let lp=HI=class extends mf{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Sd(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:_(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:_(this.pattern)?this.pattern.clone():null,marker:_(this.marker)?this.marker.clone():null};return new HI(e)}static fromSimpleLineSymbol(e){var t,i,r;const s={enabled:!0,size:(t=e.width)!=null?t:Sd(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new rF({style:e.style}):null,material:new zc({color:(e.color||CC).clone()}),marker:e.marker?new YB({placement:e.marker.placement,style:e.marker.style,color:(i=(r=e.marker.color)==null?void 0:r.clone())!=null?i:null}):null};return new HI(s)}};u([d({type:zc,json:{write:!0}})],lp.prototype,"material",void 0),u([vt({Line:"line"},{readOnly:!0})],lp.prototype,"type",void 0),u([d({type:Nle,json:{write:!0,default:"miter"}})],lp.prototype,"join",void 0),u([d({type:fj,json:{write:!0,default:"butt"}})],lp.prototype,"cap",void 0),u([d(Kp)],lp.prototype,"size",void 0),u([d(Ole)],lp.prototype,"pattern",void 0),u([d({types:{key:"type",base:YB,typeMap:{style:YB}},json:{write:!0}})],lp.prototype,"marker",void 0),lp=HI=u([P("esri.symbols.LineSymbol3DLayer")],lp);const _2=lp;var ZB;const YAe=Uo()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let AA=ZB=class extends _e{clone(){return new ZB({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:wj,write:U0}})],AA.prototype,"href",void 0),u([vt(YAe)],AA.prototype,"primitive",void 0),AA=ZB=u([P("esri.symbols.support.ObjectSymbol3DLayerResource")],AA);const ace="sphere";var QB;let K_=QB=class extends be{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new QB({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],K_.prototype,"x",void 0),u([d({type:Number})],K_.prototype,"y",void 0),u([d({type:Number})],K_.prototype,"z",void 0),K_=QB=u([P("esri.symbols.support.Symbol3DAnchorPosition3D")],K_);var JB;let Ho=JB=class extends mf{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new JB({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:zc,json:{write:!0}})],Ho.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ho.prototype,"castShadows",void 0),u([d({type:AA,json:{write:!0}})],Ho.prototype,"resource",void 0),u([vt({Object:"object"},{readOnly:!0})],Ho.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],Ho.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],Ho.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],Ho.prototype,"depth",void 0),u([vt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],Ho.prototype,"anchor",void 0),u([d({type:K_,json:{type:[Number],read:{reader:e=>new K_({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ho.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],Ho.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],Ho.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],Ho.prototype,"roll",void 0),u([d({readOnly:!0})],Ho.prototype,"isPrimitive",null),Ho=JB=u([P("esri.symbols.ObjectSymbol3DLayer")],Ho);const Sj=Ho;var KB;let Pa=KB=class extends mf{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new KB({enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:zc,json:{write:!0}})],Pa.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Pa.prototype,"castShadows",void 0),u([vt({Path:"path"},{readOnly:!0})],Pa.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],Pa.prototype,"profile",void 0),u([d({type:Nle,json:{write:!0,default:"miter"}})],Pa.prototype,"join",void 0),u([d({type:UEe,json:{write:!0,default:"butt"}})],Pa.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Pa.prototype,"width",void 0),u([Ne("width",["width","size","height"])],Pa.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],Pa.prototype,"height",void 0),u([Ne("height",["height","size","width"])],Pa.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Pa.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],Pa.prototype,"profileRotation",void 0),Pa=KB=u([P("esri.symbols.PathSymbol3DLayer")],Pa);const Ej=Pa;var eV;let tT=eV=class extends _e{constructor(){super(...arguments),this.color=new rt([0,0,0,1]),this.size=0}clone(){const e={color:re(this.color),size:this.size};return new eV(e)}};u([d(pg)],tT.prototype,"color",void 0),u([d(Kp)],tT.prototype,"size",void 0),tT=eV=u([P("esri.symbols.support.Symbol3DHalo")],tT);let OC=class extends df(_e){constructor(e){super(e),this.color=null}};u([d(pg)],OC.prototype,"color",void 0),OC=u([P("esri.symbols.support.Symbol3DTextBackground")],OC);var qI;let gl=qI=class extends mf{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){_(e)&&_(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s=ge(L({},r),{textSymbol3D:!0});t.font=e.write({},s),delete t.font.size}get size(){return _(this._userSize)?this._userSize:_(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,_(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new qI({enabled:this.enabled,font:this.font&&re(this.font),halo:this.halo&&re(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:_(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:re(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new qI({font:_(e.font)?e.font.clone():new lF,halo:ZAe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new zc({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new OC({color:e.backgroundColor.clone()}):null})}};function ZAe(e,t){return e&&t>0?new tT({color:re(e),size:t}):null}u([d({type:lF,json:{write:!0}})],gl.prototype,"font",null),u([Xe("font")],gl.prototype,"writeFont",null),u([d({type:tT,json:{write:!0}})],gl.prototype,"halo",void 0),u([d(ge(L({},Ule),{json:{default:"center",write:!0}}))],gl.prototype,"horizontalAlignment",void 0),u([d(ge(L({},Fle),{json:{default:1,write:!0}}))],gl.prototype,"lineHeight",void 0),u([d({type:zc,json:{write:!0}})],gl.prototype,"material",void 0),u([d({type:OC,json:{write:!0}})],gl.prototype,"background",void 0),u([d(Kp)],gl.prototype,"size",null),u([d({type:String,json:{write:!0}})],gl.prototype,"text",void 0),u([vt({Text:"text"},{readOnly:!0})],gl.prototype,"type",void 0),u([d(ge(L({},zle),{json:{default:"baseline",write:!0}}))],gl.prototype,"verticalAlignment",void 0),gl=qI=u([P("esri.symbols.TextSymbol3DLayer")],gl);const rg=gl;var tV;let dy=tV=class extends mf{constructor(e){super(e),this.color=iV.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new tV({color:re(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:rt,nonNullable:!0,json:{type:[Dr],write:(e,t,i)=>t[i]=e.toArray(rt.AlphaMode.UNLESS_OPAQUE),default:()=>iV.clone(),defaultEquals:e=>e.toCss(!0)===iV.toCss(!0)}})],dy.prototype,"color",void 0),u([vt({Water:"water"},{readOnly:!0})],dy.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],dy.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],dy.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],dy.prototype,"waveStrength",void 0),dy=tV=u([P("esri.symbols.WaterSymbol3DLayer")],dy);const iV=new rt([0,119,190]),lce=dy;var rV;let f_=rV=class extends be{constructor(){super(...arguments),this.portal=null}clone(){return new rV({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],f_.prototype,"name",void 0),u([d({type:String})],f_.prototype,"styleUrl",void 0),u([d({type:String})],f_.prototype,"styleName",void 0),u([d({type:Hl})],f_.prototype,"portal",void 0),f_=rV=u([P("esri.symbols.support.StyleOrigin")],f_);const sV=f_;var nV;let MC=nV=class extends be{clone(){return new nV({url:this.url})}};u([d({type:String})],MC.prototype,"url",void 0),MC=nV=u([P("esri.symbols.support.Thumbnail")],MC);const cce={icon:Ic,object:Sj,line:_2,path:Ej,fill:mS,extrude:Tle,text:rg,water:lce},QAe=St.ofType({base:mf,key:"type",typeMap:cce,errorContext:"symbol-layer"}),JAe=pe.getLogger("esri.symbols.Symbol3D");let cp=class extends Xl{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||St;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.initialized&&JAe.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){ob(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const r=y2(e.styleUrl,i);return new sV({styleUrl:r,name:e.name})}if(e.styleName&&e.name)return new sV({portal:i&&i.portal||Hl.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Hc("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let s=nb(e.styleUrl,r);kc(s)&&(s=yd(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!Hle(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new Hc("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof mf||e&&cce[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],cp.prototype,"color",null),u([d({type:QAe,nonNullable:!0,json:{write:!0}}),Bt(Kle)],cp.prototype,"symbolLayers",null),u([d({type:sV})],cp.prototype,"styleOrigin",void 0),u([Ne("styleOrigin")],cp.prototype,"readStyleOrigin",null),u([Xe("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],cp.prototype,"writeStyleOrigin",null),u([d({type:MC,json:{read:!1}})],cp.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],cp.prototype,"type",void 0),cp=u([P("esri.symbols.Symbol3D")],cp);const b2=cp;let CA=class extends _e{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],CA.prototype,"type",void 0),u([d({readOnly:!0})],CA.prototype,"visible",void 0),CA=u([P("esri.symbols.callouts.Callout3D")],CA);const uce=CA;var oV;let WI=oV=class extends _e{constructor(){super(...arguments),this.color=new rt("white")}clone(){return new oV({color:re(this.color)})}};u([d(pg)],WI.prototype,"color",void 0),WI=oV=u([P("esri.symbols.callouts.LineCallout3DBorder")],WI);const hce=WI;Object.freeze(Object.defineProperty({__proto__:null,default:hce},Symbol.toStringTag,{value:"Module"}));var aV;let py=aV=class extends uce{constructor(e){super(e),this.type="line",this.color=new rt([0,0,0,1]),this.size=Sd(1),this.border=null}get visible(){return this.size>0&&_(this.color)&&this.color.a>0}clone(){return new aV({color:re(this.color),size:this.size,border:re(this.border)})}};u([vt({line:"line"},{readOnly:!0})],py.prototype,"type",void 0),u([d(pg)],py.prototype,"color",void 0),u([d(Kp)],py.prototype,"size",void 0),u([d({type:hce,json:{write:!0}})],py.prototype,"border",void 0),u([d({readOnly:!0})],py.prototype,"visible",null),py=aV=u([P("esri.symbols.callouts.LineCallout3D")],py);const KAe=py;function Aj(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function dce(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!Aj(e)}function Cj(e){return e.type==="point-3d"||e.type==="label-3d"}function pce(e){return e.horizontalAlignment==="center"}const fce={types:{key:"type",base:uce,typeMap:{line:KAe}},json:{write:!0}};var lV;let e1=lV=class extends _e{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new lV({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Kp)],e1.prototype,"screenLength",void 0),u([d({type:Number,json:{write:!0,default:0}})],e1.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],e1.prototype,"maxWorldLength",void 0),e1=lV=u([P("esri.symbols.support.Symbol3DVerticalOffset")],e1);var XI;const mce=St.ofType({base:null,key:"type",typeMap:{text:rg}});let fy=XI=class extends b2{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new mce,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return dce(this)}hasVisibleVerticalOffset(){return Aj(this)}clone(){return new XI({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail),callout:re(this.callout),verticalOffset:re(this.verticalOffset)})}static fromTextSymbol(e){return new XI({symbolLayers:[rg.fromTextSymbol(e)]})}};u([d({type:e1,json:{write:!0}})],fy.prototype,"verticalOffset",void 0),u([d(fce)],fy.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],fy.prototype,"styleOrigin",void 0),u([d({type:mce})],fy.prototype,"symbolLayers",void 0),u([vt({LabelSymbol3D:"label-3d"},{readOnly:!0})],fy.prototype,"type",void 0),fy=XI=u([P("esri.symbols.LabelSymbol3D")],fy);const yS=fy;var YI;const gce=St.ofType({base:null,key:"type",typeMap:{line:_2,path:Ej}}),eCe=St.ofType({base:null,key:"type",typeMap:{line:_2,path:Ej}});let RA=YI=class extends b2{constructor(e){super(e),this.symbolLayers=new gce,this.type="line-3d"}clone(){return new YI({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleLineSymbol(e){return new YI({symbolLayers:[_2.fromSimpleLineSymbol(e)]})}};u([d({type:gce,json:{type:eCe}})],RA.prototype,"symbolLayers",void 0),u([vt({LineSymbol3D:"line-3d"},{readOnly:!0})],RA.prototype,"type",void 0),RA=YI=u([P("esri.symbols.LineSymbol3D")],RA);const UO=RA;let my=class extends Xl{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],my.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],my.prototype,"type",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],my.prototype,"xoffset",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],my.prototype,"yoffset",void 0),u([d({type:Number,cast:e=>e==="auto"?e:sr(e),json:{write:!0}})],my.prototype,"size",void 0),my=u([P("esri.symbols.MarkerSymbol")],my);const yce=my;var cV;const vce=St.ofType({base:null,key:"type",typeMap:{fill:mS}});let OA=cV=class extends b2{constructor(e){super(e),this.symbolLayers=new vce,this.type="mesh-3d"}clone(){return new cV({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}};u([d({type:vce})],OA.prototype,"symbolLayers",void 0),u([vt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],OA.prototype,"type",void 0),OA=cV=u([P("esri.symbols.MeshSymbol3D")],OA);const wR=OA;function tCe(e,t,i){return t.imageData?Xle({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):_ce(t.url,i)}function _ce(e,t){return rCe(t)&&!kc(e)&&t.layer.parsedUrl?sb(t.layer.parsedUrl.path,"images",e):y2(e,t)}function iCe(e,t,i,r){if(gf(e)){const s=hF(e);t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&U0(i.url,t,"url",r)}else U0(e,t,"url",r)}const bce={json:{read:{source:["imageData","url"],reader:tCe},write:{writer(e,t,i,r){iCe(e,t,this.source,r)}}}},wce={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=_ce(t.url,i)),r}}}};function rCe(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var uV;let wu=uV=class extends Ele{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=sr(i)),r!=null&&(s.height=sr(r)),s}clone(){const e=new uV({color:re(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",re(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([vt({esriPFS:"picture-fill"},{readOnly:!0})],wu.prototype,"type",void 0),u([d(bce)],wu.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],wu.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],wu.prototype,"yscale",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],wu.prototype,"width",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],wu.prototype,"height",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],wu.prototype,"xoffset",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],wu.prototype,"yoffset",void 0),u([d(wce)],wu.prototype,"source",void 0),wu=uV=u([P("esri.symbols.PictureFillSymbol")],wu);const xce=wu;var hV;let Ih=hV=class extends yce{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=sr(t)),i!=null&&(r.height=sr(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new hV({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",re(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],Ih.prototype,"color",void 0),u([vt({esriPMS:"picture-marker"},{readOnly:!0})],Ih.prototype,"type",void 0),u([d(bce)],Ih.prototype,"url",void 0),u([d(wce)],Ih.prototype,"source",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],Ih.prototype,"height",void 0),u([Ne("height",["height","size"])],Ih.prototype,"readHeight",null),u([d({type:Number,cast:sr,json:{write:!0}})],Ih.prototype,"width",void 0),u([d({json:{write:!1}})],Ih.prototype,"size",void 0),Ih=hV=u([P("esri.symbols.PictureMarkerSymbol")],Ih);const dF=Ih;var gy;const Tce=St.ofType({base:null,key:"type",typeMap:{icon:Ic,object:Sj,text:rg}});let m_=gy=class extends b2{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new Tce,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return dce(this)}hasVisibleVerticalOffset(){return Aj(this)}clone(){return new gy({verticalOffset:re(this.verticalOffset),callout:re(this.callout),styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new gy({symbolLayers:[Ic.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new gy({symbolLayers:[Ic.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var t,i;return((t=e.data)==null||(i=t.symbol)==null?void 0:i.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new gy({symbolLayers:[Ic.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new gy({symbolLayers:[Ic.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new gy({symbolLayers:[rg.fromTextSymbol(e)]})}};u([d({type:e1,json:{write:!0}})],m_.prototype,"verticalOffset",void 0),u([d(fce)],m_.prototype,"callout",void 0),u([d({type:Tce,json:{origins:{"web-scene":{write:!0}}}})],m_.prototype,"symbolLayers",void 0),u([vt({PointSymbol3D:"point-3d"},{readOnly:!0})],m_.prototype,"type",void 0),m_=gy=u([P("esri.symbols.PointSymbol3D")],m_);const Ju=m_;var MA;const Sce=St.ofType({base:null,key:"type",typeMap:{extrude:Tle,fill:mS,icon:Ic,line:_2,object:Sj,text:rg,water:lce}});let PA=MA=class extends b2{constructor(e){super(e),this.symbolLayers=new Sce,this.type="polygon-3d"}clone(){return new MA({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromJSON(e){const t=new MA;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:_(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new MA({symbolLayers:[mS.fromSimpleFillSymbol(e)]})}};u([d({type:Sce,json:{write:!0}})],PA.prototype,"symbolLayers",void 0),u([vt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],PA.prototype,"type",void 0),PA=MA=u([P("esri.symbols.PolygonSymbol3D")],PA);const zO=PA;var dV;const X5=new yi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let g_=dV=class extends Ele{constructor(...e){super(...e),this.color=new rt([0,0,0,.25]),this.outline=new Nd,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new dV({color:re(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],g_.prototype,"color",void 0),u([d()],g_.prototype,"outline",void 0),u([vt({esriSFS:"simple-fill"},{readOnly:!0})],g_.prototype,"type",void 0),u([d({type:X5.apiValues,json:{read:X5.read,write:X5.write}})],g_.prototype,"style",void 0),g_=dV=u([P("esri.symbols.SimpleFillSymbol")],g_);const Gb=g_;var pV;const Y5=new yi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let up=pV=class extends yce{constructor(...e){super(...e),this.color=new rt([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Nd}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=sr(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new pV({angle:this.angle,color:re(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([d()],up.prototype,"color",void 0),u([Xe("color")],up.prototype,"writeColor",null),u([vt({esriSMS:"simple-marker"},{readOnly:!0})],up.prototype,"type",void 0),u([d()],up.prototype,"size",void 0),u([d({type:Y5.apiValues,json:{read:Y5.read,write:Y5.write}})],up.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],up.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Nd}},json:{default:null,write:!0}})],up.prototype,"outline",void 0),up=pV=u([P("esri.symbols.SimpleMarkerSymbol")],up);const jb=up;var fV;let Wr=fV=class extends Xl{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new lF,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return sr(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new fV({angle:this.angle,backgroundColor:re(this.backgroundColor),borderLineColor:re(this.borderLineColor),borderLineSize:this.borderLineSize,color:re(this.color),font:this.font&&this.font.clone(),haloColor:re(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:rt,json:{write:!0}})],Wr.prototype,"backgroundColor",void 0),u([d({type:rt,json:{write:!0}})],Wr.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0}})],Wr.prototype,"borderLineSize",void 0),u([d({type:lF,json:{write:!0}})],Wr.prototype,"font",void 0),u([d(ge(L({},Ule),{json:{write:!0}}))],Wr.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],Wr.prototype,"kerning",void 0),u([d({type:rt,json:{write:!0}})],Wr.prototype,"haloColor",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],Wr.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],Wr.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],Wr.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],Wr.prototype,"text",void 0),u([vt({esriTS:"text"},{readOnly:!0})],Wr.prototype,"type",void 0),u([d(ge(L({},zle),{json:{write:!0}}))],Wr.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],Wr.prototype,"xoffset",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],Wr.prototype,"yoffset",void 0),u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Wr.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],Wr.prototype,"width",void 0),u([d({type:Number})],Wr.prototype,"lineWidth",void 0),u([Xe("lineWidth")],Wr.prototype,"writeLineWidth",null),u([Bt("lineWidth")],Wr.prototype,"castLineWidth",null),u([d(Fle)],Wr.prototype,"lineHeight",void 0),u([Xe("lineHeight")],Wr.prototype,"writeLineHeight",null),Wr=fV=u([P("esri.symbols.TextSymbol")],Wr);const w2=Wr;var mV;const sCe=pe.getLogger("esri.symbols.WebStyleSymbol");let hp=mV=class extends Xl{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new mV({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=await nCe();qt(t);const r=i.resolveWebStyleSymbol(this,{portal:this.portal},e,t);return r.catch(s=>{sCe.error("#fetchSymbol()","Failed to create symbol from style",s)}),r}};function nCe(){return import("./webStyleSymbolUtils.cf570a20.js")}u([d({json:{write:!1}})],hp.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],hp.prototype,"styleName",void 0),u([d({type:Hl,json:{write:!1}})],hp.prototype,"portal",void 0),u([d({type:String,json:{read:wj,write:U0}})],hp.prototype,"styleUrl",void 0),u([d({type:MC,json:{read:!1}})],hp.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],hp.prototype,"name",void 0),u([vt({styleSymbolReference:"web-style"},{readOnly:!0})],hp.prototype,"type",void 0),hp=mV=u([P("esri.symbols.WebStyleSymbol")],hp);const Hb=hp;function Rj(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function xR(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const $1={base:Xl,key:"type",typeMap:{"simple-fill":Gb,"picture-fill":xce,"picture-marker":dF,"simple-line":Nd,"simple-marker":jb,text:w2,"label-3d":yS,"line-3d":UO,"mesh-3d":wR,"point-3d":Ju,"polygon-3d":zO,"web-style":Hb,cim:d2},errorContext:"symbol"},oCe={base:Xl,key:"type",typeMap:{"picture-marker":dF,"simple-marker":jb,text:w2,"web-style":Hb,cim:d2},errorContext:"symbol"},aCe=c2({types:$1}),Ece={base:Xl,key:"type",typeMap:{"simple-fill":Gb,"picture-fill":xce,"picture-marker":dF,"simple-line":Nd,"simple-marker":jb,text:w2,"line-3d":UO,"mesh-3d":wR,"point-3d":Ju,"polygon-3d":zO,"web-style":Hb,cim:d2},errorContext:"symbol"},lCe={base:Xl,key:"type",typeMap:{text:w2,"label-3d":yS},errorContext:"symbol"},zY={base:Xl,key:"type",typeMap:{"line-3d":UO,"mesh-3d":wR,"point-3d":Ju,"polygon-3d":zO,"web-style":Hb,cim:d2},errorContext:"symbol"},cCe={base:Xl,key:"type",typeMap:{"label-3d":yS},errorContext:"symbol"},Ace=xd($1);function uCe(e){if(!e)return null;const t={};for(const i in e){const r=Km(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function hCe(e){if(!_(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let yl=class extends df(_e){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Xa(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&_(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:hCe(this.aggregateGeometries),geometry:_(this.geometry)?this.geometry.toJSON():null,symbol:_(this.symbol)?this.symbol.toJSON():null,attributes:L({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){_(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:uCe}})],yl.prototype,"aggregateGeometries",null),u([d({value:null})],yl.prototype,"attributes",null),u([d({value:null,types:kb,json:{read:Km}})],yl.prototype,"geometry",null),u([d({type:Boolean})],yl.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],yl.prototype,"layer",void 0),u([d({type:tF})],yl.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],yl.prototype,"sourceLayer",void 0),u([d({value:null,types:$1})],yl.prototype,"symbol",null),u([d({type:Boolean,value:!0})],yl.prototype,"visible",null),yl=u([P("esri.Graphic")],yl),function(e){e.generateUID=Xa}(yl||(yl={}));const ho=yl;function Xpt(e){}function dCe(e){return()=>e}function pF(e,t,i){return Ka(e.map((r,s)=>t.apply(i,[r,s])))}async function pCe(e,t,i){return(await Ka(e.map((r,s)=>t.apply(i,[r,s])))).map(r=>r.value)}async function Ad(e){if(C(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function Ypt(e){try{return{ok:!0,value:await e}}catch(t){return hf(t),{ok:!1,error:t}}}function Zpt(e){if(e.ok===!0)return e.value;throw e.error}async function Cce(e,t){return await e.load(),fCe(e,t)}async function fCe(e,t){const i=[],r=(...n)=>{for(const o of n)C(o)||(Array.isArray(o)?r(...o):St.isCollection(o)?o.forEach(a=>r(a)):rf.isLoadable(o)&&i.push(o))};t(r);let s=null;if(await pCe(i,async n=>{(await Ad(mCe(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function mCe(e){return"loadAll"in e&&typeof e.loadAll=="function"}var gV;let ZI=gV=class extends _e{constructor(e){super(e),this.type="none"}clone(){return new gV({type:this.type})}};u([vt({none:"none",stayAbove:"stay-above"})],ZI.prototype,"type",void 0),ZI=gV=u([P("esri.ground.NavigationConstraint")],ZI);var yV;const kY=pe.getLogger("esri.Ground");let Zf=yV=class extends LO(rf){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new St;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&kY.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{kY.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=L({},e)).resourceInfo),e}set layers(e){this._set("layers",ob(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r=ge(L({},r),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){const o={};dCe(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new Y("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Cce(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.ac501639.js");qt(t);const r=new i,s=this.layers.filter(BY).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.ac501639.js");qt(t);const r=new i,s=this.layers.filter(BY).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:re(this.surfaceColor),navigationConstraint:re(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new yV({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return import("./layersCreator.6b93d5a6.js").then(({populateOperationalLayers:o})=>{qt(i);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return Ka(a)}).then(()=>{})}};function gCe(e){return e&&"createElevationSampler"in e}function BY(e){return e.type==="elevation"||gCe(e)}u([d({json:{read:!1}})],Zf.prototype,"layers",null),u([Xe("layers")],Zf.prototype,"writeLayers",null),u([d({readOnly:!0})],Zf.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Dr,read:{reader:_R,source:"transparency"},write:{writer:(e,t)=>{t.transparency=iF(e)},target:"transparency"}}})],Zf.prototype,"opacity",void 0),u([d({type:rt,json:{type:[Dr],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],Zf.prototype,"surfaceColor",void 0),u([d({type:ZI,json:{write:!0}})],Zf.prototype,"navigationConstraint",void 0),Zf=yV=u([P("esri.Ground")],Zf);const TR=Zf;var vV;let yy=vV=class extends _e{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new vV({rotation:this.rotation,scale:this.scale,targetGeometry:_(this.targetGeometry)?this.targetGeometry.clone():null,camera:_(this.camera)?this.camera.clone():null})}};function Z5(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Z5}}}}})],yy.prototype,"rotation",void 0),u([Bt("rotation")],yy.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Z5}}}}})],yy.prototype,"scale",void 0),u([d({types:kb,json:{read:Km,write:!0,origins:{"web-scene":{read:Km,write:{overridePolicy:Z5}}}}})],yy.prototype,"targetGeometry",void 0),u([d({type:il,json:{write:!0}})],yy.prototype,"camera",void 0),yy=vV=u([P("esri.Viewpoint")],yy);const Cd=yy;function fF(e){return typeof e=="string"?document.getElementById(e):e}function Rce(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function VY(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function GY(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}function xe(e,t,i={}){return Oj(e,t,i,Oce)}function Rd(e,t,i={}){return Oj(e,t,i,Mce)}function Oj(e,t,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(mn(s),t(o,a))}:(o,a)=>{r(o)&&t(o,a)};if(s=qxe(e,n,i.sync,i.equals),i.initial){const o=e();n(o,o)}return s}function ma(e,t,i,r={}){let s=null,n=null,o=null;function a(){s&&n&&(n.remove(),r.onListenerRemove==null||r.onListenerRemove(s),s=null,n=null)}function l(h){r.once&&r.once&&mn(o),i(h)}const c=xe(e,(h,p)=>{a(),GN(h)&&(s=h,n=MO(h,t,l),r.onListenerAdd==null||r.onListenerAdd(h))},{sync:r.sync,initial:!0});return o=sh(()=>{c.remove(),a()}),o}function ab(e,t){return yCe(e,Mce,t)}function yCe(e,t,i){if(Ts(i))return Promise.reject(gi());const r=e();if(t!=null&&t(r))return Promise.resolve(r);let s=null;function n(){s=mn(s)}return new Promise((o,a)=>{s=eS([Lo(i,()=>{n(),a(gi())}),Oj(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:Oce)])})}function Oce(e){return!0}function Mce(e){return!!e}const Qr={sync:!0},Bi={initial:!0},xs={sync:!0,initial:!0};class _V{constructor(t=i=>i.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(i=>{t(i)||this._items.delete(i)}),this}}var Ya;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(Ya||(Ya={}));let vCe=0;function Pce(){return vCe++}function _Ce(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function jD(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function Ice(e,t,i,r){if(t.type===Ya.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==Ya.INVOKE&&t.type!==Ya.RESPONSE)return void e.postMessage(t);let s;_Ce(i)?(s=jY(i.transferList),t.data=i.result):(s=jY(r),t.data=i),s?e.postMessage(t,s):e.postMessage(t)}function SR(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function jY(e){if(!e||!e.length)return null;if(ue("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!bCe(i));return t.length?t:null}function bCe(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const wCe={statsWorker:()=>import("./statsWorker.5b8c5cbd.js"),geometryEngineWorker:()=>import("./geometryEngineWorker.ed35a466.js"),CSVSourceWorker:()=>import("./CSVSourceWorker.3ae42c57.js"),EdgeProcessingWorker:()=>Promise.resolve().then(function(){return jct}),ElevationSamplerWorker:()=>import("./ElevationSamplerWorker.bcbdf140.js"),FeatureServiceSnappingSourceWorker:()=>import("./FeatureServiceSnappingSourceWorker.f65839cb.js"),GeoJSONSourceWorker:()=>import("./GeoJSONSourceWorker.bd5cc26e.js"),LercWorker:()=>import("./LercWorker.1f0ff0b2.js"),MemorySourceWorker:()=>import("./MemorySourceWorker.e09f94b8.js"),PBFDecoderWorker:()=>import("./PBFDecoderWorker.712e055b.js"),Pipeline:()=>import("./Pipeline.97244a61.js").then(function(e){return e.P}),PointCloudWorker:()=>import("./PointCloudWorker.faca3ac0.js"),RasterWorker:()=>import("./RasterWorker.3ec77a0f.js"),SceneLayerWorker:()=>import("./SceneLayerWorker.537492d1.js").then(function(e){return e.S}),WFSSourceWorker:()=>import("./WFSSourceWorker.b939c5e8.js"),WorkerTileHandler:()=>import("./WorkerTileHandler.e8d19eb7.js")},{CLOSE:HY,ABORT:qY,INVOKE:WY,RESPONSE:J2,OPEN_PORT:XY,ON:xCe}=Ya,TCe=2;class SCe{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===Ya.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class Nl{constructor(t,i,r){this._port=t,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new SCe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new Nl(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),Nl.clients.set(s,r),i.port2}static loadWorker(t){const i=wCe[t];return i?i():Promise.resolve(null)}close(){this._post({type:HY}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new Y("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const o=Pce();return new Promise((a,l)=>{const c=HN(s,()=>{var p;const f=this._outJobs.get(o);f&&(this._outJobs.delete(o),this._processWork(),(p=f.abortHandle)==null||p.remove(),this._post({type:qY,jobId:o}),l(gi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:WY,jobId:o,methodName:t,abortable:s!=null},i,n)})}on(t,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:Ya.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:Ya.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:XY,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=TCe)return;const t=this._getNextJob();if(!t)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=t;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{var i;(i=t.abortHandle)==null||i.remove(),t.reject(gi(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){_(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=SR(t);if(i)switch(i.type){case J2:this._onResponseMessage(i);break;case WY:this._invokeQueue.push(i);break;case qY:this._onAbortMessage(i);break;case HY:this._onCloseMessage();break;case XY:this._onOpenPortMessage(i);break;case xCe:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&Nl.clients.get(this)===t&&t.destroy(),Nl.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:J2,jobId:r,error:jD(p)})}Jc(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:J2,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),Tr(p)||this._post({type:J2,jobId:r,error:jD(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:J2,jobId:r},l)}_onOpenPortMessage(t){new Nl(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,n=>{i.postMessage(n)}),s=MO(t.port,"message",n=>{SR(n).type===Ya.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){var i;const{jobId:r,error:s,data:n}=t,o=this._outJobs;if(!o.has(r))return;const a=o.get(r);this._processWork(),o.delete(r),(i=a.abortHandle)==null||i.remove(),s?a.reject(Y.fromJSON(JSON.parse(s))):a.resolve(n)}_post(t,i,r){return Ice(this._port,t,i,r)}}Nl.kernelInfo={revision:yoe,version:ece,buildDate:g7},Nl.clients=new Map;const ECe=pe.getLogger("esri.core.workers.Connection");class ACe{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new _V}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,i){return new Promise((r,s)=>{let n=!0;const o=a=>{qt(i.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];Jc(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Nl(c,i,()=>this._ongoingJobsQueue.pop()),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Nl(l,i,()=>this._ongoingJobsQueue.pop()),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a.invoke(t,i,r))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(gi(`Worker closing, aborting job calling '${t.methodName}'`));for(const i of this._clientPromises)i.then(r=>r.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,i,r){let s=null;Array.isArray(r)?(ECe.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=$0();this._ongoingJobsQueue.push({methodName:t,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l.jobAdded())}return n.promise}on(t,i){return Promise.all(this._clientPromises).then(()=>eS(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{i[s]=n.openPort(),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}}const CCe=pe.getLogger("esri.assets");function RCe(e,t){return Pi(Ei(e),t)}function Ei(e){if(!rr.assetsPath)throw CCe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new Y("assets:path-not-set","config.assetsPath is not set");return sb(rr.assetsPath,e)}const $ce=pe.getLogger("esri.intl");function Qf(e,t,i={}){const{format:r={}}=i;return Zp(e,s=>OCe(s,t,r))}function OCe(e,t,i){let r,s;const n=e.indexOf(":");if(n===-1?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const o=l2(r,t);if(o==null)return"";const a=i[s]||i[r];return a?MCe(o,a):s?PCe(o,s):Mj(o)}function MCe(e,t){switch(t.type){case"date":return eg(e,t.intlOptions);case"number":return tg(e,t.intlOptions);default:return $ce.warn("missing format descriptor for key {key}"),Mj(e)}}function PCe(e,t){switch(t.toLowerCase()){case"dateformat":return eg(e);case"numberformat":return tg(e);default:return $ce.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?eg(e):/^numberformat/i.test(t)?tg(e):Mj(e)}}function Mj(e){switch(typeof e){case"string":return e;case"number":return tg(e);case"boolean":return""+e;default:return e instanceof Date?eg(e):""}}const YY=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,ICe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function ZY(e){var t;return(t=ICe[e])!=null&&t}const IA=[],OT=new Map;function QY(e){for(const t of OT.keys())Lce(e.pattern,t)&&OT.delete(t)}function $Ce(e){return IA.includes(e)||(QY(e),IA.unshift(e)),{remove(){const t=IA.indexOf(e);t>-1&&(IA.splice(t,1),QY(e))}}}async function Dce(e){const t=Uc();OT.has(e)||OT.set(e,LCe(e,t));const i=OT.get(e);return await NCe.add(i),i}function DCe(e){if(!YY.test(e))return null;const[,t,i]=YY.exec(e),r=t+(i?"-"+i.toUpperCase():"");return ZY(r)?r:ZY(t)?t:null}async function LCe(e,t){const i=[];for(const r of IA)if(Lce(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new Y("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new Y("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function Lce(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}rj(()=>{OT.clear()});const NCe=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=$0())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function FCe(e,t,i,r){const s=t.exec(i);if(!s)throw new Y("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=DCe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await JY(e(c))}catch(p){if(c===l)throw new Y("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await JY(e(l))}catch(f){throw new Y("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function JY(e){if(_(KY.fetchBundleAsset))return KY.fetchBundleAsset(e);const t=await Pi(e,{responseType:"text"});return JSON.parse(t.data)}class UCe{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return FCe(this.getAssetUrl,this.matcher,t,i)}}function zCe(e){return new UCe(e)}const KY={};$Ce(zCe({pattern:"esri/",location:Ei}));const eZ={};function kCe(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}function BCe(e){var t;const i={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:L({},e.has),map:L({},e.map),packages:e.packages&&e.packages.concat()||[],paths:L({},e.paths)};return e.hasOwnProperty("async")||(i.async=!0),e.hasOwnProperty("isDebug")||(i.isDebug=!1),e.baseUrl||(i.baseUrl=eZ.baseUrl),(t=eZ.packages)==null||t.forEach(r=>{kCe(i.packages,r)}),i}class VCe{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}}class QI{constructor(){this._dispatcher=new VCe,this._workerPostMessage({type:Ya.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){tS(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){tS(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=SR(t);if(i&&i.type===Ya.OPEN){const{modulePath:r,jobId:s}=i;let n=await Nl.loadWorker(r);n||(n=await import(r));const o=Nl.connect(n);this._workerPostMessage({type:Ya.OPENED,jobId:s,data:o})}}}const bV=pe.getLogger("esri.core.workers"),{HANDSHAKE:GCe}=Ya,jCe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let BM,VM;const tZ="Failed to create Worker. Fallback to execute module in main thread";async function HCe(){if(!ue("esri-workers")||(ue("mozilla"),0))return iZ(new QI);if(!BM&&!VM)try{const t=jCe.replace('"{CONFIGURATION}"',`'${qCe()}'`);BM=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){VM=t||{}}let e;if(BM)try{e=new Worker(BM,{name:"esri-worker-"+WCe++})}catch{bV.warn(tZ,VM),e=new QI}else bV.warn(tZ,VM),e=new QI;return iZ(e)}async function iZ(e){return new Promise(t=>{function i(s){const n=SR(s);n&&n.type===GCe&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),bV.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new QI).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function qCe(){let e;if(rr.default!=null){const s=L({},rr);delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(rr));e.assetsPath=Qu(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=Uc(),e.has={"esri-csp-restrictions":ue("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ue("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":ue("esri-2d-query-centroid-enabled"),"featurelayer-pbf":ue("featurelayer-pbf"),"featurelayer-simplify-thresholds":ue("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ue("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ue("featurelayer-simplify-mobile-factor"),"esri-atomics":ue("esri-atomics"),"esri-shared-array-buffer":ue("esri-shared-array-buffer"),"esri-tiles-debug":ue("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ue("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ue("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=Qu(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=Qu(e.workers.workerPath):e.workers.workerPath=Qu(Ei("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=rr.workers.loaderConfig,i=BCe({baseUrl:t==null?void 0:t.baseUrl,locale:Uc(),has:L({"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1},t==null?void 0:t.has),map:L({},t==null?void 0:t.map),paths:L({},t==null?void 0:t.paths),packages:(t==null?void 0:t.packages)||[]}),r={version:ece,buildDate:g7,revision:yoe};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}let WCe=0;const XCe=pe.getLogger("esri.core.workers"),{ABORT:rZ,INVOKE:YCe,OPEN:ZCe,OPENED:QCe,RESPONSE:K2}=Ya;class Pj{constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),XCe.error(r)})}static async create(t){const i=await HCe();return new Pj(i,t)}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=Pce();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:HN(r,()=>{this._outJobs.delete(s),this._post({type:rZ,jobId:s})})};this._outJobs.set(s,a),this._post({type:ZCe,jobId:s,modulePath:t})})}_onMessage(t){const i=SR(t);if(i)switch(i.type){case QCe:this._onOpenedMessage(i);break;case K2:this._onResponseMessage(i);break;case rZ:this._onAbortMessage(i);break;case YCe:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=CAe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:K2,jobId:r,error:jD(h)})}Jc(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:K2,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),Tr(h)||this._post({type:K2,jobId:r,error:jD(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:K2,jobId:r},c)}_onOpenedMessage(t){var i;const{jobId:r,data:s}=t,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),(i=n.abortHandle)==null||i.remove(),n.resolve(s))}_onResponseMessage(t){var i;const{jobId:r,error:s,data:n}=t,o=this._outJobs.get(r);o&&(this._outJobs.delete(r),(i=o.abortHandle)==null||i.remove(),s?o.reject(Y.fromJSON(JSON.parse(s))):o.resolve(n))}_post(t,i,r){return Ice(this.worker,t,i,r)}}let m1=ue("esri-workers-debug")?1:ue("host-browser")?navigator.hardwareConcurrency-1:0;m1||(m1=ue("safari")&&ue("mac")||ue("trident")?7:2);let sZ=0;const JI=[];function JCe(){Fce()}async function GM(e,t){const i=new ACe;return await i.open(e,t),i}async function Nce(e,t={}){if(typeof e!="string")throw new Y("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(ue("host-webworker")&&!ue("esri-workers")&&(i="local"),i==="local"){let r=await Nl.loadWorker(e);r||(r=await import(e)),qt(t.signal);const s=t.client||r;return GM([Nl.connect(r)],ge(L({},t),{client:s}))}if(await Fce(),qt(t.signal),i==="dedicated"){const r=sZ++%m1;return GM([await JI[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,m1);if(r<m1){const s=new Array(r);for(let n=0;n<r;++n){const o=sZ++%m1;s[n]=JI[o].open(e,t)}return GM(s,t)}}return GM(JI.map(r=>r.open(e,t)),t)}let jM=null;async function Fce(){if(jM)return jM;new AbortController;const e=[];for(let t=0;t<m1;t++){const i=Pj.create(t).then(r=>(JI[t]=r,r));e.push(i)}return jM=Promise.all(e),jM}let KI=class extends be{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!St.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||St.isCollection(e)?e.forEach(r=>this._isHandle(r)&&i.push(r)):i.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||St.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let i=0;i<t.length;i++)t[i].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};u([d({readOnly:!0})],KI.prototype,"size",null),KI=u([P("esri.core.Handles")],KI);const Jt=KI;let jp=class extends be{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new Jt,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,xe)}addWhen(e,t,i={}){return this._installWatch(e,t,i,Rd)}addOnCollectionChange(e,t,{initial:i=!1}={}){const r=++this.handleId;return this.handles.add([ma(e,"change",this._createSyncUpdatingCallback(),Qr),ma(e,"change",t,{onListenerAdd:i?s=>t({added:s.toArray(),removed:[]}):void 0})],r),{remove:()=>this.handles.remove(r)}}addPromise(e){if(C(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(HM)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=xe(e,i,{sync:!0,equals:()=>!1});return this.handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this.handles.remove(HM),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(IO(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(HM))}),HM)}}};u([d({readOnly:!0})],jp.prototype,"updating",void 0),jp=u([P("esri.core.support.WatchUpdatingTracking")],jp);const HM=-42;var nZ;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(nZ||(nZ={}));const Fd=e=>{let t=class extends e{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new Jt}get updatingHandles(){return this._get("updatingHandles")||new jp}};return u([d({readOnly:!0})],t.prototype,"handles",null),u([d({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([P("esri.core.HandleOwner")],t),t};let vS=class extends Fd(be){};vS=u([P("esri.core.HandleOwner")],vS);pe.getLogger("esri.core.support.OwningCollection");let PC=class extends Fd(St){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{C(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(St.ofType(this.itemType.Type))(e):new St(e)}};function HD(e,t){return{type:e,cast:Kle,set(i){const r=ob(i,this._get(t),e);r.owner=this,this._set(t,r)}}}u([d()],PC.prototype,"owner",null),PC=u([P("esri.core.support.OwningCollection")],PC);function Ij(e){return new Ke({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const Uce=Ij(ai),qD=Ij(Gp),WD=Ij(Jm),KCe=new Ke({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${ai.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function fg(e){return e&&(pf(e)||e===qD)?qD:e&&(ff(e)||e===WD)?WD:Uce}function Ci(e){return e&&(pf(e)||e===qD)?Gp:e&&(ff(e)||e===WD)?Jm:ai}function Qpt(e){return V7(e)?Gp:G7(e)?Jm:ai}const zce=39.37,eRe=ai.radius*Math.PI/200,kce=/UNIT\[([^\]]+)\]\]$/i,D1=D,Bce=/UNIT\[([^\]]+)\]/i,tRe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),iRe=Uo()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),zd=e=>e*e,Pg=e=>e*e*e,ER={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:zd(.001)},"square-centimeters":{inBaseUnits:zd(.01)},"square-decimeters":{inBaseUnits:zd(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:zd(1e3)},"square-inches":{inBaseUnits:zd(.0254)},"square-feet":{inBaseUnits:zd(.3048)},"square-yards":{inBaseUnits:zd(.9144)},"square-miles":{inBaseUnits:zd(1609.344)},"square-us-feet":{inBaseUnits:zd(1200/3937)},acres:{inBaseUnits:.0015625*zd(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*Pg(.001)},"cubic-centimeters":{inBaseUnits:1e3*Pg(.01)},"cubic-decimeters":{inBaseUnits:1e3*Pg(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*Pg(1e3)},"cubic-inches":{inBaseUnits:1e3*Pg(.0254)},"cubic-feet":{inBaseUnits:1e3*Pg(.3048)},"cubic-yards":{inBaseUnits:1e3*Pg(.9144)},"cubic-miles":{inBaseUnits:1e3*Pg(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},rRe=(()=>{const e={};for(const t in ER)for(const i in ER[t].units)e[i]=t;return e})();function sRe(e,t,i){return e*ER[i].units[t].inBaseUnits}function nRe(e,t,i){return e/ER[i].units[t].inBaseUnits}function wV(e){const t=rRe[e];if(t)return t;throw new Error("unknown type")}function oZ(e,t=null){return t=t||wV(e),ER[t].baseUnit===e}function ys(e,t,i){if(t===i)return e;const r=wV(t);if(r!==wV(i))throw new Error("incompatible units");const s=oZ(t,r)?e:sRe(e,t,r);return oZ(i,r)?s:nRe(s,i,r)}function oRe(e,t){return ys(e,t,"meters")<3e3?"meters":"kilometers"}function aRe(e,t){return ys(e,t,"meters")<1e5?"meters":"kilometers"}function lRe(e,t){return ys(e,t,"feet")<1e3?"feet":"miles"}function cRe(e,t){return ys(e,t,"feet")<1e5?"feet":"miles"}function Jpt(e,t){return ys(e,t,"square-meters")<3e6?"square-meters":"square-kilometers"}function Kpt(e,t){return ys(e,t,"square-feet")<1e6?"square-feet":"square-miles"}function uRe(e,t,i){return ys(e,t,"meters")/(i*Math.PI/180)}function Vce(e){return iRe.fromJSON(e.toLowerCase())||null}function lb(e){if(e&&typeof e=="object"&&!dR(e))return 1;const t=Yl(e);return t>1e5?1:t}function hRe(e){return Yl(e)>=(e instanceof Ke?Ci(e).metersPerDegree:1e5)?"meters":Hce(e)}function Yl(e,t=ai.metersPerDegree){return Gce(e,!0)||t}function Gce(e,t=!1){let i,r,s=null;if(e!=null&&(typeof e=="object"?(i=e.wkid,r=e.wkt):typeof e=="number"?i=e:typeof e=="string"&&(r=e)),i){if(V7(i))return Gp.metersPerDegree;if(G7(i))return Jm.metersPerDegree;s=D1.values[D1[i]],!s&&t&&tRe.has(i)&&(s=eRe)}else r&&(Wce(r)?s=aZ(kce.exec(r),s):qce(r)&&(s=aZ(Bce.exec(r),s)));return s}function aZ(e,t){return e&&e[1]?jce(e[1]):t}function jce(e){return parseFloat(e.split(",")[1])}function Hce(e){let t,i,r=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,i=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(i=e)),t)r=D1.units[D1[t]];else if(i){const s=Wce(i)?kce:qce(i)?Bce:null;if(s){const n=s.exec(i);n&&n[1]&&(r=pRe(n[1]))}}return _(r)?Vce(r):null}function qce(e){return/^GEOCCS/i.test(e)}function Wce(e){return/^PROJCS/i.test(e)}const dRe=1e-7;function pRe(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!D1.units.includes(i)){const r=jce(e);i=null;const s=D1.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<dRe){i=D1.units[n];break}}return i}function eft(e){if(!e)return null;switch(Hce(e)){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric";case null:case void 0:return null}return null}const Xce={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Yce={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},fRe=Uo()(Xce),mRe=Uo()(Yce);Uo()(L(L({},Xce),Yce));var $A;const XD=Uo()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Zce=XD.jsonValues.slice();UN(Zce,"orthometric");const IC=Uo()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let $h=$A=class extends _e{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return XD.write(e,t,i)}readHeightModel(e,t,i){return XD.read(e)||(i&&i.messages&&i.messages.push(gRe(e,{context:i})),null)}readHeightUnit(e,t,i){return IC.read(e)||(i&&i.messages&&i.messages.push(lZ(e,{context:i})),null)}readHeightUnitService(e,t,i){return Vce(e)||IC.read(e)||(i&&i.messages&&i.messages.push(lZ(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new $A({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=hRe(t);return new $A({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t=L({origin:"web-scene"},t),super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new $A;return t.read(e,{origin:"web-scene"}),t}};function lZ(e,t){return new Hc("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function gRe(e,t){return new Hc("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([d({type:XD.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Zce,default:"ellipsoidal"}}}})],$h.prototype,"heightModel",void 0),u([Xe("web-scene","heightModel")],$h.prototype,"writeHeightModel",null),u([Ne(["web-scene","service"],"heightModel")],$h.prototype,"readHeightModel",null),u([d({type:IC.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:IC.jsonValues,write:IC.write}}}})],$h.prototype,"heightUnit",void 0),u([Ne("web-scene","heightUnit")],$h.prototype,"readHeightUnit",null),u([Ne("service","heightUnit")],$h.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],$h.prototype,"vertCRS",void 0),u([Ne("service","vertCRS",["vertCRS","ellipsoid","geoid"])],$h.prototype,"readVertCRS",null),$h=$A=u([P("esri.geometry.HeightModelInfo")],$h);const qb=$h;function os(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function yf(e,t,i,r,s,n,o,a,l,c,h,p,f,g,y,v,b){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=f,e[12]=g,e[13]=y,e[14]=v,e[15]=b,e}function sf(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function rl(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function jr(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],g=t[11],y=t[12],v=t[13],b=t[14],w=t[15],S=i*a-r*o,x=i*l-s*o,E=i*c-n*o,R=r*l-s*a,O=r*c-n*a,I=s*c-n*l,U=h*v-p*y,N=h*b-f*y,V=h*w-g*y,j=p*b-f*v,H=p*w-g*v,J=f*w-g*b;let K=S*J-x*H+E*j+R*V-O*N+I*U;return K?(K=1/K,e[0]=(a*J-l*H+c*j)*K,e[1]=(s*H-r*J-n*j)*K,e[2]=(v*I-b*O+w*R)*K,e[3]=(f*O-p*I-g*R)*K,e[4]=(l*V-o*J-c*N)*K,e[5]=(i*J-s*V+n*N)*K,e[6]=(b*E-y*I-w*x)*K,e[7]=(h*I-f*E+g*x)*K,e[8]=(o*H-a*V+c*U)*K,e[9]=(r*V-i*H-n*U)*K,e[10]=(y*O-v*E+w*S)*K,e[11]=(p*E-h*O-g*S)*K,e[12]=(a*N-o*j-l*U)*K,e[13]=(i*j-r*N+s*U)*K,e[14]=(v*x-y*R-b*S)*K,e[15]=(h*R-p*x+f*S)*K,e):null}function yRe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],g=t[11],y=t[12],v=t[13],b=t[14],w=t[15];return e[0]=a*(f*w-g*b)-p*(l*w-c*b)+v*(l*g-c*f),e[1]=-(r*(f*w-g*b)-p*(s*w-n*b)+v*(s*g-n*f)),e[2]=r*(l*w-c*b)-a*(s*w-n*b)+v*(s*c-n*l),e[3]=-(r*(l*g-c*f)-a*(s*g-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*w-g*b)-h*(l*w-c*b)+y*(l*g-c*f)),e[5]=i*(f*w-g*b)-h*(s*w-n*b)+y*(s*g-n*f),e[6]=-(i*(l*w-c*b)-o*(s*w-n*b)+y*(s*c-n*l)),e[7]=i*(l*g-c*f)-o*(s*g-n*f)+h*(s*c-n*l),e[8]=o*(p*w-g*v)-h*(a*w-c*v)+y*(a*g-c*p),e[9]=-(i*(p*w-g*v)-h*(r*w-n*v)+y*(r*g-n*p)),e[10]=i*(a*w-c*v)-o*(r*w-n*v)+y*(r*c-n*a),e[11]=-(i*(a*g-c*p)-o*(r*g-n*p)+h*(r*c-n*a)),e[12]=-(o*(p*b-f*v)-h*(a*b-l*v)+y*(a*f-l*p)),e[13]=i*(p*b-f*v)-h*(r*b-s*v)+y*(r*f-s*p),e[14]=-(i*(a*b-l*v)-o*(r*b-s*v)+y*(r*l-s*a)),e[15]=i*(a*f-l*p)-o*(r*f-s*p)+h*(r*l-s*a),e}function vRe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],g=e[12],y=e[13],v=e[14],b=e[15];return(t*o-i*n)*(p*b-f*v)-(t*a-r*n)*(h*b-f*y)+(t*l-s*n)*(h*v-p*y)+(i*a-r*o)*(c*b-f*g)-(i*l-s*o)*(c*v-p*g)+(r*l-s*a)*(c*y-h*g)}function xr(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=t[9],g=t[10],y=t[11],v=t[12],b=t[13],w=t[14],S=t[15];let x=i[0],E=i[1],R=i[2],O=i[3];return e[0]=x*r+E*a+R*p+O*v,e[1]=x*s+E*l+R*f+O*b,e[2]=x*n+E*c+R*g+O*w,e[3]=x*o+E*h+R*y+O*S,x=i[4],E=i[5],R=i[6],O=i[7],e[4]=x*r+E*a+R*p+O*v,e[5]=x*s+E*l+R*f+O*b,e[6]=x*n+E*c+R*g+O*w,e[7]=x*o+E*h+R*y+O*S,x=i[8],E=i[9],R=i[10],O=i[11],e[8]=x*r+E*a+R*p+O*v,e[9]=x*s+E*l+R*f+O*b,e[10]=x*n+E*c+R*g+O*w,e[11]=x*o+E*h+R*y+O*S,x=i[12],E=i[13],R=i[14],O=i[15],e[12]=x*r+E*a+R*p+O*v,e[13]=x*s+E*l+R*f+O*b,e[14]=x*n+E*c+R*g+O*w,e[15]=x*o+E*h+R*y+O*S,e}function ga(e,t,i){const r=i[0],s=i[1],n=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],g=t[7],y=t[8],v=t[9],b=t[10],w=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=f,e[7]=g,e[8]=y,e[9]=v,e[10]=b,e[11]=w,e[12]=o*r+h*s+y*n+t[12],e[13]=a*r+p*s+v*n+t[13],e[14]=l*r+f*s+b*n+t[14],e[15]=c*r+g*s+w*n+t[15]}return e}function kO(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ha(e,t,i,r){let s,n,o,a,l,c,h,p,f,g,y,v,b,w,S,x,E,R,O,I,U,N,V,j,H=r[0],J=r[1],K=r[2],he=Math.sqrt(H*H+J*J+K*K);return he<Rt?null:(he=1/he,H*=he,J*=he,K*=he,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],f=t[5],g=t[6],y=t[7],v=t[8],b=t[9],w=t[10],S=t[11],x=H*H*o+n,E=J*H*o+K*s,R=K*H*o-J*s,O=H*J*o-K*s,I=J*J*o+n,U=K*J*o+H*s,N=H*K*o+J*s,V=J*K*o-H*s,j=K*K*o+n,e[0]=a*x+p*E+v*R,e[1]=l*x+f*E+b*R,e[2]=c*x+g*E+w*R,e[3]=h*x+y*E+S*R,e[4]=a*O+p*I+v*U,e[5]=l*O+f*I+b*U,e[6]=c*O+g*I+w*U,e[7]=h*O+y*I+S*U,e[8]=a*N+p*V+v*j,e[9]=l*N+f*V+b*j,e[10]=c*N+g*V+w*j,e[11]=h*N+y*V+S*j,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function _S(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*r,e[5]=o*s+h*r,e[6]=a*s+p*r,e[7]=l*s+f*r,e[8]=c*s-n*r,e[9]=h*s-o*r,e[10]=p*s-a*r,e[11]=f*s-l*r,e}function mF(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*r,e[1]=o*s-h*r,e[2]=a*s-p*r,e[3]=l*s-f*r,e[8]=n*r+c*s,e[9]=o*r+h*s,e[10]=a*r+p*s,e[11]=l*r+f*s,e}function bS(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*r,e[1]=o*s+h*r,e[2]=a*s+p*r,e[3]=l*s+f*r,e[4]=c*s-n*r,e[5]=h*s-o*r,e[6]=p*s-a*r,e[7]=f*s-l*r,e}function gF(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Qce(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sl(e,t,i){let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Rt?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*r,e[2]=l*o*n-a*r,e[3]=0,e[4]=o*a*n-l*r,e[5]=a*a*n+s,e[6]=l*a*n+o*r,e[7]=0,e[8]=o*l*n+a*r,e[9]=a*l*n-o*r,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Jce(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _Re(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kce(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function eue(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,c=n+n,h=r*a,p=r*l,f=r*c,g=s*l,y=s*c,v=n*c,b=o*a,w=o*l,S=o*c;return e[0]=1-(g+v),e[1]=p+S,e[2]=f-w,e[3]=0,e[4]=p-S,e[5]=1-(h+v),e[6]=y+b,e[7]=0,e[8]=f+w,e[9]=y-b,e[10]=1-(h+g),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function bRe(e,t){const i=wRe,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=r*r+s*s+n*n+o*o;return p>0?(i[0]=2*(a*o+h*r+l*n-c*s)/p,i[1]=2*(l*o+h*s+c*r-a*n)/p,i[2]=2*(c*o+h*n+a*s-l*r)/p):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),eue(e,t,i),e}const wRe=M();function xRe(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function TRe(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function SRe(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function ERe(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,g=s*h,y=n*c,v=n*h,b=o*h,w=a*l,S=a*c,x=a*h,E=r[0],R=r[1],O=r[2];return e[0]=(1-(y+b))*E,e[1]=(f+x)*E,e[2]=(g-S)*E,e[3]=0,e[4]=(f-x)*R,e[5]=(1-(p+b))*R,e[6]=(v+w)*R,e[7]=0,e[8]=(g+S)*O,e[9]=(v-w)*O,e[10]=(1-(p+y))*O,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function ARe(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,f=n*c,g=n*h,y=n*p,v=o*h,b=o*p,w=a*p,S=l*c,x=l*h,E=l*p,R=r[0],O=r[1],I=r[2],U=s[0],N=s[1],V=s[2],j=(1-(v+w))*R,H=(g+E)*R,J=(y-x)*R,K=(g-E)*O,he=(1-(f+w))*O,le=(b+S)*O,$=(y+x)*I,z=(b-S)*I,k=(1-(f+v))*I;return e[0]=j,e[1]=H,e[2]=J,e[3]=0,e[4]=K,e[5]=he,e[6]=le,e[7]=0,e[8]=$,e[9]=z,e[10]=k,e[11]=0,e[12]=i[0]+U-(j*U+K*N+$*V),e[13]=i[1]+N-(H*U+he*N+z*V),e[14]=i[2]+V-(J*U+le*N+k*V),e[15]=1,e}function CRe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,g=s*a,y=s*l,v=n*o,b=n*a,w=n*l;return e[0]=1-p-y,e[1]=h+w,e[2]=f-b,e[3]=0,e[4]=h-w,e[5]=1-c-y,e[6]=g+v,e[7]=0,e[8]=f+b,e[9]=g-v,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tue(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function RRe(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e}function ORe(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function $j(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*c,e[15]=1,e}function yF(e,t,i,r){let s,n,o,a,l,c,h,p,f,g;const y=t[0],v=t[1],b=t[2],w=r[0],S=r[1],x=r[2],E=i[0],R=i[1],O=i[2];return Math.abs(y-E)<Rt&&Math.abs(v-R)<Rt&&Math.abs(b-O)<Rt?sf(e):(h=y-E,p=v-R,f=b-O,g=1/Math.sqrt(h*h+p*p+f*f),h*=g,p*=g,f*=g,s=S*f-x*p,n=x*h-w*f,o=w*p-S*h,g=Math.sqrt(s*s+n*n+o*o),g?(g=1/g,s*=g,n*=g,o*=g):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,g=Math.sqrt(a*a+l*l+c*c),g?(g=1/g,a*=g,l*=g,c*=g):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*y+n*v+o*b),e[13]=-(a*y+l*v+c*b),e[14]=-(h*y+p*v+f*b),e[15]=1,e)}function iue(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],p=n-i[1],f=o-i[2],g=h*h+p*p+f*f;g>0&&(g=1/Math.sqrt(g),h*=g,p*=g,f*=g);let y=l*f-c*p,v=c*h-a*f,b=a*p-l*h;return g=y*y+v*v+b*b,g>0&&(g=1/Math.sqrt(g),y*=g,v*=g,b*=g),e[0]=y,e[1]=v,e[2]=b,e[3]=0,e[4]=p*b-f*v,e[5]=f*y-h*b,e[6]=h*v-p*y,e[7]=0,e[8]=h,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function MRe(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function PRe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function IRe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function rue(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function $Re(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function DRe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function sue(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Dj(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],g=e[11],y=e[12],v=e[13],b=e[14],w=e[15],S=t[0],x=t[1],E=t[2],R=t[3],O=t[4],I=t[5],U=t[6],N=t[7],V=t[8],j=t[9],H=t[10],J=t[11],K=t[12],he=t[13],le=t[14],$=t[15];return Math.abs(i-S)<=Rt*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-x)<=Rt*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-E)<=Rt*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-R)<=Rt*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(o-O)<=Rt*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(a-I)<=Rt*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(l-U)<=Rt*Math.max(1,Math.abs(l),Math.abs(U))&&Math.abs(c-N)<=Rt*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(h-V)<=Rt*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(p-j)<=Rt*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(f-H)<=Rt*Math.max(1,Math.abs(f),Math.abs(H))&&Math.abs(g-J)<=Rt*Math.max(1,Math.abs(g),Math.abs(J))&&Math.abs(y-K)<=Rt*Math.max(1,Math.abs(y),Math.abs(K))&&Math.abs(v-he)<=Rt*Math.max(1,Math.abs(v),Math.abs(he))&&Math.abs(b-le)<=Rt*Math.max(1,Math.abs(b),Math.abs(le))&&Math.abs(w-$)<=Rt*Math.max(1,Math.abs(w),Math.abs($))}function Lj(e){const t=Rt,i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const LRe=xr,NRe=rue;Object.freeze(Object.defineProperty({__proto__:null,copy:os,set:yf,identity:sf,transpose:rl,invert:jr,adjoint:yRe,determinant:vRe,multiply:xr,translate:ga,scale:kO,rotate:Ha,rotateX:_S,rotateY:mF,rotateZ:bS,fromTranslation:gF,fromScaling:Qce,fromRotation:sl,fromXRotation:Jce,fromYRotation:_Re,fromZRotation:Kce,fromRotationTranslation:eue,fromQuat2:bRe,getTranslation:xRe,getScaling:TRe,getRotation:SRe,fromRotationTranslationScale:ERe,fromRotationTranslationScaleOrigin:ARe,fromQuat:CRe,frustum:tue,perspective:RRe,perspectiveFromFieldOfView:ORe,ortho:$j,lookAt:yF,targetTo:iue,str:MRe,frob:PRe,add:IRe,subtract:rue,multiplyScalar:$Re,multiplyScalarAndAdd:DRe,exactEquals:sue,equals:Dj,isOrthoNormal:Lj,mul:LRe,sub:NRe},Symbol.toStringTag,{value:"Module"}));let Q5,ie=null;function nue(){return!!ie}function FRe(){return!!ue("esri-wasm")}function oue(){return Q5||(Q5=import("./pe-wasm.f61211d2.js").then(e=>e.p).then(({default:e})=>e({locateFile:t=>Ei(`esri/geometry/support/${t}`)})).then(e=>{lue(e)}),Q5)}var xV,Zr,TV;(function(e){function t(n,o,a){ie.ensureCache.prepare();const l=t1(a),c=a===l,h=ie.ensureFloat64(l),p=ie._pe_geog_to_proj(ie.getPointer(n),o,h);return p&&Qy(a,o,h,c),p}function i(n,o,a,l){switch(l){case Zr.PE_TRANSFORM_P_TO_G:return r(n,o,a);case Zr.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ie.ensureCache.prepare();const c=t1(a),h=a===c,p=ie.ensureFloat64(c),f=ie._pe_proj_to_geog_center(ie.getPointer(n),o,p,l);return f&&Qy(a,o,p,h),f}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(xV||(xV={})),function(e){function t(){e.PE_BUFFER_MAX=ie.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=ie.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=ie.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=ie.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=ie.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=ie.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=ie.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=ie.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=ie.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=ie.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=ie.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=ie.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=ie.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=ie.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=ie.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=ie.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=ie.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=ie.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=ie.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=ie.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=ie.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=ie.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=ie.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=ie.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=ie.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=ie.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=ie.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=ie.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=ie.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=ie.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(Zr||(Zr={})),function(e){const t={},i={},r=g=>{if(g){const y=g.getType();switch(y){case Zr.PE_TYPE_GEOGCS:g=ie.castObject(g,ie.PeGeogcs);break;case Zr.PE_TYPE_PROJCS:g=ie.castObject(g,ie.PeProjcs);break;case Zr.PE_TYPE_GEOGTRAN:g=ie.castObject(g,ie.PeGeogtran);break;default:y&Zr.PE_TYPE_UNIT&&(g=ie.castObject(g,ie.PeUnit))}}return g};function s(){ie.PeFactory.prototype.initialize(null)}function n(g){return o(Zr.PE_TYPE_COORDSYS,g)}function o(g,y){let v=null,b=t[g];if(b||(b={},t[g]=b),b.hasOwnProperty(String(y)))v=b[y];else{const w=ie.PeFactory.prototype.factoryByType(g,y);ie.compare(w,ie.NULL)||(v=w,b[y]=v)}return v=r(v),v}function a(g,y){let v=null,b=i[g];if(b||(b={},i[g]=b),b.hasOwnProperty(y))v=b[y];else{const w=ie.PeFactory.prototype.fromString(g,y);ie.compare(w,ie.NULL)||(v=w,b[y]=v)}return v=r(v),v}function l(g){return o(Zr.PE_TYPE_GEOGCS,g)}function c(g){return o(Zr.PE_TYPE_GEOGTRAN,g)}function h(g){return ie.PeFactory.prototype.getCode(g)}function p(g){return o(Zr.PE_TYPE_PROJCS,g)}function f(g){return o(Zr.PE_TYPE_UNIT,g)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=f}(TV||(TV={}));let aue=null;var YD,SV,EV,AV,ZD,CV,QD,JD,RV;function lue(e){function t(n,o,a){n[o]=a(n[o])}ie=e,Zr.init(),YD.init(),ZD.init(),QD.init(),JD.init(),aue=class extends ie.PeGCSExtent{destroy(){ie.destroy(this)}};const i=[ie.PeDatum,ie.PeGeogcs,ie.PeGeogtran,ie.PeObject,ie.PeParameter,ie.PePrimem,ie.PeProjcs,ie.PeSpheroid,ie.PeUnit];for(const n of i)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(Zr.PE_NAME_MAX))});for(const n of[ie.PeGeogtran,ie.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(Zr.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=ie.getValue(l,"*");a[c]=h?ie.wrapPointer(h,ie.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(ie.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return Qy(a,o,n.call(this)),a}),t(ie.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ie._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ie.compare(l,ie.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=ie.getPointer(l);for(let p=1;p<c;p++)a.push(ie.wrapPointer(h+o*p,ie.PeGTlistExtendedGTs))}}return a}});const r=ie._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ie.compare(l,ie.NULL)){a=[l];const c=l.getNump();if(c>1){const h=ie.getPointer(l);for(let p=1;p<c;p++)a.push(ie.wrapPointer(h+r*p,ie.PeHorizon))}}return o.set(n,a),a};t(ie.PeProjcs.prototype,"horizonGcsGenerate",s),t(ie.PeProjcs.prototype,"horizonPcsGenerate",s),ie.PeObject.prototype.toString=function(n=Zr.PE_STR_OPTS_NONE){ie.ensureCache.prepare();const o=ie.getPointer(this),a=ie.ensureInt8(new Array(Zr.PE_BUFFER_MAX));return ie.UTF8ToString(ie._pe_object_to_string_ext(o,n,a))}}function Cf(e){if(!e)return;const t=ie.getClass(e);if(!t)return;const i=ie.getCache(t);if(!i)return;const r=ie.getPointer(e);r&&delete i[r]}function qM(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(ie.ensureInt8(r));return i}function t1(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function Qy(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=ie.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=ie.getValue(i,"double"),e[n][1]=ie.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=ie.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=ie._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const p=new ie.PeInteger(c);try{const f=ie.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const g=ie.getPointer(f);for(let y=1;y<c;y++)h.push(ie.wrapPointer(g+t*y,ie.PeGTlistExtendedEntry))}}finally{ie.destroy(p)}return h}e.init=i,e.getGTlist=r})(YD||(YD={})),function(e){function t(i){if(i&&i.length){for(const r of i)Cf(r),r.getEntries().forEach(s=>{Cf(s);const n=s.getGeogtran();Cf(n),n.getParameters().forEach(Cf),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Cf(o);const a=o.getDatum();Cf(a),Cf(a.getSpheroid()),Cf(o.getPrimem()),Cf(o.getUnit())})});ie.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(SV||(SV={})),function(e){function t(i,r,s,n,o){ie.ensureCache.prepare();const a=t1(s),l=s===a,c=ie.ensureFloat64(a);let h=0;n&&(h=ie.ensureFloat64(n));const p=ie._pe_geog_to_geog(ie.getPointer(i),r,c,h,o);return p&&Qy(s,r,c,l),p}e.geogToGeog=t}(EV||(EV={})),function(e){const t=(c,h,p,f,g,y)=>{let v,b;switch(ie.ensureCache.prepare(),c){case"dd":v=ie._pe_geog_to_dd,b=Zr.PE_DD_MAX;break;case"ddm":v=ie._pe_geog_to_ddm,b=Zr.PE_DDM_MAX;break;case"dms":v=ie._pe_geog_to_dms,b=Zr.PE_DMS_MAX}let w=0;h&&(w=ie.getPointer(h));const S=t1(f),x=ie.ensureFloat64(S),E=qM(p,b),R=v(w,p,x,g,ie.ensureInt32(E));if(R)for(let O=0;O<p;O++)y[O]=ie.UTF8ToString(E[O]);return R},i=(c,h,p,f,g)=>{let y;switch(ie.ensureCache.prepare(),c){case"dd":y=ie._pe_dd_to_geog;break;case"ddm":y=ie._pe_ddm_to_geog;break;case"dms":y=ie._pe_dms_to_geog}let v=0;h&&(v=ie.getPointer(h));const b=f.map(E=>ie.ensureString(E)),w=ie.ensureInt32(b),S=ie.ensureFloat64(new Array(2*p)),x=y(v,p,w,S);return x&&Qy(g,p,S),x};function r(c,h,p,f,g){return t("dms",c,h,p,f,g)}function s(c,h,p,f){return i("dms",c,h,p,f)}function n(c,h,p,f,g){return t("ddm",c,h,p,f,g)}function o(c,h,p,f){return i("ddm",c,h,p,f)}function a(c,h,p,f,g){return t("dd",c,h,p,f,g)}function l(c,h,p,f){return i("dd",c,h,p,f)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(AV||(AV={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=ie.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=ie.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=ie.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=ie.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=ie.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){ie.ensureCache.prepare();let p=0;s&&(p=ie.getPointer(s));const f=t1(o),g=ie.ensureFloat64(f),y=qM(n,Zr.PE_MGRS_MAX),v=ie.ensureInt32(y),b=ie._pe_geog_to_mgrs_extended(p,n,g,a,l,c,v);if(b)for(let w=0;w<n;w++)h[w]=ie.UTF8ToString(y[w]);return b}function r(s,n,o,a,l){ie.ensureCache.prepare();let c=0;s&&(c=ie.getPointer(s));const h=o.map(y=>ie.ensureString(y)),p=ie.ensureInt32(h),f=ie.ensureFloat64(new Array(2*n)),g=ie._pe_mgrs_to_geog_extended(c,n,p,a,f);return g&&Qy(l,n,f),g}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(ZD||(ZD={})),function(e){function t(r,s,n,o,a,l,c){ie.ensureCache.prepare();let h=0;r&&(h=ie.getPointer(r));const p=t1(n),f=ie.ensureFloat64(p),g=qM(s,Zr.PE_MGRS_MAX),y=ie.ensureInt32(g),v=ie._pe_geog_to_usng(h,s,f,o,a,l,y);if(v)for(let b=0;b<s;b++)c[b]=ie.UTF8ToString(g[b]);return v}function i(r,s,n,o){ie.ensureCache.prepare();let a=0;r&&(a=ie.getPointer(r));const l=n.map(f=>ie.ensureString(f)),c=ie.ensureInt32(l),h=ie.ensureFloat64(new Array(2*s)),p=ie._pe_usng_to_geog(a,s,c,h);return p&&Qy(o,s,h),p}e.geogToUsng=t,e.usngToGeog=i}(CV||(CV={})),function(e){function t(){e.PE_UTM_OPTS_NONE=ie.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=ie.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=ie.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){ie.ensureCache.prepare();let c=0;s&&(c=ie.getPointer(s));const h=t1(o),p=ie.ensureFloat64(h),f=qM(n,Zr.PE_UTM_MAX),g=ie.ensureInt32(f),y=ie._pe_geog_to_utm(c,n,p,a,g);if(y)for(let v=0;v<n;v++)l[v]=ie.UTF8ToString(f[v]);return y}function r(s,n,o,a,l){ie.ensureCache.prepare();let c=0;s&&(c=ie.getPointer(s));const h=o.map(y=>ie.ensureString(y)),p=ie.ensureInt32(h),f=ie.ensureFloat64(new Array(2*n)),g=ie._pe_utm_to_geog(c,n,p,a,f);return g&&Qy(l,n,f),g}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(QD||(QD={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=ie.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=ie.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=ie.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=ie.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o,a;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=ie.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=i,e.generate=r}(JD||(JD={})),function(e){function t(){return ie.PeVersion.prototype.version_string()}e.versionString=t}(RV||(RV={}));const URe=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return ie},isLoaded:nue,isSupported:FRe,load:oue,get PeCSTransformations(){return xV},get PeDefs(){return Zr},get PeFactory(){return TV},get PeGCSExtent(){return aue},get PeGTlistExtended(){return YD},get PeGTlistExtendedEntry(){return SV},get PeGTTransformations(){return EV},get PeNotationDms(){return AV},get PeNotationMgrs(){return ZD},get PeNotationUsng(){return CV},get PeNotationUtm(){return QD},get PePCSInfo(){return JD},get PeVersion(){return RV},_init:lue},Symbol.toStringTag,{value:"Module"})),tft=Math.PI/180,ift=/SPHEROID\[([^\]]+)]/i,Ig=ai.radius,bh=ai.eccentricitySquared,zRe={a1:Ig*bh,a2:Ig*bh*Ig*bh,a3:Ig*bh*bh/2,a4:Ig*bh*Ig*bh*2.5,a5:Ig*bh+Ig*bh*bh/2,a6:1-bh},rft={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:ai.radius,f:ai.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Jm.radius,f:Jm.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Gp.radius,f:Gp.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Gp.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let WM=0;class MT{constructor(t=null){this.uid=WM++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const i=new MT;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=WM++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=WM++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=WM++}getInverse(){const t=new MT;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class o0{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const i of t.steps)i instanceof MT?this.steps.push(i):this.steps.push(new MT({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}static cacheKey(t,i){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(t){const i=new o0;let r="";for(const s of t.steps){const n=MT.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cached_projection={},i._gtlistentry=null,i._chain=r,i}getInverse(){const t=new o0;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cached_projection[o0.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);const s=this._cached_projection[o0.cacheKey(t,i)];return s===void 0?null:s}}function cue(e,t,i){if(C(t)||C(i)||i.vcsWkid||Kc(t,i))return null;const r=lb(t)/lb(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>kRe(s,r);case"polyline":case"esriGeometryPolyline":return s=>VRe(s,r);case"polygon":case"esriGeometryPolygon":return s=>BRe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>GRe(s,r);case"extent":case"esriGeometryExtent":return s=>jRe(s,r);default:return null}}function kRe(e,t){e&&e.z!=null&&(e.z*=t)}function BRe(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function VRe(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function GRe(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function jRe(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let cb=null,KD=null,J5=null,K5={};function uue(){return!!cb&&nue()}function OV(e){return C(J5)&&(J5=Promise.all([oue(),import("./geometryEngineBase.aa7c7461.js").then(t=>t.g),import("./hydrated.ca36a1e4.js")])),J5.then(([,t,{hydratedAdapter:i}])=>{qt(e),KD=i,cb=t.default,cb._enableProjection(URe)})}function BO(e,t,i=null){return Array.isArray(e)?e.length===0?[]:cZ(KD,e,e[0].spatialReference,t,i):cZ(KD,[e],e.spatialReference,t,i)[0]}function cZ(e,t,i,r,s=null){if(C(i)||C(r))return t;if(wS(i,r,s))return t.map(n=>hue(n,i,r));if(C(s)){const n=o0.cacheKey(i,r);K5[n]!==void 0?s=K5[n]:(s=HRe(i,r,null),C(s)&&(s=new o0),K5[n]=s)}if(C(cb))throw new Nj;return cb._project(e,t,i,r,s)}function HRe(e,t,i=null){if(C(cb))throw new Nj;if(C(e)||C(t))return null;const r=cb._getTransformation(KD,e,t,i,i==null?void 0:i.spatialReference);return r!==null?o0.fromGE(r):null}class Nj extends Y{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var Z;function sft(e,t){try{const i=BO(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=cue(i.type,e.spatialReference,t);return _(r)&&r(i),i}catch(i){if(!(i instanceof Nj))throw i;return null}}function wS(e,t,i){return!i&&(!!Kc(e,t)||qc(e)&&qc(t)&&!!kj(e,t,Vj))}async function nft(e,t,i,r){if(!uue()){if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!wS(s,n,o))return OV(r)}else if(!wS(e,t,i))return OV(r)}}function oft(e,t){switch(kj(e,t,Vj)){case ar:return"copy3";case l0:return"wgs84ToSphericalECEF";case ub:return"wgs84ToWebMercator";case a0:return"wgs84ToPlateCarree";case u0:return"wgs84ToWGS84ECEF";case L1:return"webMercatorToWGS84";case yue:return"webMercatorToSphericalECEF";case vue:return"webMercatorToWGS84ECEF";case _ue:return"webMercatorToPlateCarree";case h0:return"wgs84ECEFToWGS84";case xue:return"wgs84ECEFToSphericalECEF";case Tue:return"wgs84ECEFToWebMercator";case c0:return"sphericalECEFToWGS84";case bue:return"sphericalECEFToWebMercator";case $V:return"sphericalMarsPCPFToMars2000";case IV:return"sphericalMoonPCPFToMoon2000";case wue:return"sphericalECEFToWGS84ECEF";case PV:return"mars2000ToSphericalPCPF";case MV:return"moon2000ToSphericalPCPF";default:return null}}function hue(e,t,i){return e?"x"in e?due(e,t,new We,i,0):"xmin"in e?YRe(e,t,new ni,i,0):"rings"in e?pue(e,t,new jl,i,0):"paths"in e?XRe(e,t,new Nc,i,0):"points"in e?WRe(e,t,new zb,i,0):null:null}function qRe(e,t,i=t.spatialReference,r=0){return!C(i)&&_(due(e,e.spatialReference,t,i,r))}function due(e,t,i,r,s){Mi[0]=e.x,Mi[1]=e.y;const n=e.z;return Mi[2]=n!==void 0?n:s,Pr(Mi,t,0,Mi,r,0,1)?(i.x=Mi[0],i.y=Mi[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=Mi[2],i.hasZ=!0),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function WRe(e,t,i,r,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!Pr(h,t,0,h,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,g=h[f],y=h[f+1];o&&a?l.push([g,y,h[f+2],n[p][3]]):o?l.push([g,y,h[f+2]]):a?l.push([g,y,n[p][2]]):l.push([g,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function XRe(e,t,i,r,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return mue(n,o,a,t,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function aft(e,t,i=t.spatialReference,r=0){return _(i)&&_(pue(e,e.spatialReference,t,i,r))}function pue(e,t,i,r,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return mue(n,o,a,t,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function YRe(e,t,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return uZ(n,o,c?e.zmin:s,t,Mi,r)?(i.xmin=Mi[0],i.ymin=Mi[1],c&&(i.zmin=Mi[2]),uZ(a,l,c?e.zmax:s,t,Mi,r)?(i.xmax=Mi[0],i.ymax=Mi[1],c&&(i.zmax=Mi[2]),h&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}function z0(e,t,i){if(C(t)||C(i))return null;const r=new We({spatialReference:i});return Pr(e,t,0,Mi,i,0,1)?(r.x=Mi[0],r.y=Mi[1],r.z=Mi[2],r):null}function fue(e,t,i){return Pr(e,t,0,Mi,i.spatialReference,0,1)?(i.x=Mi[0],i.y=Mi[1],i.z=Mi[2],i):null}function Mr(e,t,i,r=0){Mi[0]=e.x,Mi[1]=e.y;const s=e.z;return Mi[2]=s!==void 0?s:r,Pr(Mi,e.spatialReference,0,t,i,0,1)}function uZ(e,t,i,r,s,n){return $r[0]=e,$r[1]=t,$r[2]=i,Pr($r,r,0,s,n,0,1)}function kn(e,t,i,r){return!(C(t)||C(r)||e.length<2)&&(e.length===2&&($r[0]=e[0],$r[1]=e[1],$r[2]=0,e=$r),Pr(e,t,0,i,r,0,1))}function ZRe(e,t){Mi[0]=e.x,Mi[1]=e.y;const i=e.z;return Mi[2]=i!==void 0?i:0,QRe(Mi,e.spatialReference,t)}function QRe(e,t,i){return JRe(e,t,i)}function JRe(e,t,i){if(C(t))return!1;const r=k0(t,_F),s=Bp[r][Z.WGS84_COMPARABLE_LON_LAT];return!C(s)&&(s(e,0,$r,0),i!==$r&&(i[0]=$r[0],i[1]=$r[1],i.length>2&&(i[2]=$r[2])),!0)}function Pr(e,t,i,r,s,n,o=1){const a=kj(t,s,Vj);if(C(a))return!1;if(a===ar){if(e===r&&i===n)return!0;const c=i+3*o;for(let h=i,p=n;h<c;h++,p++)r[p]=e[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(e,c,r,h);return!0}function lft(e,t,i,r,s){ne(Mi,e),fe(XM,e,t),kn(Mi,i,Mi,s),kn(XM,i,XM,s),de(r,XM,Mi),Te(r,r)}function mue(e,t,i,r,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!Pr(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&i?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function cft(e,t,i,r){if(C(t)||C(r))return!1;const s=Sue(t,r,oOe);if(s.projector===ar)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if(C(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===Z.WEB_MERCATOR){const a=Bp[n.spatialReferenceId][Z.WGS84];return!C(a)&&(a(e,0,Qh,0),ub(Qh,0,i,0),i[3]=hZ(Qh[1],e[2],e[3],ai.radius),!0)}if(n.spatialReferenceId!==Z.WGS84&&n.spatialReferenceId!==Z.CGCS2000||o.spatialReferenceId!==Z.PLATE_CARREE)s.projector(e,0,i,0),i[3]=e[3]*n.metersPerUnit/o.metersPerUnit;else{const a=Bp[n.spatialReferenceId][Z.SPHERICAL_ECEF],l=Bp[Z.SPHERICAL_ECEF][Z.PLATE_CARREE];let c=e[3];_(a)&&_(l)&&(c=hZ(e[1],e[2],e[3],ai.radius)),s.projector(e,0,i,0),i[3]=c}return!0}function hZ(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(pd*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function vF(e,t,i,r){return e!=null&&(Kc(t,r)?(ig(i,e),!0):($r[0]=e[0],$r[1]=e[1],$r[2]=0,!!Pr($r,t,0,$r,r,0,1)&&(i[0]=$r[0],i[1]=$r[1],$r[0]=e[2],$r[1]=e[3],$r[2]=0,!!Pr($r,t,0,$r,r,0,1)&&(i[2]=$r[0],i[3]=$r[1],!0))))}function uft(e,t,i,r){if(C(t)||C(r))return!1;const s=k0(t,_F),n=k0(r,Eue);if(s===n&&s!==Z.UNKNOWN||Kc(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===Z.SPHERICAL_ECEF){const o=Ie(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/ai.radius;if(n===Z.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===Z.WGS84||n===Z.CGCS2000){const c=$C;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===Z.PLATE_CARREE){if(n===Z.WGS84||n===Z.CGCS2000)return i[0]=$C,i[1]=$C,i[2]=1,!0;if(n===Z.WEB_MERCATOR){const o=e[1]/ai.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function nl(e,t,i,r){if(C(e)||C(r))return!1;const s=k0(e,_F),n=k0(r,Eue);if(s===n&&!dZ(n)&&(s!==Z.UNKNOWN||Kc(e,r)))return gF(i,t),!0;if(dZ(n)){const o=Bp[s][Z.LON_LAT],a=Bp[Z.LON_LAT][n];return!C(o)&&!C(a)&&(o(t,0,Qh,0),a(Qh,0,$g,0),gue(pd*Qh[0],pd*Qh[1],i),i[12]=$g[0],i[13]=$g[1],i[14]=$g[2],!0)}if((n===Z.WEB_MERCATOR||n===Z.PLATE_CARREE)&&(s===Z.WGS84||s===Z.CGCS2000&&n===Z.PLATE_CARREE||s===Z.SPHERICAL_ECEF||s===Z.WEB_MERCATOR)){const o=Bp[s][Z.LON_LAT],a=Bp[Z.LON_LAT][n];return!C(o)&&!C(a)&&(o(t,0,Qh,0),a(Qh,0,$g,0),s===Z.SPHERICAL_ECEF?KRe(pd*Qh[0],pd*Qh[1],i):sf(i),i[12]=$g[0],i[13]=$g[1],i[14]=$g[2],!0)}return!1}function dZ(e){return e===Z.SPHERICAL_ECEF||e===Z.SPHERICAL_MARS_PCPF||e===Z.SPHERICAL_MOON_PCPF}function gue(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function KRe(e,t,i){return gue(e,t,i),rl(i,i),i}function k0(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=Yl(e,1)),e.wkt===Uce.wkt?t.spatialReferenceId=Z.SPHERICAL_ECEF:pR(e)?t.spatialReferenceId=Z.WGS84:Q1(e)?t.spatialReferenceId=Z.WEB_MERCATOR:Sae(e)?t.spatialReferenceId=Z.PLATE_CARREE:e.wkt===KCe.wkt?t.spatialReferenceId=Z.WGS84_ECEF:e.wkid===qu.CGCS2000?t.spatialReferenceId=Z.CGCS2000:e.wkt===qD.wkt?t.spatialReferenceId=Z.SPHERICAL_MARS_PCPF:e.wkt===WD.wkt?t.spatialReferenceId=Z.SPHERICAL_MOON_PCPF:pf(e)?t.spatialReferenceId=Z.GCSMARS2000:ff(e)?t.spatialReferenceId=Z.GCSMOON2000:t.spatialReferenceId=Z.UNKNOWN)}function ar(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function L1(e,t,i,r){i[r++]=xS*(e[t++]/ai.radius),i[r++]=xS*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/ai.radius))),i[r]=e[t]}function yue(e,t,i,r){L1(e,t,i,r),l0(i,r,i,r)}function vue(e,t,i,r){L1(e,t,i,r),u0(i,r,i,r)}function Fj(e,t,i,r,s){const n=.4999999*Math.PI,o=He(pd*e[t+1],-n,n),a=Math.sin(o);i[r++]=pd*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=e[t+2]}function ub(e,t,i,r){Fj(e,t,i,r,ai)}(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(Z||(Z={}));const pZ=ai.radius*Math.PI/180,$C=180/(ai.radius*Math.PI);function a0(e,t,i,r){i[r]=e[t]*pZ,i[r+1]=e[t+1]*pZ,i[r+2]=e[t+2]}function g1(e,t,i,r){i[r]=e[t]*$C,i[r+1]=e[t+1]*$C,i[r+2]=e[t+2]}function _ue(e,t,i,r){L1(e,t,i,r),a0(i,r,i,r)}function eOe(e,t,i,r){h0(e,t,i,r),a0(i,r,i,r)}function tOe(e,t,i,r){c0(e,t,i,r),a0(i,r,i,r)}function iOe(e,t,i,r){g1(e,t,i,r),l0(i,r,i,r)}function rOe(e,t,i,r){g1(e,t,i,r),ub(i,r,i,r)}function sOe(e,t,i,r){g1(e,t,i,r),u0(i,r,i,r)}function hb(e){if(C(e))return!1;const t=k0(e,_F);return!!Bp[t][Z.WGS84_COMPARABLE_LON_LAT]}function eE(e,t,i,r,s=0){const n=r+s,o=Math.cos(i);e[0]=Math.cos(t)*o*n,e[1]=Math.sin(t)*o*n,e[2]=Math.sin(i)*n}function Uj(e,t,i,r,s){const n=s+e[t+2],o=pd*e[t+1],a=pd*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function MV(e,t,i,r){Uj(e,t,i,r,Jm.radius)}function PV(e,t,i,r){Uj(e,t,i,r,Gp.radius)}function l0(e,t,i,r){Uj(e,t,i,r,ai.radius)}function zj(e,t,i,r,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=Td(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=xS*h,i[r++]=xS*c,i[r]=l-s}function IV(e,t,i,r){zj(e,t,i,r,Jm.radius)}function $V(e,t,i,r){zj(e,t,i,r,Gp.radius)}function c0(e,t,i,r){zj(e,t,i,r,ai.radius)}function bue(e,t,i,r){c0(e,t,i,r),ub(i,r,i,r)}function wue(e,t,i,r){c0(e,t,i,r),u0(i,r,i,r)}function nOe(e,t,i,r,s){const n=pd*e[t],o=pd*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function u0(e,t,i,r){nOe(e,t,i,r,ai)}function h0(e,t,i,r){const s=zRe,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,f,g,y,v,b,w,S,x,E,R,O,I,U,N,V,j,H;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),j=Math.atan2(o,n),g=a*a/p,y=c/p,R=s.a2/f,O=s.a3-s.a4/f,y>.3?(v=l/f*(1+y*(s.a1+R+g*O)/f),V=Math.asin(v),w=v*v,b=Math.sqrt(1-w)):(b=h/f*(1-g*(s.a5-R-y*O)/f),V=Math.acos(b),w=1-b*b,v=Math.sqrt(w)),S=1-ai.eccentricitySquared*w,x=ai.radius/Math.sqrt(S),E=s.a6*x,R=h-x*b,O=l-E*v,U=b*R+v*O,I=b*O-v*R,N=I/(E/S+U),V+=N,H=U+I*N/2,a<0&&(V=-V),i[r++]=xS*j,i[r++]=xS*V,i[r]=H}function xue(e,t,i,r){h0(e,t,i,r),l0(i,r,i,r)}function Tue(e,t,i,r){h0(e,t,i,r),ub(i,r,i,r)}const Bp={[Z.WGS84]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:ar,[Z.WGS84_COMPARABLE_LON_LAT]:ar,[Z.SPHERICAL_ECEF]:l0,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:ub,[Z.PLATE_CARREE]:a0,[Z.WGS84]:ar,[Z.WGS84_ECEF]:u0},[Z.CGCS2000]:{[Z.CGCS2000]:ar,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:ar,[Z.WGS84_COMPARABLE_LON_LAT]:ar,[Z.SPHERICAL_ECEF]:l0,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:a0,[Z.WGS84]:null,[Z.WGS84_ECEF]:u0},[Z.GCSMARS2000]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:ar,[Z.GCSMOON2000]:null,[Z.LON_LAT]:ar,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:PV,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.GCSMOON2000]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:ar,[Z.LON_LAT]:ar,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:MV,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.WEB_MERCATOR]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:L1,[Z.WGS84_COMPARABLE_LON_LAT]:L1,[Z.SPHERICAL_ECEF]:yue,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:ar,[Z.PLATE_CARREE]:_ue,[Z.WGS84]:L1,[Z.WGS84_ECEF]:vue},[Z.WGS84_ECEF]:{[Z.CGCS2000]:h0,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:h0,[Z.WGS84_COMPARABLE_LON_LAT]:h0,[Z.SPHERICAL_ECEF]:xue,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:Tue,[Z.PLATE_CARREE]:eOe,[Z.WGS84]:h0,[Z.WGS84_ECEF]:ar},[Z.SPHERICAL_ECEF]:{[Z.CGCS2000]:c0,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:c0,[Z.WGS84_COMPARABLE_LON_LAT]:c0,[Z.SPHERICAL_ECEF]:ar,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:bue,[Z.PLATE_CARREE]:tOe,[Z.WGS84]:c0,[Z.WGS84_ECEF]:wue},[Z.SPHERICAL_MARS_PCPF]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:$V,[Z.GCSMOON2000]:null,[Z.LON_LAT]:$V,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:ar,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.SPHERICAL_MOON_PCPF]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:IV,[Z.LON_LAT]:IV,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:ar,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.UNKNOWN]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:null,[Z.WGS84_COMPARABLE_LON_LAT]:null,[Z.SPHERICAL_ECEF]:null,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:ar,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:null,[Z.WGS84]:null,[Z.WGS84_ECEF]:null},[Z.LON_LAT]:{[Z.CGCS2000]:ar,[Z.GCSMARS2000]:ar,[Z.GCSMOON2000]:ar,[Z.LON_LAT]:ar,[Z.WGS84_COMPARABLE_LON_LAT]:ar,[Z.SPHERICAL_ECEF]:l0,[Z.SPHERICAL_MARS_PCPF]:PV,[Z.SPHERICAL_MOON_PCPF]:MV,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:ub,[Z.PLATE_CARREE]:a0,[Z.WGS84]:ar,[Z.WGS84_ECEF]:u0},[Z.WGS84_COMPARABLE_LON_LAT]:{[Z.CGCS2000]:null,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:ar,[Z.WGS84_COMPARABLE_LON_LAT]:ar,[Z.SPHERICAL_ECEF]:l0,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:null,[Z.PLATE_CARREE]:a0,[Z.WGS84]:ar,[Z.WGS84_ECEF]:u0},[Z.PLATE_CARREE]:{[Z.CGCS2000]:g1,[Z.GCSMARS2000]:null,[Z.GCSMOON2000]:null,[Z.LON_LAT]:g1,[Z.WGS84_COMPARABLE_LON_LAT]:g1,[Z.SPHERICAL_ECEF]:iOe,[Z.SPHERICAL_MARS_PCPF]:null,[Z.SPHERICAL_MOON_PCPF]:null,[Z.UNKNOWN]:null,[Z.WEB_MERCATOR]:rOe,[Z.PLATE_CARREE]:ar,[Z.WGS84]:g1,[Z.WGS84_ECEF]:sOe}};function kj(e,t,i=Bj()){return C(e)||C(t)?null:Sue(e,t,i).projector}function Sue(e,t,i){if(C(e)||C(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=k0(e,i.source),s=k0(t,i.dest);return r===Z.UNKNOWN&&s===Z.UNKNOWN?Kc(e,t)?i.projector=ar:i.projector=null:i.projector=Bp[r][s],i}function Bj(){return{source:{spatialReference:null,spatialReferenceId:Z.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:Z.UNKNOWN,metersPerUnit:1},projector:ar}}const _F={spatialReference:null,spatialReferenceId:Z.UNKNOWN},Eue={spatialReference:null,spatialReferenceId:Z.UNKNOWN},Vj=Bj(),oOe=Bj(),pd=$t(1),xS=el(1),$r=M(),Qh=M(),$g=M(),Mi=M(),XM=M();class mg{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&tS(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*fZ);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,fZ));t++)this._items.push(this.allocator())}}const fZ=1024;function Ae(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function N1(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function Gj(e,t,i,r,s,n,o,a,l,c,h,p,f,g,y,v){return[e,t,i,r,s,n,o,a,l,c,h,p,f,g,y,v]}function Aue(e,t){return new Float64Array(e,t,16)}const Es=Ae();Object.freeze(Object.defineProperty({__proto__:null,create:Ae,clone:N1,fromValues:Gj,createView:Aue,IDENTITY:Es},Symbol.toStringTag,{value:"Module"}));var Bc;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Bc||(Bc={}));function aOe(e){return 32+e.length}function lOe(){return 16}function Cue(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=aOe(r);break;case"number":t+=lOe();break;case"boolean":t+=4}}return t}function hft(e,t){return 32+e.length*t}var db;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(db||(db={}));function Qi(){return[1,0,0,0,1,0,0,0,1]}function cOe(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function uOe(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]}function Rue(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Qi,clone:cOe,fromValues:uOe,createView:Rue},Symbol.toStringTag,{value:"Module"}));function vf(){return[0,0,0,1]}function hOe(e){return[e[0],e[1],e[2],e[3]]}function dOe(e,t,i,r){return[e,t,i,r]}function Oue(e,t){return new Float64Array(e,t,4)}const pOe=vf();Object.freeze(Object.defineProperty({__proto__:null,create:vf,clone:hOe,fromValues:dOe,createView:Oue,IDENTITY:pOe},Symbol.toStringTag,{value:"Module"}));function lt(){return[0,0]}function DA(e){return[e[0],e[1]]}function Oi(e,t){return[e,t]}function fOe(e){const t=lt(),i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function Mue(e,t){return new Float64Array(e,t,2)}function Pue(){return lt()}function Iue(){return Oi(1,1)}function $ue(){return Oi(1,0)}function Due(){return Oi(0,1)}const sg=Pue(),Lue=Iue(),mOe=$ue(),gOe=Due();Object.freeze(Object.defineProperty({__proto__:null,create:lt,clone:DA,fromValues:Oi,fromArray:fOe,createView:Mue,zeros:Pue,ones:Iue,unitX:$ue,unitY:Due,ZEROS:sg,ONES:Lue,UNIT_X:mOe,UNIT_Y:gOe},Symbol.toStringTag,{value:"Module"}));function ii(){return[0,0,0,0]}function bF(e){return[e[0],e[1],e[2],e[3]]}function ri(e,t,i,r){return[e,t,i,r]}function jj(e){const t=ii(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function Nue(e,t){return new Float64Array(e,t,4)}function Fue(){return ii()}function Uue(){return ri(1,1,1,1)}function zue(){return ri(1,0,0,0)}function kue(){return ri(0,1,0,0)}function Bue(){return ri(0,0,1,0)}function Vue(){return ri(0,0,0,1)}const Vm=Fue(),Wu=Uue(),yOe=zue(),vOe=kue(),_Oe=Bue(),bOe=Vue();Object.freeze(Object.defineProperty({__proto__:null,create:ii,clone:bF,fromValues:ri,fromArray:jj,createView:Nue,zeros:Fue,ones:Uue,unitX:zue,unitY:kue,unitZ:Bue,unitW:Vue,ZEROS:Vm,ONES:Wu,UNIT_X:yOe,UNIT_Y:vOe,UNIT_Z:_Oe,UNIT_W:bOe},Symbol.toStringTag,{value:"Module"}));class Oc{constructor(t,i,r){this.itemByteSize=t,this.itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}get(){this._itemsPtr===0&&tS(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const i=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this.itemCreate(i,r*this.itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=cw){return new Oc(16,Mue,t)}static createVec3f64(t=cw){return new Oc(24,O7,t)}static createVec4f64(t=cw){return new Oc(32,Nue,t)}static createMat3f64(t=cw){return new Oc(72,Rue,t)}static createMat4f64(t=cw){return new Oc(128,Aue,t)}static createQuatf64(t=cw){return new Oc(32,Oue,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const cw=4*db.KILOBYTES,dft=Oc.createVec2f64(),Ge=Oc.createVec3f64(),Hj=Oc.createVec4f64();Oc.createMat3f64();const qj=Oc.createMat4f64();Oc.createQuatf64();function nv(e){return e?{origin:ts(e.origin),vector:ts(e.vector)}:{origin:M(),vector:M()}}function F1(e,t,i=nv()){return ne(i.origin,e),de(i.vector,t,e),i}function Wj(e,t){const i=de(Ge.get(),t,e.origin),r=Se(e.vector,i),s=Se(e.vector,e.vector),n=He(r/s,0,1),o=de(Ge.get(),oe(Ge.get(),e.vector,n),i);return Se(o,o)}function mZ(e,t,i,r,s){const{vector:n,origin:o}=e,a=de(Ge.get(),t,o),l=Se(n,a)/ua(n);return oe(s,n,He(l,i,r)),fe(s,s,e.origin)}function Gue(e,t,i){return!!wOe(e,t,!0,gZ)&&(ne(i,gZ.pA),!0)}function wOe(e,t,i,r){const n=e.origin,o=fe(Ge.get(),n,e.vector),a=t.origin,l=fe(Ge.get(),a,t.vector),c=Ge.get(),h=Ge.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=Ge.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],g=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],b=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*v-g*g;if(Math.abs(b)<1e-6)return!1;let w=(f*g-y*v)/b,S=(f+g*w)/v;i&&(w=He(w,0,1),S=He(S,0,1));const x=Ge.get(),E=Ge.get();return x[0]=n[0]+w*p[0],x[1]=n[1]+w*p[1],x[2]=n[2]+w*p[2],E[0]=a[0]+S*h[0],E[1]=a[1]+S*h[1],E[2]=a[2]+S*h[2],r.tA=w,r.tB=S,r.pA=x,r.pB=E,r.distance2=fa(x,E),!0}const gZ={tA:0,tB:0,pA:M(),pB:M(),distance2:0};new mg(()=>({origin:null,vector:null}));function Ln(e){return e?{origin:ts(e.origin),direction:ts(e.direction)}:{origin:M(),direction:M()}}function pft(e,t){return I0(e.origin,t.origin)&&I0(e.direction,t.direction)}function Xc(e,t){const i=AOe.get();return i.origin=e,i.direction=t,i}function eL(e,t=Ln()){return jue(e.origin,e.direction,t)}function xOe(e,t,i=Ln()){return ne(i.origin,e),de(i.direction,t,e),i}function jue(e,t,i=Ln()){return ne(i.origin,e),ne(i.direction,t),i}function TOe(e,t){const i=_t(Ge.get(),Te(Ge.get(),e.direction),de(Ge.get(),t,e.origin));return Se(i,i)}function SOe(e,t,i){const r=Se(e.direction,de(i,t,e.origin));return fe(i,e.origin,oe(i,e.direction,r)),i}function EOe(){return{origin:null,direction:null}}const AOe=new mg(EOe);function DC(e,t){return Se(e,t)/Ie(e)}function Xj(e,t){const i=Se(e,t)/(Ie(e)*Ie(t));return-Hs(i)}function COe(e,t,i){Te(YM,e),Te(eU,t);const r=Se(YM,eU),s=Hs(r),n=_t(YM,YM,eU);return Se(n,i)<0?2*Math.PI-s:s}const YM=M(),eU=M(),ROe=pe.getLogger("esri.geometry.support.sphere");function Vn(){return ii()}function TS(e,t=Vn()){return Dc(t,e)}function Hue(e,t){return ri(e[0],e[1],e[2],t)}function OOe(e){return e}function que(e){e[0]=e[1]=e[2]=e[3]=0}function MOe(e){return e}function wF(e){return Array.isArray(e)?e[3]:e}function Yc(e){return Array.isArray(e)?e:FOe}function Wue(e,t,i,r){return ri(e,t,i,r)}function POe(e,t,i){return e!==i&&ne(i,e),i[3]=e[3]+t,i}function IOe(e,t,i){return ROe.error("sphere.setExtent is not yet supported"),e===i?i:TS(e,i)}function ov(e,t,i){if(C(t))return!1;const{origin:r,direction:s}=t,n=$Oe;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const $Oe=M();function DV(e,t){return ov(e,t,null)}function DOe(e,t,i){if(ov(e,t,i))return i;const r=x2(e,t,Ge.get());return fe(i,t.origin,oe(Ge.get(),t.direction,Yi(t.origin,r)/Ie(t.direction))),i}function x2(e,t,i){const r=Ge.get(),s=qj.get();_t(r,t.origin,t.direction);const n=wF(e);_t(i,r,t.origin),oe(i,i,1/Ie(i)*n);const o=Zue(e,t.origin),a=Xj(t.origin,i);return sl(s,a+o,r),Fe(i,i,s),i}function LOe(e,t,i){return ov(e,t,i)?i:(SOe(t,Yc(e),i),Xue(e,i,i))}function Xue(e,t,i){const r=de(Ge.get(),t,Yc(e)),s=oe(Ge.get(),r,e[3]/Ie(r));return fe(i,s,Yc(e))}function Yue(e,t){const i=de(Ge.get(),t,Yc(e)),r=ua(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function Zue(e,t){const i=de(Ge.get(),t,Yc(e)),r=Ie(i),s=wF(e),n=s+Math.abs(s-r);return Hs(s/n)}const tU=M();function Que(e,t,i,r){const s=de(tU,t,Yc(e));switch(i){case Bc.X:{const n=oY(s,tU)[2];return se(r,-Math.sin(n),Math.cos(n),0)}case Bc.Y:{const n=oY(s,tU),o=n[1],a=n[2],l=Math.sin(o);return se(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Bc.Z:return Te(r,s);default:return}}function Jue(e,t){const i=de(LV,t,Yc(e));return Ie(i)-e[3]}function NOe(e,t,i,r){const s=Jue(e,t),n=Que(e,t,Bc.Z,LV),o=oe(LV,n,i-s);return fe(r,t,o)}const FOe=M(),LV=M(),UOe=Object.freeze(Object.defineProperty({__proto__:null,create:Vn,copy:TS,fromCenterAndRadius:Hue,wrap:OOe,clear:que,fromRadius:MOe,getRadius:wF,getCenter:Yc,fromValues:Wue,elevate:POe,setExtent:IOe,intersectRay:ov,intersectsRay:DV,intersectRayClosestSilhouette:DOe,closestPointOnSilhouette:x2,closestPoint:LOe,projectPoint:Xue,distanceToSilhouette:Yue,angleToSilhouette:Zue,axisAt:Que,altitudeAt:Jue,setAltitudeAt:NOe},Symbol.toStringTag,{value:"Module"}));function fi(e=qOe){return[e[0],e[1],e[2],e[3]]}function zOe(e,t,i,r){return Yj(e,t,i,r,Hj.get())}function xF(e,t){return Yj(t[0],t[1],t[2],t[3],e)}function Yj(e,t,i,r,s=fi()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Kue(e,t,i){return ne(i,e),i[3]=t,i}function SS(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function Oo(e,t,i,r=fi()){const s=i[0]-t[0],n=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,g=h*h+p*p+f*f,y=Math.abs(g-1)>1e-5&&g>1e-12?1/Math.sqrt(g):1;r[0]=h*y,r[1]=p*y,r[2]=f*y,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2])}function ehe(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,tE);let n=r,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,uw),n++,o=!da(tE,uw);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,i1),n++,de(ZM,tE,uw),Te(ZM,ZM),de(QM,uw,i1),Te(QM,QM),o=!da(tE,i1)&&!da(uw,i1)&&Math.abs(Se(ZM,QM))<kOe;return o?(Oo(tE,uw,i1,t),!0):(i!==0||r!==1||s!==2)&&ehe(e,t,0,1,2)}const kOe=.99619469809,tE=M(),uw=M(),i1=M(),ZM=M(),QM=M();function NV(e,t,i){return t!==e&&xF(e,t),e[3]=-Se(e,i),e}function FV(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function AR(e,t,i,r){return _t(i1,t,e),SS(i,i1,r)}function fft(e,t,i,r){return TF(e,t,de(Ge.get(),i,t),WOe,r)}function Wb(e,t,i){return!!_(t)&&TF(e,t.origin,t.direction,XOe,i)}function BOe(e,t,i){return TF(e,t.origin,t.vector,Hp.NONE,i)}function VOe(e,t,i){return TF(e,t.origin,t.vector,Hp.CLAMP,i)}function the(e,t){return mr(e,t)>=0}function GOe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:o)+e[2]*(e[2]>0?s:a)+e[3]>=0}function jOe(e,t){const i=Se(e,t.ray.direction),r=-mr(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function HOe(e,t,i){const r=oe(Ge.get(),e,-e[3]),s=UV(e,de(Ge.get(),t,r),Ge.get());return fe(i,s,r),i}function UV(e,t,i){const r=oe(Ge.get(),e,Se(e,t));return de(i,t,r),i}function mr(e,t){return Se(e,t)+e[3]}function TF(e,t,i,r,s){const n=Se(e,i);if(n===0)return!1;let o=-(Se(e,t)+e[3])/n;return r&Hp.CLAMP&&(o=He(o,0,1)),!(!(r&Hp.INFINITE_MIN)&&o<0||!(r&Hp.INFINITE_MAX)&&o>1)&&(fe(s,t,oe(s,i,o)),!0)}function mft(e){return e}const qOe=[0,0,1,0];var Hp;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(Hp||(Hp={}));const WOe=Hp.INFINITE_MIN|Hp.INFINITE_MAX,XOe=Hp.INFINITE_MAX,iU=pe.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class ihe{constructor(){this.plane=fi(),this.origin=M(),this.basis1=M(),this.basis2=M()}}function av(e=phe){return{plane:fi(e.plane),origin:ts(e.origin),basis1:ts(e.basis1),basis2:ts(e.basis2)}}function YOe(e,t,i){const r=aMe.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=zOe(0,0,0,0),SF(r),r}function Xb(e,t=av()){return Zj(e.origin,e.basis1,e.basis2,t)}function ZOe(e,t){ne(t.origin,e.origin),ne(t.basis1,e.basis1),ne(t.basis2,e.basis2),xF(t.plane,e.plane)}function Zj(e,t,i,r=av()){return ne(r.origin,e),ne(r.basis1,t),ne(r.basis2,i),SF(r),nMe(r,"fromValues()"),r}function SF(e){AR(e.basis2,e.basis1,e.origin,e.plane)}function rhe(e,t,i){e!==i&&Xb(e,i);const r=oe(Ge.get(),ng(e),t);return fe(i.origin,i.origin,r),i.plane[3]-=t,i}function QOe(e,t,i){return she(t,i),rhe(i,eH(e,e.origin),i),i}function she(e,t=av()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return se(t.origin,e[0]+i,e[1]+r,0),se(t.basis1,i,0,0),se(t.basis2,0,r,0),Yj(0,0,1,0,t.plane),t}function Qj(e,t,i){return!!Wb(e.plane,t,i)&&hhe(e,i)}function JOe(e,t,i){if(Qj(e,t,i))return i;const r=nhe(e,t,Ge.get());return fe(i,t.origin,oe(Ge.get(),t.direction,Yi(t.origin,r)/Ie(t.direction))),i}function nhe(e,t,i){const r=tL.get();dhe(e,t,r,tL.get());let s=Number.POSITIVE_INFINITY;for(const n of iH){const o=tH(e,n,EF.get()),a=Ge.get();if(BOe(r,o,a)){const l=dg(Ge.get(),t.origin,a),c=Math.abs(Hs(Se(t.direction,l)));c<s&&(s=c,ne(i,a))}}return s===Number.POSITIVE_INFINITY?ohe(e,t,i):i}function ohe(e,t,i){if(Qj(e,t,i))return i;const r=tL.get(),s=tL.get();dhe(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of iH){const a=tH(e,o,EF.get()),l=Ge.get();if(VOe(r,a,l)){const c=TOe(t,l);if(!the(s,l))continue;c<n&&(n=c,ne(i,l))}}return Jj(e,t.origin)<n&&ahe(e,t.origin,i),i}function ahe(e,t,i){const r=HOe(e.plane,t,Ge.get()),s=mZ(yZ(e,e.basis1),r,-1,1,Ge.get()),n=mZ(yZ(e,e.basis2),r,-1,1,Ge.get());return de(i,fe(Ge.get(),s,n),e.origin),i}function lhe(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=de(Ge.get(),t,r),a=DC(s,o),l=DC(n,o),c=DC(ng(e),o);return se(i,a,l,c)}function Jj(e,t){const i=lhe(e,t,Ge.get()),{basis1:r,basis2:s}=e,n=Ie(r),o=Ie(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function KOe(e,t){return Math.sqrt(Jj(e,t))}function eMe(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of iH){const s=tH(e,r,EF.get()),n=Wj(s,t);n>i&&(i=n)}return Math.sqrt(i)}function Kj(e,t){return the(e.plane,t)&&hhe(e,t)}function tMe(e,t,i,r){return sMe(e,i,r)}function eH(e,t){const i=-e.plane[3];return DC(ng(e),t)-i}function iMe(e,t,i,r){const s=eH(e,t),n=oe(oMe,ng(e),i-s);return fe(r,t,n),r}function che(e,t){return da(e.basis1,t.basis1)&&da(e.basis2,t.basis2)&&da(e.origin,t.origin)}function uhe(e,t,i){return e!==i&&Xb(e,i),jr(hw,t),rl(hw,hw),Fe(i.basis1,e.basis1,hw),Fe(i.basis2,e.basis2,hw),Fe(i.plane,e.plane,hw),Fe(i.origin,e.origin,t),NV(i.plane,i.plane,i.origin),i}function rMe(e,t,i,r){return e!==r&&Xb(e,r),sl(rU,t,i),Fe(r.basis1,e.basis1,rU),Fe(r.basis2,e.basis2,rU),SF(r),r}function ng(e){return e.plane}function sMe(e,t,i){switch(t){case Bc.X:ne(i,e.basis1),Te(i,i);break;case Bc.Y:ne(i,e.basis2),Te(i,i);break;case Bc.Z:ne(i,ng(e))}return i}function hhe(e,t){const i=de(Ge.get(),t,e.origin),r=ua(e.basis1),s=ua(e.basis2),n=Se(e.basis1,i),o=Se(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function yZ(e,t){const i=EF.get();return ne(i.origin,e.origin),ne(i.vector,t),i}function tH(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=oe(Ge.get(),r,t.origin[0]),a=oe(Ge.get(),s,t.origin[1]);fe(i.origin,o,a),fe(i.origin,i.origin,n);const l=oe(Ge.get(),r,t.direction[0]),c=oe(Ge.get(),s,t.direction[1]);return oe(i.vector,fe(l,l,c),2),i}function nMe(e,t){Math.abs(Se(e.basis1,e.basis2)/(Ie(e.basis1)*Ie(e.basis2)))>1e-6&&iU.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(Se(e.basis1,ng(e)))>1e-6&&iU.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Se(ng(e),e.origin)-e.plane[3])>1e-6&&iU.warn(t,"Plane offset is not consistent with plane origin")}function dhe(e,t,i,r){const s=ng(e);AR(s,t.direction,t.origin,i),AR(i,s,t.origin,r)}const phe={plane:fi(),origin:Le(0,0,0),basis1:Le(1,0,0),basis2:Le(0,1,0)},tL=new mg(fi),EF=new mg(nv),oMe=M(),aMe=new mg(()=>({origin:null,basis1:null,basis2:null,plane:null})),iH=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],hw=Ae(),rU=Ae(),lMe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:ihe,create:av,wrap:YOe,copy:Xb,copyWithoutVerify:ZOe,fromValues:Zj,updateUnboundedPlane:SF,elevate:rhe,setExtent:QOe,fromAABoundingRect:she,intersectRay:Qj,intersectRayClosestSilhouette:JOe,closestPointOnSilhouette:nhe,closestPoint:ohe,projectPoint:ahe,projectPointLocal:lhe,distance2:Jj,distance:KOe,distanceToSilhouette:eMe,extrusionContainsPoint:Kj,axisAt:tMe,altitudeAt:eH,setAltitudeAt:iMe,equals:che,transform:uhe,rotate:rMe,normal:ng,UP:phe},Symbol.toStringTag,{value:"Module"}));function cMe(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function uMe(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function hMe(e){return{operations:e,value:e.create()}}function fhe(e,t,i=hMe(e)){return i.operations=e,e.copy(t,i.value),i}function dMe(e){return fhe(UOe,Wue(0,0,0,Ci(e).radius))}const vZ=2**50;function pMe(){return fhe(lMe,Zj([0,0,0],[vZ,0,0],[0,vZ,0]))}function fMe(e,t,i){return e.operations.axisAt(e.value,t,Bc.Z,i)}function mMe(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function gMe(e,t,i){return e.operations.intersectRay(e.value,t,i)}function yMe(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function vMe(e,t){return e.operations.altitudeAt(e.value,t)}function mhe(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function _Me(e,t,i,r){return t!==r&&os(r,t),se(dw,r[12],r[13],r[14]),mhe(e,dw,i,dw),r[12]=dw[0],r[13]=dw[1],r[14]=dw[2],r}function sU(e,t,i){return e.operations.elevate(e.value,t,i.value)}const dw=M();function _Z(e,t,i,r,s){return s[0]=Se(e,t),s[1]=Se(e,i),s[2]=Se(e,r),s}function zV(e,t,i,r,s){ne(i,e),ne(JM,t),Te(JM,JM),_t(r,JM,i),_t(s,r,i)}function ghe(e,t){return e?fg(t):t.isGeographic?Ke.PlateCarree:t}const JM=M(),yhe=96;function gft(e,t){const i=t||e.extent,r=e.width,s=Yl(i&&i.spatialReference);return i&&r?i.width/r*s*zce*yhe:0}function vhe(e,t){return e/(Yl(t)*zce*yhe)}var bZ,iL,LC,wZ,r1;(function(e){e[e.Binary=0]="Binary",e[e.JSON=1]="JSON"})(bZ||(bZ={})),function(e){e[e.TreeIndex=0]="TreeIndex",e[e.TreeStats=1]="TreeStats",e[e.TreeData=2]="TreeData",e[e.BrickBundles=3]="BrickBundles",e[e.Section=4]="Section",e[e.VariableStats=5]="VariableStats"}(iL||(iL={})),function(e){e[e.None=1]="None",e[e.Front=2]="Front",e[e.Back=3]="Back"}(LC||(LC={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(wZ||(wZ={})),function(e){e[e.None=0]="None",e[e.StaticSections=1]="StaticSections",e[e.Slices=2]="Slices",e[e.DynamicSections=4]="DynamicSections",e[e.GhostShell=8]="GhostShell",e[e.Isosurface=16]="Isosurface",e[e.Quality=32]="Quality",e[e.SunLocation=64]="SunLocation",e[e.StaticSectionSelection=128]="StaticSectionSelection",e[e.ExaggerationAndOffset=256]="ExaggerationAndOffset",e[e.CurrentTime=512]="CurrentTime",e[e.CurrentVariable=1024]="CurrentVariable",e[e.DeleteIsosurface=2048]="DeleteIsosurface",e[e.ContainerVisibility=4096]="ContainerVisibility",e[e.RenderMode=8192]="RenderMode",e[e.Optimization=16384]="Optimization"}(r1||(r1={}));function bMe(e){return new Promise(t=>import("./vxlLayer.7c86913c.js").then(i=>i.v).then(({default:i})=>{const r=i({locateFile:wMe,preinitializedWebGLContext:e,onRuntimeInitialized:()=>t(r)})})).catch(t=>{throw t})}function wMe(e){return Ei(`esri/libs/vxl/${e}`)}var Ue;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"})(Ue||(Ue={}));var we;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(we||(we={}));var xi;function xMe(e,t,i={}){const r=_he(e);for(;r.length>1;){const s=rL(t,r.shift(),i);if(_(s))return s}return TMe(t,r.shift(),i)}function _he(e){const t=ue("esri-force-webgl");if(t===xi.WEBGL1||t===xi.WEBGL2)return[t];switch(e){case"2d":case"3d":return[xi.WEBGL2,xi.WEBGL1]}}function TMe(e,t,i={}){if(!window.WebGLRenderingContext)return xZ(e,SMe),null;const r=rL(e,t,i);return C(r)&&xZ(e,EMe),r}function rL(e,t,i={}){const r=t===xi.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=e.getContext(n,i)}catch{}if(s)break}return s}function xZ(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(xi||(xi={}));const SMe='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',EMe=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`;var ki,Dt,Me,og,wt,qa,ES,ut,Ji,tr,Je,bt,pt,ze,mt,Ct,la,mi,Mc,cn,Gr,_i;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(ki||(ki={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Dt||(Dt={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Me||(Me={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(og||(og={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(wt||(wt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(qa||(qa={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(ES||(ES={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(ut||(ut={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(Ji||(Ji={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(tr||(tr={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Je||(Je={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(bt||(bt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(pt||(pt={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ze||(ze={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(mt||(mt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Ct||(Ct={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(la||(la={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(mi||(mi={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(Mc||(Mc={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(cn||(cn={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(Gr||(Gr={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(_i||(_i={}));const nU=33984;var en,_c;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(en||(en={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(_c||(_c={}));const TZ=33306;var kr,ia,SZ,EZ,sL,kV,AZ;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(kr||(kr={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(ia||(ia={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(SZ||(SZ={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(EZ||(EZ={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(sL||(sL={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(kV||(kV={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(AZ||(AZ={}));const iE=pe.getLogger("esri.layers.VoxelWasmPerScene");var ji;(function(e){e[e.Lifetime=1]="Lifetime",e[e.RequestResponse=2]="RequestResponse",e[e.Rendering=3]="Rendering",e[e.Error=4]="Error"})(ji||(ji={}));class AMe{constructor(t){this._halfIntTexturesAvailable=!1,this._havePreparedWithAllLayers=!1,this._renderPluginContext=null,this._vxl=null,this._pluginIsActive=!1,this._moreToLoad=!1,this._viewportWidth=-1,this._viewportHeight=-1,this._newLayers=[],this._layers=new Map,this._renderPass=Ue.MATERIAL,this._renderSlot=we.VOXEL,this._rctx=null,this._renderTargetToRestore=null,this._lastFrameWasStationary=!1,this._wasmMemBlockSizes=[512,1024,2048,4096,8192,16384,32768,65536],this._wasmMemBlocks=new Map,this._dbgFlags=new Set,this._view=t,this._initialize()}get canRender(){return!!this._vxl&&this._view.viewingMode==="local"}_dbg(t,i){this._dbgFlags.has(t)&&(t===ji.Error?iE.error(i):iE.warn(i))}_removeRenderPlugin(){this._pluginIsActive&&this._view._stage&&(this._dbg(ji.Lifetime,"--removeRenderPlugin--"),this._view._stage.removeRenderPlugin(this)),this._pluginIsActive=!1}_initialize(){this._dbg(ji.Lifetime,"--initialize--");for(const t of this._wasmMemBlockSizes)this._wasmMemBlocks.set(t,0);this._readyWatchHandle=xe(()=>this._view.ready,t=>{t&&this._view.viewingMode==="local"?(this._dbg(ji.Lifetime,"view ready status changed to ready on a local view, calling addRenderPlugin"),this._view._stage.addRenderPlugin([this._renderSlot],this),this._pluginIsActive=!0):(this._dbg(ji.Lifetime,"view ready status changed, not ready or not a local view!"),this._removeRenderPlugin())},{initial:!0}),this._qualityWatchHandle=xe(()=>{var t;return(t=this._view)==null?void 0:t.qualityProfile},t=>{this._dbg(ji.Rendering,"qualityProfile changed to "+t),this._vxl&&this._vxl.set_quality(this._toWasmQuality(t))},{initial:!0}),this._timeExtentWatchHandle=xe(()=>{var t;return(t=this._view)==null?void 0:t.timeExtent},()=>{if(this._vxl){var t;const i=this._getTimeArgs((t=this._view)==null?void 0:t.timeExtent);this._dbg(ji.Rendering,"sceneView timeExtent changed to useTime="+i.useTime+" st="+i.startTime+" et="+i.endTime),this._vxl.set_scene_time_extent(i.startTime,i.endTime,i.useTime),this._renderPluginContext.requestRender()}},{initial:!0}),this._stationaryWatchHandle=xe(()=>{var t;return(t=this._view)==null?void 0:t.stationary},t=>{this._vxl&&t&&!this._lastFrameWasStationary&&this._renderPluginContext.requestRender()})}initializeRenderContext(t){this._dbg(ji.Lifetime,"--initializeRenderContext--");const i=t.renderContext.rctx;i.type===xi.WEBGL2?(this._renderPluginContext=t,this._rctx=t.renderContext.rctx,this._halfIntTexturesAvailable=!!this._rctx.capabilities.textureNorm16,this._initializeWasm(i.gl)):this._dbg(ji.Error,"WebGL 1 context only!")}uninitializeRenderContext(){this._renderPluginContext=null,this._rctx=null,this._dbg(ji.Lifetime,"--uninitializeRenderContext--")}_restoreFramebuffer(){if(!this._renderTargetToRestore)return;const t=this._renderTargetToRestore.fbo;if(!this._rctx)return void this._dbg(ji.Error,"no context in restoreFramebuffer!");this._rctx.bindFramebuffer(t,!0);const i=this._renderTargetToRestore.viewport;this._rctx.setViewport(i.x,i.y,i.width,i.height)}_bindPreviousDepthToSlot(t,i){const r=!!this._rctx,s=!!this._renderTargetToRestore;if(!r||!s)return 0;const n=this._renderTargetToRestore.fbo.depthStencilTexture;return n?(i===0?this._rctx.bindTexture(null,t,!0):this._rctx.bindTexture(n,t,!0),1):(this._dbg(ji.Error,"no depth/stencil texture exists!"),0)}_modifyResourceCount(t,i,r){if(!this._rctx)return void this._dbg(ji.Error,"modifyAllocation callback has no rendering context!");const s=t;r===1?this._rctx.instanceCounter.increment(s,i):this._rctx.instanceCounter.decrement(s,i)}_setBlendState(t,i,r,s){this._rctx?(this._rctx.setBlendingEnabled(t===1),this._rctx.setBlendFunction(i,r),this._rctx.setBlendEquation(s)):this._dbg(ji.Error,"setBlendState callback has no rendering context!")}_setFrontFace(t){this._rctx?this._rctx.setFrontFace(t):this._dbg(ji.Error,"setFrontFace callback has no rendering context!")}_setDepthStencilStateFunction(t,i,r){this._rctx?(this._rctx.setDepthFunction(r),this._rctx.setDepthTestEnabled(t===1),this._rctx.setDepthWriteEnabled(i===1),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(Ji.ALWAYS,0,255),this._rctx.setStencilOpSeparate(qa.FRONT,tr.KEEP,tr.INCR,tr.KEEP),this._rctx.setStencilOpSeparate(qa.BACK,tr.KEEP,tr.DECR,tr.KEEP)):this._dbg(ji.Error,"setDepthStencilStateFunction callback has no rendering context!")}_setRasterizerState(t){if(this._rctx)switch(t){case LC.None:this._rctx.setFaceCullingEnabled(!1);break;case LC.Back:this._rctx.setCullFace(qa.BACK),this._rctx.setFaceCullingEnabled(!0);break;case LC.Front:this._rctx.setCullFace(qa.FRONT),this._rctx.setFaceCullingEnabled(!0)}else this._dbg(ji.Error,"setRasterizerState callback has no rendering context!")}_setViewport(t,i,r,s){this._rctx?this._rctx.setViewport(t,i,r,s):this._dbg(ji.Error,"setViewport callback has no rendering context!")}_updateMemoryUsage(){this._layers.forEach((t,i)=>{if(t.needMemoryUsageUpdate){const r=this._vxl.estimate_memory_usage(i);r>=0&&(t.needMemoryUsageUpdate=!1,t.layerView.setUsedMemory(r))}})}_syncRequestsResponses(){this._layers.forEach((t,i)=>{const r=[];t.responses.forEach((a,l)=>{r.push(l),this._dbg(ji.RequestResponse,"responding for requestID:"+l+" size:"+a.size),this._vxl.respond(i,l,a),a.requestType!==iL.TreeIndex&&a.requestType!==iL.Section||(t.needMemoryUsageUpdate=!0)});const s=t.responses;for(const a of r)s.delete(a);const n=this._vxl.get_new_requests(i),o=t.abortController.signal;for(const a in n){t.outstandingRequestCount+=1,t.outstandingRequestCount===1&&t.layerView.updatingFlagChanged();const l=n[a],c={responseType:"array-buffer",signal:o};this._dbg(ji.RequestResponse,"making requestID:"+a+" url:"+l.url),Pi(l.url,c).then(h=>{t.outstandingRequestCount-=1,t.outstandingRequestCount===0&&t.layerView.updatingFlagChanged(),this._dbg(ji.RequestResponse,"have response for requestID:"+a);let p=0;if(h.data.byteLength>0){p=this._vxl._malloc(h.data.byteLength);const f=new Uint8Array(this._vxl.HEAPU8.buffer,p,h.data.byteLength),g=new Uint8Array(h.data);for(let y=0;y<h.data.byteLength;++y)f[y]=g[y]}s.set(+a,{responseType:l.responseType,ptr:p,size:h.data.byteLength,success:!0,requestType:l.requestType})}).catch(h=>{t.outstandingRequestCount-=1,t.outstandingRequestCount===0&&t.layerView.updatingFlagChanged(),Tr(h)||(this._dbg(ji.Error,`requestID:${a} failed, error=${h.toString()}`),s.set(+a,{responseType:l.responseType,ptr:0,size:0,success:!1,requestType:l.requestType}))})}})}updateWasmCamera(t){this._vxl.set_projection_matrix.apply(this._vxl,t.projectionMatrix),this._vxl.set_view_matrix.apply(this._vxl,t.viewMatrix),this._vxl.set_near_far(t.near,t.far)}isUpdating(t){return!(this._vxl||!this._vxlPromise)||!!this._layers.has(t)&&this._layers.get(t).outstandingRequestCount>0}setEnabled(t,i){this._layers.forEach((r,s)=>{r.layerView===t&&(this._vxl.set_enabled(s,i),this._renderPluginContext.requestRender())})}setSlices(t,i){const r={mask:r1.Slices,slices:{planes:i,currentEditPlane:-1}};return this._doMaskedUIUpdate(t,r,!0)}setDynamicSections(t,i){const r={mask:r1.DynamicSections,dynamicSections:{planes:i,currentEditPlane:-1}};return this._doMaskedUIUpdate(t,r,!0)}setStaticSections(t,i){const r={mask:r1.StaticSections,staticSections:i};return this._doMaskedUIUpdate(t,r,!0)}setCurrentVariable(t,i){const r={mask:r1.CurrentVariable,currentVariable:i};return this._doMaskedUIUpdate(t,r,!0)}setRenderMode(t,i){const r={mask:r1.RenderMode,renderMode:i};return this._doMaskedUIUpdate(t,r,!0)}_doMaskedUIUpdate(t,i,r){if(!this._vxl)return!1;let s=!1;return this._layers.forEach((n,o)=>{if(n.layerView===t){const a={str:JSON.stringify(i),byteCount:0,ptr:0,isReusable:!1};this._allocateBlock(a)&&(s=this._vxl.handle_masked_ui_update(o,a.ptr,a.byteCount)===1,a.isReusable||this._vxl._free(a.ptr))}}),s&&r&&this._renderPluginContext.requestRender(),s}addVoxelLayer(t){if(!this._vxl){const r={layerView:t,resolveCallback:null,rejectCallback:null},s=new Promise((n,o)=>{r.resolveCallback=n,r.rejectCallback=o});return this._newLayers.push(r),s}const i=this._addVoxelLayer(t);return i<0?Promise.reject(-1):Promise.resolve(i)}removeVoxelLayer(t){if(!this._vxl){const s=this._newLayers.findIndex(o=>t===o.layerView);s>=0&&(this._newLayers[s].resolveCallback(-1),this._newLayers.splice(s,1));const n=this._newLayers.length;return n===0&&(this._dbg(ji.Lifetime," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),n}let i=-1;this._layers.forEach((s,n)=>{s.layerView===t&&(i=n,s.abortController.abort(),this._vxl.remove_layer(i))}),i>=0&&this._layers.delete(i);const r=this._layers.size;return r===0&&(this._dbg(ji.Lifetime," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),r}_getBlockSize(t){for(const i of this._wasmMemBlockSizes)if(t<i)return i;return-1}_allocateBlock(t){t.byteCount=this._vxl.lengthBytesUTF8(t.str)+1;const i=this._getBlockSize(t.byteCount);return i<0?(t.isReusable=!1,t.ptr=this._vxl._malloc(t.byteCount)):(t.isReusable=!0,t.ptr=this._wasmMemBlocks.get(i),t.ptr===0&&(t.ptr=this._vxl._malloc(i),this._wasmMemBlocks.set(i,t.ptr))),t.ptr!==0&&(this._vxl.stringToUTF8(t.str,t.ptr,t.byteCount),!0)}_getTimeArgs(t){let i=-Number.MAX_VALUE,r=Number.MAX_VALUE,s=!1;return _(t)&&(t.isAllTime?s=!0:(_(t.start)&&(s=!0,i=t.start.getTime()/1e3),_(t.end)&&(s=!0,r=t.end.getTime()/1e3))),{startTime:i,endTime:r,useTime:s}}_addVoxelLayer(t){var i;const r=t.layer;let s=-1;const n=r.getConfiguration();if(n.length<1)return-1;const o={str:n,byteCount:0,ptr:0,isReusable:!1};if(!this._allocateBlock(o))return-1;const a=this._getTimeArgs((i=this._view)==null?void 0:i.timeExtent),l=this._view.spatialReference.isWGS84&&r.spatialReference.isWGS84?111319.49079327357:1;if(s=this._vxl.add_layer(r.serviceRoot,o.ptr,o.byteCount,l,l,a.startTime,a.endTime,a.useTime,this._toWasmQuality(this._view.qualityProfile)),o.isReusable||this._vxl._free(o.ptr),s>=0){const c=new AbortController;if(this._layers.set(s,{layerView:t,responses:new Map,outstandingRequestCount:0,abortController:c,needMemoryUsageUpdate:!1}),!this._halfIntTexturesAvailable||ue("mac")){const h=[];let p="";for(const f of t.layer.variables)f.renderingFormat.type!=="Int16"&&f.renderingFormat.type!=="UInt16"||(h.push(f.name),f.id===t.layer.style.currentVariableId&&(p=f.name));p!==""&&iE.error("#addVoxelLayer_error()",t.layer,`The voxel layer '${t.layer.title}' cannot render the current variable '${p}' in this browser`),h.length>0&&iE.warn("#addVoxelLayer_warning()",t.layer,`The voxel layer '${t.layer.title}' cannot render the variables '${h.toString()}' in this browser`)}return ue("esri-mobile")&&iE.warnOnce("Mobile support differs across devices. Voxel layer might not display as expected."),s}return-1}prepareRender(t){if(!this._vxl)return;const i=t.viewForward,r=t.eye;this._vxl.update_camera_pos_and_direction(r[0],r[1],r[2],i[0],i[1],i[2]);const s=this._vxl.cull();this._dbg(ji.RequestResponse,"missingResourceCount="+s),this._moreToLoad=s>0,this._havePreparedWithAllLayers=this._newLayers.length===0,this._updateMemoryUsage()}render(t){if(!this._vxl||t.pass!==this._renderPass||t.bindParameters.slot!==this._renderSlot)return;for(const r of this._newLayers){const s=this._addVoxelLayer(r.layerView);s===-1?r.rejectCallback(-1):r.resolveCallback(s)}if(this._newLayers=[],this._layers.size===0)return void this._dbg(ji.Error,"No voxel layers but RenderPlugin instance is being asked to render!");this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()},this._syncRequestsResponses(),this._lastFrameWasStationary=this._view.stationary,this._rctx.setPolygonOffsetFillEnabled(!1),this._rctx.setScissorTestEnabled(!1),this._rctx.setColorMask(!0,!0,!0,!0),this._vxl.begin_color_frame(!this._view.stationary||this._moreToLoad,t.bindParameters.lighting.lightingMainDirection[0],t.bindParameters.lighting.lightingMainDirection[1],t.bindParameters.lighting.lightingMainDirection[2]);const i=this._renderTargetToRestore.viewport;i.width===this._viewportWidth&&i.height===this._viewportHeight||(this._viewportWidth=i.width,this._viewportHeight=i.height,this._vxl.set_viewport(i.width,i.height),this._layers.forEach(r=>{r.needMemoryUsageUpdate=!0})),i.x===0&&i.y===0||this._dbg(ji.Error,"Unsupported viewport parameters detected!"),this.updateWasmCamera(t.bindParameters.camera),this._vxl.draw(),this._renderTargetToRestore.fbo=null,t.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),t.rctx.externalVertexArrayObjectUpdate(),t.rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),(this._moreToLoad||!this._havePreparedWithAllLayers&&this._layers.size>0)&&this._renderPluginContext.requestRender()}destroy(){this._dbg(ji.Lifetime,"--destroy--"),this._removeRenderPlugin(),this._readyWatchHandle=mn(this._readyWatchHandle),this._qualityWatchHandle=mn(this._qualityWatchHandle),this._timeExtentWatchHandle=mn(this._timeExtentWatchHandle),this._stationaryWatchHandle=mn(this._stationaryWatchHandle),this._vxl&&(this._layers.forEach(t=>{t.abortController.abort()}),this._wasmMemBlocks.forEach(t=>{t!==0&&this._vxl._free(t)}),this._vxl.uninitialize_voxel_wasm(),this._vxl=null)}_initializeWasm(t){return this._vxl?Promise.resolve():(this._vxlPromise||(this._vxlPromise=bMe(t).then(i=>{var r;if(this._vxl=i,this._vxlPromise=null,this._newLayers.length<=0)return this._dbg(ji.Lifetime," no voxel layers left after WASM downloaded, removing RenderPlugin and destroying"),void this.destroy();const s=this._getTimeArgs((r=this._view)==null?void 0:r.timeExtent),n=this._vxl.addFunction(this._restoreFramebuffer.bind(this),"v"),o=this._vxl.addFunction(this._setBlendState.bind(this),"viiii"),a=this._vxl.addFunction(this._setFrontFace.bind(this),"vi"),l=this._vxl.addFunction(this._setRasterizerState.bind(this),"vi"),c=this._vxl.addFunction(this._setDepthStencilStateFunction.bind(this),"viii"),h=this._vxl.addFunction(this._setViewport.bind(this),"viiii"),p=this._vxl.addFunction(this._bindPreviousDepthToSlot.bind(this),"iii"),f=this._vxl.addFunction(this._modifyResourceCount.bind(this),"viii"),g=this._halfIntTexturesAvailable&&!ue("mac");this._vxl.initialize_voxel_wasm(n,o,a,l,c,h,p,f,s.startTime,s.endTime,s.useTime,g),this._renderPluginContext&&this._renderPluginContext.requestRender()}).catch(()=>{for(const i of this._newLayers)i.rejectCallback(-2);this._dbg(ji.Error," WASM failed to download, removing RenderPlugin and destroying"),this.destroy()})),this._vxlPromise)}pickDepth(t,i,r){if(!this._vxl||!this._rctx||this._layers.size===0)return null;const s=r.viewport[3]-i;if(t<0||t>r.viewport[2]||i<0||i>r.viewport[3])return this._dbg(ji.Error,`pickDepth: outOfRange, screenXY=[${t}, ${s}], vp=[${r.viewport.toString()}]`),null;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};const n=r.viewForward,o=r.eye;this._vxl.update_camera_pos_and_direction(o[0],o[1],o[2],n[0],n[1],n[2]),this.updateWasmCamera(r),this._vxl.begin_frame();const a=this._vxl.pick_depth(t,s);return this._renderTargetToRestore.fbo=null,this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),this._rctx.externalVertexArrayObjectUpdate(),this._rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),a.success?a.distanceToCamera:null}_toWasmQuality(t){switch(t){case"low":return 0;case"medium":return 1;case"high":return 2}}}class iT{constructor(){this.view2WASM=new Map}static getInstance(){return iT.instance||(iT.instance=new iT),iT.instance}getVoxelWasmPerSceneView(t){return this.view2WASM.has(t)?this.view2WASM.get(t):null}isUpdating(t,i){return!!this.view2WASM.has(t)&&this.view2WASM.get(t).isUpdating(i)}addLayer(t,i){return this.view2WASM.has(t)||this.view2WASM.set(t,new AMe(t)),this.view2WASM.get(t).addVoxelLayer(i)}removeLayer(t,i){this.view2WASM.has(t)&&this.view2WASM.get(t).removeVoxelLayer(i)<1&&this.view2WASM.delete(t)}setLayerEnabled(t,i,r){this.view2WASM.has(t)&&this.view2WASM.get(t).setEnabled(i,r)}setLayerSlices(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(o=>o.type==="voxel-3d").forEach(o=>{o.layer===t&&(r=s.setSlices(o,i))})}),r}setLayerDynamicSections(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(o=>o.type==="voxel-3d").forEach(o=>{o.layer===t&&(r=s.setDynamicSections(o,i))})}),r}setLayerCurrentVariable(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(o=>o.type==="voxel-3d").forEach(o=>{o.layer===t&&(r=s.setCurrentVariable(o,i))})}),r}setLayerRenderMode(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(o=>o.type==="voxel-3d").forEach(o=>{o.layer===t&&(r=s.setRenderMode(o,i))})}),r}setLayerStaticSections(t,i){let r=!1;return this.view2WASM.forEach((s,n)=>{n.allLayerViews.filter(o=>o.type==="voxel-3d").forEach(o=>{o.layer===t&&(r=s.setStaticSections(o,i))})}),r}}function NC(e){return e&&e.type==="base-tile"||e.type==="tile"||e.type==="elevation"||e.type==="imagery-tile"||e.type==="base-elevation"||e.type==="open-street-map"||e.type==="wcs"||e.type==="web-tile"||e.type==="wmts"||e.type==="vector-tile"}function CZ(e){return(e==null?void 0:e.type)==="voxel"}function RZ(e){return(e==null?void 0:e.type)==="imagery-tile"}function bhe(e){return e.parent&&e.parent.declaredClass==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function BV(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function CMe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}const RMe=pe.getLogger("esri.support.AnalysesCollection");let AS=class extends PC{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{C(t.item)||t.item.parent===this.owner&&(RMe.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};AS=u([P("esri.support.AnalysesCollection")],AS);const e$={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},oU={xsmall:544,small:768,medium:992,large:1200};function OMe(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function aU(e,t){return t?e$[e].valueToClassName[t].split(" "):[]}const MMe=e=>{let t=class extends e{constructor(...i){super(...i),this._breakpointsHandles=new Jt,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=oU}initialize(){this._breakpointsHandles.add(xe(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Bi))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=ct(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=OMe(i);if(!r){const s=JSON.stringify(oU,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:oU,this._set("breakpoints",L({},i))}_updateClassNames(){if(!this.container)return;const i=Dl.acquire(),r=Dl.acquire();let s,n=!1;for(s in e$){const o=this[s],a=e$[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,aU(s,o).forEach(l=>r.push(l)),aU(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),Dl.release(i),Dl.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in e$)aU(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([P("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v2.10.0 - Tue Mar 15 2022 16:38:25 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var PMe="[object Object]";function IMe(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function $Me(e,t){return function(i){return e(t(i))}}var DMe=Function.prototype,whe=Object.prototype,xhe=DMe.toString,LMe=whe.hasOwnProperty,NMe=xhe.call(Object),FMe=whe.toString,UMe=$Me(Object.getPrototypeOf,Object);function zMe(e){return!!e&&typeof e=="object"}function kMe(e){if(!zMe(e)||FMe.call(e)!=PMe||IMe(e))return!1;var t=UMe(e);if(t===null)return!0;var i=LMe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&xhe.call(i)==NMe}var BMe=kMe,s1={exports:{}},Ms={},CR={exports:{}},Yb={};function The(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function VMe(e,t,i){}function GMe(e,t,i){}var jMe=/javascript\s*\:/img;function HMe(e,t){return jMe.test(t)?"":t}Yb.whiteList=The();Yb.getDefaultWhiteList=The;Yb.onAttr=VMe;Yb.onIgnoreAttr=GMe;Yb.safeAttrValue=HMe;var qMe={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},rE=qMe;function WMe(e,t){e=rE.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=rE.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=rE.trim(h.slice(0,p)),g=rE.trim(h.slice(p+1));if(f){var y=t(s,o.length,f,g,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return rE.trim(o)}var XMe=WMe,KM=Yb,YMe=XMe;function OZ(e){return e==null}function ZMe(e){var t={};for(var i in e)t[i]=e[i];return t}function She(e){e=ZMe(e||{}),e.whiteList=e.whiteList||KM.whiteList,e.onAttr=e.onAttr||KM.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||KM.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||KM.safeAttrValue,this.options=e}She.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=YMe(e,function(l,c,h,p,f){var g=r[h],y=!1;if(g===!0?y=g:typeof g=="function"?y=g(p):g instanceof RegExp&&(y=g.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var v={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var b=s(h,p,v);return OZ(b)?h+":"+p:b}else{var b=n(h,p,v);if(!OZ(b))return b}}});return a};var QMe=She;(function(e,t){var i=Yb,r=QMe;function s(o,a){var l=new r(a);return l.process(o)}t=e.exports=s,t.FilterCSS=r;for(var n in i)t[n]=i[n]})(CR,CR.exports);var rH={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},JMe=CR.exports.FilterCSS,KMe=CR.exports.getDefaultWhiteList,nL=rH;function Ehe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Ahe=new JMe;function ePe(e,t,i){}function tPe(e,t,i){}function iPe(e,t,i){}function rPe(e,t,i){}function Che(e){return e.replace(nPe,"&lt;").replace(oPe,"&gt;")}function sPe(e,t,i,r){if(i=$he(i),t==="href"||t==="src"){if(i=nL.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(eP.lastIndex=0,eP.test(i))return""}else if(t==="style"){if(MZ.lastIndex=0,MZ.test(i)||(PZ.lastIndex=0,PZ.test(i)&&(eP.lastIndex=0,eP.test(i))))return"";r!==!1&&(r=r||Ahe,i=r.process(i))}return i=Dhe(i),i}var nPe=/</g,oPe=/>/g,aPe=/"/g,lPe=/&quot;/g,cPe=/&#([a-zA-Z0-9]*);?/gim,uPe=/&colon;?/gim,hPe=/&newline;?/gim,eP=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,MZ=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,PZ=/u\s*r\s*l\s*\(.*/gi;function Rhe(e){return e.replace(aPe,"&quot;")}function Ohe(e){return e.replace(lPe,'"')}function Mhe(e){return e.replace(cPe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function Phe(e){return e.replace(uPe,":").replace(hPe," ")}function Ihe(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return nL.trim(t)}function $he(e){return e=Ohe(e),e=Mhe(e),e=Phe(e),e=Ihe(e),e}function Dhe(e){return e=Rhe(e),e=Che(e),e}function dPe(){return""}function pPe(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(o){return i?!0:nL.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return nL.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function fPe(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function mPe(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}Ms.whiteList=Ehe();Ms.getDefaultWhiteList=Ehe;Ms.onTag=ePe;Ms.onIgnoreTag=tPe;Ms.onTagAttr=iPe;Ms.onIgnoreTagAttr=rPe;Ms.safeAttrValue=sPe;Ms.escapeHtml=Che;Ms.escapeQuote=Rhe;Ms.unescapeQuote=Ohe;Ms.escapeHtmlEntities=Mhe;Ms.escapeDangerHtml5Entities=Phe;Ms.clearNonPrintableCharacter=Ihe;Ms.friendlyAttrValue=$he;Ms.escapeAttrValue=Dhe;Ms.onIgnoreTagStripAll=dPe;Ms.StripTagBody=pPe;Ms.stripCommentTag=fPe;Ms.stripBlankChar=mPe;Ms.cssFilter=Ahe;Ms.getDefaultCSSWhiteList=KMe;var AF={},Uy=rH;function gPe(e){var t=Uy.spaceIndex(e);if(t===-1)var i=e.slice(1,-1);else var i=e.slice(1,t+1);return i=Uy.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function yPe(e){return e.slice(0,2)==="</"}function vPe(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){r+=i(e.slice(s,a)),n=a,s=a;continue}if(p===">"){r+=i(e.slice(s,n)),h=e.slice(n,a+1),c=gPe(h),r+=t(n,r.length,c,h,yPe(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,g=e.charAt(a-f);g.trim()===""||g==="=";){if(g==="="){o=p;continue e}g=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var _Pe=/[^a-zA-Z0-9_:\.\-]/gim;function bPe(e,t){var i=0,r=[],s=!1,n=e.length;function o(p,f){if(p=Uy.trim(p),p=p.replace(_Pe,"").toLowerCase(),!(p.length<1)){var g=t(p,f||"");g&&r.push(g)}}for(var a=0;a<n;a++){var l=e.charAt(a),c,h;if(s===!1&&l==="="){s=e.slice(i,a),i=a+1;continue}if(s!==!1&&a===i&&(l==='"'||l==="'")&&e.charAt(a-1)==="="){if(h=e.indexOf(l,a+1),h===-1)break;c=Uy.trim(e.slice(i+1,h)),o(s,c),s=!1,a=h,i=a+1;continue}if(/\s|\n|\t/.test(l))if(e=e.replace(/\s|\n|\t/g," "),s===!1)if(h=wPe(e,a),h===-1){c=Uy.trim(e.slice(i,a)),o(c),s=!1,i=a+1;continue}else{a=h-1;continue}else if(h=xPe(e,a-1),h===-1){c=Uy.trim(e.slice(i,a)),c=IZ(c),o(s,c),s=!1,i=a+1;continue}else continue}return i<e.length&&(s===!1?o(e.slice(i)):o(s,IZ(Uy.trim(e.slice(i))))),Uy.trim(r.join(" "))}function wPe(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function xPe(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function TPe(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function IZ(e){return TPe(e)?e.substr(1,e.length-2):e}AF.parseTag=vPe;AF.parseAttr=bPe;var SPe=CR.exports.FilterCSS,Jh=Ms,Lhe=AF,EPe=Lhe.parseTag,APe=Lhe.parseAttr,t$=rH;function tP(e){return e==null}function CPe(e){var t=t$.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=t$.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=t$.trim(e.slice(0,-1))),{html:e,closing:i}}function RPe(e){var t={};for(var i in e)t[i]=e[i];return t}function Nhe(e){e=RPe(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Jh.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||Jh.whiteList,e.onTag=e.onTag||Jh.onTag,e.onTagAttr=e.onTagAttr||Jh.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Jh.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Jh.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Jh.safeAttrValue,e.escapeHtml=e.escapeHtml||Jh.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new SPe(e.css))}Nhe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=t.cssFilter;i.stripBlankChar&&(e=Jh.stripBlankChar(e)),i.allowCommentTag||(e=Jh.stripCommentTag(e));var p=!1;if(i.stripIgnoreTagBody){var p=Jh.StripTagBody(i.stripIgnoreTagBody,n);n=p.onIgnoreTag}var f=EPe(e,function(g,y,v,b,w){var S={sourcePosition:g,position:y,isClosing:w,isWhite:r.hasOwnProperty(v)},x=s(v,b,S);if(!tP(x))return x;if(S.isWhite){if(S.isClosing)return"</"+v+">";var E=CPe(b),R=r[v],O=APe(E.html,function(U,N){var V=t$.indexOf(R,U)!==-1,j=o(v,U,N,V);if(!tP(j))return j;if(V)return N=l(v,U,N,h),N?U+'="'+N+'"':U;var j=a(v,U,N,V);return tP(j)?void 0:j}),b="<"+v;return O&&(b+=" "+O),E.closing&&(b+=" /"),b+=">",b}else{var x=n(v,b,S);return tP(x)?c(b):x}},c);return p&&(f=p.remove(f)),f};var OPe=Nhe;(function(e,t){var i=Ms,r=AF,s=OPe;function n(l,c){var h=new s(c);return h.process(l)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s;for(var o in i)t[o]=i[o];for(var o in r)t[o]=r[o];function a(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=e.exports)})(s1,s1.exports);var MPe=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):s1.exports.safeAttrValue(n,o,a,l)}};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new s1.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t,i){var r=(i!=null?i:{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?s1.exports.escapeAttrValue(t):!n&&!s?s1.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):s1.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(BMe(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof t=="undefined"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const CF=new Map;function Fhe(){CF.clear()}function PPe(e){return CF.get(e)}function IPe(e,t){CF.set(e,t)}function lU(e){CF.delete(e)}var pb,CS,$Pe=function(e){if("WebkitTransition"in e.style)pb="webkitTransitionEnd",CS="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");pb="transitionend",CS="animationend"}},Uhe=function(e){pb||$Pe(e)},DPe=function(e,t){return t===void 0&&(t=e+"-active"),function(i){Uhe(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(pb,s),i.removeEventListener(CS,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(pb,s),i.addEventListener(CS,s),requestAnimationFrame(function(){i.classList.add(t)})}},LPe=function(e,t){return t===void 0&&(t=e+"-active"),function(i,r){Uhe(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(pb,n),i.removeEventListener(CS,n),r())};i.classList.add(e),i.addEventListener(pb,n),i.addEventListener(CS,n),requestAnimationFrame(function(){i.classList.add(t)})}};const NPe=pe.getLogger("esri.widgets.support.widgetUtils");function zhe(e){const t=Dl.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const i=t.join(" ");return Dl.release(t),i}(()=>{const e=new Map,t=new ResizeObserver(i=>{Fhe();for(const r of i)e.get(r.target)(r)});return(i,r,s)=>(e.has(i)&&NPe.error("Already observing element",i),e.set(i,r),t.observe(i,s),sh(()=>{t.unobserve(i),e.delete(i)}))})();function d0(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function $Z(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function VV(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function FPe(e,t){return(e==="enter"?DPe:LPe)(t)}const UPe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],zPe=UPe.reduce((e,t)=>(e[t]=[],e),{}),kPe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],khe=new MPe({whiteList:zPe,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(kPe.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function BPe(e){return e==="Enter"||e===" "}const Bhe="http://www.w3.org/",RF=`${Bhe}2000/svg`,Vhe=`${Bhe}1999/xlink`;let oL,DZ=[],sH=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},nH=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Ghe=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},VPe=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if(nH(e[r],t))return r}return-1},cU=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(nH(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},GPe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},GV=[],jV=!1,jhe=e=>{(e.children||[]).forEach(jhe),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},LZ=()=>{jV=!1,GV.forEach(jhe),GV.length=0},NZ=e=>{GV.push(e),jV||(jV=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(LZ,{timeout:16}):setTimeout(LZ,16))},FZ=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),NZ(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),NZ(e))},jPe=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")HV(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],g=l[f];g&&(Ghe(g),i.styleApplyer(e,f,g))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):i.namespace===RF?a==="href"?e.setAttributeNS(Vhe,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=khe.sanitize(l):e.setAttribute(a,l):e[a]=l}}},HPe=(e,t,i)=>{if(t)for(let r of t)rT(r,e,void 0,i)},Hhe=(e,t,i)=>{HPe(e,t.children,i),t.text&&(e.textContent=t.text),jPe(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},rT=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(r=sH(r,{namespace:RF})),r.namespace!==void 0?s=e.domNode=a.createElementNS(r.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=l+1}}Hhe(s,e,r)}},HV=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},qPe=(e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=t[l];if(l==="class")h!==c&&(HV(e,h,!1),HV(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),g=f.length;for(let y=0;y<g;y++){let v=f[y],b=!!c[v];b!==!!h[v]&&(s=!0,b?p.add(v):p.remove(v))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let g=0;g<f;g++){let y=p[g],v=c[y];v!==h[y]&&(s=!0,v?(Ghe(v),r.styleApplyer(e,y,v)):r.styleApplyer(e,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===RF?l==="href"?e.setAttributeNS(Vhe,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=khe.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},WPe=(e,t,i,r,s)=>{if(i===r)return!1;r=r||DZ;let n,o=(i=i||DZ).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&nH(p,f))h=oL(p,f,s)||h,l++;else{let g=VPe(i,f,l+1);if(g>=0){for(n=l;n<g;n++)FZ(i[n]),cU(i,n,e,"removed");h=oL(i[g],f,s)||h,l=g+1}else rT(f,t,l<o?i[l].domNode:void 0,s),GPe(f),cU(r,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)FZ(i[n]),cU(i,n,e,"removed");return h};oL=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(o,r),t.domNode=o,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=sH(i,{namespace:RF})),e.text!==t.text&&(n=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=WPe(t,r,e.children,t.children,i)||n,n=qPe(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let sE=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,oL(r,i,t)},domNode:e.domNode});const XPe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let mx=e=>sH(XPe,e),p0={create:(e,t)=>(t=mx(t),rT(e,document.createElement("div"),void 0,t),sE(e,t)),append:(e,t,i)=>(i=mx(i),rT(t,e,void 0,i),sE(t,i)),insertBefore:(e,t,i)=>(i=mx(i),rT(t,e.parentNode,e,i),sE(t,i)),merge:(e,t,i)=>(i=mx(i),t.domNode=e,Hhe(e,t,i),sE(t,i)),replace:(e,t,i)=>(i=mx(i),rT(t,e.parentNode,e,i),e.parentNode.removeChild(e),sE(t,i))},qhe,YPe=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};qhe=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let ZPe=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?qhe(i.children,s=>s.domNode===r):void 0}),i},QPe=(e,t,i)=>{let r=function(s){i("domEvent",s);let n=t(),o=YPe(s.currentTarget,n.domNode);o.reverse();let a,l=ZPe(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},UZ=e=>{let t,i,r=mx(e),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,g)=>{let y,v=()=>y;r.eventHandlerInterceptor=QPe(t,v,s),y=p(f,g(),r),a.push(y),l.push(g)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(p0.append,p,f)},insertBefore:(p,f)=>{c(p0.insertBefore,p,f)},merge:(p,f)=>{c(p0.merge,p,f)},replace:(p,f)=>{c(p0.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t},vy=class extends be{constructor(){super(...arguments),this.items=new St,this._watchUpdatingTracking=new jp,this._callbacks=new Map,this._projector=UZ(),this._hiddenProjector=UZ()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(const i of t.removed){const r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const o=r.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(i=>{t.save(),i.renderCanvas(t),t.restore()}),t.restore()}};u([d({readOnly:!0})],vy.prototype,"surface",void 0),u([d({readOnly:!0})],vy.prototype,"items",void 0),u([d({readOnly:!0})],vy.prototype,"needsRender",null),u([d({readOnly:!0})],vy.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],vy.prototype,"updating",void 0),vy=u([P("esri.views.overlay.ViewOverlay")],vy);const zZ=vy;function oH(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t!=null?t:null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}const JPe=/\?(\.|$)/g;function uo(e,t,i,r){const s=Array.isArray(t)?t:t.includes(",")?t.split(","):[t],n=Br(e,t,i,r);for(const o of s){const a=o.trim().replace(JPe,"$1"),l=e.get(a);i.call(e,l,l,a,e)}return n}function Br(e,t,i,r){return e.watch(t,i,r)}function KPe(e,t,i,r){return lH(e,t,t3e,i,r)}function e3e(e,t,i,r){return lH(e,t,i3e,i,r)}function qV(e,t,i,r){return lH(e,t,r3e,i,r)}function aH(e,t,i,r,s,n,o){const a={};function l(h){const p=a[h];p&&(n&&n(p.target,h,e,i),p.handle.remove(),delete a[h])}const c=uo(e,t,(h,p,f)=>{l(f),GN(h)&&(a[f]={handle:MO(h,i,r),target:h},s&&s(h,f,e,i))},o);return{remove(){c.remove();for(const h in a)l(h)}}}function lH(e,t,i,r,s){const n=e.watch(t,(o,a,l,c)=>{i&&!i(o)||r==null||r.call(e,o,a,l,c)},s);if(Array.isArray(t))for(const o of t){const a=e.get(o);i&&i(a)&&(r==null||r.call(e,a,a,t,e))}else{const o=e.get(t);i&&i(o)&&(r==null||r.call(e,o,o,t,e))}return n}function t3e(e){return!!e}function i3e(e){return e===!0}function r3e(e){return e===!1}const s3e="randomUUID"in crypto;function n3e(){if(s3e)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const o3e={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},a3e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},l3e=e=>L(L({},a3e),e),c3e=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},u3e=(e,t)=>e.find(t),kZ=(e,t,i=!1)=>{let r=e;return t.forEach((s,n)=>{var o;const a=(o=r)!=null&&o.children?u3e(r.children,l=>l.domNode===s):void 0;i&&!a&&n!==t.length-1||(r=a)}),r},h3e=e=>{let t;const i=L(L({},o3e),e),r=l3e(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,g,y)=>{let v;r.eventHandlerInterceptor=(w,S,x,E)=>function(R){let O;s("domEvent",R);const I=c3e(R.currentTarget,v.domNode),U=I.some(V=>{var j;return customElements.get(V==null||(j=V.tagName)==null?void 0:j.toLowerCase())});if(R.eventPhase===Event.CAPTURING_PHASE||!U)I.reverse(),O=kZ(v.getLastRender(),I);else{const V=R.composedPath(),j=V.slice(V.indexOf(R.currentTarget),V.indexOf(v.domNode)).filter(H=>H.getRootNode()===H.ownerDocument).reverse();O=kZ(v.getLastRender(),j,!0)}let N;return O&&(N=i.handleInterceptedEvent(t,O,this,R)),s("domEventProcessed",R),N},i.postProcessProjectionOptions==null||i.postProcessProjectionOptions(r);const b=y();v=f(g,b,r),l.push(v),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(v,b)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const g=c[f]();s("rendered",void 0),l[f].update(g),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,g)=>{h(p0.append,f,g)},insertBefore:(f,g)=>{h(p0.insertBefore,f,g)},merge:(f,g)=>{h(p0.merge,f,g)},replace:(f,g)=>{h(p0.replace,f,g)},detach:f=>{for(let g=0;g<c.length;g++)if(c[g]===f)return c.splice(g,1),l.splice(g,1)[0];throw new Error("renderFunction was not found")}},t},bi={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let gx,Whe,OF,Xhe=!1,aL=!1,cH=!1,wc=!1,BZ=null,WV=!1;const T2=typeof window!="undefined"?window:{};bi.cssVarShim&&T2.CSS;const vd=T2.document||{head:{}},yft=T2.HTMLElement||class{},No={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},lL=bi.shadowDomShim&&bi.shadowDom?(()=>(vd.head.attachShadow+"").indexOf("[native")>-1)():!0,d3e=(()=>{let e=!1;try{vd.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),p3e=e=>Promise.resolve(e),f3e=bi.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,Yhe=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=g3e(e,s),l=m3e(t,o),c=y3e(s);No.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>No.rel(a,n,l,c))})},m3e=(e,t)=>i=>{try{bi.lazyLoad||e.$hostElement$[t](i)}catch(r){VO(r)}},g3e=(e,t)=>t&4?vd:t&8?T2:t&16?vd.body:e,y3e=e=>d3e?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,VZ="http://www.w3.org/1999/xlink",fb=(e,t="")=>()=>{},GZ=new WeakMap,v3e=(e,t,i)=>{let r=hL.get(e);f3e&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,hL.set(e,r)},_3e=(e,t,i,r)=>{let s=Zhe(t,i),n=hL.get(s);if(e=e.nodeType===11?e:vd,n)if(typeof n=="string"){e=e.head||e;let o=GZ.get(e),a;o||GZ.set(e,o=new Set),o.has(s)||(a=vd.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},b3e=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=fb("attachStyles",t.$tagName$),n=_3e(lL&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},Zhe=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),w3e=e=>Q3e.map(t=>t(e)).find(t=>!!t),jZ={},x3e="http://www.w3.org/2000/svg",T3e="http://www.w3.org/1999/xhtml",S3e=e=>e!=null,uH=e=>(e=typeof e,e==="object"||e==="function"),Qhe=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!uH(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?cL(null,r):r),a=o)};if(c(i),t&&(bi.isDev&&e==="input"&&R3e(t),bi.vdomKey&&t.key&&(s=t.key),bi.slotRelocation&&t.name&&(n=t.name),bi.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(bi.isDev&&l.some(Jhe)&&Z3e(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),bi.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,A3e);const h=cL(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),bi.vdomKey&&(h.$key$=s),bi.slotRelocation&&(h.$name$=n),h},cL=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return bi.vdomAttribute&&(i.$attrs$=null),bi.vdomKey&&(i.$key$=null),bi.slotRelocation&&(i.$name$=null),i},E3e={},Jhe=e=>e&&e.$tag$===E3e,A3e={forEach:(e,t)=>e.map(HZ).forEach(t),map:(e,t)=>e.map(HZ).map(t).map(C3e)},HZ=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),C3e=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),Qhe(e.vtag,i,...e.vchildren||[])}const t=cL(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},R3e=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&lde('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},qZ=(e,t,i,r,s,n)=>{if(i!==r){let o=ZZ(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=WZ(i),h=WZ(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):ZZ(T2,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&No.rel(e,t,i,!1),r&&No.ael(e,t,r,!1);else{const l=uH(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(VZ,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(VZ,t,r):e.setAttribute(t,r))}}},O3e=/\s/,WZ=e=>e?e.split(O3e):[],Khe=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||jZ,o=t.$attrs$||jZ;for(r in n)r in o||qZ(s,r,n[r],void 0,i,t.$flags$);for(r in o)qZ(s,r,n[r],o[r],i,t.$flags$)},uL=(e,t,i,r)=>{let s=t.$children$[i],n=0,o,a,l;if(Xhe||(cH=!0,s.$tag$==="slot"&&(gx&&r.classList.add(gx+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=vd.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=vd.createTextNode("");else{if(wc||(wc=s.$tag$==="svg"),o=s.$elm$=vd.createElementNS(wc?x3e:T3e,s.$flags$&2?"slot-fb":s.$tag$),wc&&s.$tag$==="foreignObject"&&(wc=!1),Khe(null,s,wc),S3e(gx)&&o["s-si"]!==gx&&o.classList.add(o["s-si"]=gx),s.$children$)for(n=0;n<s.$children$.length;++n)a=uL(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?wc=!1:o.tagName==="foreignObject"&&(wc=!0)}return o["s-hn"]=OF,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=Whe,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&RR(e.$elm$,!1)),o},RR=(e,t)=>{No.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==OF&&s["s-ol"]&&(ide(s).insertBefore(s,hH(s)),s["s-ol"].remove(),s["s-ol"]=void 0,cH=!0),t&&RR(s,t)}No.$flags$&=-2},ede=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===OF&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=uL(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,hH(t))))},tde=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,nde(r),aL=!0,s["s-ol"]?s["s-ol"].remove():RR(s,!0),s.remove())},M3e=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],g=r[p],y,v;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(g==null)g=r[--p];else if(iP(c,f))yx(c,f),c=t[++s],f=r[++n];else if(iP(h,g))yx(h,g),h=t[--l],g=r[--p];else if(iP(c,g))(c.$tag$==="slot"||g.$tag$==="slot")&&RR(c.$elm$.parentNode,!1),yx(c,g),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],g=r[--p];else if(iP(h,f))(c.$tag$==="slot"||g.$tag$==="slot")&&RR(h.$elm$.parentNode,!1),yx(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(v=t[o],v.$tag$!==f.$tag$?y=uL(t&&t[n],i,o,e):(yx(v,f),t[o]=void 0,y=v.$elm$),f=r[++n]):(y=uL(t&&t[n],i,n,e),f=r[++n]),y&&ide(c.$elm$).insertBefore(y,hH(c.$elm$))}s>l?ede(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&tde(t,s,l)},iP=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,hH=e=>e&&e["s-ol"]||e,ide=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,yx=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(wc=n==="svg"?!0:n==="foreignObject"?!1:wc,n==="slot"||Khe(e,t,wc),r!==null&&s!==null?M3e(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),ede(i,null,t,s,0,s.length-1)):r!==null&&tde(r,0,r.length-1),wc&&n==="svg"&&(wc=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},rde=e=>{let t=e.childNodes,i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}rde(i)}},rd=[],sde=e=>{let t,i,r,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&(XZ(i,s)?(n=rd.find(h=>h.$nodeToRelocate$===i),aL=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:rd.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&rd.map(h=>{XZ(h.$nodeToRelocate$,i["s-sn"])&&(n=rd.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):rd.some(h=>h.$nodeToRelocate$===i)||rd.push({$nodeToRelocate$:i}));t.nodeType===1&&sde(t)}},XZ=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",nde=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(nde)},P3e=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||cL(null,null),n=Jhe(t)?t:Qhe(null,null,t);OF=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,gx=i["s-sc"],Whe=i["s-cr"],Xhe=lL&&(r.$flags$&1)!==0,aL=!1,yx(s,n);{if(No.$flags$|=1,cH){sde(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<rd.length;f++)o=rd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=vd.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<rd.length;f++)if(o=rd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}aL&&rde(n.$elm$),No.$flags$&=-2,rd.length=0}},I3e=e=>bi.lazyLoad?S2(e).$hostElement$:e,vft=(e,t,i)=>{const r=I3e(e);return{emit:s=>(bi.isDev&&!r.isConnected&&lde(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),$3e(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s}))}},$3e=(e,t,i)=>{const r=No.ce(t,i);return e.dispatchEvent(r),r},D3e=(e,t)=>{},dH=(e,t)=>(e.$flags$|=16,D3e(e,e.$ancestorComponent$),eIe(()=>L3e(e,t))),L3e=(e,t)=>{const i=e.$hostElement$,r=fb("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=PT(s,"componentWillLoad"):n=PT(s,"componentWillUpdate"),n=YZ(n,()=>PT(s,"componentWillRender")),r(),YZ(n,()=>N3e(e,s,t))},N3e=async(e,t,i)=>{const r=e.$hostElement$,s=fb("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&b3e(e);const n=fb("render",e.$cmpMeta$.$tagName$);F3e(e,t,r),n(),s(),U3e(e)},F3e=(e,t,i)=>{try{BZ=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(bi.hasRenderFn||bi.reflect)&&(bi.vdomRender||bi.reflect)&&(bi.hydrateServerSide||P3e(e,t))}catch(a){VO(a,e.$hostElement$)}return BZ=null,null},U3e=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=fb("postUpdate",t),s=i;e.$ancestorComponent$,PT(s,"componentDidRender"),e.$flags$&64?(PT(s,"componentDidUpdate"),r()):(e.$flags$|=64,PT(s,"componentDidLoad"),r())},_ft=e=>{if(bi.updatable){const t=S2(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&dH(t,!1),i}return!1},PT=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){VO(r)}},YZ=(e,t)=>e&&e.then?e.then(t):t(),z3e=(e,t)=>e!=null&&!uH(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,k3e=(e,t)=>S2(e).$instanceValues$.get(t),B3e=(e,t,i,r)=>{const s=S2(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=z3e(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(f=>{try{l[f](i,o,t)}catch(g){VO(g,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;dH(s,!1)}}}},V3e=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return k3e(this,n)},set(a){B3e(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){No.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},G3e=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=w3e(e)]);const a=Zhe(i,t.$modeName$);if(!hL.has(a)){const l=fb("registerStyles",i.$tagName$);v3e(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>dH(t,!0))()},j3e=e=>{},H3e=e=>{if((No.$flags$&1)===0){const t=S2(e),i=t.$cmpMeta$,r=fb("connectedCallback",i.$tagName$);t.$flags$&1?(Yhe(e,t,i.$listeners$),j3e(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&q3e(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),G3e(e,t,i)),r()}},q3e=e=>{const t=e["s-cr"]=vd.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},W3e=e=>{if((No.$flags$&1)===0){const t=S2(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},bft=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};bi.member&&(i.$members$=t[2]),bi.hostListener&&(i.$listeners$=t[3]),bi.watchCallback&&(i.$watchers$=e.$watchers$),bi.reflect&&(i.$attrsToReflect$=[]),bi.shadowDom&&!lL&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){Y3e(this,i)},connectedCallback(){H3e(this),bi.connectedCallback&&r&&r.call(this)},disconnectedCallback(){W3e(this),bi.disconnectedCallback&&s&&s.call(this)},__attachShadow(){lL?bi.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,V3e(e,i)},wft=e=>{const t=new URL(e,No.$resourcesUrl$);return t.origin!==T2.location.origin?t.href:t.pathname},X3e=e=>No.$resourcesUrl$=e,ode=new WeakMap,S2=e=>ode.get(e),Y3e=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return bi.isDev&&(i.$renderCount$=0),bi.method&&bi.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),bi.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),Yhe(e,i,t.$listeners$),ode.set(e,i)},ZZ=(e,t)=>t in e,VO=(e,t)=>(0,console.error)(e,t),ade=bi.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],Z3e=(...e)=>console.error(...ade,...e),lde=(...e)=>console.warn(...ade,...e),hL=new Map,Q3e=[],QZ=[],cde=[],J3e=(e,t)=>i=>{e.push(i),WV||(WV=!0,t&&No.$flags$&4?K3e(XV):No.raf(XV))},JZ=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){VO(i)}e.length=0},XV=()=>{JZ(QZ),JZ(cde),(WV=QZ.length>0)&&No.raf(XV)},K3e=e=>p3e().then(e),eIe=J3e(cde,!0),xft={isDev:!!bi.isDev,isBrowser:!0,isServer:!1,isTesting:!!bi.isTesting};let ude;function tIe(){X3e(Qu(Ei(ude)))}ude="components/assets";const hde=Symbol("widget"),iIe=[],rIe={},dL=new WeakMap;function dde(e,t){let i=t.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=dde(e,i[s]);else i=iIe;const r=t.vnodeSelector;if(pH(r)){const s=t.properties||rIe,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:sIe,afterUpdate:nIe,afterRemoved:pde,parentWidget:e,widgetConstructor:r,widgetProperties:ge(L({},s),{key:n,children:i})},children:void 0,text:void 0,domNode:null}}return t}function sIe(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){const o=new s(n);o.container=e,dL.set(e,o),o.afterCreate==null||o.afterCreate(o,e),r._internalHandles.add(sh(()=>pde(e)))}function nIe(e,t,i,{widgetProperties:r}){const s=dL.get(e);s&&(s.set(r),s.afterUpdate==null||s.afterUpdate(s,e))}function pde(e){const t=dL.get(e);t&&(t.destroy(),dL.delete(e))}function pH(e){return typeof e=="function"&&e[hde]}const fde="esri.widgets.Widget",oIe=pe.getLogger(fde);let aIe=0;const lIe={widgetIcon:"esri-icon-checkbox-unchecked"};function mde(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?mde(e[i],t[i]):e[i]=t[i]);return e}const cIe=h3e({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,n,o)=>{const a=t(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=g=>a.call(n,g);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=g=>{f==null||f(g),p()}}return a}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(Fhe(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let uU=!1,nn=class extends v2(qr.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Jt,this._projector=cIe,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=lIe.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=Coe(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await Ka(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await Dce(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=mde(re(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&oIe.error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),tIe();const i="esri-widget-uid-"+n3e(),r=this.render.bind(this);this._trackingTarget=new WN(()=>this.scheduleRender());const s=()=>{var n;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const o=r();let{properties:a}=o;a||(o.properties=a={});let{key:l,styles:c}=a;l||(a.key=i),c||(a.styles=c={}),c.display||(c.display="");let h=0;return(n=o.children)==null||n.forEach(p=>{if(pH(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${h++}`)}),dde(this,o)};this.render=()=>{if(uU)return s();let n=PPe(this);if(n)return n;this._trackingTarget.clear(),uU=!0;try{n=Zm(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{uU=!1}return IPe(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()}))}normalizeCtorArgs(e,t){const i=L({},e);return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(C6)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget=ct(this._trackingTarget),this.viewModel=ct(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,lU(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return fF(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+aIe++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(lU(this),this._projector.scheduleRender())}classes(...e){return zhe.apply(this,e)}renderNow(){lU(this),this._projector.renderNow()}_postInitialize(){var e;if(this.destroyed)return;this.scheduleRender(),(e=this._delegatedEventNames)!=null&&e.length&&this._internalHandles.add(xe(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&this._internalHandles.add(this._delegatedEventNames.map(s=>i.on(s,n=>{this.emit(s,n)})),"delegated-events")},Bi)),this.postInitialize();const t=async()=>{await this._loadLocale().catch(C6),this.scheduleRender()};this._internalHandles.add([B2e(t),xe(()=>this.uiStrings,t),Rd(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};nn[hde]=!0,u([d()],nn.prototype,"_readyForTrueRender",void 0),u([d({value:null})],nn.prototype,"container",null),u([Bt("container")],nn.prototype,"castContainer",null),u([d({aliasOf:"container"})],nn.prototype,"domNode",void 0),u([d()],nn.prototype,"iconClass",void 0),u([d()],nn.prototype,"id",null),u([d()],nn.prototype,"label",void 0),u([d()],nn.prototype,"renderable",null),u([d()],nn.prototype,"uiStrings",void 0),u([d()],nn.prototype,"viewModel",void 0),u([d()],nn.prototype,"visible",void 0),u([d()],nn.prototype,"key",void 0),u([d()],nn.prototype,"children",void 0),u([d()],nn.prototype,"afterCreate",void 0),u([d()],nn.prototype,"afterUpdate",void 0),u([d()],nn.prototype,"afterRemoved",void 0),nn=u([P(fde)],nn);const va=nn;function uIe(e,t,i){return e.units[t][i]}function MF(e,t,i,r=2,s="abbr"){return`${tg(t,{minimumFractionDigits:r,maximumFractionDigits:r})} ${uIe(e,i,s)}`}function Tft(e,t,i,r=2,s="abbr"){const n=oRe(t,i);return MF(e,ys(t,i,n),n,r,s)}function Sft(e,t,i,r=2,s="abbr"){const n=aRe(t,i);return MF(e,ys(t,i,n),n,r,s)}function Eft(e,t,i,r=2,s="abbr"){const n=lRe(t,i);return MF(e,ys(t,i,n),n,r,s)}function Aft(e,t,i,r=2,s="abbr"){const n=cRe(t,i);return MF(e,ys(t,i,n),n,r,s)}const KZ=["B","kB","MB","GB","TB"];function hIe(e,t){let i=t===0?0:Math.floor(Math.log(t)/Math.log(db.KILOBYTES));i=He(i,0,KZ.length-1);const r=tg(t/db.KILOBYTES**i,{maximumFractionDigits:2});return Zp(e.units.bytes[KZ[i]],{fileSize:r})}function dIe(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find(n=>n.name===i);return s?pIe({tagName:r,tags:s.tags}):null}function pIe(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find(s=>s.name===t);return r&&r.value||null}var YV;const fIe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let vl=YV=class extends _e{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=dIe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return fIe[t]||null}clone(){return new YV({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],vl.prototype,"contentType",void 0),u([d()],vl.prototype,"exifInfo",void 0),u([d({readOnly:!0})],vl.prototype,"orientationInfo",null),u([d({type:Dr})],vl.prototype,"id",void 0),u([d({type:String})],vl.prototype,"globalId",void 0),u([d({type:String})],vl.prototype,"keywords",void 0),u([d({type:String})],vl.prototype,"name",void 0),u([d({json:{read:!1}})],vl.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],vl.prototype,"parentObjectId",void 0),u([d({type:Dr})],vl.prototype,"size",void 0),u([d({json:{read:!1}})],vl.prototype,"url",void 0),vl=YV=u([P("esri.layers.support.AttachmentInfo")],vl);const mIe=vl;var ZV;let Zn=ZV=class extends _e{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new ZV(re({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Zn.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Zn.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Zn.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Zn.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Zn.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Zn.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Zn.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Zn.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Zn.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Zn.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Zn.prototype,"start",void 0),u([Xe("start"),Xe("num")],Zn.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Zn.prototype,"where",void 0),Zn=ZV=u([P("esri.rest.support.AttachmentQuery")],Zn),Zn.from=As(Zn);const QV=Zn,gIe="esri.widgets.Feature.support.featureUtils",eQ=pe.getLogger(gIe),yIe=/href=(""|'')/gi,vIe=/(\{([^\{\r\n]+)\})/g,_Ie=/\'/g,gde=/^\s*expression\//i,bIe=/(\n)/gi,wIe=/[\u00A0-\u9999<>\&]/gim,xIe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,TIe=/^(?:mailto:|tel:)/,yde="relationships/",JV=nj("short-date-short-time");function vde(e){if(!C(e))return e.get("sourceLayer")||e.get("layer")}async function pL(e,t){return typeof e=="function"?e.call(null,t):e}function _de(e=""){if(e)return!TIe.test(e.trim().toLowerCase())}function bde(e){return!!e&&gde.test(e)}function SIe(e,t){if(!bde(t)||!e)return null;const i=t.replace(gde,"").toLowerCase();let r;return e.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function wde(e,t){const i=SIe(t,e==null?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function EIe(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}function AIe(e){return e.replace(yIe,"")}function fL(e,t){const i=fH(t,e);return i?i.name:e}function CIe(e,t){return e&&e.map(i=>fL(i,t))}function fH(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function xde(e){return`${e}`.trim()}function y1({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?KV({formattedAttributes:t,template:PIe(r,L(L(L({},t),s),e),i),fieldInfoMap:n}):""}function KV({formattedAttributes:e,template:t,fieldInfoMap:i}){return xde(AIe(Zp(Zp(t,r=>EIe(r,i)),e)))}function RIe(e,t,i=!1){const r=t[e];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(_Ie,s);t[e]=n}}function OIe(e,t=!1){const i=L({},e);return Object.keys(i).forEach(r=>RIe(r,i,t)),i}function MIe(e,t,i){const r=(t=xde(t))&&t[0]!=="{";return Zp(e,OIe(i,r))}function e8(e,t){return e.replace(vIe,(i,r,s)=>{const n=fH(t,s);return n?`{${n.name}}`:r})}function PIe(e,t,i){const r=e8(e,i);return r&&r.replace(xIe,(s,n,o)=>MIe(s,n||o,t))}function IIe(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const i=Number(e);if(!isNaN(i))return i}return e}function $Ie(e){return(e==null?void 0:e.type)==="feature"}function tQ(e){return!(e==null||!e.layer)}function DIe(e){return(e==null?void 0:e.type)==="map-image"}function Tde(e,t){const i=t.fieldInfos,r=t.fieldName,s=Sde(i,r),n=s==null?void 0:s.clone(),o=t.preventPlacesFormatting,a=t.layer,l=fH(a,r);if(n&&(l==null?void 0:l.type)==="date"){const h=n.format||new AC;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!tQ(a)&&$Ie(a)&&a.datesInUnknownTimezone||tQ(a)&&DIe(a.layer)&&a.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,n.format=h}const c=n&&n.format;return typeof(e=IIe(e,c))=="string"||e==null||c==null?GO(e):o?tg(e,ge(L({},ole(c)),{minimumFractionDigits:0,maximumFractionDigits:20})):c.format(e)}function Sde(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function LIe({fieldName:e,graphic:t,layer:i}){if(Lm(e)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}function NIe({fieldName:e,value:t,graphic:i,layer:r}){if(Lm(e)||!r||typeof r.getFieldDomain!="function")return null;const s=r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function FIe(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:eg(o,JV),user:l}}const a=t[r];if(typeof a=="number"){const l=t[i];return{type:"create",date:eg(a,JV),user:l}}return null}function UIe(e,t){const i=new Map;return e&&e.forEach(r=>{const s=fL(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function iQ(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function mH(e){return e.replace(wIe,t=>`&#${t.charCodeAt(0)};`)}function GO(e){return typeof e=="string"?e.replace(bIe,'<br class="esri-text-new-line" />'):e}function Ede(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=NIe({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=LIe({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return Tde(t,{fieldInfos:r,fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?eg(t,JV):GO(t)}function hU({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>GIe({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:i})),Object.keys(t).forEach(a=>{const l=t[a];o[a]=Ede({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function zIe(e,t){var i,r;const{layer:s,graphic:n,outFields:o,objectIds:a,returnGeometry:l,spatialReference:c}=e,h=a[0];if(typeof h!="number"&&typeof h!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",g={layer:s,graphic:n,objectId:h,requiredFields:o};return eQ.warn(f,g),null}if((i=s.capabilities)==null||(r=i.operations)==null||!r.supportsQuery){const f="The specified layer cannot be queried. The following fields will not be available.",g={layer:s,graphic:n,requiredFields:o,returnGeometry:l};return eQ.warn(f,g),null}const p=s.createQuery();return p.objectIds=a,p.outFields=o!=null&&o.length?o:[s.objectIdField],p.returnGeometry=!!l,p.returnZ=!!l,p.returnM=!!l,p.outSpatialReference=c,(await s.queryFeatures(p,t)).features[0]}async function kIe(e){var t;if((t=e.expressionInfos)==null||!t.length)return!1;const i=await Jp(),{arcadeUtils:{hasGeometryFunctions:r}}=i;return r(e)}async function BIe({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&await i.load(s),!e.attributes))return;const n=e.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(i.fieldsIndex),l=F2e(a,e),c=l?[]:a,h=t.returnGeometry||await kIe(t);if(l&&!h)return;const p=await zIe({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes=L(L({},e.attributes),p.attributes)))}function Lm(e=""){return!!e&&e.includes(yde)}function VIe(e){return e?`${yde}${e.layerId}/${e.fieldName}`:""}function rQ({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){e&&t&&i&&Object.keys(t.attributes).forEach(o=>{const a=VIe({layerId:i.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=Ede({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function GIe({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>rQ({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>rQ({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})))}const sQ=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},Ade=({layer:e,method:t,query:i,definitionExpression:r})=>{var s,n;if((s=e.capabilities)==null||(n=s.query)==null||!n.supportsCacheHint||t==="attachments")return;const o=_(i.where)&&i.where,a=_(i.geometry)&&i.geometry;sQ(r)||sQ(o)||(a==null?void 0:a.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},jIe=({query:e,layer:t,method:i})=>{Ade({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},HIe=({queryPayload:e,layer:t,method:i})=>{Ade({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},nQ={editing:!1,operations:{add:!0,update:!0,delete:!0}},Cde=St.ofType(mIe),qIe="graphic.layer.capabilities.operations.supportsResizeAttachments";let Dh=class extends vS{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities=L({},nQ),this.activeAttachmentInfo=null,this.attachmentInfos=new Cde,this.graphic=null,this.mode="view",this.handles.add([uo(this,"graphic",()=>this._graphicChanged())])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return L(L({},nQ),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(qIe)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new Y("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new QV({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(a=>a[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new Y("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new Y("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new Y("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then(a=>this._queryAttachment(a.objectId)),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new Y("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new Y("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new Y("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then(()=>e),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new Y("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new Y("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new Y("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex(c=>c===t);if(!i||typeof i.updateAttachment!="function")throw new Y("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await a;return r.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new Y("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new QV({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then(s=>s[i][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=vde(e);this._attachmentLayer=t?t.type==="scene"&&_(t.associatedLayer)?t.associatedLayer:t:null}};u([d()],Dh.prototype,"abilities",void 0),u([Bt("abilities")],Dh.prototype,"castAbilities",null),u([d()],Dh.prototype,"activeAttachmentInfo",void 0),u([d({readOnly:!0,type:Cde})],Dh.prototype,"attachmentInfos",void 0),u([d({type:ho})],Dh.prototype,"graphic",void 0),u([d()],Dh.prototype,"mode",void 0),u([d({readOnly:!0})],Dh.prototype,"state",null),u([d({readOnly:!0})],Dh.prototype,"supportsResizeAttachments",null),Dh=u([P("esri.widgets.Attachments.AttachmentsViewModel")],Dh);const gH=Dh;function WIe(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function XIe(e){const t=Ei("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function Bl(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}var YIe=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},Rde=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?Rde(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=YIe(s)),t.push(s))}},ZIe=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return Rde(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function ae(e,t,...i){return typeof e!="function"||pH(e)?ZIe(e,t,...i):e(t,...i)}const oQ={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},tt={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},dU=window.CSS;let qo=class extends va{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new gH,this.visibleElements=L({},oQ),this._supportsImageOrientation=dU&&dU.supports&&dU.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([aH(this,"viewModel.attachmentInfos","change",()=>this.scheduleRender()),uo(this,"viewModel.mode",()=>this._modeChanged())])}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return L(L({},oQ),e)}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new Y("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new Y("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new Y("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return ae("div",{class:this.classes(tt.base,tt.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?ae("div",{key:"error-message",class:tt.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return ae("div",{class:tt.loaderContainer,key:"loader"},ae("div",{class:tt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?ae("div",{class:tt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?ae("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(tt.esriButton,tt.esriButtonTertiary,tt.esriButtonSmall,tt.esriButtonHalf,e&&tt.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?ae("button",{type:"submit",disabled:i,class:this.classes(tt.esriButton,tt.esriButtonSecondary,tt.esriButtonSmall,tt.esriButtonHalf,{[tt.buttonDisabled]:i})},this.messages.add):null,n=t?ae("span",{key:"file-name",class:tt.fileName},t.name):null,o=ae("form",{bind:this,afterCreate:VV,afterRemoved:$Z,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},ae("fieldset",{class:tt.fileFieldset},n,ae("label",{class:this.classes(tt.fileLabel,tt.esriButton,tt.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,ae("input",{class:tt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return ae("div",{key:"add-form-container",class:tt.formNode},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=i,c=s||!r,h=l.editing&&l.operations.delete&&t.deleteButton?ae("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:S=>this._submitDeleteAttachment(S,e),class:this.classes(tt.esriButton,tt.esriButtonSmall,tt.esriButtonTertiary,tt.deleteButton,{[tt.buttonDisabled]:s})},this.messages.delete):null,p=l.editing&&l.operations.update&&t.updateButton?ae("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(tt.esriButton,tt.esriButtonSmall,tt.esriButtonThird,{[tt.buttonDisabled]:c})},this.messages.update):null,f=this.visibleElements.cancelUpdateButton?ae("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(tt.esriButton,tt.esriButtonSmall,tt.esriButtonTertiary,tt.esriButtonThird,{[tt.buttonDisabled]:s})},this.messages.cancel):null,g=r?ae("span",{key:"file-name",class:tt.fileName},r.name):null,y=l.editing&&l.operations.update?ae("fieldset",{key:"file",class:tt.fileFieldset},g,ae("label",{class:this.classes(tt.fileLabel,tt.esriButton,tt.esriButtonSecondary)},this.messages.changeFile,ae("input",{class:tt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,v=ae("fieldset",{key:"size",class:tt.metadataFieldset},ae("label",null,hIe(this.messagesUnits,o))),b=ae("fieldset",{key:"content-type",class:tt.metadataFieldset},ae("label",null,n)),w=ae("form",{bind:this,afterCreate:VV,afterRemoved:$Z,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},ae("div",{class:tt.metadata},v,b),y,ae("div",{class:tt.actions},h,f,p));return ae("div",{key:"edit-form-container",class:tt.formNode},ae("a",{class:tt.itemLink,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),ae("div",{class:tt.itemLinkOverlay},ae("span",{class:tt.itemLinkOverlayIcon},ae("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},ae("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),ae("path",{fill:"none",d:"M0 0h32v32H0z"}))))),w)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,o=i&&WIe(r),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=n.includes("?")?"&":"?",h=o?`${n}${c}w=${t}`:XIe(r),p={[tt.itemMaskIcon]:!o},f={[tt.itemImageResizable]:i};return ae("div",{class:this.classes(p,tt.itemMask)},ae("img",{styles:l,alt:s,src:h,class:this.classes(f,tt.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),a=r.editing?ae("span",{"aria-hidden":"true",class:this.classes(tt.itemChevronIcon,d0(this.container)?tt.iconLeft:tt.iconRight)}):null,l=[o,ae("label",{class:tt.itemLabel},ae("span",{class:tt.itemFilename},s||this.messages.noTitle),a)],c=r.editing?ae("button",{key:"details-button",bind:this,class:tt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):ae("a",{key:"details-link",class:tt.itemButton,href:n,target:"_blank"},l);return ae("li",{class:tt.item,key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,o={[tt.containerList]:e!=="preview",[tt.containerPreview]:e==="preview"},a=s.editing&&s.operations.add&&i.addButton?ae("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(tt.esriButton,tt.esriButtonTertiary,tt.addAttachmentButton),type:"button"},ae("span",{"aria-hidden":"true",class:this.classes(tt.itemAddIcon,tt.iconPlus)}),this.messages.add):null,l=n?ae("ul",{class:tt.items},r.toArray().map(c=>this.renderAttachmentInfo({attachmentInfo:c,displayType:e}))):ae("div",{class:tt.empty},this.messages.noAttachments);return ae("div",{key:"attachments-container",class:this.classes(tt.container,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([xt("viewModel.abilities")],qo.prototype,"abilities",void 0),u([d()],qo.prototype,"displayType",void 0),u([d({readOnly:!0})],qo.prototype,"effectiveDisplayType",null),u([xt("viewModel.graphic")],qo.prototype,"graphic",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],qo.prototype,"label",void 0),u([d(),Bl("esri/widgets/Attachments/t9n/Attachments")],qo.prototype,"messages",void 0),u([d(),Bl("esri/core/t9n/Units")],qo.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],qo.prototype,"selectedFile",void 0),u([d({readOnly:!0})],qo.prototype,"submitting",void 0),u([d({readOnly:!0})],qo.prototype,"error",void 0),u([d({type:gH})],qo.prototype,"viewModel",void 0),u([d()],qo.prototype,"visibleElements",void 0),u([Bt("visibleElements")],qo.prototype,"castVisibleElements",null),qo=u([P("esri.widgets.Attachments")],qo);const QIe=qo;let LA=class extends gH{constructor(e){super(e),this.description=null,this.title=null}};u([d()],LA.prototype,"description",void 0),u([d()],LA.prototype,"title",void 0),LA=u([P("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],LA);const yH=LA,JIe={heading:"esri-widget__heading"};function vH(e,t){const i=KIe(e.level),r=`h${i}`;return delete e.level,ae(r,ge(L({},e),{class:zhe(JIe.heading,e.class),role:"heading","aria-level":String(i)}),t)}function KIe(e){return He(Math.ceil(e),1,6)}const pU={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let vx=class extends va{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return ae("div",{class:pU.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?ae(vH,{level:this.headingLevel,class:pU.title},e):null}renderDescription(){const{description:e}=this;return e?ae("div",{key:"description",class:pU.description},e):null}};u([d()],vx.prototype,"description",void 0),u([d()],vx.prototype,"headingLevel",void 0),u([d()],vx.prototype,"title",void 0),vx=u([P("esri.widgets.Feature.support.FeatureElementInfo")],vx);const _H=vx,e$e={base:"esri-feature-attachments"};let dp=class extends va{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new QIe,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new yH}initialize(){this._featureElementInfo=new _H,uo(this,["viewModel.description","viewModel.title","headingLevel"],()=>this._setupFeatureElementInfo()),uo(this,"viewModel.graphic",e=>this.attachmentsWidget.graphic=e)}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var e;const{attachmentsWidget:t}=this;return ae("div",{class:e$e.base},(e=this._featureElementInfo)==null?void 0:e.render(),t==null?void 0:t.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};u([d({readOnly:!0})],dp.prototype,"attachmentsWidget",void 0),u([xt("viewModel.description")],dp.prototype,"description",void 0),u([xt("attachmentsWidget.displayType")],dp.prototype,"displayType",void 0),u([xt("viewModel.graphic")],dp.prototype,"graphic",void 0),u([d()],dp.prototype,"headingLevel",void 0),u([xt("viewModel.title")],dp.prototype,"title",void 0),u([d({type:yH})],dp.prototype,"viewModel",void 0),dp=u([P("esri.widgets.Feature.FeatureAttachments")],dp);const t$e=dp;let _y=class extends Fd(be){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(uo(this,"creator",t=>{this._destroyContent(),this._createContent(t)}))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(pL(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=pL(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};u([d({readOnly:!0})],_y.prototype,"created",void 0),u([d()],_y.prototype,"creator",void 0),u([d()],_y.prototype,"destroyer",void 0),u([d({type:ho})],_y.prototype,"graphic",void 0),u([d({readOnly:!0})],_y.prototype,"state",null),_y=u([P("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],_y);const mL=_y;function Iu(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:r$e(e[t])}}}function i$e(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function r$e(e){return function(t,...i){i$e(t)?BPe(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function s$e(e){return e.split(",").map(t=>t.trim())}function n$e(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:s$e(e);i.push(...r)}}function o$e(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function Ode(){return o$e().startsWith("dark")}function a$e(){return"calcite-theme-"+(Ode()?"dark":"light")}function Mde(e){return e&&typeof e.render=="function"}function l$e(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const fU={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let _x=class extends va{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{_de(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}renderLoading(){return ae("div",{class:fU.loaderContainer,key:"loader"},ae("div",{class:fU.loader}))}renderCreated(){var e;const t=(e=this.viewModel)==null?void 0:e.created;return t?t instanceof HTMLElement?ae("div",{key:t,bind:t,afterCreate:this._attachToNode}):Mde(t)?ae("div",{key:t},!t.destroyed&&t.render()):ae("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}render(){var e;const t=(e=this.viewModel)==null?void 0:e.state;return ae("div",{class:fU.base},t==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([xt("viewModel.creator")],_x.prototype,"creator",void 0),u([xt("viewModel.graphic")],_x.prototype,"graphic",void 0),u([d({type:mL})],_x.prototype,"viewModel",void 0),_x=u([P("esri.widgets.Feature.FeatureContent")],_x);const i$=_x;let Jf=class extends be{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t==null||t.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const s=r.clone();s.label=wde(s,e),i.push(s)}),i}};u([d()],Jf.prototype,"attributes",void 0),u([d({type:[fle]})],Jf.prototype,"expressionInfos",void 0),u([d()],Jf.prototype,"description",void 0),u([d({type:[FO]})],Jf.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],Jf.prototype,"formattedFieldInfos",null),u([d()],Jf.prototype,"title",void 0),Jf=u([P("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Jf);const PF=Jf,c$e=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function u$e(e){let t=null;return c$e.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function h$e(e,t){if(typeof t!="string"||!t)return t;const i=u$e(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=Zp(Zp(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const nE={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let Lh=class extends va{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new PF,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new _H,uo(this,["viewModel.description","viewModel.title"],()=>this._setupFeatureElementInfo())}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?i[r]==null?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):h$e(this.messagesURIUtils,n),l={[nE.fieldDataDate]:o};return ae("tr",{key:`fields-element-info-row-${r}-${t}`},ae("th",{key:`fields-element-info-row-header-${r}-${t}`,class:nE.fieldHeader,innerHTML:s}),ae("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(nE.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?ae("table",{class:nE.esriTable,summary:this.messages.fieldsSummary},ae("tbody",null,e.map((t,i)=>this.renderFieldInfo(t,i)))):null}render(){var e;return ae("div",{class:nE.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([xt("viewModel.attributes")],Lh.prototype,"attributes",void 0),u([xt("viewModel.description")],Lh.prototype,"description",void 0),u([xt("viewModel.expressionInfos")],Lh.prototype,"expressionInfos",void 0),u([xt("viewModel.fieldInfos")],Lh.prototype,"fieldInfos",void 0),u([xt("viewModel.title")],Lh.prototype,"title",void 0),u([d({type:PF})],Lh.prototype,"viewModel",void 0),u([d(),Bl("esri/widgets/Feature/t9n/Feature")],Lh.prototype,"messages",void 0),u([d(),Bl("esri/widgets/support/t9n/uriUtils")],Lh.prototype,"messagesURIUtils",void 0),Lh=u([P("esri.widgets.Feature.FeatureFields")],Lh);const Pde=Lh;var t8;let NA=t8=class extends _e{constructor(e){super(e),this.name=null,this.code=null}clone(){return new t8({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],NA.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],NA.prototype,"code",void 0),NA=t8=u([P("esri.layers.support.CodedValue")],NA);const d$e=new yi({inherited:"inherited",codedValue:"coded-value",range:"range"});let FA=class extends _e{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],FA.prototype,"name",void 0),u([vt(d$e)],FA.prototype,"type",void 0),FA=u([P("esri.layers.support.Domain")],FA);const IF=FA;var i8;let UA=i8=class extends IF{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new i8({codedValues:re(this.codedValues),name:this.name})}};u([d({type:[NA],json:{write:!0}})],UA.prototype,"codedValues",void 0),u([vt({codedValue:"coded-value"})],UA.prototype,"type",void 0),UA=i8=u([P("esri.layers.support.CodedValueDomain")],UA);const Ide=UA;var r8;let r$=r8=class extends IF{constructor(e){super(e),this.type="inherited"}clone(){return new r8}};u([vt({inherited:"inherited"})],r$.prototype,"type",void 0),r$=r8=u([P("esri.layers.support.InheritedDomain")],r$);const $de=r$;var s8;let bx=s8=class extends IF{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new s8({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],bx.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],bx.prototype,"minValue",void 0),u([vt({range:"range"})],bx.prototype,"type",void 0),bx=s8=u([P("esri.layers.support.RangeDomain")],bx);const Dde=bx,Lde={key:"type",base:IF,typeMap:{range:Dde,"coded-value":Ide,inherited:$de}};function bH(e){if(!e||!e.type)return null;switch(e.type){case"range":return Dde.fromJSON(e);case"codedValue":return Ide.fromJSON(e);case"inherited":return $de.fromJSON(e)}return null}const p$e=new yi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var n8;const f$e=new yi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Ia=n8=class extends _e{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?f$e.fromJSON(i.fieldValueType):null}clone(){return new n8({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};u([d({type:String,json:{write:!0}})],Ia.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],Ia.prototype,"defaultValue",void 0),u([d()],Ia.prototype,"description",void 0),u([Ne("description")],Ia.prototype,"readDescription",null),u([d({types:Lde,json:{read:{reader:bH},write:!0}})],Ia.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Ia.prototype,"editable",void 0),u([d({type:Dr,json:{write:!0}})],Ia.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],Ia.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],Ia.prototype,"nullable",void 0),u([vt(p$e)],Ia.prototype,"type",void 0),u([d()],Ia.prototype,"valueType",void 0),u([Ne("valueType",["description"])],Ia.prototype,"readValueType",null),Ia=n8=u([P("esri.layers.support.Field")],Ia);const jO=Ia;var o8;let wx=o8=class extends _e{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new o8({mapLayerId:e,gdbVersion:t})}};u([vt({mapLayer:"map-layer"})],wx.prototype,"type",void 0),u([d({type:Dr,json:{write:!0}})],wx.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],wx.prototype,"gdbVersion",void 0),wx=o8=u([P("esri.layers.support.source.MapLayerSource")],wx);var a8;let Kf=a8=class extends _e{constructor(e){super(e),this.type="query-table"}clone(){var e;const{workspaceId:t,query:i,oidFields:r,spatialReference:s,geometryType:n}=this,o={workspaceId:t,query:i,oidFields:r,spatialReference:(e=s==null?void 0:s.clone())!=null?e:void 0,geometryType:n};return new a8(o)}};u([vt({queryTable:"query-table"})],Kf.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Kf.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Kf.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],Kf.prototype,"oidFields",void 0),u([d({type:Ke,json:{write:!0}})],Kf.prototype,"spatialReference",void 0),u([vt(Hae)],Kf.prototype,"geometryType",void 0),Kf=a8=u([P("esri.layers.support.source.QueryTableDataSource")],Kf);var l8;let xx=l8=class extends _e{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new l8({workspaceId:e,dataSourceName:t})}};u([vt({raster:"raster"})],xx.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],xx.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],xx.prototype,"workspaceId",void 0),xx=l8=u([P("esri.layers.support.source.RasterDataSource")],xx);var c8;let y_=c8=class extends _e{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new c8({workspaceId:e,gdbVersion:t,dataSourceName:i})}};u([vt({table:"table"})],y_.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],y_.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],y_.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],y_.prototype,"dataSourceName",void 0),y_=c8=u([P("esri.layers.support.source.TableDataSource")],y_);var u8,h8;const m$e=Uo()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let cc=u8=class extends _e{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return aQ()(e,t,i)}castLeftTableSource(e){return xd(d8(),e)}readRightTableSource(e,t,i){return aQ()(e,t,i)}castRightTableSource(e){return xd(d8(),e)}clone(){var e,t;const{leftTableKey:i,rightTableKey:r,leftTableSource:s,rightTableSource:n,joinType:o}=this,a={leftTableKey:i,rightTableKey:r,leftTableSource:(e=s==null?void 0:s.clone())!=null?e:void 0,rightTableSource:(t=n==null?void 0:n.clone())!=null?t:void 0,joinType:o};return new u8(a)}};u([vt({joinTable:"join-table"})],cc.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],cc.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],cc.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],cc.prototype,"leftTableSource",void 0),u([Ne("leftTableSource")],cc.prototype,"readLeftTableSource",null),u([Bt("leftTableSource")],cc.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],cc.prototype,"rightTableSource",void 0),u([Ne("rightTableSource")],cc.prototype,"readRightTableSource",null),u([Bt("rightTableSource")],cc.prototype,"castRightTableSource",null),u([vt(m$e)],cc.prototype,"joinType",void 0),cc=u8=u([P("esri.layers.support.source.JoinTableDataSource")],cc);let mU=null;function aQ(){return mU||(mU=c2({types:d8()})),mU}let gU=null;function d8(){return gU||(gU={key:"type",base:null,typeMap:{"data-layer":ed,"map-layer":wx}}),gU}const g$e={key:"type",base:null,typeMap:{"join-table":cc,"query-table":Kf,raster:xx,table:y_}};let ed=h8=class extends _e{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new h8({fields:e,dataSource:t})}};u([vt({dataLayer:"data-layer"})],ed.prototype,"type",void 0),u([d({type:[jO],json:{write:!0}})],ed.prototype,"fields",void 0),u([d({types:g$e,json:{write:!0}})],ed.prototype,"dataSource",void 0),ed=h8=u([P("esri.layers.support.source.DataLayerSource")],ed),ed.from=As(ed);function y$e(e,t){return t?ge(L({},t),{query:L(L({},e),t.query)}):{query:e}}function Nde(e){return typeof e=="string"?ya(e):re(e)}function v$e(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=v$e(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=t?o:JSON.stringify(o)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}const rP={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Nc({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ke.WebMercator}),minus180Line:new Nc({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ke.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Nc({paths:[[[180,-180],[180,180]]],spatialReference:Ke.WGS84}),minus180Line:new Nc({paths:[[[-180,-180],[-180,180]]],spatialReference:Ke.WGS84})}};function v1(e,t){return Math.ceil((e-t)/(2*t))}function Fde(e,t){const i=FC(e);for(const r of i)for(const s of r)s[0]+=t;return e}function FC(e){return P1(e)?e.rings:e.paths}async function _$e(e,t,i,r){const s=typeof e=="string"?ya(e):e,n=t[0].spatialReference,o=ge(L({},r),{query:ge(L({},s.query),{f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:u2(t[0]),geometries:t}),cutter:JSON.stringify(i)})}),a=await Pi(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=Km(h);return p.spatialReference=n,p})}}async function b$e(e,t,i){const r=typeof e=="string"?ya(e):e,s=t[0].spatialReference,n=u2(t[0]),o=ge(L({},i),{query:ge(L({},r.query),{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(w$e(t))})});return x$e((await Pi(r.path+"/simplify",o)).data,n,s)}function w$e(e){return{geometryType:u2(e[0]),geometries:e.map(t=>t.toJSON())}}function x$e(e,t,i){const r=Wae(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}const Ude=pe.getLogger("esri.geometry.support.normalizeUtils");function T$e(e){return e.type==="polygon"}function S$e(e){return e[0].type==="polygon"}function E$e(e){return e[0].type==="polyline"}function A$e(e,t){if(!(e instanceof Nc||e instanceof jl)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw Ude.error(s),new Y(s)}const i=FC(e),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,g=(c-a)/p,y=p/t;if(y>1){for(let S=1;S<=y-1;S++){const x=S*t,E=g*x+a,R=f*x+l;n.push([E,R])}const v=(p+Math.floor(y-1)*t)/2,b=g*v+a,w=f*v+l;n.push([b,w])}n.push([c,h])}}return T$e(e)?new jl({rings:r,spatialReference:e.spatialReference}):new Nc({paths:r,spatialReference:e.spatialReference})}function lQ(e,t,i){if(t){const r=A$e(e,1e6);e=uA(r,!0)}return i&&(e=Fde(e,i)),e}function cQ(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=v1(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=v1(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=v1(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=v1(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function C$e(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=FC(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const g=l[f][0];h=g>h?g:h}h=Number(h.toFixed(9));const p=-360*v1(h,180);for(let f=0;f<l.length;f++){const g=n.getPoint(a,f);n.setPoint(a,f,g.clone().offset(p,0))}return!0}})}if(s===i){if(S$e(e))for(const a of FC(n))e[s]=e[s].addRing(a);else if(E$e(e))for(const a of FC(n))e[s]=e[s].addPath(a)}else i=s,e[s]=n}return e}async function zde(e,t,i){var r;if(!Array.isArray(e))return zde([e],t);t&&typeof t!="string"&&Ude.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const s=typeof t=="string"?t:(r=t==null?void 0:t.url)!=null?r:rr.geometryServiceUrl;let n,o,a,l,c,h,p,f,g=0;const y=[],v=[];for(const R of e)if(C(R))v.push(R);else if(n||(n=R.spatialReference,o=x0(n),a=n.isWebMercator,h=a?102100:4326,l=rP[h].maxX,c=rP[h].minX,p=rP[h].plus180Line,f=rP[h].minus180Line),o)if(R.type==="mesh")v.push(R);else if(R.type==="point")v.push(cQ(R.clone(),l,c));else if(R.type==="multipoint"){const O=R.clone();O.points=O.points.map(I=>cQ(I,l,c)),v.push(O)}else if(R.type==="extent"){const O=R.clone()._normalize(!1,!1,o);v.push(O.rings?new jl(O):O)}else if(R.extent){const O=R.extent,I=v1(O.xmin,c)*(2*l);let U=I===0?R.clone():Fde(R.clone(),I);O.offset(I,0),O.intersects(p)&&O.xmax!==l?(g=O.xmax>g?O.xmax:g,U=lQ(U,a),y.push(U),v.push("cut")):O.intersects(f)&&O.xmin!==c?(g=O.xmax*(2*l)>g?O.xmax*(2*l):g,U=lQ(U,a,360),y.push(U),v.push("cut")):v.push(U)}else v.push(R.clone());else v.push(R);let b=v1(g,l),w=-90;const S=b,x=new Nc;for(;b>0;){const R=360*b-180;x.addPath([[R,w],[R,-1*w]]),w*=-1,b--}if(y.length>0&&S>0){const R=C$e(y,await _$e(s,y,x,i)),O=[],I=[];for(let V=0;V<v.length;V++){const j=v[V];if(j!=="cut")I.push(j);else{const H=R.shift(),J=e[V];_(J)&&J.type==="polygon"&&J.rings&&J.rings.length>1&&H.rings.length>=J.rings.length?(O.push(H),I.push("simplify")):I.push(a?Bm(H):H)}}if(!O.length)return I;const U=await b$e(s,O,i),N=[];for(let V=0;V<I.length;V++){const j=I[V];j!=="simplify"?N.push(j):N.push(a?Bm(U.shift()):U.shift())}return N}const E=[];for(let R=0;R<v.length;R++){const O=v[R];if(O!=="cut")E.push(O);else{const I=y.shift();E.push(a===!0?Bm(I):I)}}return E}function kde(e){const t={};for(const i in e){if(i==="declaredClass")continue;const r=e[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){t[i]=[];for(let s=0;s<r.length;s++)t[i][s]=kde(r[s])}else typeof r=="object"?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}var zy;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(zy||(zy={}));const uQ=4294967296,R$e=new TextDecoder("utf-8"),O$e=ue("safari")||ue("ios")?6:ue("ff")?12:32;class U1{constructor(t,i,r=0,s=t?t.byteLength:0){this._tag=0,this._dataType=zy.unknown,this._init(t,i,r,s)}_init(t,i,r,s){this._data=t,this._dataView=i,this._pos=r,this._end=s}clone(){return new U1(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getUint32(i+4,!0)*uQ;return this._skip(8),r}getSFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getInt32(i+4,!0)*uQ;return this._skip(8),r}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+t);return this._skip(t),r}getBytes(){const t=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+t);return this._skip(t),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,i,r,s){const n=this.getMessage(),o=t(n,i,r,s);return n.release(),o}processMessage(t){const i=this.getMessage(),r=t(i);return i.release(),r}getMessage(){const t=this._getLength(),i=U1.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}release(){U1.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case zy.varint:this._decodeVarint();break;case zy.fixed64:this._skip(8);break;case zy.delimited:this._skip(this._getLength());break;case zy.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let i,r=this._pos,s=0;if(this._end-r>=10)do{if(i=t[r++],s|=127&i,(128&i)==0||(i=t[r++],s|=(127&i)<<7,(128&i)==0)||(i=t[r++],s|=(127&i)<<14,(128&i)==0)||(i=t[r++],s|=(127&i)<<21,(128&i)==0)||(i=t[r++],s+=268435456*(127&i),(128&i)==0)||(i=t[r++],s+=34359738368*(127&i),(128&i)==0)||(i=t[r++],s+=4398046511104*(127&i),(128&i)==0)||(i=t[r++],s+=562949953421312*(127&i),(128&i)==0)||(i=t[r++],s+=72057594037927940*(127&i),(128&i)==0)||(i=t[r++],s+=9223372036854776e3*(127&i),(128&i)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(i=t[r],(128&i)!=0);)++r,s+=(127&i)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,s+=i*n}return this._pos=r,s}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==zy.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,i,r){if((r=Math.min(this._end,r))-i>O$e){const o=t.subarray(i,r);return R$e.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,i,r){return r=Math.min(this._end,r),new Uint8Array(t.buffer,i,r-i)}}U1.pool=new as(U1,null,e=>{e._data=null,e._dataView=null});class ql{constructor(t=[],i=[],r=!1){this.lengths=t!=null?t:[],this.coords=i!=null?i:[],this.hasIndeterminateRingOrder=r}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,i)=>t+i)}forEachVertex(t){let i=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)t(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(t){return t?(t.set(this.coords),new ql(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new ql(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class nf{constructor(t=null,i={},r,s){this.geometry=t,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new nf(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function M$e(e){return!(C(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class Cft extends nf{}class $F{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new $F;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const Bde=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class Rft{constructor(t){this.options=t,this.geometryTypes=Bde,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new $F}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||Kc(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const i=lb(this.options.sourceSpatialReference)/lb(t.spatialReference);if(i!==1)for(const r of t.features){if(!M$e(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(t,i){t.features.push(i)}createFeature(){return new nf}createSpatialReference(){return{wkid:0}}createGeometry(){return new ql}addField(t,i){t.fields.push(i)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,i){t.coords[this._coordinatePtr++]=i}addCoordinatePoint(t,i){t.coords.push(i)}addLength(t,i){t.lengths.push(i)}addQueryGeometry(t,i){t.queryGeometry=i.queryGeometry,t.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new ql}}const hQ=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],dQ=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],pQ=["upperLeft","lowerLeft"];function fQ(e){return e>=hQ.length?null:hQ[e]}function P$e(e){return e>=dQ.length?null:dQ[e]}function mQ(e){return e>=pQ.length?null:pQ[e]}function gQ(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function I$e(e,t,i){const s=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const n=e.getUInt32(),o=e.pos()+n;let a=0;for(;e.pos()<o;)t.addCoordinatePoint(s,e.getSInt64(),a++);break}default:e.skip()}return s}function $$e(e,t,i){const n=t.createGeometry(i),o=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(;e.pos()<l;)t.addLength(n,e.getUInt32(),c++);break}case 3:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(t.allocateCoordinates(n);e.pos()<l;)t.addCoordinate(n,e.getSInt64(),c),c++,c===o&&(c=0);break}default:e.skip()}return n}function D$e(e){const s=new ql;let n="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.lengths.push(e.getUInt32());break}case 3:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.coords.push(e.getSInt64());break}case 1:n=Bde[e.getEnum()];break;default:e.skip()}return{queryGeometry:s,queryGeometryType:n}}function L$e(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function N$e(e){const a={type:fQ(0)};for(;e.next();)switch(e.tag()){case 1:a.name=e.getString();break;case 2:a.type=fQ(e.getEnum());break;case 3:a.alias=e.getString();break;case 4:a.sqlType=P$e(e.getEnum());break;case 5:e.skip();break;case 6:a.defaultValue=e.getString();break;default:e.skip()}return a}function F$e(e){const r={};for(;e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.isSystemMaintained=e.getBool();break;default:e.skip()}return r}function U$e(e,t,i,r){const a=t.createFeature(i);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=r[l++].name;a.attributes[c]=e.processMessage(L$e);break}case 2:a.geometry=e.processMessageWithArgs($$e,t,i);break;case 4:a.centroid=e.processMessageWithArgs(I$e,t,i);break;default:e.skip()}return a}function z$e(e){const n=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function k$e(e){const n=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function B$e(e){const s={originPosition:mQ(0)};for(;e.next();)switch(e.tag()){case 1:s.originPosition=mQ(e.getEnum());break;case 2:s.scale=e.processMessage(z$e);break;case 3:s.translate=e.processMessage(k$e);break;default:e.skip()}return s}function V$e(e){const s={};for(;e.next();)switch(e.tag()){case 1:s.shapeAreaFieldName=e.getString();break;case 2:s.shapeLengthFieldName=e.getString();break;case 3:s.units=e.getString();break;default:e.skip()}return s}function G$e(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function j$e(e,t){const v=t.createFeatureResult();v.geometryType=gQ(t,0);let b=!1;for(;e.next();)switch(e.tag()){case 1:v.objectIdFieldName=e.getString();break;case 3:v.globalIdFieldName=e.getString();break;case 4:v.geohashFieldName=e.getString();break;case 5:v.geometryProperties=e.processMessage(V$e);break;case 7:v.geometryType=gQ(t,e.getEnum());break;case 8:v.spatialReference=e.processMessageWithArgs(G$e,t);break;case 10:v.hasZ=e.getBool();break;case 11:v.hasM=e.getBool();break;case 12:v.transform=e.processMessage(B$e);break;case 9:{const w=e.getBool();v.exceededTransferLimit=w;break}case 13:t.addField(v,e.processMessage(N$e));break;case 15:b||(t.prepareFeatures(v),b=!0),t.addFeature(v,e.processMessageWithArgs(U$e,t,v,v.fields));break;case 2:v.uniqueIdField=e.processMessage(F$e);break;default:e.skip()}return t.finishFeatureResult(v),v}function H$e(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(D$e);break;case 1:s.featureResult=e.processMessageWithArgs(j$e,t);break;default:e.skip()}return _(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function q$e(e,t){try{const r=new U1(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(H$e,t):r.skip();return s}catch(i){throw new Y("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function W$e(e,t){const i=q$e(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function p8(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=cue(i.geometryType,t,e.outSpatialReference);if(!C(r))for(const s of i.features)r(s.geometry)}const yQ="Layer does not support extent calculation.";function Vde(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function Gde(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r,n=e.outSpatialReference;let o,a;if(_(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=u2(i),s.geometry=Vde(i,e.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(t!=null&&t.returnCountOnly||t!=null&&t.returnExtentOnly||t!=null&&t.returnIdsOnly)?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?s.outSR=r.outSR.wkid||JSON.stringify(r.outSR):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&_(o)&&_(e.quantizationParameters)&&_(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c==null?"null":c},${h==null?"null":h}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&_(o)&&_(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function jde(e,t,i,r){const s=_(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await E2(e,t,"json",r);return p8(t,i,s.data),s}async function X$e(e,t,i,r){if(_(t.timeExtent)&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await Hde(e,t,r),n=s;return n.data=W$e(s.data,i),n}function Hde(e,t,i){return E2(e,t,"pbf",i)}function Y$e(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):E2(e,t,"json",i,{returnIdsOnly:!0})}function Z$e(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):E2(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function Q$e(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):E2(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(yQ);if(s.hasOwnProperty("count"))throw new Error(yQ);return r})}function E2(e,t,i,r={},s={}){const n=typeof e=="string"?ya(e):e,o=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",zde(o,null,r).then(a=>{const l=a&&a[0];_(l)&&((t=t.clone()).geometry=l);const c=kde(L(L(ge(L({},n.query),{f:i}),s),Gde(t,s)));return Pi(sb(n.path,"query"),ge(L({},r),{query:L(L({},c),r.query)}))})}var Oft=Object.freeze(Object.defineProperty({__proto__:null,encodeGeometry:Vde,executeQuery:jde,executeQueryForCount:Z$e,executeQueryForExtent:Q$e,executeQueryForIds:Y$e,executeQueryPBF:X$e,executeQueryPBFBuffer:Hde,queryToQueryStringParameters:Gde,runQuery:E2},Symbol.toStringTag,{value:"Module"})),f8;const m8=new yi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Qn=f8=class extends _e{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const i=Ke.fromJSON(t.spatialReference),r=[];for(let s=0;s<e.length;s++){const n=e[s],o=ho.fromJSON(n),a=n.geometry&&n.geometry.spatialReference;_(o.geometry)&&!a&&(o.geometry.spatialReference=i);const l=n.aggregateGeometries,c=o.aggregateGeometries;if(l&&_(c))for(const h in c){const p=c[h],f=l[h],g=f==null?void 0:f.spatialReference;_(p)&&!g&&(p.spatialReference=i)}r.push(o)}return r}writeGeometryType(e,t,i,r){if(e)return void m8.write(e,t,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&_(n.geometry))return void m8.write(n.geometry.type,t,i,r)}}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=Km(e);return!i&&t.spatialReference&&(r.spatialReference=Ke.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&_(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new f8(this.cloneProperties())}cloneProperties(){return re({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const s=e&&e[i];r.geometry=s&&s.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=c=>Math.round((c-r)/t),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)_(h)&&c(h);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=t(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return e==="point"?r=>(r.x=t(r.x),r.y=i(r.y),r):e==="polyline"||e==="polygon"?r=>{const s=P1(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,i);c&&n.push(c)}return n.length>0?(P1(r)?r.rings=n:r.paths=n,r):null}:e==="multipoint"?r=>{const s=this._quantizePoints(r.points,t,i);return s.length>0?(r.points=s,r):null}:e==="extent"?r=>r:null}_getHydrationFunction(e,t,i){return e==="point"?r=>{r.x=t(r.x),r.y=i(r.y)}:e==="polyline"||e==="polygon"?r=>{const s=P1(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=i(o)}}}:e==="extent"?r=>{r.xmin=t(r.xmin),r.ymin=i(r.ymin),r.xmax=t(r.xmax),r.ymax=i(r.ymax)}:e==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=i(o)}}:void 0}};u([d({type:String,json:{write:!0}})],Qn.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Qn.prototype,"exceededTransferLimit",void 0),u([d({type:[ho],json:{write:!0}})],Qn.prototype,"features",void 0),u([Ne("features")],Qn.prototype,"readFeatures",null),u([d({type:[jO],json:{write:!0}})],Qn.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:m8.read}}})],Qn.prototype,"geometryType",void 0),u([Xe("geometryType")],Qn.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Qn.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Qn.prototype,"hasZ",void 0),u([d({types:kb,json:{write:!0}})],Qn.prototype,"queryGeometry",void 0),u([Ne("queryGeometry")],Qn.prototype,"readQueryGeometry",null),u([d({type:Ke,json:{write:!0}})],Qn.prototype,"spatialReference",void 0),u([Xe("spatialReference")],Qn.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Qn.prototype,"transform",void 0),Qn=f8=u([P("esri.rest.support.FeatureSet")],Qn),Qn.prototype.toJSON.isDefaultToJSON=!0;const DF=Qn;var Mft=Object.freeze(Object.defineProperty({__proto__:null,default:DF},Symbol.toStringTag,{value:"Module"}));const vQ={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},J$e={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function K$e(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}function z1(e,t,i){const r=new Date(e.getTime());if(t&&i){const s=J$e[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=K$e(r.getFullYear(),r.getMonth()+t);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+t*a)}return r}function _Q(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function eDe(e,t,i){return e===0?0:e*vQ[t]/vQ[i]}var Nh;let bc=Nh=class extends _e{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return bQ}static get empty(){return tDe}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(Nh.allTime)}get isEmpty(){return this.equals(Nh.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new Nh({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=_(this.start)?this.start.getTime():this.start,i=_(this.end)?this.end.getTime():this.end,r=_(e.start)?e.start.getTime():e.start,s=_(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=Ks(this.start,r=>_Q(r,e)),i=Ks(this.end,r=>z1(_Q(r,e),1,e));return new Nh({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return Nh.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=Rc(this.start,-1/0,a=>a.getTime()),i=Rc(this.end,1/0,a=>a.getTime()),r=Rc(e.start,-1/0,a=>a.getTime()),s=Rc(e.end,1/0,a=>a.getTime());let n,o;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?o=i:s>=t&&s<=i&&(o=s),!isNaN(n)&&!isNaN(o)){const a=new Nh;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Nh.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new Nh,{start:r,end:s}=this;return _(r)&&(i.start=z1(r,e,t)),_(s)&&(i.end=z1(s,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return bQ.clone();const t=_(this.start)&&_(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=_(this.end)&&_(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new Nh({start:t,end:i})}};u([d({type:Date,json:{write:{allowNull:!0}}})],bc.prototype,"end",void 0),u([Ne("end")],bc.prototype,"readEnd",null),u([Xe("end")],bc.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],bc.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],bc.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],bc.prototype,"start",void 0),u([Ne("start")],bc.prototype,"readStart",null),u([Xe("start")],bc.prototype,"writeStart",null),bc=Nh=u([P("esri.TimeExtent")],bc);const bQ=new bc,tDe=new bc({start:void 0,end:void 0}),_f=bc;var g8;const wQ=new yi({upperLeft:"upper-left",lowerLeft:"lower-left"});let v_=g8=class extends _e{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new g8(re({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:ni,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],v_.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],v_.prototype,"mode",void 0),u([d({type:String,json:{read:wQ.read,write:wQ.write}})],v_.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],v_.prototype,"tolerance",void 0),v_=g8=u([P("esri.rest.support.QuantizationParameters")],v_);const iDe=v_;var y8;const xQ=new yi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Fh=y8=class extends _e{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=re(e))}clone(){return new y8({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:re(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],Fh.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],Fh.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],Fh.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],Fh.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],Fh.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:xQ.read},write:{target:"statisticType",writer:xQ.write}}})],Fh.prototype,"statisticType",void 0),u([d({type:Object})],Fh.prototype,"statisticParameters",void 0),u([Xe("statisticParameters")],Fh.prototype,"writeStatisticParameters",null),Fh=y8=u([P("esri.rest.support.StatisticDefinition")],Fh);const qde=Fh;var IT;const rDe=new yi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),sDe=new yi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Pt=IT=class extends _e{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return rS(IT,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new IT(re({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:_(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Pt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],Pt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],Pt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],Pt.prototype,"datumTransformation",void 0),u([Bt("datumTransformation")],Pt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Pt.prototype,"distance",void 0),u([d({type:ed,json:{write:!0}})],Pt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Pt.prototype,"formatOf3DObjects",void 0),u([d({type:String,json:{write:!0}})],Pt.prototype,"gdbVersion",void 0),u([d({types:kb,json:{read:Km,write:!0}})],Pt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Pt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],Pt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],Pt.prototype,"having",void 0),u([d({type:Date})],Pt.prototype,"historicMoment",void 0),u([Xe("historicMoment")],Pt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Pt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:e=>e<1?1:e>IT.MAX_MAX_RECORD_COUNT_FACTOR?IT.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],Pt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],Pt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Pt.prototype,"num",void 0),u([d({json:{write:!0}})],Pt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Pt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Pt.prototype,"outFields",void 0),u([d({type:Ke,json:{name:"outSR",write:!0}})],Pt.prototype,"outSpatialReference",void 0),u([d({type:[qde],json:{write:{enabled:!0,overridePolicy(){return{enabled:_(this.outStatistics)&&this.outStatistics.length>0}}}}})],Pt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],Pt.prototype,"parameterValues",void 0),u([Xe("parameterValues")],Pt.prototype,"writeParameterValues",null),u([d({type:We,json:{write:!0}})],Pt.prototype,"pixelSize",void 0),u([d({type:iDe,json:{write:!0}})],Pt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],Pt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Pt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],Pt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],Pt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],Pt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Pt.prototype,"returnZ",void 0),u([d({type:Ke,json:{write:!0}})],Pt.prototype,"sourceSpatialReference",void 0),u([vt(rDe,{ignoreUnknown:!1,name:"spatialRel"})],Pt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Pt.prototype,"start",void 0),u([Xe("start"),Xe("num")],Pt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],Pt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],Pt.prototype,"text",void 0),u([d({type:_f,json:{write:!0}})],Pt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Pt.prototype,"timeReferenceUnknownClient",void 0),u([vt(sDe,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Pt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],Pt.prototype,"where",void 0),u([Xe("where")],Pt.prototype,"writeWhere",null),Pt=IT=u([P("esri.rest.support.Query")],Pt);const Np=Pt;async function yU(e,t,i){const r=await nDe(e,t,i);return DF.fromJSON(r)}async function nDe(e,t,i){const r=Nde(e),s=L({},i),n=Np.from(t),{data:o}=await jde(r,n,n.sourceSpatialReference,s);return o}function Fo(e,t){return e?t?4:3:t?3:2}const HO=pe.getLogger("esri.layers.graphics.featureConversionUtils"),Wde={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},Xde=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},gL=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},oDe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},Yde=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function wH(e,t,i,r){if(e){if(i)return t&&r?Yde:gL;if(t&&r)return oDe}else if(t&&r)return gL;return Xde}function vU({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function _U({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function TQ({scale:e,translate:t},i){return i*e[0]+t[0]}function SQ({scale:e,translate:t},i){return t[1]-i*e[1]}function Pft(e,t,i){return e?t?i?SH(e):xH(e):i?TH(e):LF(e):null}function LF(e){const t=e.coords;return{x:t[0],y:t[1]}}function Zde(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function xH(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function aDe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function TH(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function lDe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function SH(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function cDe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function uDe(e,t,i,r){let s=LF;i&&r?s=SH:i?s=xH:r&&(s=TH);for(const n of t){const{geometry:o,attributes:a}=n,l=_(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function EH(e,t){return e&&t?cDe:e?aDe:t?lDe:Zde}function hDe(e,t,i,r,s){const n=EH(i,r);for(const o of t){const{geometry:a,attributes:l}=o;let c;a&&(c=n(new ql,a)),e.push(new nf(c,l,null,l[s]))}return e}function Ift(e,t,i=EH(t.z!=null,t.m!=null)){return i(e,t)}function dDe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;n&&(a=Qde(n,i,r)),e.push({attributes:o,geometry:a})}return e}function Qde(e,t,i){if(C(e))return null;const r=Fo(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(e.coords[n+a]);s.push(o)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function pDe(e,t,i,r,s){const n=Fo(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=Jde(new ql,a,n)),e.push(new nf(c,l,null,l[s]))}return e}function Jde(e,t,i=Fo(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let o=0;o<i;o++)r[s++]=n[o];return e}function fDe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;_(n)&&(a=Kde(n,i,r)),e.push({attributes:o,geometry:a})}return e}function Kde(e,t,i){if(!e)return null;const r=Fo(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function mDe(e,t,i,r,s){const n=Fo(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=epe(new ql,a,n)),e.push(new nf(c,l,null,l[s]))}return e}function epe(e,t,i=Fo(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return e}function gDe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o,centroid:a}=s;let l;if(_(n)&&(l=tpe(n,i,r)),_(a)){const c=LF(a);e.push({attributes:o,centroid:c,geometry:l})}else e.push({attributes:o,geometry:l})}return e}function tpe(e,t,i){if(!e)return null;const r=Fo(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function yDe(e,t,i,r,s){for(const n of t){const o=n.geometry,a=n.centroid,l=n.attributes;let c;o&&(c=ipe(new ql,o,i,r)),_(a)?e.push(new nf(c,l,Zde(new ql,a),l[s])):e.push(new nf(c,l,null,l[s]))}return e}function ipe(e,t,i=t.hasZ,r=t.hasM){return vDe(e,t.rings,i,r),e}function vDe(e,t,i,r){const s=Fo(i,r),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const $T=[],UC=[];function $ft(e,t,i,r,s){$T[0]=e;const[n]=rpe(UC,$T,t,i,r,s);return $T.length=UC.length=0,n}function rpe(e,t,i,r,s,n){if(e.length=0,!i){for(const o of t){const a=o.attributes[n];e.push(new nf(null,o.attributes,null,a))}return e}switch(i){case"esriGeometryPoint":return hDe(e,t,r,s,n);case"esriGeometryMultipoint":return pDe(e,t,r,s,n);case"esriGeometryPolyline":return mDe(e,t,r,s,n);case"esriGeometryPolygon":return yDe(e,t,r,s,n);default:HO.error("convertToFeatureSet:unknown-geometry",new Y(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function Dft(e,t,i,r){UC[0]=e,spe($T,UC,t,i,r);const s=$T[0];return $T.length=UC.length=0,s}function _De(e,t,i){if(C(e))return null;const r=new ql;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&i==null&&(i=e.hasM),K7(e)?EH(t!=null?t:e.z!=null,i!=null?i:e.m!=null)(r,e):P1(e)?ipe(r,e,t,i):ej(e)?epe(r,e,Fo(t,i)):J7(e)?Jde(r,e,Fo(t,i)):void HO.error("convertFromGeometry:unknown-geometry",new Y(`Unable to parse unknown geometry type '${e}'`))}function bDe(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(C(s))return null;switch(t){case"esriGeometryPoint":{let n=LF;return i&&r?n=SH:i?n=xH:r&&(n=TH),n(s)}case"esriGeometryMultipoint":return Qde(s,i,r);case"esriGeometryPolyline":return Kde(s,i,r);case"esriGeometryPolygon":return tpe(s,i,r);default:return void HO.error("convertToGeometry:unknown-geometry",new Y(`Unable to parse unknown geometry type '${t}'`))}}function wDe(e,t){for(const i of t)e.push({attributes:i.attributes});return e}function spe(e,t,i,r,s){if(e.length=0,C(i))return wDe(e,t);switch(i){case"esriGeometryPoint":return uDe(e,t,r,s);case"esriGeometryMultipoint":return dDe(e,t,r,s);case"esriGeometryPolyline":return fDe(e,t,r,s);case"esriGeometryPolygon":return gDe(e,t,r,s);default:HO.error("convertToFeatureSet:unknown-geometry",new Y(`Unable to parse unknown geometry type '${i}'`))}return e}function Lft(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=e,g={features:spe([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:h,queryGeometry:bDe(p,f,!1,!1)};return r&&(g.transform=r),c&&(g.exceededTransferLimit=c),n&&(g.hasM=n),o&&(g.hasZ=o),g}function Nft(e,t){const i=new $F,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(i.fields=p),i.geometryType=l,i.objectIdFieldName=o||t,i.spatialReference=a,i.objectIdFieldName?(n&&rpe(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(HO.error(new Y("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function Fft(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)_(n.geometry)&&AQ(n.geometry,n.geometry,r,s,t),_(n.centroid)&&AQ(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function Uft(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new ql,EQ(l.geometry,a.geometry,s,n,i,e),a.centroid&&(l.centroid=new ql,EQ(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),r[o]=l}return t.transform=e,t}function EQ(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),C(t)||!t.coords.length)return null;const l=Wde[s],{coords:c,lengths:h}=t,p=Fo(i,r),f=Fo(i&&o,r&&a),g=wH(i,r,o,a);if(!h.length)return g(e.coords,c,0,0,vU(n,c[0]),_U(n,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y,v,b,w,S=0,x=0,E=x;for(const R of h){if(R<l)continue;let O=0;x=E,b=y=vU(n,c[S]),w=v=_U(n,c[S+1]),g(e.coords,c,x,S,b,w),O++,S+=p,x+=f;for(let I=1;I<R;I++,S+=p)b=vU(n,c[S]),w=_U(n,c[S+1]),b===y&&w===v||(g(e.coords,c,x,S,b-y,w-v),x+=f,O++,y=b,v=w);O>=l&&(e.lengths.push(O),E=x)}return e.coords.length=E,e.coords.length?e:null}function zft(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=Wde[s],{coords:c,lengths:h}=t,p=Fo(i,r),f=Fo(i&&o,r&&a),g=wH(i,r,o,a);if(!h.length)return g(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y=0;const v=n*n;for(const b of h){if(b<l){y+=b*p;continue}const w=e.coords.length/f,S=y,x=y+(b-1)*p;g(e.coords,c,e.coords.length,S,c[S],c[S+1]),v8(e.coords,c,p,v,g,S,x),g(e.coords,c,e.coords.length,x,c[x],c[x+1]);const E=e.coords.length/f-w;E>=l?e.lengths.push(E):e.coords.length=w*f,y+=b*p}return e.coords.length?e:null}function xDe(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let h=o,p=a,f=l-h,g=c-p;if(f!==0||g!==0){const y=((s-h)*f+(n-p)*g)/(f*f+g*g);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=g*y)}return f=s-h,g=n-p,f*f+g*g}function v8(e,t,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=xDe(t,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&v8(e,t,i,r,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>i&&v8(e,t,i,r,s,c,o))}function kft(e,t,i,r){if(C(t)||!t.coords||!t.coords.length)return null;const s=Fo(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function AQ(e,t,i,r,s){const{coords:n,lengths:o}=t,a=i?r?Yde:gL:r?gL:Xde,l=Fo(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,TQ(s,n[0]),SQ(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=s.scale;let p=0;for(let f=0;f<o.length;f++){const g=o[f];e.lengths[f]=g;let y=TQ(s,n[p]),v=SQ(s,n[p+1]);a(e.coords,n,p,p,y,v),p+=l;for(let b=1;b<g;b++,p+=l)y+=n[p]*c,v-=n[p+1]*h,a(e.coords,n,p,p,y,v)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function Bft(e,t,i,r,s,n){const o=Fo(i,r),a=wH(i,r,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function TDe(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const l=n+e[r*(t+a)],c=o+e[r*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function Vft(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let o=0;o<r.length;o++)n+=TDe(i,s,r[o],t),s+=o;return Math.abs(n)}function Gft(e,t){if(C(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[t*n],c=r[t*n+1];for(let h=1;h<a;h++){const p=l+r[t*(n+h)],f=c+r[t*(n+h)+1];i.coords[t*(n+h)]=p,i.coords[t*(n+h)+1]=f,l=p,c=f}n+=a}return i}var _8;let rs=_8=class extends _e{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new _8(re({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],rs.prototype,"cacheHint",void 0),u([d({type:ed,json:{write:!0}})],rs.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],rs.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],rs.prototype,"geometryPrecision",void 0),u([d({type:Date})],rs.prototype,"historicMoment",void 0),u([Xe("historicMoment")],rs.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],rs.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],rs.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],rs.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],rs.prototype,"outFields",void 0),u([d({type:Ke,json:{read:{source:"outSR"},write:{target:"outSR"}}})],rs.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],rs.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],rs.prototype,"start",void 0),u([Xe("start"),Xe("num")],rs.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],rs.prototype,"num",void 0),u([d({json:{write:!0}})],rs.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],rs.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],rs.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],rs.prototype,"where",void 0),rs=_8=u([P("esri.rest.support.RelationshipQuery")],rs),rs.from=As(rs);const b8=rs;var w8;let Tx=w8=class extends _e{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new w8({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],Tx.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],Tx.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],Tx.prototype,"orderByFields",void 0),Tx=w8=u([P("esri.rest.support.TopFilter")],Tx);const SDe=Tx;var x8;const CQ=new yi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),RQ=new yi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Ur=x8=class extends _e{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new x8(re({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],Ur.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Ur.prototype,"distance",void 0),u([d({types:kb,json:{read:Km,write:!0}})],Ur.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Ur.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],Ur.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Ur.prototype,"num",void 0),u([d({json:{write:!0}})],Ur.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Ur.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Ur.prototype,"outFields",void 0),u([d({type:Ke,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ur.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],Ur.prototype,"resultType",void 0),u([d({json:{write:!0}})],Ur.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ur.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ur.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Ur.prototype,"start",void 0),u([Xe("start"),Xe("num")],Ur.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:CQ.read},write:{target:"spatialRel",writer:CQ.write}}})],Ur.prototype,"spatialRelationship",void 0),u([d({type:_f,json:{write:!0}})],Ur.prototype,"timeExtent",void 0),u([d({type:SDe,json:{write:!0}})],Ur.prototype,"topFilter",void 0),u([d({type:String,json:{read:RQ.read,write:{writer:RQ.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Ur.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],Ur.prototype,"where",void 0),Ur=x8=u([P("esri.rest.support.TopFeaturesQuery")],Ur),Ur.from=As(Ur);const sP=Ur,EDe="esri.widgets.Feature.support.relatedFeatureUtils",OQ=pe.getLogger(EDe),MQ=new Map;function zA(e){if(!Lm(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function ADe(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function CDe({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some(s=>(`${s.relatedTableId}`===i&&s.id===e.id&&(r=s),!!r)),r}function RDe(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}function ODe(e,t){const i=ADe(e,t);if(!!i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function MDe(e,t){if(!t||!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}function PDe(e,t,i,r){const s=new b8;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}function IDe(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function $De(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t,p=CDe({originRelationship:o,relationships:n.relationships,layerId:s});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const g=(await PDe(e,p,i,r))[e.attributes[i.objectIdField]];if(!g)return null;const y=g.features.map(v=>v.attributes[n.objectIdField]);if((l==null?void 0:l.length)>0&&n.supportsStatistics){const v=new Np;v.where=IDe(n.objectIdField,y,1e3),v.outFields=a,v.outStatistics=l,v.sourceSpatialReference=h;const b={features:Promise.resolve(g),statsFeatures:yU(c,v)};return Ka(b)}}const f=p==null?void 0:p.keyField;if(f){const g=ZN(UDe(n.fields,f)),y=RDe(e.attributes,o.keyField),v=g?`${f}=${y}`:`${f}='${y}'`,b=yU(c,new Np({where:v,outFields:t.relatedFields,sourceSpatialReference:h}),r),w=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?yU(c,new Np({where:v,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),r):null,S={features:b};return w&&(S.statsFeatures=w),Ka(S)}return null}function DDe(e,t){return Pi(e,{query:{f:"json"},signal:t&&t.signal})}function LDe({relatedInfos:e,layer:t},i){const r={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new Y("relation-required","A relation is required on a layer to retrieve related records.");throw OQ.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new Y("A related table ID is required on a layer to retrieve related records.");throw OQ.error(p),p}const l=`${t.url}/${a}`,c=MQ.get(l),h=c||DDe(l,i);c||MQ.set(l,h),r[n]=h}),Ka(r)}function NDe({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=$De(e,n,i,r))}),Ka(s)}function FDe({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new qde({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}function UDe(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const PQ={chartAnimation:!0};let Tn=class extends be{constructor(e){super(e),this.abilities=L({},PQ),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return L(L({},PQ),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(o=>{const a=o==null?void 0:o.clone();if(!a)return null;if(a.title=y1({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.title}),a.caption=y1({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.caption}),a.altText=y1({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.altText}),a.type==="image"){const{value:l}=a;return this._setImageValue({value:l,formattedAttributes:i,layer:n}),a.value.sourceURL?a:void 0}if(a.type==="pie-chart"||a.type==="line-chart"||a.type==="column-chart"||a.type==="bar-chart"){const{value:l}=a;return this._setChartValue({value:l,chartType:a.type,attributes:e,formattedAttributes:i,layer:n}),a}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const a=e8(o,s);i.sourceURL=KV({formattedAttributes:r,template:a,fieldInfoMap:t})}if(n){const a=e8(n,s);i.linkURL=KV({formattedAttributes:r,template:a,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=CIe(l,n),c&&(t.normalizeField=fL(c,n)),!l.some(p=>!!(r[p]!=null||Lm(p)&&a.size)))return;const h=o==null?void 0:o.fieldInfos;l.forEach(p=>{if(Lm(p))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:p,formattedAttributes:r,chartType:s,value:t})]);const f=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:p,fieldInfos:h});t.series.push(f)})}_getRelatedChartInfos(e){var t;const{fieldInfos:i,fieldName:r,formattedAttributes:s,chartType:n,value:o}=e,a=[],l=zA(r),{layerId:c,fieldName:h}=l,p=(t=this.relatedInfos)==null?void 0:t.get(c.toString());if(!p)return a;const{relatedFeatures:f,relation:g}=p;if(!g||!f)return a;const{cardinality:y}=g;return f.forEach(v=>{const{attributes:b}=v;b&&Object.keys(b).forEach(w=>{w===h&&a.push(this._getChartOption({value:o,attributes:b,formattedAttributes:s,fieldName:r,chartType:n,relatedFieldName:w,fieldInfos:i}))})}),y==="one-to-many"||y==="many-to-many"?a:[a[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?e:`${e}: ${t}`}_getChartOption(e){var t;const{value:i,attributes:r,formattedAttributes:s,fieldName:n,relatedFieldName:o,fieldInfos:a,chartType:l}=e,{layer:c}=this,{normalizeField:h,tooltipField:p}=i,f=h?Lm(h)?r[zA(h).fieldName]:r[h]:null,g=o&&r[o]!==void 0?r[o]:r[n]!==void 0?r[n]:s[n],y=g===void 0?null:g&&f?g/f:g,v=new ale({value:y});if(Lm(n)){const E=zA(n),R=zA(p),O=R?R.fieldName:null,I=Tde(y,{fieldInfos:a,fieldName:o,layer:c,preventPlacesFormatting:!!f}),U=E?E.label||E.fieldName:o,N=O&&r[O]!==void 0?r[O]:U;return v.tooltip=this._getTooltip({label:N,value:I,chartType:l}),v}const b=Sde(a,n),w=fL(n,c),S=p&&s[p]!==void 0?s[p]:wde(b||new FO({fieldName:w}),(t=this.popupTemplate)==null?void 0:t.expressionInfos),x=s[w];return v.tooltip=this._getTooltip({label:S,value:x,chartType:l}),v}};u([d()],Tn.prototype,"abilities",void 0),u([Bt("abilities")],Tn.prototype,"castAbilities",null),u([d()],Tn.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],Tn.prototype,"activeMediaInfo",null),u([d()],Tn.prototype,"attributes",void 0),u([d()],Tn.prototype,"description",void 0),u([d()],Tn.prototype,"fieldInfoMap",void 0),u([d()],Tn.prototype,"formattedAttributes",void 0),u([d()],Tn.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],Tn.prototype,"formattedMediaInfos",null),u([d()],Tn.prototype,"layer",void 0),u([d({readOnly:!0})],Tn.prototype,"formattedMediaInfoCount",null),u([d()],Tn.prototype,"mediaInfos",void 0),u([d()],Tn.prototype,"popupTemplate",void 0),u([d()],Tn.prototype,"relatedInfos",void 0),u([d()],Tn.prototype,"title",void 0),Tn=u([P("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Tn);const _1=Tn;var IQ=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],zDe=[].concat(IQ.slice(30,39),IQ.slice(28,30).reverse()),kDe=[{name:"default",colors:zDe},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const $Q="en-us",AH=new Map([["ar",()=>import("./ar.5d7bdca7.js").then(e=>e.a)],["bg-bg",()=>import("./bg_BG.e6ba29c2.js").then(e=>e.b)],["bs-ba",()=>import("./bs_BA.14911a00.js").then(e=>e.b)],["ca-es",()=>import("./ca_ES.1a938920.js").then(e=>e.c)],["cs-cz",()=>import("./cs_CZ.8624de8a.js").then(e=>e.c)],["da-dk",()=>import("./da_DK.aef5a9c8.js").then(e=>e.d)],["de-de",()=>import("./de_DE.b08b4cf1.js").then(e=>e.d)],["de-ch",()=>import("./de_CH.0b6cd702.js").then(e=>e.d)],["el-gr",()=>import("./el_GR.8e618bc9.js").then(e=>e.e)],["en-us",()=>import("./en_US.41c717af.js").then(e=>e.e)],["en-ca",()=>import("./en_CA.f60d00bf.js").then(e=>e.e)],["es-es",()=>import("./es_ES.1f0f76f4.js").then(e=>e.e)],["et-ee",()=>import("./et_EE.a7babafb.js").then(e=>e.e)],["fi-fi",()=>import("./fi_FI.fdc0a8b3.js").then(e=>e.f)],["fr-fr",()=>import("./fr_FR.9fb72c1a.js").then(e=>e.f)],["he-il",()=>import("./he_IL.3941bb8a.js").then(e=>e.h)],["hr-hr",()=>import("./hr_HR.0f5af0f2.js").then(e=>e.h)],["hu-hu",()=>import("./hu_HU.b4dae139.js").then(e=>e.h)],["id-id",()=>import("./id_ID.f5b918ea.js").then(e=>e.i)],["it-it",()=>import("./it_IT.94769a92.js").then(e=>e.i)],["ja-jp",()=>import("./ja_JP.8eb86db8.js").then(e=>e.j)],["ko-kr",()=>import("./ko_KR.8ba7fd29.js").then(e=>e.k)],["lt-lt",()=>import("./lt_LT.d8c1cc92.js").then(e=>e.l)],["lv-lv",()=>import("./lv_LV.ceb923a4.js").then(e=>e.l)],["nb-no",()=>import("./nb_NO.d0457d8e.js").then(e=>e.n)],["nl-nl",()=>import("./nl_NL.fbf1ad03.js").then(e=>e.n)],["pl-pl",()=>import("./pl_PL.44d49398.js").then(e=>e.p)],["pt-br",()=>import("./pt_BR.89b1d3a7.js").then(e=>e.p)],["pt-pt",()=>import("./pt_PT.2abd4e91.js").then(e=>e.p)],["ro-ro",()=>import("./ro_RO.fb4fff60.js").then(e=>e.r)],["ru-ru",()=>import("./ru_RU.684f53ee.js").then(e=>e.r)],["sk-sk",()=>import("./sk_SK.eaca904e.js").then(e=>e.s)],["sl-sl",()=>import("./sl_SL.cff9b92a.js").then(e=>e.s)],["sr-rs",()=>import("./sr_RS.44ddc4cf.js").then(e=>e.s)],["sv-se",()=>import("./sv_SE.16043ad0.js").then(e=>e.s)],["th-th",()=>import("./th_TH.99f2a35e.js").then(e=>e.t)],["tr-tr",()=>import("./tr_TR.ab1c9f2f.js").then(e=>e.t)],["uk-ua",()=>import("./uk_UA.ae3608ad.js").then(e=>e.u)],["vi-vn",()=>import("./vi_VN.7d19f32e.js").then(e=>e.v)],["zh-cn",()=>import("./zh_Hans.0f482448.js").then(e=>e.z)],["zh-hk",()=>import("./zh_Hant.f458376f.js").then(e=>e.z)],["zh-tw",()=>import("./zh_Hant.f458376f.js").then(e=>e.z)]]);function BDe(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of AH.keys())if(r.startsWith(t)){i=r;break}return i}function VDe(e){return e?AH.has(e.toLowerCase())?e.toLowerCase():BDe(e)||$Q:$Q}let pw,oE;async function GDe(e=Uc()){if(e=VDe(e),pw&&e===oE)return pw;pw=import("./index.9e9547dc.js").then(t=>t.i),oE=e;try{const[t,i]=await Promise.all([pw,AH.get(oE)()]);oE===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return pw=null,oE=null,null}return pw}function jDe(e,t="default"){const i=kDe.find(r=>r.name===t);return i?i.colors.map(r=>e.color(r)):null}const us={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},bU=.05,wU=.95,xU=15;let _l=class extends va{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new _1,this.messages=null,this._getChartDependencies=async i=>{const r=await GDe(),{destroyed:s,viewModel:n}=this;if(s||!n||!i)return;const{activeMediaInfo:o}=n;this._renderChart({chartDiv:i,mediaInfo:o,chartsModule:r})}}initialize(){this._featureElementInfo=new _H,this.own([xe(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Bi),xe(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Bi)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return ae("div",{bind:this,class:us.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?ae("div",{key:"media-element-container",class:us.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=_de(h)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",g=n?t:null,y=g?g.timestamp:0,v=g?g.sourceURL:c,b=ae("img",{alt:o||a,key:`media-${l}-${i}-${r}-${y}`,src:v});return(h?ae("a",{title:a,href:h,rel:f,target:p},b):null)||b}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return ae("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:us.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?ae("div",{key:"media-title",class:us.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?ae("div",{key:"media-caption",class:us.mediaItemCaption,innerHTML:e.caption}):null;return ae("div",{key:"media-container",class:us.mediaItemContainer},ae("div",{key:"media-item-container",class:us.mediaItem},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?this.classes(us.mediaButton,us.mediaPrevious):this.classes(us.mediaButton,us.mediaNext),s=t?this.classes(us.mediaIcon,us.mediaPreviousIconLTR,us.iconLeftTriangleArrow):this.classes(us.mediaIcon,us.mediaNextIconLTR,us.iconRightTriangleArrow),n=t?this.classes(us.mediaIcon,us.mediaPreviousIconRTL,us.iconRightTriangleArrow):this.classes(us.mediaIcon,us.mediaNextIconRTL,us.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return ae("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:a},ae("span",{"aria-hidden":"true",class:s}),ae("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_handleMediaKeyup(e){const t=Q_(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s}=e,{value:n,type:o}=s,{am4core:a}=i,l=jDe(a);function c(f){f instanceof a.ColorSet&&l&&(f.list=l)}Ode()&&a.useTheme(i.am4themes_dark);const h=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!h.matches?a.useTheme(i.am4themes_animated):a.unuseTheme(i.am4themes_animated),a.useTheme(c);const p=o==="pie-chart"?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),p.data=n.series.map(f=>({tooltip:f.tooltip,value:f.value})).filter(f=>o!=="pie-chart"||f.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=d0(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value="value",o.dataFields.category="tooltip",this._customizeChartTooltip(o.tooltip,r),o.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",n}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=bU,l.renderer.maxLabelPosition=wU,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueY="value",h.dataFields.categoryX="tooltip",e.cursor=new o.XYCursor,s.series.length>xU&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dx=a.tooltip.contentWidth});const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=bU,l.renderer.maxLabelPosition=wU,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueX="value",h.dataFields.categoryY="tooltip",e.cursor=new o.XYCursor,s.series.length>xU&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=bU,l.renderer.maxLabelPosition=wU,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.LineSeries);h.dataFields.categoryX="tooltip",h.dataFields.valueY="value",e.cursor=new o.XYCursor,s.series.length>xU&&(e.scrollbarX=new n.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=d0(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};u([xt("viewModel.attributes")],_l.prototype,"attributes",void 0),u([xt("viewModel.activeMediaInfoIndex")],_l.prototype,"activeMediaInfoIndex",void 0),u([xt("viewModel.description")],_l.prototype,"description",void 0),u([xt("viewModel.fieldInfoMap")],_l.prototype,"fieldInfoMap",void 0),u([xt("viewModel.layer")],_l.prototype,"layer",void 0),u([xt("viewModel.mediaInfos")],_l.prototype,"mediaInfos",void 0),u([xt("viewModel.popupTemplate")],_l.prototype,"popupTemplate",void 0),u([xt("viewModel.relatedInfos")],_l.prototype,"relatedInfos",void 0),u([xt("viewModel.title")],_l.prototype,"title",void 0),u([d({type:_1})],_l.prototype,"viewModel",void 0),u([d(),Bl("esri/widgets/Feature/t9n/Feature")],_l.prototype,"messages",void 0),_l=u([P("esri.widgets.Feature.FeatureMedia")],_l);const npe=_l;class HDe{constructor(t,i){this.definition=null,this.context=null,this.definition=t,this.context=i}}class bf{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let i=0;i<this.length();i++)t.push(this.get(i));return t}}class Zb extends bf{constructor(t,i,r,s,n,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=i,this._hasZ=r,this._hasM=s,this._cacheId=n,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const i=this._elements[t];if(i===void 0)return;const r=this._hasZ,s=this._hasM;let n=null;n=r&&!s?new We(i[0],i[1],i[2],void 0,this._spRef):s&&!r?new We(i[0],i[1],void 0,i[2],this._spRef):r&&s?new We(i[0],i[1],i[2],i[3],this._spRef):new We(i[0],i[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=n}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof Zb&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class CH extends bf{constructor(t,i,r,s,n){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=i,this._cacheId=n}get(t){if(this._lazyPath[t]===void 0){const i=this._elements[t];if(i===void 0)return;this._lazyPath[t]=new Zb(i,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof CH&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class Qb extends Error{}class qDe extends Qb{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class WDe extends Qb{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class XDe extends Qb{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class kA extends Qb{}class ope extends Qb{constructor(t){super(`Invalid unit ${t}`)}}class ku extends Qb{}class Dg extends Qb{constructor(){super("Zone is an abstract class")}}const Ye="numeric",Od="short",Vc="long",T8={year:Ye,month:Ye,day:Ye},ape={year:Ye,month:Od,day:Ye},YDe={year:Ye,month:Od,day:Ye,weekday:Od},lpe={year:Ye,month:Vc,day:Ye},cpe={year:Ye,month:Vc,day:Ye,weekday:Vc},upe={hour:Ye,minute:Ye},hpe={hour:Ye,minute:Ye,second:Ye},dpe={hour:Ye,minute:Ye,second:Ye,timeZoneName:Od},ppe={hour:Ye,minute:Ye,second:Ye,timeZoneName:Vc},fpe={hour:Ye,minute:Ye,hourCycle:"h23"},mpe={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23"},gpe={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:Od},ype={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:Vc},vpe={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye},_pe={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye,second:Ye},bpe={year:Ye,month:Od,day:Ye,hour:Ye,minute:Ye},wpe={year:Ye,month:Od,day:Ye,hour:Ye,minute:Ye,second:Ye},ZDe={year:Ye,month:Od,day:Ye,weekday:Od,hour:Ye,minute:Ye},xpe={year:Ye,month:Vc,day:Ye,hour:Ye,minute:Ye,timeZoneName:Od},Tpe={year:Ye,month:Vc,day:Ye,hour:Ye,minute:Ye,second:Ye,timeZoneName:Od},Spe={year:Ye,month:Vc,day:Ye,weekday:Vc,hour:Ye,minute:Ye,timeZoneName:Vc},Epe={year:Ye,month:Vc,day:Ye,weekday:Vc,hour:Ye,minute:Ye,second:Ye,timeZoneName:Vc};function zi(e){return typeof e=="undefined"}function k1(e){return typeof e=="number"}function NF(e){return typeof e=="number"&&e%1===0}function QDe(e){return typeof e=="string"}function JDe(e){return Object.prototype.toString.call(e)==="[object Date]"}function Ape(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch{return!1}}function KDe(e){return Array.isArray(e)?e:[e]}function DQ(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const n=[t(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function eLe(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function RS(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Nm(e,t,i){return NF(e)&&e>=t&&e<=i}function tLe(e,t){return e-t*Math.floor(e/t)}function pn(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function ky(e){if(!(zi(e)||e===null||e===""))return parseInt(e,10)}function wv(e){if(!(zi(e)||e===null||e===""))return parseFloat(e)}function RH(e){if(!(zi(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function OH(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function qO(e){return e%4===0&&(e%100!==0||e%400===0)}function zC(e){return qO(e)?366:365}function yL(e,t){const i=tLe(t-1,12)+1,r=e+(t-i)/12;return i===2?qO(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function MH(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function vL(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return t===4||r===3?53:52}function S8(e){return e>99?e:e>60?1900+e:2e3+e}function Cpe(e,t,i,r=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o=L({timeZoneName:t},n),a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function FF(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function Rpe(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new ku(`Invalid unit value ${e}`);return t}function _L(e,t){const i={};for(const r in e)if(RS(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=Rpe(s)}return i}function bL(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${pn(i,2)}:${pn(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${pn(i,2)}${pn(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function UF(e){return eLe(e,["hour","minute","second","millisecond"])}const iLe=/[A-Za-z_+-]{1,256}(:?\/[A-Za-z0-9_+-]{1,256}(\/[A-Za-z0-9_+-]{1,256})?)?/,rLe=["January","February","March","April","May","June","July","August","September","October","November","December"],Ope=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],sLe=["J","F","M","A","M","J","J","A","S","O","N","D"];function Mpe(e){switch(e){case"narrow":return[...sLe];case"short":return[...Ope];case"long":return[...rLe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Ppe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Ipe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],nLe=["M","T","W","T","F","S","S"];function $pe(e){switch(e){case"narrow":return[...nLe];case"short":return[...Ipe];case"long":return[...Ppe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Dpe=["AM","PM"],oLe=["Before Christ","Anno Domini"],aLe=["BC","AD"],lLe=["B","A"];function Lpe(e){switch(e){case"narrow":return[...lLe];case"short":return[...aLe];case"long":return[...oLe];default:return null}}function cLe(e){return Dpe[e.hour<12?0:1]}function uLe(e,t){return $pe(t)[e.weekday-1]}function hLe(e,t){return Mpe(t)[e.month-1]}function dLe(e,t){return Lpe(t)[e.year<0?0:1]}function pLe(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=r?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function LQ(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const fLe={D:T8,DD:ape,DDD:lpe,DDDD:cpe,t:upe,tt:hpe,ttt:dpe,tttt:ppe,T:fpe,TT:mpe,TTT:gpe,TTTT:ype,f:vpe,ff:bpe,fff:xpe,ffff:Spe,F:_pe,FF:wpe,FFF:Tpe,FFFF:Epe};class zl{static create(t,i={}){return new zl(t,i)}static parseFormat(t){let i=null,r="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(t){return fLe[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,L(L({},this.opts),i)).format()}formatDateTime(t,i={}){return this.loc.dtFormatter(t,L(L({},this.opts),i)).format()}formatDateTimeParts(t,i={}){return this.loc.dtFormatter(t,L(L({},this.opts),i)).formatToParts()}resolvedOptions(t,i={}){return this.loc.dtFormatter(t,L(L({},this.opts),i)).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return pn(t,i);const r=L({},this.opts);return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(g,y)=>this.loc.extract(t,g,y),o=g=>t.isOffsetFixed&&t.offset===0&&g.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,g.format):"",a=()=>r?cLe(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(g,y)=>r?hLe(t,g):n(y?{month:g}:{month:g,day:"numeric"},"month"),c=(g,y)=>r?uLe(t,g):n(y?{weekday:g}:{weekday:g,month:"long",day:"numeric"},"weekday"),h=g=>{const y=zl.macroTokenToFormatOpts(g);return y?this.formatWithSystemDefault(t,y):g},p=g=>r?dLe(t,g):n({era:g},"era"),f=g=>{switch(g){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(g)}};return LQ(zl.parseFormat(i),f)}formatDurationFromString(t,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=zl.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(r).filter(l=>l));return LQ(n,s(a))}}class fd{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class WO{get type(){throw new Dg}get name(){throw new Dg}get isUniversal(){throw new Dg}offsetName(t,i){throw new Dg}formatOffset(t,i){throw new Dg}offset(t){throw new Dg}equals(t){throw new Dg}get isValid(){throw new Dg}}let TU=null;class PH extends WO{static get instance(){return TU===null&&(TU=new PH),TU}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return Cpe(t,i,r)}formatOffset(t,i){return bL(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let s$={};function mLe(e){return s$[e]||(s$[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),s$[e]}const gLe={year:0,month:1,day:2,hour:3,minute:4,second:5};function yLe(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c]=r;return[o,s,n,a,l,c]}function vLe(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=gLe[n];zi(a)||(r[a]=parseInt(o,10))}return r}let nP={};class ag extends WO{static create(t){return nP[t]||(nP[t]=new ag(t)),nP[t]}static resetCache(){nP={},s$={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=ag.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return Cpe(t,i,r,this.name)}formatOffset(t,i){return bL(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=mLe(this.name),[s,n,o,a,l,c]=r.formatToParts?vLe(r,i):yLe(r,i),p=MH({year:s,month:n,day:o,hour:a===24?0:a,minute:l,second:c,millisecond:0});let f=+i;const g=f%1e3;return f-=g>=0?g:1e3+g,(p-f)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let SU=null;class Wa extends WO{static get utcInstance(){return SU===null&&(SU=new Wa(0)),SU}static instance(t){return t===0?Wa.utcInstance:new Wa(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Wa(FF(i[1],i[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${bL(this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return bL(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class _Le extends WO{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Jy(e,t){if(zi(e)||e===null)return t;if(e instanceof WO)return e;if(QDe(e)){const i=e.toLowerCase();return i==="local"||i==="system"?t:i==="utc"||i==="gmt"?Wa.utcInstance:Wa.parseSpecifier(i)||ag.create(e)}else return k1(e)?Wa.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new _Le(e)}let NQ=()=>Date.now(),FQ="system",UQ=null,zQ=null,kQ=null,BQ;class On{static get now(){return NQ}static set now(t){NQ=t}static set defaultZone(t){FQ=t}static get defaultZone(){return Jy(FQ,PH.instance)}static get defaultLocale(){return UQ}static set defaultLocale(t){UQ=t}static get defaultNumberingSystem(){return zQ}static set defaultNumberingSystem(t){zQ=t}static get defaultOutputCalendar(){return kQ}static set defaultOutputCalendar(t){kQ=t}static get throwOnInvalid(){return BQ}static set throwOnInvalid(t){BQ=t}static resetCaches(){_s.resetCache(),ag.resetCache()}}let VQ={};function bLe(e,t={}){const i=JSON.stringify([e,t]);let r=VQ[i];return r||(r=new Intl.ListFormat(e,t),VQ[i]=r),r}let E8={};function A8(e,t={}){const i=JSON.stringify([e,t]);let r=E8[i];return r||(r=new Intl.DateTimeFormat(e,t),E8[i]=r),r}let C8={};function wLe(e,t={}){const i=JSON.stringify([e,t]);let r=C8[i];return r||(r=new Intl.NumberFormat(e,t),C8[i]=r),r}let R8={};function xLe(e,t={}){const o=t,{base:i}=o,r=O5(o,["base"]),s=JSON.stringify([e,r]);let n=R8[s];return n||(n=new Intl.RelativeTimeFormat(e,t),R8[s]=n),n}let BA=null;function TLe(){return BA||(BA=new Intl.DateTimeFormat().resolvedOptions().locale,BA)}function SLe(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let i;const r=e.substring(0,t);try{i=A8(e).resolvedOptions()}catch{i=A8(r).resolvedOptions()}const{numberingSystem:s,calendar:n}=i;return[r,s,n]}}function ELe(e,t,i){return(i||t)&&(e+="-u",i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function ALe(e){const t=[];for(let i=1;i<=12;i++){const r=Zt.utc(2016,i,1);t.push(e(r))}return t}function CLe(e){const t=[];for(let i=1;i<=7;i++){const r=Zt.utc(2016,11,13+i);t.push(e(r))}return t}function oP(e,t,i,r,s){const n=e.listingMode(i);return n==="error"?null:n==="en"?r(t):s(t)}function RLe(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class OLe{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const a=r,{padTo:s,floor:n}=a,o=O5(a,["padTo","floor"]);if(!i||Object.keys(o).length>0){const l=L({useGrouping:!1},r);r.padTo>0&&(l.minimumIntegerDigits=r.padTo),this.inf=wLe(t,l)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):OH(t,3);return pn(i,this.padTo)}}}class MLe{constructor(t,i,r){this.opts=r;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&ag.create(a).valid?(s=a,this.dt=t):(s="UTC",r.timeZoneName?this.dt=t:this.dt=t.offset===0?t:Zt.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n=L({},this.opts);s&&(n.timeZone=s),this.dtf=A8(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class PLe{constructor(t,i,r){this.opts=L({style:"long"},r),!i&&Ape()&&(this.rtf=xLe(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):pLe(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}class _s{static fromOpts(t){return _s.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,i,r,s=!1){const n=t||On.defaultLocale,o=n||(s?"en-US":TLe()),a=i||On.defaultNumberingSystem,l=r||On.defaultOutputCalendar;return new _s(o,a,l,n)}static resetCache(){BA=null,E8={},C8={},R8={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r}={}){return _s.create(t,i,r)}constructor(t,i,r,s){const[n,o,a]=SLe(t);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=ELe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=RLe(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:_s.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone(ge(L({},t),{defaultToEN:!0}))}redefaultToSystem(t={}){return this.clone(ge(L({},t),{defaultToEN:!1}))}months(t,i=!1,r=!0){return oP(this,t,r,Mpe,()=>{const s=i?{month:t,day:"numeric"}:{month:t},n=i?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=ALe(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,i=!1,r=!0){return oP(this,t,r,$pe,()=>{const s=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=i?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=CLe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return oP(this,void 0,t,()=>Dpe,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Zt.utc(2016,11,13,9),Zt.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(t,i=!0){return oP(this,t,i,Lpe,()=>{const r={era:t};return this.eraCache[t]||(this.eraCache[t]=[Zt.utc(-40,1,1),Zt.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(t={}){return new OLe(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new MLe(t,this.intl,i)}relFormatter(t={}){return new PLe(this.intl,this.isEnglish(),t)}listFormatter(t={}){return bLe(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function A2(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function Jb(...e){return t=>e.reduce(([i,r,s],n)=>{const[o,a,l]=n(t,s);return[L(L({},i),o),r||a,l]},[{},null,1]).slice(0,2)}function C2(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function Npe(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=ky(t[i+s]);return[r,null,i+s]}}const Fpe=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,IH=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Upe=RegExp(`${IH.source}${Fpe.source}?`),$H=RegExp(`(?:T${Upe.source})?`),ILe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,$Le=/(\d{4})-?W(\d\d)(?:-?(\d))?/,DLe=/(\d{4})-?(\d{3})/,LLe=Npe("weekYear","weekNumber","weekDay"),NLe=Npe("year","ordinal"),FLe=/(\d{4})-(\d\d)-(\d\d)/,zpe=RegExp(`${IH.source} ?(?:${Fpe.source}|(${iLe.source}))?`),ULe=RegExp(`(?: ${zpe.source})?`);function DT(e,t,i){const r=e[t];return zi(r)?i:ky(r)}function kpe(e,t){return[{year:DT(e,t),month:DT(e,t+1,1),day:DT(e,t+2,1)},null,t+3]}function Kb(e,t){return[{hours:DT(e,t,0),minutes:DT(e,t+1,0),seconds:DT(e,t+2,0),milliseconds:RH(e[t+3])},null,t+4]}function R2(e,t){const i=!e[t]&&!e[t+1],r=FF(e[t+1],e[t+2]),s=i?null:Wa.instance(r);return[{},s,t+3]}function Bpe(e,t){const i=e[t]?ag.create(e[t]):null;return[{},i,t+1]}const zLe=RegExp(`^T?${IH.source}$`),kLe=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function BLe(e){const[t,i,r,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",f=(g,y=!1)=>g!==void 0&&(y||g&&h)?-g:g;return[{years:f(wv(i)),months:f(wv(r)),weeks:f(wv(s)),days:f(wv(n)),hours:f(wv(o)),minutes:f(wv(a)),seconds:f(wv(l),l==="-0"),milliseconds:f(RH(c),p)}]}const VLe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function DH(e,t,i,r,s,n,o){const a={year:t.length===2?S8(ky(t)):ky(t),month:Ope.indexOf(i)+1,day:ky(r),hour:ky(s),minute:ky(n)};return o&&(a.second=ky(o)),e&&(a.weekday=e.length>3?Ppe.indexOf(e)+1:Ipe.indexOf(e)+1),a}const GLe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function jLe(e){const[,t,i,r,s,n,o,a,l,c,h,p]=e,f=DH(t,s,r,i,n,o,a);let g;return l?g=VLe[l]:c?g=0:g=FF(h,p),[f,new Wa(g)]}function HLe(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const qLe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,WLe=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,XLe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function GQ(e){const[,t,i,r,s,n,o,a]=e;return[DH(t,s,r,i,n,o,a),Wa.utcInstance]}function YLe(e){const[,t,i,r,s,n,o,a]=e;return[DH(t,a,i,r,s,n,o),Wa.utcInstance]}const ZLe=A2(ILe,$H),QLe=A2($Le,$H),JLe=A2(DLe,$H),KLe=A2(Upe),eNe=Jb(kpe,Kb,R2),tNe=Jb(LLe,Kb,R2),iNe=Jb(NLe,Kb,R2),rNe=Jb(Kb,R2);function sNe(e){return C2(e,[ZLe,eNe],[QLe,tNe],[JLe,iNe],[KLe,rNe])}function nNe(e){return C2(HLe(e),[GLe,jLe])}function oNe(e){return C2(e,[qLe,GQ],[WLe,GQ],[XLe,YLe])}function aNe(e){return C2(e,[kLe,BLe])}const lNe=Jb(Kb);function cNe(e){return C2(e,[zLe,lNe])}const uNe=A2(FLe,ULe),hNe=A2(zpe),dNe=Jb(kpe,Kb,R2,Bpe),pNe=Jb(Kb,R2,Bpe);function fNe(e){return C2(e,[uNe,dNe],[hNe,pNe])}const mNe="Invalid Duration",Vpe={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},gNe=L({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},Vpe),ou=146097/400,fw=146097/4800,yNe=L({years:{quarters:4,months:12,weeks:ou/7,days:ou,hours:ou*24,minutes:ou*24*60,seconds:ou*24*60*60,milliseconds:ou*24*60*60*1e3},quarters:{months:3,weeks:ou/28,days:ou/4,hours:ou*24/4,minutes:ou*24*60/4,seconds:ou*24*60*60/4,milliseconds:ou*24*60*60*1e3/4},months:{weeks:fw/7,days:fw,hours:fw*24,minutes:fw*24*60,seconds:fw*24*60*60,milliseconds:fw*24*60*60*1e3}},Vpe),__=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],vNe=__.slice(0).reverse();function xv(e,t,i=!1){const r={values:i?t.values:L(L({},e.values),t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new qi(r)}function _Ne(e){return e<0?Math.floor(e):Math.ceil(e)}function Gpe(e,t,i,r,s){const n=e[s][i],o=t[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?_Ne(o):Math.trunc(o);r[s]+=l,t[i]-=l*n}function bNe(e,t){vNe.reduce((i,r)=>zi(t[r])?i:(i&&Gpe(e,t,i,t,r),r),null)}class qi{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||_s.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i?yNe:gNe,this.isLuxonDuration=!0}static fromMillis(t,i){return qi.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new ku(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new qi({values:_L(t,qi.normalizeUnit),loc:_s.fromObject(i),conversionAccuracy:i.conversionAccuracy})}static fromDurationLike(t){if(k1(t))return qi.fromMillis(t);if(qi.isDuration(t))return t;if(typeof t=="object")return qi.fromObject(t);throw new ku(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=aNe(t);return r?qi.fromObject(r,i):qi.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=cNe(t);return r?qi.fromObject(r,i):qi.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new ku("need to specify a reason the Duration is invalid");const r=t instanceof fd?t:new fd(t,i);if(On.throwOnInvalid)throw new XDe(r);return new qi({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new ope(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r=ge(L({},i),{floor:i.round!==!1&&i.floor!==!1});return this.isValid?zl.create(this.loc,r).formatDurationFromString(this,t):mNe}toHuman(t={}){const i=__.map(r=>{const s=this.values[r];return zi(s)?null:this.loc.numberFormatter(ge(L({style:"unit",unitDisplay:"long"},t),{unit:r.slice(0,-1)})).format(s)}).filter(r=>r);return this.loc.listFormatter(L({type:"conjunction",style:t.listStyle||"narrow"},t)).format(i)}toObject(){return this.isValid?L({},this.values):{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=OH(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;t=L({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},t);const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=qi.fromDurationLike(t),r={};for(const s of __)(RS(i.values,s)||RS(this.values,s))&&(r[s]=i.get(s)+this.get(s));return xv(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=qi.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=Rpe(t(this.values[r],r));return xv(this,{values:i},!0)}get(t){return this[qi.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i=L(L({},this.values),_L(t,qi.normalizeUnit));return xv(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i}),n={loc:s};return r&&(n.conversionAccuracy=r),xv(this,n)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return bNe(this.matrix,t),xv(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>qi.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of __)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;k1(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)__.indexOf(c)>__.indexOf(o)&&Gpe(this.matrix,s,c,i,o)}else k1(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return xv(this,{values:i},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return xv(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of __)if(!i(this.values[r],t.values[r]))return!1;return!0}}const aE="Invalid Interval";function wNe(e,t){return!e||!e.isValid?Ds.invalid("missing or invalid start"):!t||!t.isValid?Ds.invalid("missing or invalid end"):t<e?Ds.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class Ds{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new ku("need to specify a reason the Interval is invalid");const r=t instanceof fd?t:new fd(t,i);if(On.throwOnInvalid)throw new WDe(r);return new Ds({invalid:r})}static fromDateTimes(t,i){const r=uE(t),s=uE(i),n=wNe(r,s);return n==null?new Ds({start:r,end:s}):n}static after(t,i){const r=qi.fromDurationLike(i),s=uE(t);return Ds.fromDateTimes(s,s.plus(r))}static before(t,i){const r=qi.fromDurationLike(i),s=uE(t);return Ds.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let n,o;try{n=Zt.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=Zt.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return Ds.fromDateTimes(n,a);if(o){const c=qi.fromISO(s,i);if(c.isValid)return Ds.after(n,c)}else if(l){const c=qi.fromISO(r,i);if(c.isValid)return Ds.before(a,c)}}return Ds.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(i,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?Ds.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(uE).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(Ds.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(t){const i=qi.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Ds.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:Ds.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return Ds.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Ds.fromDateTimes(i,l.time)),i=null);return Ds.merge(s)}difference(...t){return Ds.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:aE}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:aE}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:aE}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:aE}toFormat(t,{separator:i=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:aE}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):qi.invalid(this.invalidReason)}mapEndpoints(t){return Ds.fromDateTimes(t(this.s),t(this.e))}}class aP{static hasDST(t=On.defaultZone){const i=Zt.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return ag.isValidZone(t)}static normalizeZone(t){return Jy(t,On.defaultZone)}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||_s.create(i,r,n)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||_s.create(i,r,n)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||_s.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||_s.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return _s.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return _s.create(i,null,"gregory").eras(t)}static features(){return{relative:Ape()}}}function jQ(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(qi.fromMillis(r).as("days"))}function xNe(e,t,i){const r=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=jQ(a,l);return(c-c%7)/7}],["days",jQ]],s={};let n,o;for(const[a,l]of r)if(i.indexOf(a)>=0){n=a;let c=l(e,t);o=e.plus({[a]:c}),o>t?(e=e.plus({[a]:c-1}),c-=1):e=o,s[a]=c}return[e,s,o,n]}function TNe(e,t,i,r){let[s,n,o,a]=xNe(e,t,i);const l=t-s,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=qi.fromObject(n,r);return c.length>0?qi.fromMillis(l,r).shiftTo(...c).plus(h):h}const LH={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},HQ={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},SNe=LH.hanidec.replace(/[\[|\]]/g,"").split("");function ENe(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(LH.hanidec)!==-1)t+=SNe.indexOf(e[i]);else for(const s in HQ){const[n,o]=HQ[s];r>=n&&r<=o&&(t+=r-n)}}return parseInt(t,10)}else return t}function wh({numberingSystem:e},t=""){return new RegExp(`${LH[e||"latn"]}${t}`)}const ANe="missing Intl.DateTimeFormat.formatToParts support";function or(e,t=i=>i){return{regex:e,deser:([i])=>t(ENe(i))}}const CNe=String.fromCharCode(160),jpe=`( |${CNe})`,Hpe=new RegExp(jpe,"g");function RNe(e){return e.replace(/\./g,"\\.?").replace(Hpe,jpe)}function qQ(e){return e.replace(/\./g,"").replace(Hpe," ").toLowerCase()}function xh(e,t){return e===null?null:{regex:RegExp(e.map(RNe).join("|")),deser:([i])=>e.findIndex(r=>qQ(i)===qQ(r))+t}}function WQ(e,t){return{regex:e,deser:([,i,r])=>FF(i,r),groups:t}}function EU(e){return{regex:e,deser:([t])=>t}}function ONe(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function MNe(e,t){const i=wh(t),r=wh(t,"{2}"),s=wh(t,"{3}"),n=wh(t,"{4}"),o=wh(t,"{6}"),a=wh(t,"{1,2}"),l=wh(t,"{1,3}"),c=wh(t,"{1,6}"),h=wh(t,"{1,9}"),p=wh(t,"{2,4}"),f=wh(t,"{4,6}"),g=b=>({regex:RegExp(ONe(b.val)),deser:([w])=>w,literal:!0}),v=(b=>{if(e.literal)return g(b);switch(b.val){case"G":return xh(t.eras("short",!1),0);case"GG":return xh(t.eras("long",!1),0);case"y":return or(c);case"yy":return or(p,S8);case"yyyy":return or(n);case"yyyyy":return or(f);case"yyyyyy":return or(o);case"M":return or(a);case"MM":return or(r);case"MMM":return xh(t.months("short",!0,!1),1);case"MMMM":return xh(t.months("long",!0,!1),1);case"L":return or(a);case"LL":return or(r);case"LLL":return xh(t.months("short",!1,!1),1);case"LLLL":return xh(t.months("long",!1,!1),1);case"d":return or(a);case"dd":return or(r);case"o":return or(l);case"ooo":return or(s);case"HH":return or(r);case"H":return or(a);case"hh":return or(r);case"h":return or(a);case"mm":return or(r);case"m":return or(a);case"q":return or(a);case"qq":return or(r);case"s":return or(a);case"ss":return or(r);case"S":return or(l);case"SSS":return or(s);case"u":return EU(h);case"uu":return EU(a);case"uuu":return or(i);case"a":return xh(t.meridiems(),0);case"kkkk":return or(n);case"kk":return or(p,S8);case"W":return or(a);case"WW":return or(r);case"E":case"c":return or(i);case"EEE":return xh(t.weekdays("short",!1,!1),1);case"EEEE":return xh(t.weekdays("long",!1,!1),1);case"ccc":return xh(t.weekdays("short",!0,!1),1);case"cccc":return xh(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return WQ(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return WQ(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return EU(/[a-z_+-/]{1,256}?/i);default:return g(b)}})(e)||{invalidReason:ANe};return v.token=e,v}const PNe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function INe(e,t,i){const{type:r,value:s}=e;if(r==="literal")return{literal:!0,val:s};const n=i[r];let o=PNe[r];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function $Ne(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function DNe(e,t,i){const r=e.match(t);if(r){const s={};let n=1;for(const o in i)if(RS(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function LNe(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return zi(e.z)||(i=ag.create(e.z)),zi(e.Z)||(i||(i=new Wa(e.Z)),r=e.Z),zi(e.q)||(e.M=(e.q-1)*3+1),zi(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),zi(e.u)||(e.S=RH(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),i,r]}let AU=null;function NNe(){return AU||(AU=Zt.fromMillis(1555555555555)),AU}function FNe(e,t){if(e.literal)return e;const i=zl.macroTokenToFormatOpts(e.val);if(!i)return e;const n=zl.create(t,i).formatDateTimeParts(NNe()).map(o=>INe(o,t,i));return n.includes(void 0)?e:n}function UNe(e,t){return Array.prototype.concat(...e.map(i=>FNe(i,t)))}function qpe(e,t,i){const r=UNe(zl.parseFormat(i),e),s=r.map(o=>MNe(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};{const[o,a]=$Ne(s),l=RegExp(o,"i"),[c,h]=DNe(t,l,a),[p,f,g]=h?LNe(h):[null,null,void 0];if(RS(h,"a")&&RS(h,"H"))throw new kA("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:g}}}function zNe(e,t,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=qpe(e,t,i);return[r,s,n,o]}const Wpe=[0,31,59,90,120,151,181,212,243,273,304,334],Xpe=[0,31,60,91,121,152,182,213,244,274,305,335];function Ku(e,t){return new fd("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function Ype(e,t,i){const r=new Date(Date.UTC(e,t-1,i)).getUTCDay();return r===0?7:r}function Zpe(e,t,i){return i+(qO(e)?Xpe:Wpe)[t-1]}function Qpe(e,t){const i=qO(e)?Xpe:Wpe,r=i.findIndex(n=>n<t),s=t-i[r];return{month:r+1,day:s}}function O8(e){const{year:t,month:i,day:r}=e,s=Zpe(t,i,r),n=Ype(t,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=vL(a)):o>vL(t)?(a=t+1,o=1):a=t,L({weekYear:a,weekNumber:o,weekday:n},UF(e))}function XQ(e){const{weekYear:t,weekNumber:i,weekday:r}=e,s=Ype(t,1,4),n=zC(t);let o=i*7+r-s-3,a;o<1?(a=t-1,o+=zC(a)):o>n?(a=t+1,o-=zC(t)):a=t;const{month:l,day:c}=Qpe(a,o);return L({year:a,month:l,day:c},UF(e))}function CU(e){const{year:t,month:i,day:r}=e,s=Zpe(t,i,r);return L({year:t,ordinal:s},UF(e))}function YQ(e){const{year:t,ordinal:i}=e,{month:r,day:s}=Qpe(t,i);return L({year:t,month:r,day:s},UF(e))}function kNe(e){const t=NF(e.weekYear),i=Nm(e.weekNumber,1,vL(e.weekYear)),r=Nm(e.weekday,1,7);return t?i?r?!1:Ku("weekday",e.weekday):Ku("week",e.week):Ku("weekYear",e.weekYear)}function BNe(e){const t=NF(e.year),i=Nm(e.ordinal,1,zC(e.year));return t?i?!1:Ku("ordinal",e.ordinal):Ku("year",e.year)}function Jpe(e){const t=NF(e.year),i=Nm(e.month,1,12),r=Nm(e.day,1,yL(e.year,e.month));return t?i?r?!1:Ku("day",e.day):Ku("month",e.month):Ku("year",e.year)}function Kpe(e){const{hour:t,minute:i,second:r,millisecond:s}=e,n=Nm(t,0,23)||t===24&&i===0&&r===0&&s===0,o=Nm(i,0,59),a=Nm(r,0,59),l=Nm(s,0,999);return n?o?a?l?!1:Ku("millisecond",s):Ku("second",r):Ku("minute",i):Ku("hour",t)}const RU="Invalid DateTime",ZQ=864e13;function lP(e){return new fd("unsupported zone",`the zone "${e.name}" is not supported`)}function OU(e){return e.weekData===null&&(e.weekData=O8(e.c)),e.weekData}function lE(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new Zt(ge(L(L({},i),t),{old:i}))}function efe(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function QQ(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function n$(e,t,i){return efe(MH(e),t,i)}function JQ(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n=ge(L({},e.c),{year:r,month:s,day:Math.min(e.c.day,yL(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7}),o=qi.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=MH(n);let[l,c]=efe(a,i,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function cE(e,t,i,r,s,n){const{setZone:o,zone:a}=i;if(e&&Object.keys(e).length!==0){const l=t||a,c=Zt.fromObject(e,ge(L({},i),{zone:l,specificOffset:n}));return o?c:c.setZone(a)}else return Zt.invalid(new fd("unparsable",`the input "${s}" can't be parsed as ${r}`))}function cP(e,t,i=!0){return e.isValid?zl.create(_s.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function MU(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=pn(e.c.year,i?6:4),t?(r+="-",r+=pn(e.c.month),r+="-",r+=pn(e.c.day)):(r+=pn(e.c.month),r+=pn(e.c.day)),r}function KQ(e,t,i,r,s){let n=pn(e.c.hour);return t?(n+=":",n+=pn(e.c.minute),(e.c.second!==0||!i)&&(n+=":")):n+=pn(e.c.minute),(e.c.second!==0||!i)&&(n+=pn(e.c.second),(e.c.millisecond!==0||!r)&&(n+=".",n+=pn(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0?n+="Z":e.o<0?(n+="-",n+=pn(Math.trunc(-e.o/60)),n+=":",n+=pn(Math.trunc(-e.o%60))):(n+="+",n+=pn(Math.trunc(e.o/60)),n+=":",n+=pn(Math.trunc(e.o%60)))),n}const tfe={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},VNe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},GNe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},ife=["year","month","day","hour","minute","second","millisecond"],jNe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],HNe=["year","ordinal","hour","minute","second","millisecond"];function eJ(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new ope(e);return t}function tJ(e,t){const i=Jy(t.zone,On.defaultZone),r=_s.fromObject(t),s=On.now();let n,o;if(zi(e.year))n=s;else{for(const c of ife)zi(e[c])&&(e[c]=tfe[c]);const a=Jpe(e)||Kpe(e);if(a)return Zt.invalid(a);const l=i.offset(s);[n,o]=n$(e,l,i)}return new Zt({ts:n,zone:i,loc:r,o})}function iJ(e,t,i){const r=zi(i.round)?!0:i.round,s=(o,a)=>(o=OH(o,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,i.units[i.units.length-1])}function rJ(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class Zt{constructor(t){const i=t.zone||On.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new fd("invalid input"):null)||(i.isValid?null:lP(i));this.ts=zi(t.ts)?On.now():t.ts;let s=null,n=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,n]=[t.old.c,t.old.o];else{const a=i.offset(this.ts);s=QQ(this.ts,a),r=Number.isNaN(s.year)?new fd("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=t.loc||_s.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Zt({})}static local(){const[t,i]=rJ(arguments),[r,s,n,o,a,l,c]=i;return tJ({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,i]=rJ(arguments),[r,s,n,o,a,l,c]=i;return t.zone=Wa.utcInstance,tJ({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,i={}){const r=JDe(t)?t.valueOf():NaN;if(Number.isNaN(r))return Zt.invalid("invalid input");const s=Jy(i.zone,On.defaultZone);return s.isValid?new Zt({ts:r,zone:s,loc:_s.fromObject(i)}):Zt.invalid(lP(s))}static fromMillis(t,i={}){if(k1(t))return t<-ZQ||t>ZQ?Zt.invalid("Timestamp out of range"):new Zt({ts:t,zone:Jy(i.zone,On.defaultZone),loc:_s.fromObject(i)});throw new ku(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(k1(t))return new Zt({ts:t*1e3,zone:Jy(i.zone,On.defaultZone),loc:_s.fromObject(i)});throw new ku("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=Jy(i.zone,On.defaultZone);if(!r.isValid)return Zt.invalid(lP(r));const s=On.now(),n=zi(i.specificOffset)?r.offset(s):i.specificOffset,o=_L(t,eJ),a=!zi(o.ordinal),l=!zi(o.year),c=!zi(o.month)||!zi(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=_s.fromObject(i);if((h||a)&&p)throw new kA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new kA("Can't mix ordinal dates with month/day");const g=p||o.weekday&&!h;let y,v,b=QQ(s,n);g?(y=jNe,v=VNe,b=O8(b)):a?(y=HNe,v=GNe,b=CU(b)):(y=ife,v=tfe);let w=!1;for(const U of y){const N=o[U];zi(N)?w?o[U]=v[U]:o[U]=b[U]:w=!0}const S=g?kNe(o):a?BNe(o):Jpe(o),x=S||Kpe(o);if(x)return Zt.invalid(x);const E=g?XQ(o):a?YQ(o):o,[R,O]=n$(E,n,r),I=new Zt({ts:R,zone:r,o:O,loc:f});return o.weekday&&h&&t.weekday!==I.weekday?Zt.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${I.toISO()}`):I}static fromISO(t,i={}){const[r,s]=sNe(t);return cE(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=nNe(t);return cE(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=oNe(t);return cE(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(zi(t)||zi(i))throw new ku("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=_s.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=zNe(o,t,i);return h?Zt.invalid(h):cE(a,l,r,`format ${i}`,t,c)}static fromString(t,i,r={}){return Zt.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=fNe(t);return cE(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new ku("need to specify a reason the DateTime is invalid");const r=t instanceof fd?t:new fd(t,i);if(On.throwOnInvalid)throw new qDe(r);return new Zt({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?OU(this).weekYear:NaN}get weekNumber(){return this.isValid?OU(this).weekNumber:NaN}get weekday(){return this.isValid?OU(this).weekday:NaN}get ordinal(){return this.isValid?CU(this.c).ordinal:NaN}get monthShort(){return this.isValid?aP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?aP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?aP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?aP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return qO(this.year)}get daysInMonth(){return yL(this.year,this.month)}get daysInYear(){return this.isValid?zC(this.year):NaN}get weeksInWeekYear(){return this.isValid?vL(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=zl.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone(Wa.instance(t),i)}toLocal(){return this.setZone(On.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=Jy(t,On.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const n=t.offset(this.ts),o=this.toObject();[s]=n$(o,n,t)}return lE(this,{ts:s,zone:t})}else return Zt.invalid(lP(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return lE(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=_L(t,eJ),r=!zi(i.weekYear)||!zi(i.weekNumber)||!zi(i.weekday),s=!zi(i.ordinal),n=!zi(i.year),o=!zi(i.month)||!zi(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new kA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new kA("Can't mix ordinal dates with month/day");let c;r?c=XQ(L(L({},O8(this.c)),i)):zi(i.ordinal)?(c=L(L({},this.toObject()),i),zi(i.day)&&(c.day=Math.min(yL(c.year,c.month),c.day))):c=YQ(L(L({},CU(this.c)),i));const[h,p]=n$(c,this.o,this.zone);return lE(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const i=qi.fromDurationLike(t);return lE(this,JQ(this,i))}minus(t){if(!this.isValid)return this;const i=qi.fromDurationLike(t).negate();return lE(this,JQ(this,i))}startOf(t){if(!this.isValid)return this;const i={},r=qi.normalizeUnit(t);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,i={}){return this.isValid?zl.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):RU}toLocaleString(t=T8,i={}){return this.isValid?zl.create(this.loc.clone(i),t).formatDateTime(this):RU}toLocaleParts(t={}){return this.isValid?zl.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0}={}){if(!this.isValid)return null;const n=t==="extended";let o=MU(this,n);return o+="T",o+=KQ(this,n,i,r,s),o}toISODate({format:t="extended"}={}){return this.isValid?MU(this,t==="extended"):null}toISOWeekDate(){return cP(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,format:n="extended"}={}){return this.isValid?(s?"T":"")+KQ(this,n==="extended",i,t,r):null}toRFC2822(){return cP(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return cP(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?MU(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),cP(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():RU}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i=L({},this.c);return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return qi.invalid("created by diffing an invalid DateTime");const s=L({locale:this.locale,numberingSystem:this.numberingSystem},r),n=KDe(i).map(qi.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=TNe(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",i={}){return this.diff(Zt.now(),t,i)}until(t){return this.isValid?Ds.fromDateTimes(this,t):this}hasSame(t,i){if(!this.isValid)return!1;const r=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||Zt.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),iJ(i,this.plus(r),ge(L({},t),{numeric:"always",units:s,unit:n}))}toRelativeCalendar(t={}){return this.isValid?iJ(t.base||Zt.fromObject({},{zone:this.zone}),this,ge(L({},t),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...t){if(!t.every(Zt.isDateTime))throw new ku("min requires all arguments be DateTimes");return DQ(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(Zt.isDateTime))throw new ku("max requires all arguments be DateTimes");return DQ(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=_s.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return qpe(o,t,i)}static fromStringExplain(t,i,r={}){return Zt.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return T8}static get DATE_MED(){return ape}static get DATE_MED_WITH_WEEKDAY(){return YDe}static get DATE_FULL(){return lpe}static get DATE_HUGE(){return cpe}static get TIME_SIMPLE(){return upe}static get TIME_WITH_SECONDS(){return hpe}static get TIME_WITH_SHORT_OFFSET(){return dpe}static get TIME_WITH_LONG_OFFSET(){return ppe}static get TIME_24_SIMPLE(){return fpe}static get TIME_24_WITH_SECONDS(){return mpe}static get TIME_24_WITH_SHORT_OFFSET(){return gpe}static get TIME_24_WITH_LONG_OFFSET(){return ype}static get DATETIME_SHORT(){return vpe}static get DATETIME_SHORT_WITH_SECONDS(){return _pe}static get DATETIME_MED(){return bpe}static get DATETIME_MED_WITH_SECONDS(){return wpe}static get DATETIME_MED_WITH_WEEKDAY(){return ZDe}static get DATETIME_FULL(){return xpe}static get DATETIME_FULL_WITH_SECONDS(){return Tpe}static get DATETIME_HUGE(){return Spe}static get DATETIME_HUGE_WITH_SECONDS(){return Epe}}function uE(e){if(Zt.isDateTime(e))return e;if(e&&e.valueOf&&k1(e.valueOf()))return Zt.fromJSDate(e);if(e&&typeof e=="object")return Zt.fromObject(e);throw new ku(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const PU={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function rfe(e){e||(e=Uc());let t=e in PU;if(!t){const n=e.split("-");n.length>1&&n[0]in PU&&(e=n[0],t=!0),t||(e="en")}const[i,r,s="#,##0.###"]=PU[e];return{decimal:i,group:r,pattern:s}}function qNe(e,t){const i=rfe((t=L({},t)).locale);t.customs=i;const r=t.pattern||i.pattern;return isNaN(e)||Math.abs(e)===1/0?null:WNe(e,r,t)}const sfe=/[#0,]*[#0](?:\.0*#*)?/;function WNe(e,t,i){const r=(i=i||{}).customs.group,s=i.customs.decimal,n=t.split(";"),o=n[0];if((t=n[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xA4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const a=sfe,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+t);return i.fractional===!1&&(i.places=0),t.replace(a,XNe(e,l[0],{decimal:s,group:r,places:i.places,round:i.round}))}function XNe(e,t,i){(i=i||{}).places===!0&&(i.places=0),i.places===1/0&&(i.places=6);const r=t.split("."),s=typeof i.places=="string"&&i.places.indexOf(",");let n=i.places;s?n=i.places.substring(s+1):n>=0||(n=(r[1]||[]).length),i.round<0||(e=Number(e.toFixed(Number(n))));const o=String(Math.abs(e)).split("."),a=o[1]||"";if(r[1]||i.places){s&&(i.places=i.places.substring(0,s));const y=i.places!==void 0?i.places:r[1]&&r[1].lastIndexOf("0")+1;y>a.length&&(o[1]=a.padEnd(Number(y),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=r[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let h,p,f=r[0].lastIndexOf(",");if(f!==-1){h=r[0].length-f-1;const y=r[0].substr(0,f);f=y.lastIndexOf(","),f!==-1&&(p=y.length-f-1)}const g=[];for(let y=o[0];y;){const v=y.length-h;g.push(v>0?y.substr(v):y),y=v>0?y.slice(0,v):"",p&&(h=p,p=void 0)}return o[0]=g.reverse().join(i.group||","),o.join(i.decimal||".")}function YNe(e){const t=rfe((e=e||{}).locale),i=e.pattern||t.pattern,r=t.group,s=t.decimal;let n=1;if(i.includes("%"))n/=100;else if(i.includes("\u2030"))n/=1e3;else if(i.includes("\xA4"))throw new Error("currency notation not supported");const o=i.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:OR(o,l=>(l="(?:"+voe(l,".")+")").replace(sfe,c=>{const h={signed:!1,separator:e.strict?r:[r,""],fractional:e.fractional,decimal:s,exponent:!1},p=c.split(".");let f=e.places;p.length===1&&n!==1&&(p[1]="###"),p.length===1||f===0?h.fractional=!1:(f===void 0&&(f=e.pattern?p[1].lastIndexOf("0")+1:1/0),f&&e.fractional==null&&(h.fractional=!0),!e.places&&f<p[1].length&&(f+=","+p[1].length),h.places=f);const g=p[0].split(",");return g.length>1&&(h.groupSize=g.pop().length,g.length>1&&(h.groupSize2=g.pop().length)),"("+QNe(h)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:r,decimal:s,factor:n}}function ZNe(e,t){const i=YNe(t),r=new RegExp("^"+i.regexp+"$").exec(e);if(!r)return NaN;let s=r[1];if(!r[1]){if(!r[2])return NaN;s=r[2],i.factor*=-1}return s=s.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),Number(s)*i.factor}function QNe(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=sJ(e),i=OR(e.fractional,s=>{let n="";return s&&e.places!==0&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n},!0);let r=t+i;return i&&(r="(?:(?:"+r+")|(?:"+i+"))"),r+OR(e.exponent,s=>s?"([eE]"+sJ({signed:e.eSigned})+")":"")}function sJ(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",OR(e.signed,t=>t?"[-+]":"",!0)+OR(e.separator,t=>{if(!t)return"(?:\\d+)";(t=voe(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const i=e.groupSize,r=e.groupSize2;if(r){const s="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*["+t+"]\\d{"+i+"})";return i-r>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"},!0)}const OR=(e,t,i)=>{if(!(e instanceof Array))return t(e);const r=[];for(let s=0;s<e.length;s++)r.push(t(e[s]));return JNe(r.join("|"),i)},JNe=(e,t)=>"("+(t?"?:":"")+e+")";var nJ,oJ;function jft(e){return jO.fromJSON(e.toJSON())}function KNe(e){return e.toJSON?e.toJSON():e}function Hft(e){return typeof e=="string"||e instanceof String}function qft(e){return typeof e=="number"}function aJ(e){return e instanceof Date}function Wft(e,t){return e===t||!(!aJ(e)||!aJ(t))&&e.getTime()===t.getTime()}function Xft(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function Yft(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new ni({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function Zft(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(nJ||(nJ={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(oJ||(oJ={}));const Qft=1e3,Jft={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},lJ={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},Kft={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function emt(e,t){return T7((i,r)=>{const s=lA(!0);e.reduce((n,o,a,l)=>n.then(c=>{try{return t(c,o,a,l)}catch(h){return XX(h)}},c=>XX(c)),s).then(i,r)})}function tmt(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function imt(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],g=o(a[f]);g&&(c&&(c+=","),c+=JSON.stringify(f)+":"+g)}return n.splice(h,1),"{"+c+"}"}(e)}class nfe{constructor(t){this.value=t}}class ofe{constructor(t){this.value=t}}class NH{constructor(t){this.fn=t}}class FH{constructor(t,i){this.paramCount=i,this.fn=t}}const eFe=NH,tFe=ofe,iFe=nfe,rFe=FH,Ac={type:"VOID"},sFe={type:"BREAK"},nFe={type:"CONTINUE"};function MR(e,t,i){return t===""||t==null||t===i||t===i?e:e=e.split(t).join(i)}function UH(e){return e instanceof NH||e instanceof HDe||e instanceof FH}function wL(e){return!!Ro(e)||!!Ba(e)||!!ca(e)||!!ka(e)||e===null||e===Ac||typeof e=="number"}function oFe(e,t){return e===void 0?t:e}function Ro(e){return typeof e=="string"||e instanceof String}function ka(e){return typeof e=="boolean"}function Ba(e){return typeof e=="number"}function aFe(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function oh(e){return e instanceof Array}function lFe(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function cFe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function uFe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function mb(e){return e instanceof bf}function ca(e){return e instanceof Date}function hFe(e,t,i){if(e.length<t||e.length>i)throw new Error("Function called with wrong number of Parameters")}function dFe(e){return e<0?-Math.round(-e):Math.round(e)}function pFe(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?i:3&i|8).toString(16)})}function zH(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=MR(t,"\u2030",""),t=MR(t,"\xA4",""),qNe(e,{pattern:t})):e.toString()}function zF(e,t){const i=Zt.fromJSDate(e);return t==null||t===""?i.toISO({suppressMilliseconds:!0}):i.toFormat(afe(t),{locale:Uc(),numberingSystem:"latn"})}function afe(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const i=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function dr(e,t,i){switch(i){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function fFe(e,t,i){if(e===null){if(t===null||t===Ac)return dr(null,null,i);if(Ba(t))return dr(0,t,i);if(Ro(t)||ka(t))return dr(0,ms(t),i);if(ca(t))return dr(0,t.getTime(),i)}if(e===Ac){if(t===null||t===Ac)return dr(null,null,i);if(Ba(t))return dr(0,t,i);if(Ro(t)||ka(t))return dr(0,ms(t),i);if(ca(t))return dr(0,t.getTime(),i)}else if(Ba(e)){if(Ba(t))return dr(e,t,i);if(ka(t))return dr(e,ms(t),i);if(t===null||t===Ac)return dr(e,0,i);if(Ro(t))return dr(e,ms(t),i);if(ca(t))return dr(e,t.getTime(),i)}else if(Ro(e)){if(Ro(t))return dr(E0(e),E0(t),i);if(ca(t))return dr(ms(e),t.getTime(),i);if(Ba(t))return dr(ms(e),t,i);if(t===null||t===Ac)return dr(ms(e),0,i);if(ka(t))return dr(ms(e),ms(t),i)}else if(ca(e)){if(ca(t))return dr(e,t,i);if(t===null||t===Ac)return dr(e.getTime(),0,i);if(Ba(t))return dr(e.getTime(),t,i);if(ka(t)||Ro(t))return dr(e.getTime(),ms(t),i)}else if(ka(e)){if(ka(t))return dr(e,t,i);if(Ba(t))return dr(ms(e),ms(t),i);if(ca(t))return dr(ms(e),t.getTime(),i);if(t===null||t===Ac)return dr(ms(e),0,i);if(Ro(t))return dr(ms(e),ms(t),i)}return!!lfe(e,t)&&(i==="<="||i===">=")}function lfe(e,t){if(e===t||e===null&&t===Ac||t===null&&e===Ac)return!0;if(ca(e)&&ca(t))return e.getTime()===t.getTime();if(e instanceof CH||e instanceof Zb)return e.equalityTest(t);if(e instanceof We&&t instanceof We){const i=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(i!=null)return i===r}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function E0(e,t){if(Ro(e))return e;if(e===null)return"";if(Ba(e))return zH(e,t);if(ka(e))return e.toString();if(ca(e))return zF(e,t);if(e instanceof tl)return JSON.stringify(e.toJSON());if(oh(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=xL(e[r]);return"["+i.join(",")+"]"}if(e instanceof bf){const i=[];for(let r=0;r<e.length();r++)i[r]=xL(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():UH(e)?"object, Function":""}function mFe(e){const t=[];if(oh(e)===!1)return null;if(e instanceof bf){for(let i=0;i<e.length();i++)t[i]=ms(e.get(i));return t}for(let i=0;i<e.length;i++)t[i]=ms(e[i]);return t}function o$(e,t){if(Ro(e))return e;if(e===null)return"";if(Ba(e))return zH(e,t);if(ka(e))return e.toString();if(ca(e))return zF(e,t);if(e instanceof tl)return e instanceof ni?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+M8(e.spatialReference)+"}":M8(e.toJSON(),(i,r)=>i.key===r.key?0:i.key==="spatialReference"?1:r.key==="spatialReference"||i.key<r.key?-1:i.key>r.key?1:0);if(oh(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=xL(e[r]);return"["+i.join(",")+"]"}if(e instanceof bf){const i=[];for(let r=0;r<e.length();r++)i[r]=xL(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():UH(e)?"object, Function":""}function xL(e){if(e===null)return"null";if(ka(e)||Ba(e)||Ro(e))return JSON.stringify(e);if(e instanceof tl||e instanceof bf||e instanceof Array)return o$(e);if(e instanceof Date)return JSON.stringify(zF(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===Ac)return"null";return"null"}function ms(e,t){return Ba(e)?e:e===null||e===""?0:ca(e)?NaN:ka(e)?e?1:0:oh(e)||e===""||e===void 0?NaN:t!==void 0&&Ro(e)?(t=MR(t,"\u2030",""),t=MR(t,"\xA4",""),ZNe(e,{pattern:t})):e===Ac?0:Number(e)}function gFe(e){if(ca(e))return e;if(Ro(e)){const t=cfe(e);if(t)return t.toJSDate()}return null}function yFe(e){return ca(e)?Zt.fromJSDate(e):Ro(e)?cfe(e):null}function cfe(e){const t=/ (\d\d)/;let i=Zt.fromISO(e);return i.isValid||t.test(e)&&(e=e.replace(t,"T$1"),i=Zt.fromISO(e),i.isValid)?i:null}function vFe(e){return ka(e)?e:Ro(e)?(e=e.toLowerCase())==="true":!!Ba(e)&&e!==0&&!isNaN(e)}function _Fe(e,t){return C(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function bFe(e){if(e===null)return null;if(e instanceof We)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof jl){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof Nc){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof zb?e.points.length===0?null:e:e instanceof ni?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function ufe(e,t){if(!e||!e.domain)return t;let i=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=E0(t);else{if(t==null)return null;if(t==="")return t;t=ms(t)}for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.code===t&&(i=s)}return i===null?t:i.name}function hfe(e,t){if(!e||!e.domain)return t;let i=null;t=E0(t);for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.name===t&&(i=s)}return i===null?t:i.code}function kF(e,t,i=null,r=null){if(!t||!t.fields)return null;let s,n,o=null;for(let a=0;a<t.fields.length;a++){const l=t.fields[a];l.name.toLowerCase()===e.toString().toLowerCase()&&(o=l)}if(o===null)throw new Error("Field not found");return r===null&&i&&t.typeIdField&&(r=i.hasField(t.typeIdField)?i.field(t.typeIdField):null),r!=null&&t.types.some(function(a){return a.id===r&&(s=a.domains&&a.domains[o.name],s&&s.type==="inherited"&&(s=cJ(o.name,t),n=!0),!0)}),n||s||(s=cJ(e,t)),{field:o,domain:s}}function cJ(e,t){let i;return t.fields.some(function(r){return r.name.toLowerCase()===e.toLowerCase()&&(i=r.domain),!!i}),i}function M8(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],g=o(a[f]);g&&(c&&(c+=","),c+=JSON.stringify(f)+":"+g)}return n.splice(h,1),"{"+c+"}"}(e)}function wFe(e){if(e===null)return null;const t=[];for(const i of e)i&&i.arcadeDeclaredClass&&i.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(i.geometry()):t.push(i);return t}function OS(e,t){if(!(t instanceof We))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function xFe(e,t){if(oh(e)||mb(e)){let i=!1,r=!1,s=[],n=t;if(oh(e)){for(const o of e)OS(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ,r=e[0].hasM)}else if(e instanceof Zb)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else{if(!mb(e))throw new Error("Invalid Argument");for(const o of e.toArray())OS(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(X7(s,r,i)===!1&&(s=s.slice(0).reverse()),new jl({rings:[s],spatialReference:n,hasZ:i,hasM:r}))}return e}function TFe(e,t){if(oh(e)||mb(e)){let i=!1,r=!1,s=[],n=t;if(oh(e)){for(const o of e)OS(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof Zb)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(mb(e)){for(const o of e.toArray())OS(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Nc({paths:[s],spatialReference:n,hasZ:i,hasM:r})}return e}function SFe(e,t){if(oh(e)||mb(e)){let i=!1,r=!1,s=[],n=t;if(oh(e)){for(const o of e)OS(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof Zb)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(mb(e)){for(const o of e.toArray())OS(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new zb({points:s,spatialReference:n,hasZ:i,hasM:r})}return e}function EFe(e,t=!1){const i=[];if(e===null)return i;if(oh(e)===!0){for(let r=0;r<e.length;r++){const s=E0(e[r]);s===""&&t!==!0||i.push(s)}return i}if(e instanceof bf){for(let r=0;r<e.length();r++){const s=E0(e.get(r));s===""&&t!==!0||i.push(s)}return i}if(wL(e)){const r=E0(e);return r===""&&t!==!0||i.push(r),i}return[]}let IU=0;function AFe(e){return IU++,IU%100==0?(IU=0,T7(t=>{setTimeout(()=>{t(e)},0)})):e}function CFe(e,t,i){switch(i){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function PR(e,t=null){return e==null?null:ka(e)||Ba(e)||Ro(e)?e:e instanceof tl?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof bf?e.toArray().map(i=>PR(i,t)):e instanceof Array?e.map(i=>PR(i,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}function RFe(e,t,i,r,s){return kH(e,t,i).then(n=>{s[r]=n})}function kH(e,t=null,i=null){if(e instanceof bf&&(e=e.toArray()),e==null)return lA(null);if(wL(e)||e instanceof tl||e instanceof Date)return lA(PR(e,i));if(e instanceof Array){const r=[],s=[];for(const n of e)n===null||wL(n)||n instanceof tl||n instanceof Date?s.push(PR(n,i)):(s.push(null),r.push(RFe(n,t,i,s.length-1,s)));return r.length>0?Exe(r).then(()=>s):lA(s)}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,i):lA(null)}function OFe(e,t,i){const r=e.fullSchema();return r===null||!r.fields?null:kF(t,r,e,i)}function MFe(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(i=>({name:i.name,code:i.id})):[]}:null}function PFe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;const n=kF(t,s,e,r);if(i===void 0)try{i=e.field(t)}catch{return null}return ufe(n,i)}function IFe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;if(i===void 0){try{i=e.field(t)}catch{return null}return i}return hfe(kF(t,s,e,r),i)}function $Fe(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const i=[];for(const r of t.fields)i.push(KNe(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:lJ[t.geometryType]===void 0?"":lJ[t.geometryType],fields:i}}const rmt=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:nfe,ImplicitResultE:ofe,NativeFunctionE:NH,SizzleFunctionE:FH,NativeFunction:eFe,ImplicitResult:tFe,ReturnResult:iFe,SizzleFunction:rFe,voidOperation:Ac,breakResult:sFe,continueResult:nFe,multiReplace:MR,isFunctionParameter:UH,isSimpleType:wL,defaultUndefined:oFe,isString:Ro,isBoolean:ka,isNumber:Ba,isInteger:aFe,isArray:oh,isFeature:lFe,isFeatureSet:cFe,isFeatureSetCollection:uFe,isImmutableArray:mb,isDate:ca,pcCheck:hFe,absRound:dFe,generateUUID:pFe,formatNumber:zH,formatDate:zF,standardiseDateFormat:afe,greaterThanLessThan:fFe,equalityTest:lfe,toString:E0,toNumberArray:mFe,toStringExplicit:o$,toNumber:ms,toDate:gFe,toDateTime:yFe,toBoolean:vFe,fixSpatialReference:_Fe,fixNullGeometry:bFe,getDomainValue:ufe,getDomainCode:hfe,getDomain:kF,stableStringify:M8,autoCastFeatureToGeometry:wFe,autoCastArrayOfPointsToPolygon:xFe,autoCastArrayOfPointsToPolyline:TFe,autoCastArrayOfPointsToMultiPoint:SFe,toStringArray:EFe,tick:AFe,binaryOperator:CFe,castAsJson:PR,castAsJsonAsync:kH,featureFullDomain:OFe,featureSubtypes:MFe,featureDomainValueLookup:PFe,featureDomainCodeLookup:IFe,featureSchema:$Fe},Symbol.toStringTag,{value:"Module"}));var P8;let VA=P8=class extends _e{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new P8({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],VA.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],VA.prototype,"maxValue",void 0),VA=P8=u([P("esri.renderer.support.AuthoringInfoClassBreakInfo")],VA);var I8;let By=I8=class extends _e{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new I8({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:re(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],By.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],By.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],By.prototype,"label",void 0),u([d({type:[VA],json:{write:!0}})],By.prototype,"classBreakInfos",void 0),By=I8=u([P("esri.renderers.support.AuthoringInfoFieldInfo")],By);var $8;const uP=new yi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),hP=new yi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),uJ={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},hJ=["high-to-low","above-and-below","centered-on","extremes"],dJ=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],pJ=["seconds","minutes","hours","days","months","years"];let bl=$8=class extends _e{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new $8({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:uJ,json:{write:!0}})],bl.prototype,"endTime",void 0),u([Bt("endTime")],bl.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],bl.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],bl.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],bl.prototype,"minSliderValue",void 0),u([d({types:uJ,json:{write:!0}})],bl.prototype,"startTime",void 0),u([Bt("startTime")],bl.prototype,"castStartTime",null),u([d({type:uP.apiValues,value:null,json:{type:uP.jsonValues,read:uP.read,write:uP.write}})],bl.prototype,"style",null),u([d({type:dJ,value:null,json:{type:dJ,origins:{"web-scene":{type:hJ,write:{writer:(e,t)=>{hJ.includes(e)&&(t.theme=e)}}}},write:!0}})],bl.prototype,"theme",null),u([d({type:hP.apiValues,json:{type:hP.jsonValues,read:hP.read,write:hP.write}})],bl.prototype,"type",void 0),u([d({type:pJ,json:{type:pJ,write:!0}})],bl.prototype,"units",void 0),bl=$8=u([P("esri.renderers.support.AuthoringInfoVisualVariable")],bl);const DFe=bl;let a$=class extends _e{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],a$.prototype,"type",void 0),a$=u([P("esri.rest.support.ColorRamp")],a$);const BH=a$;var D8;let b_=D8=class extends BH{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new D8({fromColor:re(this.fromColor),toColor:re(this.toColor),algorithm:this.algorithm})}};u([vt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],b_.prototype,"algorithm",void 0),u([d({type:rt,json:{type:[Dr],write:!0}})],b_.prototype,"fromColor",void 0),u([d({type:rt,json:{type:[Dr],write:!0}})],b_.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],b_.prototype,"type",void 0),b_=D8=u([P("esri.rest.support.AlgorithmicColorRamp")],b_);const VH=b_;var L8;let GA=L8=class extends BH{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new L8({colorRamps:re(this.colorRamps)})}};u([d({type:[VH],json:{write:!0}})],GA.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],GA.prototype,"type",void 0),GA=L8=u([P("esri.rest.support.MultipartColorRamp")],GA);const dfe=GA,LFe={key:"type",base:BH,typeMap:{algorithmic:VH,multipart:dfe}};function NFe(e){return e&&e.type?e.type==="algorithmic"?VH.fromJSON(e):e.type==="multipart"?dfe.fromJSON(e):null:null}var N8;const Tv=new yi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),dP=new yi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),fJ=new yi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),mJ=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],FFe=["high-to-low","above-and-below","above","below","90-10"],UFe=["flow-line","wave-front"],zFe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Ys=N8=class extends _e{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return NFe(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new N8({classificationMethod:this.classificationMethod,colorRamp:re(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:re(this.field1),field2:re(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:Tv.apiValues,value:null,json:{type:Tv.jsonValues,read:Tv.read,write:Tv.write,origins:{"web-document":{default:"manual",type:Tv.jsonValues,read:Tv.read,write:Tv.write}}}})],Ys.prototype,"classificationMethod",null),u([d({types:LFe,json:{write:!0}})],Ys.prototype,"colorRamp",void 0),u([Ne("colorRamp")],Ys.prototype,"readColorRamp",null),u([d({type:[String],value:null,json:{write:!0}})],Ys.prototype,"fields",null),u([d({type:By,value:null,json:{write:!0}})],Ys.prototype,"field1",null),u([d({type:By,value:null,json:{write:!0}})],Ys.prototype,"field2",null),u([d({type:UFe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ys.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Ys.prototype,"focus",null),u([d({type:Number,value:null,json:{type:Dr,write:!0}})],Ys.prototype,"numClasses",null),u([d({type:mJ,json:{type:mJ,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Ys.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ys.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ys.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Ys.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Ys.prototype,"standardDeviationInterval",null),u([d({type:dP.apiValues,value:null,json:{type:dP.jsonValues,read:dP.read,write:dP.write,origins:{"web-scene":{type:fJ.jsonValues,write:{writer:fJ.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],Ys.prototype,"type",null),u([d({type:[DFe],json:{write:!0}})],Ys.prototype,"visualVariables",void 0),u([d({type:zFe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ys.prototype,"univariateSymbolStyle",null),u([d({type:FFe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Ys.prototype,"univariateTheme",null),Ys=N8=u([P("esri.renderers.support.AuthoringInfo")],Ys);const kFe=Ys,$U=new yi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary"},{ignoreUnknown:!0});let jA=class extends _e{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:kFe,json:{write:!0}})],jA.prototype,"authoringInfo",void 0),u([d({type:$U.apiValues,readOnly:!0,json:{type:$U.jsonValues,read:!1,write:{writer:$U.write,ignoreOrigin:!0}}})],jA.prototype,"type",void 0),jA=u([P("esri.renderers.Renderer")],jA);const lv=jA;var F8;let LT=F8=class extends _e{constructor(){super(...arguments),this.title=null}clone(){return new F8({title:this.title})}};u([d({type:String,json:{write:!0}})],LT.prototype,"title",void 0),LT=F8=u([P("esri.renderers.support.LegendOptions")],LT);var U8;let l$=U8=class extends LT{constructor(){super(...arguments),this.showLegend=null}clone(){return new U8({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],l$.prototype,"showLegend",void 0),l$=U8=u([P("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l$);const pfe=l$,BFe=pe.getLogger("esri.renderers.visualVariables.VisualVariable"),DU=new yi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let Uh=class extends _e{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(BFe.error(".field: field must be a string value"),null):$O(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],Uh.prototype,"index",void 0),u([d({type:DU.apiValues,readOnly:!0,json:{read:DU.read,write:DU.write}})],Uh.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Uh.prototype,"field",void 0),u([Bt("field")],Uh.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Uh.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Uh.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],Uh.prototype,"arcadeRequired",null),u([d({type:pfe,json:{write:!0}})],Uh.prototype,"legendOptions",void 0),Uh=u([P("esri.renderers.visualVariables.VisualVariable")],Uh);const XO=Uh;var z8;let w_=z8=class extends _e{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e==null?0:e}clone(){return new z8({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:rt,json:{type:[Dr],write:!0}})],w_.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],w_.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],w_.prototype,"value",void 0),u([Xe("value")],w_.prototype,"writeValue",null),w_=z8=u([P("esri.renderers.visualVariables.support.ColorStop")],w_);const VFe=w_;var k8;let x_=k8=class extends XO{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new k8({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],x_.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],x_.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],x_.prototype,"normalizationField",void 0),u([d({type:[VFe],json:{write:!0}})],x_.prototype,"stops",null),x_=k8=u([P("esri.renderers.visualVariables.ColorVariable")],x_);const ffe=x_;var B8;let by=B8=class extends _e{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return _R(t.transparency)}writeOpacity(e,t,i){t[i]=iF(e)}clone(){return new B8({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],by.prototype,"label",void 0),u([d({type:Number,json:{type:Dr,write:{target:"transparency"}}})],by.prototype,"opacity",void 0),u([Ne("opacity",["transparency"])],by.prototype,"readOpacity",null),u([Xe("opacity")],by.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],by.prototype,"value",void 0),by=B8=u([P("esri.renderers.visualVariables.support.OpacityStop")],by);const GFe=by;var V8;let T_=V8=class extends XO{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new V8({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],T_.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],T_.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],T_.prototype,"normalizationField",void 0),u([d({type:[GFe],json:{write:!0}})],T_.prototype,"stops",null),T_=V8=u([P("esri.renderers.visualVariables.OpacityVariable")],T_);const mfe=T_;var G8;let em=G8=class extends XO{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new Y("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new G8({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],em.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],em.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],em.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],em.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],em.prototype,"valueExpressionTitle",void 0),u([Xe("web-scene","valueExpressionTitle")],em.prototype,"writeValueExpressionTitleWebScene",null),em=G8=u([P("esri.renderers.visualVariables.RotationVariable")],em);const gfe=em;var j8;let Sx=j8=class extends _e{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new j8({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],Sx.prototype,"label",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],Sx.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],Sx.prototype,"value",void 0),Sx=j8=u([P("esri.renderers.visualVariables.support.SizeStop")],Sx);const jFe=Sx;var H8;let c$=H8=class extends pfe{constructor(){super(...arguments),this.customValues=null}clone(){return new H8({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],c$.prototype,"customValues",void 0),c$=H8=u([P("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],c$);const HFe=c$;var Gm,In;function sT(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function IR(e){return e!=null&&!isNaN(e)&&isFinite(e)}function yfe(e){return e.valueExpression?Gm.Expression:e.field&&typeof e.field=="string"?Gm.Field:Gm.Unknown}function qFe(e,t){const i=t||yfe(e),r=e.valueUnit||"unknown";return i===Gm.Unknown?In.Constant:e.stops?In.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?In.ClampedLinear:r==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?In.Proportional:In.Additive:In.Identity:In.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(Gm||(Gm={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(In||(In={}));const MS={inches:ys(1,"meters","inches"),feet:ys(1,"meters","feet"),"us-feet":ys(1,"meters","us-feet"),yards:ys(1,"meters","yards"),miles:ys(1,"meters","miles"),"nautical-miles":ys(1,"meters","nautical-miles"),millimeters:ys(1,"meters","millimeters"),centimeters:ys(1,"meters","centimeters"),decimeters:ys(1,"meters","decimeters"),meters:ys(1,"meters","meters"),kilometers:ys(1,"meters","kilometers"),"decimal-degrees":1/uRe(1,"meters",ai.radius)},B0=pe.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),gJ=new ho,u$=Math.PI,vfe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function _fe(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="color"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void B0.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(C(i)||C(i.arcade))return void B0.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,b=v.getViewInfo(y),w=v.createExecContext(n,b);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,g=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const y=jH(a,c);if(y){const v=y[0],b=y[1],w=v===b?r.stops[v].color:rt.blendColors(r.stops[v].color,r.stops[b].color,y[2],_(i)?i.color:void 0);return new rt(w)}}}function bfe(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="opacity"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void B0.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(C(i)||C(i.arcade))return void B0.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,b=v.getViewInfo(y),w=v.createExecContext(n,b);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,w)}else o&&(a=o[l]);const f=r.normalizationField,g=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const y=jH(a,c);if(y){const v=y[0],b=y[1];if(v===b)return r.stops[v].opacity;{const w=r.stops[v].opacity;return w+(r.stops[b].opacity-w)*y[2]}}}}function wfe(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="rotation"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void B0.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(C(i)||C(i.arcade))return void B0.error("Use of arcade expressions requires an arcade context");const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(g),b=y.createExecContext(a,v);if(!p){const w=y.createSyntaxTree(r.valueExpression);p=y.createFunction(w),r.cache.compiledFunc=p}f=y.executeFunction(p,b)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function WFe(e,t,i){const r=typeof t=="number",s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=_(i)?i.scale:void 0,p=_(i)?i.view:void 0;o=h==null||p==="3d"?XFe(e):h}else if(!r)switch(e.inputValueType){case Gm.Expression:{if(C(i)||C(i.arcade))return void B0.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(h),g=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(e.valueExpression);l=p.createFunction(y),e.cache.compiledFunc=l}o=p.executeFunction(l,g);break}case Gm.Field:n&&(o=n[e.field]);break;case Gm.Unknown:o=null}if(!IR(o))return null;if(r||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return IR(c)&&c!==0?o/c:null}function XFe(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function BF(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void B0.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=Tfe(WFe(r,t,i),r,t,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Vl(e,t,i){return e==null?null:sT(e)?BF(e,t,i):IR(e)?e:null}function xfe(e,t,i){return IR(i)&&e>i?i:IR(t)&&e<t?t:e}function YFe(e,t,i,r){return e+(Vl(t.minSize,i,r)||t.minDataValue)}function ZFe(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=e.minSize),Vl(s,t,i)}function QFe(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Vl(t.minSize,i,r),o=Vl(t.maxSize,i,r),a=_(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?u$*(n/2)**2:n*n,h=c+s*((l?u$*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/u$):Math.sqrt(h)}return n+s*(o-n)}function JFe(e,t,i,r){const s=_(r)?r.shape:void 0,n=e/t.minDataValue,o=Vl(t.minSize,i,r),a=Vl(t.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,xfe(l,o,a)}function KFe(e,t,i,r,s){const[n,o,a]=jH(e,s);if(n===o)return Vl(t.stops[n].size,i,r);{const l=Vl(t.stops[n].size,i,r);return l+(Vl(t.stops[o].size,i,r)-l)*a}}function e4e(e,t,i,r){const s=(_(r)&&r.resolution?r.resolution:1)*MS[t.valueUnit],n=Vl(t.minSize,i,r),o=Vl(t.maxSize,i,r),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/u$)/s:a==="radius"||a==="distance"?2*e/s:e/s,xfe(l,n,o)}function Tfe(e,t,i,r,s){switch(t.transformationType){case In.Additive:return YFe(e,t,i,r);case In.Constant:return ZFe(t,i,r);case In.ClampedLinear:return QFe(e,t,i,r);case In.Proportional:return JFe(e,t,i,r);case In.Stops:return KFe(e,t,i,r,s);case In.RealWorldSize:return e4e(e,t,i,r);case In.Identity:return e;case In.Unknown:return null}}function t4e(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&i==="3d"||t))return null;const s={scale:t,view:i};let n=Vl(e.minSize,gJ,s),o=Vl(e.maxSize,gJ,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function GH(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=_fe(l,t,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=bfe(l,t,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=wfe(l,t,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=BF(l,t,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function jH(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((s,n)=>e<s?(r=n,!0):(i=n,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function i4e(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":BF(s,t,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}var r4e=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:i4e,getColor:_fe,getOpacity:bfe,getRotationAngle:wfe,getSize:BF,getSizeForValue:Tfe,getSizeFromNumberOrVariable:Vl,getSizeRangeAtScale:t4e,getVisualVariableValues:GH,viewScaleRE:vfe},Symbol.toStringTag,{value:"Module"})),q8;const mw=pe.getLogger("esri.renderers.visualVariables.SizeVariable"),pP=new yi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),W8=new yi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function yJ(e){if(e!=null)return typeof e=="string"||typeof e=="number"?sr(e):e.type==="size"?sT(e)?e:(delete(e=L({},e)).type,new Hi(e)):void 0}function vJ(e,t,i){if(typeof e!="object")return e;const r=new Hi;return r.read(e,i),r}let Hi=q8=class extends XO{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:vfe.test(this.valueExpression)}}set expression(e){mw.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){sT(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),sT(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return yfe(this)}set maxDataValue(e){e&&this.stops&&(mw.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(mw.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return yJ(e)}readMaxSize(e,t,i){return vJ(e,t,i)}set minDataValue(e){e&&this.stops&&(mw.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(mw.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return yJ(e)}readMinSize(e,t,i){return vJ(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(mw.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return qFe(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if(e==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new Y("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?W8.read(e):null}clone(){return new q8({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:sT(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:sT(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===In.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===In.Stops){const e=this.stops,t=e.map(r=>r.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],Hi.prototype,"cache",null),u([d({type:pP.apiValues,json:{type:pP.jsonValues,origins:{"web-map":{read:!1}},read:pP.read,write:pP.write}})],Hi.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],Hi.prototype,"expression",null),u([d()],Hi.prototype,"index",null),u([d({type:String,readOnly:!0})],Hi.prototype,"inputValueType",null),u([d({type:HFe,json:{write:!0}})],Hi.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],Hi.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Hi.prototype,"maxSize",null),u([Bt("maxSize")],Hi.prototype,"castMaxSize",null),u([Ne("maxSize")],Hi.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],Hi.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],Hi.prototype,"minSize",null),u([Bt("minSize")],Hi.prototype,"castMinSize",null),u([Ne("minSize")],Hi.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],Hi.prototype,"normalizationField",void 0),u([d({readOnly:!0})],Hi.prototype,"arcadeRequired",null),u([d({type:String})],Hi.prototype,"scaleBy",void 0),u([d({type:[jFe],value:null,json:{write:!0}})],Hi.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],Hi.prototype,"target",void 0),u([d({type:String,readOnly:!0})],Hi.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],Hi.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Hi.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],Hi.prototype,"valueExpression",void 0),u([Ne("valueExpression",["valueExpression","expression"])],Hi.prototype,"readValueExpression",null),u([Xe("web-scene","valueExpression")],Hi.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Hi.prototype,"valueRepresentation",void 0),u([d({type:W8.apiValues,json:{write:W8.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],Hi.prototype,"valueUnit",void 0),u([Ne("valueUnit")],Hi.prototype,"readValueUnit",null),Hi=q8=u([P("esri.renderers.visualVariables.SizeVariable")],Hi);const Sfe=Hi,s4e=pe.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),n4e={color:ffe,size:Sfe,opacity:mfe,rotation:gfe},o4e=new yi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),a4e=/^\[([^\]]+)\]$/i;let h$=class extends be{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,i)=>{let r=null;return r=t.target===i.target?0:t.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(a4e),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=o4e.read(a.type),c=n4e[l];c||(s4e.warn(`Unknown variable type: ${l}`),i&&i.messages&&i.messages.push(new Hc("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:i})));const h=new c;return h.read(a,i),h})}writeVariables(e,t){const i=[];for(const r of e){const s=r.toJSON(t);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],h$.prototype,"visualVariables",null),h$=u([P("esri.renderers.visualVariables.VisualVariableFactory")],h$);const l4e=h$,c4e={base:XO,key:"type",typeMap:{opacity:mfe,color:ffe,rotation:gfe,size:Sfe}},YO=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new l4e}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&th(i,r,n.field),n.normalizationField&&th(i,r,n.normalizationField),n.valueExpression&&await Wc(i,r,n.valueExpression))}};return u([d({types:[c4e],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([Ne("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([Xe("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([P("esri.renderers.mixins.VisualVariablesMixin")],t),t},hE={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function u4e(e,t=hE){if(!e)return{symbol:null};const{retainId:i=hE.retainId,ignoreDrivers:r=hE.ignoreDrivers,hasLabelingContext:s=hE.hasLabelingContext,retainCIM:n=hE.retainCIM}=t;let o;if(xR(e)||e instanceof Hb)o=e.clone();else if(e.type==="cim"){var a,l;const c=(a=e.data)==null||(l=a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new Y("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():Ju.fromCIMSymbol(e)}else if(e instanceof Nd)o=UO.fromSimpleLineSymbol(e);else if(e instanceof jb)o=Ju.fromSimpleMarkerSymbol(e);else if(e instanceof dF)o=Ju.fromPictureMarkerSymbol(e);else if(e instanceof Gb)o=zO.fromSimpleFillSymbol(e);else{if(!(e instanceof w2))return{error:new Y("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?yS.fromTextSymbol(e):Ju.fromTextSymbol(e)}if(i&&o.type!=="cim"&&(o.id=e.id),r&&xR(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}const h4e=["building-scene","integrated-mesh","point-cloud","scene"];function TL(e,t,i,r){const s=Efe(e,{},{context:r,isLabelSymbol:!1});_(s)&&(t[i]=s)}function _J(e,t,i,r){const s=Efe(e,{},{context:r,isLabelSymbol:!0});_(s)&&(t[i]=s)}function bJ(e){return e instanceof b2||e instanceof Hb}function Efe(e,t,i){var r;if(C(e))return null;const{context:s,isLabelSymbol:n}=i,o=s==null?void 0:s.origin,a=s==null?void 0:s.messages;if(o==="web-scene"&&!bJ(e)){const l=u4e(e,{retainCIM:!0,hasLabelingContext:n});return _(l.symbol)?l.symbol.write(t,s):(a==null||a.push(new Y("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:s,error:l.error})),null)}return(o==="web-map"||o==="portal-item"&&!h4e.includes(s==null||(r=s.layer)==null?void 0:r.type))&&bJ(e)?(a==null||a.push(new Y("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:s})),null):e.write(t,s)}function smt(e,t){return aCe(e,null,t)}const ZO={types:Ece,json:{write:{writer:TL},origins:{"web-scene":{types:zY,write:{writer:TL},read:{reader:c2({types:zY})}}}}},Afe={types:{base:Xl,key:"type",typeMap:{"simple-fill":$1.typeMap["simple-fill"],"picture-fill":$1.typeMap["picture-fill"],"polygon-3d":$1.typeMap["polygon-3d"]}},json:{write:{writer:TL},origins:{"web-scene":{type:zO,write:{writer:TL}}}}};var X8;let wy=X8=class extends _e{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new X8({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([d({type:String,json:{write:!0}})],wy.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],wy.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],wy.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],wy.prototype,"maxValue",void 0),u([d(ZO)],wy.prototype,"symbol",void 0),wy=X8=u([P("esri.renderers.support.ClassBreakInfo")],wy);const SL=wy;var Y8;const fP=pe.getLogger("esri.renderers.ClassBreaksRenderer"),Cfe="log",d$="percent-of-total",p$="field",mP=new yi({esriNormalizeByLog:Cfe,esriNormalizeByPercentOfTotal:d$,esriNormalizeByField:p$}),d4e=As(SL);let on=Y8=class extends YO(lv){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map(s=>{const n=new SL;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(e,t,i,r){const s=e.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[i]=s}castField(e){return e==null?e:typeof e=="function"?(fP.error(".field: field must be a string value"),null):$O(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&p$||i&&d$||null,t&&i&&fP.warn("warning: both normalizationField and normalizationTotal are set!")):e!==p$&&e!==d$||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r=typeof e=="number"?new SL({minValue:e,maxValue:t,symbol:Ace(i)}):d4e(re(e)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(C(t)||C(t.arcade))&&fP.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(C(t)||C(t.arcade))&&(i=ge(L({},i),{arcade:await Jp()}));const r=this.getBreakIndex(e,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(C(t)||C(t.arcade)))return void fP.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(C(t)||C(t.arcade))){const s=await Jp(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=ge(L({},i),{arcade:s})}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new Y8({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:re(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Wc(e,t,this.valueExpression)];th(e,t,this.field),th(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Tt(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const n=this.normalizationTotal,o=parseFloat(i[this.normalizationField]);if(r===Cfe)s=Math.log(s)*Math.LOG10E;else if(r!==d$||isNaN(n)){if(r===p$&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};u([d(Afe)],on.prototype,"backgroundFillSymbol",void 0),u([d({type:[SL]})],on.prototype,"classBreakInfos",void 0),u([Ne("classBreakInfos")],on.prototype,"readClassBreakInfos",null),u([Xe("classBreakInfos")],on.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],on.prototype,"defaultLabel",void 0),u([d(ZO)],on.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],on.prototype,"field",void 0),u([Bt("field")],on.prototype,"castField",null),u([d({type:Boolean})],on.prototype,"isMaxInclusive",void 0),u([d({type:LT,json:{write:!0}})],on.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],on.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],on.prototype,"normalizationField",void 0),u([d({type:Number,cast:e=>zu(e),json:{write:!0}})],on.prototype,"normalizationTotal",void 0),u([d({type:mP.apiValues,value:null,json:{type:mP.jsonValues,read:mP.read,write:mP.write}})],on.prototype,"normalizationType",null),u([vt({classBreaks:"class-breaks"})],on.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],on.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],on.prototype,"valueExpressionTitle",void 0),on=Y8=u([P("esri.renderers.ClassBreaksRenderer")],on);const Rfe=on,f$=-3;var Rm;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(Rm||(Rm={}));class p4e{constructor(t,i,r){this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,i,r,s=0){this._storage.put(this._namespace+t,i,r,s)}get(t){const i=this._storage.get(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}pop(t){const i=this._storage.pop(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}updateSize(t,i,r){this._storage.updateSize(this._namespace+t,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class HH{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Vt,this._users=new Vt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,i){this._removeFuncs.push([t,i])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(i=>i[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,i,r,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,Rm.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,Rm.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,f$)-f$;this._db.set(t,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(t,i,r){const s=this._db.get(t);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(t,i,Rm.SOME);if(!(_(n)&&n>0))return void this._db.delete(t);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const i=this._db.get(t);if(i)return this._size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(t){const i=this._db.get(t);if(i!==void 0)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>t[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(t["Priority "+(o+f$-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((i,r)=>{r.startsWith(t)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,Rm.ALL))})}clearAll(){this._db.forEach((t,i)=>this._notifyRemove(i,t.entry,Rm.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,r){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,i]of this._db){if(this._db.delete(t),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(t,i.entry,Rm.SOME);_(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(t,i))}else--i.lives,this._db.set(t,i);if(this._size<=.9*this.maxSize)return}}}class Ofe{constructor(t,i){this._storage=new HH,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i,r){this._storage.put(t,i,r,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const wJ=pe.getLogger("esri.renderers.support.DictionaryLoader"),f4e={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class qH{constructor(t,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new Ofe(100),this.url=t,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(g){if(Tr(g))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const g of this._symbolFields){const y=this.fieldMap[g];if(y&&t.attributes[y]!=null){const v=""+t.attributes[y];s[g]=v}else s[g]=""}const n=r(s,i);if(!n||typeof n!="string")return null;const o=y7(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const g of l)if(g)if(g.includes("po:")){const y=g.substr(3).split("|");if(y.length===3){const v=y[0],b=y[1];let w=y[2];if(b==="DashTemplate")w=w.split(" ").map(S=>Number(S));else if(b==="Color"){const S=new rt(w).toRgba();w=[S[0],S[1],S[2],255*S[3]]}else w=Number(w);h.push({primitiveName:v,propertyName:b,value:w})}}else if(g.includes("|")){for(const y of g.split("|"))if(this._itemNames.has(y)){c.push(y);break}}else this._itemNames.has(g)&&c.push(g);const p=!_(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void wJ.error("no valid URL!");const i=_(t)?t.abortOptions:null,r=Pi(this.url+"/resources/styles/dictionary-info.json",L({responseType:"json",query:{f:"json"}},i)),[{data:s}]=await Promise.all([r,Jp()]);if(!s)throw this._dictionaryPromise=null,new Y("esri.renderers.DictionaryRenderer","Bad dictionary data!");const n=s.expression,o=s.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+s.cimRefTemplateUrl,this._itemNames=new Set(s.itemsNames),this._symbolFields=o.symbol;const a={};if(this.config){const c=this.config;for(const h in c)a[h]=c[h]}if(o.configuration)for(const c of o.configuration)a.hasOwnProperty(c.name)||(a[c.name]=c.value);const l=[];if(_(t)&&t.fields&&this.fieldMap)for(const c of this._symbolFields){const h=this.fieldMap[c],p=t.fields.filter(f=>f.name===h);p.length>0&&l.push(ge(L({},p[0]),{name:c}))}return this._dictionaryPromise=y2e(n,_(t)?t.spatialReference:null,l,a).then(c=>{const h={scale:0};return(p,f)=>{const g=c.repurposeFeature({geometry:null,attributes:p});return h.scale=_(f)?f.scale:void 0,c.evaluate({$feature:g,$view:h})}}).catch(c=>(wJ.error("Creating dictinoary expression failed:",c),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,i,r,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;for(const l of o)Mfe(l,a);return new d2({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(t,i){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=Pi(r,L({responseType:"json",query:{f:"json"}},i));this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,i,r){if(!t||t.length===0)return null;const s=L({},t[0]);if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=f4e),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}}function Mfe(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&m4e(s,t)}}function m4e(e,t){const i=e.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":Mfe(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}var nmt=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:qH},Symbol.toStringTag,{value:"Module"})),Z8;let zh=Z8=class extends YO(lv){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new qH(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){r!=null&&r.origin||super.writeVisualVariables(e,t,i,r)}clone(){return new Z8({config:re(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:re(this.fieldMap),url:re(this.url),visualVariables:re(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Wc(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:qH})],zh.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],zh.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],zh.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],zh.prototype,"scaleExpression",void 0),u([Xe("scaleExpression")],zh.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],zh.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],zh.prototype,"url",void 0),u([Xe("visualVariables")],zh.prototype,"writeVisualVariables",null),zh=Z8=u([P("esri.renderers.DictionaryRenderer")],zh);const g4e=zh;var Q8;const y4e=pe.getLogger("esri.renderers.support.AttributeColorInfo");let tm=Q8=class extends _e{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(y4e.error(".field: field must be a string value"),null):$O(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new Q8({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:rt,json:{type:[Number],write:!0}})],tm.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],tm.prototype,"field",void 0),u([Bt("field")],tm.prototype,"castField",null),u([d({type:String,json:{write:!0}})],tm.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],tm.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],tm.prototype,"valueExpressionTitle",void 0),tm=Q8=u([P("esri.renderers.support.AttributeColorInfo")],tm);const v4e=tm;var J8;let m$=J8=class extends _e{constructor(){super(...arguments),this.unit=null}clone(){return new J8({unit:this.unit})}};u([d({type:String,json:{write:!0}})],m$.prototype,"unit",void 0),m$=J8=u([P("esri.renderers.support.DotDensityLegendOptions")],m$);const _4e=m$;var K8;let Wo=K8=class extends YO(lv){constructor(e){super(e),this.attributes=null,this.backgroundColor=new rt([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Nd,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new Gb({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new K8({attributes:re(this.attributes),backgroundColor:re(this.backgroundColor),dotBlendingEnabled:re(this.dotBlendingEnabled),dotShape:re(this.dotShape),dotSize:re(this.dotSize),dotValue:re(this.dotValue),legendOptions:re(this.legendOptions),outline:re(this.outline),referenceScale:re(this.referenceScale),visualVariables:re(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Wc(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[v4e],json:{write:!0}})],Wo.prototype,"attributes",void 0),u([d({type:rt,json:{write:!0}})],Wo.prototype,"backgroundColor",void 0),u([d({type:Boolean}),xt("dotBlendingEnabled")],Wo.prototype,"blendDots",void 0),u([d({type:Boolean,json:{write:!0}})],Wo.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],Wo.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],Wo.prototype,"dotSize",void 0),u([d({type:_4e,json:{write:!0}})],Wo.prototype,"legendOptions",void 0),u([d({type:Nd,json:{default:null,write:!0}})],Wo.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],Wo.prototype,"dotValue",void 0),u([d({type:Number}),xt("dotValue")],Wo.prototype,"referenceDotValue",void 0),u([d({type:Number,json:{write:!0}})],Wo.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],Wo.prototype,"seed",void 0),u([vt({dotDensity:"dot-density"})],Wo.prototype,"type",void 0),Wo=K8=u([P("esri.renderers.DotDensityRenderer")],Wo);const b4e=Wo;var e9;let HA=e9=class extends _e{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new e9({color:this.color,ratio:this.ratio})}};u([d({type:rt,json:{write:!0}})],HA.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],HA.prototype,"ratio",void 0),HA=e9=u([P("esri.renderers.support.HeatmapColorStop")],HA);const g$=HA;var t9;let kh=t9=class extends lv{constructor(e){super(e),this.blurRadius=10,this.referenceScale=0,this.colorStops=[new g$({ratio:0,color:new rt("rgba(255, 140, 0, 0)")}),new g$({ratio:.75,color:new rt("rgba(255, 140, 0, 1)")}),new g$({ratio:.9,color:new rt("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.maxPixelIntensity=100,this.minPixelIntensity=0,this.type="heatmap"}getSymbol(){const e=this.referenceScale!==0?5:1,t=Math.min(3*this.blurRadius*e,256);return new jb({size:`${t}px`})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field;i&&typeof i=="string"&&th(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new t9({blurRadius:this.blurRadius,referenceScale:this.referenceScale,colorStops:re(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})}};u([d({type:Number,json:{write:!0}})],kh.prototype,"blurRadius",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e!==0})},origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],kh.prototype,"referenceScale",void 0),u([d({type:[g$],json:{write:!0}})],kh.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],kh.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:i==null})}}})],kh.prototype,"fieldOffset",void 0),u([d({type:Number,json:{write:!0}})],kh.prototype,"maxPixelIntensity",void 0),u([d({type:Number,json:{write:!0}})],kh.prototype,"minPixelIntensity",void 0),u([vt({heatmap:"heatmap"})],kh.prototype,"type",void 0),kh=t9=u([P("esri.renderers.HeatmapRenderer")],kh);const w4e=kh;var i9;let S_=i9=class extends YO(lv){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new i9({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:re(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],S_.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],S_.prototype,"label",void 0),u([d(ZO)],S_.prototype,"symbol",void 0),u([vt({simple:"simple"})],S_.prototype,"type",void 0),S_=i9=u([P("esri.renderers.SimpleRenderer")],S_);const VF=S_,x4e=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function r9(e){return e instanceof be}function xJ(e){return e instanceof St?Object.keys(e.items):r9(e)?Ja(e).keys():e?Object.keys(e):[]}function gP(e,t){return e instanceof St?e.items[t]:e[t]}function T4e(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function kC(e){return e?e.declaredClass:null}function Pfe(e,t){const i=e.diff;if(i&&typeof i=="function")return i(e,t);const r=xJ(e),s=xJ(t);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||T4e(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&gP(e,p)!==gP(t,p)).concat(n,o).sort(),l=kC(e);if(l&&x4e.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=r9(e)&&r9(t);for(const p of a){const f=gP(e,p),g=gP(t,p);let y;(h||typeof f!="function"&&typeof g!="function")&&f!==g&&(f==null&&g==null||(y=i&&i[p]&&typeof i[p]=="function"?i[p](f,g):typeof f=="object"&&typeof g=="object"&&kC(f)===kC(g)?Pfe(f,g):{type:"complete",oldValue:f,newValue:g},_(y)&&(_(c)?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})))}return c}function S4e(e,t){if(C(e))return!1;const i=t.split(".");let r=e;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function omt(e,t){for(const i of t)if(S4e(e,i))return!0;return!1}function E4e(e,t){if(!(typeof e=="function"||typeof t=="function"||C(e)&&C(t)))return C(e)||C(t)||typeof e=="object"&&typeof t=="object"&&kC(e)!==kC(t)?{type:"complete",oldValue:e,newValue:t}:Pfe(e,t)}function yP(e){if(C(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const i of t.added)if(!yP(i))return!1;for(const i of t.removed)if(!yP(i))return!1;for(const i of t.changed)if(!yP(i))return!1;return!0}case"partial":for(const t in e.diff)if(!yP(e.diff[t]))return!1;return!0}}var s9;let xy=s9=class extends _e{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new s9({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([d({type:String,json:{write:!0}})],xy.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],xy.prototype,"label",void 0),u([d(ZO)],xy.prototype,"symbol",void 0),u([d({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],xy.prototype,"value",void 0),u([Bt("value")],xy.prototype,"castValue",null),xy=s9=u([P("esri.renderers.support.UniqueValueInfo")],xy);const EL=xy,A4e=()=>!!ue("enable-feature:force-wosr"),amt=()=>!!ue("enable-feature:direct-3d-object-feature-layer-display"),LU={};async function C4e(e,t){try{return{data:(await P4e(e,t)).data,baseUrl:Yle(e),styleUrl:e}}catch(i){return hf(i),null}}function R4e(e,t,i){const r=t&&t.portal||Hl.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return LU[n]||(LU[n]=O4e(e,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl,styleName:e}))),LU[n]}function O4e(e,t,i){return t.load(i).then(()=>{const r=new Pm({disableExtraQuery:!0,query:`owner:${TJ} AND type:${SJ} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords.some(a=>a.toLowerCase()===n)&&o.type===SJ&&o.owner===TJ){s=o;break}}if(!s)throw new Y("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(i)})}function M4e(e,t,i){return e.styleUrl?C4e(e.styleUrl,i):e.styleName?R4e(e.styleName,t,i):Promise.reject(new Y("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function lmt(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function cmt(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!A4e()){for(const i of e.formatInfos)if(i.type==="gltf")return i.href}return e.webRef}function P4e(e,t){const i=L({responseType:"json",query:{f:"json"}},t);return Pi(yd(e),i)}const TJ="esri_en",SJ="Style",umt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var qA;const Sv=pe.getLogger("esri.renderers.UniqueValueRenderer"),I4e=As(EL);let hs=qA=class extends YO(lv){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=t.find(a=>a.value===i[n].value);o?E4e(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<t.length;n++)i.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:$O(e)}writeField(e,t,i,r){typeof e=="string"?t[i]=e:r&&r.messages?r.messages.push(new Y("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):Sv.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||Hl.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const r=y2(t.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=nb(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?Sv.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void Sv.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?I4e(e):new EL({value:e,symbol:Ace(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)Sv.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(C(t)||C(t.arcade))&&(i=ge(L({},i),{arcade:await Jp()})),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(C(t)||C(t.arcade)))return void Sv.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(C(i)||C(i.arcade))){const s=await Jp(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=ge(L({},i),{arcade:s})}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new qA({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:re(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:re(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=re(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(re(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Wc(e,t,this.valueExpression)];th(e,t,this.field),th(e,t,this.field2),th(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return M4e(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const r=new Hb({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new EL({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=Tt(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(i[t]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof t=="function"?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new qA(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||Hl.getDefault());const r=i.populateFromStyle();return r.catch(s=>{Sv.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(e,t){const i=new qA(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch(s=>{Sv.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([d({readOnly:!0})],hs.prototype,"_cache",null),u([vt({uniqueValue:"unique-value"})],hs.prototype,"type",void 0),u([d(Afe)],hs.prototype,"backgroundFillSymbol",void 0),u([d({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],hs.prototype,"field",void 0),u([Bt("field")],hs.prototype,"castField",null),u([Xe("field")],hs.prototype,"writeField",null),u([d({type:String,json:{write:!0}})],hs.prototype,"field2",void 0),u([d({type:String,json:{write:!0}})],hs.prototype,"field3",void 0),u([d({type:String,json:{write:!0}})],hs.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],hs.prototype,"valueExpressionTitle",void 0),u([d({type:LT,json:{write:!0}})],hs.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],hs.prototype,"defaultLabel",void 0),u([d(foe(L({},ZO),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],hs.prototype,"defaultSymbol",null),u([d({type:String,json:{write:!0}})],hs.prototype,"fieldDelimiter",void 0),u([d({type:Hl,readOnly:!0})],hs.prototype,"portal",void 0),u([Ne("portal",["styleName"])],hs.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],hs.prototype,"styleOrigin",void 0),u([Ne("styleOrigin",["styleName","styleUrl"])],hs.prototype,"readStyleOrigin",null),u([Xe("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],hs.prototype,"writeStyleOrigin",null),u([d({type:[EL],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],hs.prototype,"uniqueValueInfos",null),hs=qA=u([P("esri.renderers.UniqueValueRenderer")],hs);const GF=hs,Ife={key:"type",base:lv,typeMap:{heatmap:w4e,simple:VF,"unique-value":GF,"class-breaks":Rfe,"dot-density":b4e,dictionary:g4e},errorContext:"renderer"},$4e={key:"type",base:lv,typeMap:{simple:VF,"unique-value":GF,"class-breaks":Rfe},errorContext:"renderer"},D4e=c2({types:Ife});function L4e(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Hc("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):D4e(e,t,i):null}class WH{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(E6),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const i=new WH,r=this._originStores[wi.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,re(s),wi.DEFAULTS)});for(let s=wi.SERVICE;s<E6;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||i.set(a,re(o),s)})}return i}get(t,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(t):void 0}keys(t){const i=t==null?this._values:this._originStores[t];return i?[...i.keys()]:[]}set(t,i,r=wi.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(t,i),!this._values.has(t)||this._propertyOriginMap.get(t)<=r){const n=this._values.get(t);return this._values.set(t,i),this._propertyOriginMap.set(t,r),n!==i}return!1}delete(t,i=wi.USER){const r=this._originStores[i];if(!r)return;const s=r.get(t);if(r.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===i){this._values.delete(t);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(t)}revert(t,i){for(;i>0&&!this.has(t,i);)--i;const r=this._originStores[i],s=r&&r.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,i),n!==s}originOf(t){return this._propertyOriginMap.get(t)||wi.DEFAULTS}forEach(t){this._values.forEach(t)}}const $fe=e=>{let t=class extends e{constructor(...i){super(...i);const r=Ja(this),s=r.store,n=new WH;r.store=n,gae(r,s,n)}read(i,r){vae(this,i,r)}getAtOrigin(i,r){const s=NU(this),n=r0(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return bD(this.originIdOf(i))}originIdOf(i){return NU(this).originOf(i)}revert(i,r){const s=NU(this),n=r0(r),o=Ja(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function NU(e){return Ja(e).store}let EJ=class extends $fe(be){};EJ=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],EJ);const N4e=e=>{let t=class extends e{constructor(...i){super(...i)}clear(i,r="user"){return FU(this).delete(i,r0(r))}write(i={},r){return bae(this,i=i||{},r),i}setAtOrigin(i,r,s){Ja(this).setAtOrigin(i,r,r0(s))}removeOrigin(i){const r=FU(this),s=r0(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),wi.USER)}updateOrigin(i,r){const s=FU(this),n=r0(r),o=this.get(i);for(let a=n+1;a<E6;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return t=u([P("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function FU(e){return Ja(e).store}const XH=e=>{let t=class extends N4e($fe(e)){constructor(...i){super(...i)}};return t=u([P("esri.core.MultiOriginJSONSupport")],t),t};let AJ=class extends XH(be){};AJ=u([P("esri.core.MultiOriginJSONSupport")],AJ);async function F4e(e,t){const{WhereClause:i}=await import("./WhereClause.d10f799a.js");return i.create(e,t)}function hmt(e,t){return _(e)?_(t)?`(${e}) AND (${t})`:e:t}var n9;let E_=n9=class extends _e{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new n9({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],E_.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],E_.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],E_.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],E_.prototype,"title",void 0),E_=n9=u([P("esri.form.ExpressionInfo")],E_);const U4e=E_;let A_=class extends _e{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],A_.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],A_.prototype,"label",void 0),u([d()],A_.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],A_.prototype,"visibilityExpression",void 0),A_=u([P("esri.form.elements.Element")],A_);const PS=A_;var o9;let y$=o9=class extends _e{constructor(e){super(e),this.type=null}clone(){return new o9({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],y$.prototype,"type",void 0),y$=o9=u([P("esri.form.elements.inputs.AttachmentInput")],y$);const z4e=y$;var a9;let C_=a9=class extends PS{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new a9({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],C_.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],C_.prototype,"editable",void 0),u([d({type:z4e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],C_.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],C_.prototype,"type",void 0),C_=a9=u([P("esri.form.elements.AttachmentElement")],C_);const CJ=C_;let v$=class extends _e{constructor(e){super(e),this.type=null}};u([d()],v$.prototype,"type",void 0),v$=u([P("esri.form.elements.inputs.Input")],v$);const O2=v$;let WA=class extends O2{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],WA.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],WA.prototype,"minLength",void 0),WA=u([P("esri.form.elements.inputs.TextInput")],WA);const YH=WA;var l9;let _$=l9=class extends YH{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new l9({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],_$.prototype,"type",void 0),_$=l9=u([P("esri.form.elements.inputs.BarcodeScannerInput")],_$);const k4e=_$;var c9;let Ex=c9=class extends O2{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new c9({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],Ex.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],Ex.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],Ex.prototype,"type",void 0),Ex=c9=u([P("esri.form.elements.inputs.ComboBoxInput")],Ex);const B4e=Ex;var u9;function RJ(e){return e!=null?new Date(e):null}function OJ(e){return e?e.getTime():null}let Bh=u9=class extends O2{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return RJ(t.max)}writeMax(e,t){t.max=OJ(e)}readMin(e,t){return RJ(t.min)}writeMin(e,t){t.min=OJ(e)}clone(){return new u9({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};u([d({type:Boolean,json:{write:!0}})],Bh.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],Bh.prototype,"max",void 0),u([Ne("max")],Bh.prototype,"readMax",null),u([Xe("max")],Bh.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],Bh.prototype,"min",void 0),u([Ne("min")],Bh.prototype,"readMin",null),u([Xe("min")],Bh.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],Bh.prototype,"type",void 0),Bh=u9=u([P("esri.form.elements.inputs.DateTimePickerInput")],Bh);const V4e=Bh;var h9;let Ax=h9=class extends O2{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new h9({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],Ax.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],Ax.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],Ax.prototype,"type",void 0),Ax=h9=u([P("esri.form.elements.inputs.RadioButtonsInput")],Ax);const G4e=Ax;var d9;let Cx=d9=class extends O2{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new d9({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],Cx.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],Cx.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],Cx.prototype,"type",void 0),Cx=d9=u([P("esri.form.elements.inputs.SwitchInput")],Cx);const j4e=Cx;var p9;let b$=p9=class extends YH{constructor(e){super(e),this.type="text-area"}clone(){return new p9({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],b$.prototype,"type",void 0),b$=p9=u([P("esri.form.elements.inputs.TextAreaInput")],b$);const H4e=b$;var f9;let w$=f9=class extends YH{constructor(e){super(e),this.type="text-box"}clone(){return new f9({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],w$.prototype,"type",void 0),w$=f9=u([P("esri.form.elements.inputs.TextBoxInput")],w$);const q4e=w$,W4e={base:O2,key:"type",typeMap:{"barcode-scanner":k4e,"combo-box":B4e,"datetime-picker":V4e,"radio-buttons":G4e,switch:j4e,"text-area":H4e,"text-box":q4e}};var m9;let xu=m9=class extends PS{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new m9({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:Lde,json:{read:{reader:bH},write:!0}})],xu.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],xu.prototype,"editable",void 0),u([d({type:String,json:{write:!0}})],xu.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],xu.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],xu.prototype,"hint",void 0),u([d({types:W4e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],xu.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],xu.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],xu.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],xu.prototype,"valueExpression",void 0),xu=m9=u([P("esri.form.elements.FieldElement")],xu);const MJ=xu;var g9;let im=g9=class extends PS{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new g9({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:re(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],im.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],im.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],im.prototype,"editable",void 0),u([d({type:[mle],json:{write:!0}})],im.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],im.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],im.prototype,"type",void 0),im=g9=u([P("esri.form.elements.RelationshipElement")],im);const PJ=im;function Dfe(e){return{typesWithGroup:{base:PS,key:"type",typeMap:{attachment:CJ,field:MJ,group:e,relationship:PJ}},typesWithoutGroup:{base:PS,key:"type",typeMap:{attachment:CJ,field:MJ,relationship:PJ}}}}function Lfe(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function Nfe(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>s.toJSON())}function Ffe(e,t,i=!0){return e?e.map(r=>xd(i?t.typesWithGroup:t.typesWithoutGroup,r)):null}var y9;let Ap=y9=class extends PS{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Ffe(e,UU,!1)}readElements(e,t){return Lfe(t.formElements,UU,!1)}writeElements(e,t){t.formElements=Nfe(e,UU,!1)}clone(){return new y9({description:this.description,elements:re(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],Ap.prototype,"elements",void 0),u([Bt("elements")],Ap.prototype,"castElements",null),u([Ne("elements",["formElements"])],Ap.prototype,"readElements",null),u([Xe("elements")],Ap.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],Ap.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],Ap.prototype,"type",void 0),Ap=y9=u([P("esri.form.elements.GroupElement")],Ap);const UU=Dfe(Ap),X4e=Ap;var v9;const zU=Dfe(X4e);let pp=v9=class extends _e{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Ffe(e,zU)}readElements(e,t){return Lfe(t.formElements,zU)}writeElements(e,t){t.formElements=Nfe(e,zU)}clone(){return new v9({description:this.description,expressionInfos:re(this.expressionInfos),elements:re(this.elements),title:this.title})}};u([d({type:String,json:{write:!0}})],pp.prototype,"description",void 0),u([d({json:{write:!0}})],pp.prototype,"elements",void 0),u([Bt("elements")],pp.prototype,"castElements",null),u([Ne("elements",["formElements"])],pp.prototype,"readElements",null),u([Xe("elements")],pp.prototype,"writeElements",null),u([d({type:[U4e],json:{write:!0}})],pp.prototype,"expressionInfos",void 0),u([d({type:String,json:{write:!0}})],pp.prototype,"title",void 0),pp=v9=u([P("esri.form.FormTemplate")],pp);const Y4e=pp;let Z4e=0;const IJ=pe.getLogger("esri.layers.Layer");let Sn=class extends qr.EventedMixin(KN(rf)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ni(-180,-90,180,90,Ke.WGS84),this.id=Date.now().toString(16)+"-layer-"+Z4e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ke.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e,i=await import("./arcgisLayers.120676f0.js");try{return await i.fromUrl(t)}catch(r){throw IJ.error("#fromArcGISServerUrl({ url: '"+t.url+"'})","Failed to create layer from arcgis server url",r),r}}static async fromPortalItem(e){const t="portalItem"in e?e:{portalItem:e},i=await import("./portalLayers.36e14a8b.js");try{return await i.fromItem(t)}catch(r){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||rr.portalUrl;throw IJ.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}initialize(){this.when().catch(e=>{var t,i;Tr(e)||pe.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(i=this.id)!=null?i:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?ya(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Pi(e,{query:{f:"json"},responseType:"json"})).data;throw new Y("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],Sn.prototype,"attributionDataUrl",void 0),u([d({type:ni})],Sn.prototype,"fullExtent",void 0),u([d({readOnly:!0})],Sn.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],Sn.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],Sn.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],Sn.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],Sn.prototype,"opacity",void 0),u([d({clonable:!1})],Sn.prototype,"parent",void 0),u([d({readOnly:!0})],Sn.prototype,"parsedUrl",null),u([d({type:Boolean})],Sn.prototype,"popupEnabled",void 0),u([d({type:Boolean})],Sn.prototype,"attributionVisible",void 0),u([d({type:Ke})],Sn.prototype,"spatialReference",void 0),u([d({type:String})],Sn.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],Sn.prototype,"type",void 0),u([d()],Sn.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],Sn.prototype,"visible",void 0),Sn=u([P("esri.layers.Layer")],Sn);const QO=Sn;function $J(e,t,i){if(e.hasM==null||e.hasZ)for(const r of t)for(const s of r)s.length>2&&(s[2]*=i)}function Q4e(e,t,i){if(!e&&!t||!i)return;const r=lb(i);DJ(e,i,r),DJ(t,i,r)}function DJ(e,t,i){if(e)for(const r of e)J4e(r.geometry,t,i)}function J4e(e,t,i){if(C(e)||!e.spatialReference||Kc(e.spatialReference,t))return;const r=lb(e.spatialReference)/i;if(r!==1){if("x"in e)e.z!=null&&(e.z*=r);else if("rings"in e)$J(e,e.rings,r);else if("paths"in e)$J(e,e.paths,r);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}}let K4e=0;const kU=pe.getLogger("esri.layers.graphics.sources.MemorySource");let wm=class extends rf.LoadableMixin(v2(Fd(St))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var e;const t=(e=this.layer)==null?void 0:e.geometryType;return t?this._geometryTypeRequiresClientGraphicMapping(t)?"polygon":t:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);p8(e,this.layer.spatialReference,i);const r=DF.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new Y("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return p8(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(i=>({count:i.count,extent:ni.fromJSON(i.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new Y("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&r.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}Q4e(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||C(e))return;const i=[];for(const{geometry:r}of e)!_(r)||r.type!=="mesh"||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const r=e.get(i.objectId);r!=null&&this._addIdToClientGraphic(r)}for(const i of t.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new Y("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!r&&_(o.geometry)&&(r=o.geometry.type),i[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:i,inferredGeometryType:r,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];i!=null&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){var e,t,i;return(e=(t=this.layer)==null?void 0:t.geometryType)!=null?e:(i=this.sourceJSON)==null?void 0:i.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(K4e++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return C(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?jl.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await Nce("MemorySourceWorker",{strategy:ue("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{kU.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:mY.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&s,hasZ:this.layerOrSourceGeometryType==="mesh"||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const f of h.warnings)kU.warn(f.message,{layer:this.layer,warning:f});h.featureErrors.length&&kU.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=mY.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([H7({Type:ho,ensureType:As(ho)})],wm.prototype,"itemType",void 0),u([d()],wm.prototype,"type",void 0),u([d({constructOnly:!0})],wm.prototype,"layer",void 0),u([d({readOnly:!0})],wm.prototype,"workerGeometryType",null),u([d()],wm.prototype,"sourceJSON",void 0),wm=u([P("esri.layers.graphics.sources.MemorySource")],wm);function e5e(e){return"portalItem"in e}const t5e=e=>{let t=class extends e{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):e5e(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],t.prototype,"apiKey",null),t=u([P("esri.layers.mixins.APIKeyMixin")],t),t},Ufe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},zfe=Object.values(Ufe),kfe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${zfe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),i5e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${zfe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),r5e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function dmt(e){return!!kfe.test(e)}function JO(e){const t=ya(e),i=t.path.match(kfe)||t.path.match(i5e);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:ZH(a!==-1?s.slice(a+1):s),serverType:Ufe[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function s5e(e){const t=ya(e).path.match(r5e);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function ZH(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function n5e(e,t){const i=[];if(e){const r=JO(e);_(r)&&r.title&&i.push(r.title)}if(t){const r=ZH(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function Bfe(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(i)||e.includes(r)||e.includes(s);return n&&o}function o5e(e,t){return e&&Zle(Qle(e,t))}function a5e(e){let{url:t}=e;if(!t)return{url:t};t=Qle(t,e.logger);const i=ya(t),r=JO(i.path);let s;if(_(r))r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const n=s5e(i.path);_(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:Zle(t),layerId:s}}function l5e(e,t,i,r,s){U0(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=sb(r.url,i,e.layerId.toString()))}function pmt(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(r||s||n)}const Vfe=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=JO(this.url);if(_(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",o5e(i,pe.getLogger(this.declaredClass)))}};return u([d()],t.prototype,"title",null),u([d({type:String})],t.prototype,"url",null),t=u([P("esri.layers.mixins.ArcGISService")],t),t};function KO(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function c5e(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function u5e(e,t,i,r,s,n,o,a,l,c,h,p,f,g,y,v){const b=new Float32Array(16);return b[0]=e,b[1]=t,b[2]=i,b[3]=r,b[4]=s,b[5]=n,b[6]=o,b[7]=a,b[8]=l,b[9]=c,b[10]=h,b[11]=p,b[12]=f,b[13]=g,b[14]=y,b[15]=v,b}function h5e(e,t){return new Float32Array(e,t,16)}const d5e=KO();Object.freeze(Object.defineProperty({__proto__:null,create:KO,clone:c5e,fromValues:u5e,createView:h5e,IDENTITY:d5e},Symbol.toStringTag,{value:"Module"}));const p5e=(e,t)=>{const i=yf(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return rl(i,i)},f5e=(e,t)=>{const i=yf(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return rl(i,i)},m5e=(e,t)=>{const i=1-t,r=yf(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return rl(r,r)},g5e=(e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=yf(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return rl(s,s)},y5e=(e,t)=>{const i=1-2*t,r=yf(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return rl(r,r)},v5e=(e,t)=>{const i=yf(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return rl(i,i)},_5e=(e,t)=>{const i=1-t,r=yf(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return rl(r,r)};class jF{constructor(t,i,r){this.strength=t,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(t,i,r){this.strength=Ml(t.strength,i.strength,r),this.radius=Ml(t.radius,i.radius,r),this.threshold=Ml(t.threshold,i.threshold,r)}clone(){return new jF(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:BC(this.radius),strength:this.strength,threshold:this.threshold}}}class HF{constructor(t){this.radius=t,this.type="blur"}interpolate(t,i,r){this.radius=Math.round(Ml(t.radius,i.radius,r))}clone(){return new HF(this.radius)}toJSON(){return{type:"blur",radius:BC(this.radius)}}}class $R{constructor(t,i){this.type=t,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.amount=Ml(t.amount,i.amount,r),this._updateMatrix()}clone(){return new $R(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||KO();switch(this.type){case"brightness":this._colorMatrix=p5e(t,this.amount);break;case"contrast":this._colorMatrix=f5e(t,this.amount);break;case"grayscale":this._colorMatrix=m5e(t,this.amount);break;case"invert":this._colorMatrix=y5e(t,this.amount);break;case"saturate":this._colorMatrix=v5e(t,this.amount);break;case"sepia":this._colorMatrix=_5e(t,this.amount)}}}class qF{constructor(t,i,r,s){this.offsetX=t,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(t,i,r){this.offsetX=Ml(t.offsetX,i.offsetX,r),this.offsetY=Ml(t.offsetY,i.offsetY,r),this.blurRadius=Ml(t.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Ml(t.color[0],i.color[0],r)),this.color[1]=Math.round(Ml(t.color[1],i.color[1],r)),this.color[2]=Math.round(Ml(t.color[2],i.color[2],r)),this.color[3]=Ml(t.color[3],i.color[3],r)}clone(){return new qF(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:BC(this.offsetX),yoffset:BC(this.offsetY),blurRadius:BC(this.blurRadius),color:t}}}class WF{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.angle=Ml(t.angle,i.angle,r),this._updateMatrix()}clone(){return new WF(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||KO();this._colorMatrix=g5e(t,this.angle)}}class XF{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,i,r){this.amount=Ml(t.amount,i.amount,r)}clone(){return new XF(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function Ml(e,t,i){return e+(t-e)*i}function BC(e){return Math.round(1e3*Sd(e))/1e3}function b5e(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new $R(e.type,0);case"saturate":case"brightness":case"contrast":return new $R(e.type,1);case"opacity":return new XF(1);case"hue-rotate":return new WF(0);case"blur":return new HF(0);case"drop-shadow":return new qF(0,0,0,[...aj("transparent")]);case"bloom":return new jF(0,0,1)}}function w5e(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every((r,s)=>r.type===i[s].type)}function x5e(e,t){const i=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let s=r.length;s<i.length;s++)r.push(b5e(i[s]))}function T5e(e){const t=e[0];return!!t&&"type"in t}var LJ,NJ,Gfe={exports:{}};function jfe(e){if(!e||e.length===0)return null;if(typeof e=="string"){const i=FJ(e);return i&&i.length!==0?i:null}const t=e.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new Y("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:FJ(i.value)}});t.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<t.length-1;i++){if(!w5e(t[i].effects,t[i+1].effects))throw new Y("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[i].effects,b:t[i+1].effects});x5e(t[i].effects,t[i+1].effects)}return t.sort((i,r)=>r.scale-i.scale),t}function FJ(e){let t;if(!e)return[];try{t=Gfe.exports.parse(e)}catch(i){throw new Y("effect:invalid-syntax","Invalid effect syntax",{value:e,error:i})}return t.map(i=>S5e(i))}function S5e(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return E5e(e);case"opacity":return A5e(e);case"hue-rotate":return C5e(e);case"blur":return R5e(e);case"drop-shadow":return O5e(e);case"bloom":return M5e(e)}}catch(t){throw t.details.filter=e,t}throw new Y("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function E5e(e){let t=1;return M2(e.parameters,1),e.parameters.length===1&&(t=td(e.parameters[0])),new $R(e.name,t)}function A5e(e){let t=1;return M2(e.parameters,1),e.parameters.length===1&&(t=td(e.parameters[0])),new XF(t)}function C5e(e){let t=0;return M2(e.parameters,1),e.parameters.length===1&&(t=N5e(e.parameters[0])),new WF(t)}function R5e(e){let t=0;return M2(e.parameters,1),e.parameters.length===1&&(t=KH(e.parameters[0]),eM(t,e.parameters[0])),new HF(t)}function O5e(e){const t=[];let i=null;for(const r of e.parameters)if(r.type==="color"){if(t.length&&Object.freeze(t),i)throw new Y("effect:type-error","Accepts only one color",{});i=F5e(r)}else{const s=KH(r);if(Object.isFrozen(t))throw new Y("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&eM(s,r)}if(t.length<2||t.length>3)throw new Y("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new qF(t[0],t[1],t[2]||0,i||Hfe("black"))}function M5e(e){let t=1,i=0,r=0;return M2(e.parameters,3),e.parameters[0]&&(t=td(e.parameters[0])),e.parameters[1]&&(i=KH(e.parameters[1]),eM(i,e.parameters[1])),e.parameters[2]&&(r=td(e.parameters[2])),new jF(t,i,r)}function M2(e,t){if(e.length>t)throw new Y("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function YF(e){if(e.type==="color")return"<color>";if(e.unit){if(JH[e.unit])return"<length>";if(QH[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function eM(e,t){if(e<0)throw new Y("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function P5e(e){if(e.type!=="quantity"||e.unit!==null)throw new Y("effect:type-error",`Expected <double>, Actual: ${YF(e)}`,{term:e})}function I5e(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new Y("effect:type-error",`Expected <double> or <percentage>, Actual: ${YF(e)}`,{term:e})}NJ=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:AX},h=AX,p="none",f=")",g=",",y="(",v="%",b="px",w="cm",S="mm",x="in",E="pt",R="pc",O="deg",I="rad",U="grad",N="turn",V="#",j=".",H="e",J=/^[ \t\n\r]/,K=/^[a-z\-]/,he=/^[0-9a-fA-F]/,le=/^[+\-]/,$=/^[0-9]/,z=Af("none"),k=is("none",!1),G=is(")",!1),W=is(",",!1),ee=Af("whitespace"),q=j2([" ","	",`
`,"\r"],!1,!1),te=Af("function"),Ee=is("(",!1),ve=Af("identifier"),qe=j2([["a","z"],"-"],!1,!1),Ce=Af("percentage"),Re=is("%",!1),Oe=Af("length"),Ve=is("px",!1),nr=is("cm",!1),Ti=is("mm",!1),hi=is("in",!1),tn=is("pt",!1),Sr=is("pc",!1),Er=Af("angle"),Ps=is("deg",!1),zo=is("rad",!1),ft=is("grad",!1),Gn=is("turn",!1),jn=Af("number"),wa=Af("color"),rn=is("#",!1),Ql=j2([["0","9"],["a","f"],["A","F"]],!1,!1),Ag=j2(["+","-"],!1,!1),Jl=j2([["0","9"]],!1,!1),rw=is(".",!1),ll=is("e",!1),sw=function(){return[]},mv=function(X,me){return{type:"function",name:X,parameters:me||[]}},k2=function(X,me){return me.length>0?Cwe(X,me,3):[X]},gv=function(X){return{type:"quantity",value:X.value,unit:X.unit}},yv=function(X){return{type:"color",colorType:X.type,value:X.value}},Nr=function(X){return X},ko=function(){return bv()},Kl=function(X){return{value:X,unit:"%"}},B2=function(X){return{value:X,unit:"px"}},nw=function(X){return{value:X,unit:"cm"}},ow=function(X){return{value:X,unit:"mm"}},aw=function(X){return{value:X,unit:"in"}},iu=function(X){return{value:X,unit:"pt"}},xM=function(X){return{value:X,unit:"pc"}},vv=function(X){return{value:X,unit:"deg"}},lw=function(X){return{value:X,unit:"rad"}},V2=function(X){return{value:X,unit:"grad"}},_v=function(X){return{value:X,unit:"turn"}},TM=function(X){return{value:X,unit:null}},SM=function(){return{type:"hex",value:bv()}},G2=function(X){return{type:"function",value:X}},EM=function(){return{type:"named",value:bv()}},A5=function(){return parseFloat(bv())},ce=0,Lt=0,vn=[{line:1,column:1}],vr=0,cl=[],st=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function bv(){return s.substring(Lt,ce)}function is(X,me){return{type:"literal",text:X,ignoreCase:me}}function j2(X,me,Pe){return{type:"class",parts:X,inverted:me,ignoreCase:Pe}}function mwe(){return{type:"end"}}function Af(X){return{type:"other",description:X}}function SX(X){var me,Pe=vn[X];if(Pe)return Pe;for(me=X-1;!vn[me];)me--;for(Pe={line:(Pe=vn[me]).line,column:Pe.column};me<X;)s.charCodeAt(me)===10?(Pe.line++,Pe.column=1):Pe.column++,me++;return vn[X]=Pe,Pe}function EX(X,me){var Pe=SX(X),di=SX(me);return{source:l,start:{offset:X,line:Pe.line,column:Pe.column},end:{offset:me,line:di.line,column:di.column}}}function Wt(X){ce<vr||(ce>vr&&(vr=ce,cl=[]),cl.push(X))}function gwe(X,me,Pe){return new t(t.buildMessage(X,me),X,me,Pe)}function AX(){var X;return(X=ywe())===a&&(X=vwe()),X}function ywe(){var X,me;return st++,X=ce,Hn(),s.substr(ce,4)===p?(me=p,ce+=4):(me=a,st===0&&Wt(k)),me!==a?(Hn(),Lt=X,X=sw()):(ce=X,X=a),st--,X===a&&st===0&&Wt(z),X}function vwe(){var X,me;if(X=[],(me=C5())!==a)for(;me!==a;)X.push(me),me=C5();else X=a;return X}function C5(){var X,me,Pe,di;return X=ce,Hn(),(me=bwe())!==a?(Hn(),(Pe=_we())===a&&(Pe=null),Hn(),s.charCodeAt(ce)===41?(di=f,ce++):(di=a,st===0&&Wt(G)),di!==a?(Hn(),Lt=X,X=mv(me,Pe)):(ce=X,X=a)):(ce=X,X=a),X}function _we(){var X,me,Pe,di,mo,cs,su,AM;if(X=ce,(me=R5())!==a){for(Pe=[],di=ce,mo=Hn(),s.charCodeAt(ce)===44?(cs=g,ce++):(cs=a,st===0&&Wt(W)),cs===a&&(cs=null),su=Hn(),(AM=R5())!==a?di=mo=[mo,cs,su,AM]:(ce=di,di=a);di!==a;)Pe.push(di),di=ce,mo=Hn(),s.charCodeAt(ce)===44?(cs=g,ce++):(cs=a,st===0&&Wt(W)),cs===a&&(cs=null),su=Hn(),(AM=R5())!==a?di=mo=[mo,cs,su,AM]:(ce=di,di=a);Lt=X,X=k2(me,Pe)}else ce=X,X=a;return X}function R5(){var X,me;return X=ce,(me=wwe())===a&&(me=xwe())===a&&(me=Twe())===a&&(me=Swe()),me!==a&&(Lt=X,me=gv(me)),(X=me)===a&&(X=ce,(me=Ewe())!==a&&(Lt=X,me=yv(me)),X=me),X}function Hn(){var X,me;for(st++,X=[],J.test(s.charAt(ce))?(me=s.charAt(ce),ce++):(me=a,st===0&&Wt(q));me!==a;)X.push(me),J.test(s.charAt(ce))?(me=s.charAt(ce),ce++):(me=a,st===0&&Wt(q));return st--,me=a,st===0&&Wt(ee),X}function bwe(){var X,me,Pe;return st++,X=ce,(me=CX())!==a?(s.charCodeAt(ce)===40?(Pe=y,ce++):(Pe=a,st===0&&Wt(Ee)),Pe!==a?(Lt=X,X=Nr(me)):(ce=X,X=a)):(ce=X,X=a),st--,X===a&&(me=a,st===0&&Wt(te)),X}function CX(){var X,me,Pe;if(st++,X=ce,me=[],K.test(s.charAt(ce))?(Pe=s.charAt(ce),ce++):(Pe=a,st===0&&Wt(qe)),Pe!==a)for(;Pe!==a;)me.push(Pe),K.test(s.charAt(ce))?(Pe=s.charAt(ce),ce++):(Pe=a,st===0&&Wt(qe));else me=a;return me!==a&&(Lt=X,me=ko()),st--,(X=me)===a&&(me=a,st===0&&Wt(ve)),X}function wwe(){var X,me,Pe;return st++,X=ce,Hn(),(me=ru())!==a?(s.charCodeAt(ce)===37?(Pe=v,ce++):(Pe=a,st===0&&Wt(Re)),Pe!==a?(Lt=X,X=Kl(me)):(ce=X,X=a)):(ce=X,X=a),st--,X===a&&st===0&&Wt(Ce),X}function xwe(){var X,me,Pe;return st++,X=ce,Hn(),(me=ru())!==a?(s.substr(ce,2)===b?(Pe=b,ce+=2):(Pe=a,st===0&&Wt(Ve)),Pe!==a?(Lt=X,X=B2(me)):(ce=X,X=a)):(ce=X,X=a),X===a&&(X=ce,Hn(),(me=ru())!==a?(s.substr(ce,2)===w?(Pe=w,ce+=2):(Pe=a,st===0&&Wt(nr)),Pe!==a?(Lt=X,X=nw(me)):(ce=X,X=a)):(ce=X,X=a),X===a&&(X=ce,Hn(),(me=ru())!==a?(s.substr(ce,2)===S?(Pe=S,ce+=2):(Pe=a,st===0&&Wt(Ti)),Pe!==a?(Lt=X,X=ow(me)):(ce=X,X=a)):(ce=X,X=a),X===a&&(X=ce,Hn(),(me=ru())!==a?(s.substr(ce,2)===x?(Pe=x,ce+=2):(Pe=a,st===0&&Wt(hi)),Pe!==a?(Lt=X,X=aw(me)):(ce=X,X=a)):(ce=X,X=a),X===a&&(X=ce,Hn(),(me=ru())!==a?(s.substr(ce,2)===E?(Pe=E,ce+=2):(Pe=a,st===0&&Wt(tn)),Pe!==a?(Lt=X,X=iu(me)):(ce=X,X=a)):(ce=X,X=a),X===a&&(X=ce,Hn(),(me=ru())!==a?(s.substr(ce,2)===R?(Pe=R,ce+=2):(Pe=a,st===0&&Wt(Sr)),Pe!==a?(Lt=X,X=xM(me)):(ce=X,X=a)):(ce=X,X=a)))))),st--,X===a&&st===0&&Wt(Oe),X}function Twe(){var X,me,Pe;return st++,X=ce,(me=ru())!==a?(s.substr(ce,3)===O?(Pe=O,ce+=3):(Pe=a,st===0&&Wt(Ps)),Pe!==a?(Lt=X,X=vv(me)):(ce=X,X=a)):(ce=X,X=a),X===a&&(X=ce,(me=ru())!==a?(s.substr(ce,3)===I?(Pe=I,ce+=3):(Pe=a,st===0&&Wt(zo)),Pe!==a?(Lt=X,X=lw(me)):(ce=X,X=a)):(ce=X,X=a),X===a&&(X=ce,(me=ru())!==a?(s.substr(ce,4)===U?(Pe=U,ce+=4):(Pe=a,st===0&&Wt(ft)),Pe!==a?(Lt=X,X=V2(me)):(ce=X,X=a)):(ce=X,X=a),X===a&&(X=ce,(me=ru())!==a?(s.substr(ce,4)===N?(Pe=N,ce+=4):(Pe=a,st===0&&Wt(Gn)),Pe!==a?(Lt=X,X=_v(me)):(ce=X,X=a)):(ce=X,X=a)))),st--,X===a&&(me=a,st===0&&Wt(Er)),X}function Swe(){var X,me;return st++,X=ce,Hn(),(me=ru())!==a?(Lt=X,X=TM(me)):(ce=X,X=a),st--,X===a&&st===0&&Wt(jn),X}function Ewe(){var X,me,Pe,di;if(st++,X=ce,s.charCodeAt(ce)===35?(me=V,ce++):(me=a,st===0&&Wt(rn)),me!==a){if(Pe=[],he.test(s.charAt(ce))?(di=s.charAt(ce),ce++):(di=a,st===0&&Wt(Ql)),di!==a)for(;di!==a;)Pe.push(di),he.test(s.charAt(ce))?(di=s.charAt(ce),ce++):(di=a,st===0&&Wt(Ql));else Pe=a;Pe!==a?(Lt=X,X=SM()):(ce=X,X=a)}else ce=X,X=a;return X===a&&(X=ce,(me=C5())!==a&&(Lt=X,me=G2(me)),(X=me)===a&&(X=ce,(me=CX())!==a&&(Lt=X,me=EM()),X=me)),st--,X===a&&(me=a,st===0&&Wt(wa)),X}function ru(){var X,me,Pe,di,mo,cs,su;for(X=ce,le.test(s.charAt(ce))?(s.charAt(ce),ce++):st===0&&Wt(Ag),me=ce,Pe=[],$.test(s.charAt(ce))?(di=s.charAt(ce),ce++):(di=a,st===0&&Wt(Jl));di!==a;)Pe.push(di),$.test(s.charAt(ce))?(di=s.charAt(ce),ce++):(di=a,st===0&&Wt(Jl));if(s.charCodeAt(ce)===46?(di=j,ce++):(di=a,st===0&&Wt(rw)),di!==a){if(mo=[],$.test(s.charAt(ce))?(cs=s.charAt(ce),ce++):(cs=a,st===0&&Wt(Jl)),cs!==a)for(;cs!==a;)mo.push(cs),$.test(s.charAt(ce))?(cs=s.charAt(ce),ce++):(cs=a,st===0&&Wt(Jl));else mo=a;mo!==a?me=Pe=[Pe,di,mo]:(ce=me,me=a)}else ce=me,me=a;if(me===a)if(me=[],$.test(s.charAt(ce))?(Pe=s.charAt(ce),ce++):(Pe=a,st===0&&Wt(Jl)),Pe!==a)for(;Pe!==a;)me.push(Pe),$.test(s.charAt(ce))?(Pe=s.charAt(ce),ce++):(Pe=a,st===0&&Wt(Jl));else me=a;if(me!==a){if(Pe=ce,s.charCodeAt(ce)===101?(di=H,ce++):(di=a,st===0&&Wt(ll)),di!==a){if(le.test(s.charAt(ce))?(mo=s.charAt(ce),ce++):(mo=a,st===0&&Wt(Ag)),mo===a&&(mo=null),cs=[],$.test(s.charAt(ce))?(su=s.charAt(ce),ce++):(su=a,st===0&&Wt(Jl)),su!==a)for(;su!==a;)cs.push(su),$.test(s.charAt(ce))?(su=s.charAt(ce),ce++):(su=a,st===0&&Wt(Jl));else cs=a;cs!==a?Pe=di=[di,mo,cs]:(ce=Pe,Pe=a)}else ce=Pe,Pe=a;Pe===a&&(Pe=null),Lt=X,X=A5()}else ce=X,X=a;return X}function Awe(X,me){return X.map(function(Pe){return Pe[me]})}function Cwe(X,me,Pe){return[X].concat(Awe(me,Pe))}if((o=h())!==a&&ce===s.length)return o;throw o!==a&&ce<s.length&&Wt(mwe()),gwe(cl,vr<s.length?s.charAt(vr):null,vr<s.length?EX(vr,vr+1):EX(vr,vr))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length),f=a[l.line-1],g=l.line===h.line?h.column:f.length+1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1)+i("",g-l.column,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(g){return'"'+l(g.text)+'"'},class:function(g){var y=g.parts.map(function(v){return Array.isArray(v)?c(v[0])+"-"+c(v[1]):c(v)});return"["+(g.inverted?"^":"")+y+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(g){return g.description}};function a(g){return g.charCodeAt(0).toString(16).toUpperCase()}function l(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(g){return o[g.type](g)}function p(g){var y,v,b=g.map(h);if(b.sort(),b.length>0){for(y=1,v=1;y<b.length;y++)b[y-1]!==b[y]&&(b[v]=b[y],v++);b.length=v}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function f(g){return g?'"'+l(g)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:r}},(LJ=Gfe).exports&&(LJ.exports=NJ());const QH={deg:1,grad:.9,rad:180/Math.PI,turn:360};function $5e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&QH[e.unit]!=null))throw new Y("effect:type-error",`Expected <angle>, Actual: ${YF(e)}`,{term:e})}const JH={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function D5e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&JH[e.unit]!=null))throw new Y("effect:type-error",`Expected <length>, Actual: ${YF(e)}`,{term:e})}function td(e){I5e(e);const t=e.value;return eM(t,e),e.unit==="%"?.01*t:t}function L5e(e){return P5e(e),eM(e.value,e),e.value}function N5e(e){return $5e(e),e.value*QH[e.unit]||0}function KH(e){return D5e(e),e.value*JH[e.unit]||0}function F5e(e){switch(e.colorType){case"hex":return sEe(e.value);case"named":return Hfe(e.value);case"function":return k5e(e.value)}}function Hfe(e){if(!vle(e))throw new Y("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return rEe(e)}const U5e=/^rgba?/i,z5e=/^hsla?/i;function k5e(e){if(M2(e.parameters,4),U5e.test(e.name))return[td(e.parameters[0]),td(e.parameters[1]),td(e.parameters[2]),e.parameters[3]?td(e.parameters[3]):1];if(z5e.test(e.name))return _le(L5e(e.parameters[0]),td(e.parameters[1]),td(e.parameters[2]),e.parameters[3]?td(e.parameters[3]):1);throw new Y("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function eq(e,t,i){try{return V5e(e)}catch(s){var r;i==null||(r=i.messages)==null||r.push(s)}return null}function tq(e,t,i,r){try{const s=B5e(e);Gl(i,s,t)}catch(s){r.messages&&r.messages.push(s)}}function B5e(e){const t=jfe(e);return t?T5e(t)?t.map(i=>i.toJSON()):t.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function V5e(e){if(!e||e.length===0)return null;if(G5e(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:UJ(i.value)});return t}return UJ(e)}function G5e(e){const t=e[0];return!!t&&"scale"in t}function UJ(e){if(!e||!e.length)return"";const t=[];for(const i of e){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Rf(i,"amount")];break;case"blur":r=[Rf(i,"radius","pt")];break;case"hue-rotate":r=[Rf(i,"angle","deg")];break;case"drop-shadow":r=[Rf(i,"xoffset","pt"),Rf(i,"yoffset","pt"),Rf(i,"blurRadius","pt"),j5e(i,"color")];break;case"bloom":r=[Rf(i,"strength"),Rf(i,"radius","pt"),Rf(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;jfe(s),t.push(s)}return t.join(" ")}function Rf(e,t,i){if(e[t]==null)throw new Y("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function j5e(e,t){if(e[t]==null)throw new Y("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const zJ={read:{reader:eq},write:{allowNull:!0,writer:tq}},qfe=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":zJ,"portal-item":zJ}}})],t.prototype,"effect",void 0),t=u([P("esri.layers.mixins.BlendLayer")],t),t},H5e=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([P("esri.layers.mixins.CustomParametersMixin")],t),t};var _9;const BU=new yi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),VU=new yi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let fp=_9=class extends _e{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Np(L({geometry:re(i),objectIds:re(n),spatialRelationship:r,timeExtent:re(s),where:t,units:o,distance:a},e))}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new _9({geometry:re(t),objectIds:re(s),spatialRelationship:i,timeExtent:re(r),where:e,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],fp.prototype,"where",void 0),u([d({types:kb,json:{write:!0}})],fp.prototype,"geometry",void 0),u([d({type:BU.apiValues,json:{name:"spatialRel",read:{reader:BU.read},write:{allowNull:!1,writer:BU.write,overridePolicy(){return{enabled:_(this.geometry)}}}}})],fp.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],fp.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],fp.prototype,"objectIds",void 0),u([d({type:VU.apiValues,json:{read:VU.read,write:{writer:VU.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],fp.prototype,"units",void 0),u([d({type:_f,json:{write:!0}})],fp.prototype,"timeExtent",void 0),fp=_9=u([P("esri.layers.support.FeatureFilter")],fp);const q5e=fp;var b9;const kJ={read:{reader:eq},write:{writer:tq,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},BJ={read:{reader:eq},write:{writer:tq,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},VJ={name:"showExcludedLabels",default:!0};let R_=b9=class extends _e{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){const i=super.write(e,t);if(t!=null&&t.origin){if(i.filter){const n=Object.keys(i.filter);var r;if(n.length>1||n[0]!=="where")return(r=t.messages)==null||r.push(new Y("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}var s;if("showExcludedLabels"in i)return(s=t.messages)==null||s.push(new Y("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new b9({filter:_(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:q5e,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e==null?void 0:e.write({},r);s&&Object.keys(s).length!==0?Gl(i,s,t):Gl(i,null,t)}}}})],R_.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":kJ,"portal-item":kJ}}})],R_.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":BJ,"portal-item":BJ}}})],R_.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":VJ,"portal-item":VJ}}})],R_.prototype,"excludedLabelsVisible",void 0),R_=b9=u([P("esri.layers.support.FeatureEffect")],R_);const W5e=R_,GJ={write:{allowNull:!0}},X5e=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:W5e,json:{origins:{"web-map":GJ,"portal-item":GJ}}})],t.prototype,"featureEffect",void 0),t=u([P("esri.layers.mixins.FeatureEffectLayer")],t),t},Y5e={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function Z5e(e){if(!e)return e;const{start:t,end:i}=e;return new _f({start:_(t)?z1(t,-t.getTimezoneOffset(),"minutes"):t,end:_(i)?z1(i,-i.getTimezoneOffset(),"minutes"):i})}function Q5e(e){if(!e)return e;const{start:t,end:i}=e;return new _f({start:_(t)?z1(t,t.getTimezoneOffset(),"minutes"):t,end:_(i)?z1(i,i.getTimezoneOffset(),"minutes"):i})}var w9;let XA=w9=class extends _e{async collectRequiredFields(e,t){return Wc(e,t,this.expression)}clone(){return new w9({expression:this.expression,title:this.title})}};u([d({type:String,json:{write:!0}})],XA.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],XA.prototype,"title",void 0),XA=w9=u([P("esri.layers.support.FeatureExpressionInfo")],XA);const jJ=XA;function J5e(e){return MS[e]!=null}function K5e(e){return 1/(MS[e]||1)}function eUe(){const e=Object.keys(MS);return e.sort(),e}const tUe=eUe();var x9;const vP=Uo()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),HJ=new yi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let rm=x9=class extends _e{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):_(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new x9({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}};u([d({type:jJ,json:{write:!0}})],rm.prototype,"featureExpressionInfo",void 0),u([Ne("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],rm.prototype,"readFeatureExpressionInfo",null),u([Xe("featureExpressionInfo",{featureExpressionInfo:{type:jJ},"featureExpression.value":{type:[0]}})],rm.prototype,"writeFeatureExpressionInfo",null),u([d({type:vP.apiValues,nonNullable:!0,json:{type:vP.jsonValues,read:vP.read,write:{writer:vP.write,isRequired:!0}}})],rm.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],rm.prototype,"offset",void 0),u([d({type:tUe,json:{type:String,read:HJ.read,write:HJ.write}})],rm.prototype,"unit",null),rm=x9=u([P("esri.layers.support.ElevationInfo")],rm);const Wfe=rm,iUe={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},Xfe={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},Yfe={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},Zfe={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:U0}}},rUe={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},sUe={value:null,type:Wfe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function fmt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const x$={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},nUe=ge(L({},x$),{json:ge(L({},x$.json),{origins:{"web-document":ge(L({},x$.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&i.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?_R(t.layerDefinition.drawingInfo.transparency):void 0:_R(t.drawingInfo.transparency)}})}),mmt={type:_f,readOnly:!0,get(){var e,t;if((e=this.layer)==null||!e.timeInfo)return null;const{datesInUnknownTimezone:i,timeOffset:r,useViewTime:s}=this.layer,n=(t=this.view)==null?void 0:t.timeExtent;let o=this.layer.timeExtent;i&&(o=Q5e(o));let a=s?n&&o?n.intersection(o):n||o:o;if(!a||a.isEmpty||a.isAllTime)return a;r&&(a=a.offset(-r.value,r.unit)),i&&(a=Z5e(a));const l=this._get("timeExtent");return a.equals(l)?l:a}},gmt={type:ni,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=ni.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(i.spatialReference=Ke.fromJSON(t.spatialReference)),i}}}},read:!1}},oUe={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},aUe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},lUe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},Qfe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Jfe=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&_Se(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i||"Layer"}read(i,r){r&&(r.layer=this),mSe(this,i,s=>super.read(i,s),r)}write(i,r){if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=Y5e[l];let h=c&&c[this.operationalLayerType];var s;if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),!h)return(s=r.messages)==null||s.push(new Y("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const n=super.write(i,ge(L({},r),{layer:this})),o=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof Y&&l.name==="web-document-write:property-required").length;var a;return gS(n==null?void 0:n.url)?(r==null||(a=r.messages)==null||a.push(new Y("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&o?null:n}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([d(Qfe)],t.prototype,"listMode",void 0),u([Xe("listMode")],t.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([Xe("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([d(x$)],t.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([Xe("title")],t.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([P("esri.layers.mixins.OperationalLayer")],t),t};var T9;const GU=new yi({asc:"ascending",desc:"descending"});let Rx=T9=class extends _e{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new T9({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],Rx.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],Rx.prototype,"valueExpression",void 0),u([d({type:GU.apiValues,json:{read:GU.read,write:GU.write}})],Rx.prototype,"order",void 0),Rx=T9=u([P("esri.layers.support.OrderByInfo")],Rx);const Kfe=Rx;function cUe(e,t,i){if(!e)return null;const r=e.find(n=>!!n.field);if(!r)return null;const s=new Kfe;return s.read(r,i),[s]}function uUe(e,t,i,r){const s=e.find(n=>!!n.field);s&&Gl(i,[s.toJSON()],t)}const hUe=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[Kfe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:cUe},write:{target:"layerDefinition.orderBy",writer:uUe}}})],t.prototype,"orderBy",void 0),t=u([P("esri.layers.mixins.OrderedLayer")],t),t},dUe=pe.getLogger("esri.portal.PortalItemResource");let Ty=class extends be{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?ge(L({},e),{path:this._normalizePath(e.path,e.portalItem)}):e}set path(e){_(e)&&kc(e)?dUe.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(C(i))throw new Y("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:Bs(t,"signal")})}async update(e,t){return(await import("./resourceUtils.958eab85.js")).addOrUpdateResource(this,"update",e,t)}hasPath(){return _(this.path)}_normalizePath(e,t){return C(e)?e:(e=e.replace(/^\/+/,""),_(t)&&kc(e)&&(e=uF(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],Ty.prototype,"portalItem",void 0),u([d({type:String,value:null})],Ty.prototype,"path",null),u([Bt("path")],Ty.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],Ty.prototype,"url",null),u([d({type:String,readOnly:!0})],Ty.prototype,"itemRelativeUrl",null),Ty=u([P("esri.portal.PortalItemResource")],Ty);const pUe=Ty;let YA=class extends be{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],YA.prototype,"created",void 0),u([d()],YA.prototype,"rating",void 0),YA=u([P("esri.portal.PortalRating")],YA);const jU=YA;var Ox;let oi=Ox=class extends LO(rf){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return rS(Ox,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Video Service"?i="Video Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?i="Locator":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(i="Instant App"),i}readExtent(e){return e&&e.length?new ni(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":"maps",s?Ei(i+s+r+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=Hl.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:_(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof jU&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new jU({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:re(this.applicationProxies),avgRating:this.avgRating,categories:re(this.categories),created:re(this.created),culture:this.culture,description:this.description,extent:re(this.extent),groupCategories:re(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:re(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:re(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:re(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:re(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new Ox({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",ge(L({responseType:e},t),{query:{token:this.apiKey}}))}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",L({query:{token:this.apiKey}},e)).then(t=>t.rating!=null?(t.created=new Date(t.created),new jU(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",L({query:ge(L({},e),{token:this.apiKey})},t),Ox)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new Y("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")gf(t)?r.query={data:t}:r.query={url:Qu(t)},_(i)&&(r.query.filename=i);else{const s=new FormData;_(i)?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new Y("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await import("./resourceUtils.958eab85.js")).fetchResources(this,e,t)}async addResource(e,t,i){const r=await import("./resourceUtils.958eab85.js");return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await import("./resourceUtils.958eab85.js");if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new Y("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await import("./resourceUtils.958eab85.js")).removeAllResources(this,e)}resourceFromPath(e){return new pUe({portalItem:this,path:e})}toJSON(){const e=this.extent,t={created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:this.tags,thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:this.typeKeywords,url:this.url};return noe(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Ox({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([d({type:["private","shared","org","public"]})],oi.prototype,"access",void 0),u([d()],oi.prototype,"accessInformation",void 0),u([d({type:String})],oi.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],oi.prototype,"applicationProxies",void 0),u([d()],oi.prototype,"avgRating",void 0),u([d()],oi.prototype,"categories",void 0),u([d({type:Date})],oi.prototype,"created",void 0),u([d()],oi.prototype,"culture",void 0),u([d()],oi.prototype,"description",void 0),u([d({readOnly:!0})],oi.prototype,"displayName",null),u([d({type:ni})],oi.prototype,"extent",void 0),u([Ne("extent")],oi.prototype,"readExtent",null),u([d()],oi.prototype,"groupCategories",void 0),u([d({readOnly:!0})],oi.prototype,"iconUrl",null),u([d()],oi.prototype,"id",void 0),u([d({readOnly:!0})],oi.prototype,"isLayer",null),u([d()],oi.prototype,"itemControl",void 0),u([d({readOnly:!0})],oi.prototype,"itemUrl",null),u([d()],oi.prototype,"licenseInfo",void 0),u([d({type:Date})],oi.prototype,"modified",void 0),u([d()],oi.prototype,"name",void 0),u([d()],oi.prototype,"numComments",void 0),u([d()],oi.prototype,"numRatings",void 0),u([d()],oi.prototype,"numViews",void 0),u([d()],oi.prototype,"owner",void 0),u([d()],oi.prototype,"ownerFolder",void 0),u([d({type:Hl})],oi.prototype,"portal",void 0),u([d()],oi.prototype,"screenshots",void 0),u([d()],oi.prototype,"size",void 0),u([d()],oi.prototype,"snippet",void 0),u([d()],oi.prototype,"sourceJSON",void 0),u([d({type:String})],oi.prototype,"spatialReference",void 0),u([d()],oi.prototype,"tags",void 0),u([d()],oi.prototype,"thumbnail",void 0),u([d({readOnly:!0})],oi.prototype,"thumbnailUrl",null),u([d()],oi.prototype,"title",void 0),u([d()],oi.prototype,"type",void 0),u([d()],oi.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(e,t){var i;if(t.type!=="KML")return e;const r=(i=this.portal)==null?void 0:i.restUrl;return e||(e=r&&this.id?`${r}/content/items/${this.id}/data`:null),e}}})],oi.prototype,"url",void 0),u([d({readOnly:!0})],oi.prototype,"userItemUrl",null),oi=Ox=u([P("esri.portal.PortalItem")],oi);const AL=oi;var eme=Object.freeze(Object.defineProperty({__proto__:null,default:AL},Symbol.toStringTag,{value:"Module"}));const fUe=pe.getLogger("esri.layers.mixins.PortalLayer"),tme=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var i;(i=this.portalItem)==null||i.destroy(),this.portalItem=null}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new AL({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await import("./layersLoader.0a341885.js").then(function(n){return n.l});return qt(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData},r)}catch(s){throw Tr(s)||fUe.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(hf(r),!0)))}async _fetchUserHasEditingPrivileges(i){const r=this.url?Vs==null?void 0:Vs.findCredential(this.url):null;if(!r)return!0;const s=_P.credential===r?_P.user:await this._fetchEditingUser(i);return _P.credential=r,_P.user=s,C(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var r,s;const n=(r=this.portalItem)==null||(s=r.portal)==null?void 0:s.user;if(n)return n;const o=Vs.findServerInfo(this.url);if(o==null||!o.owningSystemUrl)return null;const a=`${o.owningSystemUrl}/sharing/rest`,l=Hl.getDefault();if(l&&l.loaded&&yd(l.restUrl)===yd(a))return l.user;const c=`${a}/community/self`,h=_(i)?i.signal:null,p=await Ad(Pi(c,{authMode:"no-prompt",query:{f:"json"},signal:h}));return p.ok?Tj.fromJSON(p.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Hl.getDefault());return s&&n&&!Hle(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new Y("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,ge(L({},r),{layer:this}))}};return u([d({type:AL})],t.prototype,"portalItem",null),u([Ne("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([Xe("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([d({clonable:!1})],t.prototype,"resourceReferences",void 0),u([d({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=u([P("esri.layers.mixins.PortalLayer")],t),t},_P={credential:null,user:null},DR=new St,VC=new WeakMap;function mUe(e){ime(e)&&DR.push(e)}function gUe(e){ime(e)&&DR.includes(e)&&DR.remove(e)}function ime(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function rme(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:rme(t,e%t):0}let HU=0,bP=0;function yUe(){const e=Date.now();for(const i of DR)if(i.refreshInterval){var t;e-((t=VC.get(i))!=null?t:0)+5>=6e4*i.refreshInterval&&(VC.set(i,e),i.refresh(e))}}Doe(()=>{const e=Date.now();let t=0;for(const i of DR)t=rme(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?VC.get(i)||VC.set(i,e):VC.delete(i);if(t!==bP){if(bP=t,clearInterval(HU),bP===0)return void(HU=0);HU=setInterval(yUe,bP)}});function vUe(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const _Ue=e=>{let t=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=Coe(()=>this.hasDataChanged()),this.when().then(()=>{mUe(this)},()=>{})}destroy(){gUe(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){R6(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{pe.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([d()],t.prototype,"refreshParameters",null),t=u([P("esri.layers.mixins.RefreshableLayer")],t),t},sme=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&bUe(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([P("esri.layers.mixins.ScaleRangeLayer")],t),t};function bUe(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const b1=Uo()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var S9;let ZA=S9=class extends _e{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return eDe(this.value,this.unit,"milliseconds")}clone(){return new S9({value:this.value,unit:this.unit})}};u([d({type:Number,json:{write:!0},nonNullable:!0})],ZA.prototype,"value",void 0),u([d({type:b1.apiValues,json:{type:b1.jsonValues,read:b1.read,write:b1.write},nonNullable:!0})],ZA.prototype,"unit",void 0),ZA=S9=u([P("esri.TimeInterval")],ZA);const LR=ZA;var E9;let Mx=E9=class extends _e{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new E9({respectsDaylightSaving:e,timezone:t})}};u([d({type:Boolean,json:{write:!0}})],Mx.prototype,"respectsDaylightSaving",void 0),u([Ne("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],Mx.prototype,"readRespectsDaylightSaving",null),u([d({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],Mx.prototype,"timezone",void 0),Mx=E9=u([P("esri.layers.support.TimeReference")],Mx);const wUe=Mx;var A9;let Xo=A9=class extends _e{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new _f({start:i,end:r})}writeFullTimeExtent(e,t){e&&_(e.start)&&_(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new LR({value:t.timeInterval,unit:b1.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new LR({value:t.defaultTimeInterval,unit:b1.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new A9({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:re(n),fullTimeExtent:re(o),trackIdField:a,useTime:l})}};u([d({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],Xo.prototype,"cumulative",void 0),u([d({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],Xo.prototype,"endField",void 0),u([d({type:_f,json:{write:{enabled:!0,allowNull:!0}}})],Xo.prototype,"fullTimeExtent",void 0),u([Ne("fullTimeExtent",["timeExtent"])],Xo.prototype,"readFullTimeExtent",null),u([Xe("fullTimeExtent")],Xo.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Xo.prototype,"hasLiveData",void 0),u([d({type:LR,json:{write:{enabled:!0,allowNull:!0}}})],Xo.prototype,"interval",void 0),u([Ne("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Xo.prototype,"readInterval",null),u([Xe("interval")],Xo.prototype,"writeInterval",null),u([d({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],Xo.prototype,"startField",void 0),u([d({type:wUe,json:{write:{enabled:!0,allowNull:!0}}})],Xo.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Xo.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],Xo.prototype,"useTime",void 0),Xo=A9=u([P("esri.layers.support.TimeInfo")],Xo);const nme=Xo,xUe=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=b1.fromJSON(s.timeOffsetUnits);return n&&o?new LR({value:n,unit:o}):null}set timeInfo(i){Yae(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([d({type:_f,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([d({type:LR})],t.prototype,"timeOffset",void 0),u([Ne("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([d({value:null,type:nme,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([P("esri.layers.mixins.TemporalLayer")],t),t};var C9;let xm=C9=class extends _e{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new C9({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};u([d({constructOnly:!0})],xm.prototype,"name",void 0),u([d({constructOnly:!0})],xm.prototype,"fields",void 0),u([d({constructOnly:!0})],xm.prototype,"isAscending",void 0),u([d({constructOnly:!0})],xm.prototype,"isUnique",void 0),u([d({constructOnly:!0})],xm.prototype,"description",void 0),xm=C9=u([P("esri.layers.support.FeatureIndex")],xm);let B1=class extends _e{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster"],readOnly:!0,json:{read:!1,write:!0}})],B1.prototype,"type",void 0),B1=u([P("esri.layers.support.FeatureReduction")],B1);var R9;let Px=R9=class extends _e{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new R9({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};u([d({type:String,json:{write:!0}})],Px.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],Px.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],Px.prototype,"onStatisticValueExpression",void 0),Px=R9=u([P("esri.layers.support.OutStatistic")],Px);const TUe=Px;var O9;let QA=O9=class extends _e{constructor(){super(...arguments),this.name=null}clone(){return new O9({name:this.name,outStatistic:this.outStatistic.clone()})}};u([d({type:String,json:{write:!0}})],QA.prototype,"name",void 0),u([d({type:TUe,json:{write:!0}})],QA.prototype,"outStatistic",void 0),QA=O9=u([P("esri.layers.support.AggregateField")],QA);const SUe=QA,iq="__begin__",rq="__end__",EUe=new RegExp(iq,"ig"),AUe=new RegExp(rq,"ig"),qJ=new RegExp("^"+iq,"i"),WJ=new RegExp(rq+"$","i"),CL='"',CUe=CL+" + ",RUe=" + "+CL;function OUe(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function MUe(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function ZF(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=OUe(e.labelExpression),t.type="conventional"),t}function PUe(e){const t=ZF(e);if(!t)return null;switch(t.type){case"conventional":return M9(t.expression);case"arcade":return t.expression}return null}function IUe(e){const t=ZF(e);if(!t)return null;switch(t.type){case"conventional":return DUe(t.expression);case"arcade":return sq(t.expression)}return null}function M9(e){let t;return e?(t=Zp(e,i=>iq+'$feature["'+i+'"]'+rq),t=qJ.test(t)?t.replace(qJ,""):CL+t,t=WJ.test(t)?t.replace(WJ,""):t+CL,t=t.replace(EUe,CUe).replace(AUe,RUe)):t='""',t}const $Ue=/^\s*\{([^}]+)\}\s*$/i;function DUe(e){const t=e.match($Ue);return t&&t[1].trim()||null}const LUe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,NUe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,FUe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function sq(e){if(!e)return null;let t=LUe.exec(e)||NUe.exec(e);return t?t[1]||t[3]:(t=FUe.exec(e),t?t[2]:null)}var P9;let Sy=P9=class extends _e{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?M9(t.value):e}writeExpression(e,t,i){this.value!=null&&(e=M9(this.value)),e!=null&&(t[i]=e)}clone(){return new P9({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],Sy.prototype,"expression",void 0),u([Ne("expression",["expression","value"])],Sy.prototype,"readExpression",null),u([Xe("expression")],Sy.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Sy.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],Sy.prototype,"value",void 0),Sy=P9=u([P("esri.layers.support.LabelExpressionInfo")],Sy);const ome=Sy,ame=[252,146,31,255],ymt=[153,153,153,255],UUe={type:"esriSMS",style:"esriSMSCircle",size:6,color:ame,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},zUe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:ame},kUe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},BUe={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},VUe={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},GUe={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},jUe={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},vmt=jb.fromJSON(UUe),_mt=Nd.fromJSON(zUe),bmt=Gb.fromJSON(kUe),HUe=w2.fromJSON(BUe);jb.fromJSON(VUe);Nd.fromJSON(GUe);Gb.fromJSON(jUe);var I9;const wP=new yi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function lme(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function qUe(e){return(e==null?void 0:e.type)==="map-image"}function cme(e){var t,i;return!!qUe(e)&&!((t=e.capabilities)==null||(i=t.exportMap)==null||!i.supportsArcadeExpressionForLabeling)}function WUe(e){return lme(e)||cme(e.layer)}let $s=I9=class extends _e{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=HUe,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return i(t[r[0]],r[1],r[2]);if(r.length===7){const s=i(t[r[0]],r[1],r[2]),n=r[3],o=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=MUe(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=sq(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(e==null&&this.labelExpression!=null&&lme(r))e=new ome({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return ZF(this)}getLabelExpressionArcade(){return PUe(this)}getLabelExpressionSingleField(){return IUe(this)}hash(){return JSON.stringify(this)}clone(){return new I9({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:re(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:re(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],$s.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],$s.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],$s.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&cme(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],$s.prototype,"labelExpression",void 0),u([Ne("labelExpression")],$s.prototype,"readLabelExpression",null),u([Xe("labelExpression")],$s.prototype,"writeLabelExpression",null),u([d({type:ome,json:{write:{overridePolicy:(e,t,i)=>WUe(i)?{allowNull:!0}:{enabled:!1}}}})],$s.prototype,"labelExpressionInfo",void 0),u([Xe("labelExpressionInfo")],$s.prototype,"writeLabelExpressionInfo",null),u([d({type:wP.apiValues,json:{type:wP.jsonValues,read:wP.read,write:wP.write}})],$s.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],$s.prototype,"labelPosition",void 0),u([d({type:Number})],$s.prototype,"maxScale",void 0),u([Xe("maxScale")],$s.prototype,"writeMaxScale",null),u([d({type:Number})],$s.prototype,"minScale",void 0),u([Xe("minScale")],$s.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],$s.prototype,"repeatLabel",void 0),u([d({type:Number,cast:sr,json:{write:!0,origins:{"web-scene":{write:!1}}}})],$s.prototype,"repeatLabelDistance",void 0),u([d({types:lCe,json:{origins:{"web-scene":{types:cCe,write:_J,default:null}},write:_J,default:null}})],$s.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],$s.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],$s.prototype,"where",void 0),$s=I9=u([P("esri.layers.support.LabelClass")],$s);const NR=$s;var $9;let uc=$9=class extends _e{constructor(e){super(e),this.type="cluster",this.clusterRadius=sr("80px"),this.clusterMinSize=sr("12px"),this.clusterMaxSize=sr("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new $9({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:re(this.labelingInfo),labelsVisible:this.labelsVisible,fields:re(this.fields),popupEnabled:this.popupEnabled,popupTemplate:re(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],uc.prototype,"type",void 0),u([d({type:Number,cast:e=>e==="auto"?e:sr(e),json:{write:!0}})],uc.prototype,"clusterRadius",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],uc.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:sr,json:{write:!0}})],uc.prototype,"clusterMaxSize",void 0),u([d(Xfe)],uc.prototype,"popupEnabled",void 0),u([d({type:tF,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],uc.prototype,"popupTemplate",void 0),u([d({types:oCe})],uc.prototype,"symbol",void 0),u([d({type:[NR],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],uc.prototype,"labelingInfo",void 0),u([d(Yfe)],uc.prototype,"labelsVisible",void 0),u([d({type:[SUe],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],uc.prototype,"fields",void 0),uc=$9=u([P("esri.layers.support.FeatureReductionCluster")],uc);const ume=uc;var D9;let T$=D9=class extends B1{constructor(e){super(e),this.type="selection"}clone(){return new D9}};u([d({type:["selection"]})],T$.prototype,"type",void 0),T$=D9=u([P("esri.layers.support.FeatureReductionSelection")],T$);const XJ=T$,YJ={key:"type",base:B1,typeMap:{selection:ume}},XUe={types:{key:"type",base:B1,typeMap:{selection:XJ,cluster:ume}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:YJ},"portal-item":{types:YJ},"web-scene":{types:{key:"type",base:B1,typeMap:{selection:XJ}}}}}},ZJ=new yi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let Ey=class extends df(_e){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],Ey.prototype,"name",void 0),u([d({json:{write:!0}})],Ey.prototype,"description",void 0),u([d({json:{read:ZJ.read,write:ZJ.write}})],Ey.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],Ey.prototype,"prototype",void 0),u([d({json:{write:!0}})],Ey.prototype,"thumbnail",void 0),Ey=u([P("esri.layers.support.FeatureTemplate")],Ey);const nq=Ey;let sm=class extends df(_e){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=bH(e[i]);return t}writeDomains(e,t){const i={};for(const s of Object.keys(e)){var r;e[s]&&(i[s]=(r=e[s])==null?void 0:r.toJSON())}t.domains=i}};u([d({json:{write:!0}})],sm.prototype,"id",void 0),u([d({json:{write:!0}})],sm.prototype,"name",void 0),u([d({json:{write:!0}})],sm.prototype,"domains",void 0),u([Ne("domains")],sm.prototype,"readDomains",null),u([Xe("domains")],sm.prototype,"writeDomains",null),u([d({type:[nq],json:{write:!0}})],sm.prototype,"templates",void 0),sm=u([P("esri.layers.support.FeatureType")],sm);const hme=sm;function YUe(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function QJ(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function JJ(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class ZUe{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const i=[];for(const r of t){const s=r&&r.name;if(s){const n=KJ(s);this._fieldsMap.set(s,r),this._fieldsMap.set(n,r),i.push(n),YUe(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):ZN(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),QJ(r)||JJ(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)QJ(t)||JJ(t)||t.nullable||E2e(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(KJ(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const i=this.get(t);if(i)return i.name}}function KJ(e){return e.toLowerCase().trim()}const QUe=pe.getLogger("esri.layers.support.fieldProperties");function JUe(){return{fields:{type:[jO],value:null},fieldsIndex:{readOnly:!0,get(){return new ZUe(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||QUe.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return Zae(this.fieldsIndex,e)}}}}let Ix=class extends df(_e){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],Ix.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],Ix.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:e=>fRe.read(e)||mRe.read(e)}})],Ix.prototype,"units",void 0),Ix=u([P("esri.layers.support.GeometryFieldsInfo")],Ix);const KUe=Ix,eze=/\[([^\[\]]+)\]/gi;function eK(e,t,i){return e?e.map(r=>{const s=new NR;if(s.read(r,i),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(eze,(o,a)=>`[${tze(a,n)}]`)}return s}):null}function tze(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const s=t[r].name;if(s.toLowerCase()===i)return s}return e}var L9;let $x=L9=class extends _e{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new St}clone(){return new L9({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],$x.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],$x.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],$x.prototype,"viewAllLevelIds",void 0),$x=L9=u([P("esri.layers.support.LayerFloorInfo")],$x);const ize=$x,tK=new yi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),iK=new yi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Tu=class extends df(_e){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:tK.read,write:tK.write}})],Tu.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],Tu.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],Tu.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],Tu.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],Tu.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],Tu.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],Tu.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],Tu.prototype,"relationshipTableId",void 0),u([d({json:{read:iK.read,write:iK.write}})],Tu.prototype,"role",void 0),Tu=u([P("esri.layers.support.Relationship")],Tu);const rze=Tu,Vh=[];function sze(e,t){if(Bfe(e.url))return!0;const{wkid:i}=t;for(const r of Vh){if(e.version>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}Vh.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102960;t++)e.add(t);return e}]),Vh.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),Vh.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),Vh.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),Vh.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),Vh.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),Vh.push([10.61,()=>new Set([102497])]),Vh.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),Vh.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),Vh.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function nze(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Ad(r.populateFromStyle());if(qt(i),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Hc("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t.origin)}}}const oze=["oid","global-id"],aze=["oid","global-id","guid"];function lze({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=fze({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!o.length)return null;const a=yze({titleBase:s,fields:i,displayField:e}),l=gze();return new tF({title:a,content:l,fieldInfos:o})}const cze=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],uze=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!dme(e.name,t)&&(!i||e.name!==i)&&!oze.includes(e.type)&&!cze.some(s=>s.test(e.name));function hze(e,t){const i=e;return t&&(e=e.filter(r=>!t.includes(r.type))),e===i&&(e=e.slice()),e.sort(dze),e}function dze(e,t){return e.type==="oid"?-1:t.type==="oid"?1:rK(e)?-1:rK(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function dme(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function pze(e,t){return e.editable&&!aze.includes(e.type)&&!dme(e.name,t)}function fze({editFieldsInfo:e,fields:t,objectIdField:i},r){return hze(t,(r==null?void 0:r.ignoreFieldTypes)||vze).map(s=>new FO({fieldName:s.name,isEditable:pze(s,e),label:s.alias,format:mze(s),visible:uze(s,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function mze(e){switch(e.type){case"small-integer":case"integer":case"single":return new AC({digitSeparator:!0,places:0});case"double":return new AC({digitSeparator:!0,places:2});case"date":return new AC({dateFormat:"long-month-day-year"});default:return null}}function gze(){return[new dS,new mR]}function yze(e){const t=b2e(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}function rK(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const vze=["geometry","blob","raster","guid","xml"],qU=new yi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),_ze={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Is="FeatureLayer",sK=pe.getLogger("esri.layers.FeatureLayer");function xP(e,t){return new Y("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function nK(e){return e&&e instanceof St}function jt(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function TP(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function bze(e){var t;const i=e==null||(t=e.supportedSpatialAggregationStatistics)==null?void 0:t.map(r=>r.toLowerCase());return{envelope:!(i==null||!i.includes("envelopeaggregate")),centroid:!(i==null||!i.includes("centroidaggregate")),convexHull:!(i==null||!i.includes("convexhullaggregate"))}}const WU=JUe();function XU(e,t,i){const r=!(i==null||!i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let De=class extends X5e(qfe(hUe(xUe(sme(_Ue(Vfe(Jfe(tme(XH(H5e(t5e(df(QO))))))))))))){constructor(...e){super(...e),this._handles=new Jt,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Ke.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(St.ofType(xm)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=ct(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?L({url:e},t):e}load(e){const t=_(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(r=>this._initLayerProperties(r)));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(hf).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(t);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new Y("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:i.lastEditDate!=null?new Date(i.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,i,r){r!=null&&r.writeLayerSchema&&Gl(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}get parsedUrl(){const e=this.url?ya(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=sb(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=sb(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){gY(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const s=L4e(r,t,i)||void 0;return s||sK.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),s}if(t.defaultSymbol)return t.types&&t.types.length?new GF({defaultSymbol:YU(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(s=>({id:s.id,symbol:YU(s.symbol,s,i)}))}):new VF({symbol:YU(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(nK(t)&&this._resetMemorySource(t),nK(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof St?new wm({layer:this,items:e}):e:null}readSource(e,t){const i=DF.fromJSON(t.featureSet);return new wm({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(n=>nq.fromJSON(n)),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?n5e(this.url,i):i;let n=i;if(!n&&this.url){const o=JO(this.url);_(o)&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),ZH(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(n=>(n=hme.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}set url(e){const t=a5e({layer:this,url:e,nonStandardUrlAllowed:!0,logger:sK});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){l5e(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new Y(Is,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,i){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new Y(Is,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)})}async applyEdits(e,t){const i=await import("./editingSupport.9baaf37a.js");return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return lze(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await qN(import("./FeatureLayerSource.0eff68e0.js"),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new Np,t=this.get("capabilities.data"),i=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:r,timeExtent:s}=this;return e.timeExtent=r!=null&&s!=null?s.offset(-r.value,r.unit):s||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new Y(Is,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new Y(Is,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=QV.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new Y(Is,"this layer doesn't support attachments");const{attachmentTypes:i,objectIds:r,globalIds:s,num:n,size:o,start:a,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const c=r&&r.length>1,h=i&&i.length,p=s&&s.length,f=o&&o.length;if(c||h||p||f||n||a||l)throw new Y(Is,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||l))throw new Y(Is,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new Y(Is,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(Np.from(e)||this.createQuery(),t)).then(i=>{if(i!=null&&i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(Np.from(e)||this.createQuery(),t);throw new Y(Is,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(Np.from(e)||this.createQuery(),t);throw new Y(Is,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(Np.from(e)||this.createQuery(),t);throw new Y(Is,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(b8.from(e),t);throw new Y(Is,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(b8.from(e),t);throw new Y(Is,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(sP.from(e),t).then(i=>{if(i!=null&&i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i});throw new Y(Is,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(sP.from(e),t);throw new Y(Is,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(sP.from(e),t);throw new Y(Is,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(sP.from(e),t);throw new Y(Is,"Layer source does not support queryFeatureCount capability")})}read(e,t){const i=e.featureCollection;if(i){const r=i.layers;r&&r.length===1&&(super.read(r[0],t),i.showLegend!=null&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var i,r;t=ge(L({},t),{writeLayerSchema:(i=(r=t)==null?void 0:r.writeLayerSchema)!=null?i:this._hasMemorySource()});const{origin:s,layerContainerType:n,messages:o}=t;if(this.dynamicDataSource)return o==null||o.push(xP(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(s==="web-scene"||s==="web-map"&&n!=="tables")return o==null||o.push(xP(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return o==null||o.push(xP(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&s==="web-map"&&n==="tables")return o==null||o.push(xP(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new Y(Is,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||sze(this,e))}async save(e){return(await import("./featureLayerUtils.c5bec2da.js")).save(this,e)}async saveAs(e,t){return(await import("./featureLayerUtils.c5bec2da.js")).saveAs(this,e,t)}_readEditingEnabled(e,t,i){var r;let s=(r=e.layerDefinition)==null?void 0:r.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,t&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,i,r){if(!e){var s,n;const o=(s=this.capabilities)!=null&&(n=s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";Gl("layerDefinition.capabilities",o,t),!i||r!=null&&r.writeLayerSchema||(t.capabilities=o)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new Y(Is,`feature is missing the identifying attribute ${i}`)):Promise.reject(new Y(Is,"'attributes' are required on a feature to query attachments")):Promise.reject(new Y(Is,"A feature is required to add/delete/update attachments")):Promise.reject(new Y(Is,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return Pi(this.url,{query:ge(L({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t=>{const i=t.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),gY(this.renderer,this.fieldsIndex),Yae(this.timeInfo,this.fieldsIndex),nze(this,{origin:"service"})}async hasDataChanged(){var e;if((e=this.source)!=null&&e.refresh)try{var t;const{dataChanged:i,updates:r}=await((t=this.source)==null?void 0:t.refresh());if(_(r)&&(this.sourceJSON=L(L({},this.sourceJSON),r),this.read(r,{origin:"service",url:this.parsedUrl})),i)return!0}catch{}if(this.definitionExpression)try{return(await F4e(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){var e;const t=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+t+")"),this.isTable||this._hasMemorySource()||t.search(/\/FeatureServer\//i)!==-1||(e=this.fields)!=null&&e.some(i=>i.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+t+")")}_fixTemplates(e,t){e&&e.forEach(i=>{const r=i.prototype&&i.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new Y("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new Y("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAttachmentCapabilities(e){const t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach(i=>{const r=_ze[i.name];r&&(t[r]=!!i.isEnabled)}),t}_readDataCapabilities(e){return{isVersioned:jt(e,"isDataVersioned",!1),supportsAttachment:jt(e,"hasAttachments",!1),supportsM:jt(e,"hasM",!1),supportsZ:jt(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:jt(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map(l=>l.trim()):[],r=i.includes("editing")&&!t.datesInUnknownTimezone;let s=r&&i.includes("create"),n=r&&i.includes("delete"),o=r&&i.includes("update");const a=i.includes("changetracking");return r&&!(s||n||o)&&(s=n=o=!0),{supportsCalculate:jt(t,"supportsCalculate",!1),supportsTruncate:jt(t,"supportsTruncate",!1),supportsValidateSql:jt(t,"supportsValidateSql",!1),supportsAdd:s,supportsDelete:n,supportsEditing:r,supportsChangeTracking:a,supportsQuery:i.includes("query"),supportsQueryAttachments:jt(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:jt(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:o,supportsExceedsLimitStatistics:jt(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var t;const i=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,s=e.archivingInfo,n=(t=this.url)==null?void 0:t.includes("MapServer"),o=!ue("mapserver-pbf-enabled")&&n&&this.version<10.81,a=Bfe(this.url),l=(e.supportedQueryFormats||"").split(",").reduce((c,h)=>{const p=h.toLowerCase().trim();return p&&c.add(p),c},new Set);return{supportsStatistics:jt(i,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:jt(i,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:jt(i,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:bze(i),supportsCentroid:jt(i,"supportsReturningGeometryCentroid",!1),supportsDistance:jt(i,"supportsQueryWithDistance",!1),supportsDistinct:jt(i,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:jt(i,"supportsReturningQueryExtent",!1),supportsGeometryProperties:jt(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:jt(i,"supportsHavingClause",!1),supportsOrderBy:jt(i,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:jt(i,"supportsPagination",!1),supportsQuantization:jt(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:jt(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:jt(e,"supportsReturningQueryGeometry",!1),supportsResultType:jt(i,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:jt(i,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:jt(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:jt(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:jt(i,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:jt(r,"allowOthersToQuery",!0),supportsHistoricMoment:jt(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!o&&l.has("pbf"),supportsDisjointSpatialRelationship:jt(i,"supportsDisjointSpatialRel",!1),supportsCacheHint:jt(i,"supportsQueryWithCacheHint",!1),supportsDefaultSpatialReference:jt(i,"supportsDefaultSR",!1),supportsCompactGeometry:a,maxRecordCountFactor:TP(e,"maxRecordCountFactor",void 0),maxRecordCount:TP(e,"maxRecordCount",void 0),standardMaxRecordCount:TP(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:TP(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=jt(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:jt(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:jt(e,"allowGeometryUpdates",!0),supportsGlobalId:jt(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:jt(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:jt(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:jt(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:jt(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:jt(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:jt(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:jt(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:jt(t,"allowOthersToUpdate",!0)}}};u([d({readOnly:!0,json:{read:!1}})],De.prototype,"capabilities",void 0),u([Ne("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],De.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],De.prototype,"charts",void 0),u([d({readOnly:!0})],De.prototype,"createQueryVersion",null),u([d({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],De.prototype,"copyright",void 0),u([d({type:Boolean})],De.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],De.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],De.prototype,"definitionExpression",void 0),u([d({types:$1,readOnly:!0})],De.prototype,"defaultSymbol",void 0),u([d({type:ed})],De.prototype,"dynamicDataSource",void 0),u([d({readOnly:!0})],De.prototype,"editFieldsInfo",void 0),u([d({type:Boolean})],De.prototype,"editingEnabled",null),u([Ne(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],De.prototype,"readEditingEnabled",null),u([Ne("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],De.prototype,"readEditingEnabledFromWebMap",null),u([Xe(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],De.prototype,"writeEditingEnabled",null),u([Xe("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],De.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],De.prototype,"editingInfo",void 0),u([Ne("editingInfo")],De.prototype,"readEditingInfo",null),u([d((()=>{const e=re(sUe),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],De.prototype,"elevationInfo",void 0),u([d(XUe)],De.prototype,"featureReduction",void 0),u([d(ge(L({},WU.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:XU}}}}}))],De.prototype,"fields",void 0),u([d(WU.fieldsIndex)],De.prototype,"fieldsIndex",void 0),u([d({type:ize,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],De.prototype,"floorInfo",void 0),u([d({type:Y4e,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],De.prototype,"formTemplate",void 0),u([d({type:ni,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],De.prototype,"fullExtent",void 0),u([d()],De.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:KUe,json:{read:{source:"geometryProperties"}}})],De.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:qU.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:XU,writer(e,t,i){const r=e?qU.toJSON(e):null;r&&Gl(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:qU.read}}})],De.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],De.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],De.prototype,"hasZ",void 0),u([d({readOnly:!0,type:qb})],De.prototype,"heightModelInfo",void 0),u([d({type:Date})],De.prototype,"historicMoment",void 0),u([d(oUe)],De.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],De.prototype,"infoFor3D",void 0),u([d({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],De.prototype,"isTable",void 0),u([Ne("service","isTable",["type","geometryType"]),Ne("isTable",["layerDefinition.type","layerDefinition.geometryType"])],De.prototype,"readIsTable",null),u([Xe("web-map","isTable")],De.prototype,"writeIsTable",null),u([d(Yfe)],De.prototype,"labelsVisible",void 0),u([d({type:[NR],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:eK},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:eK},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],De.prototype,"labelingInfo",void 0),u([d((()=>{const e=re(nUe);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,i,r){Gl(r,iF(t),i)}}},e})())],De.prototype,"opacity",void 0),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],De.prototype,"layerId",void 0),u([d(rUe)],De.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const e=re(Qfe.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],De.prototype,"listMode",void 0),u([d(aUe)],De.prototype,"minScale",void 0),u([Ne("service","minScale",["minScale","effectiveMinScale"])],De.prototype,"readMinScale",null),u([d(lUe)],De.prototype,"maxScale",void 0),u([Ne("service","maxScale",["maxScale","effectiveMaxScale"])],De.prototype,"readMaxScale",null),u([d({type:String})],De.prototype,"globalIdField",void 0),u([Ne("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Ne("service","globalIdField",["globalIdField","fields"])],De.prototype,"readGlobalIdFieldFromService",null),u([d({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:XU}}}}})],De.prototype,"objectIdField",void 0),u([Ne("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Ne("service","objectIdField",["objectIdField","fields"])],De.prototype,"readObjectIdFieldFromService",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],De.prototype,"operationalLayerType",void 0),u([d(WU.outFields)],De.prototype,"outFields",void 0),u([d({readOnly:!0})],De.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],De.prototype,"path",void 0),u([d(Xfe)],De.prototype,"popupEnabled",void 0),u([d({type:tF,json:{name:"popupInfo",write:!0}})],De.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],De.prototype,"defaultPopupTemplate",null),u([d({type:[rze],readOnly:!0})],De.prototype,"relationships",void 0),u([d({types:Ife,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:$4e,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],De.prototype,"renderer",null),u([Ne("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Ne("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],De.prototype,"readRenderer",null),u([d()],De.prototype,"sourceJSON",void 0),u([d({type:Boolean})],De.prototype,"returnM",void 0),u([d({type:Boolean})],De.prototype,"returnZ",void 0),u([d((()=>{const e=re(iUe);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],De.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],De.prototype,"source",null),u([Bt("source")],De.prototype,"castSource",null),u([Ne("portal-item","source",["featureSet"]),Ne("web-map","source",["featureSet"])],De.prototype,"readSource",null),u([d({readOnly:!0})],De.prototype,"serviceDefinitionExpression",void 0),u([Ne("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],De.prototype,"readServiceDefinitionExpression",null),u([d({type:Ke,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],De.prototype,"spatialReference",void 0),u([d({type:Number})],De.prototype,"subtypeCode",void 0),u([d({type:[nq]})],De.prototype,"templates",void 0),u([Ne("templates",["editFieldsInfo","creatorField","editorField","templates"])],De.prototype,"readTemplates",null),u([d({type:nme})],De.prototype,"timeInfo",void 0),u([d()],De.prototype,"title",void 0),u([Ne("service","title",["name"]),Ne("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],De.prototype,"readTitle",null),u([Ne("web-map","title",["layerDefinition.name","title"])],De.prototype,"readTitleFromWebMap",null),u([d({type:String})],De.prototype,"sublayerTitleMode",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],De.prototype,"trackIdField",void 0),u([d({json:{read:!1}})],De.prototype,"type",void 0),u([d({type:String})],De.prototype,"typeIdField",void 0),u([Ne("service","typeIdField"),Ne("typeIdField",["layerDefinition.typeIdField"])],De.prototype,"readTypeIdField",null),u([d({type:[hme]})],De.prototype,"types",void 0),u([Ne("service","types",["types"]),Ne("types",["layerDefinition.types"])],De.prototype,"readTypes",null),u([d({readOnly:!0,json:{write:!1}})],De.prototype,"serverGens",void 0),u([d({type:St.ofType(xm),readOnly:!0})],De.prototype,"indexes",void 0),u([d(Zfe)],De.prototype,"url",null),u([Xe("url")],De.prototype,"writeUrl",null),u([d({readOnly:!0})],De.prototype,"userIsAdmin",void 0),u([d({json:{origins:{service:{read:!0}},read:!1}})],De.prototype,"version",void 0),u([Ne("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],De.prototype,"readVersion",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],De.prototype,"visible",void 0),u([Ne("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],De.prototype,"readVisible",null),De=u([P("esri.layers.FeatureLayer")],De);const YU=c2({types:Ece}),RL=De;var wmt=Object.freeze(Object.defineProperty({__proto__:null,default:RL},Symbol.toStringTag,{value:"Module"}));const wze=["$datastore","$map","$layer","$aggregatedfeatures"],xze="esri.widgets.Feature.support.arcadeFeatureUtils",Tze=pe.getLogger(xze);function Sze(e){return typeof e=="string"?GO(mH(e)):Array.isArray(e)?Eze(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?Aze(e):e}function Eze(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?GO(mH(t)):t}</li>`).join("")}</ul>`}function Aze(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?GO(mH(i)):i}</td></tr>`}).join("")}</table>`}function Cze({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h={map:n,spatialReference:s.sr,interceptor:a};if(c==="$map"&&(r.vars[c]=t.convertMapToFeatureSetCollection(h)),c==="$layer"&&(r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),c==="$datastore"&&(r.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:f,objectIdField:g,geometryType:y,spatialReference:v,displayField:b}=p,w=new RL(ge(L({fields:f,objectIdField:g,geometryType:y,spatialReference:v,displayField:b},p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null),{source:e}));r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:w,spatialReference:s.sr,interceptor:a})}})}function pme(){return import("./arcadeUtils.65026d41.js").then(function(e){return e.q})}async function Rze({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function fme({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=wze.filter(g=>t.hasVariable(a,g)),[c]=await Promise.all([Rze({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:r}),p=t.createExecContext(n,h);p.interceptor=i,p.useAsync=!0,Cze({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:i});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(g=>Tze.error("arcade-execution-error",{error:g,graphic:n,expressionInfo:e}))}async function Oze({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const o=await pme(),a={};for(const h of e)a[`expression/${h.name}`]=fme({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const l=await Ka(a),c={};for(const h in l)c[h]=Sze(l[h].value);return c}const Mze=1;let hc=class extends Fd(be){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var t,i;const r=(t=this.contentElement)==null?void 0:t.type;(i=this.contentElementViewModel)==null||i.destroy();const s=r==="fields"?new PF:r==="media"?new _1:r==="text"?new mL:null;this._set("contentElementViewModel",s)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=oH(this._compile,Mze,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&i&&s&&n))return void this._set("contentElement",null);const l=await pme();if(a!==this._abortController)return;const c=await fme({arcadeUtils:l,expressionInfo:t,graphic:i,interceptor:r,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await kH(c,a.signal),p=h==null?void 0:h.type,f=p==="media"?vR.fromJSON(h):p==="text"?pS.fromJSON(h):p==="fields"?dS.fromJSON(h):null;this._set("contentElement",f)},this.handles.add([uo(this,["expressionInfo","graphic","map","spatialReference","view"],this._compileThrottled),uo(this,"contentElement",this._createVM)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};u([d()],hc.prototype,"_abortController",void 0),u([d({type:ile})],hc.prototype,"expressionInfo",void 0),u([d({type:ho})],hc.prototype,"graphic",void 0),u([d({readOnly:!0})],hc.prototype,"contentElement",void 0),u([d({readOnly:!0})],hc.prototype,"contentElementViewModel",void 0),u([d()],hc.prototype,"interceptor",void 0),u([d()],hc.prototype,"spatialReference",null),u([d({readOnly:!0})],hc.prototype,"state",null),u([d()],hc.prototype,"map",null),u([d()],hc.prototype,"view",void 0),hc=u([P("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],hc);const oq=hc,SP={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let S$=class extends va{constructor(e,t){super(e,t),this.viewModel=new oq}initialize(){uo(this,"viewModel.contentElementViewModel",()=>this._setupExpressionWidget())}destroy(){this._destroyContentWidget()}renderLoading(){return ae("div",{key:"loading-container",class:SP.loadingSpinnerContainer},ae("span",{class:this.classes(SP.iconLoading,SP.spinner)}))}render(){var e;const{state:t}=this.viewModel;return ae("div",{class:SP.base},t==="loading"?this.renderLoading():t==="disabled"?null:(e=this._contentWidget)==null?void 0:e.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const r=e?i==="fields"?new Pde({viewModel:e}):i==="media"?new npe({viewModel:e}):i==="text"?new i$({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};u([d({type:oq})],S$.prototype,"viewModel",void 0),S$=u([P("esri.widgets.Feature.FeatureExpression")],S$);const Pze=S$;class Ize{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}}var E$;const $ze=1,oK="content-view-models",mme="esri.widgets.FeatureViewModel",Dze=pe.getLogger(mme),aK={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let ss=E$=class extends be{constructor(e){super(e),this._handles=new Jt,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=oH(this._graphicChanged,$ze,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=L({},aK),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&i.attachmentsContent||t.type==="custom"&&i.customContent||t.type==="fields"&&i.fieldsContent||t.type==="media"&&i.mediaContent||t.type==="text"&&i.textContent||t.type==="expression"&&i.expressionContent},this._handles.add(uo(this,["graphic","_effectivePopupTemplate","abilities"],()=>this.graphicChangedThrottled()))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return _(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return UIe(iQ(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return vde(this.graphic)}castAbilities(e){return L(L({},aK),e)}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof _1&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof _1&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof _1&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){Tr(i)||(this._error=i,Dze.error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)):typeof e=="string"?this._compileText(new pS({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(oK),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:i}=this,{contentElement:r,contentElementViewModel:s}=e,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new oq({expressionInfo:i,graphic:r,interceptor:E$.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(uo(a,"contentElementViewModel",()=>this._setExpressionContentVM(a,t)),oK),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new yH(L({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new mL({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:y1({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e}),description:y1({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:t})}}_createFieldsVMParams(e,t){const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s=L(L({},r.global),r.content[t]),n=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos),o=n==null?void 0:n.filter(({fieldName:h})=>bde(h)||Lm(h)||s.hasOwnProperty(h)),a=i==null?void 0:i.expressionInfos,{description:l,title:c}=e;return L({attributes:s,expressionInfos:a,fieldInfos:o},this._compileTitleAndDesc({title:c,description:l}))}_compileFields(e,t){const i=e.clone(),r=new PF(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:h}=r,{description:p,mediaInfos:f,title:g}=e;return L({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,layer:l,fieldInfoMap:s,formattedAttributes:L(L({},n.global),n.content[t]),expressionAttributes:c,mediaInfos:f,popupTemplate:o,relatedInfos:a},this._compileTitleAndDesc({title:g,description:p}))}_compileMedia(e,t){const i=e.clone(),r=new _1(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=y1({attributes:n,fieldInfoMap:i,globalAttributes:o,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new mL(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t==null?void 0:t.editFieldsInfo;return r&&s?FIe(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r,o=this.formattedAttributes.global;return y1({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.title;return pL(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.content;return pL(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:c}}=await Ka({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await BIe({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:h}}=await Ka({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:Oze({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:r,map:o,interceptor:E$.interceptor,view:a})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes=L(L({},r.attributes),h),this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=hU({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:L(L({},l),e.attributes),layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[t]=hU({fieldInfos:e.fieldInfos,graphic:r,attributes:L(L({},a),e.attributes),layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:hU({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,iQ(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=_(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const o=t.filter(c=>c&&Lm(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await LDe({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var h;const p=r.get(c.toString()),f=(h=a[c])==null?void 0:h.value;p&&f&&(p.layerInfo=f.data)});const l=await NDe({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;MDe((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=zA(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||ODe(s,t);o&&(FDe({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};ss.interceptor=new Ize(jIe,HIe),u([d()],ss.prototype,"_error",void 0),u([d()],ss.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],ss.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],ss.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],ss.prototype,"_sourceLayer",null),u([d()],ss.prototype,"abilities",void 0),u([Bt("abilities")],ss.prototype,"castAbilities",null),u([d({readOnly:!0})],ss.prototype,"content",void 0),u([d({readOnly:!0})],ss.prototype,"contentViewModels",void 0),u([d({type:Boolean})],ss.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],ss.prototype,"state",null),u([d({readOnly:!0})],ss.prototype,"formattedAttributes",void 0),u([d({type:ho,value:null})],ss.prototype,"graphic",null),u([d({readOnly:!0})],ss.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],ss.prototype,"relatedInfos",void 0),u([d()],ss.prototype,"spatialReference",null),u([d({readOnly:!0})],ss.prototype,"title",void 0),u([d()],ss.prototype,"map",null),u([d({readOnly:!0})],ss.prototype,"waitingForContent",null),u([d()],ss.prototype,"view",void 0),ss=E$=u([P(mme)],ss);const aq=ss,gme=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>Mde(i)&&!i.destroyed?ae("div",{key:i},i.render()):i instanceof HTMLElement?ae("div",{key:i,bind:i,afterCreate:this._attachToNode}):l$e(i)?ae("div",{key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return t=u([P("esri.widgets.Feature.ContentMixin")],t),t},go={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},lK={title:!0,content:!0,lastEditedInfo:!0};let xo=class extends gme(va){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements=L({},lK),this.map=null,this.view=null,this.viewModel=new aq}initialize(){this.own(uo(this,"viewModel.contentViewModels",()=>this._setupContentWidgets()))}loadDependencies(){return import("./calcite-notice.9449f1ec.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return L(L({},lK),e)}render(){const{state:e}=this.viewModel,t=ae("div",{class:go.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return ae("div",{class:this.classes(go.base,go.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return ae("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?ae("div",{key:"error-title",slot:"title"},e.errorMessage):null,ae("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return ae("div",{key:"loading-container",class:go.loadingSpinnerContainer},ae("span",{class:this.classes(go.iconLoading,go.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?ae("div",{class:go.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?ae(vH,{level:this.headingLevel,class:go.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?ae("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:ae("div",{key:`${t}-content`},i.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?ae("div",{key:this._buildKey("attachments-element",e),class:this.classes(go.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ae("div",{key:this._buildKey("expression-element",e),class:go.contentElement},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?ae("div",{key:this._buildKey("custom-element",t),class:go.contentElement},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ae("div",{key:this._buildKey("fields-element",e),class:go.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ae("div",{key:this._buildKey("media-element",e),class:go.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=Qf(n,{date:r,user:s});return ae("div",{key:"edit-info-element",class:this.classes(go.lastEditedInfo,go.contentElement)},o)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?ae("div",{key:this._buildKey("text-element",t),class:this.classes(go.contentElement,go.text)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{s.type==="attachments"&&(this._contentWidgets[n]=new t$e({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new Pde({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new npe({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new i$({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new i$({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new Pze({viewModel:r[n]}))},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new i$({viewModel:s}))}this.scheduleRender()}};u([xt("viewModel.graphic")],xo.prototype,"graphic",void 0),u([xt("viewModel.defaultPopupTemplateEnabled")],xo.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],xo.prototype,"headingLevel",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],xo.prototype,"label",void 0),u([d(),Bl("esri/widgets/Feature/t9n/Feature")],xo.prototype,"messages",void 0),u([d(),Bl("esri/t9n/common")],xo.prototype,"messagesCommon",void 0),u([d(),Bl("esri/widgets/support/t9n/uriUtils")],xo.prototype,"messagesURIUtils",void 0),u([xt("viewModel.spatialReference")],xo.prototype,"spatialReference",void 0),u([xt("viewModel.title")],xo.prototype,"title",void 0),u([d()],xo.prototype,"visibleElements",void 0),u([Bt("visibleElements")],xo.prototype,"castVisibleElements",null),u([xt("viewModel.map")],xo.prototype,"map",void 0),u([xt("viewModel.view")],xo.prototype,"view",void 0),u([d({type:aq})],xo.prototype,"viewModel",void 0),xo=u([P("esri.widgets.Feature")],xo);const Lze=xo;var yme;const A$=Symbol("anchorHandles");let O_=class extends qr.EventedAccessor{constructor(e){super(e),this[yme]=new Jt,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[A$].add([Rd(()=>Ks(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation"),{equals:TI}),Rd(()=>this.screenLocationEnabled?this.screenLocation:null,()=>this.emit("view-change"))])}destroy(){this.view=null,this[A$]=ct(this[A$])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this;return i&&_(e)&&_(t)&&t.ready?t.toScreen(e):null}};yme=A$,u([d()],O_.prototype,"location",void 0),u([d()],O_.prototype,"screenLocation",null),u([d()],O_.prototype,"screenLocationEnabled",void 0),u([d()],O_.prototype,"view",void 0),O_=u([P("esri.widgets.support.AnchorElementViewModel")],O_);const vme=O_,Nze="esri.widgets.CompassViewModel";let C$=class extends vme{constructor(e){super(e),this.visible=!1}};u([d()],C$.prototype,"visible",void 0),C$=u([P(Nze)],C$);const _me=C$,ZU={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let M_=class extends va{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new _me,this.visible=!1}initialize(){this.own([Br(this,"visible",e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;const r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,n={[ZU.spinnerStart]:r,[ZU.spinnerFinish]:s},o=this._getPositionStyles();return ae("div",{class:this.classes(ZU.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=iS(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(C(t)||C(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([xt("viewModel.location")],M_.prototype,"location",void 0),u([xt("viewModel.view")],M_.prototype,"view",void 0),u([d({type:_me})],M_.prototype,"viewModel",void 0),u([xt("viewModel.visible")],M_.prototype,"visible",void 0),M_=u([P("esri.widgets.Spinner")],M_);const Fze=M_;var cK;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(cK||(cK={}));class Uze{constructor(t,i){this._storage=new HH,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i){this._storage.put(t,i,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}new Uze(1e3);new rt([128,128,128]);const uK=/\/resource\/(.*?)\.svg$/,zze=new rt("white");function kze(e,t){const i=t.resource.href;return!ue("esri-canvas-svg-support")&&e.styleOrigin&&uK.test(i)?i.replace(uK,"/resource/png/$1.png"):i}function OL(e,t){if(t==null)return e;const i=e.toRgba();return i[3]=i[3]*t,new rt(i)}function Bze(e,t,i){const r=e.symbolLayers;if(!r)return;const s=n=>{const o=_(n)?n:null;return OL(t=t||o||i!=null&&zze,i)};r.forEach(n=>{if(n.type!=="object"||n.resource.href==null||t)if(n.type==="water")n.color=s(n.color);else{const o=_(n.material)?n.material.color:null,a=s(o);C(n.material)?n.material=new zc({color:a}):n.material.color=a,i!=null&&"outline"in n&&_(n.outline)&&_(n.outline.color)&&(n.outline.color=OL(n.outline.color,i))}})}function Vze(e,t,i){(t=t||e.color)&&(e.color=OL(t,i)),i!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=OL(e.outline.color,i))}function QU(e,t,i){e&&(t||i!=null)&&(t&&(t=new rt(t)),xR(e)?Bze(e,t,i):Rj(e)&&Vze(e,t,i))}async function Gze(e,t){const i=e.symbolLayers;i&&await pF(i,async r=>jze(r,t))}async function jze(e,t){switch(e.type){case"extrude":qze(e,t);break;case"icon":case"line":case"text":Hze(e,t);break;case"path":Xze(e,t);break;case"object":await Wze(e,t)}}function Hze(e,t){const i=bme(t);_(i)&&(e.size=i)}function bme(e){for(const t of e)if(typeof t=="number")return t;return null}function qze(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function Wze(e,t){const{resourceSize:i,symbolSize:r}=await Yze(e),s=wme(t,i,r);e.width=GC(t[0],r[0],i[0],s),e.depth=GC(t[1],r[1],i[1],s),e.height=GC(t[2],r[2],i[2],s)}function Xze(e,t){const i=wme(t,kp,[e.width,void 0,e.height]);e.width=GC(t[0],e.width,1,i),e.height=GC(t[2],e.height,1,i)}function wme(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return i[r]!=null?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}async function Yze(e){const t=await import("./symbolLayerUtils.93103fdd.js"),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,o=[r,n,s];let a=1;for(let l=0;l<3;l++)if(o[l]!=null){a=o[l]/i[l];break}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function GC(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return t!=null?t:i;default:return e}}function Zze(e,t){const i=bme(t);if(!C(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=i,e.height=i*r):(e.width=i*r,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}async function Qze(e,t){if(e&&t)return xR(e)?Gze(e,t):void(Rj(e)&&Zze(e,t))}function Jze(e,t,i){if(e&&t!=null)if(xR(e)){const r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else Rj(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function xme(e){return e&&"opacity"in e?e.opacity*xme(e.parent):1}async function Kze(e,t){var i,r;if(!e)return;const s=e.sourceLayer,n=(i=_(t)&&(r=t.useSourceLayer)!=null&&r?s:e.layer)!=null?i:s,o=xme(n);if(_(e.symbol)&&(!_(t)||t.ignoreGraphicSymbol!==!0)){const S=e.symbol.type==="web-style"?await e.symbol.fetchSymbol(_(t)?t.abortOptions:null):e.symbol.clone();return QU(S,null,o),S}const a=_(t)&&t.renderer||n&&"renderer"in n&&n.renderer;let l=a&&"getSymbolAsync"in a?await a.getSymbolAsync(e,t):null;if(!l)return;if(l=l.type==="web-style"?await l.fetchSymbol(_(t)?t.abortOptions:null):l.clone(),!("visualVariables"in a)||!a.visualVariables||!a.visualVariables.length)return QU(l,null,o),l;if("arcadeRequiredForVisualVariables"in a&&a.arcadeRequiredForVisualVariables&&(C(t)||C(t.arcade))){const S=L({},t);S.arcade=await Jp(),t=S}const c=await Promise.resolve().then(function(){return r4e}),h=[],p=[],f=[],g=[];for(const S of a.visualVariables)switch(S.type){case"color":h.push(S);break;case"opacity":p.push(S);break;case"rotation":g.push(S);break;case"size":S.target||f.push(S)}const y=!!h.length&&h[h.length-1],v=y?c.getColor(y,e,t):null,b=!!p.length&&p[p.length-1];let w=b?c.getOpacity(b,e,t):null;if(o!=null&&(w=w!=null?w*o:o),QU(l,v,w),f.length){const S=c.getAllSizes(f,e,t);await Qze(l,S)}for(const S of g)Jze(l,c.getRotationAngle(S,e,t),S.axis);return l}const eke=ue("mac")?"Meta":"Ctrl",QF={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)QF[e]=String.fromCharCode(e);for(let e=1;e<25;e++)QF[111+e]=`F${e}`;for(let e=65;e<91;e++)QF[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function tke(e){if(e.key!==void 0)return Q_(e);const t=QF[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function ike(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class rke{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}}const hK=pe.getLogger("esri.views.input.InputHandler");class fo{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?hK.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof t=="string"?new rke(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new ske(n,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new nke(t,{onEmit:(r,s,n,o)=>{this._manager.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):hK.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const i=this._incoming[t.type];if(i){for(const r of i)if(r.match.matches(t)&&(r.callback(t),t.shouldStopPropagation()))break}}}class ske{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class nke{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class oke extends fo{constructor(t){super(!0),this._onChange=t,this._value="mouse",this.registerIncoming("pointer-down",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse")}),this._moveHandler=this.registerIncoming("pointer-move",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse")}),this._moveHandler.pause()}_setValue(t){t!==this._value&&(t==="touch"?this._moveHandler.resume():this._moveHandler.pause(),this._value=t,this._onChange(t))}}const JU=pe.getLogger("esri.views.input.InputManager");let P_=class extends be{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=eke,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,i=A0.INTERNAL){if(this._nameToGroup[e])return void JU.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void JU.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const n=r.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(r,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):JU.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const r=this._handlers[i];r.priorityIndex=i,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s){for(const n of r.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of r.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)ike(o)||t.add(o)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,i=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(r(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(r(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new oke(e=>this._setLatestPointerType(e)),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,A0.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],A0.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=r!==void 0?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new ake(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new _V,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(!(r!=null&&this._stoppedPropagationEventIds.has(r)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){r!=null&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new _V;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const r of t.handler.incomingEventMatches){if(i.eventType!==r.eventType)continue;const s=i.keyModifiers.filter(n=>r.keyModifiers.includes(n));if(s.length===i.keyModifiers.length!=(s.length===r.keyModifiers.length))return i.keyModifiers.length>r.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let r=0;for(;r<t.length&&this._compareHandlerPriority(i,t[r])>=0;)r++;t.splice(r,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],P_.prototype,"hasPendingInputs",null),u([d()],P_.prototype,"eventSource",void 0),u([d()],P_.prototype,"recognizers",void 0),u([d({readOnly:!0})],P_.prototype,"latestPointerType",void 0),P_=u([P("esri.views.input.InputManager")],P_);class ake{constructor(t,i,r,s,n){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=Vy.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Vy.STOPPED}shouldStopPropagation(){return(this._propagationState&Vy.STOPPED)!=0}async(t){this._propagationState|=Vy.PAUSED;const i=(r,s)=>{this._propagationState&=~Vy.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&Vy.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var Vy;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(Vy||(Vy={}));const A0={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};function lke(e){return e&&typeof e.highlight=="function"}function cke(e){return e&&typeof e.maskOccludee=="function"}function xmt(e,t,i){return C(e)||e>i&&(t===0||e<t)}function Tmt(e,t){return e>0||t>0}function Smt(e){var t,i;const r=e.effectiveScaleRange;return{minScale:(t=r==null?void 0:r.minScale)!=null?t:0,maxScale:(i=r==null?void 0:r.maxScale)!=null?i:0}}const JF={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},w1=new h2({id:"zoom-to-feature",title:"{messages.zoom}",className:JF.iconZoom}),dK=new h2({id:"remove-selected-feature",title:"{messages.remove}",className:JF.iconTrash}),nT=new h2({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:JF.iconZoom}),oT=new h2({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:JF.iconBrowseClusteredFeatures}),uke="esri.widgets.Popup.PopupViewModel",V0=pe.getLogger(uke),hke=e=>{const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new Y("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new Y("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new Y("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new Y("trigger-action:invalid-action","Action is disabled"));if(o===w1.id)return pke(s.viewModel).catch(C6);if(o===nT.id)return fke(s.viewModel);if(o===oT.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===dK.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new Y(`trigger-action:${dK.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function Tme(e){const{selectedFeature:t,location:i,view:r}=e;return r?r.type==="3d"?t||i:e.get("selectedFeature.geometry")||i:null}function dke(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then(s=>{r=!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}).catch(()=>{const s=new Y("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});V0.error(s)}),r}return!0}async function pke(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=Tme(e);if(!n){const c=new Y("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw V0.error(c),c}const o=r.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&a.type==="point"&&dke(i,r);w1.active=!0,w1.disabled=!0;try{await e.view.goTo({target:n,scale:l?o:void 0})}finally{w1.active=!1,w1.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}async function fke(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const a=new Y("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw V0.error(a),a}if(!t.isAggregate){const a=new Y("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw V0.error(a),a}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],nT.active=!0,nT.disabled=!0;const{extent:o}=await s.queryExtent(n);await i.goTo({target:o}),nT.active=!1,nT.disabled=!1}async function mke(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const a=new Y("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:i});throw V0.error(a),a}if(!t.isAggregate){const a=new Y("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw V0.error(a),a}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}async function gke(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const a=new Y("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:i});throw V0.error(a),a}if(!t.isAggregate){const a=new Y("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw V0.error(a),a}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],oT.active=!0,oT.disabled=!0;const{features:o}=await s.queryFeatures(n);oT.active=!1,oT.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}function yke(e){var t;(t=e.selectedFeature)!=null&&t.isAggregate&&(e.features=e.features.filter(i=>i.isAggregate))}const Sme=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([d()],t.prototype,"goToOverride",void 0),u([d()],t.prototype,"view",void 0),t=u([P("esri.widgets.support.GoTo")],t),t},jC=St.ofType({key:"type",defaultKeyValue:"button",base:eF,typeMap:{button:h2,toggle:gle}}),vke=()=>[w1.clone()],_ke=()=>[nT.clone(),oT.clone()],Eme="esri.widgets.Popup.PopupViewModel",pK=pe.getLogger(Eme);let Si=class extends Sme(vme){constructor(e){super(e),this._handles=new Jt,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new jC,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ho({symbol:new Gb({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([uo(this,["autoOpenEnabled","view"],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),Br(this,["highlightEnabled","selectedFeature","visible","view"],()=>this._highlightFeature()),Br(this,"view.animation.state",e=>this._animationStateChange(e)),Br(this,"location",e=>this._locationChange(e)),Br(this,"selectedFeature",e=>this._selectedFeatureChange(e)),Br(this,["selectedFeatureIndex","featureCount","featuresPerPage"],()=>this._selectedFeatureIndexChange()),Br(this,["featurePage","selectedFeatureIndex","featureCount","featuresPerPage, featureViewModels"],()=>this._setGraphicOnFeatureViewModels()),Br(this,"featureViewModels",()=>this._featureViewModelsChange()),this.on("trigger-action",e=>hke({event:e,view:this.view})),qV(this,"waitingForResult",()=>this._waitingForResultChange(),!0),Br(this,["features","view","view.map","view.spatialReference"],()=>this._updateFeatureVMs()),Br(this,["view.scale"],this._viewScaleChange),qV(this,"visible",()=>this.browseClusterEnabled=!1),Br(this,"browseClusterEnabled",e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new jC;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){var e;const t=this._get("defaultActions")||new jC;return t.removeAll(),t.addMany((e=this.selectedFeature)!=null&&e.isAggregate?_ke():vke()),t}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Bm(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const i=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=Tme(this);if(!t){const i=new Y("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return pK.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const r=new Y("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return pK.error(r),Promise.reject(r)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t=ge(L({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of r)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){yke(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){await mke(this),await gke(this)}_animationStateChange(e){this.zoomToLocation||(w1.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var e;const t=(e=this.view)==null?void 0:e.graphics;t&&(t.remove(this.selectedClusterBoundaryFeature),t.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){var e;if((e=this.selectedFeature)!=null&&e.isAggregate)return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.browseClusterEnabled=!1,this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),e.isAggregate?void 0:(e.symbol=await Kze(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=r.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:i,promisesPerLayerView:r}=t,s=Promise.resolve(i),n=r.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(e!=null&&e.isAggregate||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach((n,o)=>{if(!n)return;let a=null;if(r.some((h,p)=>(h&&h.graphic===n&&(a=h,r.splice(p,1)),!!a)),a)s[o]=a;else{var l,c;const h=new aq({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),r.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const r=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},A0.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(c=>c.promise)];return r.popup.open({location:a||i,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return C(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;let{layer:n,sourceLayer:o}=t;if((o==null?void 0:o.type)!=="map-notes"&&(o==null?void 0:o.type)!=="subtype-group"||(n=o),!(n&&n instanceof QO))return;const a=this._getLayerView(r,n);this._highlightPromise=a;const l=await a;if(!(l&&lke(l)&&this._highlightPromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const c=n.type==="imagery"?void 0:"objectIdField"in n&&n.objectIdField,h=t.attributes,p=h&&c&&h[c],f=l.highlight(p||t);this._handles.add(f,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(r=>!t.includes(r));this.features=t.concat(i)}};u([d()],Si.prototype,"featurePage",void 0),u([d()],Si.prototype,"isLoadingFeature",null),u([d({type:jC})],Si.prototype,"actions",void 0),u([d({readOnly:!0})],Si.prototype,"active",null),u([d({readOnly:!0})],Si.prototype,"allActions",null),u([d({type:Boolean})],Si.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Si.prototype,"autoCloseEnabled",void 0),u([d()],Si.prototype,"autoOpenEnabled",void 0),u([d()],Si.prototype,"browseClusterEnabled",void 0),u([d()],Si.prototype,"content",void 0),u([d({type:jC,readOnly:!0})],Si.prototype,"defaultActions",null),u([d({readOnly:!0})],Si.prototype,"featureCount",null),u([d()],Si.prototype,"features",null),u([d()],Si.prototype,"featuresPerPage",void 0),u([d()],Si.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Si.prototype,"featureViewModels",void 0),u([d()],Si.prototype,"highlightEnabled",void 0),u([d()],Si.prototype,"includeDefaultActions",void 0),u([d({type:We})],Si.prototype,"location",null),u([d({readOnly:!0})],Si.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Si.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Si.prototype,"waitingForResult",null),u([d({readOnly:!0})],Si.prototype,"promiseCount",null),u([d()],Si.prototype,"promises",null),u([d({value:null,readOnly:!0})],Si.prototype,"selectedFeature",null),u([d({value:-1})],Si.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Si.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Si.prototype,"state",null),u([d()],Si.prototype,"title",void 0),u([d()],Si.prototype,"updateLocationEnabled",void 0),u([d()],Si.prototype,"view",void 0),u([d()],Si.prototype,"visible",void 0),u([d()],Si.prototype,"zoomFactor",void 0),u([d()],Si.prototype,"zoomToLocation",void 0),u([d()],Si.prototype,"centerAtLocation",null),Si=u([P(Eme)],Si);const Ame=Si,fK="selected-index",bke=0,mK="popup-spinner",$e={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},gK={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},yK="esri-popup";function Of(e,t){return t===void 0?`${yK}__${e}`:`${yK}__${e}-${t}`}const Cme="esri.widgets.Popup",vK=pe.getLogger(Cme),_K={closeButton:!0,featureNavigation:!0};let At=class extends gme(va){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Jt,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([i])=>{i!=null&&i.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=oH(()=>this._displaySpinner(),bke),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new Ame,this.visible=null,this.visibleElements=L({},_K),this._addSelectedFeatureIndexHandle(),this.own([Br(this,"viewModel.screenLocation",()=>this._positionContainer()),Br(this,["viewModel.active","dockEnabled"],()=>this._toggleScreenLocationEnabled()),Br(this,"viewModel.screenLocation",(i,r)=>{!!i!=!!r&&this.reposition()}),Br(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],()=>this.reposition()),Br(this,"spinnerEnabled",i=>this._spinnerEnabledChange(i)),Br(this,"viewModel.view.size",(i,r)=>this._updateDockEnabledForViewSize(i,r)),Br(this,"viewModel.view",(i,r)=>this._viewChange(i,r)),Br(this,"viewModel.view.ready",(i,r)=>this._viewReadyChange(i,r)),Br(this,["viewModel.waitingForResult","viewModel.location"],()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),Br(this,["selectedFeatureWidget.viewModel.title","selectedFeatureWidget.viewModel.state"],()=>this._setTitleFromFeatureWidget()),Br(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.state"],()=>this._setContentFromFeatureWidget()),qV(this,"collapsed",()=>{var i,r;((i=this.viewModel)==null||(r=i.view)==null?void 0:r.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),aH(this,"viewModel.allActions","change",()=>this._watchActions()),uo(this,"viewModel.allActions",()=>this._watchActions()),Br(this,"viewModel.featureViewModels",()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,r,s,n,o;return!!(this.selectedFeatureWidget?((e=this.selectedFeatureWidget)==null||(t=e.viewModel)==null?void 0:t.waitingForContent)||((i=this.selectedFeatureWidget)==null||(r=i.viewModel)==null?void 0:r.state)==="error"||((s=this.selectedFeatureWidget)==null||(n=s.viewModel)==null?void 0:n.content):(o=this.viewModel)==null?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||gK}set dockOptions(e){const t=L({},gK),i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s=L(L({},t),e),n=L(L({},t.breakpoint),r),{breakpoint:o}=s;o===!0?s.breakpoint=n:typeof o=="object"&&(s.breakpoint=L(L({},n),o)),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s=ge(L({},t),{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new Lze({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return L(L({},_K),e)}blur(){const{active:e}=this.viewModel;e||vK.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||vK.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove(fK);const r=!!e&&!!e.featureMenuOpen,s=!!e&&!!e.actionsMenuOpen,n={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:s,featureMenuOpen:r};((t=this.viewModel)==null||(i=t.view)==null?void 0:i.widthBreakpoint)==="xsmall"&&(n.collapsed=!0),this.set(n),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,r;const{actionsMenuOpen:s,dockEnabled:n,featureMenuVisible:o,dividedActions:a,currentAlignment:l,currentDockPosition:c}=this,{active:h}=this.viewModel,{menuActions:p}=a,f=h&&p.length>1&&s,g=h&&n,y=h&&!n,v=(e=this.selectedFeature)==null||(t=e.layer)==null?void 0:t.title,b=(i=this.selectedFeature)==null||(r=i.layer)==null?void 0:r.id,w={[$e.alignTopCenter]:l==="top-center",[$e.alignBottomCenter]:l==="bottom-center",[$e.alignTopLeft]:l==="top-left",[$e.alignBottomLeft]:l==="bottom-left",[$e.alignTopRight]:l==="top-right",[$e.alignBottomRight]:l==="bottom-right",[$e.isDocked]:g,[$e.shadow]:y,[$e.isDockedTopLeft]:c==="top-left",[$e.isDockedTopCenter]:c==="top-center",[$e.isDockedTopRight]:c==="top-right",[$e.isDockedBottomLeft]:c==="bottom-left",[$e.isDockedBottomCenter]:c==="bottom-center",[$e.isDockedBottomRight]:c==="bottom-right",[$e.isFeatureMenuOpen]:o,[$e.isActionsMenuOpen]:f};return ae("div",{class:this.classes($e.base,w),role:"presentation","data-layer-title":v,"data-layer-id":b,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},h?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return ae("span",{"aria-hidden":"true",class:this.classes($e.icon,$e.iconLoading,$e.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?ae("div",{key:Of("loading-container"),role:"presentation",class:$e.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=d0(this.container),t={[$e.iconRightTriangleArrow]:e,[$e.paginationPreviousIconRTL]:e,[$e.iconLeftTriangleArrow]:!e,[$e.paginationPreviousIconLTR]:!e};return ae("span",{"aria-hidden":"true",class:this.classes($e.icon,t)})}renderPreviousButton(){const{messages:e}=this;return ae("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes($e.button,$e.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=d0(this.container),t={[$e.iconLeftTriangleArrow]:e,[$e.paginationNextIconRTL]:e,[$e.iconRightTriangleArrow]:!e,[$e.paginationNextIconLTR]:!e};return ae("span",{"aria-hidden":"true",class:this.classes($e.icon,t)})}renderNextButton(){const{messages:e}=this;return ae("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes($e.button,$e.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return ae("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes($e.button,$e.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[$e.iconUndock]:e,[$e.iconDock]:!e,[$e.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[$e.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[$e.iconDockToTop]:!e&&t==="top-center",[$e.iconDockToBottom]:!e&&t==="bottom-center"};return ae("span",{"aria-hidden":"true",class:this.classes(i,$e.icon)})}renderDockButton(){var e,t,i;const{dockEnabled:r,messages:s}=this,n=(e=this.viewModel)==null||(t=e.view)==null?void 0:t.widthBreakpoint,o=r?s.undock:s.dock;return n!=="xsmall"&&(i=this.dockOptions)!=null&&i.buttonEnabled?ae("div",{role:"button","aria-label":o,title:o,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes($e.button,$e.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[$e.headerContainerButton]:i},o=ae(vH,{level:this.headingLevel,class:$e.headerTitle,innerHTML:e}),a=i?ae("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes($e.headerContainer,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):ae("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes($e.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return ae("span",{"aria-hidden":"true",class:this.classes($e.icon,$e.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?ae("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:$e.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return ae("header",{class:$e.header},this.renderTitle(),ae("div",{class:$e.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?ae("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:$e.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?ae("div",{key:Of("actions-menu-button"),class:this.classes($e.button,$e.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},ae("span",{"aria-hidden":"true",class:$e.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?ae("ul",{id:e,role:"menu","aria-labelledby":t,key:Of("actions"),class:$e.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?ae("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:$e.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?ae("section",{key:Of("navigation"),class:this.classes($e.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,o={[$e.footerHasPagination]:e,[$e.footerHasActions]:s,[$e.footerHasActionsMenu]:n};return e||s?ae("div",{key:Of("feature-buttons"),class:this.classes($e.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=Qf(e.selectedFeatures,{total:t.length});return ae("section",{key:Of("menu"),class:$e.featureMenu},ae("strong",{class:$e.featureMenuHeader},r),ae("nav",{bind:this,class:$e.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:VV},this.renderFeatureMenu(),ae("div",{class:$e.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?ae("div",{class:$e.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:ae("div",{key:Of("pointer"),class:$e.pointer,role:"presentation"},ae("div",{class:this.classes($e.pointerDirection,$e.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",f={[$e.shadow]:e,[$e.isCollapsible]:n,[$e.isCollapsed]:a};return ae("div",{class:this.classes($e.main,$e.widget,f),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=(e=this.viewModel)==null?void 0:e.content;return t?typeof t=="string"?ae("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return ae("span",{key:"text",class:$e.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[$e.iconLoading]:e.active,[$e.rotating]:e.active,[$e.icon]:!!t,[$e.actionImage]:!e.active&&!!i};return t&&(r[t]=!e.active),ae("span",{key:"icon","aria-hidden":"true",class:this.classes($e.icon,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={[$e.action]:t.type!=="toggle",[$e.actionToggle]:t.type==="toggle",[$e.actionToggleOn]:t.type==="toggle"&&t.value,[$e.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],o=i==="menu-item"?ae("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes($e.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):ae("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes($e.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[$e.featureMenuSelected]:o},l=o?ae("span",{key:Of(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:$e.iconCheckMark}):null,c=ae("span",{innerHTML:e.title||r.untitled});return ae("li",{role:"menuitem",tabIndex:-1,key:Of(`feature-menu-feature-${s}`),class:this.classes(a,$e.featureMenuItem),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},ae("span",{class:$e.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?ae("ol",{class:$e.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(i=>!!i.graphic).map((i,r)=>this.renderFeatureMenuItem(i,r))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i==null?void 0:i.attributes,o=s==="zoom-to-feature"?Qf(e.title,{messages:t}):s==="remove-selected-feature"?Qf(e.title,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?Qf(e.title,{messages:t}):e.title;return o&&n?Qf(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:$e.iconDefaultAction;return n&&i?Qf(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{image:r}=e;return r&&i?Qf(r,i):r}_createFeatureUpdatedAnimation(){return FPe("enter",$e.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(i=>{this._handles.add(Br(i,["uid","active","className","disabled","id","title","image","visible"],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),i=this._getInlineActionCount(),r=i===null,s=i===0;return{inlineActions:r?t.slice(0):s?new St:t.slice(0,i),menuActions:r?new St:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){const{selectedFeatureWidget:e,messagesCommon:t}=this;var i,r;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?t.errorMessage:((r=e.viewModel)==null?void 0:r.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){Q_(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){Q_(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=Q_(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=Q_(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===r);if(!i)return;const o=i.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=Q_(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await ab(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=Br(this,"viewModel.selectedFeatureIndex",(t,i)=>this._selectedFeatureIndexUpdated(t,i));this._handles.add(e,fK)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-t<o.top||s==="bottom"&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(C(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(x){return parseInt(x.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=i.getBoundingClientRect(),g=f+t,y=Math.max(p,c,h)+t,v=this._isOutsideView({popupHeight:y,popupWidth:g,screenLocation:n,side:"right",view:o}),b=this._isOutsideView({popupHeight:y,popupWidth:g,screenLocation:n,side:"left",view:o}),w=this._isOutsideView({popupHeight:y,popupWidth:g,screenLocation:n,side:"top",view:o}),S=this._isOutsideView({popupHeight:y,popupWidth:g,screenLocation:n,side:"bottom",view:o});return b?w?"bottom-right":"top-right":v?w?"bottom-left":"top-left":w?S?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return d0(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if(e!=="auto")return e;const i=(t=this.viewModel)==null?void 0:t.view,r=d0(this.container)?"top-left":"top-right";if(!i)return r;const s=i.padding||{left:0,right:0,top:0,bottom:0},n=i.width-s.left-s.right,{breakpoints:o}=i;return o&&n<=o.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=r/2,a=i.height-t,l=i.width-e,{padding:c}=this.view;return s==="bottom-center"?{top:t+n-c.top,left:e-o-c.left}:s==="top-left"?{bottom:a+n-c.bottom,right:l+n-c.right}:s==="bottom-left"?{top:t+n-c.top,right:l+n-c.right}:s==="top-right"?{bottom:a+n-c.bottom,left:e+n-c.left}:s==="bottom-right"?{top:t+n-c.top,left:e+n-c.left}:s==="top-center"?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(C(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a,height:l}=i;return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i;const r=e.breakpoint,s=(t=this.viewModel)==null||(i=t.view)==null?void 0:i.ui;if(!s)return!1;const{width:n,height:o}=s;if(isNaN(n)||isNaN(o))return!1;const a=r.hasOwnProperty("width")&&n<=r.width,l=r.hasOwnProperty("height")&&o<=r.height;return a||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Qf(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,mK),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new Fze({view:e}),e.ui.add(this._spinner,{key:mK,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex(n=>n.uid===t),s=i.getItemAt(r);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],At.prototype,"actionsMenuId",null),u([d({readOnly:!0})],At.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],At.prototype,"featureMenuId",null),u([d({readOnly:!0})],At.prototype,"titleId",null),u([d({readOnly:!0})],At.prototype,"contentId",null),u([d({readOnly:!0})],At.prototype,"hasContent",null),u([d({readOnly:!0})],At.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],At.prototype,"collapsible",null),u([d({readOnly:!0})],At.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],At.prototype,"contentCollapsed",null),u([d({readOnly:!0})],At.prototype,"dividedActions",null),u([xt("viewModel.actions")],At.prototype,"actions",void 0),u([d()],At.prototype,"actionsMenuOpen",null),u([d()],At.prototype,"alignment",void 0),u([xt("viewModel.autoCloseEnabled")],At.prototype,"autoCloseEnabled",void 0),u([xt("viewModel.autoOpenEnabled")],At.prototype,"autoOpenEnabled",void 0),u([xt("viewModel.defaultPopupTemplateEnabled")],At.prototype,"defaultPopupTemplateEnabled",void 0),u([xt("viewModel.content")],At.prototype,"content",void 0),u([d()],At.prototype,"collapsed",void 0),u([d()],At.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],At.prototype,"currentAlignment",null),u([d({readOnly:!0})],At.prototype,"currentDockPosition",null),u([d()],At.prototype,"dockOptions",null),u([d()],At.prototype,"dockEnabled",void 0),u([xt("viewModel.featureCount")],At.prototype,"featureCount",void 0),u([d()],At.prototype,"featureMenuOpen",void 0),u([xt("viewModel.features")],At.prototype,"features",void 0),u([xt("viewModel.goToOverride")],At.prototype,"goToOverride",void 0),u([d()],At.prototype,"headingLevel",void 0),u([xt("viewModel.highlightEnabled")],At.prototype,"highlightEnabled",void 0),u([xt("viewModel.location")],At.prototype,"location",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],At.prototype,"label",void 0),u([d()],At.prototype,"maxInlineActions",void 0),u([d(),Bl("esri/widgets/Popup/t9n/Popup")],At.prototype,"messages",void 0),u([d(),Bl("esri/t9n/common")],At.prototype,"messagesCommon",void 0),u([xt("viewModel.promises")],At.prototype,"promises",void 0),u([xt("viewModel.selectedFeature")],At.prototype,"selectedFeature",void 0),u([xt("viewModel.selectedFeatureIndex")],At.prototype,"selectedFeatureIndex",void 0),u([d({readOnly:!0})],At.prototype,"selectedFeatureWidget",null),u([d()],At.prototype,"spinnerEnabled",void 0),u([xt("viewModel.title")],At.prototype,"title",void 0),u([xt("viewModel.updateLocationEnabled")],At.prototype,"updateLocationEnabled",void 0),u([xt("viewModel.view")],At.prototype,"view",void 0),u([d({type:Ame}),n$e(["triggerAction","trigger-action"])],At.prototype,"viewModel",void 0),u([xt("viewModel.visible")],At.prototype,"visible",void 0),u([d()],At.prototype,"visibleElements",void 0),u([Bt("visibleElements")],At.prototype,"castVisibleElements",null),u([Iu()],At.prototype,"_close",null),u([Iu()],At.prototype,"_toggleDockEnabled",null),u([Iu()],At.prototype,"_toggleFeatureMenu",null),u([Iu()],At.prototype,"_toggleActionsMenu",null),u([Iu()],At.prototype,"_triggerAction",null),u([Iu()],At.prototype,"_selectFeature",null),u([Iu()],At.prototype,"_next",null),u([Iu()],At.prototype,"_previous",null),At=u([P(Cme)],At);const bK=At,KU=[0,0];function wke(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return KU[0]=i.left+t.pageXOffset,KU[1]=i.top+t.pageYOffset,KU}function wK(e){e&&(Rce(e),e.parentNode&&e.parentNode.removeChild(e))}function xke(e){const t=document.createElement("div");return e.appendChild(t),t}const dE=16,EP=750,Tke=512,Ske=2,Eke=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:dE,time:EP},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",r=>{const s=this.surface;s&&s.setAttribute("data-cursor",r)}),this.watch("interacting",r=>{const s=this.surface;s&&s.setAttribute("data-interacting",r.toString())})])}initialize(){this.handles.add(this.watch("ui",(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(i){const r=this._get("container");if(r===i)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),wK(this.root),this._set("root",null),GY(this.userContent,r),wK(this.userContent),this._set("userContent",null)),i){i.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",GY(i,n),i.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",i.insertBefore(o,i.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new zZ;o.appendChild(l.surface),this._set("overlay",l),l.watch("needsRender",c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Y1({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(xe(()=>this.size,c=>{const[h,p]=c,f="esri-view-surface--inset-outline";h>=document.body.clientWidth||p>=document.body.clientHeight?a.classList.add(f):a.classList.remove(f)},Bi),s),this._set("container",i),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get popup(){return this._get("popup")||new bK({view:this})}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n[0],r-=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n[0],r+=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([xe(()=>this.root,r=>{i.container=r?xke(r):null},Bi),xe(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},Bi)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=dE,i.time=EP,this.handles.add([(()=>{const r=()=>{i.freq=dE,i.time=EP};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),Y1({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=dE,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?dE:Math.min(EP,n.freq*Ske),!s&&n.freq>=Tke&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=wke(i);return(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d({value:null,cast:i=>fF(i)})],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d({type:bK})],t.prototype,"popup",null),u([d({type:zZ})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d()],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([P("esri.views.DOMContainer")],t),t},lq=pe.getLogger("esri.layers.support.ElevationSampler");class Rme{queryElevation(t){return Ome(t.clone(),this)}on(){return Mke}projectIfRequired(t,i){return Mme(t,i)}}class Ake extends Rme{constructor(t,i,r){super(),this.tile=t,this.noDataValue=r,this.extent=sF(t.tile.extent,i.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this.aaExtent=t.tile.extent;const s=Yl(i.spatialReference),n=i.lodAt(t.tile.level).resolution*s;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const i=this.projectIfRequired(t,this.spatialReference);return!C(i)&&this.containsAt(i.x,i.y)}containsAt(t,i){return hj(this.aaExtent,t,i)}elevationAt(t,i){if(!this.containsAt(t,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return lq.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return Tt(this.tile.sample(t,i),this.noDataValue)}}class Emt extends Rme{constructor(t,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?t.map(o=>new Ake(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=sF(Gt(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,i){for(const r of this.samplers)if(r.containsAt(t,i))return r.elevationAt(t,i);return lq.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler`),this.noDataValue}}function Ome(e,t){const i=Mme(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":Cke(e,i,t);break;case"polyline":Rke(e,i,t);break;case"multipoint":Oke(e,i,t)}return e}function Mme(e,t){if(C(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=Ub(e,t);return r||lq.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function Cke(e,t,i){e.z=i.elevationAt(t.x,t.y)}function Rke(e,t,i){Fp.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];Fp.x=c[0],Fp.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(Fp.x,Fp.y)}}e.hasZ=!0}function Oke(e,t,i){Fp.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];Fp.x=o[0],Fp.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(Fp.x,Fp.y)}e.hasZ=!0}const Fp=new We,Mke={remove(){}};var N9;let mp=N9=class extends _e{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new N9({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],mp.prototype,"cols",void 0),u([d({type:Dr,json:{write:!0}})],mp.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],mp.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],mp.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],mp.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],mp.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],mp.prototype,"scale",void 0),mp=N9=u([P("esri.layers.support.LOD")],mp);const Pme=mp;var Ay;const xK=new yi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let En=Ay=class extends _e{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=Ke.WebMercator,numLODs:n=24}=e;if(!qc(s)){const p=[];if(i)for(let f=0;f<i.length;f++){const g=i[f];p.push({level:f,scale:g,resolution:g})}else{let f=5e-4;for(let g=n-1;g>=0;g--)p.unshift({level:g,scale:f,resolution:f}),f*=2}return new Ay({dpi:96,lods:p,origin:new We(0,0,s),size:[r,r],spatialReference:s})}const o=x0(s),a=e.origin?new We({x:e.origin.x,y:e.origin.y,spatialReference:s}):new We(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Yl(s)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],g=f*c;h.push({level:p,scale:f,resolution:g})}else{let p=xae(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/t);h.push({level:0,scale:p,resolution:p*c});for(let g=1;g<f;g++){const y=p/2**t,v=y*c;h.push({level:g,scale:y,resolution:v}),p=y}}return new Ay({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=x0(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return We.fromJSON(L({spatialReference:t.spatialReference},e))}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach(s=>{r.push(s.scale),t=s.scale>t?s.scale:t,i=s.scale<i?s.scale:i,this._levelToLOD[s.level]=s})),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+Math.log(s/e)/Math.log(s/n)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=i;else if(Kc(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const c=Ub(t,this.spatialReference);if(C(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:Gt()}),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=Ay.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===Ay.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(i=o)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Gt()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return Ay.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*t;i.push(new Pme({level:n.level,scale:n.scale,resolution:o}))}return new Ay({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};u([d({type:Number,json:{write:!0}})],En.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],En.prototype,"dpi",void 0),u([d({type:String,json:{read:xK.read,write:xK.write,origins:{"web-scene":{read:!1,write:!1}}}})],En.prototype,"format",void 0),u([d({readOnly:!0})],En.prototype,"isWrappable",null),u([d({type:We,json:{write:!0}})],En.prototype,"origin",void 0),u([Ne("origin")],En.prototype,"readOrigin",null),u([d({type:[Pme],value:null,json:{write:!0}})],En.prototype,"lods",null),u([d({readOnly:!0})],En.prototype,"minScale",void 0),u([d({readOnly:!0})],En.prototype,"maxScale",void 0),u([d({readOnly:!0})],En.prototype,"scales",void 0),u([d({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],En.prototype,"size",void 0),u([Ne("size",["rows","cols"])],En.prototype,"readSize",null),u([Xe("size",{cols:{type:Dr},rows:{type:Dr}})],En.prototype,"writeSize",null),u([d({type:Ke,json:{write:!0}})],En.prototype,"spatialReference",void 0),En=Ay=u([P("esri.layers.support.TileInfo")],En),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(En||(En={}));const Fm=En,Pke=12;class br{constructor(t){const i=br.checkUnsupported(t);if(_(i))throw i;const r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=hb(this.spatialReference)||pf(this.spatialReference)||ff(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new br(this.toTileInfo())}toTileInfo(){return new Fm({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=uY(t[0]),i[1]=DD(t[1]),i[2]=uY(t[2]),i[3]=DD(t[3])):this._isGCS&&(i[0]=$t(t[0]),i[1]=$t(t[1]),i[2]=$t(t[2]),i[3]=$t(t[3]))}getExtentGeometry(t,i,r,s=new ni){return this.getExtent(t,i,r,kd),s.spatialReference=this.spatialReference,s.xmin=kd[0],s.ymin=kd[1],s.xmax=kd[2],s.ymax=kd[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof br)){if(br.checkUnsupported(t))return!1;t=new br(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!AT(t.origin[0],this.origin[0],s)||!AT(t.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*Pke,AT(r,t.levels[i].resolution,s))}rootTilesInExtent(t,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(C(t)||n[0]===0||n[1]===0)return s;br.computeRowColExtent(t,n,this.origin,kd);let o=kd[1],a=kd[3],l=kd[0],c=kd[2];const h=c-l,p=a-o;if(h*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let g=l;g<c;g++)s.push([0,f,g]);return _(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,i,r,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-t[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!aSe(s.resolution,r/2**s.level))}static hasGapInLevels(t){const i=t.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new Y("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return C(t)?cq():t.lods.length<1?new Y("tilingscheme:generic","Tiling scheme must have at least one level"):br.isPowerOfTwo(t)?br.hasGapInLevels(t)?new Y("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):br.tileSizeSupported(t)?br.hasOriginPerLODs(t)?new Y("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new Y("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new Y("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const r=t[2]-t[0],s=t[3]-t[1],n=Yl(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new br(new Fm({size:[a,a],origin:{x:t[0]-.5*(o-r),y:t[3]+.5*(o-s)},lods:[{level:0,resolution:o/a,scale:1/(a/l*c/(o*n))}],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const i=new br(br.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){const s=256/i,n=new br(new Fm({size:[i,i],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function cq(){return new Y("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}br.WebMercatorAuxiliarySphereTileInfo=new Fm({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ke.WebMercator},spatialReference:Ke.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),br.WebMercatorAuxiliarySphere=br.makeWebMercatorAuxiliarySphere(19);const kd=Gt(),aT=64,uq=512,Ike=2.5,FR=lSe(H6/10),Ime=4,$ke=4,R$=e=>e<4?3:$ke,$me=Gt();br.WebMercatorAuxiliarySphere.getExtent(0,0,0,$me);const Dke=Gt([-180,-90,180,90]),Lke="Cannot extend surface to encompass all layers because it would result in too many root tiles.",Nke="Surface extent is too large for tile resolution at level 0.",Dme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC",V1=5,Fke=pe.getLogger("esri.views.support.GroundViewElevationSampler");let Cy=class extends qr.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=FR}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(C(e.extent)||!e.spatialReference)return null;const t=sF(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(C(this.extent)||!na(this.extent,e,t)){const i=_(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return Fke.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return Tt(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return Ome(e.clone(),this)}};u([d({readOnly:!0})],Cy.prototype,"demResolution",void 0),u([d({readOnly:!0})],Cy.prototype,"extent",null),u([d({readOnly:!0})],Cy.prototype,"noDataValue",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],Cy.prototype,"spatialReference",void 0),u([d({constructOnly:!0})],Cy.prototype,"view",void 0),Cy=u([P("esri.views.support.GroundViewElevationSampler")],Cy);const Uke=Cy;let Ry=class extends be{constructor(e){super(e),this.handles=new Jt,this.view=null,this.layerViews=new St}initialize(){this.handles.add(Rd(()=>{var e,t;return(e=this.view)==null||(t=e.map)==null?void 0:t.ground},e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new Uke({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>e.watch("updating",()=>this._updateUpdating(),!0)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],Ry.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],Ry.prototype,"updating",null),u([d({constructOnly:!0})],Ry.prototype,"view",void 0),u([d({type:St,readOnly:!0})],Ry.prototype,"layerViews",void 0),u([d({readOnly:!0})],Ry.prototype,"suspended",null),Ry=u([P("esri.views.GroundView")],Ry);const zke=Ry,kke=e=>{let t=class extends e{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:Aoe([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:_(s)?s.event:null,signal:_(s)?s.signal:null,defaultPopupTemplateEnabled:!!_(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(_(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const{results:s,mapPoint:n}=await this.popupHitTest(i),o=s.filter(l=>this._isValidPopupGraphic(l.graphic,r)),a=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(l=>l.graphic),queryArea:n,location:n||a}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),_(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return _(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([P("esri.views.PopupView")],t),t};async function Bke(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,i=await Dce("esri/t9n/basemaps");return i[e]||i[t]}const F9={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Ei("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Ei("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Ei("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Ei("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Ei("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Ei("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Ei("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Ei("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Ei("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Ei("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Ei("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Ei("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Ei("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Ei("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Ei("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Ei("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}},Vke=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),Gke=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function jke(e){return e.layerContainerType==="basemap"?Vke:e.layerContainerType==="operational-layers"?Gke:null}function hq(e){return!(e.type!=="feature"||e.url||!e.source||e.source.type!=="memory")}function Hke(e,t){if(t.restrictedWebMapWriting){const i=jke(t);return!_(i)||i.has(e.type)&&!hq(e)}return!0}function qke(e,t){if(hq(e)){const i=l2("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&ez(e,r)}else e.type==="stream"?ez(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&ez(e,t)}function ez(e,t){"maxScale"in e&&(t.maxScale=PD(e.maxScale)),"minScale"in e&&(t.minScale=PD(e.minScale))}function Wke(e,t){if(qke(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=PD(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(hq(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function TK(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new Y("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(Hke(e,i)){const r={};return e.write(r,i)?r:null}return _(t)&&Wke(e,t=re(t)),t}var O$;let Xke=0;const tz=pe.getLogger("esri.Basemap");let Su=O$=class extends LO(rf){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+Xke++,this.baseLayers=new St,this.referenceLayers=new St;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&tz.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{tz.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var e;const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const i=this.referenceLayers.removeAll();for(const r of i)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(e=this.portalItem)==null||e.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=L({},e)).resourceInfo),e}set baseLayers(e){this._set("baseLayers",ob(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i=ge(L({},i),{layerContainerType:"basemap"}),this.baseLayers.forEach(s=>{const n=TK(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=TK(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&(n.isReference=!0,r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",ob(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Cce(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new O$({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t=L({origin:"web-map"},t)),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=re(i);return r.url&&tf(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&tf(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;qt(e);const r=[];if(t){const s=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;r.push(Bke(n).then(o=>{o&&this.read({title:o},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await import("./layersCreator.6b93d5a6.js"),a=[];if(qt(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=o(this.baseLayers,e.baseMapLayers.filter(p=>!p.isReference),l);a.push(c);const h=o(this.referenceLayers,e.baseMapLayers.filter(p=>p.isReference),l);a.push(h)}await Ka(a)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=ya(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||Hl.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Hl.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=F9[e];if(t){if(t.deprecated){let i=null;e==="dark-gray"?i="dark-gray-vector":e==="gray"?i="gray-vector":e==="streets"?i="streets-vector":e==="topo"&&(i="topo-vector"),w7(tz,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return O$.fromJSON(t)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:St}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],Su.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],Su.prototype,"id",void 0),u([d({type:AL})],Su.prototype,"portalItem",void 0),u([d()],Su.prototype,"referenceLayers",null),u([d({readOnly:!0})],Su.prototype,"resourceInfo",void 0),u([d({type:Ke})],Su.prototype,"spatialReference",void 0),u([d()],Su.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Su.prototype,"title",void 0),u([Xe("title")],Su.prototype,"writeTitle",null),Su=O$=u([P("esri.Basemap")],Su);const ML=Su;var Yke=Object.freeze(Object.defineProperty({__proto__:null,default:ML},Symbol.toStringTag,{value:"Module"}));let Dx=class extends Fd(St){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(Doe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=_(this.getCollections)?this.getCollections():null;if(C(e))return void this.removeAll();let t=0;for(const i of e)_(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new St(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:r=>!!r;for(const r of t)if(r){if(i(r)){const s=this.indexOf(r,e);s>=0?s!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(r);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([d()],Dx.prototype,"getCollections",void 0),u([d()],Dx.prototype,"getChildrenFunction",void 0),u([d()],Dx.prototype,"itemFilterFunction",void 0),Dx=u([P("esri.core.CollectionFlattener")],Dx);const IS=Dx;function Zke(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&e!=null&&(t=e.capabilities)!=null&&t.operations&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const SK=pe.getLogger("esri.support.basemapUtils");function Qke(){return{}}function Jke(e){for(const t in e){const i=e[t];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete e[t]}}function Kke(e,t){var i;let r;if(typeof e=="string"){if(!(e in F9)){const s=Object.entries(F9).filter(([n,o])=>rr.apiKey&&!o.classic||!rr.apiKey&&o.classic&&!o.deprecated).map(([n])=>`"${n}"`).join(", ");return SK.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${s}`),null}t&&(r=t[e]),r||(r=ML.fromId(e),t&&(t[e]=r))}else r=As(ML,e);return(i=r)!=null&&i.destroyed&&(SK.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function e6e(e){return new IS({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return i&&"tables"in i&&i.tables.includes(t)}})}const t6e=pe.getLogger("esri.support.groundUtils"),EK={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function i6e(e){let t=null;if(typeof e=="string")if(e in EK){const i=EK[e];t=new TR({resourceInfo:{data:{layers:[i]}}})}else t6e.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=As(TR,e);return t}function U9(e,t,i){let r,s;if(e)for(let o=0,a=e.length;o<a;o++){var n;if(r=e.getItemAt(o),r[t]===i)return r;if(((n=r)==null?void 0:n.type)==="group"&&(s=U9(r.layers,t,i),s))return s}}const AK=pe.getLogger("esri.support.LayersMixin"),r6e=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new St;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||AK.error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",ob(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof QO){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Jc(i)?i.then(n=>{this.destroyed||this.add(n,r)}):AK.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;r=s.getNextIndex(r),i.slice().forEach(n=>{n.parent!==this?(s.add(n,r),r+=1):this.reorder(n,r)})}findLayerById(i){return U9(this.layers,"id",i)}findLayerByUid(i){return U9(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([d()],t.prototype,"layers",null),t=u([P("esri.support.LayersMixin")],t),t},Lme="esri.support.TablesMixin",s6e=pe.getLogger(Lme);function z9(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const n=e.getItemAt(r);if(n[t]===i)return n;if((n==null?void 0:n.type)==="group"){const o=z9(n.tables,t,i);if(o)return o}}}const n6e=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new St,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&s6e.error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",ob(i,this._get("tables")))}findTableById(i){return z9(this.tables,"id",i)}findTableByUid(i){return z9(this.tables,"uid",i)}};return u([d()],t.prototype,"tables",null),t=u([P(Lme)],t),t};let gp=class extends n6e(r6e(qr.EventedMixin(be))){constructor(e){super(e),this.allLayers=new IS({getCollections:()=>{var t,i,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=e6e(this),this.basemap=null,this.editableLayers=new IS({getCollections:()=>[this.allLayers],itemFilterFunction:Zke}),this.ground=new TR,this._basemapCache=Qke()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),Jke(this._basemapCache),this._basemapCache=null}castBasemap(e){return Kke(e,this._basemapCache)}castGround(e){const t=i6e(e);return C(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],gp.prototype,"allLayers",void 0),u([d({readOnly:!0})],gp.prototype,"allTables",void 0),u([d({type:ML})],gp.prototype,"basemap",void 0),u([Bt("basemap")],gp.prototype,"castBasemap",null),u([d({readOnly:!0})],gp.prototype,"editableLayers",void 0),u([d({type:TR,nonNullable:!0})],gp.prototype,"ground",void 0),u([Bt("ground")],gp.prototype,"castGround",null),gp=u([P("esri.Map")],gp);const Nme=gp;let G1=class extends PC{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([H7({Type:ho,ensureType:As(ho)})],G1.prototype,"itemType",void 0),G1=u([P("esri.support.GraphicsCollection")],G1);let Oy=class extends be{constructor(e){super(e),this.view=null,this.baseLayerViews=new St,this.referenceLayerViews=new St,this._loadingHandle=xe(()=>{var t,i;return(t=this.view)==null||(i=t.map)==null?void 0:i.basemap},t=>{t&&t.load().catch(()=>{})},Bi)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var e,t;if(this.view&&this.view.suspended)return!1;const i=(e=this.view)==null||(t=e.map)==null?void 0:t.basemap;return!!i&&!!i.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([d({constructOnly:!0})],Oy.prototype,"view",void 0),u([d({readOnly:!0})],Oy.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],Oy.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],Oy.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],Oy.prototype,"updating",null),Oy=u([P("esri.views.BasemapView")],Oy);const o6e=pe.getLogger("esri.views.LayerViewManager");class a6e{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=$0(),this._started=!1,this.done=!1,Lo(this._controller.signal,()=>{const s=new Y("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{var s,n;let o,a;if(await i.load({signal:t}),"prefetchResources"in i&&await i.prefetchResources({signal:t}),i.createLayerView)o=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new Y("layer:view-not-supported","No layerview implementation was found");const c=await this.layerViewImporter.importLayerView(i);qt(t),o="default"in c?new c.default({layer:i,view:r}):new c({layer:i,view:r})}const l=()=>{a=mn(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Lo(t,l),qt(t);try{await o.when()}catch(c){throw l(),c}if(!(!((s=this._map)==null||(n=s.allLayers)==null)&&n.includes(i)))return l(),void this._deferred.reject(new Y("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new Y("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}}let Eu=class extends vS{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new jp,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var t;const i=(t=this.view.map)==null?void 0:t.allLayers;if(i)for(const r of i)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(C(this._workPromise)&&(this._workPromise=$0()),this.handles.remove("reschedule"),this.handles.add(IO(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var t,i,r;const s=this.view.map;if(this._map!==s&&(this.clear(),this._map=s),C(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const n=new IS({getCollections:()=>this._rootCollectionNames.map(l=>this.get(l)),getChildrenFunction:l=>l&&"layers"in l?l.layers:null});if(!n)return this._workPromise.resolve(),void(this._workPromise=null);for(const l of n)this._createLayerView(l);this._refreshCollections();for(const[l,c]of this._layerLayerViewInfoMap)n.includes(l)||(this._layerLayerViewInfoMap.delete(c.layer),c.destroy());const o=n.filter(l=>l.type==="group").map(l=>l.layers),a=[s==null||(t=s.ground)==null?void 0:t.layers,s==null||(i=s.basemap)==null?void 0:i.baseLayers,s==null||(r=s.basemap)==null?void 0:r.referenceLayers,s==null?void 0:s.layers,...o].filter(l=>!!l);this.handles.add(a.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([ma(()=>{var e,t;return(e=this.view)==null||(t=e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),xe(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),xs)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return _(this._workPromise)||this._watchUpdatingTracking.updating||Us(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new Y("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=i,t.getItemAt(r)!==o&&t.splice(r,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new a6e(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{var r,s;i&&(Tr(i)||i.name==="cancelled:layerview-create")||o6e.error(`Failed to create layerview for layer title:'${(r=e.title)!=null?r:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],Eu.prototype,"_workPromise",void 0),u([d({readOnly:!0})],Eu.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],Eu.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],Eu.prototype,"_rootCollectionNames",null),u([d()],Eu.prototype,"layerViewImporter",void 0),u([d()],Eu.prototype,"supportsGround",void 0),u([d({readOnly:!0})],Eu.prototype,"updating",null),u([d({readOnly:!0})],Eu.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],Eu.prototype,"view",void 0),Eu=u([P("esri.views.LayerViewManager")],Eu);const l6e=Eu;let dc=class extends be{constructor(e){super(e),this.factor=1.5,this.offset=Ed(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],dc.prototype,"factor",void 0),u([d({nonNullable:!0})],dc.prototype,"offset",void 0),u([d()],dc.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],dc.prototype,"size",void 0),u([d()],dc.prototype,"maskUrl",void 0),u([d()],dc.prototype,"maskEnabled",void 0),u([d()],dc.prototype,"overlayUrl",void 0),u([d()],dc.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],dc.prototype,"version",null),u([d({type:Boolean})],dc.prototype,"visible",void 0),dc=u([P("esri.views.Magnifier")],dc);const Fme=dc;let M$=class extends be{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.push(new CK(r,s,e,t,i)))}unshift(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.unshift(new CK(r,s,e,t,i)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const i=Ts(t.signal);if(i&&!t.abortCallback)t.reject(gi());else{const r=i?t.abortCallback(gi()):t.callback(e);Jc(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(i){t.reject(i)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=gi();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};u([d()],M$.prototype,"running",void 0),M$=u([P("esri.layers.support.PromiseQueue")],M$);class CK{constructor(t,i,r,s,n){this.resolve=t,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}}let JA=class extends be{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],JA.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],JA.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),JA=u([P("esri.views.support.DebugFlags")],JA);const c6e=new JA,u6e=pe.getLogger("esri.views.support.Scheduler");function h6e(e){return new PL.Scheduler({nowFunc:e})}var yt;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(yt||(yt={}));const Mp=0,RK=new Map([[yt.RESOURCE_CONTROLLER,Mp],[yt.SLIDE,Mp],[yt.STREAM_DATA_LOADER,Mp],[yt.ELEVATION_QUERY,Mp],[yt.TERRAIN_SURFACE,1],[yt.SURFACE_GEOMETRY_UPDATES,1],[yt.GRAPHICS_CORE,2],[yt.I3S_CONTROLLER,2],[yt.POINT_CLOUD_LAYER,2],[yt.FEATURE_TILE_FETCHER,2],[yt.OVERLAY,4],[yt.STAGE,4],[yt.GRAPHICS_DECONFLICTOR,4],[yt.FILTER_VISIBILITY,4],[yt.SCALE_VISIBILITY,4],[yt.FRUSTUM_VISIBILITY,4],[yt.POINT_OF_INTEREST_FREQUENT,6],[yt.POINT_OF_INTEREST_INFREQUENT,30],[yt.LABELER,8],[yt.FEATURE_QUERY_ENGINE,8],[yt.FEATURE_TILE_TREE,16],[yt.FEATURE_TILE_TREE_ACTIVE,Mp],[yt.ELEVATION_ALIGNMENT,12],[yt.TEXT_TEXTURE_ATLAS,12],[yt.CLOUDS_GENERATOR,12],[yt.TEXTURE_UNLOAD,12],[yt.LINE_OF_SIGHT_TOOL,16],[yt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Mp],[yt.SNAPPING,Mp],[yt.SHADOW_ACCUMULATOR,30]]);function OK(e){return RK.has(e)?RK.get(e):typeof e=="number"?e:1}var un;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(un||(un={}));const MK=6.5,PK=1,d6e=30,IK=1e3/30,$K=100,DK=.9;var PL,Ev;(function(e){let t=class extends be{constructor(s){super(s),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new w0("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=null,this._state=un.INTERACTING,this._tasks=new Vt,this._runQueue=new Vt,this._load=0,this._idleStateCallbacks=new Vt,this._idleUpdatesStartFired=!1,this._maxReschedule=AP,this._forceTask=!1,this._debug=!1,this._debugHandle=xe(()=>c6e.SCHEDULER_LOG_SLOW_TASKS,a=>this._debug=a,Bi),this._budget=new r(s.nowFunc);for(const a of Object.keys(yt))this.performanceInfo.tasks.set(yt[a],new w0(yt[a]));let n;const o=this;this._test={get state(){return Tt(n,o._state)},set state(a){n=a},FRAME_SAFETY_BUDGET:MK,INTERACTING_BUDGET:IK,IDLE_BUDGET:$K,get budget(){return o._budget.budget},usedBudget:0,setBudget:a=>o._budget=a,updateTask:a=>this._updateTask(a),getState:a=>this._getState(a),getRuntime:a=>this._getRuntime(a),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),mn(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=AP,this._schedule(),this.frame()))}))}registerTask(s,n){const o=OK(s),a=new i(this,s,n,o);return this._tasks.push(a),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new w0(s)),a}registerIdleStateCallbacks(s,n){const o={idleBegin:s,idleEnd:n};this._idleStateCallbacks.push(o),this.state===un.IDLE&&this._idleUpdatesStartFired&&o.idleBegin();const a=this;return{remove:()=>this._removeIdleStateCallbacks(o),set idleBegin(l){a._idleUpdatesStartFired&&(o.idleEnd(),a._state===un.IDLE&&l()),o.idleBegin=l},set idleEnd(l){o.idleEnd=l}}}get now(){return this.nowFunc()}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==un.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(n=>n.idleEnd())))}get state(){return C(this._test.state)?this._state:this._test.state}updateBudget(s){this._test.usedBudget=0;let n=MK,o=s.frameDuration,a=PK;switch(this.state){case un.IDLE:n=0,o=Math.max($K,s.frameDuration),a=d6e;break;case un.INTERACTING:o=Math.max(IK,s.frameDuration);case un.ANIMATING:}return o=o-s.elapsedFrameTime-n,this.state!==un.IDLE&&o<PK&&!this._forceTask?(this._forceTask=!0,!1):(o=Math.max(o,a),this._budget.reset(o,this.state),this._maxReschedule=AP,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case un.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case un.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s)}_updateTask(s){this._tasks.forAll(n=>{n.name===s&&n.setPriority(s)})}_getState(s){if(this._runQueue.some(o=>o.name===s))return Ev.SCHEDULED;let n=Ev.IDLE;return this._tasks.forAll(o=>{o.name===s&&o.needsUpdate&&(o.schedulePriority<=1?n=Ev.READY:n!==Ev.READY&&(n=Ev.WAITING))}),n}_getRuntime(s){let n=0;return this._tasks.forAll(o=>{o.name===s&&(n+=o.runtime)}),n}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(o=>{o.needsUpdate&&s.set(o.name,(s.get(o.name)||0)+1)}),s.size===0)return null;let n="";return s.forEach((o,a)=>{n+=o>1?` ${o}x ${a}`:` ${a}`}),n}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((n,o)=>o.needsUpdate?++n:n,0);this._load=this._load*DK+s*(1-DK)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Mp&&s.needsUpdate&&!this._runQueue.includes(s)&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,n=0;if(this._tasks.forAll(o=>{o.needsUpdate&&o.schedulePriority!==0&&o.basePriority!==Mp&&(s=!0,n=Math.max(n,o.basePriority),o.schedulePriority===1?(o.schedulePriority=0,this._runQueue.push(o)):--o.schedulePriority)}),!s)return this.updating=!1,!1;this._maxReschedule===AP&&(this._maxReschedule=n),--this._maxReschedule}return this.updating=!0,!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)}catch(l){u6e.error(`Exception in task "${o.name}"`,l)}o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",o.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(l=>l.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this.updating=this._tasks.some(n=>n.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(yt))this._frameTaskTimes.set(yt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((n,o)=>this.performanceInfo.tasks.get(o).record(n)),this.performanceInfo.total.record(s)}get test(){return this._test}};u([d()],t.prototype,"updating",void 0),u([d()],t.prototype,"nowFunc",void 0),t=u([P("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends be{constructor(s,n,o,a){super({}),this._scheduler=s,this.name=n,this._basePriority=a,this.runtime=0,this._queue=new M$,this._handles=new Jt,this.schedulePriority=this._basePriority,this.task=_(o)?o:this._queue,this._handles.add(Rd(()=>this.task.running,()=>s.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(P2),this._scheduler.removeTask(this),this.schedule=$S.schedule,this.reschedule=$S.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const n=OK(s);this._basePriority!==Mp&&this.schedulePriority===0||(this.schedulePriority=n),this._basePriority=n}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,n,o){return this._queue.push(s,n,o)}reschedule(s,n,o){return this._queue.unshift(s,n,o)}processQueue(s){this._queue.runTask(s)}};u([d({constructOnly:!0})],i.prototype,"task",void 0),u([d({readOnly:!0})],i.prototype,"updating",null),i=u([P("esri.views.support.SchedulerTask")],i);class r{constructor(n){this.now=n,this._begin=0,this._budget=0,this._state=un.IDLE,this._didWork=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r})(PL||(PL={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(Ev||(Ev={}));const P2=(()=>{const e=new PL.Budget(()=>performance.now());return e.enabled=!1,e})();class p6e{remove(){}processQueue(){}schedule(t,i,r){try{if(Ts(i)){const s=gi();return r?Promise.resolve(r(s)):Promise.reject(s)}return O6(t(P2))}catch(s){return Promise.reject(s)}}reschedule(t,i,r){return this.schedule(t,i,r)}}const $S=new p6e,AP=Number.MAX_SAFE_INTEGER;let lT=class extends be{constructor(e,t){var i;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i=t==null?void 0:t.registerTask(yt.TEXTURE_UNLOAD))!=null?i:$S}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return _(t)?`${e}.${t}px`:e}};u([d()],lT.prototype,"_frameTask",void 0),u([d()],lT.prototype,"updating",null),lT=u([P("esri.views.3d.support.TextureCollection")],lT);var LK;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(LK||(LK={}));const Ume=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],zme={};function kme(e){return!!zme[e]}function f6e(e){for(const t of e)if(!kme(t))return!1;return!0}Ume.forEach(e=>{zme[e]=!0});class m6e{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:i,priority:r},s)=>this.inputManager.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this.handlers.forEach((t,i)=>this.inputManager.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,i,r,s){const n=Array.isArray(t)?t:t.split(",");if(!f6e(n))return n.some(kme)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s!=null?s:A0.DEFAULT;const l=this._createUniqueGroupName(),c=new g6e(this.view,n,a,o);this.handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this.handlerCounts.get(h)||0;this.handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,i){if(this.handlers.has(t)){this.handlers.delete(t);for(const r of i){const s=this.handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this.handlerCounts.delete(r):this.handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class g6e extends fo{constructor(t,i,r,s){super(!0),this.view=t;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:Ed(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(Ed(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this.latestDragStart=i),!this.latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=t,f={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return n==="end"&&(this.latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:el(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:g}=t;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:g,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var UR,NK,FK;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(UR||(UR={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(NK||(NK={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(FK||(FK={}));const y6e=pe.getLogger("esri.views.interactive.interactiveToolUtils");function v6e(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return y6e.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.visible=!1,i.active&&(i.view.activeTool=null),i.destroy()})]}function IL(e){return e.visible&&e.getEditableFlag(UR.USER)&&e.getEditableFlag(UR.MANAGER)}function yp(e){return Ed(e.x,e.y)}function Bme(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return Ed(t.clientX-i.left,t.clientY-i.top)}function UK(e,t){return t instanceof Event?Bme(e,t):yp(t)}function zK(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class _6e{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":kK(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!BK(t))break;const s=yp(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(C(n))break;const o=this._findToolAndManipulatorByKey(n,i.forEachTool,CP),a=Ks(o,c=>c.manipulator),l=Ks(o,c=>c.tool);!(_(a)&&_(l)&&a.interactive)||a.grabbable&&a.grabbableForEvent(t)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,l,t),_(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(t)&&!a.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool!==n.tool&&(this._currentlyActiveTool=i.activeTool,this._revertToActiveTool=!0,i.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!BK(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),o=Ks(s||n,({key:h})=>h),a=this._findManipulatorByKey(o,i.forEachTool);if(C(a))break;const l=yp(t);l.x=He(l.x,0,i.view.width),l.y=He(l.y,0,i.view.height);const c=(s||n).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(a.dragging=!0,n?a.events.emit("drag",{action:"update",start:c,screenPoint:l}):a.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:o,start:c}));break;case"end":a.dragging=!1,n&&a.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=yp(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findToolAndManipulatorByKey(n,i.forEachTool,CP);if(b6e(t)||i.forEachTool(h=>{if((!_(o)||o.tool!==h||h.automaticManipulatorSelection)&&h.manipulators){let p=!1;h.manipulators.forEach(({manipulator:f})=>{f.selected&&(f.selected=!1,p=!0)}),p&&h.manipulatorSelectionChanged&&h.manipulatorSelectionChanged()}}),C(o))break;const{manipulator:a,tool:l}=o;if(!a.interactive)break;a.selectable&&l.automaticManipulatorSelection&&(a.selected=!a.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=t.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:r});break}case"click":{const s=yp(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(C(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{const s=yp(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(C(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=yp(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(C(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}}this._updateCursor(i.forEachTool)}_ungrabManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:yp(r)}),this._grabbedManipulators.forEach(({key:s},n)=>{s.tool===i&&i.manipulators.findById(s.manipulatorId)===t&&this._grabbedManipulators.delete(n)})}_handlePointerEnd(t,i){const r=Ks(this._grabbedManipulators.get(t.pointerId),({key:n})=>n),s=this._findManipulatorByKey(r,i.forEachTool);_(s)&&!s.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(i.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:yp(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,i){let r=null;return Us(t,({key:s})=>{const n=this._findManipulatorByKey(s,i);return!!(_(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(r=n.cursor,!0)}),r}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}clearPointers(t,i,r=!0,s){const n=o=>o.tool===t&&(C(s)||o.manipulatorId===s);this._grabbedManipulators.forEach(({key:o,pointerType:a},l)=>{if(n(o)){this._grabbedManipulators.delete(l);const c=this._findManipulatorByKey(o,i);_(c)&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:a}))}}),this._draggedManipulators.forEach(({key:o},a)=>{if(n(o)){this._draggedManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}}),r&&this._hoveredManipulators.forEach(({key:o},a)=>{if(n(o)){this._hoveredManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.hovering=!1)}}),this._updateCursor(i)}_intersect(t,i,r){let s=null;return r(n=>{if(n.manipulators==null||!IL(n))return!1;const o=n.manipulators.intersect(t,i);return!C(o)&&(s={manipulatorId:o.id,tool:n},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Ed(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!kK(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(yp(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){const n=this._intersect(t,r,s);let o=this._findManipulatorByKey(n,s);const a=Ks(this._hoveredManipulators.get(i),({key:c})=>c),l=this._findManipulatorByKey(a,s);_(o)&&!o.interactive&&(o=null),l!==o&&(_(l)&&(l.hovering=!1),_(o)?(o.hovering=!0,this._hoveredManipulators.set(i,{key:n})):this._hoveredManipulators.delete(i),this._updateCursor(s))}_findManipulatorByKey(t,i){return this._findToolAndManipulatorByKey(t,i,CP)?CP.manipulator:null}_findToolAndManipulatorByKey(t,i,r){return C(t)?null:(r.tool=null,r.manipulator=null,i(s=>{if(s!==t.tool||s.manipulators==null||!IL(s))return!1;const n=s.manipulators.findById(t.manipulatorId);return!!_(n)&&(r.manipulator=n,r.tool=s,!0)}),r.manipulator?r:null)}}function kK(e){return e==="mouse"}function BK(e){return e.pointerType!=="mouse"||e.button===0}function b6e(e){return!!e.native.shiftKey}const CP={manipulator:null,tool:null},VK=pe.getLogger("esri.views.ToolViewManager"),GK="attached",iz="tools";let nm=class extends vS{constructor(e){super(e),this._manipulatorState=new _6e,this.tools=new St,this.cursor=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.handles.add([this.view.on(Ume,e=>{this._handleInputEvent(e)},A0.TOOL),...v6e(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(_(e)&&!this.view.ready)return void VK.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return void(_(e)&&VK.warn("Tool is already active - ignoring activation request."));const t=this.activeTool;this._set("activeTool",e),_(t)&&t.deactivate(),_(e)&&e.activate(),this._removeIncompleteTools(e);const i=C(this.activeTool);for(const r of this.tools){r.setEditableFlag(UR.MANAGER,i||r===this.activeTool);const s=IL(r);!i&&s||this._manipulatorState.clearPointers(r,this._forEachTool,!s)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||(e=(t=this.textures)==null?void 0:t.updating)!=null&&e}attach(){this.view.type==="3d"?(this._set("textures",new lT(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([this.view.state.watch("camera",()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),sh(()=>this._set("textures",ct(this.textures)))],GK)):this.handles.add(this.view.watch("extent",()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){_(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(GK)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i=ge(L({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});_(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:r=>{this.activeTool=r},view:this.view}),!t&&_(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(iz),this._forEachTool(e=>{if(e instanceof be){const t=xe(()=>[e.cursor,e.visible,e.editable],()=>{IL(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,iz)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:i})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,i)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),iz)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let e=this._manipulatorState.cursor;this._forEachTool(t=>!(!_(t.cursor)||!t.visible)&&(e=t.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(t=>(C(e)||t!==e)&&!t.created).forEach(t=>{this.tools.remove(t)})}};u([d({constructOnly:!0,nonNullable:!0})],nm.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],nm.prototype,"textures",void 0),u([d({value:null})],nm.prototype,"activeTool",null),u([d({readOnly:!0,type:St})],nm.prototype,"tools",void 0),u([d({readOnly:!0})],nm.prototype,"cursor",void 0),u([d({readOnly:!0})],nm.prototype,"updating",null),nm=u([P("esri.views.ToolViewManager")],nm);const w6e=nm;let Lx=class extends be{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":x6e.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return T6e[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],Lx.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],Lx.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],Lx.prototype,"axisThreshold",null),Lx=u([P("esri.views.input.gamepad.GamepadInputDevice")],Lx);const x6e=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),T6e={standard:.15,spacemouse:.025,unknown:0},dq=Lx;let KA=class extends be{constructor(...e){super(...e),this.devices=new St,this.enabledFocusMode="document"}};u([d({type:St.ofType(dq),readOnly:!0})],KA.prototype,"devices",void 0),u([d({type:["document","view","none"]})],KA.prototype,"enabledFocusMode",void 0),KA=u([P("esri.views.input.gamepad.GamepadSettings")],KA);const S6e=KA;let P$=class extends be{constructor(){super(...arguments),this.gamepad=new S6e}};u([d({readOnly:!0})],P$.prototype,"gamepad",void 0),P$=u([P("esri.views.input.Input")],P$);const E6e=P$;let My=class extends be{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],My.prototype,"enabled",void 0),u([d({type:dq})],My.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],My.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],My.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],My.prototype,"velocityFactor",void 0),My=u([P("esri.views.navigation.gamepad.GamepadSettings")],My);const Vme=My;let I_=class extends be{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Vme,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],I_.prototype,"browserTouchPanEnabled",void 0),u([d({type:Vme,nonNullable:!0})],I_.prototype,"gamepad",void 0),u([d({type:Boolean})],I_.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],I_.prototype,"mouseWheelZoomEnabled",void 0),I_=u([P("esri.views.navigation.Navigation")],I_);const Gme=I_;function A6e(e,t,i){const r=jme(e),s=t,n=C6e(r,s,i);if(r){const o=qb.deriveUnitFromSR(r,e.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new Y("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new Y("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!R6e(e)||n===Cl.Unsupported)return new Y("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Cl.Units:{const o=r.heightUnit||"unknown",a=s.heightUnit||"unknown",l=new Y("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new Y("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Cl.HeightModel:{const o=r.heightModel||"unknown",a=s.heightModel||"unknown",l=new Y("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new Y("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Cl.CRS:{const o=r.vertCRS||"unknown",a=s.vertCRS||"unknown",l=new Y("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new Y("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function C6e(e,t,i){if(!jK(e)||!jK(t))return Cl.Unsupported;if(e==null||t==null)return Cl.Ok;if(!i&&e.heightUnit!==t.heightUnit)return Cl.Units;if(e.heightModel!==t.heightModel)return Cl.HeightModel;switch(e.heightModel){case"gravity-related-height":return Cl.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?Cl.Ok:Cl.CRS;default:return Cl.Unsupported}}var Cl;function jK(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function R6e(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!Wme(e)}function jme(e){const t=e.url&&JO(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&_(t)&&t.serverType==="ImageServer")&&Hme(e)&&e.heightModelInfo?e.heightModelInfo:Wme(e)?qb.deriveUnitFromSR(O6e,e.spatialReference):null}function Hme(e){return"heightModelInfo"in e}function qme(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function Wme(e){return qme(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):Yme(e)}function Xme(e){return e.layers!=null||Yme(e)||qme(e)||Hme(e)}function Yme(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"analysis":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(Cl||(Cl={}));const O6e=new qb({heightModel:"gravity-related-height"});var je;function HK(e){return e==="global"?je.Global:je.Local}function rz(e){return e===je.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(je||(je={}));let k9,sz=null;async function M6e(e){sz||(sz=Promise.resolve().then(function(){return ert}).then(t=>k9=t)),await sz,qt(e)}async function Zme(e,t,i,r){if(!e)return null;const s=e.spatialReference;return uue()||wS(s,t)?BO(e,t):k9?k9.projectGeometry(e,t,i,r):(await Promise.race([M6e(r),OV(r)]),Zme(e,t,i,r))}let _r=class extends be{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=rh(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return _(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return C(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var e,t,i,r;const s=(e=this.map)==null?void 0:e.call(this),n=[];return _(this.priorityCollection)&&n.push(this.priorityCollection),n.push({parent:s==null?void 0:s.basemap,layers:s==null||(t=s.basemap)==null?void 0:t.baseLayers},{layers:s==null?void 0:s.layers},{parent:s==null?void 0:s.ground,layers:s==null||(i=s.ground)==null?void 0:i.layers},{parent:s==null?void 0:s.basemap,layers:s==null||(r=s.basemap)==null?void 0:r.referenceLayers}),n}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var e;if(this.suspended)return(e=this._get("_spatialReferenceTask"))!=null?e:{updating:!1};const{layers:t,updating:i}=this._allLayers;let r=null;for(const n of t){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);_(a)&&(r=a)}if(_(r)&&r.length===1)break}if(i&&(C(r)||r.length!==1))return{updating:!0};const s=this._pickSpatialReferenceCandidate(r);return{spatialReference:_(s)?s.spatialReference:null,viewingMode:_(s)?s.viewingMode:null,updating:!1}}get _tileInfoTask(){var e,t,i,r,s,n,o,a;if(!this.required.tileInfo)return(a=this._get("_tileInfoTask"))!=null?a:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:l,updating:c}=this._collectLayers([{parent:(e=this.map)==null||(t=e.call(this))==null?void 0:t.basemap,layers:(i=this.map)==null||(r=i.call(this))==null||(s=r.basemap)==null?void 0:s.baseLayers},{layers:(n=this.map)==null||(o=n.call(this))==null?void 0:o.layers}]);if(l&&l.length>0&&"tileInfo"in l[0]){const h=l[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:c}}get _heightModelInfoTask(){var e,t;if(!this.required.heightModelInfo||this.suspended&&(e=this._get("_heightModelInfoTask"))!=null&&e.heightModelInfo)return(t=this._get("_heightModelInfoTask"))!=null?t:{updating:!1};const{layers:i,updating:r}=this._allLayers;for(const o of i)if(Xme(o)){const a=jme(o);var s,n;if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){var e;if(this.suspended||!this.required.extent)return(e=this._get("_extentCandidatesTask"))!=null?e:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const t=this._allLayers,i=t.updating,r=[];for(const n of t.layers){var s;const o="fullExtents"in n&&n.fullExtents||(_(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)r.push({extent:c,layer:n})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(C(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:_(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(_(this._projectExtentTask.task)&&(this._projectExtentTask.task=rh(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:PO(async s=>{try{const n=await Zme(i.extent,r,i.layer.portalItem,s);this._projectExtentTask=ge(L({},this._projectExtentTask),{task:null,output:n})}catch{if(Ts(s))return;this._projectExtentTask=ge(L({},this._projectExtentTask),{task:null})}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(C(e))return t;const i=[],r=(s,n)=>_(s)?_(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=r(s.viewingMode,n.viewingMode);if(o!==!1){i.push({spatialReference:s.spatialReference,viewingMode:o});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return C(e)||e.length<1?_(t)?{spatialReference:t,viewingMode:null}:null:(_(t)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==je.Local)&&(e=e.filter(({viewingMode:i})=>i!==je.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const r of t){const s=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(_(s)){const n=_(s.constraints)?s.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||C(this.userSpatialReference)||o.equals(this.userSpatialReference))&&i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){var t;if(this._loadMaybe((t=this.map)==null?void 0:t.call(this))!=="loaded")return{layers:[],updating:!0};const i={layers:[],preloading:-1,updating:!1};for(const r of e)if(this._collectCollection(r,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load(),"loading"):e.loadStatus:"loaded"}};u([d()],_r.prototype,"required",void 0),u([d({constructOnly:!0})],_r.prototype,"map",void 0),u([d({constructOnly:!0})],_r.prototype,"getSpatialReferenceSupport",void 0),u([d()],_r.prototype,"defaultSpatialReference",void 0),u([d()],_r.prototype,"userSpatialReference",void 0),u([d()],_r.prototype,"sourcePreloadCount",void 0),u([d()],_r.prototype,"priorityCollection",void 0),u([d()],_r.prototype,"requiresExtentInSpatialReference",void 0),u([d()],_r.prototype,"suspended",void 0),u([d({readOnly:!0})],_r.prototype,"ready",null),u([d({readOnly:!0})],_r.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],_r.prototype,"spatialReference",null),u([d({readOnly:!0})],_r.prototype,"extent",null),u([d({readOnly:!0})],_r.prototype,"heightModelInfo",null),u([d({readOnly:!0})],_r.prototype,"vcsWkid",null),u([d({readOnly:!0})],_r.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],_r.prototype,"viewingMode",null),u([d({readOnly:!0})],_r.prototype,"tileInfo",null),u([d({readOnly:!0})],_r.prototype,"mapCollections",null),u([d({readOnly:!0})],_r.prototype,"_allLayers",null),u([d({readOnly:!0})],_r.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],_r.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],_r.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],_r.prototype,"_extentCandidatesTask",null),u([d()],_r.prototype,"_extentTask",null),u([d()],_r.prototype,"_projectExtentTask",void 0),_r=u([P("esri.views.support.DefaultsFromMap")],_r);var I$;const RP=pe.getLogger("esri.views.View");let It=I$=class extends Fd(qr.EventedMixin(v2(be))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new IS({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new G1,this.analyses=new AS,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new St,this.magnifier=new Fme,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new E6e,this.navigation=new Gme,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new m6e(this),this.persistableViewModels=new St,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",t=>{var i,r;t?(this._currentSpatialReference=this.spatialReference,I$.views.add(this)):(this._currentSpatialReference=null,I$.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((i=this.layerViewManager)==null||i.clear(),(r=this.toolViewManager)==null||r.detach(),_(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(_(this.analysisViewManager)&&this.analysisViewManager.attach(),this._startup(),this.toolViewManager.attach())},!0))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,ab(()=>this.ready)))),this.basemapView=new Oy({view:this}),this.layerViewManager=new l6e({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new w6e({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([xe(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=ge(L({},this.defaultsFromMap.required),{extent:e}),{sync:!0,initial:!0}),xe(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),xe(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([xe(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(t&&!this.spatialReference&&r){if(_(e))return;const s=sh(()=>e=rh(e));e=PO(async n=>{try{await iS(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}RP.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=ct(this.graphics),this.analyses=ct(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager=ct(this.toolViewManager),this.layerViewManager=ct(this.layerViewManager),this.basemapView=ct(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return RP.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new _r(L({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e)},this._defaultsFromMapSettings))}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||rf.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!(this._currentSpatialReference||(e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){var t;e!==this._get("map")&&((t=e)!=null&&t.destroyed&&(RP.warn("#map","The provided map is already destroyed",{map:e}),e=null),rf.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var e,t;let i=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return i&&(e=this.defaultsFromMap)!=null&&(t=e.required)!=null&&t.heightModelInfo&&(i=i.clone(),i.vcsWkid=this.defaultsFromMap.vcsWkid,i.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),i}set spatialReference(e){const t=!Kc(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return _(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,i;return(e=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(i=this.defaultsFromMap)==null?void 0:i.heightModelInfo)!=null?e:null}importLayerView(e){throw new Y("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return _(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&RP.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(Rd(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};It.views=new St,u([d()],It.prototype,"_userSpatialReference",void 0),u([xt("toolViewManager.activeTool")],It.prototype,"activeTool",void 0),u([d({readOnly:!0})],It.prototype,"allLayerViews",void 0),u([d()],It.prototype,"groundView",void 0),u([d()],It.prototype,"animation",void 0),u([d()],It.prototype,"basemapView",void 0),u([d({readOnly:!0})],It.prototype,"_defaultsFromMapSettings",null),u([d()],It.prototype,"defaultsFromMap",null),u([d()],It.prototype,"fatalError",void 0),u([d({type:ni})],It.prototype,"extent",void 0),u([d(HD(G1,"graphics"))],It.prototype,"graphics",void 0),u([d(HD(AS,"analyses"))],It.prototype,"analyses",void 0),u([d({readOnly:!0,type:qb})],It.prototype,"heightModelInfo",null),u([d({readOnly:!0})],It.prototype,"interacting",null),u([d({readOnly:!0})],It.prototype,"navigating",void 0),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],It.prototype,"preconditionsReady",null),u([d({readOnly:!0})],It.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:St,readOnly:!0})],It.prototype,"layerViews",void 0),u([d({type:Fme})],It.prototype,"magnifier",void 0),u([d({value:null,type:Nme})],It.prototype,"map",null),u([d()],It.prototype,"padding",void 0),u([d({readOnly:!0})],It.prototype,"ready",void 0),u([d({type:Ke})],It.prototype,"spatialReference",null),u([d()],It.prototype,"spatialReferenceWarningDelay",void 0),u([d()],It.prototype,"stationary",null),u([d({readOnly:!0})],It.prototype,"supportsGround",void 0),u([d({type:_f})],It.prototype,"timeExtent",void 0),u([xt("toolViewManager.tools")],It.prototype,"tools",void 0),u([d()],It.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],It.prototype,"type",void 0),u([d({type:Number})],It.prototype,"scale",void 0),u([d({readOnly:!0})],It.prototype,"updating",void 0),u([d({readOnly:!0})],It.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],It.prototype,"initialExtent",null),u([d()],It.prototype,"cursor",null),u([d({readOnly:!0})],It.prototype,"input",void 0),u([d({type:Gme,nonNullable:!0})],It.prototype,"navigation",void 0),u([d()],It.prototype,"layerViewManager",void 0),u([d()],It.prototype,"analysisViewManager",void 0),u([d()],It.prototype,"width",void 0),u([d()],It.prototype,"height",void 0),u([d({readOnly:!0})],It.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],It.prototype,"size",null),u([d({readOnly:!0})],It.prototype,"suspended",void 0),u([d({readOnly:!0})],It.prototype,"viewEvents",void 0),u([d({readOnly:!0})],It.prototype,"persistableViewModels",void 0),u([d()],It.prototype,"_isValid",void 0),u([d()],It.prototype,"_readyCycleForced",void 0),u([d()],It.prototype,"_currentSpatialReference",void 0),It=I$=u([P("esri.views.View")],It);const P6e=It;let Py=class extends GD{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new Y("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=Jc(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],Py.prototype,"done",null),u([d({readOnly:!0,type:String})],Py.prototype,"state",void 0),u([d()],Py.prototype,"target",void 0),Py=u([P("esri.views.ViewAnimation")],Py),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(Py||(Py={}));const DS=Py,pE=()=>import("./TileLayerView3D.517d115c.js"),qK=()=>Promise.resolve().then(function(){return _st}),WK={analysis:()=>import("./AnalysisLayerView3D.baff93c8.js"),"base-dynamic":()=>import("./BaseDynamicLayerView3D.89a54050.js"),"base-elevation":qK,"base-tile":pE,"bing-maps":pE,"building-scene":()=>import("./BuildingSceneLayerView3D.14ecb41f.js"),csv:()=>import("./CSVLayerView3D.7767f3a9.js"),elevation:qK,feature:()=>import("./FeatureLayerView3D.2b5a093f.js"),geojson:()=>import("./GeoJSONLayerView3D.c1134c42.js"),graphics:()=>import("./GraphicsLayerView3D.7b98d645.js"),group:()=>import("./GroupLayerView.54d1920d.js"),imagery:()=>import("./ImageryLayerView3D.4b60f91a.js"),"integrated-mesh":()=>import("./IntegratedMeshLayerView3D.0c0528a4.js"),"map-image":()=>import("./MapImageLayerView3D.9a159a8f.js"),"ogc-feature":()=>import("./OGCFeatureLayerView3D.1c9084eb.js"),"open-street-map":pE,"point-cloud":()=>import("./PointCloudLayerView3D.4d1b51f7.js").then(function(e){return e.P}),voxel:()=>import("./VoxelLayerView3D.ade216d1.js"),route:()=>import("./RouteLayerView3D.74685af9.js"),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?import("./SceneLayerView3D.d5738fb3.js"):import("./SceneLayerGraphicsView3D.5b4387aa.js"),stream:()=>import("./StreamLayerView3D.09ab7ad3.js"),tile:pE,"imagery-tile":()=>import("./ImageryTileLayerView3D.74409a89.js"),"vector-tile":()=>import("./VectorTileLayerView3D.cc882a80.js"),wcs:()=>import("./ImageryTileLayerView3D.74409a89.js"),"web-tile":pE,wfs:()=>import("./WFSLayerView3D.5f8c8d89.js"),wms:()=>import("./WMSLayerView3D.a87ae9f4.js"),wmts:()=>import("./WMTSLayerView3D.ce3bd0bc.js"),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,"georeferenced-image":null};function I6e(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Y(`${i}:view-not-supported`,`${t} is not supported in 3D`)}const XK={hasLayerViewModule:e=>_(WK[e.type]),importLayerView:e=>{const t=WK[e.type];if(C(t))throw I6e(e);return t(e)}},$6e=pe.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),YK="analyses-owner-handles";var cT,n1;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(cT||(cT={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(n1||(n1={}));let $_=class extends Fd(be){constructor(e){super(e),this._allAnalysisViews=new St,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._analysisModules={"area-measurement":{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this.detach()}attach(){this.handles.add(this._connectOwner(this.view),YK)}detach(){this.handles.remove(YK),this._update(),this._creatingViewCount=0}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}whenAnalysisView(e){const t=this._items.get(e);if(C(t)||t.state.list===n1.REMOVED){const i=new Y("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return Promise.reject(i)}return t.createAnalysisViewTask.promise}_connectOwner(e){return this._connectAnalysesCollection(e.analyses)}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return{remove:()=>{t.remove(),i.remove();for(const r of e)this._removeAnalysis(r)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const i={state:{view:cT.PENDING,list:n1.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=PO(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=n1.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=n1.REMOVED,this._scheduleUpdate()):$6e.error("Trying to remove analysis which was not added")}_scheduleUpdate(){_(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=IO(()=>this._update()))}_update(){this._scheduledUpdateHandle=mn(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===n1.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case cT.PENDING:e.createAnalysisViewTask=rh(e.createAnalysisViewTask);break;case cT.CREATED:_(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=ct(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,C(s.module))try{if(r==="dimensioning")throw new Error("dimensioning-view-3d-not-yet-implemented");s.module=await this._loadAnalysisModule(r)}catch(o){throw this._creatingViewCount-=1,o}if(Ts(t))throw this._creatingViewCount-=1,gi("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(Ts(t))throw this._creatingViewCount-=1,n.destroy(),gi("AnalysisView creation aborted");return e.view=n,e.state.view=cT.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return import("./AreaMeasurementAnalysisView3D.cf55f166.js").then(function(t){return t.A});case"direct-line-measurement":return import("./DirectLineMeasurementAnalysisView3D.65987d13.js").then(function(t){return t.D});case"line-of-sight":return import("./LineOfSightAnalysisView3D.4ced6de8.js");case"slice":return import("./SliceAnalysisView3D.9033fdfa.js").then(function(t){return t.S});default:return null}}};u([d()],$_.prototype,"updating",null),u([d({constructOnly:!0})],$_.prototype,"view",void 0),u([d()],$_.prototype,"_allAnalysisViews",void 0),u([d()],$_.prototype,"_creatingViewCount",void 0),$_=u([P("esri.views.3d.analysis.AnalysisViewManager3D")],$_);const D6e=$_;function gb(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function L6e(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return se(e,i,r,s),e}function Amt(e,t,i){i=i||e;const r=Se(e,t);se(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),Te(i,i)}function Cmt(e,t,i){Math.abs(e[0])>Math.abs(e[1])?se(t,0,1,0):se(t,1,0,0),_t(i,e,t),Te(t,t),_t(t,i,e),Te(i,i)}function OP(e,t,i,r,s,n){const o=e+(t-e)*s;return o+(i+(r-i)*s-o)*n}function N6e(e,t,i,r=M()){const s=Ie(e),n=Ie(t),o=Se(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return oe(x1,e,c),oe(T1,t,h),fe(r,x1,T1)}return Cs(r,e,t,i)}function Rmt(e,t,i,r=M(),s=M()){const n=Ie(e),o=Ie(t),a=Se(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const g=f/c,y=g/o*h;oe(x1,e,g/n*p),oe(T1,t,y),fe(r,x1,T1)}{const g=1/n*(-Math.cos((1-i)*l)*l*f+p*(-n+o));oe(x1,e,g);const y=1/o*(Math.cos(i*l)*l*f+h*(-n+o));oe(T1,t,y),fe(s,x1,T1),oe(s,s,1/c)}return s}return Cs(r,e,t,i),de(s,t,e),Te(s,s),s}function nz(e,t,i){e=Te(x1,e),t=Te(T1,t);const r=Hs(Se(e,t));if(i){const s=_t(F6e,e,t);if(Se(s,i)<0)return-r}return r}function $$(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],o=(n-i)/(n-s);return o*e[r-1][1]+(1-o)*e[r][1]}}function Omt(e,t,i,r){de(ZK,t,e),de(QK,i,e),_t(r,ZK,QK),Te(r,r),r[3]=-Se(e,r)}const ZK=M(),QK=M(),F6e=M(),x1=M(),T1=M(),U6e=pe.getLogger("esri.views.3d.state.Constraints");let om=class extends be{constructor(e){super(e),this.collision=new eC,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===je.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==je.Local?this._set("altitude",e):U6e.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?He(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return He(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===je.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=oz)=>(i.min=io.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?$$([[4e3,io.max],[1e4,$t(88)],[6e6,$t(88)]]):()=>io.max;return(t,i=oz)=>(i.min=io.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?$$([[4e3,io.max],[5e4,$t(88)],[6e6,$t(88)],[2e7,io.min]]):$$([[3e5,io.max],[3e6,$t(88)],[6e6,$t(88)],[2e7,io.min]]);return(t,i=oz)=>(i.min=io.min,i.max=e(t),i)}};function z6e(e){return{min:-2e5,max:4*e.radius}}u([d()],om.prototype,"altitude",null),u([d({readOnly:!0})],om.prototype,"collision",void 0),u([d()],om.prototype,"distance",void 0),u([d({readOnly:!0})],om.prototype,"minimumPoiDistance",void 0),u([d()],om.prototype,"tilt",void 0),u([d({constructOnly:!0})],om.prototype,"mode",void 0),om=u([P("esri.views.3d.state.Constraints")],om);const JK=z6e(ai),io={min:$t(.5),max:$t(179.5)},oz={min:0,max:0};let eC=class extends be{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],eC.prototype,"enabled",void 0),u([d({type:Number})],eC.prototype,"elevationMargin",void 0),eC=u([P("esri.views.3d.state.Constraints.CollisionConstraint")],eC);let uT=class extends be{constructor(){super(...arguments),this.min=JK.min,this.max=JK.max}};u([d({type:Number})],uT.prototype,"min",void 0),u([d({type:Number})],uT.prototype,"max",void 0),uT=u([P("esri.views.3d.constraints.AltitudeConstraint")],uT);let Tm=class extends be{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],Tm.prototype,"near",null),u([Bt("near")],Tm.prototype,"castNear",null),u([d({type:Number,value:1e-8})],Tm.prototype,"far",null),u([Bt("far")],Tm.prototype,"castFar",null),u([d({type:["auto","manual"]})],Tm.prototype,"mode",void 0),Tm=u([P("esri.views.3d.constraints.ClipDistanceConstraint")],Tm);const B9={min:el(io.min),max:el(io.max)};let o1=class extends be{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return He(e,B9.min,B9.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],o1.prototype,"mode",void 0),u([d({type:Number,value:B9.max})],o1.prototype,"max",null),u([Bt("max")],o1.prototype,"castMax",null),o1=u([P("esri.views.3d.constraints.TiltConstraint")],o1);let a1=class extends be{constructor(){super(...arguments),this.tilt=new o1,this.altitude=new uT,this.clipDistance=new Tm}};u([d({type:o1})],a1.prototype,"tilt",void 0),u([d({type:uT})],a1.prototype,"altitude",void 0),u([d({type:Tm})],a1.prototype,"clipDistance",void 0),a1=u([P("esri.views.3d.constraints.Constraints")],a1);var V9;let Gh=V9=class extends _e{constructor(e){super(e),this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new V9(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Gh.prototype,"date",void 0),u([Ne("date",["datetime"])],Gh.prototype,"readDate",null),u([Xe("date")],Gh.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Gh.prototype,"directShadowsEnabled",void 0),u([Ne("directShadowsEnabled",["directShadows"])],Gh.prototype,"readDirectShadowsEnabled",null),u([Xe("directShadowsEnabled")],Gh.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Gh.prototype,"displayUTCOffset",void 0),u([Xe("displayUTCOffset")],Gh.prototype,"writeDisplayUTCOffset",null),Gh=V9=u([P("esri.webscene.Lighting")],Gh);const LS=Gh;var Nx;let jh=Nx=class extends qr.EventedMixin(LS){constructor(e){super(e),this.type="sun",this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new Nx(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=Nx.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=Nx.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(az.target=this,az.timezoneOffset=s,this.emit("timezone-will-change",az)),e!=null)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new Nx(ge(L({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};u([d({readOnly:!0})],jh.prototype,"type",void 0),u([d({type:Boolean})],jh.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],jh.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],jh.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],jh.prototype,"defaultDate",null),u([d({type:Date})],jh.prototype,"date",null),jh=Nx=u([P("esri.views.3d.environment.SunLighting")],jh),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(jh||(jh={}));const az={target:null,timezoneOffset:0},D_=jh;var G9;let Fx=G9=class extends qr.EventedMixin(LS){constructor(e){super(e),this.type="virtual",this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new G9(ge(L({},this.cloneConstructProperties()),{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}))}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};u([d({readOnly:!0})],Fx.prototype,"type",void 0),u([d({type:Boolean})],Fx.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],Fx.prototype,"waterReflectionEnabled",void 0),Fx=G9=u([P("esri.views.3d.environment.VirtualLighting")],Fx);const Qme=Fx,k6e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:D_,virtual:Qme}};var j9;let HC=j9=class extends be{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new j9({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],HC.prototype,"quality",null),HC=j9=u([P("esri.views.3d.environment.SceneViewAtmosphere")],HC);var H9;let tC=H9=class extends _e{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new H9({cloudCover:this.cloudCover})}};u([vt({sunny:"sunny"})],tC.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1}})],tC.prototype,"cloudCover",void 0),tC=H9=u([P("esri.views.3d.environment.SunnyWeather")],tC);const Jme=tC;var q9;let iC=q9=class extends _e{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new q9({cloudCover:this.cloudCover})}};u([vt({cloudy:"cloudy"})],iC.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1}})],iC.prototype,"cloudCover",void 0),iC=q9=u([P("esri.views.3d.environment.CloudyWeather")],iC);const B6e=iC;var W9;let rC=W9=class extends _e{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new W9({fogStrength:this.fogStrength})}};u([vt({foggy:"foggy"})],rC.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1}})],rC.prototype,"fogStrength",void 0),rC=W9=u([P("esri.views.3d.environment.FoggyWeather")],rC);const V6e=rC;var X9;let Ux=X9=class extends _e{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new X9({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([vt({rainy:"rainy"})],Ux.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1}})],Ux.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1}})],Ux.prototype,"precipitation",void 0),Ux=X9=u([P("esri.views.3d.environment.RainyWeather")],Ux);const G6e=Ux;var Y9;let zx=Y9=class extends be{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Y9({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([vt({snowy:"snowy"})],zx.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1}})],zx.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1}})],zx.prototype,"precipitation",void 0),zx=Y9=u([P("esri.views.3d.environment.SnowyWeather")],zx);const j6e=zx,Kme={key:"type",base:null,typeMap:{sunny:Jme,cloudy:B6e,rainy:G6e,snowy:j6e,foggy:V6e}},H6e=Object.keys(Kme.typeMap);function q6e(e,t){return!!H6e.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const Fu=1e4;let D$=class extends _e{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],D$.prototype,"type",void 0),D$=u([P("esri.webscene.background.Background")],D$);const ege=D$;var Z9;const W6e=ge(L({},pg),{nonNullable:!0});let sC=Z9=class extends ege{constructor(e){super(e),this.type="color",this.color=new rt([0,0,0,1])}clone(){return new Z9(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([vt({color:"color"},{readOnly:!0})],sC.prototype,"type",void 0),u([d(W6e)],sC.prototype,"color",void 0),sC=Z9=u([P("esri.webscene.background.ColorBackground")],sC);const tge=sC,KK={base:ege,key:"type",typeMap:{color:tge}};function X6e(e){return(t,i,r)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,r),n}}}const Y6e={types:KK,json:{read:X6e(KK),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var Q9;const eee=(e,t,i)=>({enabled:!i||!i.isPresentation});let L_=Q9=class extends _e{constructor(e){super(e),this.lighting=new LS,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}clone(){return new Q9(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:LS.prototype.clone.call(this.lighting),background:re(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}}};u([d({type:LS,json:{write:!0}})],L_.prototype,"lighting",void 0),u([d(Y6e)],L_.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:eee}}})],L_.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:eee}}})],L_.prototype,"starsEnabled",void 0),L_=Q9=u([P("esri.webscene.Environment")],L_);const ige=L_;var nC;const Z6e=pe.getLogger("esri.views.3d.environment.SceneViewEnvironment");let N_=nC=class extends ige{constructor(e){super(e),this.atmosphere=new HC,this.lighting=new D_}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new nC(ge(L({},t),{lighting:D_.fromWebsceneLighting(t.lighting)}))}set weather(e){q6e(e==null?void 0:e.type,Z6e)&&this._set("weather",e)}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof D_||e instanceof Qme?e:e instanceof LS?((t=this.lighting)==null?void 0:t.type)==="sun"?this.lighting.cloneWithWebsceneLighting(e):D_.fromWebsceneLighting(e):xd(k6e,e):new D_;var t}clone(){return new nC({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background)})}cloneWithWebsceneEnvironment(e){return new nC(ge(L({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background)},e.cloneConstructProperties()),{lighting:this.lighting.type&&this.lighting.type!=="sun"?D_.fromWebsceneLighting(e.lighting):this.lighting.cloneWithWebsceneLighting(e.lighting)}))}};u([d({type:HC,json:{read:!1},nonNullable:!0})],N_.prototype,"atmosphere",void 0),u([d({types:Kme,nonNullable:!0,json:{write:!1},value:new Jme})],N_.prototype,"weather",null),u([d({nonNullable:!0})],N_.prototype,"lighting",void 0),u([Bt("lighting")],N_.prototype,"castLighting",null),N_=nC=u([P("esri.views.3d.environment.SceneViewEnvironment")],N_);const kx=N_;function Bn(e,t){return e[0]=t[0],e[1]=t[1],e}function Li(e,t,i){return e[0]=t,e[1]=i,e}function id(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function Up(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function rge(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function sge(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function Q6e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function J6e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function K6e(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function eBe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function tBe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Fl(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function iBe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function NT(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function $L(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function pq(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function nge(e){const t=e[0],i=e[1];return t*t+i*i}function fq(e,t){return e[0]=-t[0],e[1]=-t[1],e}function rBe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function zR(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function Ls(e,t){return e[0]*t[0]+e[1]*t[1]}function sBe(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function Bx(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function nBe(e,t){t=t||1;const i=2*cd()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function J9(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function F_(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function oBe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function aBe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function lBe(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function cBe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function uBe(e){return"vec2("+e[0]+", "+e[1]+")"}function oge(e,t){return e[0]===t[0]&&e[1]===t[1]}function hBe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];return Math.abs(i-s)<=Rt*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=Rt*Math.max(1,Math.abs(r),Math.abs(n))}function dBe(e,t,i,r,s){let n=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const pBe=pq,fBe=Up,mBe=rge,gBe=sge,age=NT,yBe=$L,vBe=nge;Object.freeze(Object.defineProperty({__proto__:null,copy:Bn,set:Li,add:id,subtract:Up,multiply:rge,divide:sge,ceil:Q6e,floor:J6e,min:K6e,max:eBe,round:tBe,scale:Fl,scaleAndAdd:iBe,distance:NT,squaredDistance:$L,length:pq,squaredLength:nge,negate:fq,inverse:rBe,normalize:zR,dot:Ls,cross:sBe,lerp:Bx,random:nBe,transformMat2:J9,transformMat2d:F_,transformMat3:oBe,transformMat4:aBe,rotate:lBe,angle:cBe,str:uBe,exactEquals:oge,equals:hBe,projectAndScale:dBe,len:pBe,sub:fBe,mul:mBe,div:gBe,dist:age,sqrDist:yBe,sqrLen:vBe},Symbol.toStringTag,{value:"Module"}));function lge(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const K9=1e4,gw=Le(5802e-9,13558e-9,331e-7),lz=3,cz=Le(65e-8*lz,1881e-9*lz,85e-9*lz),_Be=3996e-9,bBe=.085,L$=1e5;class qs{}function T(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}(function(e){function t(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}e.int=t,e.float=i})(T||(T={}));var A;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(A||(A={}));var Gs;function jm(e,t){switch(t.textureCoordinateType){case Gs.Default:return e.attributes.add(A.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Gs.Atlas:return e.attributes.add(A.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(A.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case Gs.None:return void e.vertex.code.add(T`void forwardTextureCoordinates() {}`);default:t.textureCoordinateType;case Gs.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(Gs||(Gs={}));function mh(e){e.code.add(T`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Zc(e){e.include(mh),e.code.add(T`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function KF(e){e.fragment.code.add(T`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var F;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(F||(F={}));class eu{constructor(t,i,r,s,n=null){this.name=t,this.type=i,this.arraySize=n,this.bind={[F.Pass]:null,[F.Draw]:null},this.bind[r]=s}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class Ft extends eu{constructor(t,i,r){switch(i){case F.Pass:return void super(t,"vec2",i,(s,n,o)=>s.setUniform2fv(t,r(n,o)));case F.Draw:return void super(t,"vec2",i,(s,n,o)=>s.setUniform2fv(t,r(n,o)));default:super(t,"vec2")}}}class ke extends eu{constructor(t,i,r){switch(i){case F.Pass:return void super(t,"vec3",i,(s,n,o)=>s.setUniform3fv(t,r(n,o)));case F.Draw:return void super(t,"vec3",i,(s,n,o)=>s.setUniform3fv(t,r(n,o)));default:super(t,"vec3")}}}class dt extends eu{constructor(t,i,r){switch(i){case F.Pass:return void super(t,"vec4",i,(s,n,o)=>s.setUniform4fv(t,r(n,o)));case F.Draw:return void super(t,"vec4",i,(s,n,o)=>s.setUniform4fv(t,r(n,o)));default:super(t,"vec4")}}}class ye extends eu{constructor(t,i,r){switch(i){case F.Pass:return void super(t,"float",i,(s,n,o)=>s.setUniform1f(t,r(n,o)));case F.Draw:return void super(t,"float",i,(s,n,o)=>s.setUniform1f(t,r(n,o)));default:super(t,"float")}}}class li extends eu{constructor(t,i,r){switch(i){case F.Pass:return void super(t,"mat4",i,(s,n,o)=>s.setUniformMatrix4fv(t,r(n,o)));case F.Draw:return void super(t,"mat4",i,(s,n,o)=>s.setUniformMatrix4fv(t,r(n,o)));default:super(t,"mat4")}}}const wBe=pe.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class cge{constructor(){this.includedModules=new Map}include(t,i){if(this.includedModules.has(t)){const r=this.includedModules.get(t);if(r!==i){wBe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))r[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${t[n]}`))}}else this.includedModules.set(t,i),t(this.builder,i)}}class Fi extends cge{constructor(){super(...arguments),this.vertex=new tee,this.fragment=new tee,this.attributes=new SBe,this.varyings=new EBe,this.extensions=new NS,this.constants=new ns}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const i=this.extensions.generateSource(t),r=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?CBe:ABe,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a)=>{for(let l=0;l<n;++l)s[l](i,o,a)}}}class xBe{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const i of t)this._add(i)}_add(t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new Y(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}generateSource(){return Array.from(this._entries.values()).map(t=>_(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class TBe{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class tee extends cge{constructor(){super(...arguments),this.uniforms=new xBe,this.code=new TBe,this.constants=new ns}get builder(){return this}}class SBe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(t){return t==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}}class EBe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class NS{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const i=t==="vertex"?NS.ALLOWLIST_VERTEX:NS.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}}NS.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],NS.ALLOWLIST_VERTEX=[];class ns{constructor(){this._entries=new Set}add(t,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=ns._numberToFloatStr(r);break;case"int":s=ns._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${ns._numberToFloatStr(r[0])},                            ${ns._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${ns._numberToFloatStr(r[0])},                            ${ns._numberToFloatStr(r[1])},                            ${ns._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${ns._numberToFloatStr(r[0])},                            ${ns._numberToFloatStr(r[1])},                            ${ns._numberToFloatStr(r[2])},                            ${ns._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${ns._numberToIntStr(r[0])},                             ${ns._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${ns._numberToIntStr(r[0])},                             ${ns._numberToIntStr(r[1])},                             ${ns._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${ns._numberToIntStr(r[0])},                             ${ns._numberToIntStr(r[1])},                             ${ns._numberToIntStr(r[2])},                             ${ns._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>ns._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const ABe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,CBe=`precision highp float;
precision highp sampler2D;`;class et extends eu{constructor(t,i,r){switch(i){case F.Pass:case F.Draw:return void super(t,"sampler2D",i,r?(s,n,o)=>s.bindTexture(t,r(n,o)):null);default:super(t,"sampler2D")}}}function FT(e,t,i,r){const s=(F.Pass,[new et(e,t,i)]);if(r){const n=e+"Size",o=(a,l)=>{const c=i(a,l);return _(c)?Li(RBe,c.descriptor.width,c.descriptor.height):sg};s.push((F.Pass,new Ft(n,t,o)))}return s}const RBe=lt();function OBe(e){const t=new Fi;t.attributes.add(A.POSITION,"vec2"),t.include(jm,{textureCoordinateType:Gs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add(new li("inverseProjectionMatrix",F.Pass,(s,n)=>n.camera.inverseProjectionMatrix)),i.uniforms.add(new li("inverseViewMatrix")),i.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new ke("lightingMainDirection",F.Pass,(s,n)=>n.lighting.lightingMainDirection),new Ft("radii"),new ye("scaleHeight"),new ke("cameraPosition"),new dt("heightParameters"),new ye("innerFadeDistance"),new ye("altitudeFade"),new et("depthTex"),new ke("betaRayleigh"),new ke("betaCombined"),new ye("betaMie"),new ye("hazeStrength")]),t.include(KF),e.haze&&(r.include(Zc),r.uniforms.add(new Ft("nearFar",F.Pass,(s,n)=>n.camera.nearFar))),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(T`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(T`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?T`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?T``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":T`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?T`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:T`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?T`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:T`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?T`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:T`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":T`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const MBe=Object.freeze(Object.defineProperty({__proto__:null,build:OBe},Symbol.toStringTag,{value:"Module"}));class Vi{constructor(t,i){this._module=t,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}class Ki{constructor(t,i,r){this.release=r,i&&(this.initializeConfiguration(t,i),this._configuration=i.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=it(this._program),this._pipeline=this._configuration=null}reload(t){it(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(t,i){this.program.bindPass(t,i)}bindDraw(t,i){this.program.bindDraw(t,i),this.program.rebindTextures()}bindPipelineState(t,i=null,r){t.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return Dt.TRIANGLES}getPipelineState(t,i){return this._pipeline}initializeConfiguration(t,i){}}const Ri=new Map([[A.POSITION,0],[A.NORMAL,1],[A.UV0,2],[A.COLOR,3],[A.SIZE,4],[A.TANGENT,4],[A.AUXPOS1,5],[A.SYMBOLCOLOR,5],[A.AUXPOS2,6],[A.FEATUREATTRIBUTE,6],[A.INSTANCEFEATUREATTRIBUTE,6],[A.INSTANCECOLOR,7],[A.MODEL,8],[A.MODELNORMAL,12],[A.MODELORIGINHI,11],[A.MODELORIGINLO,15]]),PBe=pe.getLogger("esri/views/webgl");function IBe(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const uge=!!ue("enable-feature:webgl-debug");function $u(){return uge}function kR(){return uge}function f0(e){if($u()){const t=e.getError();if(t){const i=IBe(e,t),r=new Error().stack;PBe.error(new Y("webgl-error","WebGL error occured",{message:i,stack:r}))}}}class Gi{constructor(t,i,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Vt({deallocator:null}),this._glProgram=t.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(F.Pass,this),this.bindDraw=i.generateBind(F.Draw,this),this._fragmentUniforms=$u()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,i){this._glProgram.setUniform1i(t,i?1:0)}setUniform1i(t,i){this._glProgram.setUniform1i(t,i)}setUniform1f(t,i){this._glProgram.setUniform1f(t,i)}setUniform2f(t,i,r){this._glProgram.setUniform2f(t,i,r)}setUniform2fv(t,i){this._glProgram.setUniform2fv(t,i)}setUniform3f(t,i,r,s){this._glProgram.setUniform3f(t,i,r,s)}setUniform3fv(t,i){this._glProgram.setUniform3fv(t,i)}setUniform4f(t,i,r,s,n){this._glProgram.setUniform4f(t,i,r,s,n)}setUniform4fv(t,i){this._glProgram.setUniform4fv(t,i)}setUniformMatrix3fv(t,i){this._glProgram.setUniformMatrix3fv(t,i)}setUniformMatrix4fv(t,i){this._glProgram.setUniformMatrix4fv(t,i)}setUniform1fv(t,i){this._glProgram.setUniform1fv(t,i)}setUniform1iv(t,i){this._glProgram.setUniform1iv(t,i)}setUniform2iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform3iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform4iv(t,i){this._glProgram.setUniform4iv(t,i)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,i){if(C(i)||i.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let r=this._textures.get(t);return r==null?(r=this._allocTextureUnit(i),this._textures.set(t,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,i)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(i,t.unit)}),_(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var Zi,yb,l1,gt,bs,Pl,Za,FS,lg,Qa,C0,US,Xi,vb;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(Zi||(Zi={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(yb||(yb={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(l1||(l1={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(gt||(gt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(bs||(bs={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(Pl||(Pl={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Za||(Za={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(FS||(FS={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(lg||(lg={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(Qa||(Qa={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(C0||(C0={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(US||(US={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(Xi||(Xi={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(vb||(vb={}));function ah(e,t,i=og.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function po(e,t,i,r,s=og.ADD,n=og.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const mq={face:qa.BACK,mode:ES.CCW},hge={face:qa.FRONT,mode:ES.CCW},e4=e=>e===Zi.Back?mq:e===Zi.Front?hge:null,ol={zNear:0,zFar:1},Qt={r:!0,g:!0,b:!0,a:!0};function $Be(e){return BBe.intern(e)}function DBe(e){return VBe.intern(e)}function LBe(e){return GBe.intern(e)}function NBe(e){return jBe.intern(e)}function FBe(e){return HBe.intern(e)}function UBe(e){return qBe.intern(e)}function zBe(e){return WBe.intern(e)}function kBe(e){return XBe.intern(e)}function Ut(e){return YBe.intern(e)}class gg{constructor(t,i){this.makeKey=t,this.makeRef=i,this.interns=new Map}intern(t){if(!t)return null;const i=this.makeKey(t),r=this.interns;return r.has(i)||r.set(i,this.makeRef(t)),r.get(i)}}function yg(e){return"["+e.join(",")+"]"}const BBe=new gg(dge,e=>L({__tag:"Blending"},e));function dge(e){return e?yg([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const VBe=new gg(pge,e=>L({__tag:"Culling"},e));function pge(e){return e?yg([e.face,e.mode]):null}const GBe=new gg(fge,e=>L({__tag:"PolygonOffset"},e));function fge(e){return e?yg([e.factor,e.units]):null}const jBe=new gg(mge,e=>L({__tag:"DepthTest"},e));function mge(e){return e?yg([e.func]):null}const HBe=new gg(gge,e=>L({__tag:"StencilTest"},e));function gge(e){return e?yg([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const qBe=new gg(yge,e=>L({__tag:"DepthWrite"},e));function yge(e){return e?yg([e.zNear,e.zFar]):null}const WBe=new gg(vge,e=>L({__tag:"ColorWrite"},e));function vge(e){return e?yg([e.r,e.g,e.b,e.a]):null}const XBe=new gg(_ge,e=>L({__tag:"StencilWrite"},e));function _ge(e){return e?yg([e.mask]):null}const YBe=new gg(ZBe,e=>({blending:$Be(e.blending),culling:DBe(e.culling),polygonOffset:LBe(e.polygonOffset),depthTest:NBe(e.depthTest),stencilTest:FBe(e.stencilTest),depthWrite:UBe(e.depthWrite),colorWrite:zBe(e.colorWrite),stencilWrite:kBe(e.stencilWrite)}));function ZBe(e){return e?yg([dge(e.blending),pge(e.culling),fge(e.polygonOffset),mge(e.depthTest),gge(e.stencilTest),yge(e.depthWrite),vge(e.colorWrite),_ge(e.stencilWrite)]):null}class QBe{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,i,r,s){return(r||t!==i)&&(s(t),this._pipelineInvalid=!0),t}}class BR extends Ki{initializeProgram(t){const i=BR.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}initializePipeline(){return this.configuration.haze?Ut({blending:po(Me.ONE,Me.ZERO,Me.ONE_MINUS_SRC_COLOR,Me.ONE),colorWrite:Qt}):Ut({blending:po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ji.LEQUAL},colorWrite:Qt})}}BR.shader=new Vi(MBe,()=>import("./ChapmanAtmosphere.glsl.128c37f8.js"));class _a{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,i={key:this.key};for(const r of t)i[r]=this[r];return i}}function B(e={}){return(t,i)=>{var r;if(t._parameterNames=(r=t._parameterNames)!=null?r:[],t._parameterNames.push(i),e.constValue!=null)Object.defineProperty(t,i,{get:()=>e.constValue});else{var s;const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,i,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<h&p,typeof f!="number"&&typeof f!="boolean"))throw"Configuration value for "+i+" must be boolean or number, got "+typeof f}})}}}class bge extends _a{constructor(){super(...arguments),this.haze=!1}}u([B()],bge.prototype,"haze",void 0);class Un{constructor(t,i,r,s,n,o=!1,a=0){this.name=t,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new Un(A.POSITION,3,ut.FLOAT,0,12);new Un(A.POSITION,3,ut.FLOAT,0,20),new Un(A.UV0,2,ut.FLOAT,12,20);new Un(A.POSITION,3,ut.FLOAT,0,32),new Un(A.NORMAL,3,ut.FLOAT,12,32),new Un(A.UV0,2,ut.FLOAT,24,32);new Un(A.POSITION,3,ut.FLOAT,0,16),new Un(A.COLOR,4,ut.UNSIGNED_BYTE,12,16);const gq=[new Un(A.POSITION,2,ut.FLOAT,0,8)],tM=[new Un(A.POSITION,2,ut.FLOAT,0,16),new Un(A.UV0,2,ut.FLOAT,8,16)],ec=pe.getLogger("esri.views.webgl.BufferObject");function JBe(e){return Nwe(e)}class si{constructor(t,i,r,s){this._context=t,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(en.BufferObject,this),this._glName=this._context.gl.createBuffer(),f0(this._context.gl),s&&this.setData(s)}static createIndex(t,i,r){return new si(t,wt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(t,i,r){return new si(t,wt.ARRAY_BUFFER,i,r)}static createUniform(t,i,r){if(t.type!==xi.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new si(t,wt.UNIFORM_BUFFER,i,r)}static createPixelPack(t,i=mi.STREAM_READ,r){if(t.type!==xi.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new si(t,wt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(t,i=mi.STREAM_DRAW,r){if(t.type!==xi.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new si(t,wt.PIXEL_UNPACK_BUFFER,i,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER?this._indexType===ut.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER||this.bufferType===wt.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(en.BufferObject,this),this._context=null):this._glName&&ec.warn("Leaked WebGL buffer object")}setSize(t,i=null){if(t<=0&&ec.error("Buffer size needs to be positive!"),this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&_(i))switch(this._indexType=i,i){case ut.UNSIGNED_SHORT:t*=2;break;case ut.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let i=t.byteLength;this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&(gD(t)&&(i/=2,this._indexType=ut.UNSIGNED_SHORT),yD(t)&&(i/=4,this._indexType=ut.UNSIGNED_INT)),this._setBufferData(i,t)}_setBufferData(t,i=null){this._size=t;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;_(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,t,this.usage),f0(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(t,i=0,r=0,s=t.byteLength){if(!t)return;(i<0||i>=this._size)&&ec.error("offset is out of range!");let n=i,o=r,a=s,l=t.byteLength;this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&(gD(t)?(l/=2,n*=2,o*=2,a*=2):yD(t)&&(l/=4,n*=4,o*=4,a*=4)),s===void 0&&(s=l-1),r>=s&&ec.error("end must be bigger than start!"),i+r-s>this._size&&ec.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,p=ArrayBuffer.isView(t)?t.buffer:t,f=o===0&&a===t.byteLength?p:p.slice(o,a);h.bufferSubData(this.bufferType,n,f),f0(h),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(t,i,r,s){if(!t)return;(i<0||i>=this._size)&&ec.error("offset is out of range!"),r>=s&&ec.error("end must be bigger than start!"),i+r-s>this._size&&ec.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===xi.WEBGL2)o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,t,r,s-r);else{const a=r===0&&s===t.length?t:t.subarray(r,s);o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,a)}f0(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,i=0,r,s){if(this._context.type!==xi.WEBGL2)return void ec.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void ec.error("Problem getting subdata: offset and length were less than zero!");const n=JBe(t)?t.BYTES_PER_ELEMENT:1;if(n*((r!=null?r:0)+(s!=null?s:0))>t.byteLength)return void ec.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s!=null?s:0)>this.byteSize&&ec.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,wt.COPY_READ_BUFFER),o.getBufferSubData(wt.COPY_READ_BUFFER,i,t,r,s),this._context.unbindBuffer(wt.COPY_READ_BUFFER)}async getSubDataAsync(t,i=0,r,s){this._context.type===xi.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,i,r,s)):ec.error("Get buffer subdata is supported in WebGL2 only!")}}function fn(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const iee=4;class ot{constructor(t,i,r=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(en.Texture,this),this._descriptor=L({target:pt.TEXTURE_2D,samplingMode:Je.LINEAR,wrapMode:bt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},i),t.type!==xi.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),Av(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===pt.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(en.Texture,this))}release(){this.dispose()}resize(t,i){const r=this._descriptor;if(r.width!==t||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=t,r.height=i,this._descriptor.target===pt.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let i=pt.TEXTURE_CUBE_MAP_POSITIVE_X;i<=pt.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(t,i)}setData(t){this._setData(t)}_setData(t,i){if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),t===void 0&&(t=null);const s=this._descriptor;i!=null||(i=s.target);const n=Av(i);var o;t===null&&(s.width=s.width||iee,s.height=s.height||iee,n&&(s.depth=(o=s.depth)!=null?o:1));const a=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),ot._validateTexture(this._context,s),this._configurePixelStorage();const l=s.pixelFormat;let c=s.internalFormat?s.internalFormat:this._deriveInternalFormat(l,s.dataType);if(uz(t)){let h=t.width,p=t.height;const f=1;t instanceof HTMLVideoElement&&(h=t.videoWidth,p=t.videoHeight),s.width&&s.height,n&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,c,s.hasMipmap,h,p,f),this._texImage(i,0,c,h,p,f,t),f0(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),n&&s.depth===void 0&&(s.depth=f)}else{const{width:h,height:p,depth:f}=s;if(h!=null&&p!=null||console.error("Width and height must be specified!"),n&&f==null&&console.error("Depth must be specified!"),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,c,s.hasMipmap,h,p,f),r.DEPTH24_STENCIL8&&c===r.DEPTH_STENCIL&&(c=r.DEPTH24_STENCIL8),N$(t)){const g=t.levels,y=ree(i,h,p,f),v=Math.min(y-1,g.length-1);fn(r)?r.texParameteri(s.target,r.TEXTURE_MAX_LEVEL,v):s.hasMipmap=s.hasMipmap&&y===g.length;const b=c;if(!eVe(b))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((w,S,x,E)=>{const R=g[Math.min(w,g.length-1)];this._compressedTexImage(i,w,b,S,x,E,R)},v)}else _(t)?(this._texImage(i,0,c,h,p,f,t),f0(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((g,y,v,b)=>{this._texImage(i,g,c,y,v,b,null),f0(r)})}ot._applySamplingMode(r,this._descriptor),ot._applyWrapMode(r,this._descriptor),ot._applyAnisotropicFilteringParameters(this._context,this._descriptor),f0(r),this._context.bindTexture(a,ot.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,i,r,s,n,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,internalFormat:h,dataType:p,isImmutable:f,target:g}=l;if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const y=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);(i<0||r<0||s>l.width||n>l.height||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),uz(o)?a.texSubImage2D(g,t,i,r,c,p,o):N$(o)?a.compressedTexSubImage2D(g,t,i,r,s,n,h,o.levels[t]):a.texSubImage2D(g,t,i,r,s,n,c,p,o),this._context.bindTexture(y,ot.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!fn(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:g,target:y,internalFormat:v}=h;if(g&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");Av(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const b=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>h.width||o>h.height||a>h.depth||i+n>h.width||r+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),N$(l))l=l.levels[t],c.compressedTexSubImage3D(y,t,i,r,s,n,o,a,v,l);else{const w=l;c.texSubImage3D(y,t,i,r,s,n,o,a,p,f,w)}this._context.bindTexture(b,ot.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,ot._validateTexture(this._context,t)}t.samplingMode===Je.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=Je.LINEAR_MIPMAP_NEAREST):t.samplingMode===Je.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=Je.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,ot.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(i,ot.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,ot._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(ot._applySamplingMode(t,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(ot._applyWrapMode(t,i),this._wrapModeDirty=!1)}_deriveInternalFormat(t,i){if(this._context.type===xi.WEBGL1)return t;switch(i){case Ct.FLOAT:switch(t){case ze.RGBA:return mt.RGBA32F;case ze.RGB:return mt.RGB32F;default:throw new Error("Unable to derive format")}case Ct.UNSIGNED_BYTE:switch(t){case ze.RGBA:return mt.RGBA8;case ze.RGB:return mt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,i,r,s,n,o){const a=this._context.gl;if(!fn(a))throw new Error("Immutable textures are not supported in WebGL1");if(!KBe(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?ree(t,s,n,o):1;Av(t)?a.texStorage3D(t,l,i,s,n,o):a.texStorage2D(t,l,i,s,n),this._wasImmutablyAllocated=!0}_texImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===xi.WEBGL2,p=Av(t),{isImmutable:f,pixelFormat:g,dataType:y}=this._descriptor;if(h&&(c=l),h||!uz(a))if(f){if(_(a)){const v=a;p?c.texSubImage3D(t,i,0,0,0,s,n,o,g,y,v):l.texSubImage2D(t,i,0,0,s,n,g,y,v)}}else{const v=a;p?c.texImage3D(t,i,r,s,n,o,0,g,y,v):l.texImage2D(t,i,r,s,n,0,g,y,v)}else l.texImage2D(t,0,r,g,y,a)}_compressedTexImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=Av(t),p=this._descriptor.isImmutable;if(h){if(this._context.type!==xi.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}p?_(a)&&(h?c.compressedTexSubImage3D(t,i,0,0,0,s,n,o,r,a):l.compressedTexSubImage2D(t,i,0,0,s,n,r,a)):h?c.compressedTexImage3D(t,i,r,s,n,o,0,a):l.compressedTexImage2D(t,i,r,s,n,0,a)}_forEachMipmapLevel(t,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===pt.TEXTURE_3D;for(let c=0;t(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(t,i){(i.width<0||i.height<0||i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=fn(t.gl),s=oS(i.width)&&oS(i.height);r||!i.isImmutable&&!Av(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==bt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===bt.CLAMP_TO_EDGE&&i.wrapMode.t===bt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,i){let r=i.samplingMode,s=i.samplingMode;r===Je.LINEAR_MIPMAP_NEAREST||r===Je.LINEAR_MIPMAP_LINEAR?(r=Je.LINEAR,i.hasMipmap||(s=Je.LINEAR)):r!==Je.NEAREST_MIPMAP_NEAREST&&r!==Je.NEAREST_MIPMAP_LINEAR||(r=Je.NEAREST,i.hasMipmap||(s=Je.NEAREST)),t.texParameteri(i.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(i.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,i){typeof i.wrapMode=="number"?(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode)):(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode.s),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,i){var r;const s=t.capabilities.textureFilterAnisotropic;!s||t.gl.texParameterf(i.target,s.TEXTURE_MAX_ANISOTROPY,(r=i.maxAnisotropy)!=null?r:1)}}function KBe(e){return e in mt}function eVe(e){return e in kr}function N$(e){return _(e)&&"type"in e&&e.type==="compressed"}function tVe(e){return _(e)&&"byteLength"in e}function uz(e){return _(e)&&!N$(e)&&!tVe(e)}function Av(e){return e===pt.TEXTURE_3D||e===pt.TEXTURE_2D_ARRAY}function ree(e,t,i,r=1){let s=Math.max(t,i);return e===pt.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}ot.TEXTURE_UNIT_FOR_UPDATES=0;function see(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function oo(e,t){return e.vertexBuffers[t].size/iVe(e.layout[t])}function iVe(e){return e[0].stride}function yq(e,t,i,r,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function vq(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const o of r){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(wt.ARRAY_BUFFER)}function wge(e){switch(e){case ze.ALPHA:case ze.LUMINANCE:case ze.RED:case ze.RED_INTEGER:case mt.R8:case mt.R8I:case mt.R8UI:case mt.R8_SNORM:case la.STENCIL_INDEX8:return 1;case ze.LUMINANCE_ALPHA:case ze.RG:case ze.RG_INTEGER:case mt.RGBA4:case mt.R16F:case mt.R16I:case mt.R16UI:case mt.RG8:case mt.RG8I:case mt.RG8UI:case mt.RG8_SNORM:case mt.RGB565:case mt.RGB5_A1:case la.DEPTH_COMPONENT16:return 2;case ze.DEPTH_COMPONENT:case ze.RGB:case ze.RGB_INTEGER:case mt.RGB8:case mt.RGB8I:case mt.RGB8UI:case mt.RGB8_SNORM:case mt.SRGB8:case la.DEPTH_COMPONENT24:return 3;case ze.DEPTH_STENCIL:case ze.RGBA:case ze.RGBA_INTEGER:case mt.RGBA8:case mt.R32F:case mt.R11F_G11F_B10F:case mt.RG16F:case mt.R32I:case mt.R32UI:case mt.RG16I:case mt.RG16UI:case mt.RGBA8I:case mt.RGBA8UI:case mt.RGBA8_SNORM:case mt.SRGB8_ALPHA8:case mt.RGB9_E5:case mt.RGB10_A2UI:case mt.RGB10_A2:case la.DEPTH_STENCIL:case la.DEPTH_COMPONENT32F:case la.DEPTH24_STENCIL8:return 4;case la.DEPTH32F_STENCIL8:return 5;case mt.RGB16F:case mt.RGB16I:case mt.RGB16UI:return 6;case mt.RG32F:case mt.RG32I:case mt.RG32UI:case mt.RGBA16F:case mt.RGBA16I:case mt.RGBA16UI:return 8;case mt.RGB32F:case mt.RGB32I:case mt.RGB32UI:return 12;case mt.RGBA32F:case mt.RGBA32I:case mt.RGBA32UI:return 16;case kr.COMPRESSED_RGB_S3TC_DXT1_EXT:case kr.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case kr.COMPRESSED_RGBA_S3TC_DXT3_EXT:case kr.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case kr.COMPRESSED_R11_EAC:case kr.COMPRESSED_SIGNED_R11_EAC:case kr.COMPRESSED_RGB8_ETC2:case kr.COMPRESSED_SRGB8_ETC2:case kr.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case kr.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case kr.COMPRESSED_RG11_EAC:case kr.COMPRESSED_SIGNED_RG11_EAC:case kr.COMPRESSED_RGBA8_ETC2_EAC:case kr.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function R0(e){if(C(e))return 0;if("descriptor"in e)return e.glName?R0(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return wge(t)*r*i}const Cv=pe.getLogger("esri.views.webgl.VertexArrayObject");class Os{constructor(t,i,r,s,n=null){this._context=t,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(en.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,i)=>t+this._buffers[i].size,_(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&Cv.warn("Leaked WebGL VAO"));if(this._glName){var i,r;const s=(i=this._context)==null||(r=i.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):Cv.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const s in this._buffers)this._buffers[s].dispose(),delete this._buffers[s];this._indexBuffer=it(this._indexBuffer)}this._context.instanceCounter.decrement(en.VertexArrayObject,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const i=t.createVertexArray();t.bindVertexArray(i),this._bindLayout(),t.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:i,_indexBuffer:r}=this;t||Cv.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const o=t[n];o||Cv.error("Vertex buffer is uninitialized!");const a=i[n];a||Cv.error("Vertex element descriptor is empty!"),yq(this._context,this._locations,o,a)}_(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:i}=this;t||Cv.error("Vertex buffer dictionary is empty!");for(const r in t){const s=t[r];s||Cv.error("Vertex buffer is uninitialized!");const n=i[r];vq(this._context,this._locations,s,n)}_(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function ba(e,t=gq,i=Ri,r=-1,s=1){let n=null;return t===tM?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new Os(e,i,{geometry:t},{geometry:si.createVertex(e,mi.STATIC_DRAW,n)})}function rVe(e,t=gq,i=Ri){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Os(e,i,{geometry:t},{geometry:si.createVertex(e,mi.STATIC_DRAW,r)})}const xge=4;function Tge(e,t=xge){return new ot(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:t,height:t})}function nee(e,t,i=xge){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*t[0],r[s+1]=255*t[1],r[s+2]=255*t[2],r[s+3]=255*t[3];return new ot(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:i,height:i},r)}function Sge(e){return new ot(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class oee{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=M(),this._viewInverse=Ae(),this._heightParameters=ii(),this._betasRayleigh=M(),this._betasCombined=M(),this._scaleHeight=0,this._radii=lt(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=ai.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(ai.radius)}destroy(){this._atmosphereTechnique=$i(this._atmosphereTechnique),this._atmosphereHazeTechnique=$i(this._atmosphereHazeTechnique),this._vao=it(this._vao),this._handles=ct(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const i=t.renderContext.rctx,r=this._handles=new Jt,s=this._view.basemapTerrain;_(s.rootTiles)&&this._updateElevation({spatialReference:s.spatialReference,tile:s.rootTiles[0],extent:s.rootTiles[0].extent,context:"ground"}),r.add(ma(()=>this._view.basemapTerrain,"elevation-change",o=>this._updateElevation(o),{onListenerAdd:()=>this._updateElevation()})),r.add(ma(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const n=new bge;n.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(BR,n),n.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(BR,n),this._vao=ba(i,tM),this._scaleHeight=bBe*L$,se(this._betasRayleigh,gw[0],gw[1],gw[2]),se(this._betasCombined,gw[0]+cz[0],gw[1]+cz[1],gw[2]+cz[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,i){this._darkenHaze=i,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,i,r){this._update(t.bindParameters.camera);const s=t.rctx.bindTechnique(i,sVe,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{s.bindTexture("depthTex",r),this._renderCommon(i.program,t)})}_renderCommon(t,i){if(C(this._vao))return;const r=i.rctx;t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniformMatrix4fv("inverseViewMatrix",this._viewInverse),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",_Be),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),r.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Dt.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const i=t?t.tile:Tt(this._view.basemapTerrain.rootTiles,[null])[0];if(C(i)||i.level!==0)return;const r=this._adjustRadiusForTesselation(ai.radius+i.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(ai.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,Li(this._radii,t,t+L$),this._innerFadeDistance=2*Math.sqrt((2*t-K9)*K9)}_update(t){if(C(t))return;this._cameraHeight=Ie(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const i=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/L$));this._heightParameters=ri(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,i),ne(this._cameraPosition,t.eye),jr(this._viewInverse,t.viewMatrix),this._altitudeFade=lge(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?ti(.6,1,aS(9500,10500,this._cameraHeight-ai.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}const sVe=new qs;function nVe(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function DL(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function _q(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Rt?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function bq(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-r*c,e[2]=n*h+o*c+r*l-s*a,e[3]=o*h-r*a-s*l-n*c,e}function oVe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e}function aVe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e}function lVe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function cVe(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e}function F$(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,f,g=i[0],y=i[1],v=i[2],b=i[3];return c=s*g+n*y+o*v+a*b,c<0&&(c=-c,g=-g,y=-y,v=-v,b=-b),1-c>Rt?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(p=1-r,f=r),e[0]=p*s+f*g,e[1]=p*n+f*y,e[2]=p*o+f*v,e[3]=p*a+f*b,e}function uVe(e){const t=cd(),i=cd(),r=cd(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e}function hVe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e}function iM(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Ege(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*n+o]-t[3*o+n])*r,e[n]=(t[3*n+s]+t[3*s+n])*r,e[o]=(t[3*o+s]+t[3*s+o])*r}return e}function dVe(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function pVe(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const Age=Dc,fVe=Wi,mVe=L7,gVe=bq,yVe=DO,vVe=dae,_Ve=U7,Cge=N7,bVe=Cge,Rge=F7,wVe=Rge,wq=hae,xVe=Z1,TVe=pae;function SVe(e,t,i){const r=Se(t,i);return r<-.999999?(_t(Bd,EVe,t),D7(Bd)<1e-6&&_t(Bd,AVe,t),Te(Bd,Bd),DL(e,Bd,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(_t(Bd,t,i),e[0]=Bd[0],e[1]=Bd[1],e[2]=Bd[2],e[3]=1+r,wq(e,e))}const Bd=M(),EVe=Le(1,0,0),AVe=Le(0,1,0);function CVe(e,t,i,r,s,n){return F$(aee,t,s,n),F$(lee,i,r,n),F$(e,aee,lee,2*n*(1-n)),e}const aee=vf(),lee=vf();function RVe(e,t,i,r){const s=OVe;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],wq(e,Ege(e,s))}const OVe=Qi();Object.freeze(Object.defineProperty({__proto__:null,identity:nVe,setAxisAngle:DL,getAxisAngle:_q,multiply:bq,rotateX:oVe,rotateY:aVe,rotateZ:lVe,calculateW:cVe,slerp:F$,random:uVe,invert:hVe,conjugate:iM,fromMat3:Ege,fromEuler:dVe,str:pVe,copy:Age,set:fVe,add:mVe,mul:gVe,scale:yVe,dot:vVe,lerp:_Ve,length:Cge,len:bVe,squaredLength:Rge,sqrLen:wVe,normalize:wq,exactEquals:xVe,equals:TVe,rotationTo:SVe,sqlerp:CVe,setAxes:RVe},Symbol.toStringTag,{value:"Module"}));function I2(e=PVe){return[e[0],e[1],e[2],e[3]]}function VR(e,t){return MVe(e[0],e[1],e[2],t,Hj.get())}function MVe(e,t,i,r,s=I2()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function GR(e,t,i=I2()){return _t(i,e,t),Te(i,i),i[3]=Xj(e,t),i}const PVe=[0,0,1,0];function vi(){return new Float32Array(3)}function LL(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ai(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function Oge(e,t){return new Float32Array(e,t,3)}function xq(){return vi()}function Mge(){return Ai(1,1,1)}function Pge(){return Ai(1,0,0)}function Ige(){return Ai(0,1,0)}function $ge(){return Ai(0,0,1)}const IVe=xq(),$Ve=Mge(),DVe=Pge(),LVe=Ige(),NVe=$ge();Object.freeze(Object.defineProperty({__proto__:null,create:vi,clone:LL,fromValues:Ai,createView:Oge,zeros:xq,ones:Mge,unitX:Pge,unitY:Ige,unitZ:$ge,ZEROS:IVe,ONES:$Ve,UNIT_X:DVe,UNIT_Y:LVe,UNIT_Z:NVe},Symbol.toStringTag,{value:"Module"}));function Dge(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(T`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function Tq(e,t){switch(e.include(jm,t),e.fragment.code.add(T`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case Gs.Default:return void e.fragment.code.add(T`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case Gs.Atlas:return e.include(Dge),void e.fragment.code.add(T`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case Gs.None:case Gs.COUNT:return}}class cv{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,i,r=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(r,i),this._technique),this._technique}ensureResources(t){return Pl.LOADED}}class Sq extends cv{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,i=>this._texture=i),this._acquire(t.normalTextureId,i=>this._textureNormal=i),this._acquire(t.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(t.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(t.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=$i(this._texture),this._textureNormal=$i(this._textureNormal),this._textureEmissive=$i(this._textureEmissive),this._textureOcclusion=$i(this._textureOcclusion),this._textureMetallicRoughness=$i(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?Pl.LOADED:Pl.LOADING}get passParameters(){return new Lge(_(this._texture)?this._texture.glTexture:null,_(this._textureNormal)?this._textureNormal.glTexture:null,_(this._textureEmissive)?this._textureEmissive.glTexture:null,_(this._textureOcclusion)?this._textureOcclusion.glTexture:null,_(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(C(this._texture)||t!==this._texture.id)&&(this._texture=$i(this._texture),this._textureId=t,this._acquire(this._textureId,i=>this._texture=i))}_acquire(t,i){if(C(t))return void i(null);const r=this._textureRepository.acquire(t);if(Jc(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return $i(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}}class Lge extends qs{constructor(t=null,i=null,r=null,s=null,n=null){super(),this.texture=t,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const Mmt=Ai(0,.6,.2);var Mt;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(Mt||(Mt={}));function Eq(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===Mt.Normal&&r&&e.include(Tq,t),t.pbrMode!==Mt.Schematic)if(t.pbrMode!==Mt.Disabled){if(t.pbrMode===Mt.Normal){i.code.add(T`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas,n=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add((F.Pass,FT("texMetallicRoughness",n,o=>o.textureMetallicRoughness,s))),i.code.add(T`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add((F.Pass,FT("texEmission",n,o=>o.textureEmissive,s))),i.code.add(T`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add((F.Pass,FT("texOcclusion",n,o=>o.textureOcclusion,s))),i.code.add(T`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(T`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add((F.Pass,[new ke("emissionFactor",n,o=>o.emissiveFactor),new ke("mrrFactors",n,o=>o.mrrFactors)])),i.code.add(T`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(T`float getBakedOcclusion() { return 1.0; }`);else i.code.add(T`const vec3 mrr = vec3(0.0, 0.6, 0.2);
const vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function Aq(e,t){const i=e.fragment,r=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new ke("lightingAmbientSH0",F.Pass,(s,n)=>se(cee,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new dt("lightingAmbientSH_R",F.Pass,(s,n)=>Wi(Mf,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new dt("lightingAmbientSH_G",F.Pass,(s,n)=>Wi(Mf,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new dt("lightingAmbientSH_B",F.Pass,(s,n)=>Wi(Mf,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new ke("lightingAmbientSH0",F.Pass,(s,n)=>se(cee,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new dt("lightingAmbientSH_R1",F.Pass,(s,n)=>Wi(Mf,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new dt("lightingAmbientSH_G1",F.Pass,(s,n)=>Wi(Mf,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new dt("lightingAmbientSH_B1",F.Pass,(s,n)=>Wi(Mf,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new dt("lightingAmbientSH_R2",F.Pass,(s,n)=>Wi(Mf,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new dt("lightingAmbientSH_G2",F.Pass,(s,n)=>Wi(Mf,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new dt("lightingAmbientSH_B2",F.Pass,(s,n)=>Wi(Mf,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==Mt.Normal&&t.pbrMode!==Mt.Schematic||i.code.add(T`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const cee=M(),Mf=ii();function t4(e){e.vertex.code.add(T`const float PI = 3.141592653589793;`),e.fragment.code.add(T`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}function Nge(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new ye("lightingFixedFactor",F.Pass,(r,s)=>(1-s.lighting.groundLightingFactor)*(1-s.lighting.globalFactor))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new ke("lightingMainDirection",F.Pass,(r,s)=>s.lighting.lightingMainDirection),new ke("lightingMainIntensity",F.Pass,(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(T`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function Md(e,t){e.add(new ke("cameraPosition",F.Draw,(i,r)=>t.instancedDoublePrecision?pa:se(Fge,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Gc(e,t){if(e.vertex.uniforms.add(new li("proj",F.Pass,(r,s)=>s.camera.projectionMatrix)),t.instancedDoublePrecision){const r=(n,o)=>se(Fge,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new li("view",F.Pass,(n,o)=>ga(uee,o.camera.viewMatrix,r(n,o))));const s=new ke("localOrigin",F.Pass,r);return e.vertex.uniforms.add(s),s}e.vertex.uniforms.add(new li("view",F.Draw,(r,s)=>ga(uee,s.camera.viewMatrix,r.origin)));const i=new ke("localOrigin",F.Draw,r=>r.origin);return e.vertex.uniforms.add(i),i}const uee=KO(),Fge=M();class FVe extends eu{constructor(t,i,r){switch(i){case F.Draw:case F.Pass:return void super(t,"samplerCube",i,r?(s,n,o)=>s.bindTexture(t,r(n,o)):null);default:super(t,"samplerCube")}}}function Uge(e,t){e.include(Nge,t);const i=e.fragment;Md(i.uniforms,t),i.uniforms.add([new li("rotationMatrixClouds"),new li("rotationMatrixCloudsCrossFade"),new ke("anchorPosition"),new ke("anchorPositionCrossFade"),new Ft("cloudVariables"),new ye("fadeInOutFactor"),new ye("cloudsHeight"),new ye("radiusCurvatureCorrectionFactor"),new ye("radius"),new ye("totalFadeInOut"),new ye("crossFadeAnchorFactor"),new FVe("cubeMap")]),i.code.add(T`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos, float radiusReduction)
{
vec3 dirAnchor = normalize(spherePos);
vec3 sphereOriginOffset = dirAnchor * radiusReduction;
float radiusClouds = radius + cloudsHeight - radiusReduction;
float B = 2.0 * dot(cameraPosition - sphereOriginOffset, dir);
float C = dot(cameraPosition - sphereOriginOffset, cameraPosition - sphereOriginOffset) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),i.code.add(T`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),i.code.add(T`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),i.uniforms.add([new ke("lightingMainDirection",F.Pass,(r,s)=>s.lighting.lightingMainDirection),new ke("lightingMainIntensity",F.Pass,(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(T`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),i.code.add(T`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),i.code.add(T`vec4 renderCloud(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(normalize(-worldRay), cloudData), totalTransmittance);
}`),i.code.add(T`vec4 renderCloudCrossFade(vec3 worldRay, vec3 position)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPositionCrossFade, 0.0);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`)}function wf(e){e.code.add(T`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}class _b extends eu{constructor(t,i,r){switch(i){case F.Pass:return void super(t,"bool",i,(s,n,o)=>s.setUniform1b(t,r(n,o)));case F.Draw:return void super(t,"bool",i,(s,n,o)=>s.setUniform1b(t,r(n,o)))}}}class zge extends qs{constructor(){super(...arguments),this.crossFade=!1}}function UVe(){const e=new Fi;e.attributes.add(A.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:i}=e;return t.uniforms.add([new li("inverseProjectionMatrix",F.Pass,(r,s)=>s.camera.inverseProjectionMatrix),new li("inverseViewMatrix")]),t.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(wf),i.include(mh),e.include(Aq,{pbrMode:Mt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(t4),e.include(KF),e.include(Uge,{instancedDoublePrecision:!1,isGround:!1}),i.uniforms.add(new _b("crossFade",F.Pass,r=>r.crossFade)),i.code.add(T`void main() {
vec4 cloudsColor = crossFade ?
renderCloudCrossFade(normalize(worldRay), cameraPosition) :
renderCloud(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const zVe=Object.freeze(Object.defineProperty({__proto__:null,CloudsCompositionPassParameters:zge,build:UVe},Symbol.toStringTag,{value:"Module"}));class i4 extends Ki{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=i4.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({blending:ah(Me.ONE,Me.SRC_ALPHA),depthTest:{func:Ji.LEQUAL},colorWrite:Qt})}}i4.shader=new Vi(zVe,()=>import("./CloudsComposition.glsl.644cb92f.js"));let U_=class extends be{constructor(e){super(e),this._inverseViewMatrix=Ae(),this._passParameters=new zge,this._technique=new i4(e),this._vao=ba(e.rctx),this._parameters=new kVe(e.radius)}destroy(){this._technique=$i(this._technique),this._vao=it(this._vao)}render(e,t,i){const r=e.bindParameters.camera;if(C(this._vao)||C(r))return;if(!this._technique.compiled)return void this.requestRender();this._parameters.clouds=t;const s=e.rctx,n=s.bindTechnique(this._technique,this._passParameters,e.bindParameters);jr(this._inverseViewMatrix,r.viewMatrix),n.setUniformMatrix4fv("inverseViewMatrix",this._inverseViewMatrix),n.setUniform2f("cloudVariables",this._parameters.clouds.coverage,this._parameters.clouds.absorption),this._setParallaxParams(r.eye,i),e.bindParameters.cloudsComposition=this._parameters,kge(n,r,this._parameters),s.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(Dt.TRIANGLE_STRIP,0,4),this.fading&&this.requestRender()}get fading(){return this._passParameters.crossFade||this._parameters.fadeInOut.stage!==oa.FINISHED||this._parameters.fadeIn.stage!==Mu.FINISHED||this._parameters.fadeInOutHeight.stage!==S1.FINISHED}_isCameraPositionFinal(e){return sS(this._parameters.cameraPositionLastFrame,e)}_setFadeInStage(e){const t=performance.now(),i=this._parameters,r=i.parallax.anchorPointClouds,s=this._isCameraPositionFinal(e);i.fadeIn.stage===Mu.FINISHED&&(i.fadeIn.factor=1,ne(r,Pf),i.fadeIn.stage=Mu.CHANGE_ANCHOR,this._passParameters.crossFade=!1,i.fadeInOut.stage=oa.FINISHED),i.fadeIn.stage===Mu.CHANGE_ANCHOR&&s&&(ne(r,Pf),i.fadeIn.stage=Mu.FADE_IN,i.startTime=t),i.fadeIn.factor>0&&i.fadeIn.stage===Mu.FADE_IN&&(i.fadeIn.factor=1-(t-i.startTime)/dee),i.fadeIn.factor<=0&&i.fadeIn.stage===Mu.FADE_IN&&(i.fadeIn.stage=Mu.FINISHED,i.fadeIn.factor=0)}_setCrossFadingStage(){const e=performance.now(),t=this._parameters,{crossFade:i}=t,r=t.parallax.anchorPointClouds;this._passParameters.crossFade||(ne(r,Pf),t.startTime=e,i.factor=0,this._passParameters.crossFade=!0),i.factor<1&&this._passParameters.crossFade&&(i.factor=(e-t.startTime)/GVe),i.factor>=1&&this._passParameters.crossFade&&(this._passParameters.crossFade=!1,i.factor=1,ne(r,t.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e){const t=performance.now(),i=this._parameters,{fadeInOut:r,crossFade:s}=i;r.stage===oa.FINISHED&&(i.startTime=t,r.factor=0,r.stage=oa.FADE_OUT),r.factor<1&&r.stage===oa.FADE_OUT&&(r.factor=(t-i.startTime)/VVe),r.factor>=1&&r.stage===oa.FADE_OUT&&(r.factor=1,ne(i.parallax.anchorPointClouds,Pf)),r.factor>=1&&r.stage===oa.FADE_OUT&&this._isCameraPositionFinal(e)&&(i.startTime=t,r.factor=1,r.stage=oa.FADE_IN,this._passParameters.crossFade=!1,s.factor=0),r.factor>0&&r.stage===oa.FADE_IN&&(r.factor=1-(t-i.startTime)/dee),r.factor<=0&&r.stage===oa.FADE_IN&&(r.stage=oa.FINISHED,r.factor=0)}_setFadeInOutHeight(e){const t=performance.now(),i=this._parameters,r=i.fadeInOutHeight,s=(t-(r.stage===S1.FINISHED?t:i.startTimeHeightFade))/jVe;r.factor+=e?s:-s,i.startTimeHeightFade=t,r.factor=He(r.factor,0,1),r.stage=S1.HEIGHT_FADE}_setParallaxParams(e,t){const i=this._parameters,{parallax:r}=i;i.fadeInOutHeight.factor<0&&(i.fadeInOutHeight.factor=Ie(e)-i.radius>Fu?1:0),Te(Pf,e),oe(Pf,Pf,i.radius),r.anchorPointClouds[0]===0&&r.anchorPointClouds[1]===0&&r.anchorPointClouds[2]===0&&ne(r.anchorPointClouds,Pf);const s=Ie(de(BVe,r.anchorPointClouds,Pf));let n=!0;s>i.fadeIn.distanceThresholdFactor*r.cloudsHeight||i.fadeIn.stage!==Mu.FINISHED?this._setFadeInStage(e):s>i.fadeInOut.distanceThresholdFactor*r.cloudsHeight||i.fadeInOut.stage!==oa.FINISHED?this._setFadeInOutStage(e):s>i.crossFade.distanceThresholdFactor*r.cloudsHeight&&!t||this._passParameters.crossFade?this._setCrossFadingStage():n=!1;const o=Ie(e),a=o-i.radius;if((a>1.7*Fu||a<-Fu)&&i.fadeInOutHeight.factor<1?i.fadeInOutHeight.factor=1:(a>Fu||a<-.35*Fu)&&i.fadeInOutHeight.factor<1?this._setFadeInOutHeight(!0):a<Fu&&a>-.35*Fu&&i.fadeInOutHeight.factor>0?this._setFadeInOutHeight(!1):i.fadeInOutHeight.stage=S1.FINISHED,r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(o*o-i.radius*i.radius,0))/o,GR(hee,r.anchorPointClouds,yw),r.transform=Ae(),Ha(r.transform,r.transform,yw[3],yw),n){const{parallaxNew:l}=i;GR(hee,l.anchorPointClouds,yw),l.transform=Ae(),Ha(l.transform,l.transform,yw[3],yw)}ne(i.cameraPositionLastFrame,e)}};var Mu,oa,S1;u([d({constructOnly:!0})],U_.prototype,"rctx",void 0),u([d({constructOnly:!0})],U_.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],U_.prototype,"radius",void 0),u([d({constructOnly:!0})],U_.prototype,"requestRender",void 0),U_=u([P("esri.views.3d.environment.CloudsComposition")],U_),function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"}(Mu||(Mu={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.FADE_IN=2]="FADE_IN"}(oa||(oa={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(S1||(S1={}));class kVe{constructor(t){this.radius=t,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=M(),this.parallax={anchorPointClouds:M(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.parallaxNew={anchorPointClouds:M(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.crossFade={factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:oa.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:Mu.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:S1.FINISHED,factor:-1}}}function kge(e,t,i){e.bindTexture("cubeMap",i.clouds.cubeMap.colorTexture),e.setUniform1f("cloudsHeight",i.parallax.cloudsHeight),e.setUniformMatrix4fv("rotationMatrixClouds",i.parallax.transform),e.setUniformMatrix4fv("rotationMatrixCloudsCrossFade",i.parallaxNew.transform),e.setUniform3fv("anchorPosition",i.parallax.anchorPointClouds),e.setUniform3fv("anchorPositionCrossFade",i.parallaxNew.anchorPointClouds),i.fadeInOut.stage!==oa.FINISHED?e.setUniform1f("totalFadeInOut",i.fadeInOutHeight.factor+Math.max(He(i.fadeInOut.factor,0,1))):e.setUniform1f("totalFadeInOut",i.fadeInOutHeight.factor+Math.max(He(i.fadeIn.factor,0,1))),e.setUniform1f("radiusCurvatureCorrectionFactor",i.parallax.radiusCurvatureCorrectionFactor),e.setUniform1f("crossFadeAnchorFactor",He(i.crossFade.factor,0,1)),e.setUniform1f("radius",i.radius),e.setUniform3fv("cameraPosition",t.eye)}const hee=Le(0,0,1),yw=I2(),Pf=M(),BVe=M(),dee=500,VVe=250,GVe=500,jVe=500;function HVe(e){return _(e)&&_(e.cubeMap)&&!e.running&&e.coverage>0}function Wl(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function qVe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Cq(e,t,i,r,s,n,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function Rq(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function lh(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function ew(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,f=-h*n+a*l,g=c*n-o*l;let y=i*p+r*f+s*g;return y?(y=1/y,e[0]=p*y,e[1]=(-h*r+s*c)*y,e[2]=(a*r-s*o)*y,e[3]=f*y,e[4]=(h*i-s*l)*y,e[5]=(-a*i+s*n)*y,e[6]=g*y,e[7]=(-c*i+r*l)*y,e[8]=(o*i-r*n)*y,e):null}function WVe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-r*h,e[2]=r*a-s*o,e[3]=a*l-n*h,e[4]=i*h-s*l,e[5]=s*n-i*a,e[6]=n*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*n,e}function XVe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function r4(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],g=i[1],y=i[2],v=i[3],b=i[4],w=i[5],S=i[6],x=i[7],E=i[8];return e[0]=f*r+g*o+y*c,e[1]=f*s+g*a+y*h,e[2]=f*n+g*l+y*p,e[3]=v*r+b*o+w*c,e[4]=v*s+b*a+w*h,e[5]=v*n+b*l+w*p,e[6]=S*r+x*o+E*c,e[7]=S*s+x*a+E*h,e[8]=S*n+x*l+E*p,e}function NL(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],g=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*r+g*o+c,e[7]=f*s+g*a+h,e[8]=f*n+g*l+p,e}function Oq(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=Math.sin(i),g=Math.cos(i);return e[0]=g*r+f*o,e[1]=g*s+f*a,e[2]=g*n+f*l,e[3]=g*o-f*r,e[4]=g*a-f*s,e[5]=g*l-f*n,e[6]=c,e[7]=h,e[8]=p,e}function Mq(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function YVe(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function ZVe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function QVe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function JVe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function KVe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Pq(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,g=s*a,y=s*l,v=n*o,b=n*a,w=n*l;return e[0]=1-p-y,e[3]=h-w,e[6]=f+b,e[1]=h+w,e[4]=1-c-y,e[7]=g-v,e[2]=f-b,e[5]=g+v,e[8]=1-c-p,e}function Bge(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,f=-h*n+a*l,g=c*n-o*l,y=i*p+r*f+s*g;if(!y)return null;const v=1/y;return e[0]=p*v,e[1]=(-h*r+s*c)*v,e[2]=(a*r-s*o)*v,e[3]=f*v,e[4]=(h*i-s*l)*v,e[5]=(-a*i+s*n)*v,e[6]=g*v,e[7]=(-c*i+r*l)*v,e[8]=(o*i-r*n)*v,e}function G0(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],g=t[11],y=t[12],v=t[13],b=t[14],w=t[15],S=i*a-r*o,x=i*l-s*o,E=i*c-n*o,R=r*l-s*a,O=r*c-n*a,I=s*c-n*l,U=h*v-p*y,N=h*b-f*y,V=h*w-g*y,j=p*b-f*v,H=p*w-g*v,J=f*w-g*b;let K=S*J-x*H+E*j+R*V-O*N+I*U;return K?(K=1/K,e[0]=(a*J-l*H+c*j)*K,e[1]=(l*V-o*J-c*N)*K,e[2]=(o*H-a*V+c*U)*K,e[3]=(s*H-r*J-n*j)*K,e[4]=(i*J-s*V+n*N)*K,e[5]=(r*V-i*H-n*U)*K,e[6]=(v*I-b*O+w*R)*K,e[7]=(b*E-y*I-w*x)*K,e[8]=(y*O-v*E+w*S)*K,e):null}function e8e(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function t8e(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function i8e(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function r8e(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function Vge(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function s8e(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function n8e(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function o8e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function a8e(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],f=t[1],g=t[2],y=t[3],v=t[4],b=t[5],w=t[6],S=t[7],x=t[8];return Math.abs(i-p)<=Rt*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=Rt*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-g)<=Rt*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(n-y)<=Rt*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-v)<=Rt*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-b)<=Rt*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(l-w)<=Rt*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-S)<=Rt*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-x)<=Rt*Math.max(1,Math.abs(h),Math.abs(x))}function Iq(e){const t=Rt,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const l8e=r4,c8e=Vge;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:Wl,copy:qVe,set:Cq,identity:Rq,transpose:lh,invert:ew,adjoint:WVe,determinant:XVe,multiply:r4,translate:NL,rotate:Oq,scale:Mq,scaleByVec2:YVe,fromTranslation:ZVe,fromRotation:QVe,fromScaling:JVe,fromMat2d:KVe,fromQuat:Pq,normalFromMat4Legacy:Bge,normalFromMat4:G0,projection:e8e,str:t8e,frob:i8e,add:r8e,subtract:Vge,multiplyScalar:s8e,multiplyScalarAndAdd:n8e,exactEquals:o8e,equals:a8e,isOrthoNormal:Iq,mul:l8e,sub:c8e},Symbol.toStringTag,{value:"Module"}));var od;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(od||(od={}));class Gge extends _a{constructor(){super(...arguments),this.steps=od.SIXTEEN}}u([B({count:od.COUNT})],Gge.prototype,"steps",void 0);function uv(e,t=!0){e.attributes.add(A.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(T`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?T`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}function u8e(){const e=new Fi;e.include(uv,!1),e.fragment.uniforms.add(new ye("tileRows")),e.fragment.uniforms.add(new ye("tileSize"));const t=2,i=8;return e.fragment.code.add(T`
    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    vec4 taylorInvSqrt(vec4 r) {
      return 1.79284291400159 - 0.85373472095314 * r;
    }

    vec4 mod289(vec4 x) {
      return x - floor( x * (1.0 / 289.0)) * 289.0;
    }

    vec4 permute(vec4 x) {
      return mod289(((x * 34.0) + 1.0) * x);
    }

    vec4 fade(vec4 t) {
      return (t * t * t) * (t * (t * vec4(6.0) - vec4(15.0)) + vec4(10.0));
    }

    float glmPerlin(vec4 Position, vec4 rep) {
      vec4 Pi0 = mod(floor(Position), rep);
      vec4 Pi1 = mod(Pi0 + 1.0, rep);
      vec4 Pf0 = fract(Position);
      vec4 Pf1 = Pf0 - 1.0;
      vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
      vec4 iy = vec4(Pi0.y, Pi0.y, Pi1.y, Pi1.y);

      vec4 ixy = permute(permute(ix) + iy);
      vec4 ixy0 = permute(ixy + vec4(Pi0.z));
      vec4 ixy1 = permute(ixy + vec4(Pi1.z));
      vec4 ixy00 = permute(ixy0 + vec4(Pi0.w));
      vec4 ixy01 = permute(ixy0 + vec4(Pi1.w));
      vec4 ixy10 = permute(ixy1 + vec4(Pi0.w));
      vec4 ixy11 = permute(ixy1 + vec4(Pi1.w));

      vec4 gx00 = ixy00 / 7.0;
      vec4 gy00 = floor(gx00) / 7.0;
      vec4 gz00 = floor(gy00) / 6.0;
      gx00 = fract(gx00) - 0.5;
      gy00 = fract(gy00) - 0.5;
      gz00 = fract(gz00) - 0.5;
      vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);
      vec4 sw00 = step(gw00, vec4(0.0));
      gx00 -= sw00 * (step(0.0, gx00) - 0.5);
      gy00 -= sw00 * (step(0.0, gy00) - 0.5);

      vec4 gx01 = ixy01 / 7.0;
      vec4 gy01 = floor(gx01) / 7.0;
      vec4 gz01 = floor(gy01) / 6.0;
      gx01 = fract(gx01) - 0.5;
      gy01 = fract(gy01) - 0.5;
      gz01 = fract(gz01) - 0.5;
      vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);
      vec4 sw01 = step(gw01, vec4(0.0));
      gx01 -= sw01 * (step(0.0, gx01) - 0.5);
      gy01 -= sw01 * (step(0.0, gy01) - 0.5);

      vec4 gx10 = ixy10 / 7.0;
      vec4 gy10 = floor(gx10) / 7.0;
      vec4 gz10 = floor(gy10) / 6.0;
      gx10 = fract(gx10) - 0.5;
      gy10 = fract(gy10) - 0.5;
      gz10 = fract(gz10) - 0.5;
      vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);
      vec4 sw10 = step(gw10, vec4(0.0));
      gx10 -= sw10 * (step(0.0, gx10) - 0.5);
      gy10 -= sw10 * (step(0.0, gy10) - 0.5);

      vec4 gx11 = ixy11 / 7.0;
      vec4 gy11 = floor(gx11) / 7.0;
      vec4 gz11 = floor(gy11) / 6.0;
      gx11 = fract(gx11) - 0.5;
      gy11 = fract(gy11) - 0.5;
      gz11 = fract(gz11) - 0.5;
      vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);
      vec4 sw11 = step(gw11, vec4(0.0));
      gx11 -= sw11 * (step(0.0, gx11) - 0.5);
      gy11 -= sw11 * (step(0.0, gy11) - 0.5);

      vec4 g0000 = vec4(gx00.x, gy00.x, gz00.x, gw00.x);
      vec4 g1000 = vec4(gx00.y, gy00.y, gz00.y, gw00.y);
      vec4 g0100 = vec4(gx00.z, gy00.z, gz00.z, gw00.z);
      vec4 g1100 = vec4(gx00.w, gy00.w, gz00.w, gw00.w);
      vec4 g0010 = vec4(gx10.x, gy10.x, gz10.x, gw10.x);
      vec4 g1010 = vec4(gx10.y, gy10.y, gz10.y, gw10.y);
      vec4 g0110 = vec4(gx10.z, gy10.z, gz10.z, gw10.z);
      vec4 g1110 = vec4(gx10.w, gy10.w, gz10.w, gw10.w);
      vec4 g0001 = vec4(gx01.x, gy01.x, gz01.x, gw01.x);
      vec4 g1001 = vec4(gx01.y, gy01.y, gz01.y, gw01.y);
      vec4 g0101 = vec4(gx01.z, gy01.z, gz01.z, gw01.z);
      vec4 g1101 = vec4(gx01.w, gy01.w, gz01.w, gw01.w);
      vec4 g0011 = vec4(gx11.x, gy11.x, gz11.x, gw11.x);
      vec4 g1011 = vec4(gx11.y, gy11.y, gz11.y, gw11.y);
      vec4 g0111 = vec4(gx11.z, gy11.z, gz11.z, gw11.z);
      vec4 g1111 = vec4(gx11.w, gy11.w, gz11.w, gw11.w);

      vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));
      g0000 *= norm00.x;
      g0100 *= norm00.y;
      g1000 *= norm00.z;
      g1100 *= norm00.w;

      vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));
      g0001 *= norm01.x;
      g0101 *= norm01.y;
      g1001 *= norm01.z;
      g1101 *= norm01.w;

      vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));
      g0010 *= norm10.x;
      g0110 *= norm10.y;
      g1010 *= norm10.z;
      g1110 *= norm10.w;

      vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));
      g0011 *= norm11.x;
      g0111 *= norm11.y;
      g1011 *= norm11.z;
      g1111 *= norm11.w;

      float n0000 = dot(g0000, Pf0);
      float n1000 = dot(g1000, vec4(Pf1.x, Pf0.y, Pf0.z, Pf0.w));
      float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.z, Pf0.w));
      float n1100 = dot(g1100, vec4(Pf1.x, Pf1.y, Pf0.z, Pf0.w));
      float n0010 = dot(g0010, vec4(Pf0.x, Pf0.y, Pf1.z, Pf0.w));
      float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));
      float n0110 = dot(g0110, vec4(Pf0.x, Pf1.y, Pf1.z, Pf0.w));
      float n1110 = dot(g1110, vec4(Pf1.x, Pf1.y, Pf1.z, Pf0.w));
      float n0001 = dot(g0001, vec4(Pf0.x, Pf0.y, Pf0.z, Pf1.w));
      float n1001 = dot(g1001, vec4(Pf1.x, Pf0.y, Pf0.z, Pf1.w));
      float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));
      float n1101 = dot(g1101, vec4(Pf1.x, Pf1.y, Pf0.z, Pf1.w));
      float n0011 = dot(g0011, vec4(Pf0.x, Pf0.y, Pf1.z, Pf1.w));
      float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.z, Pf1.w));
      float n0111 = dot(g0111, vec4(Pf0.x, Pf1.y, Pf1.z, Pf1.w));
      float n1111 = dot(g1111, Pf1);

      vec4 fade_xyzw = fade(Pf0);
      vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);
      vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);
      vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);
      vec2 n_yzw = mix(vec2(n_zw.x, n_zw.y), vec2(n_zw.z, n_zw.w), fade_xyzw.y);
      float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);
      return 2.2 * n_xyzw;
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * glmPerlin(vec4(p, 0.0), vec4(frequency));
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float hash(float p) {
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);;
    }

    float noise(vec3 x) {
      vec3 p = floor(x);
      vec3 f = fract(x);

      f = f * f * (3.0 - 2.0 * f);
      float n = p.x + p.y * 57.0 + 113.0 * p.z;

      return mix(
      mix(
        mix(hash(n + 0.0), hash(n + 1.0), f.x),
        mix(hash(n + 57.0), hash(n + 58.0), f.x),
        f.y),
      mix(
        mix(hash(n + 113.0), hash(n + 114.0), f.x),
        mix(hash(n + 170.0), hash(n + 171.0), f.x),
        f.y),
      f.z);
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - noise(mod(tp, numCells));
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv, float tileRows) {
      vec2 tile = floor(uv);
      float z = floor(tileRows * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${T.float(i)});

      float worley0 = worley(p, ${T.float(t)} * 2.0);
      float worley1 = worley(p, ${T.float(t)} * 8.0);
      float worley2 = worley(p, ${T.float(t)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${T.float(t)});
      float worley1 = worley(p, ${T.float(t)} * 2.0);
      float worley2 = worley(p, ${T.float(t)} * 4.0);
      float worley3 = worley(p, ${T.float(t)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.code.add(T`void main() {
float padWidth = 1.0;
float paddedSize = tileSize + 2.0 * padWidth;
float tileCount = tileRows * tileRows;
vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);
bool padCell = false;
if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
padCell = true;
}
if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
padCell = true;
}
bool startPadX = false;
bool startPadY = false;
bool endPadX = false;
bool endPadY = false;
if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
startPadX = true;
}
if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
startPadY = true;
}
if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
endPadX = true;
}
if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
endPadY = true;
}
vec2 padding = vec2(2.0 * padWidth) * tile;
vec2 uv;
if (padCell) {
vec2 pixel = gl_FragCoord.xy - padWidth - padding;
if (startPadX) {
pixel.x += tileSize;
}
if (startPadY) {
pixel.y += tileSize;
}
if (endPadX) {
pixel.x -= tileSize;
}
if (endPadY) {
pixel.y -= tileSize;
}
uv = vec2(pixel.xy / tileSize);
} else {
vec2 pixel = gl_FragCoord.xy - padWidth - padding;
uv = vec2(pixel.xy / tileSize);
}
vec3 p_ = get3Dfrom2D(uv, tileRows);
vec3 p = p_;
p.z /= (tileRows * tileRows);
float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
float worleyNoise = getTextureForPointWorley(p);
gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
p_ = mod(p_ + 1.0, tileRows * tileRows);
p = p_;
p.z /= (tileRows * tileRows);
worleyPerlinNoise = getTextureForPointPerlinWorley(p);
worleyNoise = getTextureForPointWorley(p);
gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
gl_FragColor.ba = vec2(0.0, 1.0);
}`),e}const h8e=Object.freeze(Object.defineProperty({__proto__:null,build:u8e},Symbol.toStringTag,{value:"Module"}));class s4 extends Ki{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=s4.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({blending:ah(Me.ONE,Me.ZERO),depthTest:{func:Ji.LEQUAL},colorWrite:Qt})}}s4.shader=new Vi(h8e,()=>import("./NoiseTextureAtlas.glsl.c24765fa.js"));class Vx{constructor(t,i){this._context=t,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(en.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==xi.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,i=this._context.parameters.maxSamples;return t?Math.min(t,i):i}resize(t,i){const r=this._desc;if(r.width===t&&r.height===i)return;r.width=t,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(en.Renderbuffer,this),this._context=null)}}const d8e=pe.getLogger("esri.views.webgl.FrameBufferObject");class hr{constructor(t,i,r=null,s=null){if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=L({},i),t.instanceCounter.increment(en.FramebufferObject,this),_(r)){Array.isArray(r)||(r=[r]);for(let o=0;o<r.length;++o){const a=r[o],l=_c.COLOR_ATTACHMENT0+o;let c;fee(a)?(am(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new ot(this._context,c))),MP(c,this._desc)):(pee(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new Vx(this._context,c))),hz(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(_(s)){let o,a;if(fee(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),am(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new ot(this._context,a)),MP(a,this._desc);else{var n;pee(s)?(a=s.descriptor,o=s):(a=s,o=new Vx(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:_i.DEPTH_STENCIL_RENDER_BUFFER;l===_i.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===_i.DEPTH_RENDER_BUFFER||l===_i.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),hz(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(en.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(_c.COLOR_ATTACHMENT0);return t&&am(t)?t:null}get colorAttachment(){return this._colorAttachments.get(_c.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[i,r])=>t+R0(r),0)+R0(this.depthStencilAttachment)}getColorTexture(t){const i=this._colorAttachments.get(t);return i&&am(i)?i:null}attachColorTexture(t,i=_c.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(i),MP(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,i)),this._colorAttachments.set(i,t))}detachColorTexture(t=_c.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);if(am(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}}setColorTextureTarget(t,i=_c.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);am(r)&&this._framebufferTexture2D(r.glName,i,t)}attachDepthStencilTexture(t){if(C(t))return;const i=t.descriptor;i.pixelFormat!==ze.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Ct.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),MP(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==_i.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=_i.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,TZ)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,TZ)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(C(t))return;const i=t.descriptor;if(i.internalFormat!==la.DEPTH_STENCIL&&i.internalFormat!==la.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),hz(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===la.DEPTH_STENCIL?_i.DEPTH_STENCIL_RENDER_BUFFER:_i.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===_i.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(cn.FRAMEBUFFER,s,r.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===_i.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(cn.FRAMEBUFFER,r,t.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((t,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,i,r,s,n,o,a){(t<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==pt.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,ot.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(ot.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(pt.TEXTURE_2D,0,n,o,t,i,r,s),h.bindTexture(p,ot.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,i,r,s,n,o,a)}async readPixelsAsync(t,i,r,s,n,o,a){if(this._context.type!==xi.WEBGL2)return $u()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,i,r,s,n,o,a);const l=this._context.gl,c=si.createPixelPack(this._context,mi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,i,r,s,n,o,0),this._context.unbindBuffer(wt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,i){const r=this._desc;if(r.width!==t||r.height!==i){if(!this._initialized)return r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,i));r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,i),this._stencilAttachment&&this._stencilAttachment.resize(t,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=cn.FRAMEBUFFER){var i,r,s,n;const o=this._context.gl;if(this._initialized)return void o.bindFramebuffer(t,this.glName);this._glName&&o.deleteFramebuffer(this._glName);const a=this._context,l=o.createFramebuffer(),c=this._desc,h=(i=c.colorTarget)!=null?i:Gr.RENDER_BUFFER,p=(r=c.width)!=null?r:1,f=(s=c.height)!=null?s:1;if(o.bindFramebuffer(t,l),this._colorAttachments.size===0)if(h===Gr.TEXTURE||h===Gr.CUBEMAP)this._colorAttachments.set(_c.COLOR_ATTACHMENT0,p8e(a,c,this.descriptor.colorTarget===Gr.CUBEMAP?pt.TEXTURE_CUBE_MAP:pt.TEXTURE_2D));else{const y=new Vx(a,{internalFormat:mt.RGBA4,width:p,height:f});this._colorAttachments.set(_c.COLOR_ATTACHMENT0,y)}this._colorAttachments.forEach((y,v)=>{y&&(am(y)?this._framebufferTexture2D(y.glName,v,mee(y),t):o.framebufferRenderbuffer(t,v,o.RENDERBUFFER,y.glName))});const g=(n=c.depthStencilTarget)!=null?n:_i.NONE;switch(g){case _i.DEPTH_RENDER_BUFFER:case _i.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new Vx(a,{internalFormat:c.depthStencilTarget===_i.DEPTH_RENDER_BUFFER?la.DEPTH_COMPONENT16:la.DEPTH_STENCIL,width:p,height:f}));const y=g===_i.DEPTH_RENDER_BUFFER?o.DEPTH_ATTACHMENT:o.DEPTH_STENCIL_ATTACHMENT;o.framebufferRenderbuffer(t,y,o.RENDERBUFFER,this._depthAttachment.glName);break}case _i.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new Vx(a,{internalFormat:la.STENCIL_INDEX8,width:p,height:f})),o.framebufferRenderbuffer(t,o.STENCIL_ATTACHMENT,o.RENDERBUFFER,this._stencilAttachment.glName);break;case _i.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){a.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const y={target:pt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:Ct.UNSIGNED_INT_24_8,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:p,height:f};this._depthStencilTexture=new ot(a,y)}this._framebufferTexture2D(this._depthStencilTexture.glName,o.DEPTH_STENCIL_ATTACHMENT,mee(this._depthStencilTexture),t)}kR()&&o.checkFramebufferStatus(t)!==o.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=l,this._initialized=!0}_framebufferTexture2D(t,i=_c.COLOR_ATTACHMENT0,r=pt.TEXTURE_2D,s=cn.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,t,n)}_detachColorAttachment(t){$u()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(t);return am(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(cn.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._colorAttachments.delete(t),r}_disposeColorAttachments(){this._colorAttachments.forEach((t,i)=>{this._detachColorAttachment(i),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===_i.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(cn.FRAMEBUFFER,i,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(cn.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(hr._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;hr._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else hr._MAX_COLOR_ATTACHMENTS=1}const i=t-_c.COLOR_ATTACHMENT0;i+1>hr._MAX_COLOR_ATTACHMENTS&&d8e.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${hr._MAX_COLOR_ATTACHMENTS} color attachments`)}}function am(e){return"type"in e&&e.type==="texture"}function pee(e){return"type"in e&&e.type==="renderbuffer"}function fee(e){return am(e)||"pixelFormat"in e}function p8e(e,t,i){return new ot(e,{target:i,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:t.width,height:t.height})}function MP(e,t){e.target!==pt.TEXTURE_2D&&e.target!==pt.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function hz(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function mee(e){return e.descriptor.target===pt.TEXTURE_CUBE_MAP?pt.TEXTURE_CUBE_MAP_POSITIVE_X:pt.TEXTURE_2D}hr._MAX_COLOR_ATTACHMENTS=-1;const zS=ue("esri-mobile")?64:128,f8e=zS/128,$q=Math.ceil(Math.sqrt(zS)),Gy=(zS+2)*$q;class m8e{constructor(t,i){let r;this._frameBuffer=new hr(t,{colorTarget:Gr.TEXTURE,width:Gy,height:Gy},{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,hasMipmap:!1,width:Gy,height:Gy}),this._vao=ba(t),this._technique=new s4({rctx:t,viewingMode:i.state.viewingMode}),this._ensureRendered=()=>(_(r)||_(this._technique)&&this._technique.compiled&&(r=this._render(t)),r)}get textureAtlas(){return this._ensureRendered()}destroy(){this._technique=$i(this._technique),this._frameBuffer=it(this._frameBuffer),this._vao=it(this._vao)}_render(t){if(C(this._technique)||C(this._vao)||C(this._frameBuffer))return null;const i=t.getViewport();t.setViewport(0,0,Gy,Gy),t.bindFramebuffer(this._frameBuffer);const r=t.bindTechnique(this._technique);return r.setUniform1f("tileSize",zS),r.setUniform1f("tileRows",$q),t.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(i.x,i.y,i.width,i.height),this._technique=$i(this._technique),this._vao=it(this._vao),this._frameBuffer.colorTexture}}class qp extends eu{constructor(t,i,r){switch(i){case F.Pass:return void super(t,"mat3",i,(s,n,o)=>s.setUniformMatrix3fv(t,r(n,o)));case F.Draw:return void super(t,"mat3",i,(s,n,o)=>s.setUniformMatrix3fv(t,r(n,o)))}}}class jge extends qs{constructor(){super(...arguments),this.viewMatrix=Qi()}}function g8e(e){const t=new Fi;return t.include(uv,!1),t.fragment.uniforms.add(new ye("cloudRadius")),t.fragment.uniforms.add(new ye("halfCubeMapSize")),t.fragment.uniforms.add(new ye("power")),t.fragment.uniforms.add(new ye("sigmaE")),t.fragment.uniforms.add(new ye("density")),t.fragment.uniforms.add(new ye("cloudSize")),t.fragment.uniforms.add(new ye("detailSize")),t.fragment.uniforms.add(new ye("smoothness")),t.fragment.uniforms.add(new ye("cloudHeight")),t.fragment.uniforms.add(new ye("coverage")),t.fragment.uniforms.add(new qp("view",F.Draw,i=>i.viewMatrix)),t.fragment.uniforms.add(new et("cloudShapeTexture")),t.fragment.code.add(T`
    const int STEPS = ${e.steps===od.SIXTEEN?T`16`:e.steps===od.HUNDRED?T`100`:T`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);

    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(T`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${T.float(Gy)};
      const float dataWidth = ${T.float(Gy)};
      const float tileRows = ${T.float($q)};
      const vec3 atlasDimensions = vec3(${T.float(zS)}, ${T.float(zS)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${T.float(f8e)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }`),t.fragment.code.add(T`float clouds(vec3 p) {
float cloudVariations = getCloudShape(0.002 * p, 0.5);
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
cloud += (cloudVariations * 0.6 - 0.3) * ( -4.0 * (coverage * coverage - coverage));
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * saturate(remap(heightFraction, 0.75, 1.0, 1.0, 0.0));
float shape = getCloudShape(cloudSize * p, 0.0);
shape *= mix(0.0, 1.0, min(2.0 * (1.0 - coverage), 1.0));
cloud = saturate(remap(cloud, shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(T`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(T`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(T`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(T`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const y8e=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:jge,build:g8e},Symbol.toStringTag,{value:"Module"}));class fE{constructor(t,i,r,s,n,o,a,l,c=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingStepType=l,this.median=c}}const Hge={sunny:new fE([.1,.7],[.02,.02],[0,0],[.86,.86],[.8,.8],[.5,.5],[.05,.05],od.SIXTEEN),cloudy:new fE([.24,.7],[.135,.2],[0,0],[.5,.5],[.65,.7],[.3,.3],[1,1],od.TWOHUNDRED),rainy:new fE([.5,.9],[.2,.5],[.3,.6],[.4,.4],[.7,.7],[.5,.5],[1,1],od.TWOHUNDRED),snowy:new fE([.5,.9],[.2,.5],[0,0],[.4,.4],[.7,.7],[.5,.5],[1,1],od.TWOHUNDRED),foggy:new fE([.8,.8],[.5,.5],[0,0],[.85,.85],[.75,.75],[.8,.8],[.3,.3],od.HUNDRED)};class n4 extends Ki{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=n4.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({blending:po(Me.ONE,Me.ONE,Me.ZERO,Me.ZERO),depthTest:{func:Ji.LEQUAL},colorWrite:Qt})}}n4.shader=new Vi(y8e,()=>import("./Clouds.glsl.8455fc59.js"));function qge(e){e.include(Zc),e.uniforms.add(new et("geometryDepthTexture")),e.uniforms.add(new Ft("nearFar",F.Pass,(t,i)=>i.camera.nearFar)),e.code.add(T`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class v8e{constructor(){this.enabled=!1}}function Wge(e,t){t.enabled&&t.linearDepthTexture&&e.bindTexture("geometryDepthTexture",t.linearDepthTexture)}function Qc(e,t){t.hasMultipassTerrain&&(e.fragment.include(Zc),e.fragment.uniforms.add(new et("terrainDepthTexture",F.Pass,(i,r)=>r.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new Ft("nearFar",F.Pass,(i,r)=>r.camera.nearFar)),e.fragment.uniforms.add(new Ft("inverseViewport",F.Pass,(i,r)=>r.inverseViewport)),e.fragment.code.add(T`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class _8e{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function b8e(e,t){const i=e.fragment.uniforms;i.add(new Ft("nearFar",F.Pass,(r,s)=>s.camera.nearFar)),i.add(new et("depthMapView",F.Pass,(r,s)=>s.ssr.linearDepthTexture)),i.add(new li("view",F.Pass,(r,s)=>s.ssr.camera.viewMatrix)),i.add(new li("proj",F.Pass,(r,s)=>s.ssr.camera.projectionMatrix)),i.add(new ye("invResolutionHeight",F.Pass,(r,s)=>1/s.ssr.camera.height)),i.add(new et("lastFrameColorMap",F.Pass,(r,s)=>s.ssr.lastFrameColorTexture)),i.add(new li("reprojectionMatrix",F.Pass,(r,s)=>s.ssr.reprojectionMatrix)),e.fragment.include(Zc),e.fragment.code.add(T`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class w8e{constructor(){this.reprojectionMatrix=Ae()}}class Dq{constructor(t=M()){this.intensity=t}}class Xge{constructor(t=M(),i=Le(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class eG{constructor(t=M(),i=Le(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=t,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}class Yge{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function x8e(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function dz(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function UT(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function Zge(e){return(e+1)*(e+1)}function T8e(e){return He(Math.floor(Math.sqrt(e)-1),0,2)}function Qge(e,t,i){const r=e[0],s=e[1],n=e[2],o=i||[];return o.length=Zge(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function S8e(e,t){const i=Zge(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function E8e(e,t){const i=T8e(t.r.length);for(const r of e)Do(tG,r.direction),Qge(tG,i,Im),x8e(Im,U$),dz(Im,r.intensity[0],vw),UT(t.r,vw),dz(Im,r.intensity[1],vw),UT(t.g,vw),dz(Im,r.intensity[2],vw),UT(t.b,vw);return t}function A8e(e,t){Qge(tG,0,Im);for(const i of e)t.r[0]+=Im[0]*U$[0]*i.intensity[0]*4*Math.PI,t.g[0]+=Im[0]*U$[0]*i.intensity[1]*4*Math.PI,t.b[0]+=Im[0]*U$[0]*i.intensity[2]*4*Math.PI;return t}function C8e(e,t,i,r){S8e(t,r),se(i.intensity,0,0,0);let s=!1;const n=R8e,o=O8e,a=M8e;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof eG&&!s?(ne(i.direction,l.direction),ne(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof eG||l instanceof Xge?n.push(l):l instanceof Dq?o.push(l):l instanceof Yge&&a.push(l);E8e(n,r),A8e(o,r);for(const l of a)UT(r.r,l.r),UT(r.g,l.g),UT(r.b,l.b)}const R8e=[],O8e=[],M8e=[],Im=[0],vw=[0],tG=M(),U$=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],$2=.4;class P8e{constructor(){this._shOrder=2,this._oldSunlight={direction:M(),ambient:{color:M(),intensity:1},diffuse:{color:M(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new Yge,this._mainLight={intensity:M(),direction:Le(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(t){C8e(t,this._shOrder,this._mainLight,this._sphericalHarmonics),ne(this._oldSunlight.direction,this._mainLight.direction);const i=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,oe(this._oldSunlight.diffuse.color,this._mainLight.intensity,i),ne(PP,this._oldSunlight.diffuse.color),oe(PP,PP,$2*this.globalFactor),fe(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,PP)}get old(){return this._oldSunlight}}const PP=M();class o4{constructor(t,i,r){this.shadowMap=t,this.ssaoHelper=i,this.slicePlane=r,this.slot=we.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=lt(),this.lighting=new P8e,this.ssr=new w8e,this.multipassTerrain=new _8e,this.multipassGeometry=new v8e}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}let Yo=class extends be{constructor(e){super(e),this._frameTask=null,this._handles=new Jt,this._cubeMapSize=ue("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new Gge,this._bindParameters=new o4(null,null,null),this._drawParameters=new jge,this.coverage=ti(xa.coverage[0],xa.coverage[1],.5),this.density=ti(xa.density[0],xa.density[1],.5),this.absorption=ti(xa.absorption[0],xa.absorption[1],.5),this.cloudSize=ti(xa.cloudSize[0],xa.cloudSize[1],.5),this.detailSize=ti(xa.detailSize[0],xa.detailSize[1],.5),this.smoothness=ti(xa.smoothness[0],xa.smoothness[1],.5),this.cloudHeight=ti(xa.cloudHeight[0],xa.cloudHeight[1],.5),this.raymarchingStepType=xa.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=Ae(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new n4({rctx:this.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}initialize(){this._vao=ba(this.rctx);const e=Ci(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(xe(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),Bi))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>$i(e)),this._techniques=null,this._frameBufferCube=it(this._frameBufferCube),this._vao=it(this._vao),this._noiseTexture=ct(this._noiseTexture)}_ensureNoiseTexture(){return C(this._noiseTexture)&&(this._noiseTexture=new m8e(this.rctx,this.view)),this._noiseTexture.textureAtlas}get frameBufferCube(){if(C(this._frameBufferCube)){const e={target:pt.TEXTURE_CUBE_MAP,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new hr(this.rctx,{colorTarget:Gr.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}applyPreset(e,t){const i=e.median,r=s=>{const n=ti(s[0],s[1],i);return t<.5?ti(s[0],n,2*t):ti(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||C(this._vao))return void(this.running=!1);const t=this._ensureNoiseTexture();if(C(t))return;const i=this._getTechnique(this.raymarchingStepType);if(!i.compiled)return;const r=this.rctx.getViewport();this.rctx.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),this.rctx.bindFramebuffer(this.frameBufferCube);const s=this.rctx.bindTechnique(i),n=1+this.absorption,o=ti(35,120,this.absorption);s.bindTexture("cloudShapeTexture",t),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",o),s.setUniform1f("sigmaE",n),s.setUniform1f("density",ti(0,.3,this.density)),s.setUniform1f("cloudSize",ti(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",ti(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",ti(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",ti(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),this.rctx.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);for(let a=0;a<5;a++){const l=I8e[a],c=$8e[a];iue(this._viewMatrix,D8e,l,c),Wl(this._drawParameters.viewMatrix,this._viewMatrix);const h=pt.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.frameBufferCube.setColorTextureTarget(h),s.bindDraw(this._drawParameters,this._bindParameters),this.rctx.gl.drawArrays(this.rctx.gl.TRIANGLE_STRIP,0,4),this.rctx.gl.flush()}this.running=!1,this.rctx.setViewport(r.x,r.y,r.width,r.height),this.requestRender(),e.madeProgress()}};u([d({constructOnly:!0})],Yo.prototype,"rctx",void 0),u([d({constructOnly:!0})],Yo.prototype,"view",void 0),u([d({constructOnly:!0})],Yo.prototype,"requestRender",void 0),u([d()],Yo.prototype,"_frameTask",void 0),u([d()],Yo.prototype,"coverage",void 0),u([d()],Yo.prototype,"density",void 0),u([d()],Yo.prototype,"absorption",void 0),u([d()],Yo.prototype,"cloudSize",void 0),u([d()],Yo.prototype,"detailSize",void 0),u([d()],Yo.prototype,"smoothness",void 0),u([d()],Yo.prototype,"cloudHeight",void 0),u([d()],Yo.prototype,"raymarchingStepType",void 0),u([d()],Yo.prototype,"running",void 0),Yo=u([P("esri.views.3d.environment.CloudsGenerator")],Yo);const I8e=[Ai(1,0,0),Ai(-1,0,0),Ai(0,1,0),Ai(0,-1,0),Ai(0,0,1)],$8e=[Ai(0,1,0),Ai(0,1,0),Ai(0,0,-1),Ai(0,0,1),Ai(0,1,0)],D8e=xq(),xa=Hge.sunny;function L8e(e){const t=new Fi;t.attributes.add(A.POSITION,"vec2"),t.include(jm,{textureCoordinateType:Gs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add(new li("inverseProjectionMatrix",F.Pass,(s,n)=>n.camera.inverseProjectionMatrix)),i.uniforms.add(new li("inverseViewMatrix")),i.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new ye("atmosphereC")),r.uniforms.add(new ke("cameraPosition")),r.uniforms.add(new Ft("nearFar",F.Pass,(s,n)=>n.camera.nearFar)),r.uniforms.add(new et("depthTex")),r.uniforms.add(new ye("fogStrength")),r.uniforms.add(new ye("fogAmount")),r.uniforms.add(new ke("fogColor")),t.include(KF),r.include(Zc),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(T`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?T`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const N8e=Object.freeze(Object.defineProperty({__proto__:null,build:L8e},Symbol.toStringTag,{value:"Module"}));class jR extends Ki{initializeProgram(t){const i=jR.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}initializePipeline(){return this.configuration.haze?Ut({blending:po(Me.ONE,Me.ZERO,Me.ONE_MINUS_SRC_COLOR,Me.ONE),colorWrite:Qt}):Ut({blending:po(Me.SRC_ALPHA,Me.ZERO,Me.ONE_MINUS_SRC_ALPHA,Me.ONE),colorWrite:Qt})}}jR.shader=new Vi(N8e,()=>import("./Fog.glsl.546a1452.js"));class iG extends _a{constructor(){super(...arguments),this.haze=!1}}u([B()],iG.prototype,"haze",void 0);let oC=class extends be{constructor(e){super(e),this._viewInverse=Ae(),this._fogColor=vi(),this._fogColorAtNight=vi(),this._cameraDirection=vi(),this._foggyFadeStart=.3,this._foggyFadeEnd=.6,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=ba(t,tM);const i=Ci(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+L$}destroy(){this._hazeFogTechnique=$i(this._hazeFogTechnique),this._thickFogTechnique=$i(this._thickFogTechnique),this._vao=it(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(C(this._thickFogTechnique)){const e=new iG;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(jR,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(C(this._hazeFogTechnique)){const e=new iG;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(jR,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,i){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,i),this._fogAmount<=0))return;const r=t?this.thickFogTechnique:this.hazeFogTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,n=e.rctx.bindTechnique(r,F8e,e.bindParameters);s.renderDepthDetached(()=>{n.bindTexture("depthTex",s.depthTexture),this._renderFog(r.program,e)})}_renderFog(e,t){if(C(this._vao))return!1;const i=t.rctx,r=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",r.eye),e.setUniformMatrix4fv("inverseViewMatrix",this._viewInverse),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Dt.TRIANGLE_STRIP,0,4),!0}_update(e,t,i){const r=e.bindParameters.camera,s=t?.1:0;i?se(this._fogColor,.5,.5,.5):t?se(this._fogColor,1.5,1.5,1.5):se(this._fogColor,.24,.44,.8),oe(this._fogColorAtNight,this._fogColor,s),Te(this._cameraDirection,r.eye);const n=Math.max(0,Se(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));Cs(this._fogColor,this._fogColorAtNight,this._fogColor,n),jr(this._viewInverse,r.viewMatrix);const o=Ie(r.eye),a=o*o;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-aS(this._foggyFadeStart*Fu,this._foggyFadeEnd*Fu,Math.abs(o-this._planetRadius)):1-aS(this._hazeFadeStart*Fu,this._hazeFadeEnd*Fu,Math.abs(o-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],oC.prototype,"context",void 0),u([d({constructOnly:!0})],oC.prototype,"view",void 0),oC=u([P("esri.views.3d.environment.Fog")],oC);const F8e=new qs;async function ch(e,t){const{data:i}=await Pi(e,L({responseType:"image"},t));return i}var of;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(of||(of={}));class FL extends _a{constructor(){super(...arguments),this.geometry=of.Cone}}u([B({count:of.COUNT})],FL.prototype,"geometry",void 0);function ao(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class Lq extends qs{}function U8e(e){const t=new Fi,{vertex:i,fragment:r}=t;if(e.geometry===of.Underground)t.attributes.add(A.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add([new ke("lightingMainDirection",F.Pass,(s,n)=>n.lighting.lightingMainDirection),new ke("cameraPosition"),new ye("undergroundFadeAlpha")]),i.code.add(T`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(T`void main() {
gl_FragColor = color;
}`);else{t.include(ao),t.attributes.add(A.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===of.Cylinder;i.uniforms.add([new li("proj",F.Pass,(a,l)=>l.camera.projectionMatrix),new li("view"),new ke("lightingMainDirection",F.Pass,(a,l)=>l.lighting.lightingMainDirection)]),s||(t.varyings.add("innerFactor","float"),i.uniforms.add(new ke("silCircleCenter")),i.uniforms.add(new ke("silCircleV1")),i.uniforms.add(new ke("silCircleV2")),i.uniforms.add(new Ft("texV")),i.uniforms.add(new ye("innerScale")));const n=6.2831853,o=1/128;i.code.add(T`
		void main(void) {
      ${s?T`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:T`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${T.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${T.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new et("tex",F.Pass,a=>a.texture)),s||r.uniforms.add(new ye("altitudeFade")),r.code.add(T`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?T`gl_FragColor = atmosphereColor;`:T`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const z8e=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:Lq,build:U8e},Symbol.toStringTag,{value:"Module"}));class kS extends Ki{initializeProgram(t){const i=kS.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}initializePipeline(){return this.configuration.geometry===of.Cylinder?Ut({blending:po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),culling:mq,depthTest:{func:Ji.LEQUAL},colorWrite:Qt}):Ut({blending:po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ji.LEQUAL},colorWrite:Qt})}}kS.shader=new Vi(z8e,()=>import("./SimpleAtmosphere.glsl.a5578684.js"));const Jge="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function Zl(e,t=0){const i=e.stride;return e.fieldNames.filter(r=>{const s=e.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,o=k8e(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new Un(r,n,o,a,i,l,t)})}function k8e(e){const t=B8e[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const B8e={u8:ut.UNSIGNED_BYTE,u16:ut.UNSIGNED_SHORT,u32:ut.UNSIGNED_INT,i8:ut.BYTE,i16:ut.SHORT,i32:ut.INT,f32:ut.FLOAT};class Nq{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}Nq.ElementCount=9;class Fq{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}Fq.ElementCount=16;class vg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,i){this.typedBuffer[t*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}}vg.ElementCount=1;class _g{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,Li(i,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t]=i[1]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}_g.ElementCount=2;class bg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,se(i,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t]=i[2]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t]=s}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}bg.ElementCount=3;class wg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,Wi(i,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t++]=i[2],this.typedBuffer[t]=i[3]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}wg.ElementCount=4;class rM extends vg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}static fromTypedArray(t,i){return new rM(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}rM.ElementType="f32";class uh extends _g{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(uh,t,i)}static fromTypedArray(t,i){return new uh(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}uh.ElementType="f32";class pi extends bg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(pi,t,i)}static fromTypedArray(t,i){return new pi(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}pi.ElementType="f32";class yn extends wg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(yn,t,i)}static fromTypedArray(t,i){return new yn(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}yn.ElementType="f32";class Pd extends Nq{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Pd,t,i)}static fromTypedArray(t,i){return new Pd(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Pd.ElementType="f32";class j0 extends Nq{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(j0,t,i)}static fromTypedArray(t,i){return new j0(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}j0.ElementType="f64";class BS extends Fq{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(BS,t,i)}static fromTypedArray(t,i){return new BS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}BS.ElementType="f32";class H0 extends Fq{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(H0,t,i)}static fromTypedArray(t,i){return new H0(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}H0.ElementType="f64";class VS extends vg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(VS,t,i)}static fromTypedArray(t,i){return new VS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}VS.ElementType="f64";class GS extends _g{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(GS,t,i)}static fromTypedArray(t,i){return new GS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}GS.ElementType="f64";class yr extends bg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(yr,t,i)}static fromTypedArray(t,i){return new yr(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}yr.ElementType="f64";class bb extends wg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(bb,t,i)}static fromTypedArray(t,i){return new bb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}bb.ElementType="f64";class cg extends vg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(cg,t,i)}static fromTypedArray(t,i){return new cg(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}cg.ElementType="u8";class wb extends _g{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(wb,t,i)}static fromTypedArray(t,i){return new wb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}wb.ElementType="u8";class q0 extends bg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(q0,t,i)}static fromTypedArray(t,i){return new q0(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}q0.ElementType="u8";class al extends wg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(al,t,i)}static fromTypedArray(t,i){return new al(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}al.ElementType="u8";class xb extends vg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(xb,t,i)}static fromTypedArray(t,i){return new xb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}xb.ElementType="u16";class jS extends _g{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(jS,t,i)}static fromTypedArray(t,i){return new jS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}jS.ElementType="u16";class Tb extends bg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(Tb,t,i)}static fromTypedArray(t,i){return new Tb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Tb.ElementType="u16";class W0 extends wg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(W0,t,i)}static fromTypedArray(t,i){return new W0(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}W0.ElementType="u16";class Sb extends vg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(Sb,t,i)}static fromTypedArray(t,i){return new Sb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Sb.ElementType="u32";class HS extends _g{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(HS,t,i)}static fromTypedArray(t,i){return new HS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}HS.ElementType="u32";class HR extends bg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(HR,t,i)}static fromTypedArray(t,i){return new HR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}HR.ElementType="u32";class qR extends wg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(qR,t,i)}static fromTypedArray(t,i){return new qR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}qR.ElementType="u32";class qS extends vg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(qS,t,i)}static fromTypedArray(t,i){return new qS(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}qS.ElementType="i8";class Eb extends _g{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(Eb,t,i)}static fromTypedArray(t,i){return new Eb(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Eb.ElementType="i8";class WR extends bg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(WR,t,i)}static fromTypedArray(t,i){return new WR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}WR.ElementType="i8";class XR extends wg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(XR,t,i)}static fromTypedArray(t,i){return new XR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}XR.ElementType="i8";class YR extends vg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(YR,t,i)}static fromTypedArray(t,i){return new YR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}YR.ElementType="i16";class Ab extends _g{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(Ab,t,i)}static fromTypedArray(t,i){return new Ab(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Ab.ElementType="i16";class ZR extends bg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(ZR,t,i)}static fromTypedArray(t,i){return new ZR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ZR.ElementType="i16";class QR extends wg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(QR,t,i)}static fromTypedArray(t,i){return new QR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}QR.ElementType="i16";class JR extends vg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(JR,t,i)}static fromTypedArray(t,i){return new JR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}JR.ElementType="i32";class KR extends _g{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(KR,t,i)}static fromTypedArray(t,i){return new KR(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}KR.ElementType="i32";class eO extends bg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(eO,t,i)}static fromTypedArray(t,i){return new eO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}eO.ElementType="i32";class tO extends wg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(tO,t,i)}static fromTypedArray(t,i){return new tO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}tO.ElementType="i32";function Kge(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function V8e(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function G8e(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function j8e(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class UL{constructor(t,i){this.layout=t,this.buffer=typeof i=="number"?new ArrayBuffer(i*t.stride):i;for(const r of t.fieldNames){const s=t.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,i){const r=this[t];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(t,i){return new UL(this.layout,this.buffer.slice(t*this.stride,i*this.stride))}copyFrom(t,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}}class Uq{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,i){return this._appendField(t,uh,i),this}vec2f64(t,i){return this._appendField(t,GS,i),this}vec3f(t,i){return this._appendField(t,pi,i),this}vec3f64(t,i){return this._appendField(t,yr,i),this}vec4f(t,i){return this._appendField(t,yn,i),this}vec4f64(t,i){return this._appendField(t,bb,i),this}mat3f(t,i){return this._appendField(t,Pd,i),this}mat3f64(t,i){return this._appendField(t,j0,i),this}mat4f(t,i){return this._appendField(t,BS,i),this}mat4f64(t,i){return this._appendField(t,H0,i),this}vec4u8(t,i){return this._appendField(t,al,i),this}f32(t,i){return this._appendField(t,rM,i),this}f64(t,i){return this._appendField(t,VS,i),this}u8(t,i){return this._appendField(t,cg,i),this}u16(t,i){return this._appendField(t,xb,i),this}i8(t,i){return this._appendField(t,qS,i),this}vec2i8(t,i){return this._appendField(t,Eb,i),this}vec2i16(t,i){return this._appendField(t,Ab,i),this}vec2u8(t,i){return this._appendField(t,wb,i),this}vec4u16(t,i){return this._appendField(t,W0,i),this}u32(t,i){return this._appendField(t,Sb,i),this}_appendField(t,i,r){const s=i.ElementCount*Kge(i.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new UL(this,t)}createView(t){return new UL(this,t)}clone(){const t=new Uq;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((i,r)=>t.fields.set(r,i)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function ls(){return new Uq}var rG;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=i,e.scale=r,e.add=s,e.subtract=n})(rG||(rG={}));const Bo=ii();class H8e{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function ht(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new H8e(t)}function _w(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function gee(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],h=(r[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function IP(e,t,i,r,s,n=lt()){const o=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),a=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function yee(e,t,i,r,s){s||(s=e),Bo[0]=e[0],Bo[1]=e[1],Bo[2]=e[2],Bo[3]=1,Lc(Bo,Bo,t),s.length>2&&(s[2]=-Bo[2]),Lc(Bo,Bo,i),ht(Bo[3]!==0),s[0]=Bo[0]/Bo[3],s[1]=Bo[1]/Bo[3],s[2]=Bo[2]/Bo[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function q8e(e,t){return Math.log(e)/Math.log(t)}function eye(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function tye(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function W8e(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function X8e(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function Y8e(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function Z8e(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}class a4{constructor(t,i,r,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this.center=M(),ht(t.length>=1),ht(r.length%this._numIndexPerPrimitive==0),ht(r.length>=t.length*this._numIndexPerPrimitive),ht(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*r[this._numIndexPerPrimitive*t[0]];Rv.clear(),Rv.push(l),this.bbMin=Le(n[l],n[l+1],n[l+2]),this.bbMax=ts(this.bbMin);for(let h=0;h<a;++h){const p=this._numIndexPerPrimitive*t[h];for(let f=0;f<this._numIndexPerPrimitive;++f){l=o*r[p+f],Rv.push(l);let g=n[l];this.bbMin[0]=Math.min(g,this.bbMin[0]),this.bbMax[0]=Math.max(g,this.bbMax[0]),g=n[l+1],this.bbMin[1]=Math.min(g,this.bbMin[1]),this.bbMax[1]=Math.max(g,this.bbMax[1]),g=n[l+2],this.bbMin[2]=Math.min(g,this.bbMin[2]),this.bbMax[2]=Math.max(g,this.bbMax[2])}}Cs(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let h=0;h<Rv.length;++h){l=Rv.getItemAt(h);const p=n[l]-this.center[0],f=n[l+1]-this.center[1],g=n[l+2]-this.center[2],y=p*p+f*f+g*g;if(y<=c)continue;const v=Math.sqrt(y),b=.5*(v-this.radius);this.radius=this.radius+b,c=this.radius*this.radius;const w=b/v;this.center[0]+=p*w,this.center[1]+=f*w,this.center[2]+=g*w}Rv.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(fa(this.bbMin,this.bbMax)>1){const t=Cs(M(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],g=n[f],y=n[f+1],v=n[f+2];for(let b=1;b<this._numIndexPerPrimitive;++b){f=o*this.indices[p+b];const w=n[f],S=n[f+1],x=n[f+2];w<g&&(g=w),S<y&&(y=S),x<v&&(v=x)}g<t[0]&&(h|=1),y<t[1]&&(h|=2),v<t[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new a4(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){Rv.prune()}}const Rv=new Vt({deallocator:null});class sM{constructor(){this.id=Xa()}unload(){}}var Id;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(Id||(Id={}));function vee(e,t,i){const r=NT(e,t),s=NT(t,i),n=NT(i,e),o=(r+s+n)/2,a=o*(o-r)*(o-s)*(o-n);return a<=0?0:Math.sqrt(a)}function Q8e(e,t,i){return de(pz,t,e),de(_ee,i,e),Ie(_t(pz,pz,_ee))/2}new mg(nv);new mg(()=>({p0:null,p1:null,p2:null}));const pz=M(),_ee=M();let jy=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const iye=new Uint16Array([0]),zL=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function WS(e){if(e===1)return iye;if(e<zL.length)return new Uint16Array(zL.buffer,0,e);if(e>jy.length){const t=Math.max(2*jy.length,e);jy=new Uint32Array(t);for(let i=0;i<jy.length;i++)jy[i]=i}return new Uint32Array(jy.buffer,0,e)}function Pmt(e){if(e===1)return new Uint16Array(iye);if(e<zL.length)return new Uint16Array(zL.slice(0,e));if(e>jy.length){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}return new Uint32Array(jy.slice(0,e))}function rye(e,t,i){if(!e)return!1;const{size:r,data:s}=e;se(i,0,0,0),se(Du,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*r,c=t[a+1]*r,h=t[a+2]*r;se(hn,s[l+0],s[l+1],s[l+2]),se($m,s[c+0],s[c+1],s[c+2]),se($P,s[h+0],s[h+1],s[h+2]);const p=Q8e(hn,$m,$P);p?(fe(hn,hn,$m),fe(hn,hn,$P),oe(hn,hn,1/3*p),fe(i,i,hn),n+=p):(fe(Du,Du,hn),fe(Du,Du,$m),fe(Du,Du,$P),o+=3)}return(o!==0||n!==0)&&(n!==0?(oe(i,i,1/n),!0):o!==0&&(oe(i,Du,1/o),!0))}function sye(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;se(i,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&oe(i,i,1/o),o>0}function zq(e,t,i,r){if(!e)return!1;const{size:s,data:n}=e;se(r,0,0,0),se(Du,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,g=(t?t[p]:p)*s,y=(t?t[f]:f)*s;hn[0]=n[g+0],hn[1]=n[g+1],hn[2]=n[g+2],$m[0]=n[y+0],$m[1]=n[y+1],$m[2]=n[y+2],oe(hn,fe(hn,hn,$m),.5);const v=I7(hn,$m);v>0?(fe(r,r,oe(hn,hn,v)),o+=v):(fe(Du,Du,hn),a++)}return o!==0?(oe(r,r,1/o),!0):a!==0&&(oe(r,Du,1/a),!0)}const hn=M(),$m=M(),$P=M(),Du=M();class Ar extends sM{constructor(t,i=[],r=Qa.Triangle,s=-1){super(),this._primitiveType=r,this.edgeIndicesLength=s,this.type=Id.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,o]of t)o&&this._vertexAttributes.set(n,L({},o));if(i==null||i.length===0){const n=J8e(this._vertexAttributes),o=WS(n);this.edgeIndicesLength=this.edgeIndicesLength<0?n:this.edgeIndicesLength;for(const a of this._vertexAttributes.keys())this._indices.set(a,o)}else for(const[n,o]of i)o&&(this._indices.set(n,K8e(o)),n===A.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new Ar([],void 0,this._primitiveType,void 0),{_vertexAttributes:i,_indices:r}=t;return this._vertexAttributes.forEach((s,n)=>{i.set(n,s)}),this._indices.forEach((s,n)=>{r.set(n,s)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const i=this._vertexAttributes.get(t);return i&&!i.exclusive&&(i.data=Array.from(i.data),i.exclusive=!0),i}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return C(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===Qa.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const i=this.indices.get(A.POSITION),r=this.vertexAttributes.get(A.POSITION);return rye(r,i,t)}_computeAttachmentOriginPoints(t){const i=this.indices.get(A.POSITION),r=this.vertexAttributes.get(A.POSITION);return sye(r,i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(A.POSITION);if(t.length===0)return null;const i=this.primitiveType===Qa.Triangle?3:1;ht(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const r=WS(t.length/i),s=this.vertexAttributes.get(A.POSITION);return new a4(r,i,t,s)}}function J8e(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function K8e(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const bw=rG;var fz,mz,gz,sG;(function(e){const i=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let c=0;c<6;c++)for(let h=0;h<6;h++)o[6*c+h]=c;const a=new Uint16Array(36);for(let c=0;c<6;c++)a[6*c+0]=0,a[6*c+1]=1,a[6*c+2]=2,a[6*c+3]=2,a[6*c+4]=3,a[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const h=new Array(24);for(let p=0;p<8;p++)h[3*p]=i[p][0]*c[0],h[3*p+1]=i[p][1]*c[1],h[3*p+2]=i[p][2]*c[2];return new Ar([[A.POSITION,{size:3,data:h,exclusive:!0}],[A.NORMAL,{size:3,data:r}],[A.UV0,{size:2,data:s}]],[[A.POSITION,n],[A.NORMAL,o],[A.UV0,a]])}e.createGeometry=l})(fz||(fz={})),function(e){const i=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(a){Array.isArray(a)||(a=[a,a,a]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=i[c][0]*a[0],l[3*c+1]=i[c][1]*a[1],l[3*c+2]=i[c][2]*a[2];return new Ar([[A.POSITION,{size:3,data:l,exclusive:!0}],[A.NORMAL,{size:3,data:r}]],[[A.POSITION,s],[A.NORMAL,n]])}e.createGeometry=o}(mz||(mz={})),function(e){const r=Ai(-.5,0,-.5),s=Ai(.5,0,-.5),n=Ai(0,0,.5),o=Ai(0,0+.5,0),a=vi(),l=vi(),c=vi(),h=vi(),p=vi();de(a,r,o),de(l,r,s),_t(c,a,l),Te(c,c),de(a,s,o),de(l,s,n),_t(h,a,l),Te(h,h),de(a,n,o),de(l,n,r),_t(p,a,l),Te(p,p);const f=[r,s,n,o],g=[0,-1,0,c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function b(w){Array.isArray(w)||(w=[w,w,w]);const S=new Array(12);for(let x=0;x<4;x++)S[3*x]=f[x][0]*w[0],S[3*x+1]=f[x][1]*w[1],S[3*x+2]=f[x][2]*w[2];return new Ar([[A.POSITION,{size:3,data:S,exclusive:!0}],[A.NORMAL,{size:3,data:g}]],[[A.POSITION,new Uint16Array(y)],[A.NORMAL,new Uint16Array(v)]])}e.createGeometry=b}(gz||(gz={})),function(e){function t(x,E,R,O={uv:!0}){const I=-Math.PI,U=2*Math.PI,N=-Math.PI/2,V=Math.PI,j=Math.max(3,Math.floor(E)),H=Math.max(2,Math.floor(R)),J=(j+1)*(H+1),K=new Float32Array(3*J),he=new Float32Array(3*J),le=new Float32Array(2*J),$=[];let z=0;for(let ee=0;ee<=H;ee++){const q=[],te=ee/H,Ee=N+te*V,ve=Math.cos(Ee);for(let qe=0;qe<=j;qe++){const Ce=qe/j,Re=I+Ce*U,Oe=Math.cos(Re)*ve,Ve=Math.sin(Ee),nr=-Math.sin(Re)*ve;K[3*z]=Oe*x,K[3*z+1]=Ve*x,K[3*z+2]=nr*x,he[3*z]=Oe,he[3*z+1]=Ve,he[3*z+2]=nr,le[2*z]=Ce,le[2*z+1]=te,q.push(z),++z}$.push(q)}const k=new Uint32Array(2*j*(H-1)*3);z=0;for(let ee=0;ee<H;ee++)for(let q=0;q<j;q++){const te=$[ee][q],Ee=$[ee][q+1],ve=$[ee+1][q+1],qe=$[ee+1][q];ee===0?(k[z++]=te,k[z++]=ve,k[z++]=qe):ee===H-1?(k[z++]=te,k[z++]=Ee,k[z++]=ve):(k[z++]=te,k[z++]=Ee,k[z++]=ve,k[z++]=ve,k[z++]=qe,k[z++]=te)}const G=[[A.POSITION,k],[A.NORMAL,k]],W=[[A.POSITION,{size:3,data:K,exclusive:!0}],[A.NORMAL,{size:3,data:he,exclusive:!0}]];return O.uv&&(W.push([A.UV0,{size:2,data:le,exclusive:!0}]),G.push([A.UV0,k])),O.offset&&(G[0][0]=A.OFFSET,W[0][0]=A.OFFSET,G.push([A.POSITION,new Uint32Array(k.length)]),W.push([A.POSITION,{size:3,data:Float64Array.from(O.offset),exclusive:!0}])),new Ar(W,G)}function i(x,E,R){const O=x;let I,U;if(R)I=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],U=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const K=O*(1+Math.sqrt(5))/2;I=[-O,K,0,O,K,0,-O,-K,0,O,-K,0,0,-O,K,0,O,K,0,-O,-K,0,O,-K,K,0,-O,K,0,O,-K,0,-O,-K,0,O],U=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let K=0;K<I.length;K+=3)bw.scale(I,K,x/bw.length(I,K));let N={};function V(K,he){K>he&&([K,he]=[he,K]);const le=K.toString()+"."+he.toString();if(N[le])return N[le];let $=I.length;return I.length+=3,bw.add(I,3*K,I,3*he,I,$),bw.scale(I,$,x/bw.length(I,$)),$/=3,N[le]=$,$}for(let K=0;K<E;K++){const he=U.length,le=new Uint32Array(4*he);for(let $=0;$<he;$+=3){const z=U[$],k=U[$+1],G=U[$+2],W=V(z,k),ee=V(k,G),q=V(G,z),te=4*$;le[te]=z,le[te+1]=W,le[te+2]=q,le[te+3]=k,le[te+4]=ee,le[te+5]=W,le[te+6]=G,le[te+7]=q,le[te+8]=ee,le[te+9]=W,le[te+10]=ee,le[te+11]=q}U=le,N={}}const j=new Float32Array(I);for(let K=0;K<j.length;K+=3)bw.normalize(j,K);const H=[[A.POSITION,U],[A.NORMAL,U]],J=[[A.POSITION,{size:3,data:new Float32Array(I),exclusive:!0}],[A.NORMAL,{size:3,data:j,exclusive:!0}]];return new Ar(J,H)}function r(x,E,R,O,I,U,N){const V=E?[E[0],E[1],E[2]]:[0,0,0],j=x?[x[0],x[1],x[2]]:[0,0,1];U=U||[0,0];const H=R?[255*R[0],255*R[1],255*R[2],R.length>3?255*R[3]:255]:[255,255,255,255],J=O!=null&&O.length===2?O:[1,1],K=[[A.POSITION,{size:3,data:V,exclusive:!0}],[A.NORMAL,{size:3,data:j,exclusive:!0}],[A.UV0,{size:U.length,data:U}],[A.COLOR,{size:4,data:H,exclusive:!0}],[A.SIZE,{size:2,data:J}]];if(I!=null){const he=new Float32Array([I[0],I[1],I[2],I[3]]);K.push([A.AUXPOS1,{size:4,data:he}])}if(N!=null){const he=new Float32Array([N[0],N[1],N[2],N[3]]);K.push([A.AUXPOS2,{size:4,data:he}])}return new Ar(K,null,Qa.Point)}function s(x,E,R,O,I,U,N,V){if(x!=null){const{data:j}=V.getMutableAttribute(A.NORMAL);j[0]=x[0],j[1]=x[1],j[2]=x[2]}if(E!=null){const{data:j}=V.getMutableAttribute(A.POSITION);j[0]=E[0],j[1]=E[1],j[2]=E[2]}if(R!=null){const{data:j}=V.getMutableAttribute(A.COLOR);j[0]=R[0],j[1]=R[1],j[2]=R[2],j[3]=R[3]}if(O!=null){const{data:j}=V.getMutableAttribute(A.SIZE);j[0]=O[0],j[1]=O[1]}if(I!=null){const{data:j}=V.getMutableAttribute(A.AUXPOS1);j[0]=I[0],j[1]=I[1],j[2]=I[2],j[3]=I[3]}if(U!=null){const{data:j}=V.getMutableAttribute(A.UV0);j[0]=U[0],j[1]=U[1]}if(N!=null){const{data:j}=V.getMutableAttribute(A.AUXPOS2);j[0]=N[0],j[1]=N[1],j[2]=N[2],j[3]=N[3]}}function n(x,E){const R=new Float32Array(3*x.length),O=new Float32Array(E?3*x.length:3),I=new Uint32Array(x.length),U=new Uint32Array(x.length);for(let H=0;H<x.length;H++)R[3*H]=x[H][0],R[3*H+1]=x[H][1],R[3*H+2]=x[H][2],E&&(O[3*H]=E[H][0],O[3*H+1]=E[H][1],O[3*H+2]=E[H][2]),I[H]=H,U[H]=0;E||(O[0]=0,O[1]=1,O[2]=0);const N=[0,0],V=[[A.POSITION,I],[A.NORMAL,E?I:U],[A.UV0,U]],j=[[A.POSITION,{size:3,data:R,exclusive:!0}],[A.NORMAL,{size:3,data:O,exclusive:!0}],[A.UV0,{size:2,data:N,exclusive:!0}]];return new Ar(j,V,Qa.Point)}function o(){const x=[0,0,0,0,0,100,100,0,0],E=new Uint16Array([0,1,2]),R=[0,1,0],O=new Uint16Array([0,0,0]),I=[0,0],U=new Uint16Array([0,0,0]),N=[[A.POSITION,E],[A.NORMAL,O],[A.UV0,U]],V=[[A.POSITION,{size:3,data:x,exclusive:!0}],[A.NORMAL,{size:3,data:R,exclusive:!0}],[A.UV0,{size:2,data:I,exclusive:!0}]];return new Ar(V,N)}e.createBoxGeometry=fz.createGeometry,e.createDiamondGeometry=mz.createGeometry,e.createTetrahedronGeometry=gz.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=s,e.createPointArrayGeometry=n,e.createTriangleGeometry=o;const a=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function l(x=a){const E=new Array(12);for(let H=0;H<4;H++)for(let J=0;J<3;J++)E[3*H+J]=x[H][J];const R=new Uint32Array([0,1,2,2,3,0]),O=[0,0,1],I=new Uint32Array([0,0,0,0,0,0]),U=[0,0,1,0,1,1,0,1],N=[255,255,255,255],V=[[A.POSITION,R],[A.NORMAL,I],[A.UV0,R],[A.COLOR,I]],j=[[A.POSITION,{size:3,data:E,exclusive:!0}],[A.NORMAL,{size:3,data:O,exclusive:!0}],[A.UV0,{size:2,data:U,exclusive:!0}],[A.COLOR,{size:4,data:N,exclusive:!0}]];return new Ar(j,V)}function c(x,E,R,O,I=!0,U=!0){let N=0;const V=E,j=x;let H=Ai(0,N,0),J=Ai(0,N+j,0),K=Ai(0,-1,0),he=Ai(0,1,0);O&&(N=j,J=Ai(0,0,0),H=Ai(0,N,0),K=Ai(0,1,0),he=Ai(0,-1,0));const le=[J,H],$=[K,he],z=R+2,k=Math.sqrt(j*j+V*V);if(O)for(let Ce=R-1;Ce>=0;Ce--){const Re=Ce*(2*Math.PI/R),Oe=Ai(Math.cos(Re)*V,N,Math.sin(Re)*V);le.push(Oe);const Ve=Ai(j*Math.cos(Re)/k,-V/k,j*Math.sin(Re)/k);$.push(Ve)}else for(let Ce=0;Ce<R;Ce++){const Re=Ce*(2*Math.PI/R),Oe=Ai(Math.cos(Re)*V,N,Math.sin(Re)*V);le.push(Oe);const Ve=Ai(j*Math.cos(Re)/k,V/k,j*Math.sin(Re)/k);$.push(Ve)}const G=new Uint32Array(2*(R+2)*3),W=new Uint32Array(2*(R+2)*3);let ee=0,q=0;if(I){for(let Ce=3;Ce<le.length;Ce++)G[ee++]=1,G[ee++]=Ce-1,G[ee++]=Ce,W[q++]=0,W[q++]=0,W[q++]=0;G[ee++]=le.length-1,G[ee++]=2,G[ee++]=1,W[q++]=0,W[q++]=0,W[q++]=0}if(U){for(let Ce=3;Ce<le.length;Ce++)G[ee++]=Ce,G[ee++]=Ce-1,G[ee++]=0,W[q++]=Ce,W[q++]=Ce-1,W[q++]=1;G[ee++]=0,G[ee++]=2,G[ee++]=le.length-1,W[q++]=1,W[q++]=2,W[q++]=$.length-1}const te=new Float32Array(3*z);for(let Ce=0;Ce<z;Ce++)te[3*Ce]=le[Ce][0],te[3*Ce+1]=le[Ce][1],te[3*Ce+2]=le[Ce][2];const Ee=new Float32Array(3*z);for(let Ce=0;Ce<z;Ce++)Ee[3*Ce]=$[Ce][0],Ee[3*Ce+1]=$[Ce][1],Ee[3*Ce+2]=$[Ce][2];const ve=[[A.POSITION,G],[A.NORMAL,W]],qe=[[A.POSITION,{size:3,data:te,exclusive:!0}],[A.NORMAL,{size:3,data:Ee,exclusive:!0}]];return new Ar(qe,ve)}function h(x,E,R,O,I,U){const N=O?LL(O):Ai(1,0,0),V=I?LL(I):Ai(0,0,0);U=U==null||U;const j=vi();Te(j,N);const H=vi();oe(H,j,Math.abs(x));const J=vi();oe(J,H,-.5),fe(J,J,V);const K=Ai(0,1,0);Math.abs(1-Se(j,K))<.2&&se(K,0,0,1);const he=vi();_t(he,j,K),Te(he,he),_t(K,he,j);const le=2*R+(U?2:0),$=R+(U?2:0),z=new Float32Array(3*le),k=new Float32Array(3*$),G=new Float32Array(2*le),W=new Uint32Array(3*R*(U?4:2)),ee=new Uint32Array(3*R*(U?4:2));U&&(z[3*(le-2)+0]=J[0],z[3*(le-2)+1]=J[1],z[3*(le-2)+2]=J[2],G[2*(le-2)]=0,G[2*(le-2)+1]=0,z[3*(le-1)+0]=z[3*(le-2)+0]+H[0],z[3*(le-1)+1]=z[3*(le-2)+1]+H[1],z[3*(le-1)+2]=z[3*(le-2)+2]+H[2],G[2*(le-1)]=1,G[2*(le-1)+1]=1,k[3*($-2)+0]=-j[0],k[3*($-2)+1]=-j[1],k[3*($-2)+2]=-j[2],k[3*($-1)+0]=j[0],k[3*($-1)+1]=j[1],k[3*($-1)+2]=j[2]);const q=(Re,Oe,Ve)=>{W[Re]=Oe,ee[Re]=Ve};let te=0;const Ee=vi(),ve=vi();for(let Re=0;Re<R;Re++){const Oe=Re*(2*Math.PI/R);oe(Ee,K,Math.sin(Oe)),oe(ve,he,Math.cos(Oe)),fe(Ee,Ee,ve),k[3*Re+0]=Ee[0],k[3*Re+1]=Ee[1],k[3*Re+2]=Ee[2],oe(Ee,Ee,E),fe(Ee,Ee,J),z[3*Re+0]=Ee[0],z[3*Re+1]=Ee[1],z[3*Re+2]=Ee[2],G[2*Re+0]=Re/R,G[2*Re+1]=0,z[3*(Re+R)+0]=z[3*Re+0]+H[0],z[3*(Re+R)+1]=z[3*Re+1]+H[1],z[3*(Re+R)+2]=z[3*Re+2]+H[2],G[2*(Re+R)+0]=Re/R,G[2*Re+1]=1;const Ve=(Re+1)%R;q(te++,Re,Re),q(te++,Re+R,Re),q(te++,Ve,Ve),q(te++,Ve,Ve),q(te++,Re+R,Re),q(te++,Ve+R,Ve)}if(U){for(let Re=0;Re<R;Re++){const Oe=(Re+1)%R;q(te++,le-2,$-2),q(te++,Re,$-2),q(te++,Oe,$-2)}for(let Re=0;Re<R;Re++){const Oe=(Re+1)%R;q(te++,Re+R,$-1),q(te++,le-1,$-1),q(te++,Oe+R,$-1)}}const qe=[[A.POSITION,W],[A.NORMAL,ee],[A.UV0,W]],Ce=[[A.POSITION,{size:3,data:z,exclusive:!0}],[A.NORMAL,{size:3,data:k,exclusive:!0}],[A.UV0,{size:2,data:G,exclusive:!0}]];return new Ar(Ce,qe)}function p(x,E,R,O,I){R=R||10,O=O==null||O,ht(x.length>1);const U=[[0,0,0]],N=[],V=[];for(let j=0;j<R;j++){N.push([0,-j-1,-(j+1)%R-1]);const H=j/R*2*Math.PI;V.push([Math.cos(H)*E,Math.sin(H)*E])}return e.createPathExtrusionGeometry(V,x,U,N,O,I)}function f(x,E,R,O,I,U=Ai(0,0,0)){const N=x.length,V=new Float32Array(E.length*N*3+(6*R.length||0)),j=new Float32Array(E.length*N*3+(R?6:0)),H=(E.length-1)*N*6+3*O.length*2,J=new Uint32Array(H),K=new Uint32Array(H);let he=0,le=0,$=0,z=0;const k=vi(),G=vi(),W=vi(),ee=vi(),q=vi(),te=vi(),Ee=vi(),ve=M(),qe=vi(),Ce=vi(),Re=vi(),Oe=vi(),Ve=vi(),nr=fi();se(qe,0,1,0),de(G,E[1],E[0]),Te(G,G),I?(fe(ve,E[0],U),Te(W,ve)):se(W,0,0,1),S(G,W,qe,qe,q,W,bee),ne(ee,W),ne(Oe,q);for(let ft=0;ft<R.length;ft++)oe(te,q,R[ft][0]),oe(ve,W,R[ft][2]),fe(te,te,ve),fe(te,te,E[0]),V[he++]=te[0],V[he++]=te[1],V[he++]=te[2];j[le++]=-G[0],j[le++]=-G[1],j[le++]=-G[2];for(let ft=0;ft<O.length;ft++)J[$++]=O[ft][0]>0?O[ft][0]:-O[ft][0]-1+R.length,J[$++]=O[ft][1]>0?O[ft][1]:-O[ft][1]-1+R.length,J[$++]=O[ft][2]>0?O[ft][2]:-O[ft][2]-1+R.length,K[z++]=0,K[z++]=0,K[z++]=0;let Ti=R.length;const hi=R.length-1;for(let ft=0;ft<E.length;ft++){let Gn=!1;ft>0&&(ne(k,G),ft<E.length-1?(de(G,E[ft+1],E[ft]),Te(G,G)):Gn=!0,fe(Ce,k,G),Te(Ce,Ce),fe(Re,E[ft-1],ee),SS(E[ft],Ce,nr),Wb(nr,Xc(Re,k),ve)?(de(ve,ve,E[ft]),Te(W,ve),_t(q,Ce,W),Te(q,q)):S(Ce,ee,Oe,qe,q,W,bee),ne(ee,W),ne(Oe,q)),I&&(fe(ve,E[ft],U),Te(Ve,ve));for(let jn=0;jn<N;jn++)if(oe(te,q,x[jn][0]),oe(ve,W,x[jn][1]),fe(te,te,ve),Te(Ee,te),j[le++]=Ee[0],j[le++]=Ee[1],j[le++]=Ee[2],fe(te,te,E[ft]),V[he++]=te[0],V[he++]=te[1],V[he++]=te[2],!Gn){const wa=(jn+1)%N;J[$++]=Ti+jn,J[$++]=Ti+N+jn,J[$++]=Ti+wa,J[$++]=Ti+wa,J[$++]=Ti+N+jn,J[$++]=Ti+N+wa;for(let rn=0;rn<6;rn++)K[z++]=J[$-6+rn]-hi}Ti+=N}const tn=E[E.length-1];for(let ft=0;ft<R.length;ft++)oe(te,q,R[ft][0]),oe(ve,W,R[ft][1]),fe(te,te,ve),fe(te,te,tn),V[he++]=te[0],V[he++]=te[1],V[he++]=te[2];const Sr=le/3;j[le++]=G[0],j[le++]=G[1],j[le++]=G[2];const Er=Ti-N;for(let ft=0;ft<O.length;ft++)J[$++]=O[ft][0]>=0?Ti+O[ft][0]:-O[ft][0]-1+Er,J[$++]=O[ft][2]>=0?Ti+O[ft][2]:-O[ft][2]-1+Er,J[$++]=O[ft][1]>=0?Ti+O[ft][1]:-O[ft][1]-1+Er,K[z++]=Sr,K[z++]=Sr,K[z++]=Sr;const Ps=[[A.POSITION,J],[A.NORMAL,K]],zo=[[A.POSITION,{size:3,data:V,exclusive:!0}],[A.NORMAL,{size:3,data:j,exclusive:!0}]];return new Ar(zo,Ps)}function g(x,E,R){ht(x.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),ht(x[0].length===3,"createPolylineGeometry(): malformed vertex"),ht(E==null||E.length===x.length,"createPolylineGeometry: need same number of points and normals"),ht(E==null||E[0].length===3,"createPolylineGeometry(): malformed normal");const O=new Float64Array(3*x.length),I=new Uint32Array(2*(x.length-1));let U=0,N=0;for(let H=0;H<x.length;H++){for(let J=0;J<3;J++)O[U++]=x[H][J];H>0&&(I[N++]=H-1,I[N++]=H)}const V=[],j=[];if(V.push([A.POSITION,I]),j.push([A.POSITION,{size:3,data:O,exclusive:!0}]),E){const H=new Float32Array(3*E.length);let J=0;for(let K=0;K<x.length;K++)for(let he=0;he<3;he++)H[J++]=E[K][he];V.push([A.NORMAL,I]),j.push([A.NORMAL,{size:3,data:H,exclusive:!0}])}return R&&(j.push([A.COLOR,{size:4,data:R}]),V.push([A.COLOR,WS(R.length/4)])),new Ar(j,V,Qa.Line)}function y(x,E,R,O,I=0){const U=new Array(18),N=[[-E,I,O/2],[R,I,O/2],[0,x+I,O/2],[-E,I,-O/2],[R,I,-O/2],[0,x+I,-O/2]],V=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let j=0;j<6;j++)U[3*j]=N[j][0],U[3*j+1]=N[j][1],U[3*j+2]=N[j][2];return new Ar([[A.POSITION,{size:3,data:U,exclusive:!0}]],[[A.POSITION,V]])}function v(x,E){const R=x.getMutableAttribute(A.POSITION).data;for(let O=0;O<R.length;O+=3){const I=R[O],U=R[O+1],N=R[O+2];se(ww,I,U,N),Fe(ww,ww,E),R[O]=ww[0],R[O+1]=ww[1],R[O+2]=ww[2]}}function b(x,E=x){const R=x.vertexAttributes,O=R.get(A.POSITION).data,I=R.get(A.NORMAL).data;if(I){const U=E.getMutableAttribute(A.NORMAL).data;for(let N=0;N<I.length;N+=3){const V=I[N+1];U[N+1]=-I[N+2],U[N+2]=V}}if(O){const U=E.getMutableAttribute(A.POSITION).data;for(let N=0;N<O.length;N+=3){const V=O[N+1];U[N+1]=-O[N+2],U[N+2]=V}}return E}function w(x,E,R,O,I){return!(Math.abs(Se(E,x))>I)&&(_t(R,x,E),Te(R,R),_t(O,R,x),Te(O,O),!0)}function S(x,E,R,O,I,U,N){return w(x,E,I,U,N)||w(x,R,I,U,N)||w(x,O,I,U,N)}e.createSquareGeometry=l,e.createConeGeometry=c,e.createCylinderGeometry=h,e.createTubeGeometry=p,e.createPathExtrusionGeometry=f,e.createPolylineGeometry=g,e.createExtrudedTriangle=y,e.transformInPlace=v,e.cgToGIS=b,e.makeOrthoBasisDirUp=w,e.makeOrthoBasisDirUpFallback=S}(sG||(sG={}));const bee=.99619469809,ww=vi(),Rl=sG,e9e=pe.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class t9e{constructor(){this.type="panoramic",this._techniqueConfig=new FL,this._passParameters=new Lq,this._readyResolver=Qm(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=it(this._passParameters.texture),this._vao=it(this._vao),this._readyController=rh(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=of.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(kS,this._techniqueConfig);const i=t.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=oo(this._vao,"geometry"),ch(Jge,{signal:this._readyController.signal}).then(r=>{this._passParameters.texture=new ot(i,{pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!0},r),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(r=>{Tr(r)||e9e.error("Unable to initialize atmosphere: image request failed",r),this._readyResolver.reject()})}get canRender(){return this._passParameters.texture!=null}render(t){const i=t.rctx,r=i.bindTechnique(this._technique,this._passParameters,t.bindParameters);i9e(wee,t.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",wee),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Dt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const i=Rl.createPolySphereGeometry(1,2,!1),r=i.indices.get(A.POSITION);for(let a=0;a<r.length;a+=3){const l=r[a];r[a]=r[a+2],r[a+2]=l}const s=i.vertexAttributes.get(A.POSITION).data,n=xee.createBuffer(r.length),o=n.position;for(let a=0;a<r.length;++a){const l=3*r[a];o.set(a,0,s[l]),o.set(a,1,s[l+1]),o.set(a,2,s[l+2])}return new Os(t,Ri,{geometry:Zl(xee)},{geometry:si.createVertex(t,mi.STATIC_DRAW,n.buffer)})}}function i9e(e,t){os(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const wee=Ae(),xee=ls().vec3f(A.POSITION);var X0;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(X0||(X0={}));class nG extends _a{constructor(){super(...arguments),this.type=X0.Rain}}u([B({count:X0.COUNT})],nG.prototype,"type",void 0);function r9e(e){const t=new Fi;return t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new ke("cameraPosition")),t.vertex.uniforms.add(new ke("offset")),t.vertex.uniforms.add(new ye("width")),t.vertex.uniforms.add(new li("proj",F.Pass,(i,r)=>r.camera.projectionMatrix)),t.vertex.uniforms.add(new li("view")),t.vertex.uniforms.add(new ye("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(T`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===X0.Rain?T`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:T`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new ye("opacity")),t.fragment.uniforms.add(new ke("particleColor")),t.fragment.code.add(T`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===X0.Rain?T`d = 0.5 * smoothstep(0.5, 0.0, d);`:T`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const s9e=Object.freeze(Object.defineProperty({__proto__:null,build:r9e},Symbol.toStringTag,{value:"Module"}));class n9e extends qs{constructor(){super(...arguments),this.time=0,this.radius=1}}class Um extends Ki{initializeProgram(t){const i=Um.shader.get().build(this.configuration);return new Gi(t.rctx,i,Um.attributeLocation)}initializePipeline(){return Ut({blending:po(Me.ONE,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ji.LEQUAL},colorWrite:Qt})}}Um.shader=new Vi(s9e,()=>import("./Precipitation.glsl.959df866.js")),Um.attributeLocation=new Map([[A.POSITION,0],[A.INSTANCEFEATUREATTRIBUTE,1]]);class nye{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return _(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let z_=class extends be{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=M(),this._tile=M(),this._particleColor=vi(),this._particleColorAtNight=vi(),this._nightMultiplier=.7,this._cameraDirection=vi(),this._renderParameters=new n9e,this._animation=new nye,this._updatingTracking=new jp,this._renderParameters.time=0,this._renderParameters.radius=Ci(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=$i(this._snowTechnique),this._rainTechnique=$i(this._rainTechnique),this._vao=it(this._vao),this._instanceIdBuffer=it(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(C(this._rainTechnique)){const e=new nG;e.type=X0.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(Um,e)}return this._rainTechnique}get snowTechnique(){if(C(this._snowTechnique)){const e=new nG;e.type=X0.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(Um,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,i){const r=i==="rainy",s=r?this.rainTechnique:this.snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),C(s)||C(this._vao)||C(this._instanceIdBuffer)||(_(e.bindParameters.cloudsComposition)&&(this._opacity=1-e.bindParameters.cloudsComposition.fadeInOutHeight.factor),this._opacity<=0)||C(this._vao)||C(this._instanceIdBuffer))return;const o=n.bindTechnique(s);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(r?this._rainSpeed:this._snowSpeed)*S7(this._animation.time),this._update(o,i,e),n.bindVAO(this._vao);const a=Um.attributeLocation;o.assertCompatibleVertexAttributeLocations(this._vao),yq(n,a,this._instanceIdBuffer,Tee,0),n.capabilities.instancing.drawArraysInstanced(Dt.TRIANGLES,0,3,this._numParticles*t),vq(n,a,this._instanceIdBuffer,Tee)}_update(e,t,i){const r=i.bindParameters.camera,s=r.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",r.viewMatrix),e.setUniform3fv("cameraPosition",s),e.bindPass(null,i.bindParameters),e.setUniform1f("time",this._renderParameters.time),t==="rainy"?se(this._particleColor,.85,.85,.85):se(this._particleColor,1,1,1),oe(this._particleColorAtNight,this._particleColor,this._nightMultiplier),Te(this._cameraDirection,s);const n=Math.max(0,Se(this._cameraDirection,i.bindParameters.lighting.lightingMainDirection));Cs(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){C(this._vao)&&(this._vao=this._createVertexArrayObject(e)),C(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let i=0;i<this._numParticles;i++)t.push(i);return si.createVertex(e,mi.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Os(e,Um.attributeLocation,{geometry:Zl(o9e)},{geometry:si.createVertex(e,mi.STATIC_DRAW,t)})}};u([d({constructOnly:!0})],z_.prototype,"context",void 0),u([d({constructOnly:!0})],z_.prototype,"view",void 0),u([d({readOnly:!0})],z_.prototype,"updating",null),u([d()],z_.prototype,"_updatingTracking",void 0),z_=u([P("esri.views.3d.environment.Precipitation")],z_);const o9e=ls().vec3f(A.POSITION),Tee=Zl(ls().f32(A.INSTANCEFEATUREATTRIBUTE),1),a9e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",l9e=pe.getLogger("esri.views.3d.environment.SimpleAtmosphere"),DP=128,See=-K9,Eee=0,yz=50,c9e=()=>1-511/512,u9e=$$([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class h9e{constructor(t){this.view=t,this.type="simple",this._renderData={texV:lt(),silCircleCenter:M(),silCircleV1:M(),silCircleV2:M(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new Lq,this._fadeVaoCount=0,this._readyResolver=Qm(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=pf(t.spatialReference);const i=Ci(t.spatialReference);this.planetRadius=i.radius,this.outerRimWidth=i.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+See)/this.planetRadius,this.middleRimFactor=(this.planetRadius+Eee)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=Eee/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=mn(this._cameraChangeHandle),this._passParameters.texture=it(this._passParameters.texture),this._fadeVao=it(this._fadeVao),this._vao=it(this._vao),this._readyController=rh(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const i=t.renderContext.rctx;this._cameraChangeHandle=xe(()=>{var n;return(n=this.view.state)==null?void 0:n.camera},()=>t.requestRender(),xs),this._vao=this._createRibbon(i),this._vaoCount=oo(this._vao,"geometry"),this._fadeVao=ba(i),this._fadeVaoCount=oo(this._fadeVao,"geometry");const r=this.isOnMars?a9e:Jge,s=this._readyController.signal;try{const n=await ch(r,{signal:s});qt(s),this._passParameters.texture=new ot(i,{pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!0},n),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(n){Tr(n)||l9e.error("Unable to initialize simple atmosphere: image request failed",n),this._readyResolver.reject(n)}}get coneTechnique(){if(C(this._coneTechnique)){const t=new FL;t.geometry=of.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(kS,t)}return this._coneTechnique}get undergroundTechnique(){if(C(this._undergroundTechnique)){const t=new FL;t.geometry=of.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(kS,t)}return this._undergroundTechnique}render(t){const i=t.bindParameters.camera;this._update(i);const r=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const s=r.bindTechnique(this.coneTechnique,this._passParameters,t.bindParameters);s.setUniformMatrix4fv("proj",i.projectionMatrix),s.setUniformMatrix4fv("view",i.viewMatrix),s.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),s.setUniform3fv("silCircleV1",this._renderData.silCircleV1),s.setUniform3fv("silCircleV2",this._renderData.silCircleV2),s.setUniform2fv("texV",this._renderData.texV),s.setUniform1f("altitudeFade",this._renderData.altitudeFade),s.setUniform1f("innerScale",this._renderData.innerScale),r.bindVAO(this._vao),r.drawArrays(Dt.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const s=r.bindTechnique(this.undergroundTechnique,this._passParameters,t.bindParameters);s.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),s.setUniform3fv("cameraPosition",i.eye),r.bindVAO(this._fadeVao),r.drawArrays(Dt.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const i=M(),r=this.planetRadius,s=Ie(t.eye),n=s-r;if(n<0){const g=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=g}else this._renderData.undergroundFadeAlpha=0;const o=Math.max(yz,n),a=r+See;this._renderData.innerScale=d9e(r+o,r,a)-1,this._renderData.altitudeFade=lge(n),oe(i,t.eye,(r+yz)/s),Aee(i,t.center,t.up,r,this._renderData);const l=this._computeScreenRimWidth(t,i,t.up,this._renderData),c=c9e(),h=u9e(n);let p=this.texV0+c*this.texVScale,f=this.texV0+l*h*this.texVScale;if(n>yz){Aee(t.eye,t.center,t.up,r,this._renderData);const g=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),y=He((g-1.5)/(l-1.5),0,1);p=this.texV0+y*c*this.texVScale,f=this.texV0+ti(this.texV1,l*h,y)*this.texVScale}Li(this._renderData.texV,p,f)}_createRibbon(t){const i=new Float32Array(3+3*DP*3),r=new Uint32Array(3*DP*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<DP;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this.innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this.middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this.outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===DP-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=Cee.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Os(t,Ri,{geometry:Zl(Cee)},{geometry:si.createVertex(t,mi.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,i,r,s){return fe(mE,s.silCircleCenter,s.silCircleV2),oe(_z,mE,this.outerRimFactor),yF(vz,i,mE,r),yee(mE,vz,t.projectionMatrix,t.viewport),yee(_z,vz,t.projectionMatrix,t.viewport),Yi(mE,_z)/t.height}}function Aee(e,t,i,r,s){const n=Ie(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.silCircleV1,c=s.silCircleV2;return oe(s.silCircleCenter,e,a/n),_t(l,e,t),ua(l)<1&&_t(l,e,i),oe(l,l,o/Ie(l)),_t(c,l,e),oe(c,c,o/Ie(c)),o}const vz=Ae(),mE=M(),_z=M();function d9e(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const Cee=ls().vec3f(A.POSITION);function kq(e){const t=T`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=T`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function p9e(){const e=new Fi;return e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.COLOR,"vec4"),e.attributes.add(A.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add(new li("transform")),e.vertex.uniforms.add(new dt("viewport",F.Pass,(t,i)=>i.camera.fullViewport)),e.vertex.uniforms.add(new ye("pixelRatio",F.Pass,(t,i)=>i.camera.pixelRatio)),e.include(kq),e.vertex.code.add(T`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(T`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}const f9e=Object.freeze(Object.defineProperty({__proto__:null,build:p9e},Symbol.toStringTag,{value:"Module"}));class m9e{constructor(){this.modelMatrix=Ae()}}class l4 extends Ki{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=l4.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({blending:po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:Ji.LEQUAL},colorWrite:Qt})}bindPass(t,i){this.program.bindPass(t,i);const r=this._makeInfiniteProjectionMatrix(i.camera.projectionMatrix,i.camera.near,g9e);xr(r,r,i.camera.viewMatrix),xr(r,r,t.modelMatrix),this.program.setUniformMatrix4fv("transform",r)}_makeInfiniteProjectionMatrix(t,i,r){return os(r,t),r[10]=24e-8-1,r[11]=-1,r[14]=(24e-8-2)*i,r}}l4.shader=new Vi(f9e,()=>import("./Stars.glsl.31927389.js"));const g9e=Ae(),y9e=pe.getLogger("esri.views.3d.environment.Stars");let Iy=class extends be{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new m9e,this._updatingTracking=new jp}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return _(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=rh(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=$i(this._technique),this._vao=it(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),C(this._technique)||C(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Dt.POINTS,0,this._numPoints)}_ensureResources(e){if(_(this._technique)||C(xw))return;this._technique=new l4({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=xw.byteLength/Ree;const t=new Float32Array(xw,0,2*this._numPoints),i=new Uint8Array(xw,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(()=>{var r;return(r=this.view)==null?void 0:r.environment.lighting.date},r=>this._update(r),Bi)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=os(this._renderParameter.modelMatrix,b9e);bS(r,r,-i*Math.PI),xr(r,_9e,r),bS(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=Oee.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[l]),f=this._hexToRGB(v9e[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new Os(e,Ri,{geometry:Zl(Oee)},{geometry:si.createVertex(e,mi.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(_(xw))return null;const e=PO(async t=>{const{data:i}=await RCe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(i),xw=i});return e.promise.catch(t=>{Tr(t)||y9e.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new Y("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/Ree;if(t%1!=0||t>5e4||t<5e3)throw new Y("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],Iy.prototype,"view",void 0),u([d({constructOnly:!0})],Iy.prototype,"requestRender",void 0),u([d({readOnly:!0})],Iy.prototype,"updating",null),u([d()],Iy.prototype,"_loadDataTask",void 0),u([d()],Iy.prototype,"_updatingTracking",void 0),Iy=u([P("esri.views.3d.environment.Stars")],Iy);const v9e=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],_9e=Gj(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),b9e=Gj(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Ree=9,Oee=ls().vec3f(A.POSITION).vec4u8(A.COLOR).f32(A.SIZE);let xw=null;var aC;const w9e=[we.POSTPROCESSING_ENVIRONMENT_OPAQUE,we.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Mee,Zo=aC=class extends be{constructor(e){super(e),this._handles=new Jt,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(w9e,this)}destroy(){var e;this._pendingAtmosphere=ct(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=ct(this._handles),this._set("view",null)}get atmosphereType(){return _(this._pendingAtmosphere)?this._pendingAtmosphere.type:_(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!((e=this.view.basemapTerrain)==null||!e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!_(this._precipitation)&&this._precipitation.update(e)}get updating(){return _(this._pendingAtmosphere)||_(this._stars)&&this._stars.updating||_(this._clouds)&&this._clouds.running}get weatherVisible(){return Ie(this.view.state.camera.eye)-Ci(this.view.spatialReference).radius<=Fu}get _stars(){var e,t;const i=this.view,r=(e=(t=i.environment)==null?void 0:t.starsEnabled)!=null&&e,s=this._get("_stars");return!r||C(this._context)?(ct(s),null):_(s)?s:new Iy({view:i,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||C(this._context))return ct(e),null;const t=this.view,i=this._context;return _(e)&&e.context===i?e:(ct(e),new z_({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||C(this._context))return ct(e),null;if(_(e))return e;const t=this.view,i=this._context.renderContext.rctx;return ct(e),new Yo({rctx:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudComposition(){const e=this._get("_cloudComposition");if(!this.weatherEnabled||C(this._context))return ct(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=Ci(this.view.spatialReference).radius;return _(e)&&e.viewingMode===t&&e.radius===r?e:(ct(e),new U_({rctx:i,viewingMode:t,radius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||C(this._context))return ct(e),null;if(_(e))return e;const t=this.view,i=this._context;return ct(e),new oC({context:i,view:t})}get weatherEnabled(){var e,t;return!((e=this.view)==null||(t=e.environmentManager)==null||!t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e,this._handles.add([Rd(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),xs),xe(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),xs),xe(()=>this._stars,()=>this._setNeedsRender()),xe(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),Bi),xe(()=>this._precipitation,()=>this._setNeedsRender()),xe(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),Bi),xe(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},xs)])}uninitializeRenderContext(){this._context=null,this._atmosphere=ct(this._atmosphere),this._set("_stars",ct(this._stars)),this._set("_precipitation",ct(this._precipitation)),this._set("_clouds",ct(this._clouds)),this._set("_cloudComposition",ct(this._cloudComposition)),this._set("_fog",ct(this._fog))}render(e){if(e.pass===Ue.MATERIAL)switch(e.bindParameters.slot){case we.POSTPROCESSING_ENVIRONMENT_OPAQUE:_(this._stars)&&this._stars.render(e),_(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),HVe(this._clouds)&&_(this._cloudComposition)&&this._cloudComposition.render(e,this._clouds,_(this.view.animation)));break;case we.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(_(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),_(this._fog)){const i=t==="foggy"||t==="rainy"||t==="snowy";(i||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,i,t==="rainy")}if(_(this._precipitation)){const i=this.view.environment.weather;i.type!=="rainy"&&i.type!=="snowy"||this._precipitation.render(e,i.precipitation,i.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return C(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){C(e)||C(this._clouds)||(this._clouds.applyPreset(Hge[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){_(this._context)&&this._context.requestRender()}_updateFog(e){if(!C(this._fog)&&!C(e))switch(e.type){case"foggy":this._fog.strength=ti(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=ti(4e-6,8e-5,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;_(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return _(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);_(this._context)&&i.initializeRenderContext(this._context),C(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then(()=>{_(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return oee;case"panoramic":return t9e;case"simple":return h9e;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||t==null||ff(this.view.spatialReference)?"none":i==="local"?"panoramic":t==="high"&&_(this._context)&&oee.isSupported(this._context)&&dR(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=_(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{Mee=aC.prototype._getAtmosphereClass,aC.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{aC.prototype._getAtmosphereClass=Mee}}}};u([d({constructOnly:!0})],Zo.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],Zo.prototype,"updating",null),u([d()],Zo.prototype,"weatherVisible",null),u([d()],Zo.prototype,"_context",void 0),u([d()],Zo.prototype,"_pendingAtmosphere",void 0),u([d({readOnly:!0})],Zo.prototype,"_stars",null),u([d({readOnly:!0})],Zo.prototype,"_precipitation",null),u([d({readOnly:!0})],Zo.prototype,"_clouds",null),u([d({readOnly:!0})],Zo.prototype,"_cloudComposition",null),u([d({readOnly:!0})],Zo.prototype,"_fog",null),u([d({readOnly:!0})],Zo.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Zo.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Zo.prototype,"_weatherUpdateParameters",null),Zo=aC=u([P("esri.views.3d.environment.EnvironmentRenderer")],Zo);function Pee(e,t,i){return x9e(e,t.longitude,t.latitude,i.longitude,i.latitude)}function x9e(e,t,i,r,s){const n=$t(i),o=$t(s),a=n-o,l=$t(t)-$t(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*Td(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function T9e(e,t,i){const r=t.spatialReference,s=Ci(r),n=new We(t.x,e.y,r),o=new We(i.x,e.y,r),a=new We(e.x,t.y,r),l=new We(e.x,i.y,r);return{lon:Pee(s.radius,n,o),lat:Pee(s.radius,a,l)}}function S9e(e,t,i){const r=t/i,s=$t(e),n=Math.sin(r/2),o=Math.cos(s),a=2*Td(Math.sqrt(n*n/(o*o)));return el(a)}function E9e(e,t){let i=e/15;return t||(i=Math.round(i)),i}function Iee(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=E9e(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}var $ee,Dee,Lee,oye={exports:{}};$ee=oye,Dee=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f($){return $.valueOf()/l-.5+c}function g($){return new Date(($+.5-c)*l)}function y($){return f($)-h}var v=23.4397*a;function b($,z){return n(t($)*i(v)-r(z)*t(v),i($))}function w($,z){return s(t(z)*i(v)+i(z)*t(v)*t($))}function S($,z,k){return n(t($),i($)*t(z)-r(k)*i(z))}function x($,z,k){return s(t(z)*t(k)+i(z)*i(k)*i($))}function E($,z){return a*(280.16+360.9856235*$)-z}function R($){return a*(357.5291+.98560028*$)}function O($){return a*(1.9148*t($)+.02*t(2*$)+3e-4*t(3*$))}function I($,z){return $+z+102.9372*a+e}function U($,z){var k=R($),G=I(k,O(k));return z||(z={dec:0,ra:0}),z.dec=w(G,0),z.ra=b(G,0),z}var N={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function($,z,k,G){var W=a*-k,ee=a*z,q=y($),te=U(q,p),Ee=E(q,W)-te.ra;return G||(G={azimuth:0,altitude:0}),G.azimuth=S(Ee,ee,te.dec),G.altitude=x(Ee,ee,te.dec),G}},V=[[-.83,"sunrise","sunset"]];N.addTime=function($,z,k){V.push([$,z,k])};var j=9e-4;function H($,z){return Math.round($-j-z/(2*e))}function J($,z,k){return j+($+z)/(2*e)+k}function K($,z,k){return h+$+.0053*t(z)-.0069*t(2*k)}function he($,z,k){return o((t($)-t(z)*t(k))/(i(z)*i(k)))}function le($){var z=a*(134.963+13.064993*$),k=a*(93.272+13.22935*$),G=a*(218.316+13.176396*$)+6.289*a*t(z),W=5.128*a*t(k),ee=385001-20905*i(z);return{ra:b(G,W),dec:w(G,W),dist:ee}}return N.getTimes=function($,z,k){var G=a*-k,W=a*z,ee=H(y($),G),q=J(0,G,ee),te=R(q),Ee=O(te),ve=I(te,Ee),qe=w(ve,0),Ce=K(q,te,ve);function Re(Er){return K(J(he(Er,W,qe),G,ee),te,ve)}function Oe(Er){var Ps=(t(Er)-t(W)*t(qe))/(i(W)*i(qe));return Ps<-1?N.PolarException.MIDNIGHT_SUN:Ps>1?N.PolarException.POLAR_NIGHT:N.PolarException.NORMAL}var Ve,nr,Ti,hi,tn,Sr={solarNoon:g(Ce),nadir:g(Ce-.5),polarException:N.PolarException.NORMAL};for(Ve=0,nr=V.length;Ve<nr;Ve+=1)tn=Ce-((hi=Re((Ti=V[Ve])[0]*a))-Ce),Sr[Ti[1]]=g(tn),Sr[Ti[2]]=g(hi);return Sr.polarException=Oe(V[0][0]*a),Sr},N.getMoonPosition=function($,z,k){var G=a*-k,W=a*z,ee=y($),q=le(ee),te=E(ee,G)-q.ra,Ee=x(te,W,q.dec);return Ee+=.017*a/r(Ee+10.26*a/(Ee+5.1*a)),{azimuth:S(te,W,q.dec),altitude:Ee,distance:q.dist}},N.getMoonFraction=function($){var z=y($),k=U(z),G=le(z),W=149598e3,ee=o(t(k.dec)*t(G.dec)+i(k.dec)*i(G.dec)*i(k.ra-G.ra)),q=n(W*t(ee),G.dist-W*i(ee));return(1+i(q))/2},N},(Lee=Dee())!==void 0&&($ee.exports=Lee);const Cb=oye.exports,Pp={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function A9e(e,t,i,r,s,n,o){se(o.ambient.color,1,1,1),o.ambient.intensity=Pp.global.ambient,se(o.direct.color,1,1,1),o.direct.intensity=Pp.global.direct;const a=t[2],l=He((Math.abs(a)-Pp.local.altitude)/(Pp.global.altitude-Pp.local.altitude),0,1);let c;if(o.globalFactor=l,n==="sun"&&(c=Cb.getTimes(e,t[1],t[0])),l<1){let h;if(n==="sun")h=D9e(e,c,r);else{const p=lye(r);h={direct:{intensity:Pp.local.directAtNoon*p.direct,color:Le(1,1,1)},ambient:{intensity:Pp.local.ambientAtNoon*p.ambient,color:Le(1,1,1)},timeOfDay:"early afternoon"}}Cs(o.ambient.color,h.ambient.color,o.ambient.color,l),o.ambient.intensity=ti(h.ambient.intensity,o.ambient.intensity,l),Cs(o.direct.color,h.direct.color,o.direct.color,l),o.direct.intensity=ti(h.direct.intensity,o.direct.intensity,l),o.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,o.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}o.noonFactor=n==="sun"?$9e(e,c):1,n==="sun"?R9e(e,t,i,o.direct.directionToLightSource):C9e(s,i,o.direct.directionToLightSource)}function C9e(e,t,i){t===je.Global?Te(NP,e.eye):se(NP,0,0,1),sl(LP,L9e,e.viewRight),Fe(i,NP,LP),sl(LP,N9e,NP),Fe(i,i,LP)}function R9e(e,t,i,r){const s=I9e,n=sf(P9e);if(i===je.Global)Cb.getPosition(e,0,0,s),se(r,0,0,-1),_S(n,n,-s.azimuth),mF(n,n,-s.altitude),Fe(r,r,n);else{const o=Pp.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=He(c,0,1),c<1?(Cb.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(r,0,-1,0),bS(n,n,-s.azimuth),_S(n,n,-s.altitude),Fe(r,r,n)}}function O9e(e,t){if(t===je.Global)return!0;const i=Pp.planarDirection;return Math.abs(e)<i.localAltitude}const M9e=Le(.5773502691896258,-.5773502691896258,.5773502691896258);class aye{constructor(){this.ambient={color:Le(1,1,1),intensity:.55},this.direct={color:Le(1,1,1),intensity:.55,directionToLightSource:ts(M9e)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const P9e=Ae(),I9e={azimuth:0,altitude:0};function $9e(e,t){const i=e.valueOf();let r,s;t.polarException===Cb.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===Cb.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-He(Math.abs(i-n)/432e5,0,1)}function lye(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function Nee(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function D9e(e,t,i){const r=e.valueOf();let s,n;t.polarException===Cb.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===Cb.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,g=s+p/2,y=n-p/2,v=n+p/2,b=Pp.local,w=[.01,b.ambientAtNight],S=[.8,.8,1],x=[.01,.01,.01],E=[b.directAtTwilight,b.ambientAtTwilight],R=[1,.6,.5],O=[.8,.8,1],I=[.9*b.directAtNoon,b.ambientAtNoon],U=[1,.98,.98],N=[.98,.98,1],V=[b.directAtNoon,b.ambientAtNoon],j=[1,1,1],H=[1,1,1],J=I,K=U,he=N,le=E,$=R,z=O;let k,G,W=[0,0],ee=[0,0,0],q=[0,0,0];r<f||r>v?(W=w,ee=x,q=S,G="night"):r<g?(k=g-f,W=Wn(r-f,k,w,E),ee=Wn(r-f,k,x,R),q=Wn(r-f,k,S,O),G="sun rising"):r<c?(k=c-g,W=Wn(r-g,k,E,I),ee=Wn(r-g,k,R,U),q=Wn(r-g,k,O,N),G="early morning"):r<a?(k=a-c,W=Wn(r-c,k,I,V),ee=Wn(r-c,k,U,j),q=Wn(r-c,k,N,H),G="late morning"):r<h?(k=h-a,W=Wn(r-a,k,V,J),ee=Wn(r-a,k,j,K),q=Wn(r-a,k,H,he),G="early afternoon"):r<y?(k=y-h,W=Wn(r-h,k,J,le),ee=Wn(r-h,k,K,$),q=Wn(r-h,k,he,z),G="late afternoon"):r<v&&(k=v-y,W=Wn(r-y,k,le,w),ee=Wn(r-y,k,$,x),q=Wn(r-y,k,z,S),G="sun setting");let te=0;switch(i){case"rainy":case"foggy":te=.9;case"snowy":te=.5}te>0&&(ee=Nee(ee,te),q=Nee(q,te));const Ee=Le(ee[0],ee[1],ee[2]),ve=Le(q[0],q[1],q[2]),qe=lye(i);return{direct:{intensity:W[0]*qe.direct,color:Ee},ambient:{intensity:W[1]*qe.ambient,color:ve},timeOfDay:G}}function Wn(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}const LP=Ae(),NP=M(),L9e=.35,N9e=-.5;let Hh=class extends qr.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Jt,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new eG,this._ambientLight=new Dq,this._moonLight=new Xge,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||(e=this._renderer)!=null&&e.updating)}get weatherEnabled(){var e,t,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((t=this._view)==null||(i=t.state)==null?void 0:i.viewingMode)===je.Global&&dR(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Zo({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler(),r=()=>this._updateLighting();this._viewHandles.add([xe(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Qr),xe(()=>e.environment.lighting.date,s=>this._lightingDateHandler(s),Qr),xe(()=>e.stationary,()=>this._interactingStationaryHandler()),xe(()=>e.environment.lighting.directShadowsEnabled,t,Qr),xe(()=>e.environment.lighting.ambientOcclusionEnabled,t,Qr),xe(()=>e.environment.lighting.waterReflectionEnabled,t,Qr),xe(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,Qr),xe(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Qr),xe(()=>e.environment.weather.type,r,Qr),xe(()=>this.weatherEnabled,r,Qr),xe(()=>e.viewingMode,()=>this._resetReferencePosition(!0),xs),xe(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),xs),xe(()=>e.state.camera,i,xs),xe(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=ct(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.date),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!hb(i)){const r=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(r))return void this._requestReferencePositionUpdate(r)}if(this._preupdateTracking(e),_(this._referencePosWGS84Comparable)){const r=Iee(this._referencePosWGS84Comparable,Fee);_(r)&&(t.autoUpdate(null,r),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=dR(this._view.spatialReference);if(i&&!hb(this._view.spatialReference))return!1;const r=e.position;return C(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=M()),i?ZRe(r,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,i=e||t.environment.lighting.date,r=this._referencePosWGS84Comparable,s=_(r)?F9e:U9e;if(_(r)){const h=this.weatherVisible?t.environment.weather.type:"disabled";A9e(i,r,t.state.viewingMode,h,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,o=s.direct;oe(n.intensity,o.color,o.intensity*Math.PI),ne(n.direction,o.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const a=this._ambientLight;oe(a.intensity,s.ambient.color,s.ambient.intensity);const l=this._moonLight;Cs(l.intensity,k9e,B9e,s.globalFactor);const c=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));oe(l.intensity,l.intensity,c),ne(l.direction,o.directionToLightSource),t._stage.renderView.updateLightSources([n,a,l],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||C(e))return!1;const i=z9e;i.setTime((t||this._view.environment.lighting.date).getTime());const r=Iee(e,Fee);if(C(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=Rc(this._referencePosWGS84Comparable,!0,s=>O9e(s[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof tge?{type:"color",color:jj(rt.toUnitRGBA(i.color))}:{type:"color",color:ri(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,enableFillLights:this._view.environment.lighting.type==="sun",background:r})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=iS(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),r=this._referencePosUpdateTimer=iS(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===r&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const i=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[t[0],t[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([d({type:Boolean,readOnly:!0})],Hh.prototype,"updating",null),u([d()],Hh.prototype,"disableQueries",void 0),u([d()],Hh.prototype,"_disableWeather",void 0),u([d()],Hh.prototype,"weatherEnabled",null),u([d()],Hh.prototype,"weatherVisible",null),u([d()],Hh.prototype,"referencePositionWGS84Comparable",null),u([d()],Hh.prototype,"_renderer",void 0),u([d()],Hh.prototype,"_referencePosWGS84Comparable",void 0),Hh=u([P("esri.views.3d.environment.SceneViewEnvironmentManager")],Hh);const F9e=new aye,U9e=new aye,z9e=new Date,Fee={hours:0,minutes:0,seconds:0},k9e=Le(.22,.22,.33),B9e=Le(.22,.22,.22);function iO(e,t){return(e&t)!=0}function kL(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var zt,ur,gn;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(zt||(zt={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(ur||(ur={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(gn||(gn={}));const Y0={selection:ur.NONE,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:gn.TUMBLE};function cye(e,t,i,r){return t=t||e.viewForward,ne(r,t),oe(r,r,Math.sign(Se(t,i))),r}function V9e(e,t,i,r){return W9e(e,t,i,H9e(r,t,i,!0))}function G9e(e,t,i,r){const s=Se(i,de(e,r,t));return fe(e,t,oe(e,i,s))}const j9e={dir:M(),len:0,clip:lt()};function H9e(e,t,i,r){const s=j9e;return e?(i&&r&&(s.len=Yi(t,i)),ne(s.dir,e)):r?(s.len=Yi(t,i),de(s.dir,i,t),oe(s.dir,s.dir,1/s.len)):(de(s.dir,i,t),Te(s.dir,s.dir)),s}function q9e(e,t,i){const r=Se(e,i.dir),s=-mr(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function W9e(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!q9e(e[s],t,r))return!1;return!0}function X9e(e,t,i=Y0){const r=Bq(e,t,i);if(r===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=cye(t,i.interactionDirection,Q9e(e,t,Math.sign(r),tGe),eGe),a=ne(iGe,t.viewForward),l=s.intersectInfiniteManifold(Xc(t.eye,o),n,bz);return t.eye=_(l)?l:s.setAltitude(bz,n,t.eye),t.center=G9e(bz,t.eye,a,t.center),!0}function Bq(e,t,i=Y0){if(!Y9e(e,i))return 0;const r=J9e(e.state.constraints.altitude,K9e);Z9e(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=He(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function Y9e(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==zt.TUMBLE||!iO(t.selection,ur.TILT))}function Z9e(e,t,i){const r=t.interactionType;if(r===zt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===zt.TUMBLE||r===zt.ZOOM,c=Bq(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,kL(c,h,l,a,.05*h,i)}function Q9e(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),oe(r,r,i),r}function J9e(e,t){return t.min=e.min,t.max=e.max,t}const K9e={min:0,max:0},eGe=M(),tGe=M(),iGe=M(),bz=M();function Vq(e,t,i=Y0){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;FP.min=0,FP.max=r,sGe(e,i,FP);const s=Gq(e,t),n=FP.max-s;return n>=-1e-6?0:n}function rGe(e,t,i=Y0){const r=Vq(e,t,i);if(r===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=Gq(e,t)+r,o=ne(oGe,t.eye),a=cye(t,i.interactionDirection,nGe(e,t,cGe),lGe);if(!ov(Hue(s.renderLocation,n),Xc(t.eye,a),UP))return!1;t.eye=UP;const l=de(aGe,t.eye,o);t.center=fe(UP,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,UP);return _(h)&&(t.center=h),!0}function sGe(e,t,i){const r=t.interactionType;if(r===zt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===zt.ZOOM||r===zt.PAN,c=Vq(e,o),h=c===0?0:Gq(e,o);i.min=s,i.max=n,kL(c,h,l,a,.05*h,i)}function Gq(e,t){const i=e.pointsOfInterest.surfaceOrigin;return Yi(t.eye,i.renderLocation)}function nGe(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return dg(i,t.eye,r.renderLocation)}const FP={min:0,max:0},oGe=M(),aGe=M(),lGe=M(),cGe=M(),UP=M();var Rr,zn;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(Rr||(Rr={}));class uGe{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=zn.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(zn||(zn={}));function xf(e){return _(e)&&_(e.dist)}function Uee(e){return(t,i,r)=>(Cs(zee,t,i,r),!Kj(e,zee))}function uye(e){return xf(e)&&e.intersector===Rr.OBJECT&&!!e.target}function hye(e){return xf(e)&&e.intersector===Rr.HUD&&!!e.target&&_(e.target.center)}const zee=M();class hGe{constructor(){this._transform=Ae(),this._transformInverse=new zP({value:this._transform},jr,Ae),this._transformInverseTranspose=new zP(this._transformInverse,rl,Ae),this._transformTranspose=new zP({value:this._transform},rl,Ae),this._transformInverseRotation=new zP({value:this._transform},Bge,Qi)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){os(this._transform,t)}multiplyTransform(t){xr(this._transform,this._transform,t)}set(t){os(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}}class zP{constructor(t,i,r){this.original=t,this.update=i,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class dGe{constructor(t=0){this.offset=t,this.tmpVertex=M()}applyToVertex(t,i,r){const s=t+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)Lg[n]=t[0+n]+this.localOrigin[n],kP[n]=t[3+n]+this.localOrigin[n],Tw[n]=Lg[n];const i=this.applyToVertex(Lg[0],Lg[1],Lg[2]);for(let n=0;n<3;++n)t[n]=i[n],t[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)Tw[o]=(n&1<<o)==0?Lg[o]:kP[o];r(Tw)}let s=0;for(let n=0;n<3;++n)Lg[n]*kP[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?Tw[o]=0:Tw[o]=(n&1<<o)!=0?Lg[o]:kP[o];r(Tw)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const Lg=M(),kP=M(),Tw=M();class pGe{constructor(t=0){this.offset=t,this.componentLocalOriginLength=0,this.tmpVertex=M(),this.mbs=ii(),this.obb={center:M(),halfSize:vi(),quaternion:null}}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,i,r){const s=t,n=i,o=r+this.componentLocalOriginLength,a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(t){const i=t[0],r=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=this.offset/Math.sqrt(i*i+r*r+s*s);t[0]+=i*l,t[1]+=r*l,t[2]+=s*l;const c=this.offset/Math.sqrt(n*n+o*o+a*a);return t[3]+=n*c,t[4]+=o*c,t[5]+=a*c,t}applyToMbs(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.mbs[0]=t[0]+t[0]*r,this.mbs[1]=t[1]+t[1]*r,this.mbs[2]=t[2]+t[2]*r,this.mbs[3]=t[3]+t[3]*this.offset/i,this.mbs}applyToObb(t){const i=t.center,r=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this.obb.center[0]=i[0]+i[0]*r,this.obb.center[1]=i[1]+i[1]*r,this.obb.center[2]=i[2]+i[2]*r,D0(this.obb.halfSize,t.halfSize,t.quaternion),fe(this.obb.halfSize,this.obb.halfSize,t.center);const s=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);return this.obb.halfSize[0]+=this.obb.halfSize[0]*s,this.obb.halfSize[1]+=this.obb.halfSize[1]*s,this.obb.halfSize[2]+=this.obb.halfSize[2]*s,de(this.obb.halfSize,this.obb.halfSize,t.center),iM(Gee,t.quaternion),D0(this.obb.halfSize,this.obb.halfSize,Gee),this.obb.halfSize[0]*=this.obb.halfSize[0]<0?-1:1,this.obb.halfSize[1]*=this.obb.halfSize[1]<0?-1:1,this.obb.halfSize[2]*=this.obb.halfSize[2]<0?-1:1,this.obb.quaternion=t.quaternion,this.obb}}class fGe{constructor(t=0){this.offset=t,this.sphere=Vn(),this.tmpVertex=M()}applyToVertex(t,i,r){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*i+s[8]*r+s[12],o=s[1]*t+s[5]*i+s[9]*r+s[13],a=s[2]*t+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,i){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(t){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}}const kee=new fGe;function oG(e){return _(e)?(kee.offset=e,kee):null}const Bee=new pGe;function Imt(e){return _(e)?(Bee.offset=e,Bee):null}const Vee=new dGe;function mGe(e){return _(e)?(Vee.offset=e,Vee):null}const c1="terrain",Gee=vf();function aG(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function gGe(e,t){const i=e.length;for(let r=0;r<i;++r)hT[0]=e[r],t[r]=hT[0];return t}function yGe(e,t){const i=e.length;for(let r=0;r<i;++r)hT[0]=e[r],hT[1]=e[r]-hT[0],t[r]=hT[1];return t}const hT=new Float32Array(2);function lG(e,t){return C(e)&&(e=[]),e.push(t),e}function cG(e,t){if(C(e))return null;const i=e.filter(r=>r!==t);return i.length===0?null:i}function nM(e){return!!_(e)&&!e.visible}function vGe(e,t,i){const r=e.origin.vec3;eye(wz,-r[0],-r[1],-r[2]),_(e.transformation)?xr(t,wz,e.transformation):os(t,wz),i&&(jr(i,t),rl(i,i))}function _Ge(e,t,i,r,s){BP[0]=e.get(t,0),BP[1]=e.get(t,1),BP[2]=e.get(t,2),aG(BP,Ov,3),i.set(s,0,Ov[0]),r.set(s,0,Ov[1]),i.set(s,1,Ov[2]),r.set(s,1,Ov[3]),i.set(s,2,Ov[4]),r.set(s,2,Ov[5])}const BP=new Float64Array(3),Ov=new Float32Array(6),wz=Ae(),XS=1e-5;class bGe{constructor(t){this.options=new uGe,this._results=new wGe,this.transform=new hGe,this.tolerance=XS,this.verticalOffset=null,this._ray=Ln(),this._rayEnd=M(),this._rayBeginTransformed=M(),this._rayEndTransformed=M(),this.viewingMode=t==null?je.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,i,r){this.resetWithRay(xOe(t,i,this._ray),r)}resetWithRay(t,i){this.camera=i,t!==this._ray&&eL(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===je.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,fe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r==null?XS:r;const o=oG(this.verticalOffset);if(_(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();_(c)?(_(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const i=t.geometryRecords;if(!i)return;const r=t.transformation,s=oG(this.verticalOffset);for(const n of i){const{geometry:o,material:a,instanceParameters:l}=n;if(nM(l))continue;const c=o.id;this.transform.setAndInvalidateLazyTransforms(r,n.getShaderTransformation()),Fe(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),Fe(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;_(s)&&(s.objectTransform=this.transform),a.intersect(o,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(p,f,g,y,v,b)=>{if(p>=0){if(_(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,p))return;const w=y?this._results.hud:this._results,S=y?x=>{const E={object:t,geometryId:c,triangleNr:g,center:_(b)?[b[0],b[1],b[2]]:null};x.set(Rr.HUD,E,p,f,Es,v)}:x=>x.set(Rr.OBJECT,{object:t,geometryId:c,triangleNr:g},p,f,h,v);if((w.min.drapedLayerOrder==null||v>=w.min.drapedLayerOrder)&&(w.min.dist==null||p<w.min.dist)&&S(w.min),this.options.store!==zn.MIN&&(w.max.drapedLayerOrder==null||v<w.max.drapedLayerOrder)&&(w.max.dist==null||p>w.max.dist)&&S(w.max),this.options.store===zn.ALL)if(y){const x=new uG(this._ray);S(x),this._results.hud.all.push(x)}else{const x=new zT(this._ray);S(x),this._results.all.push(x)}}},n.shaderTransformation)}}sortResults(t=this._results.all){t.sort((i,r)=>i.dist!==r.dist?Tt(i.dist,0)-Tt(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?Tt(i.drapedLayerOrder,Number.MAX_VALUE)-Tt(r.drapedLayerOrder,Number.MAX_VALUE):Tt(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-Tt(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function hh(e){return new bGe(e)}class wGe{constructor(){this.min=new zT(Ln()),this.max=new zT(Ln()),this.hud={min:new uG(Ln()),max:new uG(Ln()),all:new Array},this.ground=new zT(Ln()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class zT{constructor(t){this.intersector=Rr.OBJECT,this.normal=M(),this.transformation=Ae(),this._ray=Ln(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return _(this.dist)?(oe(VP,this.ray.direction,this.dist),Ie(VP)):null}getIntersectionPoint(t){return!!xf(this)&&(oe(VP,this.ray.direction,this.dist),fe(t,this.ray.origin,VP),!0)}getTransformedNormal(t){return ne(gE,this.normal),gE[3]=0,Lc(gE,gE,this.transformation),ne(t,gE),Te(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Rr.OBJECT,eL(t,this._ray)}set(t,i,r,s,n,o,a){this.intersector=t,this.dist=r,ne(this.normal,Tt(s,sae)),os(this.transformation,Tt(n,Es)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){eL(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,ne(this.normal,t.normal),os(this.transformation,t.transformation)}}class uG extends zT{constructor(){super(...arguments),this.intersector=Rr.HUD}}function jq(e){return new zT(e)}const VP=M(),gE=ii();function dye(e,t,i,r){return _(e.renderCoordsHelper.fromRenderCoords(t.eye,BL,r))&&Ple(i,BL)}function c4(e,t){return e.elevationProvider?Tt(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function tw(e,t,i,r){const s=e.state.camera.clone();t&&(s.eye=t,s.center=i,s.up=r),xGe(e,s.ray,Ng)||ne(Ng,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(fa(s.eye,Ng)<o){const a=n.collision.enabled;ne(Mv,s.viewForward),oe(Mv,Mv,o),a?s.eye=de(BL,Ng,Mv):fe(Ng,s.eye,Mv);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(de(Mv,Ng,s.eye),s.eye=l.setAltitude(BL,h,s.eye),fe(Ng,s.eye,Mv))}return s.center=Ng,s}function jee(e,t,i){if(!e.state.isGlobal)return!1;const r=c4(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,SGe),o=n*n;return fa(t,i)>o}function xGe(e,t,i){let r=Hee[e.viewingMode];r||(r=hh(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Hee[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||jee(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||jee(e,t.origin,i))||!!s&&TGe(t,i,Ci(e.spatialReference).radius)}function TGe(e,t,i){const r=Se(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return oe(t,e.direction,s/Ie(e.direction)),fe(t,t,e.origin),!0}const Hee={},BL=M(),Ng=M(),Mv=M(),SGe={near:0,far:0};function D2(e,t,i=eh.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=c4(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Ie(t.eye);if(de(GP,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(EGe,o,t.eye),i===eh.EYE_AND_CENTER)t.center=fe(GP,t.eye,GP);else if(i===eh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=oe(GP,t.center,l)}return!0}var eh;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(eh||(eh={}));const GP=M(),EGe=M();function Z0(e,t,i){e.worldUpAtPosition(t,qee),de(xz,i,t);const r=Ie(xz);return r===0?0:Hs(Se(xz,qee)/r)}const qee=M(),xz=M();function pye(e,t,i=Y0,r=!0){yE.eyeCenterDistance=0,yE.requiresTwoSteps=!1;const s=Hq(e,t,i,void 0,yE);if(s===0)return!1;switch(sl(jP,-s,t.viewRight),i.tiltMode){case gn.LOOK_AROUND:Fe(Fg,t.viewForward,jP),oe(Fg,Fg,yE.eyeCenterDistance),t.center=fe(Ky,t.eye,Fg);break;case gn.TUMBLE:de(Fg,t.center,t.eye),Fe(Fg,Fg,jP),t.eye=de(Ky,t.center,Fg);break;default:i.tiltMode}return t.up=Fe(Ky,t.up,jP),!yE.requiresTwoSteps||!r||pye(e,t,i,!1)}function Hq(e,t,i=Y0,r=Y0,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,LGe);return DGe(e,i,o),r.interactionType===zt.TUMBLE&&iO(r.selection,ur.ALTITUDE)&&fye(e,r.interactionStartCamera,o),i.tiltMode===gn.LOOK_AROUND||r.tiltMode===gn.LOOK_AROUND?CGe(e,t,o,s):AGe(e,t,o)}function AGe(e,t,i){const r=Z0(e.renderCoordsHelper,t.center,t.eye),s=r-He(r,i.min,i.max);return rO(s)?s:0}function CGe(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return OGe(e,t,i,r);case"local":return RGe(e,t,i,r);default:return void(e.viewingMode,void 0)}}function RGe(e,t,i,r){const s=Z0(e.renderCoordsHelper,t.center,t.eye),n=He(s,i.min,i.max),o=s-n;if(!rO(o))return 0;if(r){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=t.distance}return o}function OGe(e,t,i,r){const s=MGe(e,t,NGe),n=He(s.tiltAtCenter,i.min,i.max);if(!rO(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=PGe(s),a=IGe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=$Ge(s,o)),r&&(r.eyeCenterDistance=hG(s,o)),a}function MGe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+Ci(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,Ky);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,_(n)?(i.eyeCenterDistance=Yi(t.eye,n),i.tiltAtCenter=Z0(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=Z0(e.renderCoordsHelper,t.center,t.eye):(x2(s,t.ray,Ky),i.eyeCenterDistance=Yi(t.eye,Ky),i.tiltAtCenter=Hs(-Se(t.viewForward,Te(Ky,Ky)))),i.radius=s,i.eyeRadius=Ie(t.eye),i.constraints=e.state.constraints,i}function rO(e){return Math.abs(e)>1e-9}function PGe(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const o=hG(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&rO(n-s);){const l=(s+n)/2,c=hG(e,l);rO(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function hG(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-He(t,0,Math.PI),r=Td(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function IGe(e,t){const i=Td(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=Td(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function $Ge(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function DGe(e,t,i){if(t.interactionType===zt.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t,{min:n,max:o}=i,a=Hq(e,r,Y0,t),l=a===0?0:Z0(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===zt.TUMBLE?(iO(t.selection,ur.ALTITUDE)&&fye(e,r,i),kL(a,l,!0,s,Wee,i)):kL(a,l,!1,s,Wee,i)}function fye(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const s=ua(t.center),n=Math.sqrt(s),o=t.distance,a=Ci(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-Hs(p),i.max)),i.max=Math.min(i.max,Math.PI-Hs(h))}const Fg=M(),jP=Ae(),Ky=M(),Wee=$t(5),LGe={min:0,max:0},NGe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},yE={eyeCenterDistance:0,requiresTwoSteps:!1};function FGe(e){return e}const u4=e=>e*e,qq=e=>1-u4(1-e),UGe=e=>e<.5?u4(2*e)/2:(qq(2*(e-.5))+1)/2,Wq=e=>e*e*e,mye=e=>1-Wq(1-e),gye=e=>e<.5?Wq(2*e)/2:(mye(2*(e-.5))+1)/2,Xq=e=>e*e*e*e,yye=e=>1-Xq(1-e),zGe=e=>e<.5?Xq(2*e)/2:(yye(2*(e-.5))+1)/2,Yq=e=>e*e*e*e*e,vye=e=>1-Yq(1-e),kGe=e=>e<.5?Yq(2*e)/2:(vye(2*(e-.5))+1)/2,Zq=e=>1-Math.cos(e*Math.PI/2),_ye=e=>1-Zq(1-e),BGe=e=>e<.5?Zq(2*e)/2:(_ye(2*(e-.5))+1)/2,Qq=e=>2**(10*(e-1)),oM=e=>1-Qq(1-e),VGe=e=>e<.5?Qq(2*e)/2:(oM(2*(e-.5))+1)/2,Jq=e=>-(Math.sqrt(1-e*e)-1),bye=e=>1-Jq(1-e),GGe=e=>e<.5?Jq(2*e)/2:(bye(2*(e-.5))+1)/2;function gh(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function yh(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const jGe=yh(gh(1),1),HGe=yh(gh(1),0),wye=yh(gh(1),.5),qGe=yh(gh(2),1),WGe=yh(gh(2),0),XGe=yh(gh(2),.5),YGe=yh(gh(3),1),ZGe=yh(gh(3),0),QGe=yh(gh(3),.5),JGe=yh(gh(4),1),KGe=yh(gh(4),0),e7e=yh(gh(4),.5),t7e={linear:FGe,"in-quad":u4,"out-quad":qq,"in-out-quad":UGe,"in-coast-quad":jGe,"out-coast-quad":HGe,"in-out-coast-quad":wye,"in-cubic":Wq,"out-cubic":mye,"in-out-cubic":gye,"in-coast-cubic":qGe,"out-coast-cubic":WGe,"in-out-coast-cubic":XGe,"in-quart":Xq,"out-quart":yye,"in-out-quart":zGe,"in-coast-quart":YGe,"out-coast-quart":ZGe,"in-out-coast-quart":QGe,"in-quint":Yq,"out-quint":vye,"in-out-quint":kGe,"in-coast-quint":JGe,"out-coast-quint":KGe,"in-out-coast-quint":e7e,"in-sine":Zq,"out-sine":_ye,"in-out-sine":BGe,"in-expo":Qq,"out-expo":oM,"in-out-expo":VGe,"in-circ":Jq,"out-circ":bye,"in-out-circ":GGe};function Kr(e,t,i=n7e,r=t){let s=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let a=0;a<o7e;a++){let l=0;for(const c of s7e)if(iO(i.selection,c.type)){const h=Math.abs(c.error(e,r,i));c.apply(e,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=iO(i.selection,ur.COLLISION),o=i7e(i.interactionType,e);return n&&D2(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function i7e(e,t){switch(e){case zt.PAN:return eh.EYE_AND_CENTER;case zt.ASCEND:return t.state.isGlobal?eh.EYE_AND_CENTER_SCALE:eh.EYE_AND_CENTER;default:return eh.EYE}}function sd(e,t){const i=typeof e=="number"?e:NT(e,t),r=Math.min(1,i/150);return gye(r)}function r7e(e,t,i){return Hq(e,t,i)*t.distance}const s7e=[{type:ur.TILT,error:r7e,apply:pye},{type:ur.ALTITUDE,error:Bq,apply:X9e},{type:ur.DISTANCE,error:Vq,apply:rGe}],n7e={selection:ur.ALL,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:gn.TUMBLE},o7e=5,tc=M(),ul=M(),Ug=M(),yo=M(),Pv=M(),a7e=M(),ic={upward:Le(0,0,1),forward:Le(0,1,0),sideway:Le(1,0,0)},Xee=Qi();class Yee{constructor(t=je.Global){this.viewingMode=t,this.center=M(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=ts(ic.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===je.Global){const n=(Ie(this.center)+Ie(t.center))/2;i.pan=nz(this.center,t.center)*n}else i.pan=Yi(this.center,t.center);let r=Math.abs(t.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(t,i,r){this.viewingMode===je.Global?N6e(t.center,i.center,r.pan,this.center):Cs(this.center,t.center,i.center,r.pan),this.distance=ti(t.distance,i.distance,r.zoom),this.pitch=ti(t.pitch,i.pitch,r.rotate);let s=t.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=ti(s,n,r.rotate)}copyFrom(t){ne(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,ne(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,Xee);ne(this.center,t.center),de(yo,t.center,t.eye),so(yo,yo,i),so(Pv,t.up,i),this.distance=Ie(yo),yo[0]/=this.distance,yo[1]/=this.distance,yo[2]/=this.distance,this.pitch=this._eyeUpToPitch(yo),this.yaw=this._eyeUpToYaw(yo,Pv),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,Xee);lh(i,i),this._axisAngleVec3(ic.sideway,this.pitch-Math.PI/2,ic.forward,yo),this._axisAngleVec3(ic.upward,this.yaw,yo),this._axisAngleVec3(ic.sideway,this.pitch-Math.PI/2,ic.upward,Pv),this._axisAngleVec3(ic.upward,this.yaw,Pv),oe(yo,yo,this.distance),so(yo,yo,i),so(Pv,Pv,i),t.center=this.center,t.eye=de(yo,this.center,yo),t.up=Pv}_axisAngleVec3(t,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return oe(tc,r,n),_t(ul,t,r),oe(ul,ul,o),oe(Ug,t,(1-n)*Se(t,r)),fe(s,fe(s,tc,ul),Ug)}_lookAtOrientation(t,i=Qi()){return this._upAtLookAt(t,Ug),_t(tc,this.lookAtDirection,Ug),Te(tc,tc),tc[0]===0&&tc[1]===0&&tc[2]===0&&ne(tc,ic.sideway),_t(ul,Ug,tc),Te(ul,ul),i[0]=tc[0],i[1]=ul[0],i[2]=Ug[0],i[3]=tc[1],i[4]=ul[1],i[5]=Ug[1],i[6]=tc[2],i[7]=ul[2],i[8]=Ug[2],i}_upAtLookAt(t,i){return this.viewingMode===je.Local?ne(i,ic.upward):Te(i,t)}_eyeUpToPitch(t){return Math.PI-nz(ic.upward,t)}_eyeUpToYaw(t,i){const r=a7e;return Math.abs(i[2])<.5?(ne(r,i),t[2]>0&&oe(r,r,-1)):ne(r,t),_t(ul,r,ic.upward),Te(ul,ul),nz(ic.sideway,ul,ic.upward)}}function Kq(e){return e?{ray:Ln(e.ray),c0:e.c0,c1:e.c1}:{ray:Ln(),c0:0,c1:Number.MAX_VALUE}}function l7e(e,t=Kq()){return eL(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function c7e(e,t,i=Kq()){const r=Ie(e.vector);return jue(e.origin,t,i.ray),i.c0=0,i.c1=r,i}new mg(()=>({c0:0,c1:0,ray:null}));function sO(e){return e?[fi(e[0]),fi(e[1]),fi(e[2]),fi(e[3]),fi(e[4]),fi(e[5])]:[fi(),fi(),fi(),fi(),fi(),fi()]}function xye(){return[M(),M(),M(),M(),M(),M(),M(),M()]}function VL(e,t){for(let i=0;i<Q0.NUM;i++)xF(e[i],t[i])}function Tye(e,t,i,r=m7e){const s=xr(qj.get(),t,e);jr(s,s);for(let n=0;n<dG.NUM;++n){const o=Lc(Hj.get(),f7e[n],s);se(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Sye(i,r)}function Sye(e,t){Oo(t[Qe.FAR_BOTTOM_LEFT],t[Qe.NEAR_BOTTOM_LEFT],t[Qe.NEAR_TOP_LEFT],e[cr.LEFT]),Oo(t[Qe.NEAR_BOTTOM_RIGHT],t[Qe.FAR_BOTTOM_RIGHT],t[Qe.FAR_TOP_RIGHT],e[cr.RIGHT]),Oo(t[Qe.FAR_BOTTOM_LEFT],t[Qe.FAR_BOTTOM_RIGHT],t[Qe.NEAR_BOTTOM_RIGHT],e[cr.BOTTOM]),Oo(t[Qe.NEAR_TOP_LEFT],t[Qe.NEAR_TOP_RIGHT],t[Qe.FAR_TOP_RIGHT],e[cr.TOP]),Oo(t[Qe.NEAR_BOTTOM_LEFT],t[Qe.NEAR_BOTTOM_RIGHT],t[Qe.NEAR_TOP_RIGHT],e[cr.NEAR]),Oo(t[Qe.FAR_BOTTOM_RIGHT],t[Qe.FAR_BOTTOM_LEFT],t[Qe.FAR_TOP_LEFT],e[cr.FAR])}function m0(e,t){for(let i=0;i<Q0.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function u7e(e,t){return Aye(e,l7e(t,Cye.get()))}function h7e(e,t,i){return Aye(e,c7e(t,i,Cye.get()))}function Eye(e,t){for(let i=0;i<Q0.NUM;i++)if(mr(e[i],t)>0)return!1;return!0}function d7e(e,t){for(let i=0;i<Q0.NUM;i++)if(GOe(e[i],t))return!1;return!0}function Aye(e,t){for(let i=0;i<Q0.NUM;i++)if(!jOe(e[i],t))return!1;return!0}var cr,Qe;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(cr||(cr={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Qe||(Qe={}));const p7e={bottom:[Qe.FAR_BOTTOM_RIGHT,Qe.NEAR_BOTTOM_RIGHT,Qe.NEAR_BOTTOM_LEFT,Qe.FAR_BOTTOM_LEFT],near:[Qe.NEAR_BOTTOM_LEFT,Qe.NEAR_BOTTOM_RIGHT,Qe.NEAR_TOP_RIGHT,Qe.NEAR_TOP_LEFT],far:[Qe.FAR_BOTTOM_RIGHT,Qe.FAR_BOTTOM_LEFT,Qe.FAR_TOP_LEFT,Qe.FAR_TOP_RIGHT],right:[Qe.NEAR_BOTTOM_RIGHT,Qe.FAR_BOTTOM_RIGHT,Qe.FAR_TOP_RIGHT,Qe.NEAR_TOP_RIGHT],left:[Qe.FAR_BOTTOM_LEFT,Qe.NEAR_BOTTOM_LEFT,Qe.NEAR_TOP_LEFT,Qe.FAR_TOP_LEFT],top:[Qe.FAR_TOP_LEFT,Qe.NEAR_TOP_LEFT,Qe.NEAR_TOP_RIGHT,Qe.FAR_TOP_RIGHT]};var Q0,dG;(function(e){e[e.NUM=6]="NUM"})(Q0||(Q0={})),function(e){e[e.NUM=8]="NUM"}(dG||(dG={}));const f7e=[ri(-1,-1,-1,1),ri(1,-1,-1,1),ri(1,1,-1,1),ri(-1,1,-1,1),ri(-1,-1,1,1),ri(1,-1,1,1),ri(1,1,1,1),ri(-1,1,1,1)],Cye=new mg(Kq),m7e=xye(),g7e=pe.getLogger("esri.views.3d.webgl-engine.lib.Camera");class Di{constructor(t=null,i=null,r=null){this._viewUp=M(),this._viewForward=M(),this._viewRight=M(),this._ray=Ln(),this._viewport=ri(0,0,1,1),this._padding=ri(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Oi(1,1e3),this._viewDirty=!0,this._viewMatrix=Ae(),this._projectionDirty=!0,this._projectionMatrix=Ae(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ae(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ae(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=sO(),this._fullViewport=ii(),this.pixelRatio=1,this.relativeElevation=0,_(t)&&ne(this._ray.origin,t),this._center=_(i)?ts(i):M(),this._up=_(r)?ts(r):Le(0,0,1)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return de(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){os(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[Ot.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[Ot.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[Ot.RIGHT]+this._padding[Ot.LEFT]}set fullWidth(t){this.width=t-(this._padding[Ot.RIGHT]+this._padding[Ot.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Ot.TOP]+this._padding[Ot.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Ot.TOP]+this._padding[Ot.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Ot.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Ot.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[Ot.TOP]===t[Ot.TOP]&&this._padding[Ot.RIGHT]===t[Ot.RIGHT]&&this._padding[Ot.BOTTOM]===t[Ot.BOTTOM]&&this._padding[Ot.LEFT]===t[Ot.LEFT]||(this._viewport[0]+=t[Ot.LEFT]-this._padding[Ot.LEFT],this._viewport[1]+=t[Ot.BOTTOM]-this._padding[Ot.BOTTOM],this._viewport[2]-=t[Ot.RIGHT]+t[Ot.LEFT]-(this._padding[Ot.RIGHT]+this._padding[Ot.LEFT]),this._viewport[3]-=t[Ot.TOP]+t[Ot.BOTTOM]-(this._padding[Ot.TOP]+this._padding[Ot.BOTTOM]),Dc(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(xr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,r=this.near*Math.tan(this.fovY/2),s=r*this.aspect;tue(this._projectionMatrix,-s*(1+2*this._padding[Ot.LEFT]/t),s*(1+2*this._padding[Ot.RIGHT]/t),-r*(1+2*this._padding[Ot.BOTTOM]/i),r*(1+2*this._padding[Ot.TOP]/i),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return C(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Ae()),this._inverseProjectionDirty&&jr(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){os(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Y8e(this._fov,this.width,this.height)}set fovX(t){this._fov=W8e(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Z8e(this._fov,this.width,this.height)}set fovY(t){this._fov=X8e(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Yi(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(jr(this._viewInverseTransposeMatrix,this.viewMatrix),rl(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){ne(this._ray.origin,t.eye),ne(this._center,t.center),ne(this._up,t.up),Dc(this._viewport,t.viewport),Dc(this._padding,t.padding),Bn(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(os(this._viewMatrix,t.viewMatrix),ne(this._viewRight,t.viewRight),ne(this._viewUp,t.viewUp),ne(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(os(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(VL(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(os(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Dc(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new Di().copyFrom(this)}equals(t){return da(this.eye,t.eye)&&da(this._center,t.center)&&da(this._up,t.up)&&Z1(this._viewport,t.viewport)&&Z1(this._padding,t.padding)&&oge(this._nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this.pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const i=5e-4,r=1-1e-10;Qp(vo,t.eye,t.center),Qp(Tz,this.eye,this._center);const s=Se(vo,Tz),n=G6(vo),o=G6(Tz);return s*s>=r*n*o&&$7(t.eye,this.eye)<Math.max(n,o)*i*i&&$D(t.padding,this._padding)<.5&&$D(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(DC(this.viewForward,de(vo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=Vr()){return t[0]=(this.padding[Ot.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[Ot.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,i=.5,r=.5){return t[0]=this.padding[Ot.LEFT]+this.width*i,t[1]=this.padding[Ot.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const i=this.viewport,r=this.padding;t.setViewport(i[0]-r[3],i[1]-r[2],i[2]+r[1]+r[3],i[3]+r[0]+r[2])}applyProjection(t,i){t!==kt&&ne(kt,t),kt[3]=1,Lc(kt,kt,this.projectionMatrix);const r=Math.abs(kt[3]);oe(kt,kt,1/r);const s=this.fullViewport;i[0]=ti(0,s[0]+s[2],.5+.5*kt[0]),i[1]=ti(0,s[1]+s[3],.5+.5*kt[1]),i[2]=.5*(kt[2]+1),i[3]=r}unapplyProjection(t,i){const r=this.fullViewport;kt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],kt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],kt[2]=(2*t[2]-1)*t[3],kt[3]=t[3],Lc(kt,kt,this.inverseProjectionMatrix),i[0]=kt[0],i[1]=kt[1],i[2]=kt[2]}projectToScreen(t,i){this.projectToRenderScreen(t,Sz),this.renderToScreen(Sz,i)}projectToRenderScreen(t,i){if(kt[0]=t[0],kt[1]=t[1],kt[2]=t[2],kt[3]=1,Lc(kt,kt,this.viewProjectionMatrix),kt[3]===0)return null;oe(kt,kt,1/Math.abs(kt[3]));const r=this.fullViewport;return"x"in i?(i.x=ti(0,r[0]+r[2],.5+.5*kt[0]),i.y=ti(0,r[1]+r[3],.5+.5*kt[1])):(i[0]=ti(0,r[0]+r[2],.5+.5*kt[0]),i[1]=ti(0,r[1]+r[3],.5+.5*kt[1]),i.length>2&&(i[2]=.5*(kt[2]+1))),i}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,Sz),i)}unprojectFromRenderScreen(t,i){if(xr(HP,this.projectionMatrix,this.viewMatrix),!jr(HP,HP))return null;const r=this.fullViewport;return kt[0]=2*(t[0]-r[0])/r[2]-1,kt[1]=2*(t[1]-r[1])/r[3]-1,kt[2]=2*t[2]-1,kt[3]=1,Lc(kt,kt,HP),kt[3]===0?null:(i[0]=kt[0]/kt[3],i[1]=kt[1]/kt[3],i[2]=kt[2]/kt[3],i)}constrainWindowSize(t,i,r,s=r){const n=t*this.pixelRatio,o=i*this.pixelRatio,a=Math.max(n-r/2,0),l=Math.max(this.fullHeight-o-s/2,0),c=-Math.min(n-r/2,0),h=-Math.min(this.fullHeight-o-s/2,0);return[a,l,r-c- -Math.min(this.fullWidth-n-r/2,0),s-h- -Math.min(o-s/2,0)]}computeUp(t){t===je.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,i){const r=t[0]*this.pixelRatio,s=this.fullHeight-t[1]*this.pixelRatio;return i[0]=r,i[1]=s,i}renderToScreen(t,i){const r=t[0]/this.pixelRatio,s=(this.fullHeight-t[1])/this.pixelRatio;i[0]=r,i[1]=s}_computeUpGlobal(){de(vo,this.center,this.eye);const t=Ie(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty()):Math.abs(Se(vo,this.center))>.9999*Ie(vo)*t||(_t(this._up,vo,this.center),_t(this._up,this._up,vo),Te(this._up,this._up),this._markViewDirty())}_computeUpLocal(){dg(vo,this.eye,this.center),Math.abs(vo[2])<=.9999&&(oe(vo,vo,vo[2]),se(this._up,-vo[0],-vo[1],1-vo[2]),Te(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,i){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?da(t,i)||(ne(i,t),this._markViewDirty()):g7e.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Tye(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(yF(this._viewMatrix,this.eye,this._center,this._up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const kt=ii(),HP=Ae(),vo=M(),Tz=M(),Sz=no();var Ot;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(Ot||(Ot={}));const GL={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class eW{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:GL.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new eW(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:GL.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class y7e{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,i)=>t+i.time,0)}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),t*=this.time;let r=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(t<=a.time||o===this.segments.length-1){i=this.segmentInterpolateComponentsAt(a,t/a.time,i),n.hasPan?i.pan=(r+l.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate?i.rotate=(s+l.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1;const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?i.zoom=(c-h)/(p-h):i.zoom=1,i}t-=a.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(t,i,r){return t.interpolateComponentsAt(i,r)}}class Ez{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);const n=(t.source.pixelsPerRotateAtZoom(r)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const r=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}}function v7e(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function _7e(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function b7e(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function w7e(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function x7e(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function T7e(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function S7e(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function E7e(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function A7e(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function C7e(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function R7e(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function O7e(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function M7e(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function P7e(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function I7e(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function $7e(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}function D7e(e,t){let i=L7e(e,t);const r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?w7e:v7e,a=s?x7e:_7e,l=s?T7e:b7e,c=n?M7e:C7e,h=n?P7e:R7e,p=n?I7e:O7e,f=E=>o(e,E,r)+S7e(e,E,r)+c(e,E,r),g=E=>a(e,E,r)+E7e(e,E,r)+h(e,E,r),y=E=>l(e,E,r)+A7e(e,E,r)+p(e,E,r);let v=f(i);const b=$7e(e);let w;const S=t.maximumIterations||20,x=t.maximumDistance!=null?t.maximumDistance:1/0;for(w=0;w<S;w++){const R=(g(i)+1e-6)/y(i);if(isNaN(R)||i>=x&&R<0){if(!isFinite(x))return null;i=x,v=f(i);break}if(i-=R,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const O=f(i);if(Math.abs(O-v)/v<=.005)break;v=O}return v>b*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function L7e(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class N7e extends y7e{constructor(t,i){super(),this._preallocSegments=[new Ez,new Ez,new Ez],this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=null;i&&i.apex&&(r=D7e(t,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i.apex)}segmentInterpolateComponentsAt(t,i,r){return r=t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=qq(r.zoom):t===this._descensionSegment&&(r.zoom=u4(r.zoom)),r}_updateWithApex(t,i){const[r,s,n]=this._preallocSegments,o=i.ascensionFactor!=null?i.ascensionFactor:.5,a=Math.min(1-o,i.ascensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const F7e={zoom:0,pan:0,rotate:0};class U7e{constructor(t){this.createCamera=t,this._time=0,this.definition=new eW(t),this.path=new N7e}get time(){return this._time}update(t,i,r){this.definition.update(t,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(Roe(this.path.time),r),this._easing=r.easing?r.easing:this._time>=1e3?wye:oM}cameraAt(t,i){i=i||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const r=this.path.interpolateComponentsAt(t,F7e);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(t){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(t,this._time)-i)/(r-i)}_applyTimeSettings(t,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?t=i.duration:i.speedFactor!=null&&(t=t/r);const s=i.minDuration!=null?i.minDuration:GL.minDuration/r,n=i.maxDuration!=null?i.maxDuration:GL.maxDuration/r;return Math.min(Math.max(s,t),n)}}const z7e=M();class k7e{constructor(t){this.currentTime=0,this._animation=new U7e(()=>new Yee(t)),this._current=new Yee(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=de(z7e,i.center,t.center),a=Ie(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ne(s.lookAtDirection,o),ne(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new Di,this._current.copyToRenderCamera(i),i}step(t,i){return this.finished||(this.currentTime=this.currentTime+Roe(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}}var Cr;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(Cr||(Cr={}));let E1=class extends be{constructor(){super(...arguments),this.state=Cr.Ready}get active(){return this.state===Cr.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Cr.Stopped,!0)}finishController(){this.state=Cr.Finished}get steppingFinished(){return!1}};u([d({readOnly:!0})],E1.prototype,"active",null),u([d()],E1.prototype,"state",void 0),E1=u([P("esri.views.3d.state.controllers.CameraController")],E1);let nO=class extends E1{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(gi()),this._asyncResult=null),this.state===Cr.Finished||this.state===Cr.Stopped?this.state===Cr.Finished?e.resolve():e.reject(gi()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Cr.Running,_(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!_(this.viewAnimation)||this.state!==Cr.Ready&&this.state!==Cr.Running||(this.viewAnimation.state===DS.State.FINISHED?this.finish():this.viewAnimation.state===DS.State.STOPPED&&(this.state=Cr.Stopped))}onControllerEnd(){_(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Cr.Finished?this.viewAnimation.finish():this.state===Cr.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Cr.Finished?this._asyncResult.resolve():this._asyncResult.reject(gi()))}finish(){this.finishController()}};nO=u([P("esri.views.3d.state.controllers.AnimationController")],nO);let zm=class extends nO{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new k7e(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new DS}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);qP.copyFrom(this.view.state.camera);const r=hh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(qP.ray,r,Zee)&&(qP.center=Zee),this.animation.update(qP,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return ge(L({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},e),{easing:typeof e.easing=="string"?t7e[e.easing]:e.easing})}};u([d({constructOnly:!0})],zm.prototype,"view",void 0),u([d({constructOnly:!0})],zm.prototype,"mode",void 0),zm=u([P("esri.views.3d.state.controllers.PointToPointAnimationController")],zm);const qP=new Di,Zee=M();function Rye(e,t,i){return B7e(e,e.screenToRender(t,Ge.get()),i)}function B7e(e,t,i){const r=Bn(Ge.get(),t);if(r[2]=0,!e.unprojectFromRenderScreen(r,i.origin))return null;const s=Bn(Ge.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,Ge.get());return C(n)?null:(de(i.direction,n,i.origin),i)}function L2(e,t,i){return tW(e,e.screenToRender(t,Ge.get()),i)}function tW(e,t,i){ne(i.origin,e.eye);const r=se(Ge.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(r,Ge.get());return C(s)?null:(de(i.direction,s,i.origin),i)}function iW(e,t,i,r){const s=L2(t,i,V7e);return ov(e,s,r)}const V7e=Ln(),Oye=30,jL=[1,3e8],Mye=70;function j1(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function pG(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function J0(e,t,i){const r=sl(qj.get(),i[3],i);de(Ii,e.eye,t),Fe(Ii,Ii,r),e.eye=fe(Ii,Ii,t),de(Ii,e.center,t),Fe(Ii,Ii,r),e.center=fe(Ii,Ii,t),e.up=Fe(Ii,e.up,r)}function G7e(e,t,i,r){return Wb(e,Rye(t,i,nW),r)}function fG(e,t,i,r){return Wb(e,L2(t,i,nW),r)}function rW(e,t,i,r){const s=Ge.get();let n=1-i;de(s,t,e.eye);const o=Ie(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(oe(s,s,n),e.eye=fe(Ii,e.eye,s),e.center=Cs(Ii,e.center,t,n))}function Pye(e,t,i){t.getScreenCenter(Qee),iW(e,t,Qee,Ii)&&(t.center=Ii);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=oe(Ge.get(),t.viewForward,s);t.eye=de(Ii,t.center,n)}const Qee=Vr();function Az(e,t){se(t,0,0,0);for(const i of e)fe(t,t,i);oe(t,t,1/e.length)}function z$(e,t,i,r){return Math.sin(e/Ie(t))*(i+r.radius)}function Jee(e,t,i,r){return z$(Math.PI/2,t,i,r)+(e-Math.PI/2)}var Nn;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(Nn||(Nn={}));const Kee={Elevation:3e4,Angle:$t(6)},qC={Pole:.95,Angle:$t(18),Tilt:45},Iye=$t(80);function $ye(e,t,i,r,s){const n=M(),o=Vn();let a=!0,l=!0;return e.intersectScreen(i,n)?o[3]=Ie(n):(l=!1,t.aboveGround?o[3]=Math.max(Ie(t.center),.9*s.radius):o[3]=Ie(t.eye)-t.relativeElevation,r?oO(o,t,i,n):a=iW(o,t,i,n)),{sphere:o,scenePickPoint:a?n:null,hasGeometryIntersection:l}}function h4(e,t,i,r){return Ie(e.eye)-r.radius>Kee.Elevation?Nn.Horizontal:i?(L2(e,t,ate),-Math.sign(e.relativeElevation)*(.5*Math.PI+Xj(e.eye,ate.direction))<Kee.Angle?Nn.Vertical:Nn.Horizontal):Nn.Vertical}function Dye(e,t,i){de(Cz,i,t),e.eye=de(Ii,e.eye,Cz),e.center=de(Ii,e.center,Cz)}const Cz=M();function oO(e,t,i,r){const s=L2(t,i,nW);return!C(s)&&(x2(e,s,WP),ov(e,s,r)?!(fa(WP,s.origin)<fa(r,s.origin))||(ne(r,WP),!1):(de(Sw,t.eye,t.center),Te(Sw,Sw),Kue(Sw,-Se(Te(Sw,Sw),WP),ete),Wb(ete,s,r),!1))}const WP=M(),Sw=M(),ete=fi();function Lye(e,t,i,r,s,n){let o;if(_t(WL,e,t),de(QP,e,t),Ie(e)<=s||!r.aboveGround){_t(i,QP,r.eye);const a=Se(e,t)/(Ie(e)*Ie(t)),l=Math.cos(He(N0.normalize($t(n)),0,Iye));o=-Hs(a)-Math.max(0,Ie(t)-s)/(l*s)}else de(tte,r.eye,r.center),_t(i,QP,tte),o=-Ie(QP)/s;return Te(i,i),oe(i,i,Ie(WL)),o}const tte=M();function ite(e,t,i,r){let s,n;const o=Math.cos(He(N0.normalize($t(r)),0,Iye));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Hs(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Hs(e/i),(n-s)*i}function j7e(e,t,i,r,s,n,o,a,l,c){const h=ite(e[2],t[2],o[3],l),p=c?ite(e[0],t[0],o[3],180):t[0]-e[0],f=Math.sin(a)*p-Math.cos(a)*h,g=Math.cos(a)*p+Math.sin(a)*h;Te(Ii,s);const y=c?f/Math.sqrt(Math.abs(o[3]**2-Se(i,Ii)**2)):f/o[3],v=g/Math.sqrt(Math.abs(o[3]**2-Se(i,r)**2));Li(n,y,v)}function Nye(e,t,i,r,s,n,o,a,l,c){_t(WL,e,t),zV(n.up,n.eye,XP,YP,ZP),zV([0,0,1],n.eye,Hm,O0,kye),ne(i,O0),ne(r,Hm),Te(i,i),oe(i,i,Ie(WL)),_Z(e,Te(YP,YP),Te(ZP,ZP),Te(XP,XP),rte),_Z(t,YP,ZP,XP,ste),j7e(rte,ste,e,Hm,O0,s,o,a,l,c)}function H7e(e,t,i,r,s,n,o){sl(HL,s,r),sl(qL,o,n),xr(dT,HL,qL),de(t,e,i),Fe(t,t,dT),fe(t,t,i)}function Fye(e,t,i,r,s,n){sl(HL,r,i),sl(qL,n,s),xr(dT,HL,qL),de(Ii,e.eye,t),Fe(Ii,Ii,dT),e.eye=fe(Ii,Ii,t),de(Ii,e.center,t),Fe(Ii,Ii,dT),e.center=fe(Ii,Ii,t),de(Ii,e.up,t),Fe(Ii,Ii,dT),e.up=fe(Ii,Ii,t)}function sW(e,t,i,r,s,n,o=qC.Pole,a=qC.Angle){const l=Math.abs(r)>Math.PI-a||Math.abs(r)<a,c=Math.abs(e[2])<i*o||Math.abs(t)>i;return!!(l&&c&&n.aboveGround&&s<qC.Tilt)}function Uye(e,t,i,r,s,n){if(n)GR(i,r,nte),J0(t,e,nte);else{const o=Lye(i,r,ote,t,e[3],s);J0(t,e,VR(ote,o))}}function zye(e,t,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;ne(Iv,r),JP.copyFrom(t);for(let p=0;p<a&&fa(i,Iv)>l&&(c=fa(i,Iv),Nye(i,Iv,O0,Hm,vE,JP,e,s,n,o),Fye(JP,e,Hm,vE[1],O0,vE[0]),H7e(Iv,Iv,e,Hm,vE[1],O0,vE[0]),h=fa(i,Iv),h<c||p===0);p++)t.copyFrom(JP)}function q7e(e,t,i,r,s,n,o){sW(i,Se(t.up,i),e[3],-N0.normalize($t(s)),n,t,qC.Pole,qC.Angle)?zye(e,t,i,r,-N0.normalize($t(s)),n,o):Uye(e,t,i,r,n,o)}function W7e(e,t,i,r,s,n){const{eye:o}=e;zV([0,0,1],o,Hm,O0,kye);const a=t.translation[0]*i.pan,l=s.mode==="zoom"?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Se(e.center,Hm)**2/Ie(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(Ha(r.pan.matrix,r.pan.matrix,h,Hm),r.pan.enabled=!0,s.mode){case"pan":Ha(r.pan.matrix,r.pan.matrix,p,O0),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function X7e(e,t,i,r,s){const{eye:n,viewRight:o}=e,a=_t(Ge.get(),o,n),l=t.translation[0]*i.pan;switch(l!==0&&(Ha(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*i.pan;c!==0&&(Ha(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function Y7e(e,t,i,r,s,n,o,a,l){sW(e.center,Se(e.up,e.center),Ie(e.center),-N0.normalize($t(n)),o,t)?W7e(t,i,r,a,l,-N0.normalize($t(s))):X7e(t,i,r,a,l)}const Hm=M(),O0=M(),kye=M(),XP=M(),YP=M(),ZP=M(),rte=M(),ste=M(),vE=lt(),nte=I2(),HL=Ae(),qL=Ae(),dT=Ae(),Iv=M(),Ii=M(),QP=M(),JP=new Di,WL=M(),ote=M(),nW={origin:M(),direction:M()},ate={origin:M(),direction:M()},lte=.6,Rz=4,Z7e=12,Q7e=60,J7e=20;let XL=class extends zm{constructor(){super(...arguments),this.zoomLocation=M(),this.tmpCamera=new Di,this.tmpViewDir=M(),this.tmpRayDir={origin:M(),direction:M()},this.targetOnSphere=M(),this.tmpCenter=M(),this.constraintOptions={selection:ur.ALL_EXCEPT_COLLISION,interactionType:zt.ZOOM,interactionFactor:null,interactionStartCamera:new Di,interactionDirection:null,tiltMode:gn.TUMBLE},this.sphere=Vn()}initialize(){this.intersector=hh(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation)&&(s=e>0,n=!0),this.tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ne(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:oM}}_updateCamera(e,t,i,r,s){const n=Ci(this.view.spatialReference);if(h4(e,r,s,n)===Nn.Horizontal){let o=lte**t;this.sphere[3]=Ie(i),de(this.tmpViewDir,e.center,e.eye);const a=Ie(this.tmpViewDir);let l=a*o;if(o<=1&&l<Rz&&(l=Rz,o=l/a),Math.abs(a-l)<1e-6)return;const c=Ie(e.center);if(this.sphere[3]!==c){const h=this.sphere[3]+o*(c-this.sphere[3]);e.center=oe(KP,e.center,h/c)}oe(this.tmpViewDir,this.tmpViewDir,-o),e.eye=fe(KP,e.center,this.tmpViewDir),Kr(this.view,e,this.constraintOptions),fa(i,e.center)>1e-12&&iW(this.sphere,e,r,this.targetOnSphere)&&q7e(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let o=lte**Math.abs(t);const a=t>0?1:-1;de(this.tmpViewDir,i,e.eye);const l=Ie(this.tmpViewDir);let c;L2(e,r,this.tmpRayDir),Te(this.tmpRayDir.direction,this.tmpRayDir.direction),this.view.camera.position.hasZ&&(c=Math.abs(this.view.camera.position.z));let h=Math.max(Z7e*c,J7e);const p=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,Q7e);h=p?Math.min(h,p):h,h=s?Math.min(h,l):h,oe(this.tmpRayDir.direction,this.tmpRayDir.direction,h),fe(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let f=h*o;const g=Math.max(Rz,1.01*e.nearFar[0]);if(t>0&&f<g&&(f=g,o=f/h),Math.abs(h-f)<1e-6)return;oe(this.tmpRayDir.direction,this.tmpRayDir.direction,a*(1-o)),e.eye=fe(KP,e.eye,this.tmpRayDir.direction),e.center=fe(KP,e.center,this.tmpRayDir.direction)}D2(this.view,e)}};XL=u([P("esri.views.3d.state.controllers.global.ZoomStepController")],XL);const KP=M(),K7e=.6,eje=4,tje=60,ije=14,rje=20;let YL=class extends zm{constructor(){super(...arguments),this.zoomLocation=M(),this.tmpCamera=new Di,this.tmpRayDir=M(),this.tmpCenter=M(),this.constraintOptions={selection:ur.ALL,interactionType:zt.ZOOM,interactionFactor:null,interactionStartCamera:new Di,interactionDirection:null,tiltMode:gn.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const s=hh(this.view.state.viewingMode);e>0?(this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ne(this.zoomLocation,this.tmpCamera.center);const n=K7e**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),t[0],t[1],this.view.state.camera,tje);const a=Math.max(ije*Math.abs(this.view.camera.position.z),rje);if(o=o?Math.min(o,a):a,o){const l=M();de(l,this.zoomLocation,this.tmpCamera.eye),o<Ie(l)&&(Te(l,l),fe(this.zoomLocation,this.tmpCamera.eye,oe(l,l,o)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:oM}}_updateCamera(e,t,i){de(this.tmpRayDir,i,e.eye);const r=Ie(this.tmpRayDir);let s=r*t;const n=t<=1,o=Math.max(eje,1.01*e.nearFar[0]);n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||(oe(this.tmpRayDir,this.tmpRayDir,t),e.eye=de(cte,i,this.tmpRayDir),e.center=Cs(cte,e.center,i,1-t),Kr(this.view,e,this.constraintOptions))}};YL=u([P("esri.views.3d.state.controllers.local.ZoomStepController")],YL);const cte=M();function sje(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function oW(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class nje extends fo{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){const i=t.data;if(sje(i,"primary")){const r=this.view.state.isGlobal?new XL({view:this.view,mode:"animation"}):new YL({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Vr(i.x,i.y)),t.stopPropagation()}}}let K0=class extends E1{constructor(){super(...arguments),this.startCamera=new Di,this.currentCamera=new Di}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Cr.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};K0=u([P("esri.views.3d.state.controllers.InteractiveController")],K0);var Ol;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(Ol||(Ol={}));const oje=7,Oz=90;let pT=class extends K0{constructor(e){super(e),this.view=null,this.pivot=Ol.CENTER,this.lastPoint=lt(),this.tmpWorldUp=M(),this.tmpViewDir=M(),this.tmpRotCurPoint=lt(),this.tmpTransf=Ae(),this.tmpAxis=M(),this.tmpPivotPoint=M(),this.pivotPos=M(),this.constraintOptions={selection:ur.ALL,interactionType:zt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:gn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===Ol.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Ol.EYE:ne(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=zt.LOOK_AROUND,this.constraintOptions.tiltMode=gn.LOOK_AROUND,this.constraintOptions.selection=ur.NONE;break;case Ol.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||ne(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=zt.TUMBLE,this.constraintOptions.tiltMode=gn.TUMBLE,this.constraintOptions.selection=ur.ALL&~ur.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,j1(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=M();de(r,this.pivotPos,i.eye);const s=Ie(r);let n=Math.min(s,oje*Math.abs(this.view.camera.position.z));const o=Ci(this.view.spatialReference),a=Vr(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=h4(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*Oz,Oz),h=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),e[0],e[1],i,Oz);c===void 0&&h===void 0||(c=c===void 0?h:c,h=h===void 0||l===Nn.Horizontal?c:h,n=c>h?h:c,n=t?Math.min(n,s):n),Te(r,r),ne(this.pivotPos,fe(this.tmpPivotPoint,i.eye,oe(this.tmpPivotPoint,r,n)))}update(e){if(this.active){switch(this.pivot){case Ol.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case Ol.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}Kr(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),j1(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;de(this.tmpViewDir,i,r);const o=Ie(this.tmpViewDir),a=Hs(Se(this.tmpViewDir,this.tmpWorldUp)/o);if(this.pivot===Ol.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=He(s+a,io.min,io.max)-a,_t(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===Ol.CENTER&&(n=-n),sl(this.tmpTransf,n,this.tmpWorldUp),Ha(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),Fe(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=Fe(Mz,e.up,this.tmpTransf),fe(Mz,r,this.tmpViewDir),Bn(this.lastPoint,this.tmpRotCurPoint),Mz}};u([d({constructOnly:!0})],pT.prototype,"view",void 0),u([d()],pT.prototype,"pivot",void 0),pT=u([P("esri.views.3d.state.controllers.RotateController")],pT);const Mz=M();class Pz extends fo{constructor(t,i,r,s){super(!0),this.view=t,this.pointerAction=i,this.pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!oW(t.data,this.pointerAction))return;const r=Vr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new pT({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let k$=class extends K0{constructor(e){super(e),this.view=null,this.pickPoint=M(),this.tmpP0=lt(),this.panAxisAngle=I2(),this.tmpRayDir=M(),this.tmpRayDirPick=M(),this.targetOnSphere=M(),this.tmpRay={origin:M(),direction:M()},this.dragBeginPoint=Vr(),this.normalizedAnchorPoint=lt(),this.constraintOptions={selection:ur.ALL_EXCEPT_COLLISION,interactionType:zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:gn.TUMBLE},this.sphere=Vn(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Bn(this.dragBeginPoint,e),j1(this.startCamera,e,this.normalizedAnchorPoint);const t=Ci(this.view.spatialReference),i=$ye(this.intersectionHelper,this.startCamera,e,!1,t);if(this.navMode=h4(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===Nn.Horizontal)this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let r;L2(this.startCamera,e,this.tmpRay),Te(this.tmpRay.direction,this.tmpRay.direction),de(this.tmpRayDirPick,this.startCamera.eye,i.scenePickPoint);const s=Ie(this.tmpRayDirPick);this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let n=He(Oye*r,jL[0],jL[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,Mye);n=o?Math.min(n,o):n,n=i.scenePickPoint?Math.min(n,s):n,this.hasPickPoint=!0,oe(this.tmpRay.direction,this.tmpRay.direction,n),fe(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===Nn.Horizontal){de(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Ie(this.tmpRayDir);j1(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const n=1-(1-r/t)*(1-this.sphere[3]/Ie(this.currentCamera.center));this.currentCamera.center=oe(e3,this.currentCamera.center,n)}oe(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=fe(e3,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=sd(this.dragBeginPoint,e),Kr(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(oO(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),GR(this.pickPoint,this.targetOnSphere,this.panAxisAngle),J0(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Ie(this.tmpRay.direction);j1(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;oe(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=fe(e3,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=fe(e3,this.currentCamera.center,this.tmpRayDir)}D2(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],k$.prototype,"view",void 0),k$=u([P("esri.views.3d.state.controllers.global.ZoomController")],k$);const e3=M();let B$=class extends K0{constructor(e){super(e),this.view=null,this.tmpP=M(),this.tmpDir=M(),this.tmpN=M(),this.tmpP0=lt(),this.tmpPoi=M(),this.tmpRayDir=M(),this.dragBeginPoint=Vr(),this.normalizedAnchorPoint=lt(),this.constraintOptions={selection:ur.ALL,interactionType:zt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:M(),tiltMode:gn.TUMBLE},this.plane=fi()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Bn(this.dragBeginPoint,e),j1(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP);de(this.tmpDir,this.tmpP,this.startCamera.eye);const i=Ie(this.tmpDir);let r;Te(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=He(Oye*r,jL[0],jL[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),e[0],e[1],this.view.state.camera,Mye);s=n?Math.min(s,n):s,s=t?Math.min(s,i):s,oe(this.tmpDir,this.tmpDir,s),fe(this.tmpP,this.startCamera.eye,this.tmpDir),de(this.tmpN,this.startCamera.eye,this.startCamera.center),Te(this.tmpN,this.tmpN),this.tmpN[1]<0&&Do(this.tmpN,this.tmpN),SS(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;G7e(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||ne(this.tmpPoi,this.currentCamera.center),j1(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);Bn(this.normalizedAnchorPoint,this.tmpP0),de(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=Ie(this.tmpRayDir);let r=i*(1-t);ne(this.constraintOptions.interactionDirection,this.tmpRayDir),oe(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(oe(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=fe($v,this.currentCamera.eye,this.tmpRayDir),Cs($v,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?$v[2]=Math.max(this.startCamera.center[2],$v[2]):$v[2]=Math.min(this.startCamera.center[2],$v[2]),this.currentCamera.center=$v,this.constraintOptions.interactionFactor=sd(this.dragBeginPoint,e),Kr(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],B$.prototype,"view",void 0),B$=u([P("esri.views.3d.state.controllers.local.ZoomController")],B$);const $v=M();class aje extends fo{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!oW(t.data,this.pointerAction))return;const r=Vr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new k$({view:this.view}):this.cameraController=new B$({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const lje=M(),t3=M();function aW(){return{direction:M(),up:M()}}function Bye(e,t,i,r,s){let n=Te(lje,e),o=Se(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Se(t,r)),o<.99?(ne(n,t),a&&oe(n,n,-1)):n=null);let l=0;if(n){oe(t3,r,Se(r,n)),de(n,n,t3);const h=Se(n,s)/(Ie(n)*Ie(s));_t(t3,n,s),l=(Se(t3,r)>0?1:-1)*el(Hs(h))}const c=el(Hs(-Se(r,e)/Ie(e)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const Vye=Le(0,1,0),Gye=Le(0,0,1),_E=Ae(),If=M(),$f=M();function jye(e,t,i,r=aW()){const{direction:s,up:n}=r;return Kce(_E,-$t(t)),_S(_E,_E,$t(i)),Fe(s,Gye,_E),oe(s,s,-1),Fe(n,Vye,_E),r}function cje(e,t,i,r){return Bye(t,i,r,Gye,Vye)}function uje(e,t,i,r){const s=jye(e,i,r),n=M();return oe(n,s.direction,-t),fe(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}}function hje(e){return el(e)}function dje(e){return $t(e)}function Hye(e,t,i,r,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return Mr(t,If,n),Mr(t,$f,n),If[0]-=i/2,$f[0]+=i/2,If[1]-=r/2,$f[1]+=r/2,kn(If,n,If,o),kn($f,n,$f,o),s?(s.xmin=If[0],s.ymin=If[1],s.xmax=$f[0],s.ymax=$f[1],s.spatialReference=o):s=new ni(If[0],If[1],$f[0],$f[1],o),s}const pje=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:jye,directionToHeadingTilt:cje,eyeForCenterWithHeadingTilt:uje,lookAtTiltToEyeTilt:hje,eyeTiltToLookAtTilt:dje,toExtent:Hye},Symbol.toStringTag,{value:"Module"})),qye=Le(0,0,1),Wye=Te(M(),Le(1,1,1)),fje=new L0(-180,180),bE=Ae(),Hy=M(),Ew=M();function Xye(e,t,i,r=aW()){_t(Hy,e,qye),Se(Hy,Hy)===0&&_t(Hy,e,Wye),sl(bE,-$t(t),e),Ha(bE,bE,-$t(i),Hy);const{up:s,direction:n}=r;return _t(s,Hy,e),Te(s,s),Fe(s,s,bE),Te(n,e),Do(n,n),Fe(n,n,bE),r}function mje(e,t,i,r){const s=Hy,n=Ew;return Te(s,e),_t(Ew,s,qye),Se(Ew,Ew)===0&&_t(Ew,s,Wye),_t(n,Ew,s),Bye(t,i,r,s,n)}function gje(e,t,i,r){const s={eye:M(),up:null,tilt:r,heading:i},n=Hy;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=$t(i),l=$t(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),g=Ie(n);let y;if(Math.abs(l)<1e-8)y=o+g;else{const le=g/p,$=Td(o/le),z=Math.PI-l-$;y=le*Math.sin(z)}const v=f*o,b=o*o*(p*p),w=h*h*b,S=y-v,x=S*S,E=w*(w+x-n[1]*n[1]);if(E<0)return oe(s.eye,n,y/g),s.tilt=0,s;const R=Math.sqrt(E),O=n[1]*S,I=w+x;let U;if(U=h>0?-R+O:R+O,Math.abs(I)<1e-8)return g<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):oe(s.eye,n,y/g),s.tilt=0,Iz(s.eye),$z(s,e);s.eye[1]=U/I;const N=c*c*b,V=p*o,j=h*V*s.eye[1],H=s.eye[1]*s.eye[1],J=1-H,K=Math.sqrt(J),he=w*H+N-2*j*K*S+J*x;return Math.abs(he)<1e-8?(oe(s.eye,n,y/g),s.tilt=0,Iz(s.eye),$z(s,e)):(s.eye[0]=(J*(y*n[0]-v*n[0])-V*K*(n[0]*s.eye[1]*h+n[2]*c))/he,s.eye[2]=(J*(y*n[2]-v*n[2])-V*K*(n[2]*s.eye[1]*h-n[0]*c))/he,oe(s.eye,s.eye,y),Iz(s.eye),$z(s,e))}function Iz(e){const t=e[1];e[1]=-e[2],e[2]=t}function $z(e,t){const i=Xye(t,e.heading,e.tilt);return e.up=i.up,e}function yje(e,t,i){const r=Ie(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=Td(i/(s/Math.sin(e)));return el(e-n)}function vje(e,t,i){const r=$t(e),s=Ie(t);return Td(i/(s/Math.sin(r)))+r}function Yye(e,t,i,r,s){let n,o,a,l;const c=t.latitude,h=Ci(e.spatialReference).radius,p=t.longitude,f=S9e(c,i,h)/2;n=p-f,o=p+f;const g=$t(c),y=(1+Math.sin(g))/(1-Math.sin(g)),v=(y+1)*Math.tan(r/h/2),b=v*v;function w(x){const E=Math.PI/2;return(x=cSe.normalize(x,-E))>E&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*y+b))),l=a+r/h,a=w(a),l=w(l),l<a){const x=l;l=a,a=x}if(a=Math.max(el(a),-90),l=Math.min(el(l),90),o=fje.monotonic(n,o),o-n>180){const x=(o-n-180)/2;n+=x,o-=x}const S=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:Ke.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=S):s=new ni(n,a,o,l,S),e.spatialReference&&e.spatialReference.isWebMercator&&Bm(s,!1,s),s}const _je=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:Xye,directionToHeadingTilt:mje,eyeForCenterWithHeadingTilt:gje,lookAtTiltToEyeTilt:yje,eyeTiltToLookAtTilt:vje,toExtent:Yye},Symbol.toStringTag,{value:"Module"}));function ZL(e){return e.type==="point"}class Zye{constructor(t,i=null,r=0){this.array=t,this.spatialReference=i,this.offset=r}}function Qye(e){return"array"in e}function Vp(e,t,i="ground"){if(ZL(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(Qye(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,Tt(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}function QL(e,t){return e!=null&&(t==null||(t===je.Local?!e.isGeographic||e.isWGS84||e.wkid===qu.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===qu.CGCS2000||e.wkid===qu.GCSMARS2000||e.wkid===qu.GCSMARS2000_SPHERE||e.wkid===qu.GCSMOON2000))}const Jye=pe.getLogger("esri.views.3d.support.cameraUtils"),Kye=39.37,e0e=96,mG=1,bje=8,wje=5,t0e=1,ute=M(),i3=M(),xje={heading:0,tilt:0},Om=new We,Tje=new L0(-20037508342788905e-9,20037508342788905e-9),Sje=new L0(-180,180);var lo;function aM(e){return e.spatialReference||Ke.WGS84}function N2(e){return e.viewingMode==="global"?_je:pje}function Eje(e,t,i,r,s){return N2(e).headingTiltToDirectionUp(t,i,r,s)}function Sm(e,t){if(C(t))return null;const i=e.renderSpatialReference,r=N2(e).headingTiltToDirectionUp,s=M();if(!Mr(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);oe(n.direction,n.direction,e.state.camera.distance),fe(n.direction,n.direction,s);const o=tw(e,s,n.direction,n.up);return o.fov=$t(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(lo||(lo={}));const Aw=M();function YS(e,t,i){const r=e.renderSpatialReference,s=d4(e,t.eye,t.viewForward,t.up,xje);let n=aM(e);return kn(t.eye,r,Aw,n)||(n=Ke.WGS84,kn(t.eye,r,Aw,n)),C(i)?new il(new We(Aw,n),s.heading,s.tilt,el(t.fov)):(i.position.x=Aw[0],i.position.y=Aw[1],i.position.z=Aw[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=el(t.fov),i)}function lW(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===je.Global&&i!=null&&(t*=Math.cos($t(i))),t/=e.renderCoordsHelper.unitInMeters,s/(e0e*Kye/t)/Math.tan(r.fovX/2)}function Rb(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=e0e*Kye/(n/s);return e.renderCoordsHelper.viewingMode===je.Global&&(o/=Math.cos($t(i))),o*=e.renderCoordsHelper.unitInMeters,o}function i0e(e,t,i,r,s,n){return r0e(e,t,lW(e,i,t.latitude),r,s,n)}function r0e(e,t,i,r,s,n){if(H1(n)){const a=new F2(n.signal);return aO(e,r.heading,r.tilt,t,i,s,a),void a.resolver.promise.then(l=>{const c=KL(e,l,r.fov);if(!C(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=aO(e,r.heading,r.tilt,t,i,s);return KL(e,o,r.fov,n)}function d4(e,t,i,r,s){return N2(e).directionToHeadingTilt(t,i,r,s)}function Aje(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,Om,e.spatialReference)&&Tt(Vp(e.elevationProvider,Om),0)>Om.z-t0e)}async function Cje(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,Om,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(Om.x,Om.y,Om.z,Om.spatialReference,"ground",i);return Tt(r,0)>Om.z-t0e}async function Rje(e,t,i){const r=M();if(t)if(t instanceof We){if(Mr(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return _(s)&&e.renderCoordsHelper.setAltitude(r,s),r}}else ne(r,t);else ne(r,e.state.camera.center);return r}function Oje(e,t){const i=M();if(t&&t instanceof We){if(Mr(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const r=Vp(e.elevationProvider,t);_(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else ne(i,t||e.state.camera.center);return i}function aO(e,t,i,r,s,n,o){const a=r&&r instanceof We?r:null;if(H1(o))return Rje(e,r,o.signal).then(c=>{gG(e,t,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=Oje(e,r);return gG(e,t,i,a,l,s,n,o)}function gG(e,t,i,r,s,n,o,a){if(C(r)){const p=e.renderSpatialReference;if(r=z0(s,p,aM(e)),C(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=Ije(e,t,i,s,n,o),c=(0,N2(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===lo.ADJUST&&e.viewingMode==="global"&&i>0){const p=()=>{const g=s0e(e,s,n,Dje(e,n,i,s));return o=i-g<1?lo.LOCKED:lo.ADJUST,gG(e,t,g,r,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(Aje(e,c.eye))return p();if(H1(a))return Cje(e,c.eye,a.signal).then(g=>g?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:ts(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||H1(a)?{center:M(),eye:M(),up:M(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=ts(s),h.heading=c.heading,h.tilt=c.tilt,H1(a)&&a.resolver.resolve(h),h}function WC(e,t,i,r,s,n=null){const o=t.zmax!=null&&t.zmin!=null;let a,l,c;if(e.state.isGlobal){if(!QL(t.spatialReference,je.Global))return H1(n)&&n.resolver.reject(),null;const w=new We(t.xmin,t.ymin,t.spatialReference),S=new We(t.xmax,t.ymax,t.spatialReference),x=t.spatialReference.isGeographic?Sje:Tje;a=new We({x:x.center(w.x,S.x),y:(S.y+w.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const E=Ci(t.spatialReference),R=T9e(a,w,S);l=R.lon,c=R.lat,x.diff(w.x,S.x)>x.range/2&&(l+=E.halfCircumference),l=Math.min(l,E.halfCircumference),c=Math.min(c,E.halfCircumference)}else{const w=Tt(e.renderSpatialReference,t.spatialReference);w.equals(t.spatialReference)||(t=BO(t,w)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const S=o?(t.zmax+t.zmin)/2:null;a=new We({x:t.xmin+.5*l,y:t.ymin+.5*c,z:S,spatialReference:w})}const h=o?t.zmax-t.zmin:0,p=e.state.camera,f=1/Math.tan(p.fovX/2),g=1/Math.tan(p.fovY/2),y=1/Math.tan(p.fov/2),v=Math.max(.5*l*f,.5*c*g,.5*h*y)/mG;if(H1(n)){const w=new F2(n.signal);return aO(e,i,r,a,v,s,w),void w.resolver.promise.then(S=>{const x=KL(e,S,e.camera.fov);if(!C(x))return n.resolver.resolve(x);n.resolver.reject()},S=>n.resolver.reject(S))}const b=aO(e,i,r,a,v,s);return KL(e,b,e.camera.fov,n)}function Mje(e,t,i){const r=e.renderSpatialReference,s=z0(i,r,aM(e));if(C(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=I7(t.eye,i),l=2*a*n*mG,c=2*a*o*mG;return e.viewingMode==="global"?Yye(e,s,l,c):Hye(e,s,l,c)}function Pje(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>bje)return!0;const s=e.renderSpatialReference,n=aM(e),o=z0(t,s,n),a=z0(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(C(o)||C(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return a.distance(o)/l>wje}function Ije(e,t,i,r,s,n){let o=0;return n===lo.ADJUST&&Pje(e,r,s)?(t=0,o=$je(e,s,i,r)):o=cW(e,r,s,i),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:i=s0e(e,r,s,o)}}const JL=.7;function $je(e,t,i,r){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-JL)+s.max*JL,o=cW(e,r,t,i);return Math.min(o,n)}function Dje(e,t,i,r){const s=e.state.constraints.tilt(t);let n=cW(e,r,t,i);return n=Math.min(n,.5*Math.PI),s.min*(1-JL)+n*JL}function s0e(e,t,i,r){return N2(e).lookAtTiltToEyeTilt(r,t,i)}function cW(e,t,i,r){return N2(e).eyeTiltToLookAtTilt(r,t,i)}function KL(e,t,i,r){if(C(t))return null;const s=e.renderSpatialReference,n=z0(t.eye,s,aM(e));return C(n)?null:_(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new il(n,t.heading,t.tilt,i)}function n0e(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(t);Jye.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function o0e(e,t){var i;const r=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(t);Jye.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function Lje(e,t){return e.spatialReference?vhe(t,e.spatialReference):void 0}function a0e(e,t,i){const r=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=Ke.WGS84;return t instanceof il?(s=t.position.latitude,Mr(t.position,ute,r),Mr(i,i3,r),n=Yi(ute,i3)):(kn(t.center,r,i3,o),s=i3[1],n=t.distance),Rb(e,n,s)}class F2{constructor(t){this.signal=t,this.resolver=Qm()}}function H1(e){return e&&"resolver"in e}function Th(e){let t=e*e;return e<0&&(t*=-1),t}function hte(e,t,i){const r=i,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=Th(s.axes[0]),r.translation[1]=Th(s.axes[1]),r.translation[2]=Th(s.buttons[7])-Th(s.buttons[6]),r.heading=Th(s.axes[2]),r.tilt=Th(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Th(s.axes[0]),r.translation[1]=1.2*Th(s.axes[1]),r.translation[2]=2*-Th(s.axes[2]),r.heading=1.2*Th(s.axes[5]),r.tilt=1.2*Th(s.axes[3])),r.tilt*=o,oe(r.translation,r.translation,a),r}function dte(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function Dz(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let e0=class extends K0{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new Di,this.constraintOptions={selection:ur.ALL,interactionType:zt.NONE,interactionStartCamera:new Di,interactionFactor:0,interactionDirection:null,tiltMode:gn.LOOK_AROUND}}handleEventGamepad(e){const t=hte(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||Dz(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,dte(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=dte(this.keysButtonState,this.transformation);Dz(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Dv),this._applyDisabledMovementTypes(Dv),this._applyPan(Dv.pan),this._applyRotate(Dv.rotate),this._applyZoom(Dv.zoom),this._applyAscend(Dv.ascend),this.constraintOptions.interactionType=zt.NONE,this.constraintOptions.selection=ur.COLLISION,Kr(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;de(Ta,t.center,t.eye),Fe(Ta,Ta,e.matrix),t.center=fe(Ta,Ta,t.eye),t.up=Fe(Ta,t.up,e.matrix),this.constraintOptions.interactionType=zt.LOOK_AROUND,this.constraintOptions.selection=ur.ALL_EXCEPT_COLLISION,Kr(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=Fe(Ta,t.eye,e.matrix),t.center=Fe(Ta,t.center,e.matrix),this.view.state.isGlobal&&(t.up=Fe(Ta,t.up,e.matrix)),this.constraintOptions.interactionType=zt.PAN,this.constraintOptions.selection=ur.ALL,Kr(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=fe(Ta,this.currentCamera.eye,oe(Ge.get(),t,e)),ne(wE,t),Do(wE,wE),this.constraintOptions.interactionDirection=wE,this.constraintOptions.interactionType=zt.ZOOM,this.constraintOptions.selection=ur.ALL_EXCEPT_COLLISION,Kr(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Ge.get());if(this.constraintOptions.interactionDirection=ne(wE,t),this.view.state.isGlobal){const i=Ie(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=oe(Ta,this.currentCamera.eye,r),this.currentCamera.center=oe(Ta,this.currentCamera.center,r)}else{const i=oe(Ge.get(),t,e);this.currentCamera.eye=fe(Ta,this.currentCamera.eye,i),this.currentCamera.center=fe(Ta,this.currentCamera.center,i)}this._updateCameraCenter(),this.constraintOptions.interactionType=zt.ASCEND,this.constraintOptions.selection=ur.COLLISION,Kr(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=ur.ALL_EXCEPT_COLLISION,Kr(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){Vje(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,Ta)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=se(Ge.get(),s[0],s[1],0);Te(a,a);const l=n.translation[0]*e.pan;if(l!==0){const y=oe(Ge.get(),r,l);ga(i.pan.matrix,i.pan.matrix,y),i.pan.enabled=!0}switch(o.mode){case"pan":{const y=-n.translation[1]*e.pan;if(y!==0){const v=oe(Ge.get(),a,y);ga(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Ha(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,Ge.get())),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=Z0(this.view.renderCoordsHelper,t.center,t.eye),g=He(f+p,io.min,io.max)-f;g&&(Ha(i.rotate.matrix,i.rotate.matrix,g,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=_t(Ge.get(),s,r);Te(a,a),Do(a,a),Y7e(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,o),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(Dv.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Ha(i.rotate.matrix,i.rotate.matrix,h,this.tmpCamera.eye),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(Ha(i.rotate.matrix,i.rotate.matrix,f,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=Ci(this.view.spatialReference),s=z$(io.min,t.origin,i,r);let n=0,o=0;const a=Ge.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){const l=Z0(this.view.renderCoordsHelper,a,t.origin);n=z$(l,t.origin,i,r),o=z$(io.max,t.origin,i,r)}else{x2(i+r.radius,t,a);const l=Hs(-Se(t.direction,Te(a,a)));n=Jee(l,t.origin,i,r),o=Jee(io.max,t.origin,i,r)}return He(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=Eje(this.view,t,0,l0e,Bje),n=i.intersectManifoldClosestSilhouette(Xc(t,s),e,Ge.get()),o=Yi(t,n),a=i.intersectManifoldClosestSilhouette(Xc(t,dg(Ge.get(),t,r.center)),e,Ge.get()),l=Yi(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,Ge.get());if(s){const o=de(Ge.get(),e,n),a=Ie(o);oe(o,o,1/a);const l=Te(Ge.get(),e),c=Hs(Se(l,o));return a*Math.sin(Math.min(Fje,c))}{const o=ne(Ge.get(),e);return t.setAltitude(o,this.filteredSurfaceElevation),Yi(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:Uje}_computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+Ci(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=Ge.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,c=pte*r.width,h=pte*r.width,p=a*Math.tan(.5*r.fovX)/l,f=p/i,g=p/this._computeHeadingRotateRadius(n),y=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*y-y),zoom:2**(c*e/l)*a-a,rotate:He(g*h,zje,kje)*e}}_applyDisabledMovementTypes(e){!_(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&sf(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&sf(e.rotate.matrix))}static activatesFor(e,t){const i=hte(t,e.navigation.gamepad,Nje);return!(t.action==="end"||Dz(i))}};u([d({constructOnly:!0})],e0.prototype,"view",void 0),u([d({constructOnly:!0})],e0.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],e0.prototype,"disableMovements",void 0),e0=u([P("esri.views.3d.state.controllers.GamepadKeyboardController")],e0);const Nje={translation:[0,0,0],heading:0,tilt:0,zoom:0},l0e=80,Fje=$t(l0e),pte=.75,Uje=5,zje=$t(30),kje=$t(80),Dv={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ae()},rotate:{enabled:!1,matrix:Ae()}},Ta=M(),wE=M(),Bje=aW();function Vje(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,sf(e.pan.matrix),e.rotate.enabled=!1,sf(e.rotate.matrix)}class Gje extends fo{constructor(t){super(!0),this.view=t,this.watchHandles=new Jt,this.handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([xe(()=>this.view.navigation.gamepad.enabled,i=>{i?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},Bi),xe(()=>this.view.navigation.gamepad.device,i=>{this.cameraControllerGamepad&&i&&this.cameraControllerGamepad.gamepadDevice!==i&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const i=this.view.navigation.gamepad.device;if(i&&t.data.device!==i)return;const r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||e0.activatesFor(this.view,t.data)){if(!r){const s=new e0({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(s)&&(this.cameraControllerGamepad=s)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var Tl;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(Tl||(Tl={}));class jje extends fo{constructor(t,i){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:je.Local},this.keyToNumber={[i.left]:Tl.LEFT,[i.right]:Tl.RIGHT,[i.forward]:Tl.FORWARD,[i.backward]:Tl.BACKWARD,[i.up]:Tl.UP,[i.down]:Tl.DOWN,[i.headingLeft]:Tl.HEADINGLEFT,[i.headingRight]:Tl.HEADINGRIGHT,[i.tiltUp]:Tl.TILTUP,[i.tiltDown]:Tl.TILTDOWN,[i.zoomIn]:Tl.ZOOMIN,[i.zoomOut]:Tl.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new e0({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(i),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(i),t.stopPropagation())}}class Hje extends fo{constructor(t,i){super(!0),this.view=t,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const i=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new XL({view:this.view,mode:"interaction"}):new YL({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*i.deltaY,Vr(i.x,i.y)),t.preventDefault(),t.stopPropagation()}}class eN{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let M0=class extends nO{constructor(e){super(e),this.view=null,this.beginCamera=new Di,this.elapsedTimeSec=0,this.constraintOptions={selection:ur.ALL,interactionType:zt.PAN,interactionFactor:0,interactionStartCamera:new Di,interactionDirection:null,tiltMode:gn.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new DS}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),Kr(this.view,t,this.constraintOptions)}};u([d({constructOnly:!0})],M0.prototype,"view",void 0),M0=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],M0);let XC=class extends M0{constructor(e){super(e),this.interactionType=zt.PAN,this.tmpPan=M()}momentumStep(e,t){const i=this.momentum.value(e);oe(this.tmpPan,this.momentum.direction,i),t.eye=de(fte,t.eye,this.tmpPan),t.center=de(fte,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};u([d({constructOnly:!0})],XC.prototype,"momentum",void 0),XC=u([P("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],XC);const fte=M(),qje=M(),r3=M();let V$=class extends M0{constructor(e){super(e),this.interactionType=zt.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);ne(r3,t.eye),Te(r3,r3),_t(this.momentum.axis2,r3,this.momentum.axis1),Fye(t,qje,this.momentum.axis1,i,this.momentum.axis2,r)}};u([d({constructOnly:!0})],V$.prototype,"momentum",void 0),V$=u([P("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],V$);let u1=class extends M0{constructor(e){super(e),this.interactionType=zt.TUMBLE}set center(e){this._set("center",ts(e))}set axis(e){this._set("axis",ts(e))}momentumStep(e,t){const i=this.momentum.value(e);J0(t,this.center,VR(this.axis,i))}};u([d({constructOnly:!0})],u1.prototype,"momentum",void 0),u([d({constructOnly:!0})],u1.prototype,"center",null),u([d({constructOnly:!0})],u1.prototype,"axis",null),u1=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],u1);let fT=class extends M0{constructor(e){super(e),this.interactionType=zt.ZOOM,this.constraintOptions.interactionDirection=M()}set zoomCenter(e){this._set("zoomCenter",ts(e))}momentumStep(e,t){ne(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);rW(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=dg(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};u([d({constructOnly:!0})],fT.prototype,"momentum",void 0),u([d({constructOnly:!0})],fT.prototype,"zoomCenter",null),fT=u([P("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],fT);let k_=class extends M0{constructor(e){super(e),this.interactionType=zt.ZOOM,this.radius=0,this.tmpSceneCenter=M(),this.tmpZoomAxisAngle=I2(),this.sphere=Vn()}set screenCenter(e){this._set("screenCenter",Vr(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",ts(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);Pye(this.sphere,t,i),this.constraintOptions.interactionType=zt.ZOOM,Kr(this.view,t,this.constraintOptions),oO(this.sphere,t,this.screenCenter,this.tmpSceneCenter),GR(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),J0(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=zt.PAN}};u([d({constructOnly:!0})],k_.prototype,"momentum",void 0),u([d({constructOnly:!0})],k_.prototype,"screenCenter",null),u([d({constructOnly:!0})],k_.prototype,"sceneCenter",null),u([d({constructOnly:!0})],k_.prototype,"radius",void 0),k_=u([P("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],k_);class nd{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class p4{constructor(t,i,r){this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const r=this.value(t);return this.value(t+i)-r}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const r=1-this.friction;return t*(r**i-1)/Math.log(r)}}class Wje extends p4{constructor(t,i,r,s,n){super(t,i,r),this.sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class c0e{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.time=new nd(.6),this.screen=[new nd(.4),new nd(.4)],this.scene=[new nd(.6),new nd(.6),new nd(.6)],this.tmpDirection=M()}add(t,i,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(i[0]),this.scene[1].update(i[1]),this.scene[2].update(i[2]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){se(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=Ie(this.tmpDirection);s>0&&oe(this.tmpDirection,this.tmpDirection,1/s);const n=s/this.time.filteredDelta;return new Wje(t,i,r,n,this.tmpDirection)}}class mte{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const gte=1e-5;class Xje extends p4{constructor(t,i,r,s,n,o=0,a){super(t,i,r),this.angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class Yje{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.tmpAxis1=M(),this.tmpAxis2=M(),this.tmpAngles=lt(),this.time=new nd(.3),this.screen=[new nd(.4),new nd(.4)],this.angle1=new mte(.6),this.angle2=new mte(.6),this.axis1=M(),this.axis2=M(),this.lastScene=M()}addMomentumDirectRotation(t,i,r,s,n,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;let a=Lye(this.lastScene,i,this.tmpAxis2,s,n,o);this.angle2.update(0),ua(this.tmpAxis2)<gte?a=0:Te(this.axis1,this.tmpAxis2),this.angle1.update(a),ne(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,o,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;Nye(this.lastScene,i,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,s,n,o,a,!1),ua(this.tmpAxis2)<gte?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),Te(this.axis1,this.tmpAxis1),Te(this.axis2,this.tmpAxis2)),ne(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){const s=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new Xje(t,i,r,s,this.axis1,n,this.axis2)}}class u0e{constructor(t=2.5,i=.01,r=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.maxVelocity=s,this.enabled=!0,this.value=new nd(.8),this.time=new nd(.3)}add(t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=He(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,i,r){return new p4(t,i,r)}}class h0e extends u0e{constructor(t=3,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){if(this.value.hasLastValue){const r=this.value.lastValue;let s=t-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=r+s}super.add(t,i)}}class Zje extends p4{constructor(t,i,r){super(t,i,r)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const r=super.value(t),s=super.value(t+i)-r;return Math.exp(s)}}class d0e extends u0e{constructor(t=2.5,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,r){return new Zje(t,i,r)}}let G$=class extends K0{constructor(e){super(e),this.view=null,this.smoothRotation=new eN(.05),this.rotationAxis=M(),this.panningPlane=fi(),this.smoothScaling=new eN(.05),this.zoomCenterScreen=Vr(),this.zoomMomentumEstimator=new d0e,this.rotationMomentumEstimator=new h0e,this.panSphericalMomentumEstimator=new Yje,this.panPlanarMomentumEstimator=new c0e,this.adjustedSphere=Vn(),this.tmp3d=M(),this.tmpScreenPointArray=Vr(),this.beginScreenPoint=Vr(),this.beginScenePoint=M(),this.screenPickPoint=Vr(),this.navMode=Nn.Horizontal,this.tmpInteractionDirection=M(),this.constraintOptions={selection:ur.ALL,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:new Di,interactionDirection:null,tiltMode:gn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-N0.normalize($t(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),Mm(e.center,this.screenPickPoint),Bn(this.beginScreenPoint,this.screenPickPoint);const i=Ci(this.view.spatialReference),r=$ye(this.intersectionHelper,this.startCamera,this.screenPickPoint,!0,i);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,ne(this.beginScenePoint,this.scenePickPoint),this.navMode=h4(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===Nn.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=Do(this.tmp3d,this.startCamera.viewForward);SS(this.scenePickPoint,t,this.panningPlane);const i=Vr(this.screenPickPoint[0],0),r=M(),s=Ie(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],oO(this.adjustedSphere,this.startCamera,i,r);const n=no();this.startCamera.projectToRenderScreen(r,n);const o=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],o);const a=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);a&&SS(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=M(),c=M(),h=M(),p=80,f=5,g=50;de(l,this.scenePickPoint,this.currentCamera.eye);const y=Ie(l);Te(l,l);const v=f*Math.max(Math.abs(this.view.camera.position.z),g),b=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,p);let w=b?Math.min(b,v):v;w=a?Math.min(w,y):w,ne(h,fe(c,this.currentCamera.eye,oe(c,l,w))),this.panningPlane[3]=-Se(this.panningPlane,h),this.startCamera.center=fe(c,this.startCamera.eye,oe(c,this.startCamera.viewForward,w));const S=Mm(e.center,this.tmpScreenPointArray);fG(this.panningPlane,this.startCamera,S,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===Nn.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===Nn.Horizontal?new k_({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new fT({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new u1({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===Nn.Horizontal){const r=this.panSphericalMomentumEstimator.evaluateMomentum();if(r)return new V$({view:this.view,momentum:r})}else{const r=this.panPlanarMomentumEstimator.evaluateMomentum();if(r)return new XC({view:this.view,momentum:r})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),Pye(this.sphere,this.currentCamera,this.smoothScaling.value),Mm(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=zt.ZOOM,this.constraintOptions.interactionFactor=sd(e.radius-this.beginRadius),Kr(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=Mm(e.center,this.tmpScreenPointArray);oO(this.sphere,this.currentCamera,t,this.tmp3d),sW(this.beginScenePoint,Se(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(zye(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(Uye(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=zt.PAN,this.constraintOptions.interactionFactor=sd(this.screenPickPoint,t),Kr(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){Te(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||Do(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+pG(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),J0(this.currentCamera,this.sphere,VR(this.rotationAxis,s)),this.constraintOptions.interactionType=zt.TUMBLE,this.constraintOptions.interactionFactor=sd(e.radius*i),Kr(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=Mm(e.center,this.tmpScreenPointArray);fG(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(Dye(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=zt.PAN,this.constraintOptions.interactionFactor=sd(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),Kr(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),rW(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=zt.ZOOM,this.constraintOptions.interactionFactor=sd(e.radius-this.beginRadius),Kr(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){ne(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||Do(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=pG(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),J0(this.currentCamera,this.sphere,VR(this.rotationAxis,n)),this.constraintOptions.interactionType=zt.TUMBLE,this.constraintOptions.interactionFactor=sd(e.radius*n),Kr(this.view,this.currentCamera,this.constraintOptions)}};u([d({constructOnly:!0})],G$.prototype,"view",void 0),G$=u([P("esri.views.3d.state.controllers.global.PinchAndPanController")],G$);const yte=Le(0,0,1),Qje={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},Jje=80;let j$=class extends K0{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new eN(.05),this.scalingValueSmooth=new eN(.05),this.planeHorizontal=fi(),this.planeVertical=fi(),this.rotationMomentumEstimator=new h0e,this.panMomentumEstimator=new c0e(300,12,.9),this.zoomMomentumEstimator=new d0e,this.beginCenter=M(),this.tmpPoints=[],this.beginCenterScreen=Vr(),this.tmpCentroid3d=M(),this.tmpCentroid2d=Vr(),this.tmp2d=Vr(),this.constraintOptions={selection:ur.ALL,interactionType:zt.NONE,interactionFactor:0,interactionStartCamera:new Di,interactionDirection:null,tiltMode:gn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),Mm(e.center,this.beginCenterScreen),Kue(yte,0,this.planeHorizontal);const i=M(),r=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i),s=M();Do(s,this.startCamera.viewForward);const n=M();ne(n,yte);const o=Se(s,n),a=Td(o<0?-o:o);if(this.panMode=a>=Qje.ANGLE_THRESHOLD?Nn.Horizontal:Nn.Vertical,NV(this.planeHorizontal,this.planeHorizontal,i),this.startCamera.aboveGround||FV(this.planeHorizontal,this.planeHorizontal),this.panMode===Nn.Vertical){oe(n,n,o),de(this.planeVertical,s,n),Te(this.planeVertical,this.planeVertical),NV(this.planeVertical,this.planeVertical,i);const l=M(),c=M(),h=M();de(l,i,this.currentCamera.eye);const p=Ie(l);Te(l,l);const f=5*Math.max(Math.abs(this.view.camera.position.z),50),g=this.view._stage.renderView.getMinimalDepthForArea(this.view.getVoxelWasmPerSceneView(),this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,Jje);let y=g?Math.min(g,f):f;y=r?Math.min(y,p):y,ne(h,fe(c,this.currentCamera.eye,oe(c,l,y))),this.planeVertical[3]=-Se(this.planeVertical,h),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),Az(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),Az(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===Nn.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const s=this.beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=n,this.scalingValueSmooth.update(s),rW(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=zt.ZOOM,this.constraintOptions.interactionFactor=sd(Math.abs(e.radius-this.beginRadius)),Kr(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),Az(this.tmpPoints,this.tmpCentroid3d),Mm(e.center,this.tmpCentroid2d),Dye(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=zt.PAN,this.constraintOptions.interactionFactor=sd(this.beginCenterScreen,this.tmpCentroid2d),Kr(this.view,this.currentCamera,this.constraintOptions),t){const s=this.planeHorizontal,n=r,o=this.rotationValueSmooth.value,a=o+pG(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=l,this.rotationValueSmooth.update(a);const c=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*e.timestamp),J0(this.currentCamera,n,VR(s,c)),this.constraintOptions.interactionType=zt.TUMBLE,this.constraintOptions.interactionFactor=sd(Math.abs(e.radius*c)),Kr(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new fT({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new u1({view:this.view,momentum:i,center:this.beginCenter,axis:this.planeHorizontal});const r=this.panMomentumEstimator.evaluateMomentum();return r?new XC({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const s=this.tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,r[n]===void 0&&(r[n]=M()),fG(t,i,s,r[n]),n+=1}),r}};u([d({constructOnly:!0})],j$.prototype,"view",void 0),j$=u([P("esri.views.3d.state.controllers.local.PinchAndPanController")],j$);class vte extends fo{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!oW(t.data,this.pointerAction))return;const i=t.timestamp-this.lastEndTimestamp,r=40,s=this.momentum&&this.momentum.active&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const r=this.controller.end(t.data);i&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new G$({view:this.view}):new j$({view:this.view})}}class Kje extends fo{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}}class p0e extends fo{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class eHe extends p0e{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class tHe extends p0e{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class iHe extends fo{constructor(t,i=!1){super(!0),this.view=t,this.invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){var i,r,s;const n=this.invert?-1:1,o=Vr(0,t.data.delta*n);switch(t.data.action){case"begin":(i=this.cameraController)==null||i.end(),this.cameraController=new pT({view:this.view,pivot:Ol.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(o);break;case"update":(r=this.cameraController)==null||r.update(o);break;case"end":(s=this.cameraController)==null||s.end(),this.cameraController=null}}}function _te(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:t.axes.map(i=>nHe(i,e.axisThreshold))}:{buttons:[],axes:[]}}function rHe(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function sHe(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function nHe(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}class oHe{constructor(t,i){this.element=t,this.input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this.inputDevices[a];l&&(this._emitGamepadEvent(o,_te(l),!1),this.inputDevices.splice(a,1),this.latestUpdate.splice(a,1),this.input.gamepad.devices.remove(l),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const i=new dq(t);i.deviceType!=="unknown"&&(this.inputDevices[t.index]=i,this.input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=Y1({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this.element.contains(document.activeElement),r=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this.inputDevices[s.index];if(!n)return;const o=this.latestUpdate[s.index],a=_te(n),l=r||sHe(a);o&&(o.timestamp===s.timestamp||!o.active&&l||rHe(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this.callback&&this.callback({device:this.inputDevices[t.index],state:i,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}}const bte=ue("trident"),wte=ue("edge"),aHe=ue("chrome"),lHe=ue("ff"),cHe=ue("safari"),Cw={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class f4{constructor(t,i){this.input=i,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new oHe(t,this.input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const r=this._active[i];this._element.removeEventListener(Lz[i],r),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&Lz[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(Lz[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,i){i?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Cw.touchNone:Cw.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Cw.touchPan:Cw.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Cw.touchNone),this._element.classList.remove(Cw.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=Bme(this._element,t);return f4.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const r=tke(i);r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:(bte||wte)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}bte||wte?r*=.7:aHe||cHe?r*=.6:lHe&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,o)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}f4.test={disableSubpixelCoordinates:!1};const Lz={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class uHe extends fo{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function f0e(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function hHe(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function dHe(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:Ed()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[x,E]=e,[R,O]=[E.x-x.x,E.y-x.y];return t.radius=Math.sqrt(R*R+O*O)/2,t.center.x=(x.x+E.x)/2,t.center.y=(x.y+E.y)/2,t}let i=0,r=0;for(let x=0;x<e.length;x++)i+=e[x].x,r+=e[x].y;i/=e.length,r/=e.length;const s=e.map(x=>x.x-i),n=e.map(x=>x.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let x=0;x<s.length;x++){const E=s[x],R=n[x],O=E*E,I=R*R;o+=O,a+=I,l+=E*R,c+=O*E,h+=I*R,p+=E*I,f+=R*O}const g=.5*(c+p),y=.5*(h+f),v=o*a-l*l,b=(g*a-y*l)/v,w=(o*y-l*g)/v,S=Ed(b+i,w+r);return{radius:Math.sqrt(b*b+w*w+(o+a)/e.length),center:S}}class pHe extends fo{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:i.buttons,timestamp:s,pointers:fHe(this.activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=s3(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(i,s);const n=H$(s,m0e(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this.activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=s3(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=s3(this.activePointerMap);this.activePointerMap.forEach(r=>{r.initialAngle=H$(r,i)-t,r.lastAngle=H$(r,i)-t})}_emitEvent(t,i,r){const s=s3(this.activePointerMap);this.drag.emit(this._createPayload(t,i,s,r),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this.activePointerMap.get(i)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this.isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(r),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function m0e(e){const t=[];return e.forEach(i=>{t.push(Ed(i.event.x,i.event.y))}),dHe(t)}function s3(e){const t=m0e(e);let i=0;return e.forEach(r=>{let s=H$(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s,i+=s-r.initialAngle}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function fHe(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function H$(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var xte;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(xte||(xte={}));const g0={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class mHe extends fo{constructor(t=g0.maximumDoubleClickDelay,i=g0.maximumDoubleClickDistance,r=g0.maximumDoubleTouchDelay,s=g0.maximumDoubleTouchDistance,n=VN){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=mn(t.doubleClickTimeout))}get hasPendingInputs(){return Us(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_handleImmediateClick(t){const i=t.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s){const n=i.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;f0e(s.event.data,i)>n?(this._clearDoubleClickTimeout(r,!0),this._startClick(t)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const i=this._pointerId(t.data),r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(i,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(i),r)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const i=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(i,!0)}_handleDrag(t){const i=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(i,!0)}_clearDoubleClickTimeout(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,i&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class gHe extends fo{constructor(t=g0.maximumDoubleClickDelay,i=g0.maximumDoubleClickDistance,r=g0.maximumDoubleTouchDelay,s=g0.maximumDoubleTouchDistance,n=VN){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=this._pointerId(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerLoss(t,i){const r=t.data,s=this._pointerId(r),n=this._pointerState.get(s);if(n&&i==="pointer-up"&&n.downButton===r.native.button){const o=n.immediateDoubleClick;if(o){o.timeoutHandle.remove();const a=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;f0e(o,t.data)>a?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,o.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_removeState(t){const i=this._pointerId(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const xE={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class yHe extends fo{constructor(t=xE.maximumClickDelay,i=xE.movementUntilMouseDrag,r=xE.movementUntilPenDrag,s=xE.movementUntilTouchDrag,n=xE.holdDelay,o=VN){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=i,this.movementUntilPenDrag=r,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):hHe(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}}class vHe{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this.currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class _He extends fo{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new vHe({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this.dragEventSeparator.handle(r))}get failed(){return this.state==="failed"}_observeStart(t,i){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;i.pointers.forEach(v=>{r=Math.max(r,v.x),s=Math.min(s,v.x),n=Math.max(n,v.y),o=Math.min(o,v.y)});let a=-1/0,l=1/0,c=-1/0,h=1/0;t.pointers.forEach(v=>{a=Math.max(a,v.x),l=Math.min(l,v.x),c=Math.max(c,v.y),h=Math.min(h,v.y)});const p=r-s,f=n-o,g=a-l,y=c-h;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(g-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}}let lm=class extends be{constructor(){super(...arguments),this._handles=new Jt}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new f4(this.view.surface,e.input);const t=[new gHe,new yHe,new mHe,new pHe(this.view.navigation),new _He],i=new P_({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new uHe],A0.INTERNAL),this._modeDragPan=new vte(e,"primary"),this._modeDragRotate=new Pz(e,"secondary",Ol.CENTER),this._modeDragZoom=new aje(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new Kje(e),new nje(e),new Gje(e),new jje(e,r.pan),new Hje(e),new tHe(e,r.resetTilt),new eHe(e,r.resetHeading),new Pz(e,"primary",Ol.EYE,[r.lookAround]),new Pz(e,"secondary",Ol.CENTER,[r.lookAround]),new vte(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new iHe(e)],A0.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(xe(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Bi))}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=yG.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],lm.prototype,"view",void 0),u([d({value:"pan"})],lm.prototype,"primaryDragAction",null),u([d({value:"default"})],lm.prototype,"mode",null),u([d({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],lm.prototype,"hasPendingInputs",void 0),u([d({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],lm.prototype,"latestPointerType",void 0),u([d()],lm.prototype,"_inputManager",void 0),lm=u([P("esri.views.3d.input.SceneInputManager")],lm);const yG=new Map,Nz=new Map,Fz=new Map;Nz.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Nz.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Fz.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Fz.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),yG.set("default",Nz),yG.set("pro",Fz);const bHe=lm;let Xr=class extends be{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],Xr.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],Xr.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],Xr.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],Xr.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],Xr.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],Xr.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],Xr.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],Xr.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],Xr.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],Xr.prototype,"SHOW_POI",void 0),u([d()],Xr.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],Xr.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],Xr.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],Xr.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],Xr.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],Xr.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],Xr.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],Xr.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],Xr.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],Xr.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],Xr.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],Xr.prototype,"LINE_WIREFRAMES",void 0),Xr=u([P("esri.views.3d.support.DebugFlags")],Xr);const Ni=new Xr;let xc,kT,vG=!1,_G=!1,bG=!1,wG=!1,YC=null;function wHe(e,t){if(!_G||!kT)return;g0e();const i=kT;let r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];r+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),y0e(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function xHe(e){bG=Ni.DECONFLICTOR_SHOW_VISIBLE,wG=Ni.DECONFLICTOR_SHOW_INVISIBLE,vG=bG||wG,_G=Ni.DECONFLICTOR_SHOW_GRID,YC=null,vG||_G?YC=()=>THe(e):xc&&(xc.parentElement.removeChild(xc),xc=null)}function g0e(){YC&&(YC(),YC=null)}function THe(e){xc==null&&(xc=document.createElement("canvas"),xc.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(xc));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;xc.setAttribute("width",`${o}px`),xc.setAttribute("height",`${a}px`),xc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),kT=xc.getContext("2d"),kT.clearRect(0,0,s,n),kT.font="12px Arial"}function y0e(e,t,i,r,s){g0e();const n=xc.height,o=kT;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function SHe(e,t){vG&&(t&&bG||!t&&wG)&&y0e(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var $n,$c;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})($n||($n={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}($c||($c={}));function v0e(e,t){return new m4(e,x0e,t)}function EHe(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=x0e;return new m4(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:Uz.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:Uz.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:Uz.minPixelSize},t)}function AHe(e){return Math.abs(e*e*e)}function _0e(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return TE.scale=Math.min(r.divisor/(t-r.offset),1),TE.factor=AHe(e),TE.minPixelSize=r.minPixelSize,TE.paddingPixels=s,TE}function b0e(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function uW(e,t){return Math.max(ti(e*t.scale,e,t.factor),b0e(e,t))}function CHe(e,t,i){const r=_0e(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,uW(1,r)}function Tte(e,t,i,r){r.scale=CHe(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function w0e(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,b0e(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function RHe(e,t,i,r){return uW(e,_0e(t,i,r))}class m4{constructor(t,i,r,s=OHe(),n){this.viewingMode=t,this.description=i,this.ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this.viewingMode===je.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new m4(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this.description,{fovY:a,distance:l}=t,c=this.calculateCurvatureDependentParameters(t,i),h=this.coverageCompensation(t,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,g=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),v=g/Math.cos(y),b=y+a*n*h,w=(v-f*(g/Math.cos(b)))/(1-f);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=w,r.divisor=v-w,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(t,i,r=Ste){return r.tiltAngle=this.description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,i,r=Ste){const s=this.description.curvatureDependent,n=1+t.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=He((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return r.tiltAngle=ti(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=ti(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(t,i,r){return(t.fovY-r.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}}const x0e={curvatureDependent:{min:{curvature:$t(10),tiltAngle:$t(12),scaleFallOffFactor:.5},max:{curvature:$t(70),tiltAngle:$t(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},Uz={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function OHe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const TE={scale:0,factor:0,minPixelSize:0,paddingPixels:0},Ste={tiltAngle:0,scaleFallOffFactor:0};function MHe(e){return e instanceof Float32Array&&e.length>=16}function PHe(e){return Array.isArray(e)&&e.length>=16}function IHe(e){return MHe(e)||PHe(e)}var Q;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(Q||(Q={}));function hW(e){e.vertex.code.add(T`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(T`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(T`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(T`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(T`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(T`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(T`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function $He(e){e.uniforms.add(new dt("screenSizePerspective",F.Pass,t=>T0e(t.screenSizePerspective)))}function g4(e){e.uniforms.add(new dt("screenSizePerspectiveAlignment",F.Pass,t=>T0e(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function T0e(e){return Wi(DHe,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const DHe=ii();function S0e(e,t){const i=e.vertex;t.hasVerticalOffset?(E0e(i),t.hasScreenSizePerspective&&(e.include(hW),g4(i),Md(e.vertex.uniforms,t)),i.code.add(T`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?T`vec3 worldNormal = normalize(worldPos + localOrigin);`:T`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?T`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:T`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(T`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const LHe=ii();function E0e(e){e.uniforms.add(new dt("verticalOffset",F.Pass,(t,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Wi(LHe,n*a,o,r,s)}))}var Lu;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(Lu||(Lu={}));var ja;function A0e(e,t){e.include(hW),e.attributes.add(A.POSITION,"vec3"),e.attributes.add(A.NORMAL,"vec3"),e.attributes.add(A.AUXPOS1,"vec4");const i=e.vertex;Gc(e,t),Md(i.uniforms,t),i.uniforms.add([new dt("viewport",F.Pass,(r,s)=>s.camera.fullViewport),new ye("polygonOffset"),new ye("cameraGroundRelative"),new ye("perDistancePixelRatio"),new ye("renderTransparentlyOccludedHUD")]),t.hasVerticalOffset&&E0e(i),i.uniforms.add(new et("hudVisibilityTexture")),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(T`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(T`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new li("viewNormal",F.Pass,(r,s)=>s.camera.viewInverseTransposeMatrix)),t.isDraped||i.code.add(T`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`),t.screenCenterOffsetUnitsEnabled===ja.Screen&&i.uniforms.add(new ye("pixelRatio",F.Pass,(r,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&g4(i),i.code.add(T`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===ja.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?T`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==ja.Screen?T`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===ja.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===ja.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(T`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function C0e(e,t){e.setUniform1f("renderTransparentlyOccludedHUD",t.renderTransparentlyOccludedHUD===Lu.Occluded?1:t.renderTransparentlyOccludedHUD===Lu.NotOccluded?0:.75)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(ja||(ja={}));const n3=Rs();function y4(e,t,i,r,s,n,o){if(!nM(t))if(e.boundingInfo){ht(e.primitiveType===Qa.Triangle);const a=i.tolerance;R0e(e.boundingInfo,r,s,a,n,o)}else{const a=e.indices.get(A.POSITION),l=e.vertexAttributes.get(A.POSITION);lM(r,s,0,a.length/3,a,l,void 0,n,o)}}const NHe=M();function R0e(e,t,i,r,s,n){if(C(e))return;const o=M0e(t,i,NHe);if($le(n3,e.getBBMin()),Dle(n3,e.getBBMax()),_(s)&&s.applyToAabb(n3),pW(n3,t,o,r)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>BHe){const p=e.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&R0e(p[f],t,i,r,s,n);return}}lM(t,i,0,h,l,c,a,s,n)}}const O0e=M();function lM(e,t,i,r,s,n,o,a,l){if(o)return FHe(e,t,i,r,s,n,o,a,l);const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],g=e[2],y=t[0]-p,v=t[1]-f,b=t[2]-g;for(let w=i,S=3*i;w<r;++w){let x=h*s[S++],E=c[x++],R=c[x++],O=c[x];x=h*s[S++];let I=c[x++],U=c[x++],N=c[x];x=h*s[S++];let V=c[x++],j=c[x++],H=c[x];_(a)&&([E,R,O]=a.applyToVertex(E,R,O,w),[I,U,N]=a.applyToVertex(I,U,N,w),[V,j,H]=a.applyToVertex(V,j,H,w));const J=I-E,K=U-R,he=N-O,le=V-E,$=j-R,z=H-O,k=v*z-$*b,G=b*le-z*y,W=y*$-le*v,ee=J*k+K*G+he*W;if(Math.abs(ee)<=Number.EPSILON)continue;const q=p-E,te=f-R,Ee=g-O,ve=q*k+te*G+Ee*W;if(ee>0){if(ve<0||ve>ee)continue}else if(ve>0||ve<ee)continue;const qe=te*he-K*Ee,Ce=Ee*J-he*q,Re=q*K-J*te,Oe=y*qe+v*Ce+b*Re;if(ee>0){if(Oe<0||ve+Oe>ee)continue}else if(Oe>0||ve+Oe<ee)continue;const Ve=(le*qe+$*Ce+z*Re)/ee;Ve>=0&&l(Ve,dW(J,K,he,le,$,z,O0e),w,!1)}}function FHe(e,t,i,r,s,n,o,a,l){const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],g=e[2],y=t[0]-p,v=t[1]-f,b=t[2]-g;for(let w=i;w<r;++w){const S=o[w];let x=3*S,E=h*s[x++],R=c[E++],O=c[E++],I=c[E];E=h*s[x++];let U=c[E++],N=c[E++],V=c[E];E=h*s[x];let j=c[E++],H=c[E++],J=c[E];_(a)&&([R,O,I]=a.applyToVertex(R,O,I,w),[U,N,V]=a.applyToVertex(U,N,V,w),[j,H,J]=a.applyToVertex(j,H,J,w));const K=U-R,he=N-O,le=V-I,$=j-R,z=H-O,k=J-I,G=v*k-z*b,W=b*$-k*y,ee=y*z-$*v,q=K*G+he*W+le*ee;if(Math.abs(q)<=Number.EPSILON)continue;const te=p-R,Ee=f-O,ve=g-I,qe=te*G+Ee*W+ve*ee;if(q>0){if(qe<0||qe>q)continue}else if(qe>0||qe<q)continue;const Ce=Ee*le-he*ve,Re=ve*K-le*te,Oe=te*he-K*Ee,Ve=y*Ce+v*Re+b*Oe;if(q>0){if(Ve<0||qe+Ve>q)continue}else if(Ve>0||qe+Ve<q)continue;const nr=($*Ce+z*Re+k*Oe)/q;nr>=0&&l(nr,dW(K,he,le,$,z,k,O0e),S,!1)}}const Ete=M(),Ate=M();function dW(e,t,i,r,s,n,o){return se(Ete,e,t,i),se(Ate,r,s,n),_t(o,Ete,Ate),Te(o,o),o}function M0e(e,t,i){return se(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function pW(e,t,i,r){return fW(e,t,i,r,1/0)}function fW(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-r-t[2])*i[2],f=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function P0e(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;_(s)&&(n=RHe(n,r,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return He(o*t,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function I0e(e,t){const i=t?I0e(t):{};for(const r in e){let s=e[r];s&&s.forEach&&(s=kHe(s)),s==null&&r in i||(i[r]=s)}return i}function UHe(e,t){let i=!1;for(const r in t){const s=t[r];s!==void 0&&(Array.isArray(s)?e[r]===null?(e[r]=s.slice(),i=!0):d7(e[r],s)&&(i=!0):e[r]!==s&&(i=!0,e[r]=s))}return i}function zHe(e,t,i,r,s,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(A.POSITION).data,a=e.vertexAttributes.get(A.SIZE),l=a&&a.data[0],c=r[0],h=r[1],p=((l+s)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],b=o[y+1],w=c-v,S=h-b,x=o[y+3]-v,E=o[y+4]-b,R=He((x*w+E*S)/(x*x+E*E),0,1),O=x*R-w,I=E*R-S,U=O*O+I*I;U<f&&(f=U,g=y/3)}f<p*p&&n(i.dist,i.normal,g,!1)}function kHe(e){const t=[];return e.forEach(i=>t.push(i)),t}const $0e={multiply:1,ignore:2,replace:3,tint:4},BHe=1e3;class Tf extends sM{constructor(t,i){super(),this.type=Id.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Ri,this._parameters=I0e(t,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,i=!0){UHe(this._parameters,t)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){_(this.repository)&&this.repository.materialChanged(this)}}var wr;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(wr||(wr={}));class U2 extends qs{constructor(){super(...arguments),this.renderOccluded=wr.Occlude}}function $mt(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=t[e[l]],r+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function VHe(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let a=0;a<o;++a){const l=2*e[a];s[r]=t[l],s[r+1]=t[l+1],r+=n}}function D0e(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}}function ZS(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}}function v4(e,t,i,r,s,n=1){if(!i)return void D0e(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,c=i[0],h=i[1],p=i[2],f=i[4],g=i[5],y=i[6],v=i[8],b=i[9],w=i[10],S=i[12],x=i[13],E=i[14];if(s*=a,n===1)for(let R=0;R<l;++R){const O=3*e[R],I=t[O],U=t[O+1],N=t[O+2];o[s]=c*I+f*U+v*N+S,o[s+1]=h*I+g*U+b*N+x,o[s+2]=p*I+y*U+w*N+E,s+=a}else for(let R=0;R<l;++R){const O=3*e[R],I=t[O],U=t[O+1],N=t[O+2],V=c*I+f*U+v*N+S,j=h*I+g*U+b*N+x,H=p*I+y*U+w*N+E;for(let J=0;J<n;++J)o[s]=V,o[s+1]=j,o[s+2]=H,s+=a}}function mW(e,t,i,r,s,n=1){if(!i)return void D0e(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],g=o[4],y=o[5],v=o[6],b=o[8],w=o[9],S=o[10],x=!Lj(o),E=1e-6,R=1-E;if(s*=l,n===1)for(let O=0;O<c;++O){const I=3*e[O],U=t[I],N=t[I+1],V=t[I+2];let j=h*U+g*N+b*V,H=p*U+y*N+w*V,J=f*U+v*N+S*V;if(x){const K=j*j+H*H+J*J;if(K<R&&K>E){const he=1/Math.sqrt(K);j*=he,H*=he,J*=he}}a[s+0]=j,a[s+1]=H,a[s+2]=J,s+=l}else for(let O=0;O<c;++O){const I=3*e[O],U=t[I],N=t[I+1],V=t[I+2];let j=h*U+g*N+b*V,H=p*U+y*N+w*V,J=f*U+v*N+S*V;if(x){const K=j*j+H*H+J*J;if(K<R&&K>E){const he=1/Math.sqrt(K);j*=he,H*=he,J*=he}}for(let K=0;K<n;++K)a[s+0]=j,a[s+1]=H,a[s+2]=J,s+=l}}function GHe(e,t,i,r,s,n=1){if(!i)return void ZS(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],g=o[4],y=o[5],v=o[6],b=o[8],w=o[9],S=o[10],x=!Lj(o),E=1e-6,R=1-E;if(s*=l,n===1)for(let O=0;O<c;++O){const I=4*e[O],U=t[I],N=t[I+1],V=t[I+2],j=t[I+3];let H=h*U+g*N+b*V,J=p*U+y*N+w*V,K=f*U+v*N+S*V;if(x){const he=H*H+J*J+K*K;if(he<R&&he>E){const le=1/Math.sqrt(he);H*=le,J*=le,K*=le}}a[s+0]=H,a[s+1]=J,a[s+2]=K,a[s+3]=j,s+=l}else for(let O=0;O<c;++O){const I=4*e[O],U=t[I],N=t[I+1],V=t[I+2],j=t[I+3];let H=h*U+g*N+b*V,J=p*U+y*N+w*V,K=f*U+v*N+S*V;if(x){const he=H*H+J*J+K*K;if(he<R&&he>E){const le=1/Math.sqrt(he);H*=le,J*=le,K*=le}}for(let he=0;he<n;++he)a[s+0]=H,a[s+1]=J,a[s+2]=K,a[s+3]=j,s+=l}}function tN(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,n===1){if(i===4)for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else if(i===4)for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}function _4(e,t,i,r,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case A.POSITION:{ht(a.size===3);const c=s.getField(o,pi);c&&v4(l,a.data,i,c,n);break}case A.NORMAL:{ht(a.size===3);const c=s.getField(o,pi);c&&mW(l,a.data,r,c,n);break}case A.UV0:{ht(a.size===2);const c=s.getField(o,uh);c&&VHe(l,a.data,c,n);break}case A.COLOR:{ht(a.size===3||a.size===4);const c=s.getField(o,al);c&&tN(l,a.data,a.size,c,n);break}case A.SYMBOLCOLOR:{ht(a.size===3||a.size===4);const c=s.getField(o,al);c&&tN(l,a.data,a.size,c,n);break}case A.TANGENT:{ht(a.size===4);const c=s.getField(o,yn);c&&GHe(l,a.data,r,c,n);break}}}}function iN(e,t,i=0){const r=He(e,0,qHe);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*WHe(r*jHe[s]))}function gW(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*HHe[r];return i}const jHe=[1,256,65536,16777216],HHe=[1/256,1/65536,1/16777216,1/4294967296],qHe=gW(new Uint8ClampedArray([255,255,255,255]));function WHe(e){return e-Math.floor(e)}function XHe(){if(C(zz)){const e=t=>Ei(`esri/libs/basisu/${t}`);zz=import("./basis_transcoder.3b2a427d.js").then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(i=>(i.initializeBasis(),delete i.then,i)))}return zz}let zz;var h1;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(h1||(h1={}));let _d=null,o3=null;async function L0e(){return C(o3)&&(o3=XHe(),_d=await o3),o3}function YHe(e,t){if(C(_d))return e.byteLength;const i=new _d.BasisFile(new Uint8Array(e)),r=F0e(i)?N0e(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function ZHe(e,t){if(C(_d))return e.byteLength;const i=new _d.KTX2File(new Uint8Array(e)),r=U0e(i)?N0e(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function N0e(e,t,i,r,s){const n=wge(t?kr.COMPRESSED_RGBA8_ETC2_EAC:kr.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function F0e(e){return e.getNumImages()>=1&&!e.isUASTC()}function U0e(e){return e.getFaces()>=1&&e.isETC1S()}async function QHe(e,t,i){C(_d)&&(_d=await L0e());const r=new _d.BasisFile(new Uint8Array(i));if(!F0e(r))return null;r.startTranscoding();const s=z0e(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function JHe(e,t,i){C(_d)&&(_d=await L0e());const r=new _d.KTX2File(new Uint8Array(i));if(!U0e(r))return null;r.startTranscoding();const s=z0e(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function z0e(e,t,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?r?[h1.ETC2_RGBA,kr.COMPRESSED_RGBA8_ETC2_EAC]:[h1.ETC1_RGB,kr.COMPRESSED_RGB8_ETC2]:c?r?[h1.BC3_RGBA,kr.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[h1.BC1_RGB,kr.COMPRESSED_RGB_S3TC_DXT1_EXT]:[h1.RGBA32,ze.RGBA],f=t.hasMipmap?i:Math.min(1,i),g=[];for(let w=0;w<f;w++)g.push(new Uint8Array(o(w,h))),a(w,h,g[w]);const y=g.length>1,v=y?Je.LINEAR_MIPMAP_LINEAR:Je.LINEAR,b=ge(L({},t),{samplingMode:v,hasMipmap:y,internalFormat:p,width:s,height:n});return new ot(e,b,{type:"compressed",levels:g})}const SE=pe.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),KHe=542327876,eqe=131072,tqe=4;function yW(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function iqe(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const rqe=yW("DXT1"),sqe=yW("DXT3"),nqe=yW("DXT5"),oqe=31,aqe=0,lqe=1,cqe=2,uqe=3,hqe=4,dqe=7,pqe=20,fqe=21;function mqe(e,t,i){const{textureData:r,internalFormat:s,width:n,height:o}=gqe(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?Je.LINEAR_MIPMAP_LINEAR:Je.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new ot(e,t,r)}function gqe(e,t){const i=new Int32Array(e,0,oqe);if(i[aqe]!==KHe)return SE.error("Invalid magic number in DDS header"),null;if(!(i[pqe]&tqe))return SE.error("Unsupported format, must contain a FourCC code"),null;const r=i[fqe];let s,n;switch(r){case rqe:s=8,n=kr.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case sqe:s=16,n=kr.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case nqe:s=16,n=kr.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return SE.error("Unsupported FourCC code:",iqe(r)),null}let o=1,a=i[hqe],l=i[uqe];(3&a)==0&&(3&l)==0||(SE.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;i[cqe]&eqe&&t!==!1&&(o=Math.max(1,i[dqe])),o===1||oS(a)&&oS(l)||(SE.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let g=i[lqe]+4;const y=[];for(let v=0;v<o;++v)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,g,f),y.push(p),g+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}class vs extends sM{constructor(t,i){super(),this.data=t,this.type=Id.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new qr,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:bt.REPEAT,t:bt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||C0.STRETCH,this.estimatedTexMemRequired=vs._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;C(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){gS(t.src)||t.preload==="auto"&&t.crossOrigin||(t.preload="auto",t.crossOrigin="anonymous",t.src=t.src)}_startPreloadImageElement(t){gf(t.src)||gS(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,i){if(C(t))return 0;if(H2(t)||Z_(t))return i.encoding===vs.KTX2_ENCODING?ZHe(t,i.mipmap):i.encoding===vs.BASIS_ENCODING?YHe(t,i.mipmap):t.byteLength;const{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?vs._getDataDimensions(t):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var i;return{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?Je.LINEAR_MIPMAP_LINEAR:Je.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(i=this.params.maxAnisotropy)!=null?i:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,i){if(_(this._glTexture))return this._glTexture;if(_(this._loadingPromise))return this._loadingPromise;const r=this.data;return C(r)?(this._glTexture=new ot(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,i,r):r instanceof Image?this._loadFromImageElement(t,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,i):(H2(r)||Z_(r))&&this.params.encoding===vs.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,r)):(H2(r)||Z_(r))&&this.params.encoding===vs.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,r)):(H2(r)||Z_(r))&&this.params.encoding===vs.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,r)):Z_(r)?this._loadFromPixelData(t,r):H2(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,i,r){if(!(this.data instanceof HTMLVideoElement)||C(this._glTexture)||this.data.readyState<ZC.HAVE_CURRENT_DATA||r===this.data.currentTime)return r;if(_(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this.data),this._drawStretchedTexture(t,i,s,n,o,this._glTexture)}else{const{width:s,height:n}=this.data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.data.currentTime}_loadFromDDSData(t,i){return this._glTexture=mqe(t,this._createDescriptor(t),i),this._glTexture}_loadFromKTX2(t,i){return this._loadAsync(()=>JHe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(t,i){return this._loadAsync(()=>QHe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(t,i){ht(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=this.params.components===1?ze.LUMINANCE:this.params.components===3?ze.RGB:ze.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new ot(t,r,i),this._glTexture}_loadFromURL(t,i,r){return this._loadAsync(async s=>{const n=await ch(r,{signal:s});return qt(s),this._loadFromImage(t,n,i)})}_loadFromImageElement(t,i,r){return r.complete?this._loadFromImage(t,r,i):this._loadAsync(async s=>{const n=await ice(r,r.src,!1,s);return qt(s),this._loadFromImage(t,n,i)})}_loadFromVideoElement(t,i,r){return r.readyState>=ZC.HAVE_CURRENT_DATA?this._loadFromImage(t,r,i):this._loadFromVideoElementAsync(t,i,r)}_loadFromVideoElementAsync(t,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),mn(h)},l=()=>{r.readyState>=ZC.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,r,i)))},c=p=>{a(),o(p||new Y("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=Lo(s,()=>c(gi()))}))}_loadFromImage(t,i,r){const s=vs._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?ze.RGB:ze.RGBA,!this._requiresPowerOfTwo(t,n)||oS(s.width)&&oS(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new ot(t,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,i,s,n,r),this._glTexture)}_loadAsync(t){const i=new AbortController;this._loadingController=i;const r=t(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(t,i){const r=bt.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return!fn(t.gl)&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(t,i,r,s,n){const{width:o,height:a}=r,l=nS(o),c=nS(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case C0.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new ot(t,s),h.updateData(0,0,0,o,a,i);break;case C0.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,i,r,s){const n=new ot(t,r),o=new hr(t,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE},n),a=new ot(t,{target:pt.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=ba(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,i,r,s,n,o){t.bindFramebuffer(r);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height);const l=t.bindTechnique(i);l.setUniform4f("uColor",1,1,1,1),l.bindTexture("tex",n),t.bindVAO(s),t.drawArrays(Dt.TRIANGLE_STRIP,0,oo(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height)}unload(){if(_(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(_(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),_(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var ZC;vs.DDS_ENCODING="image/vnd-ms.dds",vs.KTX2_ENCODING="image/ktx2",vs.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(ZC||(ZC={}));const lO=128,vW=.5;function k0e(e,t=lO,i=t*vW,r=0){const s=yqe(e,t,i,r);return new vs(s,{mipmap:!1,wrap:{s:bt.CLAMP_TO_EDGE,t:bt.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function yqe(e,t=lO,i=t*vW,r=0){switch(e){case"circle":default:return vqe(t,i);case"square":return _qe(t,i);case"cross":return wqe(t,i,r);case"x":return xqe(t,i,r);case"kite":return bqe(t,i);case"triangle":return Tqe(t,i);case"arrow":return Sqe(t,i)}}function vqe(e,t){const i=e/2-.5;return cM(e,G0e(i,i,t/2))}function _qe(e,t){return B0e(e,t,!1)}function bqe(e,t){return B0e(e,t,!0)}function wqe(e,t,i=0){return V0e(e,t,!1,i)}function xqe(e,t,i=0){return V0e(e,t,!0,i)}function Tqe(e,t){return cM(e,j0e(e/2,t,t/2))}function Sqe(e,t){const i=t,r=t/2,s=e/2,n=.8*i,o=G0e(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),a=j0e(s,i,r);return cM(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function B0e(e,t,i){return i&&(t/=Math.SQRT2),cM(e,(r,s)=>{let n=r-.5*e+.25,o=.5*e-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function V0e(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return cM(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function G0e(e,t,i){return(r,s)=>{const n=r-e,o=s-t;return Math.sqrt(n*n+o*o)-i}}function j0e(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const o=Math.abs(s-e)-i,a=n-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function cM(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const n=s+e*r;let o=t(s,r);o=o/e+.5,iN(o,i,4*n)}return i}class Dmt extends qs{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function Eqe(e,t){H0e(e,t,[new ke("slicePlaneOrigin",F.Pass,(i,r)=>Y0e(t,i,r)),new ke("slicePlaneBasis1",F.Pass,(i,r)=>{var s;return rN(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new ke("slicePlaneBasis2",F.Pass,(i,r)=>{var s;return rN(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function es(e,t){H0e(e,t,[new ke("slicePlaneOrigin",F.Draw,(i,r)=>Y0e(t,i,r)),new ke("slicePlaneBasis1",F.Draw,(i,r)=>{var s;return rN(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new ke("slicePlaneBasis2",F.Draw,(i,r)=>{var s;return rN(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function H0e(e,t,i){if(!t.hasSlicePlane){const o=T`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=T`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=T`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?T`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:T`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function q0e(e,t,i){return e.instancedDoublePrecision?se(Aqe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function W0e(e,t){return _(e)?de(sN,t.origin,e):t.origin}function X0e(e,t,i){return e.hasSliceTranslatedView?_(t)?ga(Cqe,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function Y0e(e,t,i){if(C(i.slicePlane))return pa;const r=q0e(e,t,i),s=W0e(r,i.slicePlane),n=X0e(e,r,i);return _(n)?Fe(sN,s,n):s}function rN(e,t,i,r){if(C(r)||C(i.slicePlane))return pa;const s=q0e(e,t,i),n=W0e(s,i.slicePlane),o=X0e(e,s,i);return _(o)?(fe(EE,r,n),Fe(sN,n,o),Fe(EE,EE,o),de(EE,EE,sN)):r}const Aqe=M(),sN=M(),EE=M(),Cqe=Ae();function Rqe(e,t){const{vertex:i,fragment:r}=e;t.hasMultipassGeometry&&i.include(qge),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(T`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?T`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&r.include(Zc),t.hasMultipassTerrain&&(r.uniforms.add(new et("terrainDepthTexture",F.Pass,(s,n)=>n.multipassTerrain.linearDepthTexture)),r.uniforms.add(new Ft("nearFar",F.Pass,(s,n)=>n.camera.nearFar)),r.uniforms.add(new Ft("inverseViewport",F.Pass,(s,n)=>n.inverseViewport))),r.include(mh),r.code.add(T`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?T`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const Oqe=ri(1,1,0,1),Z0e=ri(1,0,1,1);function xg(e){e.fragment.uniforms.add(new et("depthTex",F.Pass,(t,i)=>i.highlightDepthTexture)),e.fragment.uniforms.add(new Ft("highlightViewportPixelSz",F.Pass,(t,i)=>i.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",Oqe).add("unoccludedHighlightFlag","vec4",Z0e),e.fragment.code.add(T`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}class b4 extends eu{constructor(t,i,r,s){switch(i){case F.Pass:return void super(t,"vec4",i,(n,o,a)=>n.setUniform4fv(t,r(o,a)),s);case F.Draw:return void super(t,"vec4",i,(n,o,a)=>n.setUniform4fv(t,r(o,a)),s)}}}class Po extends eu{constructor(t,i,r,s){switch(i){case F.Pass:return void super(t,"float",i,(n,o,a)=>n.setUniform1fv(t,r(o,a)),s);case F.Draw:return void super(t,"float",i,(n,o,a)=>n.setUniform1fv(t,r(o,a)),s)}}}function BT(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(A.INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new ke("vvSizeMinSize",F.Pass,r=>r.vvSizeMinSize)),i.uniforms.add(new ke("vvSizeMaxSize",F.Pass,r=>r.vvSizeMaxSize)),i.uniforms.add(new ke("vvSizeOffset",F.Pass,r=>r.vvSizeOffset)),i.uniforms.add(new ke("vvSizeFactor",F.Pass,r=>r.vvSizeFactor)),i.uniforms.add(new qp("vvSymbolRotationMatrix",F.Pass,r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new ke("vvSymbolAnchor",F.Pass,r=>r.vvSymbolAnchor)),i.code.add(T`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(T`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?T`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(T`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",bd),t.hasVvInstancing&&(i.uniforms.add(new Po("vvColorValues",F.Pass,r=>r.vvColorValues,bd)),i.uniforms.add(new b4("vvColorColors",F.Pass,r=>r.vvColorColors,bd))),i.code.add(T`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?T`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(T`vec4 vvColor() { return vec4(1.0); }`)}const bd=8,nN=.1,co=.001;function Mqe(e){const t=new Fi,i=e.signedDistanceFieldEnabled;if(t.include(kq),t.include(A0e,e),t.include(es,e),e.output===Q.Occlusion)return t.include(Rqe,e),t;const{vertex:r,fragment:s}=t;t.include(hW),s.include(mh),s.include(wf),t.include(BT,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),r.uniforms.add(new dt("viewport",F.Pass,(c,h)=>h.camera.fullViewport)),r.uniforms.add(new Ft("screenOffset")),r.uniforms.add(new Ft("anchorPosition")),r.uniforms.add(new dt("materialColor")),r.uniforms.add(new ye("pixelRatio",F.Pass,(c,h)=>h.camera.pixelRatio)),i&&r.uniforms.add(new dt("outlineColor")),e.hasScreenSizePerspective&&($He(r),g4(r)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(A.UV0,"vec2"),t.attributes.add(A.COLOR,"vec4"),t.attributes.add(A.SIZE,"vec2"),t.attributes.add(A.AUXPOS2,"vec4"),r.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?T`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:T`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=T`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?i?T`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T`posProj += quadOffset;`;e.vvColor&&r.uniforms.add([new b4("vvColorColors",F.Pass,c=>c.vvColorColors,bd),new Po("vvColorValues",F.Pass,c=>c.vvColorValues,bd)]),r.uniforms.add(new Ft("textureCoordinateScaleFactor",F.Pass,c=>_(c.texture)&&_(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:Lue)),r.code.add(T`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${n}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${T.float(co)};
      ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${T.float(co)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${o}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?T`} else { vtc = vec2(0.0);
        ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),s.uniforms.add(new et("tex",F.Pass,c=>c.texture)),i&&s.uniforms.add([new dt("outlineColor"),new ye("outlineSize")]);const a=e.debugDrawLabelBorder?T`(isBorder > 0.0 ? 0.0 : ${T.float(nN)})`:T.float(nN),l=T`
    ${e.debugDrawLabelBorder?T`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?T`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${T.float(lO)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.float(co)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?T`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===Q.Alpha&&s.code.add(T`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===Q.Color&&s.code.add(T`
    void main() {
      ${l}
      ${e.transparencyPassType===gt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===Q.Highlight&&(t.include(xg),s.code.add(T`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?T`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function Q0e(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",Vm),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPosition",oN(t))}function oN(e,t=Iqe){return e.textureIsSignedDistanceField?Pqe(e.anchorPosition,e.distanceFieldBoundingBox,t):Bn(t,e.anchorPosition),t}function Pqe(e,t,i){_(t)?Li(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):Li(i,0,0)}const Iqe=lt(),$qe=Object.freeze(Object.defineProperty({__proto__:null,build:Mqe,bindHUDMaterialUniforms:Q0e,calculateAnchorPosForRendering:oN},Symbol.toStringTag,{value:"Module"})),jc=po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),Dqe=ah(Me.ONE,Me.ONE),J0e=ah(Me.ZERO,Me.ONE_MINUS_SRC_ALPHA);function Tg(e){return e===gt.FrontFace?null:e===gt.Alpha?J0e:Dqe}function w4(e){return e===gt.FrontFace?ol:null}const x4=5e5,T4={factor:-1,units:-2};function S4(e){return e?T4:null}function hv(e,t=Ji.LESS){return e===gt.NONE||e===gt.FrontFace?t:Ji.LEQUAL}class uM extends Ki{initializeConfiguration(t,i){i.spherical=t.viewingMode===je.Global}initializeProgram(t){const i=uM.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}bindPass(t,i){this.program.bindPass(t,i),this.program.setUniform1f("cameraGroundRelative",i.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(i.camera.fovY/2)/(i.camera.fullViewport[2]/2)),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),this.configuration.output===Q.Occlusion?Wge(this.program,i.multipassGeometry):(C0e(this.program,i),Q0e(this.program,t,i.camera.pixelRatio||1),this.configuration.occlusionTestEnabled&&this.program.bindTexture("hudVisibilityTexture",i.hudVisibilityTexture))}_setPipelineState(t){const i=this.configuration,r=t===gt.NONE,s=t===gt.FrontFace,n=this.configuration.hasPolygonOffset&&Lqe,o=(r||s)&&i.output!==Q.Highlight?(i.depthEnabled||i.output===Q.Occlusion)&&ol:null;return Ut({blending:i.output===Q.Color||i.output===Q.Alpha||i.output===Q.Highlight?r?Nqe:Tg(t):null,depthTest:{func:Ji.LEQUAL},depthWrite:o,colorWrite:Qt,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===Q.Occlusion?Dt.POINTS:Dt.TRIANGLES}}uM.shader=new Vi($qe,()=>import("./HUDMaterial.glsl.906c1d4d.js"));const Lqe={factor:0,units:-4},Nqe=ah(Me.ONE,Me.ONE_MINUS_SRC_ALPHA);class Io extends _a{}u([B({constValue:!0})],Io.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],Io.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],Io.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!1})],Io.prototype,"isGround",void 0),u([B({constValue:F.Pass})],Io.prototype,"pbrTextureBindType",void 0);class ds extends Io{constructor(){super(...arguments),this.output=Q.Color,this.screenCenterOffsetUnitsEnabled=ja.World,this.transparencyPassType=gt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([B({count:Q.COUNT})],ds.prototype,"output",void 0),u([B({count:ja.COUNT})],ds.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B({count:gt.COUNT})],ds.prototype,"transparencyPassType",void 0),u([B()],ds.prototype,"spherical",void 0),u([B()],ds.prototype,"occlusionTestEnabled",void 0),u([B()],ds.prototype,"signedDistanceFieldEnabled",void 0),u([B()],ds.prototype,"vvSize",void 0),u([B()],ds.prototype,"vvColor",void 0),u([B()],ds.prototype,"hasVerticalOffset",void 0),u([B()],ds.prototype,"hasScreenSizePerspective",void 0),u([B()],ds.prototype,"debugDrawLabelBorder",void 0),u([B()],ds.prototype,"binaryHighlightOcclusionEnabled",void 0),u([B()],ds.prototype,"hasSlicePlane",void 0),u([B()],ds.prototype,"hasPolygonOffset",void 0),u([B()],ds.prototype,"depthEnabled",void 0),u([B()],ds.prototype,"pixelSnappingEnabled",void 0),u([B()],ds.prototype,"isDraped",void 0),u([B()],ds.prototype,"hasMultipassGeometry",void 0),u([B()],ds.prototype,"hasMultipassTerrain",void 0),u([B()],ds.prototype,"cullAboveGround",void 0),u([B({constValue:!0})],ds.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],ds.prototype,"hasVvInstancing",void 0);class QS extends Tf{constructor(t){super(t,new qqe),this.techniqueConfig=new ds}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?ja.Screen:ja.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===Q.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===Q.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=i.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedHudGeometry(t,o,a,l,c):this._intersectHudGeometry(t,i,r,s,a,l)}_intersectDrapedHudGeometry(t,i,r,s,n){const o=t.vertexAttributes.get(A.POSITION),a=t.vertexAttributes.get(A.SIZE),l=this.parameters,c=oN(l);let h=1,p=1;if(_(s)){const g=s(Ote);h=g[0],p=g[5]}h*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const f=jqe*t.screenToWorldRatio;for(let g=0;g<o.data.length/o.size;g++){const y=g*o.size,v=o.data[y],b=o.data[y+1],w=g*a.size;let S;zg[0]=a.data[w]*h,zg[1]=a.data[w+1]*p,l.textureIsSignedDistanceField&&(S=l.outlineSize*t.screenToWorldRatio/2),Cte(i,v,b,zg,f,S,l,c)&&r(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(t,i,r,s,n,o){if(!s.options.selectionMode||!s.options.hud||nM(i))return;const a=this.parameters;let l=1,c=1;if(Wl(Bz,r),_(o)){const S=o(Ote);l=S[0],c=S[5],zqe(Bz)}const h=t.vertexAttributes.get(A.POSITION),p=t.vertexAttributes.get(A.SIZE),f=t.vertexAttributes.get(A.NORMAL),g=t.vertexAttributes.get(A.AUXPOS1);ht(h.size>=3);const y=s.point,v=s.camera,b=oN(a);l*=v.pixelRatio,c*=v.pixelRatio;const w=this.parameters.centerOffsetUnits==="screen";for(let S=0;S<h.data.length/h.size;S++){const x=S*h.size;se(_o,h.data[x],h.data[x+1],h.data[x+2]),Fe(_o,_o,r);const E=S*p.size;zg[0]=p.data[E]*l,zg[1]=p.data[E+1]*c,Fe(_o,_o,v.viewMatrix);const R=S*g.size;if(se(rc,g.data[R+0],g.data[R+1],g.data[R+2]),!w&&(_o[0]+=rc[0],_o[1]+=rc[1],rc[2]!==0)){const I=rc[2];Te(rc,_o),de(_o,_o,oe(rc,rc,I))}const O=S*f.size;if(se(AE,f.data[O],f.data[O+1],f.data[O+2]),this._normalAndViewAngle(AE,Bz,v,Vz),this._applyVerticalOffsetTransformationView(_o,Vz,v,kz),v.applyProjection(_o,Vo),Vo[0]>-1){Vo[0]=Math.floor(Vo[0]),Vo[1]=Math.floor(Vo[1]),w&&(rc[0]||rc[1])&&(Vo[0]+=rc[0],rc[1]!==0&&(Vo[1]+=uW(rc[1],kz.factorAlignment)),v.unapplyProjection(Vo,_o)),Vo[0]+=this.parameters.screenOffset[0],Vo[1]+=this.parameters.screenOffset[1],w0e(zg,kz.factor,zg);const I=Gqe*v.pixelRatio;let U;if(a.textureIsSignedDistanceField&&(U=a.outlineSize*v.pixelRatio/2),Cte(y,Vo[0],Vo[1],zg,I,U,a,b)){const N=s.ray;if(Fe(Rte,_o,jr(Vqe,v.viewMatrix)),Vo[0]=y[0],Vo[1]=y[1],v.unprojectFromRenderScreen(Vo,_o)){const V=M();ne(V,N.direction);const j=1/Ie(V);oe(V,V,j),n(Yi(N.origin,_o)*j,V,-1,!0,1,Rte)}}}}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(A.POSITION),n=t.indices.get(A.POSITION);return sye(s,n,i)}createBufferWriter(){return new Xqe(this)}_normalAndViewAngle(t,i,r,s){return IHe(i)&&(i=Wl(Bqe,i)),so(s.normal,t,i),Fe(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=Se(eve,Hqe),s}_updateScaleInfo(t,i,r){const s=this.parameters;_(s.screenSizePerspective)?Tte(r,i,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),_(s.screenSizePerspectiveAlignment)?Tte(r,i,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,Vz);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,i,r,s,n){return this._applyCenterOffsetNDC(t,i,r,s),_(n)&&ne(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(t,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ne(n,t);const c=He(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return oe(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,i,r,s){const n=Ie(t),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=oe(_o,i.normal,o*a);return fe(s,t,l),s}_applyVerticalOffsetTransformationView(t,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Ie(t);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Ie(t),a=Tt(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=P0e(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),oe(i.normal,i.normal,l),fe(t,t,i.normal)}_applyCenterOffsetView(t,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==t&&ne(r,t),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Te(AE,r),fe(r,r,oe(AE,AE,i[2])))),r}_applyCenterOffsetNDC(t,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&ne(s,t),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(t,i,r,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&ne(s,t),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(t){if(t===we.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:r}=this.parameters;return t===(i?we.LABEL_MATERIAL:we.HUD_MATERIAL)||r&&t===we.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===Q.Color||t.output===Q.Alpha?new Fqe(t):t.output===Q.Highlight?new K0e(t):null}calculateRelativeScreenBounds(t,i,r=Gt()){return Uqe(this.parameters,t,i,r),r[2]=r[0]+t[0],r[3]=r[1]+t[1],r}}class K0e extends Sq{constructor(t){super(L(L({},t),t.material.parameters))}_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.passParameters),this.selectProgram(t)}selectProgram(t){return this.ensureTechnique(uM,t)}beginSlot(t){return this._updateParameters(t)}}class Fqe extends K0e{_isOcclusionSlot(t){return t.slot===we.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===Q.Color||this._output===Q.Alpha)}selectProgram(t){return this.ensureTechnique(uM,t,this._isOcclusionSlot(t)?Q.Occlusion:this._output)}}function Uqe(e,t,i,r=kqe){return Bn(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function zqe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function Cte(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&_(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const kz={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},kqe=lt(),_o=M(),AE=M(),Vo=ii(),eve=M(),Rte=M(),Bz=Qi(),Bqe=Qi(),Vqe=Ae(),rc=M(),Vz={normal:eve,cosAngle:0},Ote=Ae(),Gqe=1,jqe=2,zg=[0,0],Hqe=Le(0,0,1);class qqe extends Lge{constructor(){super(...arguments),this.renderOccluded=wr.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Oi(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const Wqe=ls().vec3f(A.POSITION).vec3f(A.NORMAL).vec2f(A.UV0).vec4u8(A.COLOR).vec2f(A.SIZE).vec4f(A.AUXPOS1).vec4f(A.AUXPOS2);class Xqe{constructor(t){this.material=t,this.vertexBufferLayout=Wqe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(A.POSITION).length}write(t,i,r,s){v4(i.indices.get(A.POSITION),i.vertexAttributes.get(A.POSITION).data,t.transformation,r.position,s,6),mW(i.indices.get(A.NORMAL),i.vertexAttributes.get(A.NORMAL).data,t.invTranspTransformation,r.normal,s,6);{const n=i.vertexAttributes.get(A.UV0).data;let o,a,l,c;if(n==null||n.length<4){const g=this.material.parameters;o=0,a=0,l=g.texCoordScale[0],c=g.texCoordScale[1]}else o=n[0],a=n[1],l=n[2],c=n[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);const h=i.indices.get(A.POSITION).length,p=r.uv0;let f=s;for(let g=0;g<h;++g)p.set(f,0,o),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,a),f+=1}tN(i.indices.get(A.COLOR),i.vertexAttributes.get(A.COLOR).data,4,r.color,s,6);{const n=i.indices.get(A.SIZE),o=i.vertexAttributes.get(A.SIZE).data,a=n.length,l=r.size;let c=s;for(let h=0;h<a;++h){const p=o[2*n[h]],f=o[2*n[h]+1];for(let g=0;g<6;++g)l.set(c,0,p),l.set(c,1,f),c+=1}}i.indices.get(A.AUXPOS1)&&i.vertexAttributes.get(A.AUXPOS1)&&ZS(i.indices.get(A.AUXPOS1),i.vertexAttributes.get(A.AUXPOS1).data,r.auxpos1,s,6),i.indices.get(A.AUXPOS2)&&i.vertexAttributes.get(A.AUXPOS2)&&ZS(i.indices.get(A.AUXPOS2),i.vertexAttributes.get(A.AUXPOS2).data,r.auxpos2,s,6)}}const Vd=M(),Rw=ii(),CE=ii(),Gz=M(),Yqe=Ae(),Zqe=Vn(),jz=Ln(),Qqe=M(),Jqe=Gt();class Kqe{constructor(){this.aabr=Gt(),this.distance=0,this.culled=!1,this.visible=!1}}class eWe{constructor(t,i,r={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info=r}}class tWe{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class iWe{}class rWe{constructor(){this.sortArray=new Vt({allocator:t=>t||new iWe})}}var El;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(El||(El={}));class tve{constructor(){this.camera=new Di,this.slicePlane=av(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),Xb(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let mT=class extends be{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new tve,this._state=El.Idle,this.graphics=new tWe,this.iterators=new rWe,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==El.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/El.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case El.Idle:this._startUpdate(),e.madeProgress();case El.Process:if(this._state=El.Process,!this._processActiveGraphics(e))return;case El.Sort:if(this._state=El.Sort,!this._sortVisibleGraphics(e))return;case El.Deconflict:if(this._state=El.Deconflict,!this._deconflictVisibleGraphics(e))return;default:wHe(this,this.graphics.visible),this._state=El.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(C(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof QS}_startUpdate(){xHe(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new Kqe,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),sWe(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=jr(Yqe,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?Zqe:null;let s=0;for(_(r)&&(Fe(r,pa,this._runningViewState.camera.viewMatrix),r[3]=Ci(this.view.spatialReference).radius,s=Yue(r,pa));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===$n.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),SHe(n,a)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=Mte(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=Mte(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=nWe(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible($n.GRAPHIC,$c.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);nh(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(C(a)){if(a=this._getProjectionInfo(l,t,lWe),a.isOutsideScreen||this._isCulledBySlice(e,Vd)||_(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!Ni.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}C(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=Yc(s.boundingVolumeWorldSpace.bounds);Fe(Vd,a,r.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(A.NORMAL).data,h=l.get(A.AUXPOS1).data;return o.applyShaderOffsetsView(Vd,c,s.transformation,h,r,i.scaleInfo,Vd),Wi(Rw,Vd[0],Vd[1],Vd[2],1),Lc(CE,Rw,r.projectionMatrix),oe(i.positionNDC,CE,1/CE[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,Gz),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(Gz[2]),i.distance=Gz[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Wi(CE,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Lc(Rw,CE,t),DO(Rw,Rw,1/Rw[3]),se(i.positionView,Vd[0],Vd[1],Vd[2]),i}_isCulledByHorizon(e,t,i){return ne(jz.direction,e.positionView),se(jz.origin,0,0,0),!!ov(t,jz,Qqe)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&Kj(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(oWe);w0e(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=zD(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,Jqe),ti(0,n.fullWidth,.5+.5*r[0]),ti(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Lp(a),F0(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}S0(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this.accBinsSizeX);r<=Math.floor(i.aabr[2]/this.accBinsSizeX);r++)if(!(r<0||r>=this.accBinsNumX))for(let s=Math.floor(i.aabr[1]/this.accBinsSizeY);s<=Math.floor(i.aabr[3]/this.accBinsSizeY);s++){if(s<0||s>=this.accBinsNumY)continue;const n=this.accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,nF(l.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let i=0;i<this.accBinsNumX;i++){this.accBins.push([]);const r=this.accBins[this.accBins.length-1];for(let s=0;s<this.accBinsNumY;s++)r.push(new Vt)}}else for(let i=0;i<this.accBinsNumX;i++)for(let r=0;r<this.accBinsNumY;r++)this.accBins[i][r].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this.accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this.accBinsNumY||this.accBins[o][a].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag($c.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===$n.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function sWe(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag($c.DECONFLICTION,t)}function*Mte(e){if(Map.prototype.entries){const t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*nWe(e,t,i){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.prio=s.info?-s.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([d({constructOnly:!0})],mT.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],mT.prototype,"updating",null),mT=u([P("esri.views.3d.layers.graphics.Deconflictor")],mT);const oWe=lt();class aWe{constructor(){this.positionView=M(),this.positionNDC=M(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const lWe=new aWe,cWe=2e3;let q$=class extends mT{constructor(){super(...arguments),this.visibilityGroup=$n.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===un.IDLE||t-this._lastDeconfliction>cWe)&&(super.runTask(e),this.state===El.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};u([d({constructOnly:!0})],q$.prototype,"parent",void 0),q$=u([P("esri.views.3d.layers.graphics.LabelDeconflictor")],q$);let xG=class extends mT{constructor(){super(...arguments),this._handles=new Jt,this._contexts=new Map,this._viewState=new tve,this.visibilityGroup=$n.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([xe(()=>{var e,t;return(e=this.view)==null||(t=e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),xe(()=>{var e,t,i;return(e=this.view)==null||(t=e.map)==null||(i=t.ground)==null?void 0:i.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),xe(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Bi)]),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.GRAPHICS_DECONFLICTOR,this),this._labels=new q$({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&Hz(e));t.setVisibilityFlag($c.DECONFLICTION,i,$n.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;_(e)&&uhe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=_(e)}_slicePlaneChanged(){Us(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new eWe(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),Hz(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=Hz(e);i||uWe(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function Hz(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function uWe(e){const t=e.graphics3DGraphics;t&&t.forEach(i=>i.clearVisibilityFlag($c.DECONFLICTION))}xG=u([P("esri.views.3d.layers.graphics.GraphicsDeconflictor")],xG);const _W=(e,t,i)=>[t,i],JS=(e,t,i)=>[t,i,e[2]],bW=(e,t,i)=>[t,i,e[2],e[3]];function Lmt(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:_(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function ive({scale:e,translate:t},i){return i*e[0]+t[0]}function rve({scale:e,translate:t},i){return t[1]-i*e[1]}function sve(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=ive(e,i[0][0]),a=rve(e,i[0][1]);r[0]=t(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=t(c,o,a)}return r}function nve(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=sve(e,t,i[s]);return r}function hWe(e,t,i,r){return sve(e,i?r?bW:JS:r?JS:_W,t)}function dWe(e,t,i,r){return nve(e,i?r?bW:JS:r?JS:_W,t)}function pWe(e,t,i,r){return nve(e,i?r?bW:JS:r?JS:_W,t)}function ove(e,t,i,r,s){return _(i)&&(t.points=hWe(e,i.points,r,s)),t}function ave(e,t,i,r,s){return C(i)||(t.x=ive(e,i.x),t.y=rve(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m))),t}function lve(e,t,i,r,s){return _(i)&&(t.rings=pWe(e,i.rings,r,s)),t}function cve(e,t,i,r,s){return _(i)&&(t.paths=dWe(e,i.paths,r,s)),t}class Nmt{constructor(t,i,r){this.uid=t,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function Fmt(e){return _(e.geometry)}class Umt{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function zmt(e){const t=Hae.fromJSON(e.geometryType),i=Ke.fromJSON(e.spatialReference),r=e.transform,s=e.features.map(n=>{const o=fWe(n,t,i,e.objectIdFieldName),a=o.geometry;if(_(a)&&r)switch(a.type){case"point":o.geometry=ave(r,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=ove(r,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=lve(r,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=cve(r,a,a,a.hasZ,a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map(n=>jO.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function fWe(e,t,i,r){return{uid:Xa(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:mWe(e.geometry,t,i),visible:!0}}function mWe(e,t,i){if(C(e))return null;switch(t){case"point":{const r=e;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=e;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=e;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=e;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function Sg(e,t,i,r){return{x:e,y:t,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function gWe(e){if(C(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)i+=n.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=RM(e.vertexAttributes.position),t+=RM(e.vertexAttributes.normal),t+=RM(e.vertexAttributes.uv),t+=RM(e.vertexAttributes.tangent)}return t}function kmt(e){let t=32;return t+=Cue(e.attributes),t+=3,t+=8+gWe(e.geometry),t}function yWe(e){if(C(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function Bmt(e){if(C(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function Vmt(e,t){switch(ir(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)H5(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)H5(t,e.rings[i],e.hasZ);break;case"multipoint":H5(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function vWe(e,t){switch(nh(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)j5(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)j5(t,e.rings[i]);break;case"multipoint":j5(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function Gmt(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}Rs();Gt();function uve(e){return"declaredClass"in e}function Pte(e){return"declaredClass"in e}function _We(e){return"declaredClass"in e}function bWe(e,t){if(!e)return null;if(_We(e))return e;const i=new ho({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=re(e.symbol),i.attributes=re(e.attributes),i.geometry=hve(e.geometry),i}function hve(e){return C(e)?null:uve(e)?e:Km(wWe(e))}function wWe(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:Ite(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:Ite(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:pve(i)?dve(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}function Ite(e){return xWe(e)?e.map(t=>dve(t)):e}function dve(e){return e.map(t=>Xwe(t))}function xWe(e){for(const t of e)if(t.length!==0)return pve(t);return!1}function pve(e){return e.length&&(roe(e[0])||soe(e[0]))}function TWe(e,t){if(!e)return null;let i;if(Pte(e)){if(t==null)return e.clone();if(Pte(t))return t.copy(e)}return t!=null?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Sg(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}const SWe=pe.getLogger("esri.layers.support.labelFormatUtils"),$te={type:"simple",evaluate:()=>null},EWe={getAttribute:(e,t)=>e.field(t)};async function fve(e,t,i){if(!e||!e.symbol)return $te;const r=e.where,s=ZF(e),n=r?await import("./WhereClause.d10f799a.js"):null;let o;if(s.type==="arcade"){const a=await m2e(s.expression,i,t);o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{SWe.error(new Y("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>sq(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":mve(p,h)})};if(r){let a;try{a=n.WhereClause.create(r,t)}catch{return $te}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:EWe;return a.testFeature(c,h)?l(c):null}}return o}function mve(e,t){if(e==null)return"";const i=t.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=e;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+e,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=e;return t.type==="date"||t.type==="esriFieldTypeDate"?r=eg(r,nj("short-date")):ZN(t)&&(r=tg(+r)),r||""}var jmt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:fve,formatField:mve},Symbol.toStringTag,{value:"Module"}));function wW(e,t){if(e.type==="point")return kg(e,t,!1);if(uve(e))switch(e.type){case"extent":return kg(e.center,t,!1);case"polygon":return kg(e.centroid,t,!1);case"polyline":return kg(Dte(e),t,!0);case"mesh":return kg(e.origin,t,!1)}else switch(e.type){case"extent":return kg(AWe(e),t,!0);case"polygon":return kg(CWe(e),t,!0);case"polyline":return kg(Dte(e),t,!0)}}function Dte(e){const t=e.paths[0];if(!t||t.length===0)return null;const i=Mae(t,Oae(t)/2);return Sg(i[0],i[1],i[2],e.spatialReference)}function AWe(e){const t=isFinite(e.zmin);return Sg(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function CWe(e){const t=e.rings[0];if(!t||t.length===0)return null;const i=Pae(e.rings,e.hasZ);return Sg(i[0],i[1],i[2],e.spatialReference)}function kg(e,t,i){const r=i?e:TWe(e);return t&&e?qRe(e,r,t)?r:null:r}function Hmt(e,t,i,r=0){if(e){t||(t=Gt());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Wi(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function gve(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(A.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function QC(e,t){const i=bF(Wu);return _(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),_(t)?i[3]=t:_(e)&&e.length>3&&(i[3]=e[3]),i}function qmt(e,t,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)_(e)&&e[o]!=null?n[o]=e[o]:_(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return _(t)?n[3]=t:_(r)?n[3]=r:n[3]=s[3],n}function Lte(e=kp,t,i,r=1){const s=new Array(3);if(C(t)||C(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=i[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return za(s)}function RWe(e){return e.isPrimitive!=null}function E4(e){return RWe(e)&&(e=[e.width,e.depth,e.height]),aN(e)?null:"Symbol sizes may not be negative values"}function aN(e){if(Array.isArray(e)){for(const t of e)if(!aN(t))return!1;return!0}return e==null||e>=0}function OWe(e,t,i,r=Ae()){const s=e||0,n=t||0,o=i||0;return s!==0&&bS(r,r,-s/180*Math.PI),n!==0&&_S(r,r,n/180*Math.PI),o!==0&&mF(r,r,o/180*Math.PI),r}function xW(e,t){return t.minDemResolution!=null?t.minDemResolution:aF(e)?t.minDemResolutionForPoints:.01*MEe(e)}function yve(e,t,i,r,s,n,o,a,l,c,h){const p=FWe[h.mode];let f,g,y=0;if(Pr(e,t,i,r,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,g=o):(f=r,g=s),Pr(f,l.spatialReference,g,n,c.spatialReference,o,a)?y:void 0}function ug(e,t,i,r,s){const n=(ZL(e)?e.z:Qye(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const o=Tt(Vp(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=Tt(Vp(t,e,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=Tt(Vp(t,e,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=Tt(Vp(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return i.mode,void(s.z=0)}}function MWe(e,t,i,r){return ug(e,t,i,r,gT),gT.z}function hM(e,t,i){return t==null||i==null?e.definedChanged:t==="on-the-ground"&&i==="on-the-ground"?e.staysOnTheGround:t===i||t!=="on-the-ground"&&i!=="on-the-ground"?Lr.UPDATE:e.onTheGroundChanged}function dh(e){return e==="relative-to-ground"||e==="relative-to-scene"}function ev(e){return e!=="absolute-height"}function PWe(e,t,i,r,s){ug(t,i,s,r,gT),gve(e,gT.verticalDistanceToGround);const n=gT.sampledElevation,o=os(UWe,e.transformation);return a3[0]=t.x,a3[1]=t.y,a3[2]=gT.z,nl(t.spatialReference,a3,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function IWe(e,t,i,r,s,n){let o=0;const a=n.spatialReference;t*=3,r*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],f=Tt(n.getElevation(c,h,p,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,t+=3,r+=3}return o/s}function $We(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const g=e[t+0],y=e[t+1],v=e[t+2],b=Tt(n.getElevation(g,y,v,p,"ground"),0);l+=b,i[r+0]=g,i[r+1]=y,i[r+2]=h==null?v+b+c:b+c,t+=3,r+=3}return l/s}function DWe(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const g=e[t+0],y=e[t+1],v=e[t+2],b=Tt(n.getElevation(g,y,v,p,"scene"),0);l+=b,i[r+0]=g,i[r+1]=y,i[r+2]=h==null?v+b+c:b+c,t+=3,r+=3}return l/s}function LWe(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return t!==0||i!=null}function NWe(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<s;++h){const p=e[t+0],f=e[t+1],g=e[t+2];i[r+0]=p,i[r+1]=f,i[r+2]=c==null?g+l:l,t+=3,r+=3}return 0}class dM{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var Lr;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(Lr||(Lr={}));const FWe={"absolute-height":{applyElevationAlignmentBuffer:NWe,requiresAlignment:LWe},"on-the-ground":{applyElevationAlignmentBuffer:IWe,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:$We,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:DWe,requiresAlignment:()=>!0}},UWe=Ae(),gT=new dM,a3=M();function vve(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const a of n){const{update:l,averageGeometrySampledElevation:c}=bve(a,t,i,r);o+=c,l&&s.geometryVertexAttrsUpdated(a)}return o/n.length}function cO(e,t,i,r){const s=e.stageObject,n=t.centerPointInElevationSR;let o=0;s.metadata.usesVerticalDistanceToGround?(ug(n,i,t,r,Ga),gve(s,Ga.verticalDistanceToGround),o=Ga.sampledElevation):(ug(n,i,t,r,Ga),t.mode!=="absolute-height"&&(o=Ga.sampledElevation));const a=os(zWe,s.transformation),l=se(_ve,a[12],a[13],a[14]);Ni.TESTS_DISABLE_OPTIMIZATIONS?(Va[0]=n.x,Va[1]=n.y,Va[2]=Ga.z,nl(n.spatialReference,Va,a,r.spatialReference)&&(s.transformation=a)):r.setAltitudeOfTransformation(Ga.z,a);const c=TW/r.unitInMeters;return(Math.abs(a[12]-l[0])>=c||Math.abs(a[13]-l[1])>=c||Math.abs(a[14]-l[2])>=c)&&(s.transformation=a),o}const zWe=Ae();function kWe(e,t,i,r){const s=e.graphics3DSymbolLayer.lodRenderer;if(C(s))return 0;const n=t.centerPointInElevationSR;ug(n,i,t,r,Ga);const o=t.mode!=="absolute-height"?Ga.sampledElevation:0,a=s.instanceData,l=e.instanceIndex,c=VWe;a.getGlobalTransform(l,c);const h=se(_ve,c[12],c[13],c[14]);Ni.TESTS_DISABLE_OPTIMIZATIONS?(Va[0]=n.x,Va[1]=n.y,Va[2]=Ga.z,nl(n.spatialReference,Va,c,r.spatialReference)&&a.setGlobalTransform(l,c)):r.setAltitudeOfTransformation(Ga.z,c);const p=TW/r.unitInMeters;return(Ni.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&a.setGlobalTransform(l,c),o}function BWe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let o=0,a=null,l=0,c=!1;for(const h of n){const p=h.geometry.vertexAttributes.get(A.POSITION);if(p!==a){const{update:f,averageGeometrySampledElevation:g}=bve(h,t,i,r);l=g,a=p,c=f}c&&s.geometryVertexAttrsUpdated(h),o+=l}return o/n.length}const TW=.01,Va=M(),au=M(),Ow=M(),VWe=Ae(),_ve=M(),Ga=new dM;function bve(e,t,i,r){let s=!1;const n=i.spatialReference,o=e.geometry,a=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;au[0]=a[12],au[1]=a[13],au[2]=a[14],o.invalidateBoundingInfo();const c=o.getMutableAttribute(A.POSITION),h=c.data,p=o.vertexAttributes.get(A.MAPPOS).data,f=c.size,g=h.length/f,y=new Zye(p,n);let v=0,b=0;for(let w=0;w<g;w++){if(Ow[0]=h[v],Ow[1]=h[v+1],Ow[2]=h[v+2],ug(y,i,t,r,Ga),l&&(b+=Ga.sampledElevation),Ni.TESTS_DISABLE_OPTIMIZATIONS)h[v]=y.array[y.offset],h[v+1]=y.array[y.offset+1],h[v+2]=Ga.z,Pr(h,n,v,h,r.spatialReference,v,1),h[v]-=au[0],h[v+1]-=au[1],h[v+2]-=au[2],s=!0;else{Va[0]=h[v]+au[0],Va[1]=h[v+1]+au[1],Va[2]=h[v+2]+au[2],r.setAltitude(Va,Ga.z),h[v]=Va[0]-au[0],h[v+1]=Va[1]-au[1],h[v+2]=Va[2]-au[2];const S=TW/r.unitInMeters;(Math.abs(Ow[0]-h[v])>=S||Math.abs(Ow[1]-h[v+1])>=S||Math.abs(Ow[2]-h[v+2])>=S)&&(s=!0)}v+=f,y.offset+=3}return b/=g,{update:s,averageGeometrySampledElevation:b}}const GWe=pe.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function jWe(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function Wmt(e){const t=e&&e.expression;if(typeof t=="string"){const i=Tve(t);if(i!=null)return{cachedResult:i}}return null}async function Xmt(e,t,i){const r=e&&e.expression;if(typeof r!="string")return null;const s=Tve(r);if(s!=null)return{cachedResult:s};const n=await Jp(),o=n.arcadeUtils,a=o.createSyntaxTree(r);return o.dependsOnView(a)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(a),context:o.createExecContext(null,{sr:t}),modules:n}}}function wve(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function SW(e,t){if(e!=null&&!xve(e)){if(!t||!e.arcade)return void GWe.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=hve(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function HWe(e){if(e!=null){if(xve(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof i!="number"&&(e.cachedResult=0,i=0),i}return 0}function Ymt(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||r==="0"||(i=null),i}const qWe={cachedResult:0};function xve(e){return e.cachedResult!=null}function Tve(e){return e==="0"?0:null}class tu{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=K5e(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:t+r}calculateOffsetRenderUnits(t){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=HWe(r)*this._metersPerElevationInfoUnit),i/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=J5e(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=Tt(t.offset,0)}updateFeatureExpressionInfoContext(t,i,r){if(C(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&_(i)&&_(r)?(this._featureExpressionInfoContext=jWe(t),SW(this._featureExpressionInfoContext,wve(s.modules,i,r))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const i=new tu;return _(t)&&i.setFromElevationInfo(t),i}}var Nt;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(Nt||(Nt={}));class Sf{constructor(t,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=i}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,i){this._stageLayer=i,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),_(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,i){if(C(this._edgeState))return;const r=Nte(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,i){C(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!i),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),_(this._edgeState))){const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(t,i,r,s){this.elevationAligner!=null&&(_(r)&&SW(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,i),this._resetEdgeObject(s))}getCenterObjectSpace(t=M()){return ne(t,Yc(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(t=Rs()){const i=this.stageObject.boundingVolumeObjectSpace;return $le(t,i.min),Dle(t,i.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;t.render.origin[0]+=i[12],t.render.origin[1]+=i[13],t.render.origin[2]+=i[14],t.render.num++}else for(const i of this.stageObject.geometryRecords)i.computeAttachmentOrigin(Df)&&(Fe(Df,Df,this.stageObject.transformation),fe(t.render.origin,t.render.origin,Df),t.render.num++)}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=WWe,l=aF(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];Bg[0]=o[p[0]],Bg[1]=o[p[1]],Bg[2]=o[p[2]],Fe(Bg,Bg,this.stageObject.transformation),Lv[3*h+0]=Bg[0],Lv[3*h+1]=Bg[1],Lv[3*h+2]=Bg[2]}if(!t(Lv,0,l))return null;ir(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],Lv[h+p]),o[p+3]=Math.max(o[p+3],Lv[h+p]);c&&r.push({location:Lv.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){ud(o,Df);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=Tt(i.service.getElevation(Df[0],Df[1],h),0);else try{const f=xW(o,i);p=Tt(await i.service.queryElevation(Df[0],Df[1],s,f,h),0)}catch{}Ile(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,i){t===lg.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),t===lg.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(C(this._edgeState))return;const i=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,t):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,i){const r=this._edgeState;if(C(r))return;const s=Nte(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function Nte(e){return e.isVisible?e.parameters.transparent?Nt.TRANSPARENT:Nt.OPAQUE:Nt.INVISIBLE}const Lv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Bg=M(),Df=M(),WWe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var js;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(js||(js={}));class EW{constructor(t){this.schedule=t,this._loadStatus=Cc.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,i){return this._loadStatus===Cc.LOADED?(t&&t(),this._loader):this._loadStatus===Cc.FAILED?(i&&i(this._loadError),this._loader):(C(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Cc.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Cc.FAILED,!Tr(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(t,i).catch(()=>{}),this._loader)}abortLoad(){_(this._abortController)?this._abortController=rh(this._abortController):this._loadStatus===Cc.LOADING&&(this._loadStatus=Cc.FAILED),this._loader=null}}var Cc;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(Cc||(Cc={}));function XWe(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Sve(e,t){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&Rl.cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Rl.createPolySphereGeometry(.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Rl.createBoxGeometry(1));case"cone":return i(qz,r=>Rl.createConeGeometry(1,.5,r,!1),!0);case"inverted-cone":return i(qz,r=>Rl.createConeGeometry(1,.5,r,!0),!0);case"cylinder":return i(qz,r=>Rl.createCylinderGeometry(1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Rl.createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Rl.createDiamondGeometry(1),!0);default:return}}const qz=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function YWe(e){return e.type==="fill"}function ZWe(e){return e.type==="extrude"}function QWe(e){return e&&e.enabled&&(ZWe(e)||YWe(e))&&_(e.edges)}function JWe(e){return e&&e.enabled&&e.edges||null}function Eve(e,t){return KWe(JWe(e),t)}function KWe(e,t){if(C(e))return null;const i=_(e.color)?jj(rt.toUnitRGBA(e.color)):ri(0,0,0,0),r=$o(e.size),s=$o(e.extensionLength);switch(e.type){case"solid":return eXe(L({color:i,size:r,extensionLength:s},t));case"sketch":return tXe(L({color:i,size:r,extensionLength:s},t));default:return}}function eXe(e){return ge(L(L({},iXe),e),{type:"solid"})}function tXe(e){return ge(L(L({},rXe),e),{type:"sketch"})}const iXe={color:ri(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Nt.OPAQUE,hasSlicePlane:!1},rXe={color:ri(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Nt.OPAQUE,hasSlicePlane:!1};function l3(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.material)})}),FN(t)}function sXe(e){const t=new Array;return e.levels.forEach(i=>{i.components.forEach(r=>{r.textures&&t.push(...r.textures)})}),FN(t)}function AW(e){const t=[];return e.components.forEach(i=>{t.push(i.geometry)}),FN(t)}function nXe(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.geometry)})}),FN(t)}function oXe(e){return AW(e).reduce((t,i)=>t+i.indexCount/3,0)}const CW={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function Zmt(e){return e.type==="web-style"?CW:RW(e.symbolLayers.toArray().map(t=>Ave(e,t)))}function RW(e){let t=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)C(a)||(t+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function Qmt(e){const t=RW(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Fte={};function Ave(e,t){const i=Cve(e,t),r=QWe(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:_(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:ge(L({},aXe(t.resource&&t.resource.primitive||ace)),{memory:i});case"path":{let a=0,l=0;switch(t.profile){case"circle":a=10;break;case"quad":a=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*a,h=a*l*2;let p=-2*h-c;switch(t.cap){case"none":break;case"butt":case"square":p+=2*(a-1);break;case"round":p+=2*(a*(3-1)*2+a);break;default:return}return{primitivesPerFeature:p,primitivesPerCoordinate:h+c,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function Cve(e,t){const i=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Sa.EXTRUDE_EDGES:Sa.EXTRUDE;case"fill":return _(t.outline)&&t.outline.size>0?Sa.FILL_OUTLINE:Sa.FILL;case"water":return Sa.FILL;case"line":return t.join==="round"?Sa.LINE_ROUND:Sa.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Sa.PATH_ROUND_CIRCLE;case"quad":return Sa.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return Sa.PATH_MITER_CIRCLE;case"quad":return Sa.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return i?Sa.OBJECT_POINT:Sa.OBJECT_POLYGON;case"icon":case"text":return i?Sa.ICON_POINT:Sa.ICON_POLYGON;default:return}}function aXe(e){let t=Fte[e];if(t)return t;const i=Sve(e,null);return t={primitivesPerFeature:AW(i.levels[0]).reduce((r,s)=>r+s.indices.get(A.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Fte[e]=t,t}const Sa={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},c3=pe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class Ef extends EW{constructor(t,i,r,s){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=c3,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=i,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new tu,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Ute(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=Ute(t);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,i,r,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!i.length||i.length===1&&!i[0].length?l=`${a} (no ${r} were defined)`:Array.isArray(i)&&Array.isArray(i[0])?o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (${r} should be defined as a 2D array)`:l=`${a} (failed to project geometry to view spatial reference)`,l&&c3.warnOncePerTick(l)}_validateGeometry(t,i=null,r=null){if(_(i)&&!i.includes(t.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return c3.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return lXe}_defaultElevationInfoZ(){return cXe}_updateElevationContext(){_(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,i=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,i){const r=t.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=Tt(this._elevationContext.meterUnitOffset,Tt(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?qWe:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,t,this._context.layer),i}prepareSymbolLayerPatch(t){}updateGeometry(t,i){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,i=zte){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(_(t)?r*=t.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(t,i=zte){const r=this._getCombinedOpacity(t,i);if(this._drivenProperties.color)return QC(null,r);const s=_(t)?rt.toUnitRGB(t):kp;return QC(s,r)}_getVertexOpacityAndColor(t,i=null){const r=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=QC(r,s);return _(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return Ave(this.symbol,this.symbolLayer)}globalPropertyChanged(t,i,r){switch(t){case"opacity":return this.layerOpacityChanged(i,r);case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Lr.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,i,r){let s=Lr.UPDATE;return t.forEach(n=>{const o=i(n);if(_(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Lr.RECREATE}),s}applyRendererDiff(t,i){return js.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?qm(i.size.field,t):0,s=i.color?qm(i.color.field,t):0,n=i.opacity?qm(i.opacity.field,t):0;return ri(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&c3.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var i,r,s,n,o,a,l,c,h,p,f,g,y,v,b,w;return{size:(i=(r=this._fastUpdates)==null||(s=r.visualVariables)==null||(n=s.size)==null?void 0:n.field)!=null?i:null,color:(o=(a=this._fastUpdates)==null||(l=a.visualVariables)==null||(c=l.color)==null?void 0:c.field)!=null?o:null,opacity:(h=(p=this._fastUpdates)==null||(f=p.visualVariables)==null||(g=f.opacity)==null?void 0:g.field)!=null?h:null,rotation:(y=(v=this._fastUpdates)==null||(b=v.visualVariables)==null||(w=b.rotation)==null?void 0:w.field)!=null?y:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function qm(e,t){const i=e!=null?t.attributes[e]:0;return i!=null&&isFinite(i)?i:0}function Ute(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(i=>{switch(i.type){case"color":if(t.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const lXe={mode:"on-the-ground",offset:0,unit:"meters"},cXe={mode:"absolute-height",offset:0,unit:"meters"},zte={hasIntrinsicColor:!1};class Ob{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,i,r,s,n,o){this.id=Xa(),this.geometry=t,this.material=i,this.transformation=r,this.instanceParameters=s,this.origin=n,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return _(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(Fe(t,t,this.getStaticTransformation()),!0)}}Ob.pool=new as(Ob);class lN{constructor(t){this.channel=t,this.id=Xa()}}class Eg extends sM{constructor(t={}){super(),this.type=Id.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Ae(),this._bvObjectSpace=new kte,this._bvWorldSpace=new kte,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new Rve),this.transformation=Ae();const{geometries:i,materials:r,transformations:s,origins:n}=t;if(Array.isArray(i)){ht(r.length===i.length,"Object3D: materials don't match geometries"),ht(s.length===i.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=i.length,this._geometries.length=i.length;for(let o=0;o<i.length;o++)this._geometries[o]=i[o],this._geometryRecords[o]=Ob.pool.acquire(i[o],r[o],N1(s[o]),{highlights:null,occludees:null,visible:this._visible},n&&n[o])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){os(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){ht(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,i,r,s,n){r=r||Es,this._geometries.push(t);const o=Ob.pool.acquire(t,i,r,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||_(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const i=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=_(i.shaderTransformation)?this._geometryRecords.some(r=>_(r.shaderTransformation)):this._hasVolatileTransformation,i.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:i}),this._invalidateBoundingVolume(),i}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const i of this._geometryRecords)i.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new lN(lg.MaskOccludee);for(const i of this._geometryRecords)i.instanceParameters.occludees=lG(i.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const i of this._geometryRecords)i.instanceParameters.occludees=cG(i.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new lN(lg.Highlight);for(const i of this._geometryRecords)i.instanceParameters.highlights=lG(i.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const i of this._geometryRecords)i.instanceParameters.highlights=cG(i.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,i){return xr(Tt(i,Ae()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,i){return i=i||Ae(),xr(i,this.transformation,t.getShaderTransformation()),i}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],o=this._geometryRecords[s],a=n.boundingInfo;_(a)&&(this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,o.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this._getCombinedShaderTransformation(o)))}Cs(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Cs(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=M(),i=M(),r=gb(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(C(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),a=gb(o);Fe(t,n.getCenter(),o);const l=Yi(t,this._bvObjectSpace.bounds),c=n.getBSRadius()*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),Fe(i,t,this.transformation);const h=Yi(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,i,r){const s=t.getBBMin(),n=t.getBBMax(),o=ts(s),a=ts(n);Fe(o,o,r),Fe(a,a,r);for(let l=0;l<3;++l)i.min[l]=Math.min(i.min[l],o[l],a[l]),i.max[l]=Math.max(i.max[l],o[l],a[l]);for(let l=0;l<3;++l){ne(o,s),ne(a,n),o[l]=n[l],a[l]=s[l],Fe(o,o,r),Fe(a,a,r);for(let c=0;c<3;++c)i.min[c]=Math.min(i.min[c],o[c],a[c]),i.max[c]=Math.max(i.max[c],o[c],a[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,_(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,i){_(this._parentLayer)&&this._parentLayer.events.emit(t,i)}get test(){const t=this;return{hasGeometry:i=>t._geometries.includes(i),getGeometryIndex:i=>t._geometries.indexOf(i)}}}class Rve{constructor(){this.min=Le(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Le(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class kte extends Rve{constructor(){super(...arguments),this.bounds=Vn()}init(){se(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),se(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),que(this.bounds)}}const y0=M();function OW(e,t,i,r,s,n,o,a){const l=i?i.length:0,c=e.clippingExtent;if(Mr(t,y0,e.elevationProvider.spatialReference),_(c)&&!dj(c,y0))return null;Mr(t,y0,e.renderCoordsHelper.spatialReference);const h=e.localOriginFactory.getOrigin(y0),p=new Eg({castShadow:!1,metadata:{layerUid:n,graphicUid:o,usesVerticalDistanceToGround:!0}});for(let f=0;f<l;f++){const g=Es;p.addGeometry(i[f],r[f],g,h,a)}return{object:p,sampledElevation:PWe(p,t,e.elevationProvider,e.renderCoordsHelper,s)}}function uO(e,t,i){const r=e.elevationContext,s=i.spatialReference;Mr(t,y0,s),r.centerPointInElevationSR=Sg(y0[0],y0[1],t.hasZ?y0[2]:0,s)}function hO(e){switch(e.type){case"point":return e;case"polygon":case"extent":return wW(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const i=Mae(t,Oae(t)/2);return Sg(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function MW(){return new Float32Array(2)}function uXe(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function Bu(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function hXe(e,t){return new Float32Array(e,t,2)}function Ove(){return MW()}function Mve(){return Bu(1,1)}function Pve(){return Bu(1,0)}function Ive(){return Bu(0,1)}const dXe=Ove(),pXe=Mve(),fXe=Pve(),mXe=Ive();Object.freeze(Object.defineProperty({__proto__:null,create:MW,clone:uXe,fromValues:Bu,createView:hXe,zeros:Ove,ones:Mve,unitX:Pve,unitY:Ive,ZEROS:dXe,ONES:pXe,UNIT_X:fXe,UNIT_Y:mXe},Symbol.toStringTag,{value:"Module"}));function gXe(e){const t=new Fi;t.include(kq),t.include(A0e,e),t.include(es,e),t.attributes.add(A.UV0,"vec2");const{vertex:i,fragment:r}=t;return i.uniforms.add(new dt("viewport",F.Pass,(s,n)=>n.camera.fullViewport)),i.uniforms.add(new ye("lineSize")),i.uniforms.add(new Ft("pixelToNDC")),i.uniforms.add(new ye("borderSize")),i.uniforms.add(new Ft("screenOffset")),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&g4(i),i.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?T`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?T`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:T`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?T`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:T`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?T`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:T`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new dt("uColor")),r.uniforms.add(new dt("borderColor")),e.hasMultipassGeometry&&(r.include(qge,e),r.uniforms.add(new Ft("inverseViewport",F.Pass,(s,n)=>n.inverseViewport))),r.code.add(T`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?T`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:T`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function $ve(e,t,i){Bte(e,"uColor",t.color),e.setUniform2f("screenOffset",t.screenOffset[0]*i,t.screenOffset[1]*i),_(t.borderColor)?(Bte(e,"borderColor",t.borderColor),e.setUniform1f("borderSize",i)):(e.setUniform4f("borderColor",0,0,0,0),e.setUniform1f("borderSize",0))}function Bte(e,t,i){i.length===3?e.setUniform4f(t,i[0],i[1],i[2],1):e.setUniform4fv(t,i)}const yXe=Object.freeze(Object.defineProperty({__proto__:null,build:gXe,bindLineCalloutUniforms:$ve},Symbol.toStringTag,{value:"Module"}));class A4 extends Ki{initializeConfiguration(t,i){i.spherical=t.viewingMode===je.Global}initializeProgram(t){const i=A4.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}bindPass(t,i){this.program.bindPass(t,i),$ve(this.program,t,i.camera.pixelRatio||1),C0e(this.program,i),Wge(this.program,i.multipassGeometry),this.program.bindTexture("hudVisibilityTexture",i.hudVisibilityTexture),this.program.setUniform1f("cameraGroundRelative",i.camera.aboveGround?1:-1),this.program.setUniform1f("polygonOffset",t.shaderPolygonOffset),this.program.setUniform1f("perDistancePixelRatio",Math.tan(i.camera.fovY/2)/(i.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix),this.program.setUniform2f("pixelToNDC",2/i.camera.fullViewport[2],2/i.camera.fullViewport[3]);const r=i.camera.pixelRatio||1;this.program.setUniform1f("lineSize",Math.ceil(t.size)*r)}setPipelineState(t){const i=t?Ji.ALWAYS:Ji.LESS;return this.configuration.depthHudEnabled?Ut({depthTest:{func:i},depthWrite:ol}):Ut({blending:po(Me.ONE,Me.SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:Qt})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}A4.shader=new Vi(yXe,()=>import("./LineCallout.glsl.19607f43.js"));class Au extends Io{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=ja.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([B({count:ja.COUNT})],Au.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([B()],Au.prototype,"spherical",void 0),u([B()],Au.prototype,"occlusionTestEnabled",void 0),u([B()],Au.prototype,"hasVerticalOffset",void 0),u([B()],Au.prototype,"hasScreenSizePerspective",void 0),u([B()],Au.prototype,"depthHudEnabled",void 0),u([B()],Au.prototype,"depthHudAlignStartEnabled",void 0),u([B()],Au.prototype,"hasSlicePlane",void 0),u([B()],Au.prototype,"hasMultipassGeometry",void 0),u([B({constValue:!0})],Au.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],Au.prototype,"isDraped",void 0);class A1 extends Tf{constructor(t){super(t,new _Xe),this.techniqueConfig=new Au,this._uniqueMaterialIdentifier=A1.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,i){const r=(i==null?void 0:i.slot)!==we.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?ja.Screen:ja.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!i&&i.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case we.LINE_CALLOUTS:case we.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===Q.Color?new vXe(t):null}createBufferWriter(){return new wXe}validateParameters(t){const i=A1.uniqueMaterialIdentifier(t);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class vXe extends cv{beginSlot(t){return this.ensureTechnique(A4,t)}}class _Xe extends U2{constructor(){super(...arguments),this.screenOffset=sg,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const bXe=ls().vec3f(A.POSITION).vec3f(A.NORMAL).vec2f(A.UV0).vec4f(A.AUXPOS1),Vte=[Bu(0,0),Bu(1,0),Bu(0,1),Bu(1,0),Bu(1,1),Bu(0,1)];class wXe{constructor(){this.vertexBufferLayout=bXe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(A.POSITION).length}write(t,i,r,s){v4(i.indices.get(A.POSITION),i.vertexAttributes.get(A.POSITION).data,t.transformation,r.position,s,6),mW(i.indices.get(A.NORMAL),i.vertexAttributes.get(A.NORMAL).data,t.invTranspTransformation,r.normal,s,6),ZS(i.indices.get(A.AUXPOS1),i.vertexAttributes.get(A.AUXPOS1).data,r.auxpos1,s,6);for(let n=0;n<Vte.length;++n)r.uv0.setVec(s+n,Vte[n])}}class C4 extends Ef{constructor(t,i){super(t,null,i,SXe),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new A1(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const i=this.materialParameters;return i.screenOffset=t.screenOffset||sg,i.centerOffsetUnits=t.centerOffsetUnits||"world",i}get materialParameters(){const t=this.symbol,i=t.callout,r=_(i.color)?rt.toUnitRGBA(i.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const s=$o(i.size||0);let n=null;if(t.verticalOffset){const{screenLength:p,minWorldLength:f,maxWorldLength:g}=t.verticalOffset;n={screenLength:$o(p),minWorldLength:f||0,maxWorldLength:g!=null?g:1/0}}const o=_(i.border)&&_(i.border.color)?rt.toUnitRGBA(i.border.color):null,a=t.symbolLayers.getItemAt(0).type==="object",l=!a,c=a?0:void 0,h=t.type==="label-3d";return{color:r,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:o,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:h,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:wr.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return TXe}createGraphics3DGraphic(t){const i=t.renderingInfo,r=t.graphic,s=this.setGraphicElevationContext(r,new tu,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!pce(l)))return null;const a=wW(r.geometry);return C(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){return C(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=hM(C4.elevationModeChangeTypes,r,s);return n!==Lr.UPDATE||t.forEach(o=>{const a=i(o);_(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return C(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=dh(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:CW.memory}}_createVertexData(t){const{translation:i,centerOffset:r}=t,s=i?{size:3,data:[i[0],i[1],i[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[A.POSITION,s],[A.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[A.AUXPOS1,n]]}_getOrCreateMaterial(t){const i=this._perInstanceMaterialParameters(t),r=A1.uniqueMaterialIdentifier(i);if(_(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(r);return C(s)&&(s=new A1(i),t.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new A1(i),isUnique:!0}}_createAs3DShape(t,i,r,s){const n=[new Ar(this._createVertexData(r),xXe,Qa.Point)],o=this._getOrCreateMaterial(r),a=OW(this._context,t,n,[o.material],i,this._context.layer.uid,s);if(a===null)return null;const l=new Sf(this,a.object,n,o.isUnique?[o.material]:null,null,cO,i);return l.metadata={elevationOffset:r.elevationOffset||0},l.alignedSampledElevation=a.sampledElevation,l.needsElevationUpdates=dh(i.mode),uO(l,t,this._context.elevationProvider),l}}C4.elevationModeChangeTypes={definedChanged:Lr.UPDATE,staysOnTheGround:Lr.UPDATE,onTheGroundChanged:Lr.RECREATE};const Wz=new Uint16Array([0]),xXe=[[A.POSITION,Wz],[A.NORMAL,Wz],[A.AUXPOS1,Wz]],TXe={mode:"relative-to-ground",offset:0},SXe={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Gte=pe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function EXe(e,t){if(!Cj(e))return Gte.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=AXe[e.callout.type];return i?new i(e,t):(Gte.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const AXe={line:C4};class CXe{constructor(t,i,r){this.graphic=t,this.renderingInfo=i,this.layer=r}}const jte=new as(Array,e=>oF(e,Lle),null,10,5),RXe=Gt();class OXe{constructor(t,i,r,s,n){this.graphic=t,this.graphics3DSymbol=i,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=MXe($n._COUNT,$c._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?wve(n,t,s):null;for(const o of r)_(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,i){this._layer=i,this._stage=t,this._forEachSymbolLayerGraphic(r=>{r.initialize(t,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,i,r){this._labelGraphics.push(t),t.initialize(i,r),t.setVisibility(this.isVisible($n.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(t=!0)}),t}isVisible(t=$n.GRAPHIC,i){for(let r=0;r<=t;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(t,i){return this._visibilityFlags[i][t]!=null}setVisibilityFlag(t,i,r){const s=this.isVisible(r);this._visibilityFlags[r][t]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===$n.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible($n.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,i=$n.GRAPHIC){return this.setVisibilityFlag(t,void 0,i)}computeExtent(t){if(!this._extent){const i=this.graphic.geometry;if(C(i))return!1;this._extent=Gt(),vWe(i,this._extent);const r=i.spatialReference;if(!r.equals(t)&&!vF(this._extent,r,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,i){return _(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,i),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,i,r){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=jl.fromExtent(s.type==="mesh"?s.extent:s)),_De(s,i,r)}get usedMemory(){let t=Cue(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(C(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=yWe(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:M(),num:0},draped:{origin:lt(),num:0}};for(const i of this.graphics)C(i)||i.computeAttachmentOrigin(t);return t.render.num&&oe(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&Fl(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?ir(n.boundingBox):n.boundingBox=ir(),n.requiresDrapedElevation=!1,await pF(this.graphics,async o=>{if(C(o))return;const a=o.type==="draped"?i:t,l=jte.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&fS(n.boundingBox,l),jte.release(l)}),REe(n.boundingBox)||IB(pj(n.boundingBox,RXe))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(_(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,i,this._featureExpressionFeature,r)})}addObjectStateSet(t,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(t,i))}removeObjectState(t){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(t))}_forEachGraphicList(t,i){t.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function MXe(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var Hte,qte,Wte,Dve={exports:{}};Hte=Dve,qte=function(){function e($,z,k){k=k||2;var G,W,ee,q,te,Ee,ve,qe=z&&z.length,Ce=qe?z[0]*k:$.length,Re=t($,0,Ce,k,!0),Oe=[];if(!Re||Re.next===Re.prev)return Oe;if(qe&&(Re=l($,z,Re,k)),$.length>80*k){G=ee=$[0],W=q=$[1];for(var Ve=k;Ve<Ce;Ve+=k)(te=$[Ve])<G&&(G=te),(Ee=$[Ve+1])<W&&(W=Ee),te>ee&&(ee=te),Ee>q&&(q=Ee);ve=(ve=Math.max(ee-G,q-W))!==0?1/ve:0}return r(Re,Oe,k,G,W,ve),Oe}function t($,z,k,G,W){var ee,q;if(W===le($,z,k,G)>0)for(ee=z;ee<k;ee+=G)q=J(ee,$[ee],$[ee+1],q);else for(ee=k-G;ee>=z;ee-=G)q=J(ee,$[ee],$[ee+1],q);if(q&&R(q,q.next)){var te=q.next;K(q),q=te}return q}function i($,z){if(!$)return $;z||(z=$);var k,G=$;do if(k=!1,G.steiner||!R(G,G.next)&&E(G.prev,G,G.next)!==0)G=G.next;else{var W=G.prev;if(K(G),(G=z=W)===G.next)break;k=!0}while(k||G!==z);return z}function r($,z,k,G,W,ee,q){if($){!q&&ee&&y($,G,W,ee);for(var te,Ee,ve=$;$.prev!==$.next;)if(te=$.prev,Ee=$.next,ee?n($,G,W,ee):s($))z.push(te.i/k),z.push($.i/k),z.push(Ee.i/k),K($),$=Ee.next,ve=Ee.next;else if(($=Ee)===ve){q?q===1?r($=o(i($),z,k),z,k,G,W,ee,2):q===2&&a($,z,k,G,W,ee):r(i($),z,k,G,W,ee,1);break}}}function s($){var z=$.prev,k=$,G=$.next;if(E(z,k,G)>=0)return!1;for(var W=$.next.next;W!==$.prev;){if(S(z.x,z.y,k.x,k.y,G.x,G.y,W.x,W.y)&&E(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function n($,z,k,G){var W=$.prev,ee=$,q=$.next;if(E(W,ee,q)>=0)return!1;for(var te=W.x<ee.x?W.x<q.x?W.x:q.x:ee.x<q.x?ee.x:q.x,Ee=W.y<ee.y?W.y<q.y?W.y:q.y:ee.y<q.y?ee.y:q.y,ve=W.x>ee.x?W.x>q.x?W.x:q.x:ee.x>q.x?ee.x:q.x,qe=W.y>ee.y?W.y>q.y?W.y:q.y:ee.y>q.y?ee.y:q.y,Ce=b(te,Ee,z,k,G),Re=b(ve,qe,z,k,G),Oe=$.prevZ,Ve=$.nextZ;Oe&&Oe.z>=Ce&&Ve&&Ve.z<=Re;){if(Oe!==$.prev&&Oe!==$.next&&S(W.x,W.y,ee.x,ee.y,q.x,q.y,Oe.x,Oe.y)&&E(Oe.prev,Oe,Oe.next)>=0||(Oe=Oe.prevZ,Ve!==$.prev&&Ve!==$.next&&S(W.x,W.y,ee.x,ee.y,q.x,q.y,Ve.x,Ve.y)&&E(Ve.prev,Ve,Ve.next)>=0))return!1;Ve=Ve.nextZ}for(;Oe&&Oe.z>=Ce;){if(Oe!==$.prev&&Oe!==$.next&&S(W.x,W.y,ee.x,ee.y,q.x,q.y,Oe.x,Oe.y)&&E(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.prevZ}for(;Ve&&Ve.z<=Re;){if(Ve!==$.prev&&Ve!==$.next&&S(W.x,W.y,ee.x,ee.y,q.x,q.y,Ve.x,Ve.y)&&E(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.nextZ}return!0}function o($,z,k){var G=$;do{var W=G.prev,ee=G.next.next;!R(W,ee)&&O(W,G,G.next,ee)&&V(W,ee)&&V(ee,W)&&(z.push(W.i/k),z.push(G.i/k),z.push(ee.i/k),K(G),K(G.next),G=$=ee),G=G.next}while(G!==$);return i(G)}function a($,z,k,G,W,ee){var q=$;do{for(var te=q.next.next;te!==q.prev;){if(q.i!==te.i&&x(q,te)){var Ee=H(q,te);return q=i(q,q.next),Ee=i(Ee,Ee.next),r(q,z,k,G,W,ee),void r(Ee,z,k,G,W,ee)}te=te.next}q=q.next}while(q!==$)}function l($,z,k,G){var W,ee,q,te=[];for(W=0,ee=z.length;W<ee;W++)(q=t($,z[W]*G,W<ee-1?z[W+1]*G:$.length,G,!1))===q.next&&(q.steiner=!0),te.push(w(q));for(te.sort(c),W=0;W<te.length;W++)k=i(k=p(te[W],k),k.next);return k}function c($,z){return $.x-z.x}function h($){if($.next.prev===$)return $;let z=$;for(;;){const k=z.next;if(k.prev===z||k===z||k===$)break;z=k}return z}function p($,z){var k=f($,z);if(!k)return z;var G=H(k,$),W=i(k,k.next);let ee=h(G);return i(ee,ee.next),W=h(W),h(z===k?W:z)}function f($,z){var k,G=z,W=$.x,ee=$.y,q=-1/0;do{if(ee<=G.y&&ee>=G.next.y&&G.next.y!==G.y){var te=G.x+(ee-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(te<=W&&te>q){if(q=te,te===W){if(ee===G.y)return G;if(ee===G.next.y)return G.next}k=G.x<G.next.x?G:G.next}}G=G.next}while(G!==z);if(!k)return null;if(W===q)return k;var Ee,ve=k,qe=k.x,Ce=k.y,Re=1/0;G=k;do W>=G.x&&G.x>=qe&&W!==G.x&&S(ee<Ce?W:q,ee,qe,Ce,ee<Ce?q:W,ee,G.x,G.y)&&(Ee=Math.abs(ee-G.y)/(W-G.x),V(G,$)&&(Ee<Re||Ee===Re&&(G.x>k.x||G.x===k.x&&g(k,G)))&&(k=G,Re=Ee)),G=G.next;while(G!==ve);return k}function g($,z){return E($.prev,$,z.prev)<0&&E(z.next,$,$.next)<0}function y($,z,k,G){var W=$;do W.z===null&&(W.z=b(W.x,W.y,z,k,G)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==$);W.prevZ.nextZ=null,W.prevZ=null,v(W)}function v($){var z,k,G,W,ee,q,te,Ee,ve=1;do{for(k=$,$=null,ee=null,q=0;k;){for(q++,G=k,te=0,z=0;z<ve&&(te++,G=G.nextZ);z++);for(Ee=ve;te>0||Ee>0&&G;)te!==0&&(Ee===0||!G||k.z<=G.z)?(W=k,k=k.nextZ,te--):(W=G,G=G.nextZ,Ee--),ee?ee.nextZ=W:$=W,W.prevZ=ee,ee=W;k=G}ee.nextZ=null,ve*=2}while(q>1);return $}function b($,z,k,G,W){return($=1431655765&(($=858993459&(($=252645135&(($=16711935&(($=32767*($-k)*W)|$<<8))|$<<4))|$<<2))|$<<1))|(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z=32767*(z-G)*W)|z<<8))|z<<4))|z<<2))|z<<1))<<1}function w($){var z=$,k=$;do(z.x<k.x||z.x===k.x&&z.y<k.y)&&(k=z),z=z.next;while(z!==$);return k}function S($,z,k,G,W,ee,q,te){return(W-q)*(z-te)-($-q)*(ee-te)>=0&&($-q)*(G-te)-(k-q)*(z-te)>=0&&(k-q)*(ee-te)-(W-q)*(G-te)>=0}function x($,z){return $.next.i!==z.i&&$.prev.i!==z.i&&!N($,z)&&(V($,z)&&V(z,$)&&j($,z)&&(E($.prev,$,z.prev)||E($,z.prev,z))||R($,z)&&E($.prev,$,$.next)>0&&E(z.prev,z,z.next)>0)}function E($,z,k){return(z.y-$.y)*(k.x-z.x)-(z.x-$.x)*(k.y-z.y)}function R($,z){return $.x===z.x&&$.y===z.y}function O($,z,k,G){var W=U(E($,z,k)),ee=U(E($,z,G)),q=U(E(k,G,$)),te=U(E(k,G,z));return W!==ee&&q!==te||!(W!==0||!I($,k,z))||!(ee!==0||!I($,G,z))||!(q!==0||!I(k,$,G))||!(te!==0||!I(k,z,G))}function I($,z,k){return z.x<=Math.max($.x,k.x)&&z.x>=Math.min($.x,k.x)&&z.y<=Math.max($.y,k.y)&&z.y>=Math.min($.y,k.y)}function U($){return $>0?1:$<0?-1:0}function N($,z){var k=$;do{if(k.i!==$.i&&k.next.i!==$.i&&k.i!==z.i&&k.next.i!==z.i&&O(k,k.next,$,z))return!0;k=k.next}while(k!==$);return!1}function V($,z){return E($.prev,$,$.next)<0?E($,z,$.next)>=0&&E($,$.prev,z)>=0:E($,z,$.prev)<0||E($,$.next,z)<0}function j($,z){var k=$,G=!1,W=($.x+z.x)/2,ee=($.y+z.y)/2;do k.y>ee!=k.next.y>ee&&k.next.y!==k.y&&W<(k.next.x-k.x)*(ee-k.y)/(k.next.y-k.y)+k.x&&(G=!G),k=k.next;while(k!==$);return G}function H($,z){var k=new he($.i,$.x,$.y),G=new he(z.i,z.x,z.y),W=$.next,ee=z.prev;return $.next=z,z.prev=$,k.next=W,W.prev=k,G.next=k,k.prev=G,ee.next=G,G.prev=ee,G}function J($,z,k,G){var W=new he($,z,k);return G?(W.next=G.next,W.prev=G,G.next.prev=W,G.next=W):(W.prev=W,W.next=W),W}function K($){$.next.prev=$.prev,$.prev.next=$.next,$.prevZ&&($.prevZ.nextZ=$.nextZ),$.nextZ&&($.nextZ.prevZ=$.prevZ)}function he($,z,k){this.i=$,this.x=z,this.y=k,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function le($,z,k,G){for(var W=0,ee=z,q=k-G;ee<k;ee+=G)W+=($[q]-$[ee])*($[ee+1]+$[q+1]),q=ee;return W}return e.deviation=function($,z,k,G){var W=z&&z.length,ee=W?z[0]*k:$.length,q=Math.abs(le($,0,ee,k));if(W)for(var te=0,Ee=z.length;te<Ee;te++){var ve=z[te]*k,qe=te<Ee-1?z[te+1]*k:$.length;q-=Math.abs(le($,ve,qe,k))}var Ce=0;for(te=0;te<G.length;te+=3){var Re=G[te]*k,Oe=G[te+1]*k,Ve=G[te+2]*k;Ce+=Math.abs(($[Re]-$[Ve])*($[Oe+1]-$[Re+1])-($[Re]-$[Oe])*($[Ve+1]-$[Re+1]))}return q===0&&Ce===0?0:Math.abs((Ce-q)/q)},e.flatten=function($){for(var z=$[0][0].length,k={vertices:[],holes:[],dimensions:z},G=0,W=0;W<$.length;W++){for(var ee=0;ee<$[W].length;ee++)for(var q=0;q<z;q++)k.vertices.push($[W][ee][q]);W>0&&(G+=$[W-1].length,k.holes.push(G))}return k},e},(Wte=qte())!==void 0&&(Hte.exports=Wte);const KS=Dve.exports,R4=pe.getLogger("esri.views.3d.support.buffer.math");function hg(e,t,i){if(e.count!==t.count)return void R4.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],f=i[10],g=i[12],y=i[13],v=i[14],b=e.typedBuffer,w=e.typedBufferStride,S=t.typedBuffer,x=t.typedBufferStride;for(let E=0;E<r;E++){const R=E*w,O=E*x,I=S[O],U=S[O+1],N=S[O+2];b[R]=s*I+a*U+h*N+g,b[R+1]=n*I+l*U+p*N+y,b[R+2]=o*I+c*U+f*N+v}}function $d(e,t,i){if(e.count!==t.count)return void R4.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],g=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,b=t.typedBufferStride;for(let w=0;w<r;w++){const S=w*y,x=w*b,E=v[x],R=v[x+1],O=v[x+2];g[S]=s*E+a*R+h*O,g[S+1]=n*E+l*R+p*O,g[S+2]=o*E+c*R+f*O}}function TG(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function PW(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],g=h*h+p*p+f*f;if(g>0){const y=1/Math.sqrt(g);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function PXe(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:hg,transformMat3:$d,scale:TG,normalize:PW,shiftRight:PXe},Symbol.toStringTag,{value:"Module"}));function O4(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&_(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function IXe(e,t){if(_(e.symbol))return e.symbol;const i=O4(e,t);return _(i)&&i.type!=="dot-density"?i.getSymbol(e,t):null}function Jmt(e,t){const i=O4(e,t),r=IXe(e,t);if(C(r))return null;const s={renderer:i,symbol:r};if(C(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=GH(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function $Xe(e,t){if(_(e.symbol))return e.symbol;const i=O4(e,t);return _(i)&&i.getSymbolAsync(e,ge(L({},t),{abortOptions:{signal:t.signal}}))}async function Kmt(e,t){const i=O4(e,t),r=await $Xe(e,t);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=GH(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=rt.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function DXe(e,t=0){const i=e[t];return typeof i=="number"&&isFinite(i)?i:null}function LXe(e){for(let t=0;t<3;t++){const i=e[t];if(typeof i=="number")return isFinite(i)?i:0}return 0}function Lve(e,t,i){var r;const s=e.byteLength/(4*t),n=new Uint32Array(e,0,s*t);let o=new Uint32Array(s);const a=(r=i==null?void 0:i.minReduction)!=null?r:0,l=(i==null?void 0:i.originalIndices)||null,c=l?l.length:0,h=(i==null?void 0:i.componentOffsets)||null;let p=0;if(h)for(let O=0;O<h.length-1;O++){const I=h[O+1]-h[O];I>p&&(p=I)}else p=s;const f=Math.floor(1.1*p)+1;(Gd==null||Gd.length<2*f)&&(Gd=new Uint32Array(nS(2*f)));for(let O=0;O<2*f;O++)Gd[O]=0;let g=0;const y=!!h&&!!l,v=y?c:s,b=y?new Uint32Array(c):null,w=1.96;let S=a!==0?Math.ceil(4*w*w/(a*a)*a*(1-a)):v,x=1,E=h?h[1]:v;for(let O=0;O<v;O++){if(O===S){const H=1-g/O;if(H+w*Math.sqrt(H*(1-H)/O)<a)return null;S*=2}if(O===E){for(let H=0;H<2*f;H++)Gd[H]=0;if(l)for(let H=h[x-1];H<h[x];H++)b[H]=o[l[H]];E=h[++x]}const I=y?l[O]:O,U=I*t,N=UXe(n,U,t);let V=N%f,j=g;for(;Gd[2*V+1]!==0;){if(Gd[2*V]===N){const H=Gd[2*V+1]-1;if(NXe(n,U,H*t,t)){j=o[H];break}}V++,V>=f&&(V-=f)}j===g&&(Gd[2*V]=N,Gd[2*V+1]=I+1,g++),o[I]=j}if(a!==0&&1-g/s<a)return null;if(y){for(let O=h[x-1];O<b.length;O++)b[O]=o[l[O]];o=b}const R=new Uint32Array(t*g);g=0;for(let O=0;O<v;O++)o[O]===g&&(FXe(n,(y?l[O]:O)*t,R,g*t,t),g++);if(l&&!y){const O=new Uint32Array(c);for(let I=0;I<O.length;I++)O[I]=o[l[I]];o=O}return{buffer:R.buffer,indices:o,uniqueCount:g}}function NXe(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function FXe(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function UXe(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Gd=null;function zXe(e){const t=pM(e.rings,e.hasZ,af.CCW_IS_HOLE),i=[];let r=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),p=a.holeIndices.map(g=>g-c),f=new Uint32Array(KS(h,p,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=kXe(i,r,s),o=Lve(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function kXe(e,t,i){if(e.length===1)return e[0];const r=new Float64Array(t),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function pM(e,t,i){const r=e.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let g=0;g<r;++g)h+=e[g].length;const p=new Float64Array(3*h);let f=0;for(let g=r-1;g>=0;g--){const y=e[g],v=i===af.CCW_IS_HOLE&&BXe(y);if(v&&r!==1)s[a++]=y;else{let b=y.length;for(let S=0;S<a;++S)b+=s[S].length;const w={index:f,pathLengths:new Array(a+1),count:b,holeIndices:new Array(a)};w.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=v?u3(y,y.length-1,-1,p,f,y.length,t):u3(y,0,1,p,f,y.length,t);for(let S=0;S<a;++S){const x=s[S];w.holeIndices[S]=f,w.pathLengths[S+1]=x.length,x.length>0&&(o[c++]={index:f,count:x.length}),f=u3(x,0,1,p,f,x.length,t)}a=0,w.count>0&&(n[l++]=w)}}for(let g=0;g<a;++g){const y=s[g];y.length>0&&(o[c++]={index:f,count:y.length}),f=u3(y,0,1,p,f,y.length,t)}return l<r&&(n.length=l),c<r&&(o.length=c),{position:p,polygons:n,outlines:o}}function u3(e,t,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,t+=i}return s/3}function BXe(e){return!X7(e,!1,!1)}var af;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(af||(af={}));var JC,SG;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(JC||(JC={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(SG||(SG={}));var gs,Vu,nt,e2,Mn,Fn;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(gs||(gs={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Vu||(Vu={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(nt||(nt={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(e2||(e2={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(Mn||(Mn={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(Fn||(Fn={}));class VXe{constructor(t,i){this.vec3=t,this.id=i}}function KC(e,t,i,r){return new VXe(Le(e,t,i),r)}var Ao;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})(Ao||(Ao={}));class Xte{constructor(t,i){this.index=t,this.renderTargets=i,this.extent=Gt(),this.resolution=0,this.renderLocalOrigin=KC(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new jXe,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}getValidTarget(t){return this.validTargets[t]?this.renderTargets.getTarget(t):null}get needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const i=t===Ao.ColorAndWater?this.renderTargets.getTarget(Mn.Color):t===Ao.Highlight?this.renderTargets.getTarget(Mn.Highlight):this.renderTargets.getTarget(Mn.Occluded);return i?i.getTexture():null}getNormalTexture(t){const i=t===Ao.ColorAndWater?this.renderTargets.getTarget(Mn.Water):null;return i?i.getTexture():null}draw(t,i){const r=this.computeRenderTargetValidityBitfield(),s=this.needsColorWithoutRasterImage;for(const n of this.renderTargets.renderTargets)n.type===Mn.ColorNoRasterImage&&s===!1?this.validTargets[n.type]=!1:this.validTargets[n.type]=t.drawTarget(this,n,i);return r^this.computeRenderTargetValidityBitfield()?US.CHANGED:US.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[Mn.Color]|+t[Mn.ColorNoRasterImage]<<1|+t[Mn.Highlight]<<2|+t[Mn.Water]<<3|+t[Mn.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const i=.001*t.range;if(this.extent[0]-i<=t.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];zD(this.extent,t.range,0,r)}if(this.extent[2]+i>=t.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];zD(this.extent,-t.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,ig(this.canvasGeometries.extents[0],this.extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const i=this.canvasGeometries.extents[t];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===gs.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function GXe(e,t,i){return Math.min(nS(Math.max(e,t)+256),i)}class jXe{constructor(){this.extents=[Gt(),Gt(),Gt()],this.numViews=0}}class Nve{constructor(t,i){this.size=MW(),this._fbo=null,this._fbo=new hr(t,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE},{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=it(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,i){this.size[0]=t,this.size[1]=i,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,i;return(t=(i=this._fbo)==null?void 0:i.gpuMemoryUsage)!=null?t:0}}class HXe{constructor(t){const i=(r,s,n=!0)=>({type:s,fbo:new Nve(t,n),renderPass:r,valid:!1,lastUsed:1/0});this.renderTargets=[i(Ue.MATERIAL,Mn.Color),i(Ue.MATERIAL,Mn.ColorNoRasterImage),i(Ue.MATERIAL_HIGHLIGHT,Mn.Highlight,!1),i(Ue.MATERIAL_NORMAL,Mn.Water),i(Ue.MATERIAL,Mn.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,i,r){if(t)i.lastUsed=r;else if(r-i.lastUsed>qXe)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,i)=>t+i.fbo.gpuMemoryUsage,0)}}const qXe=1e3;class IW{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,i){var r;return(r=this._outer.get(t))==null?void 0:r.get(i)}set(t,i,r){const s=this._outer.get(t);s?s.set(i,r):this._outer.set(t,new Map([[i,r]]))}delete(t,i){const r=this._outer.get(t);r&&(r.delete(i),r.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((i,r)=>t(i,r))}}class Fve{constructor(t){this._context=t,this._perConstructorInstances=new IW,this._frameCounter=0,this._keepAliveFrameCount=Yte}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,i){const r=i.key;let s=this._perConstructorInstances.get(t,r);if(C(s)){const n=new t(this._context,i,()=>this.release(n));s=new WXe(n),this._perConstructorInstances.set(t,r,s)}return++s.refCount,s.technique}releaseAndAcquire(t,i,r){if(_(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(t,i)}release(t){if(C(t)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(t.constructor,t.key);C(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Yte&&this._perConstructorInstances.forEach((t,i)=>{t.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>{l.technique.reload(this._context)}))};t.push(s(i,r))}),await Promise.all(t)}}class WXe{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const Yte=-1,M4=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const s of(r=this._managedDisposables)!=null?r:[]){var r;const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class P4 extends M4(class{}){}function Kn(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(i=(r=e._managedDisposables)==null?void 0:r.slice())!=null?i:[]),e._managedDisposables.unshift(t)}}const XXe=pe.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class Uve{constructor(t,i,r,s){this._textureRepository=t,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new IW}dispose(){this._textureRepository.dispose()}acquire(t,i){this._ownMaterial(t);let r=this._id2glMaterialRef.get(i,t.id);if(C(r)){const s=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});r=new YXe(s),this._id2glMaterialRef.set(i,t.id,r)}return r.ref(),r.glMaterial}release(t,i){const r=this._id2glMaterialRef.get(i,t.id);_(r)&&(r.unref(),r.referenced||(it(r.glMaterial),this._id2glMaterialRef.delete(i,t.id)))}_ownMaterial(t){_(t.repository)&&t.repository!==this&&XXe.error("Material is already owned by a different material repository"),t.repository=this}}class YXe{constructor(t){this.glMaterial=t,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,ht(this.refCnt>=0)}get referenced(){return this.refCnt>0}}const ZXe=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class t2{constructor(t,i){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new zr,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),zr.clearPool(),EG[0]=null,Nv.prune(),B_.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);const r=zr.acquire();for(let s=0;s<i;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}zr.release(r)}remove(t,i=null){this._objectCount-=t.length;const r=zr.acquire();for(const s of t){const n=_(i)?i:TS(this._objectToBoundingSphere(s),tYe);lC(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}zr.release(r),this._shrink()}update(t,i){if(!lC(i[3])&&this._isDegenerate(t))return;const r=eYe(t);this.remove(r,i),this.add(r)}forEachAlongRay(t,i,r){const s=Xc(t,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(t,i,r,s){const n=Xc(t,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(t){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(t),r.residents!==null&&r.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=Xz(t,i),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!m0(r,f))return;const g=qy(t,i,Yc(f)),y=g-f[3],v=g+f[3];y<o&&(o=y,a=v,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!m0(r,p.bounds)||(oe(lu,c,p.halfSize),fe(lu,lu,p.bounds),qy(t,i,lu)>a))return!1;const f=p.node;return f.terminals.forAll(g=>h(g)),f.residents!==null&&f.residents.forAll(g=>h(g)),!0},t,i),l}forEachInDepthRange(t,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:v=>{r===t2.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,v.near),c=Math.min(c,v.far)):(l=Math.max(l,-v.far),c=Math.min(c,-v.near))}};h.setRange(s);const p=qy(i,r,t),f=Xz(i,r),g=Xz(i,-r),y=v=>{if(!a(v))return;const b=this._objectToBoundingSphere(v),w=Yc(b),S=qy(i,r,w)-p,x=S-b[3],E=S+b[3];x>c||E<l||!m0(o,b)||n(v,h)};this._forEachNodeDepthOrdered(this._root,v=>{if(!m0(o,v.bounds)||(oe(lu,f,v.halfSize),fe(lu,lu,v.bounds),qy(i,r,lu)-p>c)||(oe(lu,g,v.halfSize),fe(lu,lu,v.bounds),qy(i,r,lu)-p<l))return!1;const b=v.node;return b.terminals.forAll(w=>y(w)),b.residents!==null&&b.residents.forAll(w=>y(w)),!0},i,r)}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize))}_intersectsNode(t,i){return h3(i.bounds,2*-i.halfSize,Tc),h3(i.bounds,2*i.halfSize,Sc),gee(t.origin,t.direction,Tc,Sc)}_intersectsNodeWithOffset(t,i,r){return h3(i.bounds,2*-i.halfSize,Tc),h3(i.bounds,2*i.halfSize,Sc),r.applyToMinMax(Tc,Sc),gee(t.origin,t.direction,Tc,Sc)}_intersectsObject(t,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||DV(r,t)}_intersectsObjectWithOffset(t,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||DV(r.applyToBoundingSphere(s),t)}_forEachNode(t,i){let r=zr.acquire().init(t);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(zr.acquire().init(r).advance(n));zr.release(r)}}_forEachNodeDepthOrdered(t,i,r,s=t2.DepthOrder.FRONT_TO_BACK){let n=zr.acquire().init(t);const o=[n];for(KXe(r,s,Jte);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Jte[a];n.node.children[l]&&o.push(zr.acquire().init(n).advance(l))}zr.release(n)}}_remove(t,i,r){Nv.clear();const s=r.advanceTo(i,(n,o)=>{Nv.push(n.node),Nv.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=Nv.length-2;n>=0;n-=2){const o=Nv.data[n],a=Nv.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Vt({shrink:!0})),!0)}_add(t,i){i.advanceTo(this._objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){const i=t.node.residents;t.node.residents=null;for(let r=0;r<i.length;r++){const s=zr.acquire().init(t);this._add(i.getItemAt(r),s),zr.release(s)}}_grow(t,i){if(i!==0&&(Zte(t,i,r=>this._objectToBoundingSphere(r),jd),lC(jd[3])&&!this._fitsInsideTree(jd)))if(this._nodeIsEmpty(this._root.node))TS(jd,this._root.bounds),this._root.halfSize=1.25*jd[3];else{const r=this._rootBoundsForRootAsSubNode(jd);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(jd,r):this._growRootAsSubNode(r),zr.release(r)}}_rebuildTree(t,i){ne(Zz,i.bounds),Zz[3]=i.halfSize,Zte([t,Zz],2,s=>s,Qz);const r=zr.acquire().init(this._root);this._root.initFrom(null,Qz,1.25*Qz[3]),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),zr.release(r)}_placingRootViolatesMaxDepth(t){const i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const i=t[3],r=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let a=0;a<3;a++){const l=n[a]-o-(r[a]-i),c=r[a]+i-(n[a]+o),h=Math.max(0,Math.ceil(l/(2*o))),p=Math.max(0,Math.ceil(c/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),d3[a].min=h,d3[a].max=p}for(let a=0;a<3;a++){let l=d3[a].min,c=d3[a].max;const h=(s-(l+c))/2;l+=Math.ceil(h),c+=Math.floor(h);const p=n[a]-o-l*o*2;Yz[a]=p+(c+l)*o}return Yz[3]=s*o*kve,zr.acquire().initFrom(null,Yz,s*o,0)}_growRootAsSubNode(t){const i=this._root.node;ne(jd,this._root.bounds),jd[3]=this._root.halfSize,this._root.init(t),t.advanceTo(jd,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&t==null;)r=s++,t=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(t){return!lC(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const i=this._root.bounds,r=this._root.halfSize;return t[3]<=r&&t[0]>=i[0]-r&&t[0]<=i[0]+r&&t[1]>=i[1]-r&&t[1]<=i[1]+r&&t[2]>=i[2]-r&&t[2]<=i[2]+r}}class zr{constructor(){this.bounds=Vn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,r,s=this.depth){return this.node=_(t)?t:zr.createEmptyNode(),_(i)&&TS(i,this.bounds),this.halfSize=r,this.depth=s,this}advance(t){let i=this.node.children[t];i||(i=zr.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;const r=zve[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*kve,this}advanceTo(t,i,r=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const i=this.bounds;return(i[0]<t[0]?1:0)+(i[1]<t[1]?2:0)+(i[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Vt({shrink:!0}),residents:new Vt({shrink:!0})}}static acquire(){return zr._pool.acquire()}static release(t){zr._pool.release(t)}static clearPool(){zr._pool.prune()}}function QXe(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function JXe(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function h3(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function Zte(e,t,i,r){if(t===1){const s=i(e[0]);TS(s,r)}else{Tc[0]=1/0,Tc[1]=1/0,Tc[2]=1/0,Sc[0]=-1/0,Sc[1]=-1/0,Sc[2]=-1/0;for(let s=0;s<t;s++){const n=i(e[s]);lC(n[3])&&(QXe(Tc,n),JXe(Sc,n))}Cs(r,Tc,Sc,.5),r[3]=Math.max(Sc[0]-Tc[0],Sc[1]-Tc[1],Sc[2]-Tc[2])/2}}function KXe(e,t,i){if(!B_.length)for(let r=0;r<8;++r)B_.push({index:0,distance:0});for(let r=0;r<8;++r){const s=zve[r];B_.data[r].index=r,B_.data[r].distance=qy(e,t,s)}B_.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=B_.data[r].index}function Xz(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=qy(e,t,Qte[s]);n<i&&(i=n,r=Qte[s])}return r}function qy(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function lC(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}zr._pool=new as(zr),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(t2||(t2={}));const zve=[Le(-1,-1,-1),Le(1,-1,-1),Le(-1,1,-1),Le(1,1,-1),Le(-1,-1,1),Le(1,-1,1),Le(-1,1,1),Le(1,1,1)],Qte=[Le(-1,-1,-1),Le(-1,-1,1),Le(-1,1,-1),Le(-1,1,1),Le(1,-1,-1),Le(1,-1,1),Le(1,1,-1),Le(1,1,1)],kve=Math.sqrt(3),EG=[null];function eYe(e){return EG[0]=e,EG}const Yz=Vn(),lu=M(),Tc=M(),Sc=M(),Nv=new Vt,tYe=Vn(),jd=Vn(),Zz=Vn(),Qz=Vn(),d3=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],B_=new Vt,Jte=[0,0,0,0,0,0,0,0],md=t2;class Bve extends sM{constructor(t,i=""){var r,s,n;super(),this.apiLayerUid=i,this.type=Id.Layer,this.events=new qr,this.isSliceable=!1,this._objects=new Vt,this._stageHandles=new Jt,this.apiLayerUid=i,this.isVisible=(r=t==null?void 0:t.isVisible)==null||r,this.isPickable=(s=t==null?void 0:t.isPickable)==null||s,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:FS.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const i of ZXe)this._stageHandles.add(this.events.on(i,r=>t.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),_(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),_(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const i of t)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),_(this._octree)&&this._octree.add(t)}removeMany(t){const i=new Array;if(this._objects.removeUnorderedMany(t,t.length,i),i.length!==0){for(const r of i)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),_(this._octree)&&this._octree.remove(i)}}sync(){_(this._stage)&&this.updatePolicy!==FS.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,i){_(this._octree)&&this._octree.update(t,i)}getSpatialQueryAccelerator(){return C(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=ct(this._octree)}_createOctree(){this._octree=new md(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function cN(e){return _(e)&&e.type===Id.Layer}class Vve{constructor(t,i){this._material=t,this._repository=i,this._map=new Map}destroy(){this._map.forEach((t,i)=>{_(t)&&this._repository.release(this._material,Mb(i))})}load(t,i){this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,Mb(i)));const r=this._map.get(i);if(_(r)){if(r.ensureResources(t)===Pl.LOADED)return r;this._repository.requestRender()}return null}}function Mb(e){switch(e){case Ue.MATERIAL:return Q.Color;case Ue.MATERIAL_ALPHA:return Q.Alpha;case Ue.MATERIAL_DEPTH:return Q.Depth;case Ue.MATERIAL_NORMAL:return Q.Normal;case Ue.MATERIAL_DEPTH_SHADOWMAP_ALL:return Q.Shadow;case Ue.MATERIAL_HIGHLIGHT:return Q.Highlight;case Ue.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return Q.Shadow}}class $W extends U2{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Le(1,1,1),this.vvSizeMaxSize=Le(100,100,100),this.vvSizeOffset=Le(0,0,0),this.vvSizeFactor=Le(1,1,1),this.vvSizeValue=Le(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Qi()}}const Kte=8;function Gve(e,t){const i=e.vertex;i.uniforms.add(new ye("intrinsicWidth",F.Pass,r=>r.width)),t.vvSize?(e.attributes.add(A.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new ke("vvSizeMinSize",F.Pass,r=>r.vvSizeMinSize)),i.uniforms.add(new ke("vvSizeMaxSize",F.Pass,r=>r.vvSizeMaxSize)),i.uniforms.add(new ke("vvSizeOffset",F.Pass,r=>r.vvSizeOffset)),i.uniforms.add(new ke("vvSizeFactor",F.Pass,r=>r.vvSizeFactor)),i.code.add(T`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(A.SIZE,"float"),i.code.add(T`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(A.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new Po("vvOpacityValues",F.Pass,r=>r.vvOpacityValues,Kte)),i.uniforms.add(new Po("vvOpacityOpacities",F.Pass,r=>r.vvOpacityOpacities,Kte)),i.code.add(T`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(T`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(A.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",bd),i.uniforms.add(new Po("vvColorValues",F.Pass,r=>r.vvColorValues,bd)),i.uniforms.add(new b4("vvColorColors",F.Pass,r=>r.vvColorColors,bd)),i.code.add(T`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(A.COLOR,"vec4"),i.code.add(T`vec4 getColor(){
return applyOpacity(color);
}`))}function dv(e,t){e.fragment.include(mh),t.output===Q.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(T`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===Q.Depth&&e.fragment.code.add(T`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function iYe(e){return C(e)?Vm:e.length===4?e:Wi(rYe,e[0],e[1],e[2],1)}const rYe=ii();function jve(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?sYe(e,t):nYe(e)}function sYe(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:r,fragment:s}=e;s.include(mh),r.uniforms.add(new ye("stipplePatternPixelSize")),t.draped||(Md(r.uniforms,t),r.uniforms.add(new ye("worldToScreenPerDistanceRatio",F.Pass,(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(T`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),r.code.add(T`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${oYe};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(T`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(T`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new ye("pixelRatio",F.Pass,(n,o)=>o.camera.pixelRatio)),r.code.add(T`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?T`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new et("stipplePatternTexture")),s.uniforms.add(new ye("stipplePatternSDFNormalizer")),s.uniforms.add(new ye("stipplePatternTextureSize")),s.uniforms.add(new ye("stipplePatternPixelSizeInv")),s.code.add(T`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),s.code.add(T`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?T`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:T`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?T`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?T`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:T`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?T`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:T`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new dt("stippleOffColor",F.Pass,n=>iYe(n.stippleOffColor))),s.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function nYe(e){e.fragment.code.add(T`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const oYe=T.float(.4);var ih;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(ih||(ih={}));class Ir extends Io{constructor(){super(...arguments),this.output=Q.Color,this.capType=ih.BUTT,this.transparencyPassType=gt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}u([B({count:Q.COUNT})],Ir.prototype,"output",void 0),u([B({count:ih.COUNT})],Ir.prototype,"capType",void 0),u([B({count:gt.COUNT})],Ir.prototype,"transparencyPassType",void 0),u([B()],Ir.prototype,"occluder",void 0),u([B()],Ir.prototype,"hasSlicePlane",void 0),u([B()],Ir.prototype,"hasPolygonOffset",void 0),u([B()],Ir.prototype,"writeDepth",void 0),u([B()],Ir.prototype,"draped",void 0),u([B()],Ir.prototype,"stippleEnabled",void 0),u([B()],Ir.prototype,"stippleOffColorEnabled",void 0),u([B()],Ir.prototype,"stippleScaleWithLineWidth",void 0),u([B()],Ir.prototype,"stipplePreferContinuous",void 0),u([B()],Ir.prototype,"roundJoins",void 0),u([B()],Ir.prototype,"vvSize",void 0),u([B()],Ir.prototype,"vvColor",void 0),u([B()],Ir.prototype,"vvOpacity",void 0),u([B()],Ir.prototype,"falloffEnabled",void 0),u([B()],Ir.prototype,"innerColorEnabled",void 0),u([B()],Ir.prototype,"hasOccludees",void 0),u([B()],Ir.prototype,"hasMultipassTerrain",void 0),u([B()],Ir.prototype,"cullAboveGround",void 0),u([B()],Ir.prototype,"wireframe",void 0),u([B({constValue:!0})],Ir.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!0})],Ir.prototype,"stippleRequiresStretchMeasure",void 0),u([B({constValue:!0})],Ir.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],Ir.prototype,"hasSliceTranslatedView",void 0);const uN=1;function aYe(e){const t=new Fi;t.include(t4),t.include(Gve,e),t.include(jve,e),e.output===Q.Depth&&t.include(dv,e),Gc(t,e);const{vertex:i,fragment:r}=t;i.uniforms.add(new li("inverseProjectionMatrix",F.Pass,(p,f)=>f.camera.inverseProjectionMatrix)),i.uniforms.add(new Ft("nearFar",F.Pass,(p,f)=>f.camera.nearFar)),i.uniforms.add(new ye("miterLimit",F.Pass,p=>p.join!=="miter"?0:p.miterLimit)),i.uniforms.add(new dt("viewport",F.Pass,(p,f)=>f.camera.fullViewport)),i.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.SUBDIVISIONFACTOR,"float"),t.attributes.add(A.UV0,"vec2"),t.attributes.add(A.AUXPOS1,"vec3"),t.attributes.add(A.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.hasMultipassTerrain&&t.varyings.add("depth","float");const s=e.capType===ih.ROUND,n=e.stippleEnabled&&e.stippleScaleWithLineWidth||s;n&&t.varyings.add("vLineWidth","float");const o=e.stippleEnabled&&e.stippleScaleWithLineWidth;o&&t.varyings.add("vLineSizeInv","float");const a=e.innerColorEnabled||s;a&&t.varyings.add("vLineDistance","float");const l=e.stippleEnabled&&s,c=e.falloffEnabled||l;c&&t.varyings.add("vLineDistanceNorm","float"),s&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),i.code.add(T`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),i.code.add(T`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.hasMultipassTerrain?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),i.uniforms.add(new ye("pixelRatio",F.Pass,(p,f)=>f.camera.pixelRatio)),i.code.add(T`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${n?T`vLineWidth = lineWidth;`:""}
      ${o?T`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||s)&&i.code.add(T`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${s?T`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(T`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?i.code.add(T`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?T`min(1.0, subdivisionFactor * ${T.float((uN+2)/(uN+1))})`:T`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(T`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const h=e.capType!==ih.BUTT;return i.code.add(T`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${h?T`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(T`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${c||a?T`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${a?T`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${c?T`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),s&&i.code.add(T`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?i.uniforms.add(new ye("worldToScreenRatio",F.Pass,(p,f)=>1/f.screenToPCSRatio)):i.code.add(T`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(T`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?i.code.add(T`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(T`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(T`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),i.code.add(T`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),t.include(Qc,e),t.include(es,e),r.include(wf),r.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?r.code.add(T`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(s&&r.code.add(T`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${T.float(co)}) {
        discard;
      }
    `),l?r.code.add(T`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${T.float(co)}, stippleCoverage);
      `):r.code.add(T`float stippleAlpha = getStippleAlpha();`),r.uniforms.add(new dt("intrinsicColor",F.Pass,p=>p.color)),r.code.add(T`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(r.uniforms.add(new dt("innerColor",F.Pass,p=>Tt(p.innerColor,p.color))),r.uniforms.add(new ye("innerWidth",F.Pass,(p,f)=>p.innerWidth*f.camera.pixelRatio)),r.code.add(T`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),r.code.add(T`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(r.uniforms.add(new ye("falloff",F.Pass,p=>p.falloff)),r.code.add(T`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),r.code.add(T`
    if (finalColor.a < ${T.float(co)}) {
      discard;
    }

    ${e.output===Q.Alpha?T`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===Q.Color?T`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===Q.Color&&e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===Q.Highlight?T`gl_FragColor = vec4(1.0);`:""}
    ${e.output===Q.Depth?T`outputDepth(linearDepth);`:""}
  }
  `),t}const lYe=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:uN,build:aYe},Symbol.toStringTag,{value:"Module"})),DW={func:Ji.LESS},hN={func:Ji.ALWAYS},lf={mask:255},Hve={mask:0},cYe=e=>({function:{func:Ji.NOTEQUAL,ref:e,mask:e},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.KEEP}}),uYe=e=>({function:{func:Ji.ALWAYS,ref:e,mask:e},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.REPLACE}}),pv={function:{func:Ji.ALWAYS,ref:Za.OutlineVisualElementMask,mask:Za.OutlineVisualElementMask},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.ZERO}},tv={function:{func:Ji.ALWAYS,ref:Za.OutlineVisualElementMask,mask:Za.OutlineVisualElementMask},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.REPLACE}},qve={function:{func:Ji.EQUAL,ref:Za.OutlineVisualElementMask,mask:Za.OutlineVisualElementMask},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.KEEP}},Wve={function:{func:Ji.NOTEQUAL,ref:Za.OutlineVisualElementMask,mask:Za.OutlineVisualElementMask},operation:{fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.KEEP}},Xve=new Map([[A.POSITION,0],[A.SUBDIVISIONFACTOR,1],[A.UV0,2],[A.AUXPOS1,3],[A.AUXPOS2,4],[A.COLOR,5],[A.COLORFEATUREATTRIBUTE,5],[A.SIZE,6],[A.SIZEFEATUREATTRIBUTE,6],[A.OPACITYFEATUREATTRIBUTE,7]]);class I4 extends Ki{constructor(t,i,r){super(t,i,r),this.stippleTextureRepository=t.stippleTextureRepository}initializeProgram(t){const i=I4.shader.get().build(this.configuration);return new Gi(t.rctx,i,Xve)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}_makePipelineState(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:r.output===Q.Color||r.output===Q.Alpha?s?jc:Tg(t):null,depthTest:{func:hv(t)},depthWrite:s?r.writeDepth&&ol:w4(t),colorWrite:Qt,stencilWrite:r.hasOccludees?lf:null,stencilTest:r.hasOccludees?i?tv:pv:null,polygonOffset:s||n?r.hasPolygonOffset&&eie:T4})}initializePipeline(){const t=this.configuration;if(t.occluder){const i=t.hasPolygonOffset&&eie;this._occluderPipelineTransparent=Ut({blending:jc,polygonOffset:i,depthTest:hN,depthWrite:null,colorWrite:Qt,stencilWrite:null,stencilTest:Wve}),this._occluderPipelineOpaque=Ut({blending:jc,polygonOffset:i,depthTest:hN,depthWrite:null,colorWrite:Qt,stencilWrite:Hve,stencilTest:qve}),this._occluderPipelineMaskWrite=Ut({blending:null,polygonOffset:i,depthTest:DW,depthWrite:null,colorWrite:null,stencilWrite:lf,stencilTest:tv})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Dt.LINES:Dt.TRIANGLE_STRIP}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===we.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===we.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}I4.shader=new Vi(lYe,()=>import("./RibbonLine.glsl.4553170e.js"));const eie={factor:0,units:-4},hYe=pe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var Sl;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(Sl||(Sl={}));class yT extends Tf{constructor(t){super(t,new pYe),this._vertexAttributeLocations=Xve,this.techniqueConfig=new Ir,this.layout=this.createLayout()}isClosed(t,i){return Yve(this.parameters,t,i)}getConfiguration(t,i){this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===we.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern)&&t!==Q.Highlight;return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&_(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===wr.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedLineGeometry(t,s,c,o,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectDrapedLineGeometry(t,i,r,s,n){if(!i.options.selectionMode)return;const o=t.vertexAttributes.get(A.POSITION).data,a=t.vertexAttributes.get(A.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const y=t.vertexAttributes.get(A.SIZEFEATUREATTRIBUTE).data[0];l*=He(this.parameters.vvSizeOffset[0]+y*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=s[0],h=s[1],p=(l/2+4)*t.screenToWorldRatio;let f=Number.MAX_VALUE,g=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],b=o[y+1],w=c-v,S=h-b,x=o[y+3]-v,E=o[y+4]-b,R=He((x*w+E*S)/(x*x+E*E),0,1),O=x*R-w,I=E*R-S,U=O*O+I*I;U<f&&(f=U,g=y/3)}f<p*p&&n(r.dist,r.normal,g,!1)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||nM(i))return;if(!tye(r))return void hYe.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes,a=o.get(A.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const w=o.get(A.SIZEFEATUREATTRIBUTE).data[0];l*=He(this.parameters.vvSizeOffset[0]+w*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(A.SIZE)&&(l*=o.get(A.SIZE).data[0]);const c=s.camera,h=mYe;Bn(h,s.point);const p=l*c.pixelRatio/2+4*c.pixelRatio;se(RE[0],h[0]-p,h[1]+p,0),se(RE[1],h[0]+p,h[1]+p,0),se(RE[2],h[0]+p,h[1]-p,0),se(RE[3],h[0]-p,h[1]-p,0);for(let w=0;w<4;w++)if(!c.unprojectFromRenderScreen(RE[w],Lf[w]))return;Oo(c.eye,Lf[0],Lf[1],Kz),Oo(c.eye,Lf[1],Lf[2],ek),Oo(c.eye,Lf[2],Lf[3],tk),Oo(c.eye,Lf[3],Lf[0],ik);let f=Number.MAX_VALUE,g=0;const y=AG(this.parameters,o,t.indices)?a.length-2:a.length-5;for(let w=0;w<y;w+=3){Ea[0]=a[w]+r[12],Ea[1]=a[w+1]+r[13],Ea[2]=a[w+2]+r[14];const S=(w+3)%a.length;if(Aa[0]=a[S]+r[12],Aa[1]=a[S+1]+r[13],Aa[2]=a[S+2]+r[14],mr(Kz,Ea)<0&&mr(Kz,Aa)<0||mr(ek,Ea)<0&&mr(ek,Aa)<0||mr(tk,Ea)<0&&mr(tk,Aa)<0||mr(ik,Ea)<0&&mr(ik,Aa)<0)continue;if(c.projectToRenderScreen(Ea,Uv),c.projectToRenderScreen(Aa,zv),Uv[2]<0&&zv[2]>0){de(Hd,Ea,Aa);const E=c.frustum,R=-mr(E[cr.NEAR],Ea)/Se(Hd,E[cr.NEAR]);oe(Hd,Hd,R),fe(Ea,Ea,Hd),c.projectToRenderScreen(Ea,Uv)}else if(Uv[2]>0&&zv[2]<0){de(Hd,Aa,Ea);const E=c.frustum,R=-mr(E[cr.NEAR],Aa)/Se(Hd,E[cr.NEAR]);oe(Hd,Hd,R),fe(Aa,Aa,Hd),c.projectToRenderScreen(Aa,zv)}else if(Uv[2]<0&&zv[2]<0)continue;Uv[2]=0,zv[2]=0;const x=Wj(F1(Uv,zv,rie),h);x<f&&(f=x,ne(tie,Ea),ne(iie,Aa),g=w/3)}const v=s.rayBegin,b=s.rayEnd;if(f<p*p){let w=Number.MAX_VALUE;if(Gue(F1(tie,iie,rie),F1(v,b,gYe),Fv)){de(Fv,Fv,v);const S=Ie(Fv);oe(Fv,Fv,1/S),w=S/Yi(v,b)}n(w,Fv,g,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=t.indices,n=r.get(A.POSITION);return zq(n,s?s.get(A.POSITION):null,s&&AG(this.parameters,r,s),i)}createLayout(){const t=ls().vec3f(A.POSITION).f32(A.SUBDIVISIONFACTOR).vec2f(A.UV0).vec3f(A.AUXPOS1).vec3f(A.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(A.SIZEFEATUREATTRIBUTE):t.f32(A.SIZE),this.parameters.vvColorEnabled?t.f32(A.COLORFEATUREATTRIBUTE):t.vec4f(A.COLOR),this.parameters.vvOpacityEnabled&&t.f32(A.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new fYe(this.layout,this.parameters)}requiresSlot(t,i){if(t===we.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===wr.OccludeAndTransparentStencil)return t===we.OPAQUE_MATERIAL||t===we.OCCLUDER_MATERIAL||t===we.TRANSPARENT_OCCLUDER_MATERIAL;const r=Mb(i);return r===Q.Color||r===Q.Alpha?t===(this.parameters.writeDepth?we.TRANSPARENT_MATERIAL:we.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===we.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===Q.Color||t.output===Q.Alpha||t.output===Q.Highlight||t.output===Q.Depth?new dYe(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0)}}class dYe extends cv{_updateParameters(t){return this.ensureTechnique(I4,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==Q.Color&&this._output!==Q.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class pYe extends $W{constructor(){super(...arguments),this.width=0,this.color=Wu,this.join="miter",this.cap=ih.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class fYe{constructor(t,i){this.parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const r=i.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=uN+r}}_isClosed(t){return AG(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const r=t.indices.get(A.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(t,i,r,s){var n;const o=yYe,a=vYe,l=_Ye,c=i.vertexAttributes.get(A.POSITION).data,h=i.indices&&i.indices.get(A.POSITION),p=(n=i.vertexAttributes.get(A.DISTANCETOSTART))==null?void 0:n.data;h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,g=0;this.parameters.vvSizeEnabled?g=i.vertexAttributes.get(A.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(A.SIZE)&&(f=i.vertexAttributes.get(A.SIZE).data[0]);let y=[1,1,1,1],v=0;this.parameters.vvColorEnabled?v=i.vertexAttributes.get(A.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(A.COLOR)&&(y=i.vertexAttributes.get(A.COLOR).data);let b=0;this.parameters.vvOpacityEnabled&&(b=i.vertexAttributes.get(A.OPACITYFEATUREATTRIBUTE).data[0]);const w=c.length/3,S=t.transformation,x=new Float32Array(r.buffer),E=this.vertexBufferLayout.stride/4;let R=s*E;const O=R;let I=0;const U=p?(J,K,he)=>I=p[he]:(J,K,he)=>I+=Yi(J,K),N=(J,K,he,le,$,z,k)=>{if(x[R++]=K[0],x[R++]=K[1],x[R++]=K[2],x[R++]=le,x[R++]=k,x[R++]=$,x[R++]=J[0],x[R++]=J[1],x[R++]=J[2],x[R++]=he[0],x[R++]=he[1],x[R++]=he[2],this.parameters.vvSizeEnabled?x[R++]=g:x[R++]=f,this.parameters.vvColorEnabled)x[R++]=v;else{const G=Math.min(4*z,y.length-4);x[R++]=y[G+0],x[R++]=y[G+1],x[R++]=y[G+2],x[R++]=y[G+3]}this.parameters.vvOpacityEnabled&&(x[R++]=b)};R+=E,se(a,c[0],c[1],c[2]),S&&Fe(a,a,S);const V=this._isClosed(i);if(V){const J=c.length-3;se(o,c[J],c[J+1],c[J+2]),S&&Fe(o,o,S)}else se(l,c[3],c[4],c[5]),S&&Fe(l,l,S),N(a,a,l,1,Sl.LEFT_CAP_START,0,0),N(a,a,l,1,Sl.RIGHT_CAP_START,0,0),ne(o,a),ne(a,l);const j=V?0:1,H=V?w:w-1;for(let J=j;J<H;J++){const K=(J+1)%w*3;se(l,c[K+0],c[K+1],c[K+2]),S&&Fe(l,l,S),U(o,a,J),N(o,a,l,0,Sl.LEFT_JOIN_END,J,I),N(o,a,l,0,Sl.RIGHT_JOIN_END,J,I);const he=this.numJoinSubdivisions;for(let le=0;le<he;++le){const $=(le+1)/(he+1);N(o,a,l,$,Sl.LEFT_JOIN_END,J,I),N(o,a,l,$,Sl.RIGHT_JOIN_END,J,I)}N(o,a,l,1,Sl.LEFT_JOIN_START,J,I),N(o,a,l,1,Sl.RIGHT_JOIN_START,J,I),ne(o,a),ne(a,l)}V?(se(l,c[3],c[4],c[5]),S&&Fe(l,l,S),I=U(o,a,H),N(o,a,l,0,Sl.LEFT_JOIN_END,j,I),N(o,a,l,0,Sl.RIGHT_JOIN_END,j,I)):(I=U(o,a,H),N(o,a,a,0,Sl.LEFT_CAP_END,H,I),N(o,a,a,0,Sl.RIGHT_CAP_END,H,I)),Jz(x,O+E,x,O,E),R=Jz(x,R-E,x,R,E),this.parameters.wireframe&&this._addWireframeVertices(r,O,R,E)}_addWireframeVertices(t,i,r,s){const n=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=Jz(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function Jz(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function AG(e,t,i){return Yve(e,t.get(A.POSITION).data,i?i.get(A.POSITION):null)}function Yve(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const Ea=M(),Aa=M(),Hd=M(),Fv=M(),mYe=M(),Uv=no(),zv=no(),tie=M(),iie=M(),rie=nv(),gYe=nv(),yYe=M(),vYe=M(),_Ye=M(),RE=[no(),no(),no(),no()],Lf=[M(),M(),M(),M()],Kz=fi(),ek=fi(),tk=fi(),ik=fi();class LW{constructor(t,i=125e4){this._originSR=t,this._gridSize=i,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Xa()}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(i==null){if(_(p3))return this._origins.set(this._rootOriginId,KC(p3[0],p3[1],p3[2],this._rootOriginId)),this.getOrigin(t);const h=KC(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,h),h}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),o=Math.round(t[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(de(_n,t,i.vec3),_n[0]=Math.abs(_n[0]),_n[1]=Math.abs(_n[1]),_n[2]=Math.abs(_n[2]),_n[0]<c&&_n[1]<c&&_n[2]<c){if(l){const h=Math.max(..._n);if(de(_n,t,l.vec3),_n[0]=Math.abs(_n[0]),_n[1]=Math.abs(_n[1]),_n[2]=Math.abs(_n[2]),Math.max(..._n)<h)return l}return i}return l||(l=KC(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(t,i=ri(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new yT({width:2,color:i}),s.add(this._material);const g=new Bve({isPickable:!1}),y=new Eg({castShadow:!1});s.add(y),g.add(y),s.add(g),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Uint16Array(2*(l-1)),p=.5*this._gridSize;for(let g=0;g<l;g++)c[3*g+0]=t[0]+(1&a[g]?p:-p),c[3*g+1]=t[1]+(2&a[g]?p:-p),c[3*g+2]=t[2]+(4&a[g]?p:-p),g>0&&(h[2*g+0]=g-1,h[2*g+1]=g);Pr(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new Ar([[A.POSITION,{size:3,data:c,exclusive:!0}]],[[A.POSITION,h]],Qa.Line);s.add(f),o.addGeometry(f,this._material,Es)}}let p3=null;const _n=M();class Zve{constructor(t,i,r,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new Di,this.pass=Ue.MATERIAL,this.renderOccludedMask=sie,this.bindParameters=new o4(i,r,_(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=sie}get isHighlightPass(){return this.pass===Ue.MATERIAL_HIGHLIGHT}}class bYe extends Zve{constructor(t,i,r,s,n){super(t,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n}}const sie=wr.Occlude|wr.OccludeAndTransparent|wr.OccludeAndTransparentStencil;var i2;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(i2||(i2={}));class f3{constructor(){this.camera=new Di,this.lightMat=Ae()}}class NW{constructor(t,i,r=0){this.rctx=t,this.viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=ii(),this._cascades=[new f3,new f3,new f3,new f3],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=r}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return Wi(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=He(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&_(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const i=this._snapshots.length;if(t>i){const r=t-i;this._snapshots.length=t;for(let s=0;s<r;++s)this._snapshots[i+s]=null}else if(t<this.snapshotCount){const r=i-t;for(let s=0;s<r;++s)this._discardSnapshot(t+s);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)sk[t]=this._cascades[t];return sk.length=this.numCascades,sk}start(t,i,r){ht(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(t,i);const o=t.viewMatrix,a=t.projectionMatrix;for(let l=0;l<this.numCascades;++l)this._constructCascade(l,a,o,i);this.lastOrigin=null,this.clear()}finish(t){ht(this.enabled),this.rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this.lastOrigin||!da(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||M(),ne(this.lastOrigin,t);for(let i=0;i<this.numCascades;++i){ga(fie,this._cascades[i].lightMat,t);for(let r=0;r<16;++r)mie[16*i+r]=fie[r]}}return mie}takeCascadeSnapshotTo(t,i){ht(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this.rctx,n=s.bindTexture(r,ot.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(pt.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,ot.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(ki.COLOR_BUFFER_BIT|ki.DEPTH_BUFFER_BIT)}_computeTextureSize(t,i){const r=.5*Math.log(t*t+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(_(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new ot(this.rctx,t),this._fbo=new hr(this.rctx,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let i=this._snapshots[t];if(_(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(t);const r={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new ot(this.rctx,r),this._snapshots[t]=i,i}_discardDepthTexture(){this._fbo=it(this._fbo),this._depthTexture=it(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=it(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,i,r,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);ht(l<c);for(let p=0;p<8;++p){Wi(lie,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:c,1),Lc(wl[p],lie,aie);for(let f=0;f<3;++f)wl[p][f]/=wl[p][3]}Do(rk,wl[0]),ga(nie,pie,rk),n.camera.viewMatrix=nie;for(let p=0;p<8;++p)Fe(wl[p],wl[p],n.camera.viewMatrix);ne(qd,wl[0]),ne(Wd,wl[0]);for(let p=1;p<8;++p)for(let f=0;f<3;++f)qd[f]=Math.min(qd[f],wl[p][f]),Wd[f]=Math.max(Wd[f],wl[p][f]);qd[2]-=200,Wd[2]+=200,n.camera.near=-Wd[2],n.camera.far=-qd[2],this.warp?this._constructTrapezoidalProjection(r,s,n):this._constructOrthogonalProjection(n),xr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureSize/2;n.camera.viewport[0]=t%2==0?0:h,n.camera.viewport[1]=Math.floor(t/2)===0?0:h,n.camera.viewport[2]=h,n.camera.viewport[3]=h}_constructOrthogonalProjection(t){$j(t.camera.projectionMatrix,qd[0],Wd[0],qd[1],Wd[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,i,r){const s=1/wl[0][3],n=1/wl[4][3];ht(s<n);let o=s+Math.sqrt(s*n);const a=Math.sin(Hs(t[2]*i[0]+t[6]*i[1]+t[10]*i[2]));o/=a,xYe(wl,o,a,cie,uie,wYe,hie,die),TYe(cie,uie,hie,die,r.camera.projectionMatrix),r.camera.projectionMatrix[10]=2/(qd[2]-Wd[2]),r.camera.projectionMatrix[14]=-(qd[2]+Wd[2])/(qd[2]-Wd[2])}_setupMatrices(t,i){xr(oie,t.projectionMatrix,t.viewMatrix),jr(aie,oie);const r=this.viewingMode===je.Global?t.eye:se(rk,0,0,1);yF(pie,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(t){let{near:i,far:r}=t;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(t,i){this.numCascades=Math.min(1+Math.floor(q8e(t/i,4)),this.maxNumCascades);const r=(t-i)/this.numCascades,s=(t/i)**(1/this.numCascades);let n=i,o=i;for(let a=0;a<this.numCascades+1;++a)this._cascadeDistances[a]=ti(n,o,this.splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var t,i;return this._snapshots.reduce((r,s)=>r+R0(s),(t=(i=this._fbo)==null?void 0:i.gpuMemoryUsage)!=null?t:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){t.splitSchemeLambda=i},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(i){t.warp=i},get warp(){return t.warp}}}}const nie=Ae(),oie=Ae(),aie=Ae(),lie=ii(),wl=[];for(let e=0;e<8;++e)wl.push(ii());const qd=M(),Wd=M(),cie=lt(),uie=lt(),wYe=lt(),hie=lt(),die=lt(),pie=Ae(),rk=M(),sk=[],fie=Ae(),mie=new Float32Array(64),sc=lt(),Mw=lt(),kv=[lt(),lt(),lt(),lt()],Ws=lt(),nk=lt(),Vg=lt(),OE=lt(),Pw=lt(),Iw=lt(),m3=lt();function xYe(e,t,i,r,s,n,o,a){Li(sc,0,0);for(let R=0;R<4;++R)id(sc,sc,e[R]);Fl(sc,sc,.25),Li(Mw,0,0);for(let R=4;R<8;++R)id(Mw,Mw,e[R]);Fl(Mw,Mw,.25),Bx(kv[0],e[4],e[5],.5),Bx(kv[1],e[5],e[6],.5),Bx(kv[2],e[6],e[7],.5),Bx(kv[3],e[7],e[4],.5);let l=0,c=$L(kv[0],sc);for(let R=1;R<4;++R){const O=$L(kv[R],sc);O<c&&(c=O,l=R)}Up(Ws,kv[l],e[l+4]);const h=Ws[0];let p,f;Ws[0]=-Ws[1],Ws[1]=h,Up(nk,Mw,sc),Ls(nk,Ws)<0&&fq(Ws,Ws),Bx(Ws,Ws,nk,i),zR(Ws,Ws),p=f=Ls(Up(Vg,e[0],sc),Ws);for(let R=1;R<8;++R){const O=Ls(Up(Vg,e[R],sc),Ws);O<p?p=O:O>f&&(f=O)}Bn(r,sc),Fl(Vg,Ws,p-t),id(r,r,Vg);let g=-1,y=1,v=0,b=0;for(let R=0;R<8;++R){Up(OE,e[R],r),zR(OE,OE);const O=Ws[0]*OE[1]-Ws[1]*OE[0];O>0?O>g&&(g=O,v=R):O<y&&(y=O,b=R)}_w(g>0,"leftArea"),_w(y<0,"rightArea"),Fl(Pw,Ws,p),id(Pw,Pw,sc),Fl(Iw,Ws,f),id(Iw,Iw,sc),m3[0]=-Ws[1],m3[1]=Ws[0];const w=IP(r,e[b],Iw,id(Vg,Iw,m3),1,s),S=IP(r,e[v],Iw,Vg,1,n),x=IP(r,e[v],Pw,id(Vg,Pw,m3),1,o),E=IP(r,e[b],Pw,Vg,1,a);_w(w,"rayRay"),_w(S,"rayRay"),_w(x,"rayRay"),_w(E,"rayRay")}function ci(e,t){return 3*t+e}const gie=lt();function hl(e,t){return Li(gie,e[t],e[t+3]),gie}const Ca=lt(),Ze=Qi();function TYe(e,t,i,r,s){Up(Ca,i,r),Fl(Ca,Ca,.5),Ze[0]=Ca[0],Ze[1]=Ca[1],Ze[2]=0,Ze[3]=Ca[1],Ze[4]=-Ca[0],Ze[5]=0,Ze[6]=Ca[0]*Ca[0]+Ca[1]*Ca[1],Ze[7]=Ca[0]*Ca[1]-Ca[1]*Ca[0],Ze[8]=1,Ze[ci(0,2)]=-Ls(hl(Ze,0),e),Ze[ci(1,2)]=-Ls(hl(Ze,1),e);let n=Ls(hl(Ze,0),i)+Ze[ci(0,2)],o=Ls(hl(Ze,1),i)+Ze[ci(1,2)],a=Ls(hl(Ze,0),r)+Ze[ci(0,2)],l=Ls(hl(Ze,1),r)+Ze[ci(1,2)];n=-(n+a)/(o+l),Ze[ci(0,0)]+=Ze[ci(1,0)]*n,Ze[ci(0,1)]+=Ze[ci(1,1)]*n,Ze[ci(0,2)]+=Ze[ci(1,2)]*n,n=1/(Ls(hl(Ze,0),i)+Ze[ci(0,2)]),o=1/(Ls(hl(Ze,1),i)+Ze[ci(1,2)]),Ze[ci(0,0)]*=n,Ze[ci(0,1)]*=n,Ze[ci(0,2)]*=n,Ze[ci(1,0)]*=o,Ze[ci(1,1)]*=o,Ze[ci(1,2)]*=o,Ze[ci(2,0)]=Ze[ci(1,0)],Ze[ci(2,1)]=Ze[ci(1,1)],Ze[ci(2,2)]=Ze[ci(1,2)],Ze[ci(1,2)]+=1,n=Ls(hl(Ze,1),t)+Ze[ci(1,2)],o=Ls(hl(Ze,2),t)+Ze[ci(2,2)],a=Ls(hl(Ze,1),i)+Ze[ci(1,2)],l=Ls(hl(Ze,2),i)+Ze[ci(2,2)],n=-.5*(n/o+a/l),Ze[ci(1,0)]+=Ze[ci(2,0)]*n,Ze[ci(1,1)]+=Ze[ci(2,1)]*n,Ze[ci(1,2)]+=Ze[ci(2,2)]*n,n=Ls(hl(Ze,1),t)+Ze[ci(1,2)],o=Ls(hl(Ze,2),t)+Ze[ci(2,2)],a=-o/n,Ze[ci(1,0)]*=a,Ze[ci(1,1)]*=a,Ze[ci(1,2)]*=a,s[0]=Ze[0],s[1]=Ze[1],s[2]=0,s[3]=Ze[2],s[4]=Ze[3],s[5]=Ze[4],s[6]=0,s[7]=Ze[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Ze[6],s[13]=Ze[7],s[14]=0,s[15]=Ze[8]}class Qve{constructor(){this.adds=new Vt,this.removes=new Vt,this.updates=new Vt({allocator:t=>t||new SYe,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class SYe{}class EYe{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var Yt;(function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"})(Yt||(Yt={}));function Jve(e){const t=new Map,i=r=>{let s=t.get(r);return s||(s=new EYe,t.set(r,s)),s};return e.removes.forAll(r=>{ok(r)&&i(r.material).removes.push(r)}),e.adds.forAll(r=>{ok(r)&&i(r.material).adds.push(r)}),e.updates.forAll(r=>{ok(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),t}function ok(e){return e.data.indexCount>=1}function AYe(e){const t=T`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function $4(e,t){t.normalType===gr.Attribute&&(e.attributes.add(A.NORMAL,"vec3"),e.vertex.code.add(T`vec3 normalModel() {
return normal;
}`)),t.normalType===gr.CompressedAttribute&&(e.include(AYe),e.attributes.add(A.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(T`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===gr.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(T`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var gr;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(gr||(gr={}));function D4(e){e.attributes.add(A.POSITION,"vec3"),e.vertex.code.add(T`vec3 positionModel() { return position; }`)}function dN({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(T`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(T`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function fM(e){return!!ue("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function VT(e,t){e.include(D4);const i=e.vertex;i.include(dN,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add(new ke("transformWorldFromViewTH",F.Pass,r=>r.transformWorldFromViewTH)),i.uniforms.add(new ke("transformWorldFromViewTL",F.Pass,r=>r.transformWorldFromViewTL)),i.uniforms.add(new qp("transformViewFromCameraRelativeRS",F.Pass,r=>r.transformViewFromCameraRelativeRS)),i.uniforms.add(new li("transformProjFromView",F.Pass,r=>r.transformProjFromView)),i.uniforms.add([new qp("transformWorldFromModelRS",F.Draw,r=>r.transformWorldFromModelRS),new ke("transformWorldFromModelTH",F.Draw,r=>r.transformWorldFromModelTH),new ke("transformWorldFromModelTL",F.Draw,r=>r.transformWorldFromModelTL)]),i.code.add(T`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}
vec3 positionView() {
return transformViewFromCameraRelativeRS * positionWorldCameraRelative();
}
void forwardPosition() {
vPositionWorldCameraRelative = positionWorldCameraRelative();
vPosition_view = positionView();
gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
}
vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.uniforms.add(new ke("transformWorldFromViewTL",F.Pass,r=>r.transformWorldFromViewTL)),e.fragment.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class Kve{constructor(){this.transformWorldFromViewTH=M(),this.transformWorldFromViewTL=M(),this.transformViewFromCameraRelativeRS=Qi(),this.transformProjFromView=Ae()}}class e_e extends qs{constructor(){super(...arguments),this.transformWorldFromModelRS=Qi(),this.transformWorldFromModelTH=vi(),this.transformWorldFromModelTL=vi()}}function L4(e,t){if(t.normalType===gr.Attribute||t.normalType===gr.CompressedAttribute){e.include($4,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3");const i=e.vertex.uniforms;i.add(new qp("transformNormalGlobalFromModel",F.Draw,r=>r.transformNormalGlobalFromModel)),i.add(new qp("transformNormalViewFromGlobal",F.Pass,r=>r.transformNormalViewFromGlobal)),e.vertex.code.add(T`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)}else t.normalType===gr.Ground?(e.include(VT,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(T`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?T`normalize(vPositionWorldCameraRelative);`:T`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(T`void forwardNormal() {}`)}class t_e extends Kve{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Qi()}}class i_e extends e_e{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Qi(),this.toMapSpace=ii()}}class r_e extends i_e{constructor(t=M()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function CYe(e){e.fragment.code.add(T`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function RYe(e){e.fragment.code.add(T`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function yie(e){e.fragment.uniforms.add(new et("texWaveNormal")),e.fragment.uniforms.add(new et("texWavePerturbation")),e.fragment.uniforms.add(new dt("waveParams")),e.fragment.uniforms.add(new Ft("waveDirection")),e.include(CYe),e.fragment.code.add(T`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}function OYe(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity),e.setUniform1f("timeElapsed",t.timeElapsed)}function mM(e,t){t.output===Q.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(T`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===Q.Depth||t.output===Q.Shadow?(e.include(VT,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new Ft("nearFar",F.Pass,(i,r)=>r.camera.nearFar)),e.vertex.code.add(T`void forwardLinearDepth() {
linearDepth = (-positionView().z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(T`void forwardLinearDepth() {}`)}function v0(e,t){t.spherical?e.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class z2 extends eu{constructor(t,i,r){switch(i){case F.Pass:return void super(t,"int",i,(s,n,o)=>s.setUniform1i(t,r(n,o)));case F.Draw:return void super(t,"int",i,(s,n,o)=>s.setUniform1i(t,r(n,o)));default:super(t,"int")}}}class s_e extends eu{constructor(t,i,r,s){switch(i){case F.Pass:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s);case F.Draw:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s)}}}class n_e extends qs{constructor(){super(...arguments),this.origin=M()}}function N4(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new s_e("shadowMapMatrix",F.Pass,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),o_e(e))}function Pb(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new s_e("shadowMapMatrix",F.Draw,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),o_e(e))}function o_e(e){const t=e.fragment;t.include(mh),t.uniforms.add([new et("shadowMapTex",F.Pass,(i,r)=>r.shadowMap.depthTexture),new z2("numCascades",F.Pass,(i,r)=>r.shadowMap.numCascades),new dt("cascadeDistances",F.Pass,(i,r)=>r.shadowMap.cascadeDistances),new ye("depthHalfPixelSz",F.Pass,(i,r)=>.5/r.shadowMap.textureSize)]),t.code.add(T`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function MYe(e){const t=e.fragment.code;t.add(T`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(T`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(T`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function F4(e,t){const i=e.fragment.code;e.include(t4),t.pbrMode===Mt.Water||t.pbrMode===Mt.WaterOnIntegratedMesh?(i.add(T`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(T`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(T`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(T`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(T`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==Mt.Normal&&t.pbrMode!==Mt.Schematic||(e.include(MYe),i.add(T`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(T`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(T`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(T`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(T`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(T`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function a_e(e,t){e.include(F4,t),e.include(KF),e.include(RYe),t.hasCloudsReflections&&e.include(Uge,t),t.hasScreenSpaceReflections&&e.include(b8e,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(T`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new ye("lightingSpecularStrength",F.Pass,(r,s)=>s.lighting.mainLight.specularStrength),new ye("lightingEnvironmentStrength",F.Pass,(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(T`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(T`vec4 cloudsColor = crossFade == 0 ? renderCloud(reflectedWorld, position) : renderCloudCrossFade(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * (1.0 - totalFadeInOut);`),t.hasScreenSpaceReflections?i.code.add(T`vec4 viewPosition = vec4(positionView.xyz, 1.0);
vec3 viewDir = normalize(viewPosition.xyz);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(T`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(T`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor;
}`)}function PYe(e){const t=new Fi,i=Gc(t,e);return t.include(ao),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.UV0,"vec2"),t.vertex.uniforms.add(new dt("waterColor")),e.output!==Q.Color&&e.output!==Q.Alpha||(t.include(v0,e),t.include(mM,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),t.fragment.uniforms.add(i),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.vertex.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(co)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===Q.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(Qc,e),e.output===Q.Alpha&&(t.include(es,e),t.fragment.uniforms.add(new dt("waterColor")),t.fragment.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===Q.Color&&(t.include(Aq,{pbrMode:Mt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(yie),t.include(es,e),t.include(Pb,e),t.include(a_e,e),t.fragment.uniforms.add([new dt("waterColor"),new ke("lightingMainDirection",F.Pass,(r,s)=>s.lighting.lightingMainDirection),new ke("lightingMainIntensity",F.Pass,(r,s)=>s.lighting.mainLight.intensity),new ye("timeElapsed"),new li("view")]),Md(t.fragment.uniforms,e),t.fragment.include(wf),t.fragment.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?T`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===Q.Normal&&(t.include(v0,e),t.include(yie,e),t.include(es,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(co)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add(new ye("timeElapsed")),t.fragment.code.add(T`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===Q.Draped&&(t.varyings.add("vpos","vec3"),t.vertex.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(co)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),t.fragment.uniforms.add(new dt("waterColor")),t.fragment.code.add(T`void main() {
gl_FragColor = waterColor;
}`)),e.output===Q.Highlight&&(t.include(xg),t.varyings.add("vpos","vec3"),t.vertex.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(co)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(es,e),t.fragment.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const IYe=Object.freeze(Object.defineProperty({__proto__:null,build:PYe},Symbol.toStringTag,{value:"Module"}));class U4 extends Ki{constructor(t,i,r){super(t,i,r),this._textureRepository=t.waterTextureRepository}initializeConfiguration(t,i){i.spherical=t.viewingMode===je.Global,i.doublePrecisionRequiresObfuscation=fM(t.rctx)}initializeProgram(t){const i=U4.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}bindPass(t,i){this.program.bindPass(t,i),this.configuration.output===Q.Color&&this.configuration.hasCloudsReflections&&_(i.cloudsComposition)&&kge(this.program,i.camera,i.cloudsComposition),this.configuration.output!==Q.Color&&this.configuration.output!==Q.Normal||(OYe(this.program,t),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",t.color)}_setPipelineState(t){const i=this.configuration,r=t===gt.NONE,s=t===gt.FrontFace;return Ut({blending:i.output!==Q.Normal&&i.output!==Q.Highlight&&i.transparent?r?jc:Tg(t):null,depthTest:{func:hv(t)},depthWrite:r?i.writeDepth&&ol:w4(t),colorWrite:Qt,polygonOffset:r||s?null:S4(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}U4.shader=new Vi(IYe,()=>import("./WaterSurface.glsl.c596b52e.js"));class An extends Io{constructor(){super(...arguments),this.output=Q.Color,this.transparencyPassType=gt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([B({count:Q.COUNT})],An.prototype,"output",void 0),u([B({count:gt.COUNT})],An.prototype,"transparencyPassType",void 0),u([B()],An.prototype,"spherical",void 0),u([B()],An.prototype,"receiveShadows",void 0),u([B()],An.prototype,"hasSlicePlane",void 0),u([B()],An.prototype,"transparent",void 0),u([B()],An.prototype,"enableOffset",void 0),u([B()],An.prototype,"writeDepth",void 0),u([B()],An.prototype,"hasScreenSpaceReflections",void 0),u([B()],An.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],An.prototype,"isDraped",void 0),u([B()],An.prototype,"hasMultipassTerrain",void 0),u([B()],An.prototype,"cullAboveGround",void 0),u([B({constValue:Mt.Water})],An.prototype,"pbrMode",void 0),u([B({constValue:!0})],An.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!0})],An.prototype,"highStepCount",void 0),u([B({constValue:ue("enable-feature:clouds-reflections")})],An.prototype,"hasCloudsReflections",void 0),u([B({constValue:!1})],An.prototype,"useFillLights",void 0);class vie extends cv{_updateParameters(t){return this.ensureTechnique(U4,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}ensureResources(t){const i=this._techniqueRepository.constructionContext.waterTextureRepository;return i.resourceState===Pl.NOT_LOADED&&i.loadTextures(t),i.resourceState}beginSlot(t){return this._output===Q.Color&&(this._updateShadowState(t),this._updateSSRState(t)),this._updateParameters(t)}}const $Ye=ls().vec3f(A.POSITION),DYe=ls().vec3f(A.POSITION).vec2f(A.UV0),l_e=ls().vec3f(A.POSITION).vec4u8(A.COLOR);class z4{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(A.POSITION).length}write(t,i,r,s){_4(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}class c_e extends Tf{constructor(t){super(t,new u_e),this._techniqueConfig=new An,this.animation=new nye}getConfiguration(t,i){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=i.transparencyPassType,this._techniqueConfig.enableOffset=i.camera.relativeElevation<x4,this._techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<LYe;const r=this.animation.advance(t);return this.setParameters({timeElapsed:S7(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}intersect(t,i,r,s,n,o,a){y4(t,i,s,n,o,void 0,a)}requiresSlot(t,i){switch(Mb(i)){case Q.Normal:return t===we.DRAPED_WATER;case Q.Color:if(this.parameters.isDraped)return t===we.DRAPED_MATERIAL;break;case Q.Highlight:return t===we.OPAQUE_MATERIAL||t===we.DRAPED_MATERIAL}let r=we.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?we.TRANSPARENT_MATERIAL:we.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===r}createGLMaterial(t){if(t.output===Q.Color&&this.parameters.isDraped)return t.output=Q.Draped,new vie(t);switch(t.output){case Q.Color:case Q.Normal:case Q.Highlight:case Q.Alpha:return new vie(t)}return null}createBufferWriter(){return new z4(DYe)}}class u_e extends U2{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Oi(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=ri(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1}}const LYe=35e3;class _ie{constructor(t){this.first=t.from,this.count=t.to-t.from}}class Gx{constructor(t=0,i=0){this.from=t,this.to=i}}class NYe extends Gx{constructor(t,i,r,s,n,o){super(i,r),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=o}}function bie(e){return Array.from(e.values()).sort(FYe)}function FYe(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function g3(e,t){if(e.length===0)return void e.push(new _ie(t));const i=e[e.length-1];if(UYe(i,t)){const r=t.from-i.first+t.to-t.from;i.count=r}else e.push(new _ie(t))}function UYe(e,t){return e.first+e.count>=t.from}class zYe{constructor(t,i){this._pool=t,this._size=0,this._buffer=t.newBuffer(CG(i))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,i){let r;const s=kYe(this._buffer.length,this._size,t);if(this._buffer.length!==s){const o=this._pool.newBuffer(s);i&&(o.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),o.vao.vertexBuffers.geometry.setSubData(o.array,0,0,o.array.byteLength)),r=this._buffer,this._buffer=o}const n=this._size;return this._size=t,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(o,a,l)=>this._buffer.array.set(r.array.subarray(a,l),o),hasNewBuffer:!0}:{dispose:()=>{},copy:(o,a,l)=>{o!==a&&this._buffer.array.copyWithin(o,a,l)},hasNewBuffer:!1}}erase(t,i){this._buffer.array.fill(0,t,i)}}const wie=65536;function CG(e){return Math.ceil(e/wie)*wie}function kYe(e,t,i){return t<=i?e>=i?e:CG(Math.max(2*e,i)):e<=2*i?e:CG(i)}class BYe{constructor(t,i,r,s){this.vao=new Os(t,i,{geometry:r},{geometry:si.createVertex(t,mi.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const VYe=f$+1;class GYe{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${Xa()}`,jYe)}dispose(){this._cache.destroy()}newBuffer(t){const i=t.toString(),r=this._cache.pop(i);if(_(r)){const s=r.pop();return r.length>0&&this._cache.put(i,r,s.array.byteLength*r.length,VYe),s}return new BYe(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const i=t.array.byteLength,r=t.array.length.toString(),s=this._cache.pop(r);return _(s)?(s.push(t),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[t],i,-1),null}}function jYe(e,t){if(t===Rm.ALL)return void e.forEach(s=>s.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}class h_e{constructor(t,i,r){this._rctx=t,this._materialRepository=i,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new Vt,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Vve(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new GYe(t,r.vertexAttributeLocations,Zl(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof c_e}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==wr.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,i){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,o=qYe(t,i);o.forEach((a,l)=>{o.delete(l);const c=a.toAdd.reduce((w,S)=>w+r.elementCount(S.data),0);let h=n.get(l);if(h==null)ht(a.toRemove.length===0),h=new XYe(a.origin,new zYe(this._bufferPool,c*s)),n.set(l,h);else if(a.toAdd.length===0&&h.instances.size===a.toRemove.length)return h.buffer.dispose(),void n.delete(l);let p=0;h.instances.forEach(w=>p+=w.to-w.from);const f=a.toRemove.reduce((w,S)=>w+r.elementCount(S.data),0),g=h.buffer.size,y=(p+c-f)*s,v=ZYe;if(y<g/2?this._removeAndRebuild(h,a.toRemove,s,y,v):a.toRemove.length>0&&this._remove(h,a.toRemove,s,v),a.toAdd.length>0){const w=QYe;eye(w,-a.origin[0],-a.origin[1],-a.origin[2]),this._add(h,a.toAdd,s,w,v)}const b=h.buffer.vao.vertexBuffers.geometry;Sie(v),v.forAll(({from:w,to:S})=>{if(w<S){const x=h.buffer.array,E=4,R=w*E,O=S*E;b.setSubData(x,R,R,O)}}),v.clear(),h.drawCommandsDirty=!0})}_updateGeometries(t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.origin.id),a=o&&o.instances.get(n.id);if(!a)return;const l=s.updateType;if(l&Yt.State.VISIBILITIES&&(a.isVisible=n.instanceParameters.visible),l&(Yt.State.HIGHLIGHTS|Yt.State.VISIBILITIES)){const c=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&c}if(l&Yt.State.OCCLUDEES&&(a.hasOccludees=!!n.instanceParameters.occludees),l&(Yt.State.VERTEXATTRS|Yt.State.TRANSFORMATION)){const{array:c,vao:h}=o.buffer;vGe(n,ak,ME),i.write({transformation:ak,invTranspTransformation:ME},n.data,i.vertexBufferLayout.createView(c.buffer),a.from),ht(a.from+i.elementCount(n.data)===a.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(c,a.from*r*4,a.from*r*4,a.to*r*4)}o.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(i=>{i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Us(i.instances,r=>(r.isVisible?(r.hasHighlights&&(this._hasHighlights=!0,i.hasHighlights=!0),r.hasOccludees&&(this._hasOccludees=!0,i.hasOccludees=!0)):i.hasHiddenInstances=!0,i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees))});const t=i=>{if(i.drawCommandsDefault=null,i.drawCommandsHighlight=null,i.drawCommandsOccludees=null,i.drawCommandsShadowHighlightRest=null,i.instances.size===0)return;if(!Tie(i)){const s=this._bufferWriter.vertexBufferLayout.stride,n=4*i.buffer.size/s;return void(i.drawCommandsDefault=[{first:0,count:n}])}const r=bie(i.instances);i.drawCommandsDefault=[],i.drawCommandsHighlight=[],i.drawCommandsOccludees=[],i.drawCommandsShadowHighlightRest=[];for(const s of r)s.isVisible&&(s.hasOccludees?g3(i.drawCommandsOccludees,s):g3(i.drawCommandsDefault,s),s.hasHighlights?g3(i.drawCommandsHighlight,s):g3(i.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(i=>{i.drawCommandsDirty&&(t(i),i.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,i){return t==null||this._material.requiresSlot(t,i)}render(t,i){if(!this.requiresSlot(i.slot,t))return!1;const r=t===Ue.MATERIAL_HIGHLIGHT||t===Ue.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(r&&!this._hasHighlights)return!1;const s=t===Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(r||s);if(this._dataByOrigin.forEach(c=>{if(r&&!c.hasHighlights)return;const h=(r?c.drawCommandsHighlight:s&&Tie(c)?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,p=n&&c.drawCommandsOccludees||null;(_(h)||_(p))&&this._renderCommandData.push(new YYe(c.origin,c.buffer,h,p))}),this._renderCommandData.length===0)return!1;const o=this._rctx,a=this._glMaterials.load(o,t);if(C(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(i);return o.bindTechnique(l,this._material.parameters,i,!1),this._renderCommandData.forAll(c=>{l.bindDraw(c,i);const{buffer:h,renderCommands:p,occludeeCommands:f}=c;l.ensureAttributeLocations(h.vao),o.bindVAO(h.vao);const g=l.primitiveType;_(p)&&this._renderCommands(o,g,p),_(f)&&(l.bindPipelineState(o,i.slot,!0),this._renderCommands(o,g,f),l.bindPipelineState(o,i.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,i,r){for(let s=0;s<r.length;s++)t.drawArrays(i,r[s].first,r[s].count)}_removeAndRebuild(t,i,r,s,n){for(const h of i)t.instances.delete(h.id);const o=bie(t.instances);t.instances.clear();const a=t.buffer.size,l=t.buffer.alloc(s);let c=0;for(const h of o){const p=h.from*r,f=h.to*r;l.copy(c,p,f),h.from=c/r,c+=f-p,h.to=c/r,t.instances.set(h.id,h)}n.push(new Gx(0,l.hasNewBuffer?t.buffer.array.length:a)),l.dispose(),t.buffer.erase(c,n.back().to),t.holes.clear()}_remove(t,i,r,s){for(const n of i){const o=n.id,a=t.instances.get(o),l=a.from*r,c=a.to*r;t.buffer.erase(l,c),t.holes.push(new Gx(a.from,a.to)),t.instances.delete(o),s.push(new Gx(l,c))}Sie(t.holes)}_add(t,i,r,s,n){if(i.length===0)return;const o=this._bufferWriter;let a=o.vertexBufferLayout.createView(t.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const p of i){const f=_(p.transformation)?xr(ak,s,p.transformation):s;jr(ME,f);const g=rl(ME,ME),y=o.elementCount(p.data),v=y*r;let b=WYe(t.holes,y);C(b)&&(b=t.buffer.size/r,t.buffer.grow(v),a=o.vertexBufferLayout.createView(t.buffer.array.buffer)),o.write({transformation:f,invTranspTransformation:g},p.data,a,b);const w=p.instanceParameters.visible,S=!!p.instanceParameters.highlights&&w,x=!!p.instanceParameters.occludees,E=new NYe(p.id,b,b+y,w,S,x);ht(t.instances.get(p.id)==null),t.instances.set(p.id,E),l?n.push(new Gx(E.from*r,E.to*r)):(c=Math.min(E.from,c),h=Math.max(E.to,h))}l||n.push(new Gx(c*r,h*r))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class HYe{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function qYe(e,t){const i=new Map;for(const r of e)xie(i,r,!0);for(const r of t)xie(i,r,!1);return i}function xie(e,t,i){const r=t.origin;if(C(r))return;let s=e.get(r.id);s==null&&(s=new HYe(r.vec3),e.set(r.id,s)),i?s.toAdd.push(t):s.toRemove.push(t)}function Tie(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function WYe(e,t){let i;if(!e.some(s=>!(s.to-s.from<t)&&(i=s,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function Sie(e){const t=new Map;e.forAll(r=>t.set(r.from,r));let i=!0;for(;i;)i=!1,e.forEach(r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)})}class XYe{constructor(t,i){this.origin=t,this.buffer=i,this.instances=new Map,this.holes=new Vt({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class YYe extends r_e{constructor(t,i,r,s){super(t),this.buffer=i,this.renderCommands=r,this.occludeeCommands=s}}const ZYe=new Vt({deallocator:null}),QYe=Ae(),ak=Ae(),ME=Ae();let Cp=class extends be{constructor(e){super(e),this._pending=new JYe,this._changes=new Qve,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Vt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Us(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Jve(this._changes);let t=!1,i=!1,r=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new h_e(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,i=!0,r=!0),!o)return;const a=i||o.hasHighlights,l=r||o.hasWater;o.modify(s),i=i||a!==o.hasHighlights,r=r||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Us(this._materialRenderers,s=>s.hasHighlights)),r&&(this._hasWater=Us(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const r=this._pending.empty;for(const s of i)this._pending.adds.add(s);r&&this.notifyChange("updating"),t===Yt.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const s of e)r.has(s)?(this._pending.removed.add(s),r.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===Yt.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=this._changes.updates.length===0;for(const r of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(r),s.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case Yt.State.TRANSFORMATION:case Yt.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case Yt.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,s){return this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,i)=>{const r=i.material.renderPriority-t.material.renderPriority;return r!==0?r:t.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.instanceParameters.visible)return;let o=0;_(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),y3[0]=i[0]-r,y3[1]=i[1]-o,y3[2]=1,v3[0]=i[0]-r,v3[1]=i[1]-o,v3[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,y3,v3,(a,l,c)=>{KYe(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(C(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}}_notifyGraphicVisibilityChanged(e){if(C(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return C(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],Cp.prototype,"drapeSource",void 0),u([d()],Cp.prototype,"updating",null),u([d()],Cp.prototype,"rctx",null),u([d()],Cp.prototype,"rendererContext",void 0),u([d()],Cp.prototype,"_materialRepository",null),u([d()],Cp.prototype,"_localOriginFactory",null),Cp=u([P("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Cp);class JYe{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function KYe(e,t,i,r,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=c=>{c.set(Rr.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==zn.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===zn.ALL){const c=jq(s.ray);l(c),s.results.all.push(c)}}const y3=M(),v3=M();function k4(e){e.fragment.uniforms.add(new dt("projInfo",F.Pass,(t,i)=>eZe(i))),e.fragment.uniforms.add(new Ft("zScale",F.Pass,(t,i)=>d_e(i))),e.fragment.code.add(T`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function eZe(e){const t=e.camera.projectionMatrix;return t[11]===0?Wi(Eie,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):Wi(Eie,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const Eie=ii();function d_e(e){return e.camera.projectionMatrix[11]===0?Li(Aie,0,1):Li(Aie,1,0)}const Aie=lt();var iv;(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(iv||(iv={}));class p_e extends _a{constructor(){super(...arguments),this.output=iv.SSAO}}u([B({count:iv.COUNT})],p_e.prototype,"output",void 0);const PE={samples:16,filterRadius:4};function tZe(e){const t=new Fi,i=t.fragment;if(t.include(uv),e.output===iv.Blur){const r=(PE.filterRadius+1)/2,s=1/(2*r*r);i.include(Zc),i.uniforms.add([new et("normalMap"),new et("depthMap"),new et("tex"),new Ft("blurSize"),new ye("projScale"),new Ft("nearFar",F.Pass,(n,o)=>o.camera.nearFar)]),i.code.add(T`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${T.float(s)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(T`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${T.int(PE.filterRadius)}; r <= ${T.int(PE.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===iv.SSAO&&(i.include(Zc),t.include(k4),i.uniforms.add(new et("normalMap")),i.uniforms.add(new et("depthMap")),i.uniforms.add(new et("rnm")),i.uniforms.add(new ye("intensity")),i.uniforms.add(new ye("projScale")),i.uniforms.add(new ye("radius")),i.uniforms.add(new Ft("nearFar",F.Pass,(r,s)=>s.camera.nearFar)),i.uniforms.add(new Ft("screenSize")),i.uniforms.add(new Ft("rnmScale")),i.code.add(T`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(T`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new Ft("zScale",F.Pass,(r,s)=>d_e(s))),i.code.add(T`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${T.int(PE.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${T.int(PE.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const iZe=Object.freeze(Object.defineProperty({__proto__:null,build:tZe},Symbol.toStringTag,{value:"Module"}));class dO extends Ki{initializeProgram(t){const i=dO.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({colorWrite:Qt})}}dO.shader=new Vi(iZe,()=>import("./SSAO.glsl.75fbbbb7.js"));class f_e{constructor(t,i,r){this._techniqueRep=t,this._rctx=i,this._requestRender=r,this._enabled=!1,this._ssaoTechniqueConfig=new p_e,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=it(this.quadVAO)}disposeOffscreenBuffers(){Ks(this._ssaoFBO,t=>t.resize(0,0)),Ks(this._blur0FBO,t=>t.resize(0,0)),Ks(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&_(this._noiseTexture)&&_(this._ssaoFBO)&&_(this._blur0FBO)&&_(this._blur1FBO)}get colorTexture(){return _(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return _(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return _(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,i,r){if(!this.enabled||C(i)||C(r)||C(this._noiseTexture)||C(this._ssaoFBO)||C(this._blur0FBO)||C(this._blur1FBO))return;const s=this._rctx,n=t.camera,o=n.fullViewport,a=o[2],l=o[3],c=a/this._blurSizePx,h=l/this._blurSizePx;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);const p=1,f=1,g=a*p,y=l*f;s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l);const v=s.bindTechnique(this._ssaoTechnique,Cie,t);v.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);let b=1/n.computeRenderPixelSizeAtDist(1);v.setUniform1f("projScale",b*p),v.setUniform2f("screenSize",g,y);const w=Yi(n.eye,n.center);let S=20*n.computeRenderPixelSizeAtDist(w);S=Math.max(.1,S),v.setUniform1f("radius",S),v.setUniform1f("intensity",4*this._attenuation/S**6),v.bindTexture("rnm",this._noiseTexture),v.bindTexture("normalMap",r),v.bindTexture("depthMap",i),C(this.quadVAO)&&(this.quadVAO=ba(this._rctx)),s.bindVAO(this.quadVAO),s.drawArrays(Dt.TRIANGLE_STRIP,0,oo(this.quadVAO,"geometry"));const x=s.bindTechnique(this._blurTechnique,Cie,t);x.bindTexture("tex",this._ssaoFBO.colorTexture),x.bindTexture("normalMap",r),x.bindTexture("depthMap",i),s.setViewport(0,0,g/this._blurSizePx,y/this._blurSizePx),s.bindFramebuffer(this._blur0FBO),x.setUniform2f("screenSize",g,y),x.setUniform2f("blurSize",0,this._blurSizePx*p/y),w>5e4&&(b=Math.max(0,b-(w-5e4))),x.setUniform1f("projScale",b),s.drawArrays(Dt.TRIANGLE_STRIP,0,oo(this.quadVAO,"geometry")),x.setUniform2f("blurSize",this._blurSizePx*f/g,0),s.bindFramebuffer(this._blur1FBO),x.bindTexture("tex",this._blur0FBO.colorTexture),s.drawArrays(Dt.TRIANGLE_STRIP,0,oo(this.quadVAO,"geometry")),s.setViewport(o[0],o[1],o[2],o[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=iv.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(dO,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=iv.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(dO,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():import("./SSAOHelperData.08f44d75.js").then(i=>{this._data=i,t()})}_initialize(){const t={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE};ch(this._data.noiseTexture).then(r=>{this._enabled&&(this._ssaoFBO=new hr(this._rctx,i,t),this._blur0FBO=new hr(this._rctx,i,t),this._blur1FBO=new hr(this._rctx,i,t),this._noiseTexture=new ot(this._rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,hasMipmap:!0,width:r.width,height:r.height},r),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=it(this._noiseTexture),this._blur1FBO=it(this._blur1FBO),this._blur0FBO=it(this._blur0FBO),this._ssaoFBO=it(this._ssaoFBO)}get gpuMemoryUsage(){return(_(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(_(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(_(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const Cie=new qs;function rZe(){const e=new Fi;return e.include(uv),e.fragment.uniforms.add([new et("tex"),new dt("uColor")]),e.fragment.code.add(T`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const sZe=Object.freeze(Object.defineProperty({__proto__:null,build:rZe},Symbol.toStringTag,{value:"Module"}));class gM extends Ki{initializeProgram(t){const i=gM.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){return this.configuration.hasAlpha?Ut({blending:po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),colorWrite:Qt}):Ut({colorWrite:Qt})}}gM.shader=new Vi(sZe,()=>import("./TextureOnly.glsl.237aa73d.js"));class FW extends _a{constructor(){super(...arguments),this.hasAlpha=!1}}u([B()],FW.prototype,"hasAlpha",void 0);class m_e{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=it(t.texture)),this.cache.clear()}_acquire(t){if(C(t))return null;const i=this._patternId(t),r=this.cache.get(i);if(r)return r.refCount++,r.bind;const s=t.pixelRatio,{encodedData:n,sdfNormalizer:o,pixels:a,paddedPixels:l}=nZe(t.pattern,s),c=a/s,h={refCount:1,texture:null,bind:p=>(C(h.texture)&&(h.texture=new ot(this._rctx,{width:l,height:1,internalFormat:ze.RGBA,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE},n)),p.bindTexture("stipplePatternTexture",h.texture),{pixelSize:c,sdfNormalizer:o,pixels:a})};return this.cache.set(i,h),h.bind}release(t){if(C(t))return;const i=this._patternId(t),r=this.cache.get(i);r&&(r.refCount--,r.refCount===0&&(_(r.texture)&&r.texture.dispose(),this.cache.delete(i)))}swap(t,i){const r=this._acquire(i);return this.release(t),r}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function nZe(e,t){const i=e.map(y=>Math.round(y*t)),r=1/t,s=Math.floor(i.reduce((y,v)=>y+v)),n=i.reduce((y,v)=>Math.max(y,v)),o=(Math.floor(.5*(n-1))+.5)*r,a=[];let l=1;for(const y of i){for(let v=0;v<y;v++){const b=l*(Math.min(v,y-1-v)+.5)*r/o*.5+.5;a.push(b)}l=-l}const c=Math.round(i[0]/2),h=[...a.slice(c),...a.slice(0,c)],p=s+2,f=new Uint8Array(4*p);let g=4;for(const y of h)iN(y,f,g),g+=4;return f.copyWithin(0,g-4,g),f.copyWithin(g,4,8),{encodedData:f,sdfNormalizer:o,paddedPixels:p,pixels:s}}var Ul,ro;(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(Ul||(Ul={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(ro||(ro={}));class W$ extends _a{constructor(){super(...arguments),this.function=Ul.Standard,this.alphaMode=ro.None,this.hasOpacityFactor=!1}}u([B({count:Ul.COUNT})],W$.prototype,"function",void 0),u([B({count:ro.COUNT})],W$.prototype,"alphaMode",void 0),u([B()],W$.prototype,"hasOpacityFactor",void 0);let qh=class extends M4(be){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Jt,this._frameTask=$S,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new Vt,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new qr,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new m_e(e.renderingContext),this._shaderTechniqueRepository=new Fve({rctx:this._rctx,viewingMode:je.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new Zve(this._rctx,new NW(this._rctx,this.view.state.viewingMode),new f_e(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([xe(()=>t.updating,()=>this.events.emit("content-changed"),xs),xe(()=>this.spatialReference,i=>this._localOriginFactory=new LW(i),xs),ma(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new Uve(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&pN)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=we.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=Sge(this._rctx),this._bindParameters.camera=C1,this._bindParameters.transparencyPassType=gt.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new Dq(Le(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=$i(this._debugTextureTechnique),this._debugPatternTexture=it(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=it(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=it(this._shaderTechniqueRepository),this._temporaryFBO=it(this._temporaryFBO),this._quadVAO=it(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||Us(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return _(this._overlays)&&_(this._overlayRenderTarget)}get gpuMemoryUsage(){return _(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Cp)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);_(r)&&r.destroy();const s=new t(ge(L({},i),{rendererContext:this,drapeSource:e}));return this._drapeSourceRenderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(xe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(C(e))return;const t=this._drapeSourceRenderers.get(e);C(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(_(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return Tt(this._overlays,[])}ensureDrapeTargets(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=CI(e,i=>i.drapeTargetType===SG.WithoutRasterImage)})}ensureDrapeSources(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=CI(e,i=>i.drapeSourceType===JC.Features),t.hasDrapedRasterSource=CI(e,i=>i.drapeSourceType===JC.RasterImage)})}ensureOverlays(e,t){C(this._overlays)&&(this._overlayRenderTarget=new HXe(this._rctx),this._overlays=[new Xte(gs.INNER,this._overlayRenderTarget),new Xte(gs.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=it(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&(_(this._overlays)&&this._drapeSourceRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(P2,e=>e.updatePolicy===FS.SYNC)}isEmpty(){let e=!0;for(const t of this._drapeSourceRenderers.values())if(e=e&&t.isEmpty,!e)break;return e&&!Ni.OVERLAY_DRAW_DEBUG_TEXTURE}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(r.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===Ue.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===Ue.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;C1.pixelRatio=e.pixelRatio*i,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===Ue.MATERIAL_NORMAL?we.DRAPED_WATER:we.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===gs.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(ki.COLOR_BUFFER_BIT));const c=t.type===Mn.ColorNoRasterImage?Wy.ExcludeRasterImage:t.type===Mn.Occluded?Wy.OccludedOnly:Wy.Normal;if(c===Wy.OccludedOnly&&(this._renderContext.renderOccludedMask=pN),Ni.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==Wy.OccludedOnly)for(let h=0;h<r.numViews;h++)this._setViewParameters(r.extents[h],e,C1),this._drawDebugTexture(e.resolution,aZe[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:h,renderer:p})=>{if(c===Wy.ExcludeRasterImage&&h.drapeSourceType===JC.RasterImage)return;const{fullOpacity:f}=h,g=_(f)&&f<1&&s===Ue.MATERIAL;g&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(ki.COLOR_BUFFER_BIT));for(let y=0;y<r.numViews;y++)this._setViewParameters(r.extents[y],e,C1),p.render(this._renderContext,this._bindParameters);g&&_(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),ro.PremultipliedAlpha,f,Ul.OverlayWithTransparency,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){C(this._temporaryFBO)&&(this._temporaryFBO=new Nve(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}intersect(e,t,i,r){let s=0;for(const o of this._drapeSourceRenderers.values()){var n;s=(n=o.intersect==null?void 0:o.intersect(e,t,i,r,s))!=null?n:s}}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),this._drapeSourceRenderers.size===0))return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new oZe(i,t,r<0?1/0:r))}),this._sortedDrapeSourceRenderers.sort((t,i)=>t.index-i.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,$j(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),gF(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=Us(this._drapeSourceRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Us(this._drapeSourceRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Us(this._drapeSourceRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays(Dt.TRIANGLE_STRIP,0,oo(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let o=0;o<e;o++){const a=Math.floor(o/10),l=Math.floor(n/10);a<2||l<2||10*a>e-20||10*l>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&a&&1&l?1&o^1&n?0:255:1&a^1&l?0:128)}this._debugPatternTexture=new ot(this._rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:e,height:t},i);const s=new FW;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(gM,s),this._quadVAO=ba(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var Wy;u([d()],qh.prototype,"_frameTask",void 0),u([d()],qh.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([Kn()],qh.prototype,"_shaderTechniqueRepository",void 0),u([Kn()],qh.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],qh.prototype,"view",void 0),u([d()],qh.prototype,"worldToPCSRatio",void 0),u([d()],qh.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],qh.prototype,"updating",null),qh=u([P("esri.views.3d.terrain.OverlayRenderer")],qh),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(Wy||(Wy={}));class oZe{constructor(t,i,r){this.drapeSource=t,this.renderer=i,this.index=r}}const aZe=[[1,.5,.5],[.5,.5,1]],C1=new Di;C1.near=1,C1.far=1e4,C1.relativeElevation=null;const UW=-2,pN=wr.OccludeAndTransparent;function Rie(e){const t=[[A.POSITION,e.indices]],i=[[A.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return _(e.attributeData.color)&&(i.push([A.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([A.COLOR,new Uint32Array(e.indices.length)])),_(e.attributeData.uvMapSpace)&&(i.push([A.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([A.UVMAPSPACE,e.indices])),_(e.attributeData.boundingRect)&&(i.push([A.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([A.BOUNDINGRECT,e.indices])),_(e.attributeData.mapPosition)&&(i.push([A.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([A.MAPPOS,e.indices])),new Ar(i,t)}function Oie(e){const t=[[A.POSITION,e.indices],[A.UV0,e.indices]],i=[[A.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[A.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return _(e.attributeData.mapPosition)&&(i.push([A.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([A.MAPPOS,e.indices])),new Ar(i,t)}function pO(e){switch(e.type){case"extent":if(e instanceof ni)return jl.fromExtent(e);break;case"polygon":return e}return null}function zW(e,t,i,r){const s=pM(e.rings,e.hasZ,af.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=yve(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),a=o!=null;return{position:s.position,mapPosition:n,polygons:v_e(s.polygons,s.position,n),outlines:y_e(s.outlines,s.position,n),projectionSuccess:a,sampledElevation:o}}function g_e(e,t){const i=pM(e.rings,!1,af.CCW_IS_HOLE),r=Pr(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=UW;return{position:i.position,polygons:v_e(i.polygons,i.position),outlines:y_e(i.outlines,i.position),projectionSuccess:r}}function y_e(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({index:s,count:n,position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function v_e(e,t,i){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=l+3*n,h=o.map(p=>p-s);r.push({index:s,count:n,holeIndices:h,pathLengths:a,position:t.subarray(l,c),mapPosition:i?i.subarray(l,c):void 0})}return r}function __e(e,t){const i=e.fragment;switch(i.code.add(T`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Or.None:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Or.View:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Or.WindingOrder:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Or.COUNT:}}var Or;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Or||(Or={}));function b_e(e){e.vertex.code.add(T`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function w_e(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(A.MODELORIGINHI,"vec3"),e.attributes.add(A.MODELORIGINLO,"vec3"),e.attributes.add(A.MODEL,"mat3"),e.attributes.add(A.MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include(dN,t),i.uniforms.add(new ke("viewOriginHi",F.Draw,(r,s)=>gGe(se(_3,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),_3))),i.uniforms.add(new ke("viewOriginLo",F.Draw,(r,s)=>yGe(se(_3,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),_3)))),i.code.add(T`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(T`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?T`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(T`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===Q.Normal&&(i.uniforms.add(new li("viewNormal",F.Pass,(r,s)=>s.camera.viewInverseTransposeMatrix)),i.code.add(T`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(T`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const _3=M();var zs;function lZe(e){switch(e){case"multiply":default:return zs.Multiply;case"ignore":return zs.Ignore;case"replace":return zs.Replace;case"tint":return zs.Tint}}function x_e(e,t,i){if(C(e)||t===zs.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=He(Math.round(e[3]*fN),0,fN),s=r===0||t===zs.Tint?0:t===zs.Replace?cZe:uZe;i[0]=He(Math.round(e[0]*$w),0,$w),i[1]=He(Math.round(e[1]*$w),0,$w),i[2]=He(Math.round(e[2]*$w),0,$w),i[3]=r+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(zs||(zs={}));const $w=255,fN=85,cZe=fN,uZe=2*fN;function T_e(e){e.vertex.code.add(T`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${T.int(zs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${T.int(zs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${T.int(zs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${T.int(zs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function S_e(e,t){t.hasSymbolColors?(e.include(T_e),e.attributes.add(A.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(T`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new z2("colorMixMode",F.Pass,i=>$0e[i.colorMixMode])),e.vertex.code.add(T`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function iw(e,t){t.hasVertexColors?(e.attributes.add(A.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(T`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(T`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(T`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function hZe(e){e.fragment.code.add(T`
    #define discardOrAdjustAlpha(color) { if (color.a < ${T.float(co)}) { discard; } }
  `)}function q1(e,t){E_e(e,t,new ye("textureAlphaCutoff",F.Pass,i=>i.textureAlphaCutoff))}function dZe(e,t){E_e(e,t,new ye("textureAlphaCutoff",F.Draw,i=>i.textureAlphaCutoff))}function E_e(e,t,i){const r=e.fragment;switch(t.alphaDiscardMode!==Xi.Mask&&t.alphaDiscardMode!==Xi.MaskBlend||r.uniforms.add(i),t.alphaDiscardMode){case Xi.Blend:return e.include(hZe);case Xi.Opaque:r.code.add(T`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Xi.Mask:r.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Xi.MaskBlend:e.fragment.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function A_e(e,t){const i=e.vertex.code,r=e.fragment.code,s=t.hasModelTransformation;t.output!==Q.Depth&&t.output!==Q.Shadow||(Gc(e,t),e.include(ao,{linearDepth:!0,hasModelTransformation:s}),e.include(jm,t),e.include(BT,t),e.include(dv,t),e.include(es,t),e.vertex.uniforms.add(new Ft("nearFar",F.Pass,(n,o)=>o.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new et("tex",F.Pass,n=>n.texture)),i.add(T`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(q1,t),r.add(T`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?T`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===Q.Normal&&(Gc(e,t),e.include(ao,{linearDepth:!1,hasModelTransformation:s}),e.include($4,t),e.include(L4,t),e.include(jm,t),e.include(BT,t),t.hasColorTexture&&e.fragment.uniforms.add(new et("tex",F.Pass,n=>n.texture)),e.varyings.add("vPositionView","vec3"),i.add(T`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===gr.Attribute?T`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(es,t),e.include(q1,t),r.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?T`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===gr.ScreenDerivative?T`
            vec3 normal = screenDerivativeNormal(vPositionView);`:T`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===Q.Highlight&&(Gc(e,t),e.include(ao,{linearDepth:!1,hasModelTransformation:s}),e.include(jm,t),e.include(BT,t),t.hasColorTexture&&e.fragment.uniforms.add(new et("tex",F.Pass,n=>n.texture)),i.add(T`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(es,t),e.include(q1,t),e.include(xg),r.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?T`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function C_e(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(A.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Or.WindingOrder?i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(T`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==Gs.None){e.include(Tq,t);const r=t.supportsTextureAtlas;i.uniforms.add(t.pbrTextureBindType===F.Pass?FT("normalTexture",F.Pass,s=>s.textureNormal,r):FT("normalTexture",F.Draw,s=>s.textureNormal,r)),i.code.add(T`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function yM(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add([new et("ssaoTex",F.Pass,(r,s)=>s.ssaoHelper.colorTexture),new dt("viewportPixelSz",F.Pass,(r,s)=>Wi(pZe,s.camera.fullViewport[0],s.camera.fullViewport[1],1/s.ssaoHelper.width,1/s.ssaoHelper.height))]),i.code.add(T`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):i.code.add(T`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const pZe=ii();function Ib(e,t){const i=e.fragment;e.include(yM,t),t.pbrMode!==Mt.Disabled&&e.include(F4,t),e.include(Aq,t),i.constants.add("ambientBoostFactor","float",$2),e.include(t4),i.code.add(T`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===Mt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.uniforms.add(new ke("lightingMainDirection",F.Pass,(r,s)=>s.lighting.lightingMainDirection)),i.code.add(T`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?T`normalize(vPosWorld)`:T`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.uniforms.add([new ye("lightingGlobalFactor",F.Pass,(r,s)=>s.lighting.globalFactor),new ke("lightingMainIntensity",F.Pass,(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(T`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===Mt.Disabled||t.pbrMode===Mt.WaterOnIntegratedMesh?(e.include(Nge,t),i.code.add(T`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==Mt.Normal&&t.pbrMode!==Mt.Schematic||(i.code.add(T`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(T`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new _b("hasFillLights",F.Pass,(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(T`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new ye("lightingSpecularStrength",F.Pass,(r,s)=>s.lighting.mainLight.specularStrength),new ye("lightingEnvironmentStrength",F.Pass,(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(T`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(T`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===Mt.Schematic?T`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:T`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function R_e(e,t){const i=T`
  /*
  *  ${t.name}
  *  ${t.output===Q.Color?"RenderOutput: Color":t.output===Q.Depth?"RenderOutput: Depth":t.output===Q.Shadow?"RenderOutput: Shadow":t.output===Q.Normal?"RenderOutput: Normal":t.output===Q.Highlight?"RenderOutput: Highlight":""}
  */
  `;kR()&&(e.fragment.code.add(i),e.vertex.code.add(i))}function fO(e){e.include(wf),e.code.add(T`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${T.int(zs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${T.int(zs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(zs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${T.int(zs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(zs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function fZe(e){const t=new Fi,i=t.vertex.code,r=t.fragment.code;t.include(R_e,{name:"Default Material Shader",output:e.output});const s=Gc(t,e);return t.include(D4),t.varyings.add("vpos","vec3"),t.include(BT,e),t.include(w_e,e),t.include(S0e,e),e.output!==Q.Color&&e.output!==Q.Alpha||(Md(t.vertex.uniforms,e),t.include($4,e),t.include(ao,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===gr.Attribute&&e.offsetBackfaces&&t.include(b_e),t.include(C_e,e),t.include(L4,e),e.instancedColor&&t.attributes.add(A.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(jm,e),t.include(mM,e),t.include(S_e,e),t.include(iw,e),t.vertex.uniforms.add(new dt("externalColor",F.Pass,n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new li("model",F.Pass,n=>_(n.modelTransformation)?n.modelTransformation:Es)),i.add(T`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${T.float(co)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===gr.Attribute?T`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===gr.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===Q.Alpha&&(t.include(es,e),t.include(q1,e),t.include(Qc,e),t.fragment.uniforms.add([new ye("opacity",F.Pass,n=>n.opacity),new ye("layerOpacity",F.Pass,n=>n.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new et("tex",F.Pass,n=>n.texture)),t.fragment.include(fO),r.add(T`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?T`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?T`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===Q.Color&&(t.include(es,e),t.include(Ib,e),t.include(yM,e),t.include(q1,e),t.include(e.instancedDoublePrecision?N4:Pb,e),t.include(Qc,e),Md(t.fragment.uniforms,e),t.fragment.uniforms.add([s,new ke("ambient",F.Pass,n=>n.ambient),new ke("diffuse",F.Pass,n=>n.diffuse),new ye("opacity",F.Pass,n=>n.opacity),new ye("layerOpacity",F.Pass,n=>n.layerOpacity),new ye("lightingGlobalFactor",F.Pass,(n,o)=>o.lighting.globalFactor),new ke("lightingMainIntensity",F.Pass,(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",$2),e.hasColorTexture&&t.fragment.uniforms.add(new et("tex",F.Pass,n=>n.texture)),t.include(Eq,e),t.include(F4,e),t.fragment.include(fO),t.include(__e,e),r.add(T`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?T`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===gr.ScreenDerivative?T`
        vec3 normal = screenDerivativeNormal(localvpos);`:T`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===Mt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?T`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${e.hasNormalTexture?T`
              mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal = normal;"}
        ${e.pbrMode===Mt.Normal||e.pbrMode===Mt.Schematic?e.spherical?T`vec3 normalGround = normalize(vpos + localOrigin);`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:T``}
        ${e.pbrMode===Mt.Normal||e.pbrMode===Mt.Schematic?T`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(A_e,e),t}const mZe=Object.freeze(Object.defineProperty({__proto__:null,build:fZe},Symbol.toStringTag,{value:"Module"}));class gZe extends t_e{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Le(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Zi.Back,this.emissiveFactor=Le(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Le(.2,.2,.2),this.diffuse=Le(.8,.8,.8),this.externalColor=ri(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=M(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Qi(),this.transparent=!1,this.writeDepth=!0,this.customDepthTest=yb.Less,this.textureAlphaMode=Xi.Blend,this.textureAlphaCutoff=nN,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1}}class yZe extends i_e{constructor(){super(...arguments),this.origin=M(),this.slicePlaneLocalOrigin=this.origin}}class vM extends Ki{initializeConfiguration(t,i){i.spherical=t.viewingMode===je.Global,i.doublePrecisionRequiresObfuscation=fM(t.rctx),i.textureCoordinateType=i.hasColorTexture||i.hasMetalnessAndRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Gs.Default:Gs.None}initializeProgram(t){return this._initializeProgram(t,vM.shader)}_initializeProgram(t,i){const r=i.get().build(this.configuration);return new Gi(t.rctx,r,Ri)}_convertDepthTestFunction(t){return t===yb.Lequal?Ji.LEQUAL:Ji.LESS}_setPipeline(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:r.output!==Q.Color&&r.output!==Q.Alpha||!r.transparent?null:s?jc:Tg(t),culling:vZe(r)&&e4(r.cullFace),depthTest:{func:hv(t,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:s||n?r.writeDepth&&ol:null,colorWrite:Qt,stencilWrite:r.hasOccludees?lf:null,stencilTest:r.hasOccludees?i?tv:pv:null,polygonOffset:s||n?null:S4(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}function vZe(e){return e.cullFace!==Zi.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}vM.shader=new Vi(mZe,()=>import("./DefaultMaterial.glsl.fcc7d2ab.js"));class Kt extends Io{constructor(){super(...arguments),this.output=Q.Color,this.alphaDiscardMode=Xi.Opaque,this.doubleSidedMode=Or.None,this.pbrMode=Mt.Disabled,this.cullFace=Zi.None,this.transparencyPassType=gt.NONE,this.normalType=gr.Attribute,this.textureCoordinateType=Gs.None,this.customDepthTest=yb.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1}}u([B({count:Q.COUNT})],Kt.prototype,"output",void 0),u([B({count:Xi.COUNT})],Kt.prototype,"alphaDiscardMode",void 0),u([B({count:Or.COUNT})],Kt.prototype,"doubleSidedMode",void 0),u([B({count:Mt.COUNT})],Kt.prototype,"pbrMode",void 0),u([B({count:Zi.COUNT})],Kt.prototype,"cullFace",void 0),u([B({count:gt.COUNT})],Kt.prototype,"transparencyPassType",void 0),u([B({count:gr.COUNT})],Kt.prototype,"normalType",void 0),u([B({count:Gs.COUNT})],Kt.prototype,"textureCoordinateType",void 0),u([B({count:yb.COUNT})],Kt.prototype,"customDepthTest",void 0),u([B()],Kt.prototype,"spherical",void 0),u([B()],Kt.prototype,"hasVertexColors",void 0),u([B()],Kt.prototype,"hasSymbolColors",void 0),u([B()],Kt.prototype,"hasVerticalOffset",void 0),u([B()],Kt.prototype,"hasSlicePlane",void 0),u([B()],Kt.prototype,"hasSliceHighlight",void 0),u([B()],Kt.prototype,"hasColorTexture",void 0),u([B()],Kt.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([B()],Kt.prototype,"hasEmissionTexture",void 0),u([B()],Kt.prototype,"hasOcclusionTexture",void 0),u([B()],Kt.prototype,"hasNormalTexture",void 0),u([B()],Kt.prototype,"hasScreenSizePerspective",void 0),u([B()],Kt.prototype,"hasVertexTangents",void 0),u([B()],Kt.prototype,"hasOccludees",void 0),u([B()],Kt.prototype,"hasMultipassTerrain",void 0),u([B()],Kt.prototype,"hasModelTransformation",void 0),u([B()],Kt.prototype,"offsetBackfaces",void 0),u([B()],Kt.prototype,"vvSize",void 0),u([B()],Kt.prototype,"vvColor",void 0),u([B()],Kt.prototype,"receiveShadows",void 0),u([B()],Kt.prototype,"receiveAmbientOcclusion",void 0),u([B()],Kt.prototype,"textureAlphaPremultiplied",void 0),u([B()],Kt.prototype,"instanced",void 0),u([B()],Kt.prototype,"instancedColor",void 0),u([B()],Kt.prototype,"instancedDoublePrecision",void 0),u([B()],Kt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],Kt.prototype,"writeDepth",void 0),u([B()],Kt.prototype,"transparent",void 0),u([B()],Kt.prototype,"enableOffset",void 0),u([B()],Kt.prototype,"cullAboveGround",void 0),u([B({constValue:!0})],Kt.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],Kt.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],Kt.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!0})],Kt.prototype,"useFillLights",void 0);function _Ze(e){const t=new Fi,i=t.vertex.code,r=t.fragment.code,s=Gc(t,e);return t.include(D4),t.varyings.add("vpos","vec3"),t.include(BT,e),t.include(w_e,e),t.include(S0e,e),e.output!==Q.Color&&e.output!==Q.Alpha||(Md(t.vertex.uniforms,e),t.include($4,e),t.include(ao),e.offsetBackfaces&&t.include(b_e),e.instancedColor&&t.attributes.add(A.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(jm,e),t.include(mM,e),t.include(S_e,e),t.include(iw,e),t.vertex.uniforms.add(new dt("externalColor",F.Pass,n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),i.add(T`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${T.float(co)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?T`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===Q.Alpha&&(t.include(es,e),t.include(q1,e),t.include(Qc,e),t.fragment.uniforms.add([new ye("opacity",F.Pass,n=>n.opacity),new ye("layerOpacity",F.Pass,n=>n.layerOpacity),new li("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new et("tex",F.Pass,n=>n.texture)),t.fragment.include(fO),r.add(T`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?T`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?T`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===Q.Color&&(t.include(es,e),t.include(Ib,e),t.include(yM,e),t.include(q1,e),t.include(e.instancedDoublePrecision?N4:Pb,e),t.include(Qc,e),Md(t.fragment.uniforms,e),t.fragment.uniforms.add([s,new ke("ambient",F.Pass,n=>n.ambient),new ke("diffuse",F.Pass,n=>n.diffuse),new ye("opacity",F.Pass,n=>n.opacity),new ye("layerOpacity",F.Pass,n=>n.layerOpacity),new li("view"),new ye("lightingGlobalFactor",F.Pass,(n,o)=>o.lighting.globalFactor),new ke("lightingMainIntensity",F.Pass,(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",$2),e.hasColorTexture&&t.fragment.uniforms.add(new et("tex",F.Pass,n=>n.texture)),t.include(Eq,e),t.include(F4,e),t.fragment.include(fO),r.add(T`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?T`
        vec4 texColor = texture2D(tex, vuv0);
        ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===Mt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?T`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${T`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===Mt.Normal||e.pbrMode===Mt.Schematic?e.spherical?T`vec3 normalGround = normalize(vpos + localOrigin);`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:T``}
        ${e.pbrMode===Mt.Normal||e.pbrMode===Mt.Schematic?T`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),t.include(A_e,e),t}const bZe=Object.freeze(Object.defineProperty({__proto__:null,build:_Ze},Symbol.toStringTag,{value:"Module"}));class B4 extends vM{initializeConfiguration(t,i){super.initializeConfiguration(t,i),i.hasMetalnessAndRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=gr.Attribute,i.doubleSidedMode=Or.WindingOrder,i.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,B4.shader)}}B4.shader=new Vi(bZe,()=>import("./RealisticTree.glsl.063c9caf.js"));class $b extends Tf{constructor(t){super(t,TZe),this.supportsEdges=!0,this.techniqueConfig=new Kt,this.vertexBufferLayout=EZe(this.parameters),this.instanceBufferLayout=t.instanced?O_e(this.parameters):null}isVisibleInPass(t){return t!==Ue.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==Ue.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=t,o=_(i)&&i.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType=this.parameters.normals==="screenDerivative"?gr.ScreenDerivative:gr.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,_(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?Zi.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=_(this.parameters.modelTransformation),t!==Q.Color&&t!==Q.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=Or.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Or.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Or.WindingOrder:Or.None,this.techniqueConfig.instancedColor=_(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Mt.Schematic:Mt.Normal:Mt.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<x4),this.techniqueConfig}intersect(t,i,r,s,n,o,a){if(_(this.parameters.verticalOffset)){const l=s.camera;se(ck,r[12],r[13],r[14]);let c=null;switch(s.viewingMode){case je.Global:c=Te(Mie,ck);break;case je.Local:c=ne(Mie,RZe)}let h=0;const p=de(OZe,ck,l.eye),f=Ie(p),g=oe(p,p,1/f);let y=null;this.parameters.screenSizePerspective&&(y=Se(c,g)),h+=P0e(l,f,this.parameters.verticalOffset,y,this.parameters.screenSizePerspective),oe(c,c,h),so(lk,c,s.transform.inverseRotation),n=de(AZe,n,lk),o=de(CZe,o,lk)}y4(t,i,s,n,o,oG(s.verticalOffset),a)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?we.TRANSPARENT_MATERIAL:we.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:we.OPAQUE_MATERIAL)||t===we.DRAPED_MATERIAL}createGLMaterial(t){return t.output===Q.Color||t.output===Q.Alpha||t.output===Q.Depth||t.output===Q.Normal||t.output===Q.Shadow||t.output===Q.Highlight?new wZe(t):null}createBufferWriter(){return new SZe(this.vertexBufferLayout,this.instanceBufferLayout)}}class wZe extends Sq{constructor(t){super(L(L({},t),t.material.parameters))}_updateParameters(t){const i=this._material.parameters;this.updateTexture(i.textureId);const r=t.camera.viewInverseTransposeMatrix;return se(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.passParameters),this.ensureTechnique(i.treeRendering?B4:vM,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==Q.Color&&this._output!==Q.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class xZe extends gZe{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1,this.renderOccluded=wr.Occlude}}const TZe=new xZe;class SZe{constructor(t,i){this.vertexBufferLayout=t,this.instanceBufferLayout=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(A.POSITION).length}write(t,i,r,s){_4(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}function EZe(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=ls().vec3f(A.POSITION).vec3f(A.NORMAL);return e.hasVertexTangents&&i.vec4f(A.TANGENT),t&&i.vec2f(A.UV0),e.hasVertexColors&&i.vec4u8(A.COLOR),e.hasSymbolColors&&i.vec4u8(A.SYMBOLCOLOR),i}function O_e(e){let t=ls();return t=e.instancedDoublePrecision?t.vec3f(A.MODELORIGINHI).vec3f(A.MODELORIGINLO).mat3f(A.MODEL).mat3f(A.MODELNORMAL):t.mat4f(A.MODEL).mat4f(A.MODELNORMAL),_(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(A.INSTANCECOLOR)),_(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(A.INSTANCEFEATUREATTRIBUTE)),t}const AZe=M(),CZe=M(),RZe=Le(0,0,1),Mie=M(),lk=M(),ck=M(),OZe=M(),MZe=["polygon","extent"];class PZe extends Ef{constructor(t,i,r,s){super(t,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=E4(this._getSymbolSize());if(a)throw new Y("graphics3dextrudesymbollayer:invalid-size",a)}const t=Bs(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),r=za(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Zi.None:Zi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new $b(o),this._bottomMaterial=new $b(ge(L({},o),{cullFace:Zi.Back})),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,MZe,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new tu);return this._createAs3DShape(i,t.renderingInfo,r,s,i.uid)}layerOpacityChanged(t,i){const r=Bs(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();return t.forEach(a=>{const l=i(a);_(l)&&l.layerOpacityChanged(o,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,ev)}slicePlaneEnabledChanged(t,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){let i;var r;return t.size&&this._drivenProperties.size?i=(r=DXe(t.size,2))!=null?r:0:i=this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(t,i){return this._drivenPropertiesChanged(i)?js.Recreate_Symbol:js.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,i,r,s,n){const o=pO(t.geometry);if(C(o))return null;const a=zW(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer"),o.rings.length===0||!o.rings.some(he=>he.length>0))return null;const l=wW(o);if(C(l))return null;const c=new Array,h=new Array,p=new Array,f=Rs(),g=Ae(),y=M(),v=this._context.renderCoordsHelper.viewingMode===je.Global;v||this._context.renderCoordsHelper.worldUpAtPosition(null,y),nl(o.spatialReference,[l.x,l.y,0],g,this._context.renderCoordsHelper.spatialReference);const b=Ae();jr(b,g);const w=Qi();G0(w,b);const{polygons:S,mapPosition:x,position:E}=a,R=E.length/3,O=new Float64Array(3*R*6),I=new Float64Array(3*R*6),U=new Float64Array(3*R*6),N=new Float64Array(1*R*6);let V=0;for(let he=0;he<S.length;++he){const le=S[he],$=le.count;if(this._context.clippingExtent&&(ir(f),Fc(f,le.mapPosition),!hd(f,this._context.clippingExtent)))continue;const z=KS(le.mapPosition,le.holeIndices,3);if(z.length===0)continue;const k=3*$*2+z.length,G=new Uint32Array(k),W=new Uint32Array(z.length),ee=6*$,q=3*O.BYTES_PER_ELEMENT,te=new yr(O.buffer,V*q,q,(V+ee)*q),Ee=3*I.BYTES_PER_ELEMENT,ve=new yr(I.buffer,V*Ee,Ee,(V+ee)*Ee),qe=new Float64Array(U.buffer,3*V*U.BYTES_PER_ELEMENT,3*ee),Ce=new Float64Array(N.buffer,1*V*N.BYTES_PER_ELEMENT,1*ee),Re=this._getExtrusionSize(i);IZe(E,x,z,le,te.typedBuffer,qe,ve.typedBuffer,Ce,0,G,W,Re,y,v),hg(te,te,b),$d(ve,ve,w),V+=6*$;const Oe=Pie(G,G.length-W.length,{positions:te.typedBuffer,elevation:qe,normals:ve.typedBuffer,heights:Ce},r);c.push(Oe),h.push(this._material),p.push(Es);const Ve=Pie(W,0,{positions:te.typedBuffer,elevation:qe,normals:ve.typedBuffer,heights:Ce},r);c.push(Ve),h.push(this._bottomMaterial),p.push(Es)}if(c.length===0)return null;const j=new Eg({geometries:c,materials:h,transformations:p,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});j.transformation=g;const H=Eve(this.symbolLayer,{opacity:this._getLayerOpacity()}),J=_(H)?{baseMaterial:this._material,edgeMaterials:[H],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,K=new Sf(this,j,c,null,null,LZe,s,J);return K.alignedSampledElevation=a.sampledElevation,K.needsElevationUpdates=ev(s.mode),K}}function Pie(e,t,i,r){const s=new Uint32Array(e.length),n=[[A.POSITION,{size:3,data:i.positions,exclusive:!0}],[A.NORMAL,{size:3,data:i.normals,exclusive:!0}],[A.COLOR,{size:4,data:r,exclusive:!0}],[A.SIZE,{size:1,data:i.heights,exclusive:!0}]],o=[[A.POSITION,e],[A.NORMAL,e],[A.COLOR,s]];return i.elevation&&(n.push([A.MAPPOS,{size:3,data:i.elevation}]),o.push([A.MAPPOS,e])),new Ar(n,o,Qa.Triangle,t)}function IZe(e,t,i,r,s,n,o,a,l,c,h,p,f,g){const y=i.length/3;let v=0,b=2*r.count;$Ze(e,t,r.index,r.count,i,0,y,s,n,o,a,l,c,h,b,p,f,g),l+=2*r.count,b=0,Iie(s,n,a,o,v,r.pathLengths[0],r.count,l,c,b,p),l+=4*r.pathLengths[0],b+=2*r.pathLengths[0],v+=r.pathLengths[0];for(let w=1;w<r.pathLengths.length;++w)Iie(s,n,a,o,v,r.pathLengths[w],r.count,l,c,b,p),l+=4*r.pathLengths[w],b+=2*r.pathLengths[w],v+=r.pathLengths[w]}function $Ze(e,t,i,r,s,n,o,a,l,c,h,p,f,g,y,v,b,w){ne(Ra,b);const S=v>0?1:-1;let x=3*i,E=p,R=3*E,O=p+r,I=3*O;for(let V=0;V<r;++V)w&&(Ra[0]=e[x+0],Ra[1]=e[x+1],Ra[2]=e[x+2],Te(Ra,Ra)),a[R+0]=e[x+0],a[R+1]=e[x+1],a[R+2]=e[x+2],l[R+0]=t[x+0],l[R+1]=t[x+1],l[R+2]=t[x+2],c[R+0]=-S*Ra[0],c[R+1]=-S*Ra[1],c[R+2]=-S*Ra[2],h[E]=0,a[I+0]=e[x+0]+v*Ra[0],a[I+1]=e[x+1]+v*Ra[1],a[I+2]=e[x+2]+v*Ra[2],l[I+0]=t[x+0],l[I+1]=t[x+1],l[I+2]=t[x+2],c[I+0]=S*Ra[0],c[I+1]=S*Ra[1],c[I+2]=S*Ra[2],h[O]=v,R+=3,I+=3,x+=3,E+=1,O+=1;x=3*n,R=0,I=3*y;const U=v<0?Uie:Fie,N=v<0?Fie:Uie;for(let V=0;V<o;++V)g[R+0]=s[x+U[0]],g[R+1]=s[x+U[1]],g[R+2]=s[x+U[2]],f[I+0]=s[x+N[0]]+r,f[I+1]=s[x+N[1]]+r,f[I+2]=s[x+N[2]]+r,R+=3,I+=3,x+=3}function b3(e,t,i,r,s,n,o){r[n]=r[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const IE=M();function Iie(e,t,i,r,s,n,o,a,l,c,h){let p=s,f=s+1,g=s+o,y=s+o+1,v=a,b=a+1,w=a+2*n,S=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let x=0;x<n;++x)x===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),DZe(e,p,f,g,IE),b3(e,t,r,i,IE,v,p),b3(e,t,r,i,IE,b,f),b3(e,t,r,i,IE,w,g),b3(e,t,r,i,IE,S,y),l[c++]=v,l[c++]=w,l[c++]=S,l[c++]=v,l[c++]=S,l[c++]=b,p++,f++,g++,y++,v+=2,b+=2,w+=2,S+=2}const uk=M(),$ie=M(),Die=M(),Lie=M(),Nie=M();function DZe(e,t,i,r,s){t*=3,i*=3,r*=3,se(uk,e[t++],e[t++],e[t++]),se($ie,e[i++],e[i++],e[i++]),se(Die,e[r++],e[r++],e[r++]),de(Lie,$ie,uk),de(Nie,Die,uk),_t(s,Nie,Lie),Te(s,s)}const Dw=M();function LZe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords,o=n.length,a=t.mode!=="absolute-height";let l=0;const c=s.transformation,h=jr(Ae(),c);for(let p=0;p<o;p+=2){const f=n[p].geometry,g=f.getMutableAttribute(A.POSITION).data,y=f.vertexAttributes.get(A.SIZE).data,v=f.vertexAttributes.get(A.MAPPOS).data,b=new Zye(v),w=g.length/3;let S=0,x=!1,E=0;const R=i.spatialReference;for(let O=0;O<w;O++){Dw[0]=g[S],Dw[1]=g[S+1],Dw[2]=g[S+2],ug(b,i,t,r,w3),a&&(E+=w3.sampledElevation),Ni.TESTS_DISABLE_OPTIMIZATIONS?(se(dl,b.array[b.offset+0],b.array[b.offset+1],w3.z+y[S/3]),r.toRenderCoords(dl,R,dl),Fe(dl,dl,h)):(se(dl,g[S+0],g[S+1],g[S+2]),Fe(dl,dl,c),r.setAltitude(dl,w3.z+y[S/3]),Fe(dl,dl,h)),g[S]=dl[0],g[S+1]=dl[1],g[S+2]=dl[2];const I=NZe/r.unitInMeters;(Math.abs(Dw[0]-g[S])>=I||Math.abs(Dw[1]-g[S+1])>=I||Math.abs(Dw[2]-g[S+2])>=I)&&(x=!0),b.offset+=3,S+=3}x&&(f.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p]),n[p+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p+1])),l+=E/w}return l/o}const dl=M(),Ra=M(),w3=new dM,Fie=[0,2,1],Uie=[0,1,2],NZe=.01;function FZe(e,t,i,r,s){const n=e.referencesGeometry()&&s?UZe(t,r,s):t,o=e.repurposeFeature(n);try{return e.evaluate(ge(L({},i),{$feature:o}))}catch(a){return pe.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const hk=new Map;function UZe(e,t,i){const{transform:r,hasZ:s,hasM:n}=i;hk.has(t)||hk.set(t,zZe(t));const o=hk.get(t)(e.geometry,r,s,n);return ge(L({},e),{geometry:o})}function zZe(e){const t={};switch(e){case"esriGeometryPoint":return(i,r,s,n)=>ave(r,t,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>lve(r,t,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>cve(r,t,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>ove(r,t,i,s,n);default:return pe.getLogger("esri.views.2d.support.arcadeOnDemand").error(new Y("mapview-arcade",`Unable to handle geometryType: ${e}`)),i=>i}}const egt=1.2,kZe=Vm,BZe=Wu;class V4{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Yt.Geometry.ADD);if(t||this._addedToStage){for(const i of this.renderGeometries)i.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Yt.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Yt.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=M()){return se(t,0,0,0)}getBoundingBoxObjectSpace(t=Rs()){return ir(t)}addObjectState(t,i){t===lg.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Yt.State.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(i=>{t.removeRenderGeometry(i)})}removeRenderGeometryObjectState(t,i){t.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Yt.State.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const i of this.renderGeometries)i.computeAttachmentOrigin(Lw)&&(t.draped.origin[0]+=Lw[0],t.draped.origin[1]+=Lw[1],t.draped.num++)}async getProjectedBoundingBox(t,i,r,s,n){ir(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,zie,r),CEe(n,zie)}if(i){let o;ud(n,Lw);const a=xW(n,i);try{o=await i.service.queryElevation(Lw[0],Lw[1],s,a,"ground")}catch{}_(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,i,r,s){if(this.boundingBox)oF(Xd,this.boundingBox);else{const n=t.boundingSphere,o=n[3];Xd[0]=n[0]-o,Xd[1]=n[1]-o,Xd[2]=n[2]-o,Xd[3]=n[0]+o,Xd[4]=n[1]+o,Xd[5]=n[2]+o}return i(Xd,0,2),this.calculateRelativeScreenBounds&&s.push({location:ud(Xd),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),pj(Xd,r)}}const zie=Gt(),Xd=Rs(),Lw=M();class M_e{constructor(t,i,r,s=2048){this.text=t,this._alignment=i,this._parameters=r,this.maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),i=this.lineHeight;return Math.ceil(t+i+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*VZe}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(C(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case P0.Left:return this.backgroundHorizontalPadding;case P0.Center:return(this.displayWidth-this._lineWidths[t])/2;case P0.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,i=0,r=0){t.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this.haloSize,a=this.firstLineYOffset;i+=o,r+=a+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,i+p,r),this._renderLineDecoration(t,i+p,r,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(t,i+p,r,this._textWidths[c]),r+=this.lineSpacing}if(Ni.TEXT_SHOW_BASELINE){t.strokeStyle=kie,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this.baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this.lineSpacing}}if(Ni.TEXT_SHOW_BORDER&&(t.strokeStyle=kie,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this.hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this.baselinePosition}const l=n?this.haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),t.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),t.stroke()}_roundedRect(t,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=He(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(i,r+s),t.arcTo(i,r,i+s,r,s),t.lineTo(i+n-s,r),t.arcTo(i+n,r,i+n,r+s,s),t.lineTo(i+n,r+o-s),t.arcTo(i+n,r+o,i+n-s,r+o,s),t.lineTo(i+s,r+o),t.arcTo(i,r+o,i,r+o-s,s),t.closePath()):t.rect(i,r,n,o)}_renderHalo(t,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=X$(dk,Math.max(o,Nw),Math.max(a,Nw)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this.baselinePosition;for(let f=0;f<this._lines.length;++f){const g=this._getLineXOffset(f);this._renderLineDecoration(c,s+g,p,this._textWidths[f],!0),p+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),t.globalAlpha=1}_renderHaloEmulated(t,i,r){r+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of P_e)this._fillText(t,n,i+o+this.haloSize*a,r+this.haloSize*l);r+=this.lineSpacing}}_renderHaloNative(t,i,r){const s=2*this.haloSize;r+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,i+a,r)}r+=this.lineSpacing}}_setFontProperties(t,i){t.font=this._parameters.fontString(i),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(_(this._displayWidth))return this._displayWidth;const t=X$(dk,Nw,Nw).getContext("2d");this._setFontProperties(t,this.fontSize);let i=2*this.haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const o=t.measureText(n).width,a=o+i;this._textWidths.push(o),this._lineWidths.push(a),s=Math.max(s,a)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(C(this._heightMetrics)){const t=X$(dk,Nw,Nw).getContext("2d");this._setFontProperties(t,this.fontSize);const i=t.measureText(this.text+GZe),r=this.hasBackground?t.measureText(this._lines[0]):i,s=this._lines.length===1?r:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):i,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;this._heightMetrics={paddingTop:i.actualBoundingBoxAscent-r.actualBoundingBoxAscent,paddingBottom:i.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:i.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,i,r,s){t.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(t,i,r,s){t.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(t,i,r){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.stroke()}_drawBox(t,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const P_e=[];for(let t=0;t<360;t+=360/16)P_e.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var P0;function X$(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(P0||(P0={}));const dk={canvas:null},VZe=.2,Nw=512,kie="rgb(255, 0, 255, 0.5)",GZe=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),jZe={left:0,center:.5,right:1},Y$={"bottom-left":Oi(0,0),bottom:Oi(.5,0),"bottom-right":Oi(1,0),left:Oi(0,.5),center:Oi(.5,.5),right:Oi(1,.5),"top-left":Oi(0,1),top:Oi(.5,1),"top-right":Oi(1,1)};function I_e(e){switch(e){case"left":return P0.Left;case"right":return P0.Right;default:return P0.Center}}function Bie(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function HZe(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function qZe(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function WZe(e){return e==="middle"?"center":e}var Mo,Vie,mN;function $E(e){return e!=null}function Fw(e){return typeof e=="number"}function G4(e){return typeof e=="string"}function XZe(e){return e==null||G4(e)}function ks(e,t){e&&e.push(t)}function YZe(e,t,i,r=Ae()){const s=e||0,n=t||0,o=i||0;return s!==0&&bS(r,r,-s/180*Math.PI),n!==0&&_S(r,r,n/180*Math.PI),o!==0&&mF(r,r,o/180*Math.PI),r}function Gg(e,t,i,r,s){const n=e.minSize,o=e.maxSize;if(e.expression)return ks(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=r.symbolSize[i];return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=Mo.DefinedSize,!0}if($E(e.field))return $E(e.stops)?e.stops.length===2&&Fw(e.stops[0].size)&&Fw(e.stops[1].size)?(Gie(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=Mo.DefinedSize,!0):(ks(s,"Could not convert size info: stops only supported with 2 elements"),!1):Fw(n)&&Fw(o)&&$E(e.minDataValue)&&$E(e.maxDataValue)?(Gie(n,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=Mo.DefinedSize,!0):MS[e.valueUnit]!=null?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/MS[e.valueUnit],t.type[i]=Mo.DefinedSize,!0):e.valueUnit==="unknown"?(ks(s,"Could not convert size info: proportional size not supported"),!1):(ks(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!$E(e.field)){if(e.stops&&e.stops[0]&&Fw(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=Mo.DefinedSize,!0;if(Fw(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=Mo.DefinedSize,!0}return ks(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Gie(e,t,i,r,s,n){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-i*o,s.factor[n]=o}function ZZe(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return ks(r,"Could not convert size info: unsupported property"),null;if(!XZe(e.field))return ks(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return ks(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[Mo.Undefined,Mo.Undefined,Mo.Undefined]};let s;switch(e.axis){case"width":return s=Gg(e,t.size,0,i,r),s?t:null;case"height":return s=Gg(e,t.size,2,i,r),s?t:null;case"depth":return s=Gg(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=Gg(e,t.size,0,i,r),s&&Gg(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=Gg(e,t.size,0,i,r),s=s&&Gg(e,t.size,1,i,r),s=s&&Gg(e,t.size,2,i,r),s?t:null;default:return ks(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function QZe(e,t,i){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===Mo.DefinedSize&&(n*=t.modelSize[s],e.type[s]=Mo.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let r;if(e.type[0]!==Mo.Undefined)r=0;else if(e.type[1]!==Mo.Undefined)r=1;else{if(e.type[2]===Mo.Undefined)return ks(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===Mo.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}function jie(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function JZe(e,t,i){if(e.normalizationField)return ks(i,"Could not convert color info: unsupported property"),null;if(G4(e.field)){if(!e.stops)return ks(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return ks(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.color.values[s]=n.value,jie(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return ks(i,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,jie(t.color.colors,s,r)}}return t}function KZe(e,t,i){if(e.normalizationField)return ks(i,"Could not convert opacity info: unsupported property"),null;if(G4(e.field)){if(!e.stops)return ks(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return ks(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return ks(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=r}}return t}function pk(e,t,i){const r=i===2&&e.rotationType==="arithmetic";t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function eQe(e,t,i){if(!G4(e.field))return ks(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return ks(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return pk(e,t.rotation,0),t;case"roll":return pk(e,t.rotation,1),t;case null:case void 0:case"heading":return pk(e,t.rotation,2),t;default:return ks(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function $_e(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return ks(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?ZZe(c,l,t,i):l;case"color":return s?JZe(c,l,i):l;case"opacity":return o?KZe(c,l,i):null;case"rotation":return n?eQe(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!QZe(a.size,t,i)?null:a:null}function kW(e){return e&&e.size!=null}function mO(e,t){if(!e)return{enabled:!1};if(Ni.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=$_e(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:D_e(i,t),requiresShaderTransformation:kW(i)}:{enabled:!1}}function gO(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=$_e(t.visualVariables,i);return!!s&&!!(x3(r.size,s.size,"size")&&x3(r.color,s.color,"color")&&x3(r.rotation,s.rotation,"rotation")&&x3(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=D_e(s,i),e.requiresShaderTransformation=kW(s),!0)}function x3(e,t,i){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&i==="rotation"){const r=e,s=t;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function D_e(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=kW(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=Qi(),sf(eR),YZe(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],eR),Wl(i.vvSymbolRotationMatrix,eR)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(Mo||(Mo={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(Vie||(Vie={})),function(e){const t=Ae(),i=M();function r(n,o,a){if(!n.vvSizeEnabled)return a;os(t,a);const l=n.vvSymbolRotationMatrix;yf(eR,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),xr(t,t,eR);for(let c=0;c<3;++c){const h=n.vvSizeOffset[c]+o[0]*n.vvSizeFactor[c];i[c]=He(h,n.vvSizeMinSize[c],n.vvSizeMaxSize[c])}return kO(t,t,i),ga(t,t,n.vvSymbolAnchor),t}function s(n,o,a){if(!o.vvSizeEnabled)return se(n,1,1,1);for(let l=0;l<3;++l){const c=o.vvSizeOffset[l]+a[0]*o.vvSizeFactor[l];n[l]=He(c,o.vvSizeMinSize[l],o.vvSizeMaxSize[l])}return n}e.evaluateModelTransform=r,e.evaluateModelTransformScale=s}(mN||(mN={}));const eR=Ae(),RG=mN.evaluateModelTransform,tQe=mN.evaluateModelTransformScale;class iQe{constructor(){this.visible=!0}}class r2{constructor(t,i,r={}){this.data=t,this.material=i,this.boundingSphere=ii(),this.instanceParameters=new iQe,this._transformation=Ae(),this._shaderTransformationDirty=!0,this.layerUid=Tt(r.layerUid,null),this.graphicUid=Tt(r.graphicUid,null),this.id=r.id?r.id:Xa(),this.boundingInfo=Tt(r.boundingInfo,null),this.calculateShaderTransformation=Tt(this.calculateShaderTransformation,null),this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,i,r=gb(t)){C(this.boundingInfo)||(Fe(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return _(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return C(this.calculateShaderTransformation)?Tt(this.transformation,Es):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ae()),os(this._shaderTransformation,this.calculateShaderTransformation(Tt(this.transformation,Es))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(_(this._transformation)&&Fe(t,t,this._transformation),!0);const i=this.indices.get(A.POSITION),r=this.vertexAttributes.get(A.POSITION);return!!rye(r,i,t)&&(_(this._transformation)&&Fe(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new lN(lg.Highlight),i=this.instanceParameters;return i.highlights=lG(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=cG(i.highlights,t)}}const rQe=Ae(),Hie=Le(0,0,1),sQe=16,nQe=1.5,R1=vW,oQe=[R1/2,R1/2,1-R1/2,1-R1/2],aQe=[lO*R1,lO*R1];class yO extends Ef{constructor(t,i,r,s){super(t,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(_(r))this._prepareResourcesPrimitive(i,r);else{const s=kze(this.symbol,this.symbolLayer),n=hF(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),t):await this._prepareResourcesHref(i,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=E4(this._getIconSize());if(t)throw new Y("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,i=Math.round(t.size!=null?$o(t.size):sQe);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(t){const i=this._getGraphicHash(t);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:C0.PAD};r=new vs(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(t,i){const r=t.width/t.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(lQe(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;t.verticalOffset={screenLength:$o(r),minWorldLength:s||0,maxWorldLength:n!=null?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,i){const r=this._getOutlineSize();if(fk(i)&&r===0)throw new Error("Nothing to render");this._outlineSize=r,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const s=this._context.sharedResources.textures.fromData(i,()=>k0e(i));this._texture=s.texture,this._releaseTexture=s,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=oQe,t.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/R1,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,i,r){if(!ue("esri-canvas-svg-support")&&bj(i))throw new Y("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.pixelRatio,o=await Ad(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw hf(o.error),new Y("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,i,r){const s=new d2({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await import("./CIMSymbolRasterizer.6681e9e0.js")).CIMSymbolRasterizer;qt(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await g2e(p,this._context.layer.spatialReference,n);a=(g,y,v)=>{const b=FZe(f,g,{$view:v},"esriGeometryPoint",y);return b!==null?b:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];qt(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||xAe}_getOutlineSize(){let t=0;const i=this.symbolLayer;return _(i.outline)&&i.outline.size!=null?Math.max($o(i.outline.size),0):(t=fk(this._getPrimitive())?nQe:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),i=this.symbolLayer,r=Bs(i,"outline","color");if(_(r)){const s=rt.toUnitRGB(r),n=r.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(fk(this._getPrimitive()))return kZe;const t=C(this._getPrimitive()),i=Bs(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:t})}_getAnchorPos(t,i){return t==="relative"?Oi((i.x||0)+.5,.5-(i.y||0)):t in Y$?Y$[t]:Y$.center}_createMaterialAndAddToStage(t,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=mO(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let r=_(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return r||(r=new QS(t),this._cimSymbolMaterials.set(Tt(t.textureId,0),r),i.add(r)),r}return this._material=new QS(t),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=$i(this._releaseTexture)}_getScaleFactor(t,i){if(this._drivenProperties.size&&t.size){for(let r=0;r<3;r++){const s=t.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[r]=$o(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/i;if(isFinite(+t.size[2]))return+t.size[2]/i}return 1}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),f=L({textureId:p.id},this._cimMaterialParametersInfo);s=this._createMaterialAndAddToStage(f,this._context.stage),r=[p.params.width,p.params.height]}else r=this._size,s=this._material;const n=hO(i.geometry);if(C(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=[r[0]*l,r[1]*l],h=this.setGraphicElevationContext(i,new tu);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,s,a,c,t.layer.uid):this._createAs3DShape(i,n,s,a,c,h,i.uid)}layerOpacityChanged(){const t=this._getFillColor(),i=this._getOutlineColor();return this._forEachMaterial(r=>{r.setParameters({color:t}),r.setParameters({outlineColor:i})}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=hM(yO.elevationModeChangeTypes,r,s);if(n!==Lr.UPDATE)return n;const o=dh(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!gO(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return js.Recreate_Symbol;_(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return js.Fast_Update}_defaultElevationInfoNoZ(){return cQe}_createAs3DShape(t,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?g=>RG(this._fastUpdates.materialParameters,l,g):null,h=[Rl.createPointGeometry(Hie,null,s,n,uQe,null,l)],p=OW(this._context,i,h,[r],o,this._context.layer.uid,a,c);if(p===null)return null;const f=new Sf(this,p.object,h,null,null,cO,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=dh(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,g),uO(f,i,this._context.elevationProvider),f}_createAsOverlay(t,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=ii();Mr(i,a,this._context.overlaySR),a[2]=UW;const l=this._context.clippingExtent;if(_(l)&&!dj(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?y=>RG(this._fastUpdates.materialParameters,c,y):null,p=Rl.createPointGeometry(Hie,a,s,n,null,null,c),f=new r2(p,r,{layerUid:o,graphicUid:t.uid,calculateShaderTransformation:h});a[3]=0,Dc(f.boundingSphere,a);const g=new V4(this,[f],null,this._context.drapeSourceRenderer);return g.getScreenSize=this._createScreenSizeGetter(n,h),g.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(g.getScreenSize(),1,y),g}_createScreenSizeGetter(t,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=lt())=>{const a=i(rQe);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=t[0]/this._symbolTextureRatio+r,n=t[1]/this._symbolTextureRatio+r;return(o=lt())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Le(t,t,t),r=Sd(1),s=t*r;return{modelSize:i,symbolSize:Le(s,s,s),unitInMeters:r,transformation:{anchor:pa,scale:kp,rotation:pa}}}_getGraphicHash(t){let i="";for(const r of this._cimRequiredFields)i+=r+t.attributes[r];return i}_forEachMaterial(t){_(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return ge(L({},super.test()),{material:this._material})}}function lQe(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function fk(e){return!C(e)&&(e==="cross"||e==="x")}yO.PRIMITIVE_SIZE=aQe,yO.elevationModeChangeTypes={definedChanged:Lr.UPDATE,staysOnTheGround:Lr.NONE,onTheGroundChanged:Lr.RECREATE};const cQe={mode:"relative-to-ground",offset:0},uQe=ri(0,0,0,1);function OG(e){const t=[],i=[];pQe(e,i,t);const r=i[0][1].data,s=t[0][1].length,n=new Uint16Array(s);return fQe(e,i,t),mQe(e,i,t,n),yQe(e,i,t,n),gQe(e,i,t,n),vQe(e,i,t,n),_Qe(e,i,t,n),bQe(e,i,t,r),new Ar(i,t,Qa.Line)}function hQe(e,t,i,r){const s=e.type==="polygon"?af.CCW_IS_HOLE:af.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=pM(n,e.hasZ,s),l=new Float64Array(o.length),c=yve(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),h=c!=null;return{lines:h?L_e(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function L_e(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function dQe(e,t){const i=e.type==="polygon"?af.CCW_IS_HOLE:af.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=pM(r,!1,i),o=Pr(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=UW;return{lines:o?L_e(n,s):[],projectionSuccess:o}}function pQe(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=e,n=wQe(r)&&s===Db.REMOVE,o=r.length/3-(n?1:0),a=new Uint32Array(2*(o-1)),l=n?f7(r,0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([A.POSITION,{size:3,data:l,exclusive:n}]),i.push([A.POSITION,a])}function fQe(e,t,i){const r=e.attributeData.mapPosition;C(r)||(i.push([A.MAPPOS,i[0][1]]),t.push([A.MAPPOS,{size:3,data:r}]))}function mQe(e,t,i,r){if(_(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([A.COLOR,{size:4,data:Tt(s,BZe)}]),i.push([A.COLOR,r])}function gQe(e,t,i,r){const s=e.attributeData.colorFeature;C(s)||(t.push([A.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([A.COLOR,r]))}function yQe(e,t,i,r){if(_(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([A.SIZE,{size:1,data:[Tt(s,1)]}]),i.push([A.SIZE,r])}function vQe(e,t,i,r){const s=e.attributeData.sizeFeature;C(s)||(t.push([A.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([A.SIZEFEATUREATTRIBUTE,r]))}function _Qe(e,t,i,r){const s=e.attributeData.opacityFeature;C(s)||(t.push([A.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([A.OPACITYFEATUREATTRIBUTE,r]))}function bQe(e,t,i,r){if(C(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==je.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(r.length),n=Ci(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)Fj(r,f,s,f,n);const o=r.length/3,a=new Float32Array(o+1);let l=xQe,c=TQe,h=0,p=0;se(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),se(c,s[p++],s[p++],s[p++]),h+=age(l,c),a[f]=h,[l,c]=[c,l];t.push([A.DISTANCETOSTART,{size:1,data:a}]),i.push([A.DISTANCETOSTART,i[0][1]])}function wQe(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var Db;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(Db||(Db={}));const xQe=M(),TQe=M();function MG(e){switch(e){case"butt":return ih.BUTT;case"square":return ih.SQUARE;case"round":return ih.ROUND;default:return null}}const gN=64,N_e=gN/2,F_e=N_e/5;function SQe(e,t){return _(t)?EQe(e,AQe(t.style)):null}function EQe(e,t){return e.fromData(t,()=>k0e(t,gN,N_e,F_e))}function AQe(e){return e==="diamond"?"kite":e}function CQe(e){const t=new Fi;t.include(Gve,e),e.output===Q.Depth&&t.include(dv,e);const{vertex:i,fragment:r}=t;return r.include(mh),Gc(t,e),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.UV0,"vec2"),t.attributes.add(A.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(T`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),i.uniforms.add([new Ft("nearFar",F.Pass,(s,n)=>n.camera.nearFar),new dt("viewport",F.Pass,(s,n)=>n.camera.fullViewport)]),i.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),i.code.add(T`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(i.uniforms.add(new li("inverseProjectionMatrix",F.Pass,(s,n)=>n.camera.inverseProjectionMatrix)),i.code.add(T`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),i.code.add(T`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),i.uniforms.add(new ye("perScreenPixelRatio",F.Pass,(s,n)=>n.camera.perScreenPixelRatio)),i.code.add(T`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),i.uniforms.add(new ye("pixelRatio",F.Pass,(s,n)=>n.camera.pixelRatio)),i.code.add(T`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${T.float(gN/F_e)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||i.code.add(T`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),i.code.add(T`
        ${e.hasMultipassTerrain?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),t.include(Qc,e),t.include(es,e),r.uniforms.add([new dt("intrinsicColor",F.Pass,s=>s.color),new et("tex",F.Pass,s=>s.texture)]),r.include(wf),r.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${T.float(1/gN)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${T.float(co)}) {
      discard;
    }

    ${e.output===Q.Alpha?T`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===Q.Color?T`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===Q.Color&&e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===Q.Highlight?T`gl_FragColor = vec4(1.0);`:""}
    ${e.output===Q.Depth?T`outputDepth(linearDepth);`:""}
  }
  `),t}const RQe=Object.freeze(Object.defineProperty({__proto__:null,build:CQe},Symbol.toStringTag,{value:"Module"})),U_e=new Map([[A.POSITION,0],[A.UV0,2],[A.AUXPOS1,3],[A.SIZE,6],[A.SIZEFEATUREATTRIBUTE,6],[A.COLOR,5],[A.COLORFEATUREATTRIBUTE,5],[A.OPACITYFEATUREATTRIBUTE,7]]);class j4 extends Ki{initializeProgram(t){const i=j4.shader.get().build(this.configuration);return new Gi(t.rctx,i,U_e)}_makePipelineState(t,i){const r=this.configuration,s=t===gt.NONE;return Ut({blending:r.output===Q.Color||r.output===Q.Alpha?s?jc:Tg(t):null,depthTest:{func:hv(t)},depthWrite:s?r.writeDepth&&ol:w4(t),colorWrite:Qt,stencilWrite:r.hasOccludees?lf:null,stencilTest:r.hasOccludees?i?tv:pv:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ut({blending:jc,depthTest:hN,depthWrite:null,colorWrite:Qt,stencilWrite:null,stencilTest:Wve}),this._occluderPipelineOpaque=Ut({blending:jc,depthTest:hN,depthWrite:null,colorWrite:Qt,stencilWrite:Hve,stencilTest:qve}),this._occluderPipelineMaskWrite=Ut({blending:null,depthTest:DW,depthWrite:null,colorWrite:null,stencilWrite:lf,stencilTest:tv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===we.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===we.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}j4.shader=new Vi(RQe,()=>import("./LineMarker.glsl.4185faf0.js"));class Qo extends Io{constructor(){super(...arguments),this.output=Q.Color,this.transparencyPassType=gt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([B({count:Q.COUNT})],Qo.prototype,"output",void 0),u([B({count:gt.COUNT})],Qo.prototype,"transparencyPassType",void 0),u([B()],Qo.prototype,"occluder",void 0),u([B()],Qo.prototype,"hasSlicePlane",void 0),u([B()],Qo.prototype,"writeDepth",void 0),u([B()],Qo.prototype,"draped",void 0),u([B()],Qo.prototype,"hasCap",void 0),u([B()],Qo.prototype,"vvSize",void 0),u([B()],Qo.prototype,"vvColor",void 0),u([B()],Qo.prototype,"vvOpacity",void 0),u([B()],Qo.prototype,"hasOccludees",void 0),u([B()],Qo.prototype,"hasMultipassTerrain",void 0),u([B()],Qo.prototype,"cullAboveGround",void 0),u([B({constValue:!0})],Qo.prototype,"hasVvInstancing",void 0),u([B({constValue:!0})],Qo.prototype,"hasSliceTranslatedView",void 0);class OQe extends Tf{constructor(t){super(t,new PQe),this._vertexAttributeLocations=U_e,this.techniqueConfig=new Qo,this.layout=this.createLayout()}dispose(){}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===we.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==ih.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===wr.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=ls().vec3f(A.POSITION).vec2f(A.UV0).vec3f(A.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(A.SIZEFEATUREATTRIBUTE):t.f32(A.SIZE),this.parameters.vvColorEnabled?t.f32(A.COLORFEATUREATTRIBUTE):t.vec4f(A.COLOR),this.parameters.vvOpacityEnabled&&t.f32(A.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new IQe(this.layout,this.parameters)}requiresSlot(t,i){if(t===we.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===wr.OccludeAndTransparentStencil)return t===we.OPAQUE_MATERIAL||t===we.OCCLUDER_MATERIAL||t===we.TRANSPARENT_OCCLUDER_MATERIAL;const r=Mb(i);return r===Q.Color||r===Q.Alpha?t===(this.parameters.writeDepth?we.TRANSPARENT_MATERIAL:we.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===we.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===Q.Color||t.output===Q.Alpha||t.output===Q.Highlight||t.output===Q.Depth?new MQe(t):null}}class MQe extends Sq{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.passParameters),this.ensureTechnique(j4,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==Q.Color&&this._output!==Q.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class PQe extends $W{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=ih.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class IQe{constructor(t,i){this.vertexBufferLayout=t,this.parameters=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,i,r,s){const n=i.vertexAttributes.get(A.POSITION).data,o=n.length/3;let a=1,l=0;this.parameters.vvSizeEnabled?l=i.vertexAttributes.get(A.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(A.SIZE)&&(a=i.vertexAttributes.get(A.SIZE).data[0]);let c=[1,1,1,1],h=0;this.parameters.vvColorEnabled?h=i.vertexAttributes.get(A.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(A.COLOR)&&(c=i.vertexAttributes.get(A.COLOR).data);let p=0;this.parameters.vvOpacityEnabled&&(p=i.vertexAttributes.get(A.OPACITYFEATUREATTRIBUTE).data[0]);const f=t.transformation,g=new Float32Array(r.buffer);let y=s*(this.vertexBufferLayout.stride/4);const v=(x,E,R,O)=>{if(g[y++]=x[0],g[y++]=x[1],g[y++]=x[2],g[y++]=R[0],g[y++]=R[1],g[y++]=E[0],g[y++]=E[1],g[y++]=E[2],this.parameters.vvSizeEnabled?g[y++]=l:g[y++]=a,this.parameters.vvColorEnabled)g[y++]=h;else{const I=Math.min(4*O,c.length-4);g[y++]=c[I+0],g[y++]=c[I+1],g[y++]=c[I+2],g[y++]=c[I+3]}this.parameters.vvOpacityEnabled&&(g[y++]=p)};let b;(function(x){x[x.ASCENDING=1]="ASCENDING",x[x.DESCENDING=-1]="DESCENDING"})(b||(b={}));const w=(x,E)=>{const R=se($Qe,n[3*x],n[3*x+1],n[3*x+2]),O=DQe;let I=x+E;do se(O,n[3*I],n[3*I+1],n[3*I+2]),I+=E;while(sS(R,O)&&I>=0&&I<o);f&&(Fe(R,R,f),Fe(O,O,f)),v(R,O,[-1,-1],x),v(R,O,[1,-1],x),v(R,O,[1,1],x),v(R,O,[-1,-1],x),v(R,O,[1,1],x),v(R,O,[-1,1],x)},S=this.parameters.placement;S!=="begin"&&S!=="begin-end"||w(0,b.ASCENDING),S!=="end"&&S!=="begin-end"||w(o-1,b.DESCENDING)}}const $Qe=M(),DQe=M(),bo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},LQe={dash:bo.dash,"dash-dot":[...bo.dash,...bo.dot],dot:bo.dot,"long-dash":bo["long-dash"],"long-dash-dot":[...bo["long-dash"],...bo.dot],"long-dash-dot-dot":[...bo["long-dash"],...bo.dot,...bo.dot],none:null,"short-dash":bo["short-dash"],"short-dash-dot":[...bo["short-dash"],...bo["short-dot"]],"short-dash-dot-dot":[...bo["short-dash"],...bo["short-dot"],...bo["short-dot"]],"short-dot":bo["short-dot"],solid:null},NQe=8;function FQe(e,t=2){return C(e)?e:{pattern:e.slice(),pixelRatio:t}}function tgt(e,t=2){return{pattern:[e,e],pixelRatio:t}}function z_e(e){return _(e)&&e.type==="style"?UQe(e.style):null}function UQe(e){return _(e)?FQe(LQe[e],NQe):null}const zQe=["polyline","polygon","extent"];class H4 extends Ef{constructor(t,i,r,s){super(t,i,r,s),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=mO(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:Sd(1);if(t<0)throw new Y("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=SQe(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,i=!1){var r;const s=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(s[3]=0);const n={width:this._computeMaterialWidth((r=this.symbolLayer)==null?void 0:r.size),color:s,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:MG(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:z_e(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?L(L({},n),this._fastUpdates.materialParameters):n}get _materialColor(){return Ks(this.symbolLayer.material,t=>t.color)}get _markerColor(){return Ks(this.symbolLayer.marker,t=>t.color)}get lineMaterial(){return C(this._lineMaterial)&&(this._lineMaterial=new yT(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return C(this._ringMaterial)&&(this._ringMaterial=new yT(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return C(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new yT(ge(L({},this._getMaterialParameters(!1)),{wireframe:!0})),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return C(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new yT(ge(L({},this._getMaterialParameters(!0)),{wireframe:!0})),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return C(this._markerMaterial)&&_(this.symbolLayer.marker)&&_(this._markerTexture)&&(this._markerMaterial=new OQe(ge(L({},this._getMaterialParameters(!1,!0)),{placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id})),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=$i(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?$o(LXe(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?qm(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const i=ri(1,1,1,1);return this._drivenProperties.color&&t.color&&(i[0]=t.color[0],i[1]=t.color[1],i[2]=t.color[2],t.color.length>0&&(i[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(i[3]=t.opacity),i}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?qm(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?qm(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,zQe,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new tu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,r,i.uid)}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!gO(this._fastUpdates,i,this._vvConvertOptions))return js.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return js.Fast_Update}prepareSymbolLayerPatch(t){var i,r;if(t.diff.type!=="partial")return;const s=t.diff.diff,n={};((i=s.size)==null?void 0:i.type)==="complete"&&(n.width=this._computeMaterialWidth(s.size.newValue),delete s.size),((r=s.cap)==null?void 0:r.type)==="complete"&&(n.cap=MG(Tt(s.cap.newValue,"butt")),delete s.cap);const o=this._prepareMarkerPatch(t,s);this._prepareMaterialPatch(t,s,o),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(n)))}layerOpacityChanged(){return this._forEachMaterial((t,i)=>this._updateMaterialLayerOpacity(t,i)),!0}_forEachMaterial(t){_(this._lineMaterial)&&t(this._lineMaterial),_(this._ringMaterial)&&t(this._ringMaterial),_(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),_(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),_(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,i=!1){const r=t.parameters.color,s=Bs(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=ri(r[0],r[1],r[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=hM(H4.elevationModeChangeTypes,r,s);if(n!==Lr.UPDATE)return n;const o=dh(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof ni)return jl.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,i,r){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=new Array,c=new Array,h=Rs(),p=hQe(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,o,f,"LineSymbol3DLayer");for(let v=0;v<p.lines.length;v++){const{position:b,mapPosition:w}=p.lines[v];if(_(this._context.clippingExtent)&&(ir(h),Fc(h,w),!hd(h,this._context.clippingExtent)))continue;const S=this._createGeometry(t,b,w,n.type,tR.ELEVATED);a.push(S),l.push(n.type==="polygon"?this.ringMaterial:this.lineMaterial),c.push(Es),Ni.LINE_WIREFRAMES&&(a.push(S.cloneShallow()),l.push(n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(Es));const x=this.markerMaterial;_(x)&&(a.push(S.cloneShallow()),l.push(x),c.push(Es))}if(a.length===0)return null;const g=new Eg({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),y=new Sf(this,g,a,null,null,BWe,i);return y.alignedSampledElevation=p.sampledElevation,y.needsElevationUpdates=dh(i.mode),y}_createGeometry(t,i,r,s,n){const o=s==="polygon"?Db.REMOVE:Db.KEEP,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return OG({overlayInfo:n===tR.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:o,uniformSize:this._uniformSize,attributeData:{position:i,mapPosition:r,size:l?null:this._getDrivenSize(t.renderingInfo),color:a?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,i){const r=t.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const a=Ni.LINE_WIREFRAMES?s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;_(a)&&(a.renderPriority=this._renderPriority-.001),_(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=Rs(),p=ir(),f=dQe(s,this._context.overlaySR),g=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,g,"LineSymbol3DLayer");for(const y of f.lines){if(ir(h),Fc(h,y.position),!hd(h,this._context.clippingExtent))continue;fS(p,h);const v=this._createGeometry(t,y.position,null,s.type,tR.DRAPED),b=S=>{const x=new r2(v,S,{layerUid:i,graphicUid:r.uid});return c.push(x),x};if(_(l)){const S=b(l),x=this.symbolLayer.marker.placement;x!=="begin"&&x!=="begin-end"||Fc(h,y.position,0,1),x!=="end"&&x!=="begin-end"||Fc(h,y.position,y.position.length-3,1),this._updateBoundingSphere(S,h)}const w=b(o);if(this._updateBoundingSphere(w,h),Ni.LINE_WIREFRAMES){const S=b(a);this._updateBoundingSphere(S,h)}}return new V4(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,i){Wi(t.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return _(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=Tt(t,Sd(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?$o(1):1:$o(t)}_prepareMaterialPatch(t,i,r){const s=i.material;if(C(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,t));if(s.type==="collection")return;const n=s.type==="complete"?Ks(s.newValue,a=>a.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(bF(o),this._markerMaterial,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterial,t),delete i.material}_prepareMarkerPatch(t,i){const r=i.marker;if(C(r)||r.type!=="partial"||_(r.diff.style)||_(r.diff.placement)||_(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:C(this._markerColor)};const s=r.diff.color;if(C(s))return delete i.marker,{changed:!1,useMaterialColor:C(this._markerColor)};const n=s.newValue;return C(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,t),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,i,r){C(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:t}))}}var tR;H4.elevationModeChangeTypes={definedChanged:Lr.RECREATE,staysOnTheGround:Lr.NONE,onTheGroundChanged:Lr.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(tR||(tR={}));const qie=2048,kQe=1.5,BQe=8;function VQe(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},o=BW(e,t.padding),a=KQe(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=JQe(e,a),h=iJe(i),p=aJe[h];return{format:h,quality:He(r!=null?r:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function GQe(e,t){const i=VQe(e,t),r=i.area,s=i.width/r.width,n=BW(i,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],g=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:g,ignorePadding:y}}function jQe(e,t,i){const{ctx:r,canvas:s}=k_e(e,i),n=r.getImageData(0,0,e.width,e.height),o=WQe(s,t);return B_e(s),{dataUrl:o,data:n}}function HQe(e,t){const{ctx:i,canvas:r}=k_e(e,t),s=i.getImageData(0,0,e.width,e.height);return B_e(r),s}function k_e(e,t){const i=qQe();t.premultipliedAlpha&&sJe(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d");return r.putImageData(e,0,0),t.flipY&&rJe(r),{ctx:r,canvas:i}}function B_e(e){e.width=0,e.height=0}function qQe(){return C(mk)&&(mk=document.createElement("canvas")),mk}let mk=null;function WQe(e,t){const i=nJe[t.format],r=t.quality/100;return e.toDataURL(i,r)}function gk(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(yN)try{return new ImageData(e,t)}catch{yN=!1}return V_e(e,t,i)}function XQe(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(yN)try{return new ImageData(e,t,i)}catch{yN=!1}const s=V_e(t,i,r);return s.data.set(e,0),s}function YQe(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,f=n/c,g=o/h,y=Math.ceil(f/2),v=Math.ceil(g/2),b=e.width;for(let w=0;w<h;w++)for(let S=0;S<c;S++){const x=4*(S+(a?h-w-1:w)*c);let E=0,R=0,O=0,I=0,U=0,N=0;const V=(w+.5)*g;for(let j=Math.floor(w*g);j<(w+1)*g;j++){const H=Math.abs(V-(j+.5))/v,J=(S+.5)*f,K=H*H;for(let he=Math.floor(S*f);he<(S+1)*f;he++){const le=Math.abs(J-(he+.5))/y,$=Math.sqrt(K+le*le);if($>=1)continue;let z=2*$*$*$-3*$*$+1;const k=4*(r+he+(s+j)*b);N+=z*l[k+3],R+=z,!i&&l[k+3]<255&&(z=z*l[k+3]/255),O+=z*l[k],I+=z*l[k+1],U+=z*l[k+2],E+=z}}p[x]=O/E,p[x+1]=I/E,p[x+2]=U/E,p[x+3]=N/R}return t}function ZQe(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,a=BW(e,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=s-c,f=Math.min(BQe,Math.min((qie-l)/h,(qie-c)/p));return f<kQe?e:ge(L({},e),{framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}})}function V_e(e,t,i){return i||(i=QQe()),i.getContext("2d").createImageData(e,t)}let DE=null,yN=!0;function QQe(){return DE||(DE=document.createElement("canvas"),DE.width=1,DE.height=1),DE}function JQe(e,t){if(!e)return t;const i=e.width,r=e.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return t;const s=t.width/t.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function KQe(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(i.x=Math.floor(e.area.x)),e.area.y!=null&&(i.y=Math.floor(e.area.y));const r=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return eJe(tJe(i,e),t)}function eJe(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function tJe(e,t){if(!t||t.width==null||t.height==null)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const n=Math.floor(e.height*i);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}function BW(e,t){return!t||e&&e.ignorePadding?lJe:t}function iJe(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return oJe}}function rJe(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function sJe(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s!==255&&s>0){const n=255/s;t[r+0]=t[r+0]*n,t[r+1]=t[r+1]*n,t[r+2]=t[r+2]*n}}}const nJe={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Wie=98,oJe="png",aJe={png:100,jpg:Wie,jpeg:Wie},lJe={top:0,right:0,bottom:0,left:0};var jx;const yk=new WeakMap;let cJe=0,vp=jx=class extends _e{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:nb(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[i]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:nb(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[i]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const i=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(yk.has(this.data)||yk.set(this.data,++cJe),t(yk.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new jx(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return XQe(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new jx({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new jx({data:e}):rS(jx,e)}};u([d({type:String,json:{write:U0}})],vp.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],vp.prototype,"data",null),u([Xe("data")],vp.prototype,"writeData",null),u([Ne("data")],vp.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],vp.prototype,"transparent",null),u([d({json:{write:!0}})],vp.prototype,"wrap",void 0),u([d({readOnly:!0})],vp.prototype,"contentHash",null),vp=jx=u([P("esri.geometry.support.MeshTexture")],vp);const GT=vp;var PG;let cm=PG=class extends _e{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new PG(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:_(this.color)?this.color.clone():null,colorTexture:_(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:_(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};u([d({type:rt,json:{write:!0}})],cm.prototype,"color",void 0),u([d({type:GT,json:{write:!0}})],cm.prototype,"colorTexture",void 0),u([d({type:GT,json:{write:!0}})],cm.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],cm.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],cm.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],cm.prototype,"doubleSided",void 0),cm=PG=u([P("esri.geometry.support.MeshMaterial")],cm);const VW=cm;var IG;let um=IG=class extends VW{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new IG(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return ge(L({},super.clonePropertiesWithDeduplication(e)),{emissiveColor:_(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:_(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:_(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:_(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null})}};u([d({type:rt,json:{write:!0}})],um.prototype,"emissiveColor",void 0),u([d({type:GT,json:{write:!0}})],um.prototype,"emissiveTexture",void 0),u([d({type:GT,json:{write:!0}})],um.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],um.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],um.prototype,"roughness",void 0),u([d({type:GT,json:{write:!0}})],um.prototype,"metallicRoughnessTexture",void 0),um=IG=u([P("esri.geometry.support.MeshMaterialMetallicRoughness")],um);const vN=um;var Z$;const Uw=pe.getLogger("esri.geometry.support.MeshVertexAttributes");let aa=Z$=class extends _e{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return Hx(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},Uw)}castPosition(e){return e&&e instanceof Float32Array&&Uw.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),Hx(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},Uw)}castUv(e){return Hx(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},Uw)}castNormal(e){return Hx(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},Uw)}castTangent(e){return Hx(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},Uw)}clone(){const e={position:re(this.position),uv:re(this.uv),normal:re(this.normal),tangent:re(this.tangent),color:re(this.color)};return new Z$(e)}clonePositional(){const e={position:re(this.position),normal:re(this.normal),tangent:re(this.tangent),uv:this.uv,color:this.color};return new Z$(e)}};function vk(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function Hx(e,t,i,r,s){if(!e)return e;if(e instanceof t)return vk(e,r,t,s);for(const n of i)if(e instanceof n)return vk(new t(e),r,t,s);if(Array.isArray(e))return vk(new t(e),r,t,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function LE(e,t,i){t[i]=uJe(e)}function uJe(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}u([d({json:{write:LE}})],aa.prototype,"color",void 0),u([Bt("color")],aa.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:LE}})],aa.prototype,"position",void 0),u([Bt("position")],aa.prototype,"castPosition",null),u([d({json:{write:LE}})],aa.prototype,"uv",void 0),u([Bt("uv")],aa.prototype,"castUv",null),u([d({json:{write:LE}})],aa.prototype,"normal",void 0),u([Bt("normal")],aa.prototype,"castNormal",null),u([d({json:{write:LE}})],aa.prototype,"tangent",void 0),u([Bt("tangent")],aa.prototype,"castTangent",null),aa=Z$=u([P("esri.geometry.support.MeshVertexAttributes")],aa);var cC;const hJe=pe.getLogger("esri.geometry.support.MeshComponent");let hm=cC=class extends _e{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return rS(cC,e)}castFaces(e){return Hx(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},hJe)}castMaterial(e){return rS(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?vN:VW,e)}clone(){return new cC({faces:re(this.faces),shading:this.shading,material:re(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:re(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new cC(i)}};u([d({json:{write:!0}})],hm.prototype,"faces",void 0),u([Bt("faces")],hm.prototype,"castFaces",null),u([d({type:VW,json:{write:!0}})],hm.prototype,"material",void 0),u([Bt("material")],hm.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],hm.prototype,"shading",void 0),u([d({type:Boolean})],hm.prototype,"trustSourceNormals",void 0),hm=cC=u([P("esri.geometry.support.MeshComponent")],hm);const rv=hm,q4=pe.getLogger("esri.geometry.support.meshUtils.normalProjection");function _M(e,t,i,r,s){return J4(r)?(Q4(Wm.TO_PCPF,pi.fromTypedArray(e),yr.fromTypedArray(t),yr.fromTypedArray(i),r,pi.fromTypedArray(s)),s):(q4.error("Cannot convert spatial reference to PCPF"),s)}function W4(e,t,i,r,s){return J4(r)?(Q4(Wm.FROM_PCPF,pi.fromTypedArray(e),yr.fromTypedArray(t),yr.fromTypedArray(i),r,pi.fromTypedArray(s)),s):(q4.error("Cannot convert to spatial reference from PCPF"),s)}function X4(e,t,i){return Pr(e,t,0,i,fg(t),0,e.length/3),i}function Y4(e,t,i){return Pr(e,fg(i),0,t,i,0,e.length/3),t}function G_e(e,t,i){if(C(e))return t;const r=yr.fromTypedArray(e),s=yr.fromTypedArray(t);return hg(s,r,i),t}function j_e(e,t,i){if(C(e))return t;G0(ln,i);const r=pi.fromTypedArray(e),s=pi.fromTypedArray(t);return $d(s,r,ln),Iq(ln)||PW(s,s),t}function H_e(e,t,i){if(C(e))return t;G0(ln,i);const r=pi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=pi.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if($d(s,r,ln),Iq(ln)||PW(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function bM(e,t,i,r,s){if(!J4(r))return q4.error("Cannot convert spatial reference to PCPF"),s;Q4(Wm.TO_PCPF,pi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),yr.fromTypedArray(t),yr.fromTypedArray(i),r,pi.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function Z4(e,t,i,r,s){if(!J4(r))return q4.error("Cannot convert to spatial reference from PCPF"),s;Q4(Wm.FROM_PCPF,pi.fromTypedArray(e,16),yr.fromTypedArray(t),yr.fromTypedArray(i),r,pi.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function Q4(e,t,i,r,s,n){if(!t)return;const o=i.count,a=fg(s);if(q_e(s))for(let l=0;l<o;l++)r.getVec(l,T3),t.getVec(l,Yd),nl(a,T3,S3,a),Wl(ln,S3),e===Wm.FROM_PCPF&&lh(ln,ln),so(Yd,Yd,ln),n.setVec(l,Yd);else for(let l=0;l<o;l++){r.getVec(l,T3),t.getVec(l,Yd),nl(a,T3,S3,a),Wl(ln,S3);const c=DD(i.get(l,1));let h=Math.cos(c);e===Wm.TO_PCPF&&(h=1/h),ln[0]*=h,ln[1]*=h,ln[2]*=h,ln[3]*=h,ln[4]*=h,ln[5]*=h,e===Wm.FROM_PCPF&&lh(ln,ln),so(Yd,Yd,ln),Te(Yd,Yd),n.setVec(l,Yd)}return n}function J4(e){return q_e(e)||dJe(e)}function q_e(e){return e.isWGS84||Tae(e)||pf(e)||ff(e)}function dJe(e){return e.isWebMercator}var Wm;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(Wm||(Wm={}));const T3=M(),Yd=M(),S3=Ae(),ln=Qi();function pJe(e){const t=new Fi;t.include(ao),t.include(iw,e),t.include(jve,e),Gc(t,e);const{vertex:i,fragment:r}=t;return e.stippleEnabled&&(t.attributes.add(A.UV0,"vec2"),t.attributes.add(A.AUXPOS1,"vec3"),i.uniforms.add(new dt("viewport",F.Pass,(s,n)=>n.camera.fullViewport))),t.attributes.add(A.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(T`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(T`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new ye("worldToScreenRatio",F.Pass,(s,n)=>1/n.screenToPCSRatio)):i.code.add(T`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(T`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(T`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(T`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(T`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(T`}`),e.output===Q.Highlight&&t.include(xg),t.include(es,e),r.uniforms.add(new ye("alphaCoverage",F.Pass,(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||r.uniforms.add(new dt("constantColor",F.Pass,s=>s.color)),r.code.add(T`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${T.float(co)}) {
      discard;
    }

    ${e.output===Q.Color?T`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===Q.Highlight?T`outputHighlight();`:""}
  }
  `),t}const fJe=Object.freeze(Object.defineProperty({__proto__:null,build:pJe},Symbol.toStringTag,{value:"Module"}));class K4 extends Ki{constructor(t,i,r){super(t,i,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==Q.Highlight}initializeProgram(t){const i=K4.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}initializePipeline(){const t=this.configuration,i=po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Ut({blending:n,depthTest:DW,depthWrite:o,colorWrite:Qt,stencilWrite:t.hasOccludees?lf:null,stencilTest:t.hasOccludees?s?tv:pv:null});return t.output===Q.Color?(this._occludeePipelineState=r(!0,t.transparent||this.stippleEnabled?i:null,ol),r(!1,t.transparent||this.stippleEnabled?i:null,ol)):r(!1)}get primitiveType(){return Dt.LINES}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}K4.shader=new Vi(fJe,()=>import("./NativeLine.glsl.b5fbd74a.js"));class pc extends Io{constructor(){super(...arguments),this.output=Q.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([B({count:Q.COUNT})],pc.prototype,"output",void 0),u([B()],pc.prototype,"hasSlicePlane",void 0),u([B()],pc.prototype,"hasVertexColors",void 0),u([B()],pc.prototype,"transparent",void 0),u([B()],pc.prototype,"draped",void 0),u([B()],pc.prototype,"stippleEnabled",void 0),u([B()],pc.prototype,"stippleOffColorEnabled",void 0),u([B()],pc.prototype,"stipplePreferContinuous",void 0),u([B()],pc.prototype,"hasOccludees",void 0),u([B({constValue:!1})],pc.prototype,"stippleRequiresClamp",void 0),u([B({constValue:!1})],pc.prototype,"stippleScaleWithLineWidth",void 0),u([B({constValue:!1})],pc.prototype,"stippleRequiresStretchMeasure",void 0);const mJe=pe.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var _N;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(_N||(_N={}));class Xie extends Tf{constructor(t){super(t,new vJe),this._techniqueConfig=new pc}getConfiguration(t,i){this._techniqueConfig.output=t,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=i.slot===we.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?zHe(t,s,c,o,1,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||nM(i))return;if(!tye(r))return void mJe.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes.get(A.POSITION).data,a=s.camera,l=bJe;Bn(l,s.point);const c=2;se(NE[0],l[0]-c,l[1]+c,0),se(NE[1],l[0]+c,l[1]+c,0),se(NE[2],l[0]+c,l[1]-c,0),se(NE[3],l[0]-c,l[1]-c,0);for(let y=0;y<4;y++)if(!a.unprojectFromRenderScreen(NE[y],Nf[y]))return;Oo(a.eye,Nf[0],Nf[1],_k),Oo(a.eye,Nf[1],Nf[2],bk),Oo(a.eye,Nf[2],Nf[3],wk),Oo(a.eye,Nf[3],Nf[0],xk);let h=Number.MAX_VALUE,p=0;for(let y=0;y<o.length-5;y+=3){if(Jo[0]=o[y]+r[12],Jo[1]=o[y+1]+r[13],Jo[2]=o[y+2]+r[14],Ko[0]=o[y+3]+r[12],Ko[1]=o[y+4]+r[13],Ko[2]=o[y+5]+r[14],mr(_k,Jo)<0&&mr(_k,Ko)<0||mr(bk,Jo)<0&&mr(bk,Ko)<0||mr(wk,Jo)<0&&mr(wk,Ko)<0||mr(xk,Jo)<0&&mr(xk,Ko)<0)continue;if(a.projectToRenderScreen(Jo,Vv),a.projectToRenderScreen(Ko,Gv),Vv[2]<0&&Gv[2]>0){de(Zd,Jo,Ko);const b=a.frustum,w=-mr(b[cr.NEAR],Jo)/Se(Zd,b[cr.NEAR]);oe(Zd,Zd,w),fe(Jo,Jo,Zd),a.projectToRenderScreen(Jo,Vv)}else if(Vv[2]>0&&Gv[2]<0){de(Zd,Ko,Jo);const b=a.frustum,w=-mr(b[cr.NEAR],Ko)/Se(Zd,b[cr.NEAR]);oe(Zd,Zd,w),fe(Ko,Ko,Zd),a.projectToRenderScreen(Ko,Gv)}else if(Vv[2]<0&&Gv[2]<0)continue;Vv[2]=0,Gv[2]=0;const v=Wj(F1(Vv,Gv,Qie),l);v<h&&(h=v,ne(Yie,Jo),ne(Zie,Ko),p=y/3)}const f=s.rayBegin,g=s.rayEnd;if(h<c*c){let y=Number.MAX_VALUE;if(Gue(F1(Yie,Zie,Qie),F1(f,g,_Je),Bv)){de(Bv,Bv,f);const v=Ie(Bv);oe(Bv,Bv,1/v),y=v/Yi(f,g)}n(y,Bv,p,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(A.POSITION);return zq(s,null,!1,i)}requiresSlot(t){return t===we.OPAQUE_MATERIAL||t===we.DRAPED_MATERIAL}createGLMaterial(t){return t.output===Q.Color||t.output===Q.Highlight?new gJe(t):null}createBufferWriter(){const t=this.parameters.hasVertexColors?l_e:$Ye;return C(this.parameters.stipplePattern)?new z4(t):new yJe(t.clone().vec3f(A.AUXPOS1).vec2f(A.UV0))}}class gJe extends cv{_updateParameters(t){return this.ensureTechnique(K4,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output===Q.Color&&this._updateOccludeeState(t),this._updateParameters(t)}}class yJe{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(A.POSITION).length}write(t,i,r,s){_4(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s),this._writeAuxpos1(t,i,r,s),this._writeUV0(t,i,r,s)}_writeAuxpos1(t,i,r,s){const n=r.getField(A.AUXPOS1,pi),o=i.indices.get(A.POSITION),a=i.vertexAttributes.get(A.POSITION).data,l=t.transformation,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const g=3*o[p+f],y=a[g],v=a[g+1],b=a[g+2],w=l[0]*y+l[4]*v+l[8]*b+l[12],S=l[1]*y+l[5]*v+l[9]*b+l[13],x=l[2]*y+l[6]*v+l[10]*b+l[14];h[s]=w,h[s+1]=S,h[s+2]=x,s+=c}}_writeUV0(t,i,r,s){var n;const o=r.getField(A.UV0,uh),a=i.indices.get(A.POSITION),l=i.vertexAttributes.get(A.POSITION).data,c=(n=i.vertexAttributes.get(A.DISTANCETOSTART))==null?void 0:n.data,h=t.transformation,p=o.typedBufferStride,f=o.typedBuffer;let g=0;f[s*=p]=_N.START,f[s+1]=g,s+=p;const y=3*a[0],v=se(Jo,l[y],l[y+1],l[y+2]);h&&Fe(v,v,h);const b=Ko,w=a.length-1;let S=1;const x=c?(R,O,I)=>g=c[I]:(R,O,I)=>g+=Yi(R,O);for(let R=1;R<w;R+=2){const O=3*a[R];se(b,l[O],l[O+1],l[O+2]),h&&Fe(b,b,h),x(v,b,S++);for(let I=0;I<2;++I)f[s]=1-I,f[s+1]=g,s+=p;ne(v,b)}const E=3*a[w];se(b,l[E],l[E+1],l[E+2]),h&&Fe(b,b,h),x(v,b,S),f[s]=_N.END,f[s+1]=g}}class vJe extends U2{constructor(){super(...arguments),this.color=Wu,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const Jo=M(),Ko=M(),Zd=M(),Bv=M(),Vv=no(),Gv=no(),Yie=M(),Zie=M(),Qie=nv(),_Je=nv(),bJe=M(),NE=[no(),no(),no(),no()],Nf=[M(),M(),M(),M()],_k=fi(),bk=fi(),wk=fi(),xk=fi(),wJe=["mesh"];class xJe extends Ef{constructor(t,i,r,s){super(t,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Ni.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Xie({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Xie({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,wJe,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new tu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(t,i){const r=this._getLayerOpacity();return this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=i(s);_(n)&&n.layerOpacityChanged(r,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,ev)}slicePlaneEnabledChanged(t,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return C(t)?"-":t instanceof rt?t.toHex():t.contentHash}_materialPropertiesDefault(t,i){const r=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(t,i,r){const s=this._materialPropertiesDefault(t,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),g=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${g},ds:${l},ac:${c},am:${h}`,i.material instanceof vN){const{metallic:y,roughness:v,metallicRoughnessTexture:b,emissiveColor:w,emissiveTexture:S,occlusionTexture:x}=i.material,E=this._colorOrTextureUid(b),R=this._colorOrTextureUid(w),O=this._colorOrTextureUid(S),I=this._colorOrTextureUid(x);s.metallic=y,s.roughness=v,s.metallicRoughnessTexture=b,s.emissiveColor=w,s.emissiveTexture=S,s.occlusionTexture=x,s.uid=`${s.uid},mrm:${y},mrr:${v},mrt:${E},emuid:${R},etmuid:${O},otmuid:${I}`}return s}_setInternalColorValueParameters(t,i){i.diffuse=rt.toUnitRGB(t),i.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const i=this._getInternalTexture(t,Xi.Opaque);return _(i)?i.id:null}_getInternalTexture(t,i){const r=this._getLoadableTextureResource(t);if(!r)return null;const s=`${t.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new vs(r,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:i!==Xi.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const i=this._castTextureWrapIndividual(t);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return bt.CLAMP_TO_EDGE;case"mirror":return bt.MIRRORED_REPEAT;default:return bt.REPEAT}}_setInternalMaterialParameters(t,i){if(_(t.color)&&this._setInternalColorValueParameters(t.color,i),_(t.colorTexture)){const r=this._getInternalTexture(t.colorTexture,i.textureAlphaMode);_(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}_(t.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(t.normalTexture)),_(t.emissiveColor)&&(i.emissiveFactor=rt.toUnitRGB(t.emissiveColor)),_(t.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),_(t.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),_(t.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const i=this._drivenProperties.color;let r=_(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)t.externalColor=Wu;else{const s=_(this.symbolLayer.material)?this.symbolLayer.material.color:null;_(s)?t.externalColor=rt.toUnitRGBA(s):(r=null,t.externalColor=Wu)}r&&(t.colorMixMode=r),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const i=t.vertexAttributes.color;if(C(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(t,i){var r,s,n;const o=(r=i.material)==null?void 0:r.color,a=(s=i.material)==null?void 0:s.colorTexture,l=(n=i.material)==null?void 0:n.alphaMode,c=l==="blend",h=l!=="opaque"&&(this._hasTransparentVertexColors(t)||_(o)&&o.a<1||_(a)&&a.transparent||c),p=this._materialProperties(t,i,h),f=this._materials.get(p.uid);if(f)return f.material;const g={material:null,isComponentTransparent:h,alphaMode:i.material?i.material.alphaMode:"opaque"},y=p.metallicRoughnessTexture==null&&p.metallic==null&&p.roughness==null,v={usePBR:this._usePBR(),isSchematic:y,hasVertexColors:p.hasVertexColors,hasSymbolColors:p.hasSymbolVertexColors,hasVertexTangents:p.hasVertexTangents,ambient:pa,diffuse:kp,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Zi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};y||(v.mrrFactors=[p.metallic!=null?p.metallic:1,p.roughness!=null?p.roughness:1,.5]),i.material&&(v.doubleSided=i.material.doubleSided,v.cullFace=i.material.doubleSided?Zi.None:Zi.Back,v.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(v),this._setMaterialTransparentParameter(v,g),this._setInternalMaterialParameters(p,v);const b=new $b(v);return g.material=b,this._materials.set(p.uid,g),this._context.stage.add(b),b}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,i){t.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,i.alphaMode==="auto"?t.textureAlphaMode=t.transparent?Xi.MaskBlend:Xi.Opaque:t.textureAlphaMode=i.alphaMode==="opaque"?Xi.Opaque:i.alphaMode==="mask"?Xi.Mask:Xi.Blend}_addDebugNormals(t,i,r,s){const n=i.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],c=[],h=[],p=[];for(let y=0;y<n;y++){const v=i[y],b=v.vertexAttributes.get(A.POSITION),w=v.vertexAttributes.get(A.NORMAL),S=v.indices.get(A.POSITION),x=v.indices.get(A.NORMAL),E=b.data,R=w.data;for(let O=0;O<S.length;O++){const I=3*S[O],U=3*x[O];for(let N=0;N<3;N++)l.push(E[I+N]);for(let N=0;N<3;N++)l.push(E[I+N]+R[U+N]*a);if(c.push(c.length),c.push(c.length),O%3==0){this._calculateFaceNormal(E,S,O,Bw),this._getFaceVertices(E,S,O,Xn,zw,kw),fe(Xn,Xn,zw),fe(Xn,Xn,kw),oe(Xn,Xn,1/3);for(let N=0;N<3;N++)h.push(Xn[N]);for(let N=0;N<3;N++)h.push(Xn[N]+Bw[N]*a);p.push(p.length),p.push(p.length)}}}const f=new Ar([[A.POSITION,{data:l,size:3,exclusive:!0}]],[[A.POSITION,new Uint32Array(c)]],Qa.Line);i.push(f),r.push(this._debugVertexNormalMaterial),s.push(N1(s[0]));const g=new Ar([[A.POSITION,{data:h,size:3,exclusive:!0}]],[[A.POSITION,new Uint32Array(p)]],Qa.Line);i.push(g),r.push(this._debugFaceNormalMaterial),s.push(N1(s[0]))}_createAs3DShape(t,i,r,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:h}=o;Ni.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const p=new Eg({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});p.transformation=h;const f=this._createEdgeMaterial(),g=_(f)?{baseMaterial:l[0],edgeMaterials:[f],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,y=new Sf(this,p,a,null,null,cO,r,g);return y.needsElevationUpdates=ev(r.mode),y.useObjectOriginAsAttachmentOrigin=!0,y.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(p),y.alignedSampledElevation=cO(y,y.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),y}_getCenterPointInElevationSR(t){const i=Sg(0,0,0,this._context.elevationProvider.spatialReference);return fue([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(t,i,r,s){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(t,i,r,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,i,r,s){if(C(i))return this._createComponentNormalsFlat(t,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,Bw);for(let a=0;a<3;a++){const l=3*s[o+a];Xn[0]=i[l+0],Xn[1]=i[l+1],Xn[2]=i[l+2],Se(Bw,Xn)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return{normals:i,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,i){const r=new Float32Array(i.length),s=new Uint32Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(t,i,n,Bw);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return{normals:r,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(t,i,o,Bw);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:M(),count:0},r[c]=h),fe(h.normal,h.normal,a),h.count++}}const s=new Float32Array(3*i.length),n=new Uint32Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(Te(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,i,r,s){return this._getFaceVertices(t,i,r,Xn,zw,kw),de(zw,zw,Xn),de(kw,kw,Xn),_t(Xn,zw,kw),Te(s,Xn),s}_getOrCreateComponents(t){return Tt(t.components,TJe)}_createPositionBuffer(t,i){let r=t.vertexAttributes.position;const s=i.reprojection===yc.ECEF?i.transformBeforeProject:null;if(_(s)&&(r=G_e(r,new Float64Array(r.length),s)),i.reprojection===yc.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=_(s)?r:new Float64Array(r.length);return Pr(r,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(t,i,r){let s=t.vertexAttributes.normal;if(C(s))return null;const n=r.reprojection===yc.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=j_e(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===yc.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return _M(s,o,i,t.spatialReference,a)}_createTangentBuffer(t,i,r){let s=t.vertexAttributes.tangent;if(C(s))return null;const n=r.reprojection===yc.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=H_e(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===yc.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return bM(s,o,i,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(t),r=lZe(Bs(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return x_e(i,r,s),s}return null}_createBuffers(t,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(_(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(_(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(_(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===yc.NONE&&_(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===yc.NONE&&_(a.geometryTransformation)?a.geometryTransformation:Ae()}}_computeReprojectionInfo(t){const i=_(t.transform),r=i&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===je.Local?yc.NONE:yc.ECEF;if(i){if(r===yc.NONE){const n=Ae();return nl(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:N1(t.transform.localMatrix),needsBufferCopy:!1}}const s=gF(Ae(),t.transform.origin);return xr(s,s,t.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(t,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;E3[0]=o.x,E3[1]=o.y,E3[2]=o.z;const a=Ae();nl(t.spatialReference,E3,a,n);const l=yr.fromTypedArray(i);if(jr(Jie,a),hg(l,l,Jie),_(r)||_(s)){if(Wl(FE,a),lh(FE,FE),_(r)){const c=pi.fromTypedArray(r);$d(c,c,FE)}if(_(s)){const c=pi.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);$d(c,c,FE)}}return a}_validateFaces(t,i){const r=t.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,i){return i.faces?i.faces:WS(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return t.spatialReference.equals(r)?s=i:(s=new Float64Array(i.length),Pr(t.vertexAttributes.position,t.spatialReference,0,s,r,0,n)),ir(Tk),Fc(Tk,s,0,n),!hd(Tk,this._context.clippingExtent)}_createGeometryInfo(t,i){if(!wS(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const r=this._createBuffers(t,i);if(C(r))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:h,geometryTransformation:p}=r,f=this._getOrCreateComponents(t),g=[],y=[],v=[];let b=!1;for(const w of f){if(!this._validateFaces(t,w))return null;const S=this._getOrCreateFaces(t,w);if(S.length===0)continue;const x=this._createComponentNormals(s,l,w,S);x.didFlipNormals&&(b=!0);const E=[[A.POSITION,{size:3,data:s,exclusive:!0}],[A.NORMAL,{size:3,data:x.normals,exclusive:!0}]],R=[[A.POSITION,S],[A.NORMAL,x.indices]];_(o)&&(E.push([A.COLOR,{size:4,data:o,exclusive:!0}]),R.push([A.COLOR,S])),_(a)&&(E.push([A.SYMBOLCOLOR,{size:4,data:a,exclusive:!0}]),R.push([A.SYMBOLCOLOR,new Uint16Array(S.length)])),_(n)&&(E.push([A.UV0,{size:2,data:n,exclusive:!0}]),R.push([A.UV0,S])),_(c)&&(E.push([A.TANGENT,{size:4,data:c,exclusive:!0}]),R.push([A.TANGENT,S]));const O=new Ar(E,R);g.push(O),y.push(p),v.push(this._getOrCreateMaterial(t,w))}return b&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,transformations:y,materials:v,objectTransformation:h}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return Eve(this.symbolLayer,t)}}const E3=M(),Xn=M(),zw=M(),kw=M(),Bw=M(),Jie=Ae(),FE=Qi(),Tk=Rs(),TJe=[new rv];var yc;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(yc||(yc={}));class SJe{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const i=this.lodRenderer.instanceData;t!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,i,r){if(this.elevationAligner){SW(this.elevationContext.featureExpressionInfoContext,r);const s=this.elevationAligner(this,this.elevationContext,t,i);_(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=M()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Qd),Fe(t,this.lodRenderer.baseBoundingSphere.center,Qd)}getBoundingBoxObjectSpace(t=Rs()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Qd);const i=this.lodRenderer.baseBoundingBox;ir(t);for(let r=0;r<8;++r)se(cu,(1&r)==0?i[0]:i[3],(2&r)==0?i[1]:i[4],(4&r)==0?i[2]:i[5]),Fe(cu,cu,Qd),ef(t,cu);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Qd),t.render.origin[0]+=Qd[12],t.render.origin[1]+=Qd[13],t.render.origin[2]+=Qd[14],t.render.num++}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=EJe,l=aF(o)?1:a.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Qd);for(let h=0;h<l;h++){const p=a[h];cu[0]=o[p[0]],cu[1]=o[p[1]],cu[2]=o[p[2]],Fe(cu,cu,Qd),jv[3*h+0]=cu[0],jv[3*h+1]=cu[1],jv[3*h+2]=cu[2]}if(!t(jv,0,l))return null;ir(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],jv[h+p]),o[p+3]=Math.max(o[p+3],jv[h+p]);c&&r.push({location:jv.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(ud(o,Sk),this.elevationContext.mode!=="absolute-height")){let h;const p=xW(o,i);try{h=await i.service.queryElevation(Sk[0],Sk[1],s,p,"ground")}catch{}_(h)&&Ile(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,i){if(t===lg.Highlight){const r=new lN(t);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(t){this._highlights.forEach(i=>t.remove(i))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const jv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],cu=M(),Sk=M(),EJe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Qd=Ae();function AJe(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const s=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:s,geometry:i,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function CJe(e){return{levels:e.map(t=>AJe(t))}}function RJe(e,t=MJe){const i=oXe(e);return Math.sqrt(i/(t*Math.PI))}function OJe(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=RJe(t))})}const MJe=.05;function igt(e){return e=e||globalThis.location.hostname,IJe.some(t=>{var i;return((i=e)==null?void 0:i.match(t))!=null})}function PJe(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(W_e)!=null||t.match(Y_e)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(X_e)!=null||t.match(Z_e)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const W_e=/^devext.arcgis.com$/,X_e=/^qaext.arcgis.com$/,Y_e=/^[\w-]*\.mapsdevext.arcgis.com$/,Z_e=/^[\w-]*\.mapsqa.arcgis.com$/,IJe=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,W_e,X_e,/^jsapps.esri.com$/,Y_e,Z_e];function $Je(e,t,i){if(e.count!==t.count)return void R4.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],g=i[9],y=i[10],v=i[11],b=i[12],w=i[13],S=i[14],x=i[15],E=e.typedBuffer,R=e.typedBufferStride,O=t.typedBuffer,I=t.typedBufferStride;for(let U=0;U<r;U++){const N=U*R,V=U*I,j=O[V],H=O[V+1],J=O[V+2],K=O[V+3];E[N]=s*j+l*H+f*J+b*K,E[N+1]=n*j+c*H+g*J+w*K,E[N+2]=o*j+h*H+y*J+S*K,E[N+3]=a*j+p*H+v*J+x*K}}function Q_e(e,t,i){if(e.count!==t.count)return void R4.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],g=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,b=t.typedBufferStride;for(let w=0;w<r;w++){const S=w*y,x=w*b,E=v[x],R=v[x+1],O=v[x+2],I=v[x+3];g[S]=s*E+a*R+h*O,g[S+1]=n*E+l*R+p*O,g[S+2]=o*E+c*R+f*O,g[S+3]=I}}function DJe(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],g=h*h+p*p+f*f;if(g>0){const y=1/Math.sqrt(g);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function $G(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function LJe(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:$Je,transformMat3:Q_e,normalize:DJe,scale:$G,shiftRight:LJe},Symbol.toStringTag,{value:"Module"}));function NJe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:NJe},Symbol.toStringTag,{value:"Module"}));function FJe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:FJe},Symbol.toStringTag,{value:"Module"}));function UJe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function Q$(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:UJe,makeDense:Q$},Symbol.toStringTag,{value:"Module"}));function J_e(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function K_e(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(G8e(t.elementType)){const h=j8e(t.elementType);if(V8e(t.elementType))for(let p=0;p<a;++p)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else J_e(e,t,i);return e}function zJe(e,t,i,r){var s,n;const o=e.typedBuffer,a=e.typedBufferStride,l=(s=r==null?void 0:r.count)!=null?s:e.count;let c=((n=r==null?void 0:r.dstIndex)!=null?n:0)*a;for(let h=0;h<l;++h)o[c]=t,o[c+1]=i,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:J_e,normalizeIntegerBuffer:K_e,fill:zJe},Symbol.toStringTag,{value:"Module"}));function e5(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function kJe(e,t,i,r,s){var n,o;const a=e.typedBuffer,l=e.typedBufferStride,c=(n=s==null?void 0:s.count)!=null?n:e.count;let h=((o=s==null?void 0:s.dstIndex)!=null?o:0)*l;for(let p=0;p<c;++p)a[h]=t,a[h+1]=i,a[h+2]=r,h+=l}Object.freeze(Object.defineProperty({__proto__:null,copy:e5,fill:kJe},Symbol.toStringTag,{value:"Module"}));function e1e(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function t1e(e,t,i,r,s,n){var o,a;const l=e.typedBuffer,c=e.typedBufferStride,h=(o=n==null?void 0:n.count)!=null?o:e.count;let p=((a=n==null?void 0:n.dstIndex)!=null?a:0)*c;for(let f=0;f<h;++f)l[p]=t,l[p+1]=i,l[p+2]=r,l[p+3]=s,p+=c}Object.freeze(Object.defineProperty({__proto__:null,copy:e1e,fill:t1e},Symbol.toStringTag,{value:"Module"}));function d1(e,t){return new e(new ArrayBuffer(t*e.ElementCount*Kge(e.ElementType)))}class i1e{constructor(t){this.streamDataRequester=t}async loadJSON(t,i){return this._load("json",t,i)}async loadBinary(t,i){return gf(t)?(qt(i),Wle(t)):this._load("binary",t,i)}async loadImage(t,i){return this._load("image",t,i)}async _load(t,i,r){if(C(this.streamDataRequester))return(await Pi(i,{responseType:BJe[t]})).data;const s=await Ad(this.streamDataRequester.request(i,t,r));if(s.ok===!0)return s.value;throw hf(s.error),new Y("",`Request for resource failed: ${s.error}`)}}const BJe={image:"image",binary:"array-buffer",json:"json"},VJe=pe.getLogger("esri.views.3d.glTF");class GJe{error(t){throw new Y("gltf-loader-error",t)}errorUnsupported(t){throw new Y("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,i){t&&this.errorUnsupported(i)}assert(t,i){t||this.error(i)}warn(t){VJe.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,i){t&&this.warnUnsupported(i)}}function jJe(e={}){return L({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}function HJe(e,t={}){return{data:e,parameters:L({wrap:L({s:bt.REPEAT,t:bt.REPEAT},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}class Lb{constructor(t,i,r=""){this.major=t,this.minor=i,this._context=r}lessThan(t,i){return this.major<t||t===this.major&&this.minor<i}since(t,i){return!this.lessThan(t,i)}validate(t){if(this.major!==t.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new Y(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new Lb(this.major,this.minor,this._context)}static parse(t,i=""){const[r,s]=t.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new Y((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new Y((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const o=parseInt(r,10),a=parseInt(s,10);return new Lb(o,a,i)}}class Kie{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const i=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,i,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var iR,ere;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(iR||(iR={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(ere||(ere={}));const r1e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},qJe={pbrMetallicRoughness:r1e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},WJe={ESRI_externalColorMixMode:"tint"},tre=(e={})=>{const t=L(L({},r1e),e.pbrMetallicRoughness),i=XJe(L(L({},WJe),e.extras));return ge(L(L({},qJe),e),{pbrMetallicRoughness:t,extras:i})};function XJe(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const YJe={magFilter:Je.LINEAR,minFilter:Je.LINEAR_MIPMAP_LINEAR,wrapS:bt.REPEAT,wrapT:bt.REPEAT},ZJe=e=>L(L({},YJe),e);function QJe(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(t=s||"",i=n||"","")),{dirPart:t,filePart:i}}const A3={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class Em{constructor(t,i,r,s,n){this.context=t,this.errorContext=i,this.uri=r,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=QJe(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),i.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),i.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,i,r,s){if(gf(r)){const a=hF(r);if(a.mediaType!=="model/gltf-binary")try{const c=JSON.parse(a.isBase64?atob(a.data):a.data);return new Em(t,i,r,c)}catch{}const l=Wle(r);if(Em._isGLBData(l))return this._fromGLBData(t,i,r,l)}if(r.endsWith(".gltf")){const a=await t.loadJSON(r,s);return new Em(t,i,r,a)}const n=await t.loadBinary(r,s);if(Em._isGLBData(n))return this._fromGLBData(t,i,r,n);const o=await t.loadJSON(r,s);return new Em(t,i,r,o)}static _isGLBData(t){const i=new Kie(t);return i.remainingBytes()>=4&&i.readUint32()===A3.MAGIC}static async _fromGLBData(t,i,r,s){const n=await Em._parseGLBData(i,s);return new Em(t,i,r,n.json,n.binaryData)}static async _parseGLBData(t,i){const r=new Kie(i);t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=r.readUint32(),n=r.readUint32(),o=r.readUint32();t.assert(s===A3.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(i.byteLength>=o,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,l,c=0;for(;r.remainingBytes()>=8;){const h=r.readUint32(),p=r.readUint32();c===0?(t.assert(p===A3.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(h>=0,"No JSON data found."),a=await rKe(r.readUint8Array(h))):c===1?(t.errorUnsupportedIf(p!==A3.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=r.readUint8Array(h)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return a||t.error("No GLB JSON chunk detected."),{json:a,binaryData:l}}async getBuffer(t,i){const r=this.json.buffers[t],s=this.errorContext;if(r.uri==null)return s.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const n=await this._getBufferLoader(t,i);return s.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,i){const r=this.bufferLoaders.get(t);if(r)return r;const s=this.json.buffers[t],n=this.context.loadBinary(this._resolveUri(s.uri),i).then(o=>new Uint8Array(o));return this.bufferLoaders.set(t,n),n}async getAccessor(t,i){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];r.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),r.errorUnsupportedIf(s.type in[iR.MAT2,iR.MAT3,iR.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i),a=eKe[s.type],l=tKe[s.componentType],c=a*l,h=n.byteStride||c;return{raw:o.buffer,byteStride:h,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:h===c,componentCount:a,componentByteSize:l,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,i){if(t.indices==null)return null;const r=await this.getAccessor(t.indices,i);if(r.isDenselyPacked)switch(r.componentType){case ut.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case ut.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case ut.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case ut.UNSIGNED_BYTE:return Q$(this._wrapAccessor(cg,r));case ut.UNSIGNED_SHORT:return Q$(this._wrapAccessor(xb,r));case ut.UNSIGNED_INT:return Q$(this._wrapAccessor(Sb,r))}}async getPositionData(t,i){const r=this.errorContext;r.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,i);return r.errorUnsupportedIf(s.componentType!==ut.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+R3[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(pi,s)}async getNormalData(t,i){const r=this.errorContext;r.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,i);return r.errorUnsupportedIf(s.componentType!==ut.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+R3[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(pi,s)}async getTangentData(t,i){const r=this.errorContext;r.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,i);return r.errorUnsupportedIf(s.componentType!==ut.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+R3[s.componentType]),r.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new yn(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,i){const r=this.errorContext;r.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,i);return r.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===ut.FLOAT?this._wrapAccessor(uh,s):(r.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),iKe(s))}async getVertexColors(t,i){const r=this.errorContext;r.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,i);if(r.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===ut.FLOAT)return this._wrapAccessor(yn,s);if(s.componentType===ut.UNSIGNED_BYTE)return this._wrapAccessor(al,s);if(s.componentType===ut.UNSIGNED_SHORT)return this._wrapAccessor(W0,s)}else if(s.componentCount===3){if(s.componentType===ut.FLOAT)return this._wrapAccessor(pi,s);if(s.componentType===ut.UNSIGNED_BYTE)return this._wrapAccessor(q0,s);if(s.componentType===ut.UNSIGNED_SHORT)return this._wrapAccessor(Tb,s)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+R3[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,i,r){let s=this.materialCache.get(t.material);if(!s){const n=t.material!=null?tre(this.json.materials[t.material]):tre(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(t),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(n.normalTexture,i),h=r?this.getTexture(n.occlusionTexture,i):null,p=r?this.getTexture(n.emissiveTexture,i):null,f=r?this.getTexture(o.metallicRoughnessTexture,i):null,g=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:g,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(t,i){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const r=t.index,s=this.errorContext,n=this.json.textures[r],o=ZJe(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const a=this.json.images[n.source],l=await this._loadTextureImageData(r,n,i);return Uoe(this.textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>(s.error(`Unexpected TextureSampler WrapMode: ${p}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(o.wrapS)?o.wrapS:h(o.wrapS),wrapT:c(o.wrapT)?o.wrapT:h(o.wrapT),minFilter:o.minFilter,name:a.name,id:r}})}getNodeTransform(t){if(t===void 0)return KJe;let i=this.nodeTransformCache.get(t);if(!i){const r=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?i=xr(Ae(),r,s.matrix):s.translation||s.rotation||s.scale?(i=N1(r),s.translation&&ga(i,i,s.translation),s.rotation&&(C3[3]=_q(C3,s.rotation),Ha(i,i,C3[3],C3)),s.scale&&kO(i,i,s.scale)):i=r,this.nodeTransformCache.set(t,i)}return i}_wrapAccessor(t,i){return new t(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(t){return Qu(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=Lb.parse(this.json.asset.version,"glTF");JJe.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,i=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&i.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,i)=>{t.children&&t.children.forEach(r=>{this.nodeParentMap.set(r,i)})})}async _loadTextureImageData(t,i,r){const s=this.textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(i,r);return this.textureLoaders.set(t,n),n}async _createTextureLoader(t,i){const r=this.json.images[t.source];if(r.uri)return this.context.loadImage(this._resolveUri(r.uri),i);const s=this.errorContext;s.errorUnsupportedIf(r.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(r.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[r.bufferView],o=await this.getBuffer(n.buffer,i);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),sKe(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const JJe=new Lb(2,0,"glTF"),KJe=Jce(Ae(),Math.PI/2),C3=vf(),eKe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},tKe={[ut.BYTE]:1,[ut.UNSIGNED_BYTE]:1,[ut.SHORT]:2,[ut.UNSIGNED_SHORT]:2,[ut.FLOAT]:4,[ut.UNSIGNED_INT]:4};function iKe(e){switch(e.componentType){case ut.BYTE:return new Eb(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ut.UNSIGNED_BYTE:return new wb(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ut.SHORT:return new Ab(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ut.UNSIGNED_SHORT:return new jS(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ut.UNSIGNED_INT:return new HS(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ut.FLOAT:return new uh(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function rKe(e){return new Promise((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function sKe(e,t){return new Promise((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image;o.addEventListener("load",()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)):i(o)}),o.addEventListener("error",a=>{URL.revokeObjectURL(n),r(a)}),o.src=n})}const R3={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let nKe=0;async function s1e(e,t,i={},r=!0){const s=await Em.load(e,J$,t,i),n="gltf_"+nKe++,o={lods:[],materials:new Map,textures:new Map,meta:oKe(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await aKe(s,async(c,h,p,f)=>{var g;const y=(g=l.get(p))!=null?g:0;l.set(p,y+1);const v=c.mode!==void 0?c.mode:Dt.TRIANGLES,b=v===Dt.TRIANGLES||v===Dt.TRIANGLE_STRIP||v===Dt.TRIANGLE_FAN?v:null;if(C(b))return void J$.warnUnsupported("Unsupported primitive mode ("+hKe[v]+"). Skipping primitive.");if(!s.hasPositions(c))return void J$.warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(c,i),S=s.getMaterial(c,i,r),x=s.hasNormals(c)?s.getNormalData(c,i):null,E=s.hasTangents(c)?s.getTangentData(c,i):null,R=s.hasTextureCoordinates(c)?s.getTextureCoordinates(c,i):null,O=s.hasVertexColors(c)?s.getVertexColors(c,i):null,I=s.getIndexData(c,i),U={transform:N1(h),attributes:{position:await w,normal:x?await x:null,texCoord0:R?await R:null,color:O?await O:null,tangent:E?await E:null},indices:await I,primitiveType:b,material:cKe(o,await S,n)};let N=null;_(o.meta)&&_(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(N=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:f,lodThreshold:N},o.lods[p].parts[y]=U});for(const c of o.lods)c.parts=c.parts.filter(h=>!!h);return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{}}}function oKe(e){const t=e.json;let i=null;return t.nodes.forEach(r=>{const s=r.extras;_(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function aKe(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),lKe(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=e.getNodeTransform(a);if(J$.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function lKe(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function cKe(e,t,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=HJe(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:uKe.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=jJe({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const J$=new GJe,uKe=[Je.LINEAR_MIPMAP_LINEAR,Je.LINEAR_MIPMAP_NEAREST],hKe=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function dKe(e,t=WS){return typeof e=="number"?t(e):gD(e)||Z_(e)?new Uint32Array(e):e}function pKe(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function fKe(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=e[0];let n=e[1],o=0;for(let a=0;a<i;++a){const l=e[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}const dm=pe.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function n1e(e,t){const i=await mKe(e,t);return{resource:i,textures:await bKe(i.textureDefinitions,t)}}async function mKe(e,t){const i=_(t)&&t.streamDataRequester;if(i)return gKe(e,i,t);const r=await Ad(Pi(e,t));if(r.ok===!0)return r.value.data;hf(r.error),o1e(r.error)}async function gKe(e,t,i){const r=await Ad(t.request(e,"json",i));if(r.ok===!0)return r.value;hf(r.error),o1e(r.error.details.url)}function o1e(e){throw new Y("",`Request for object resource failed: ${e}`)}function yKe(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(dm.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(dm.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(dm.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(dm.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else dm.warn("Indexed geometries must specify faces"),r=!1;break}default:dm.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(dm.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(dm.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function vKe(e,t){const i=[],r=[],s=[],n=[],o=e.resource,a=Lb.parse(o.version||"1.0","wosr");xKe.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions,p=e.textures;let f=0;const g=new Map;for(let y=0;y<c.length;y++){const v=c[y];if(!yKe(v))continue;const b=wKe(v),w=v.params.vertexAttributes,S=[];for(const N in w){const V=w[N],j=V.values;S.push([N,{data:j,size:V.valuesPerElement,exclusive:!0}])}const x=[];if(v.params.topology!=="PerAttributeArray"){const N=v.params.faces;for(const V in N)x.push([V,new Uint32Array(N[V].values)])}const E=p&&p[b.texture];if(E&&!g.has(b.texture)){const{image:N,params:V}=E,j=new vs(N,V);n.push(j),g.set(b.texture,j)}const R=g.get(b.texture),O=R?R.id:void 0;let I=s[b.material]?s[b.material][b.texture]:null;if(!I){const N=h[b.material.substring(b.material.lastIndexOf("/")+1)].params;N.transparency===1&&(N.transparency=0);const V=E&&E.alphaChannelUsage,j=N.transparency>0||V==="transparency"||V==="maskAndTransparency",H=E?a1e(E.alphaChannelUsage):void 0,J={ambient:za(N.diffuse),diffuse:za(N.diffuse),opacity:1-(N.transparency||0),transparent:j,textureAlphaMode:H,textureAlphaCutoff:.33,textureId:O,initTextureTransparent:!0,doubleSided:!0,cullFace:Zi.None,colorMixMode:N.externalColorMixMode||"tint",textureAlphaPremultiplied:!!E&&!!E.params.preMultiplyAlpha};_(t)&&t.materialParamsMixin&&Object.assign(J,t.materialParamsMixin),I=new $b(J),s[b.material]||(s[b.material]={}),s[b.material][b.texture]=I}r.push(I);const U=new Ar(S,x);f+=x.position?x.position.length:0,i.push(U)}return{name:l,stageResources:{textures:n,materials:r,geometries:i},pivotOffset:o.model.pivotOffset,boundingBox:_Ke(i),numberOfVertices:f,lodThreshold:null}}function _Ke(e){const t=ir();return e.forEach(i=>{const r=i.boundingInfo;_(r)&&(ef(t,r.getBBMin()),ef(t,r.getBBMax()))}),t}async function bKe(e,t){const i=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){dm.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:bt.REPEAT,t:bt.REPEAT},preMultiplyAlpha:a1e(h)!==Xi.Opaque},f=_(t)&&t.disableTextures?Promise.resolve(null):ch(l,t);i.push(f.then(g=>({refId:c,image:g,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function a1e(e){switch(e){case"mask":return Xi.Mask;case"maskAndTransparency":return Xi.MaskBlend;case"none":return Xi.Opaque;default:return Xi.Blend}}function wKe(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const xKe=new Lb(1,2,"wosr"),Vw=2.1;async function l1e(e,t){const i=c1e(PJe(e));if(i.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(i.url,t):n1e(i.url,t)),c=vKe(l,t);return{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove}}const r=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):s1e(new i1e(t.streamDataRequester),i.url,t,t.usePBR)),s=Bs(r.model.meta,"ESRI_proxyEllipsoid");r.meta.isEsriSymbolResource&&_(s)&&r.meta.uri.includes("/RealisticTrees/")&&EKe(r,s);const n=r.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!r.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},o=ge(L({},t.materialParamsMixin),{treeRendering:!!r.customMeta.esriTreeRendering});if(i.specifiedLodIndex!=null){const l=K$(r,n,o,i.specifiedLodIndex);let c=l[0].boundingBox;return i.specifiedLodIndex!==0&&(c=K$(r,n,o,0)[0].boundingBox),{lods:l,referenceBoundingBox:c,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}const a=K$(r,n,o);return{lods:a,referenceBoundingBox:a[0].boundingBox,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}function c1e(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function K$(e,t,i,r){const s=e.model,n=Qi(),o=new Array,a=new Map,l=new Map;return s.lods.forEach((c,h)=>{if(r!==void 0&&h!==r)return;const p={name:c.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:_(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:ir()};o.push(p),c.parts.forEach(f=>{const g=f.material+(f.attributes.normal?"_normal":"")+(f.attributes.color?"_color":"")+(f.attributes.texCoord0?"_texCoord0":"")+(f.attributes.tangent?"_tangent":""),y=s.materials.get(f.material),v=_(f.attributes.texCoord0),b=_(f.attributes.normal),w=TKe(y.alphaMode);if(!a.has(g)){if(v){if(_(y.textureColor)&&!l.has(y.textureColor)){const le=s.textures.get(y.textureColor),$=ge(L({},le.parameters),{preMultiplyAlpha:w!==Xi.Opaque});l.set(y.textureColor,new vs(le.data,$))}if(_(y.textureNormal)&&!l.has(y.textureNormal)){const le=s.textures.get(y.textureNormal);l.set(y.textureNormal,new vs(le.data,le.parameters))}if(_(y.textureOcclusion)&&!l.has(y.textureOcclusion)){const le=s.textures.get(y.textureOcclusion);l.set(y.textureOcclusion,new vs(le.data,le.parameters))}if(_(y.textureEmissive)&&!l.has(y.textureEmissive)){const le=s.textures.get(y.textureEmissive);l.set(y.textureEmissive,new vs(le.data,le.parameters))}if(_(y.textureMetallicRoughness)&&!l.has(y.textureMetallicRoughness)){const le=s.textures.get(y.textureMetallicRoughness);l.set(y.textureMetallicRoughness,new vs(le.data,le.parameters))}}const N=y.color[0]**(1/Vw),V=y.color[1]**(1/Vw),j=y.color[2]**(1/Vw),H=y.emissiveFactor[0]**(1/Vw),J=y.emissiveFactor[1]**(1/Vw),K=y.emissiveFactor[2]**(1/Vw),he=_(y.textureColor)&&v?l.get(y.textureColor):null;a.set(g,new $b(L(ge(L({},t),{transparent:w===Xi.Blend,customDepthTest:yb.Lequal,textureAlphaMode:w,textureAlphaCutoff:y.alphaCutoff,diffuse:[N,V,j],ambient:[N,V,j],opacity:y.opacity,doubleSided:y.doubleSided,doubleSidedType:"winding-order",cullFace:y.doubleSided?Zi.None:Zi.Back,hasVertexColors:!!f.attributes.color,hasVertexTangents:!!f.attributes.tangent,normals:b?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:_(he)?he.id:void 0,colorMixMode:y.colorMixMode,normalTextureId:_(y.textureNormal)&&v?l.get(y.textureNormal).id:void 0,textureAlphaPremultiplied:_(he)&&!!he.params.preMultiplyAlpha,occlusionTextureId:_(y.textureOcclusion)&&v?l.get(y.textureOcclusion).id:void 0,emissiveTextureId:_(y.textureEmissive)&&v?l.get(y.textureEmissive).id:void 0,metallicRoughnessTextureId:_(y.textureMetallicRoughness)&&v?l.get(y.textureMetallicRoughness).id:void 0,emissiveFactor:[H,J,K],mrrFactors:[y.metallicFactor,y.roughnessFactor,t.mrrFactors[2]],isSchematic:!1}),i)))}const S=SKe(f.indices||f.attributes.position.count,f.primitiveType),x=f.attributes.position.count,E=d1(pi,x);hg(E,f.attributes.position,f.transform);const R=[[A.POSITION,{data:E.typedBuffer,size:E.elementCount,exclusive:!0}]],O=[[A.POSITION,S]];if(_(f.attributes.normal)){const N=d1(pi,x);G0(n,f.transform),$d(N,f.attributes.normal,n),R.push([A.NORMAL,{data:N.typedBuffer,size:N.elementCount,exclusive:!0}]),O.push([A.NORMAL,S])}if(_(f.attributes.tangent)){const N=d1(yn,x);G0(n,f.transform),Q_e(N,f.attributes.tangent,n),R.push([A.TANGENT,{data:N.typedBuffer,size:N.elementCount,exclusive:!0}]),O.push([A.TANGENT,S])}if(_(f.attributes.texCoord0)){const N=d1(uh,x);K_e(N,f.attributes.texCoord0),R.push([A.UV0,{data:N.typedBuffer,size:N.elementCount,exclusive:!0}]),O.push([A.UV0,S])}if(_(f.attributes.color)){const N=d1(al,x);if(f.attributes.color.elementCount===4)f.attributes.color instanceof yn?$G(N,f.attributes.color,255):f.attributes.color instanceof al?e1e(N,f.attributes.color):f.attributes.color instanceof W0&&$G(N,f.attributes.color,1/256);else{t1e(N,255,255,255,255);const V=new q0(N.buffer,0,4);f.attributes.color instanceof pi?TG(V,f.attributes.color,255):f.attributes.color instanceof q0?e5(V,f.attributes.color):f.attributes.color instanceof Tb&&TG(V,f.attributes.color,1/256)}R.push([A.COLOR,{data:N.typedBuffer,size:N.elementCount,exclusive:!0}]),O.push([A.COLOR,S])}const I=new Ar(R,O);p.stageResources.geometries.push(I),p.stageResources.materials.push(a.get(g)),v&&(_(y.textureColor)&&p.stageResources.textures.push(l.get(y.textureColor)),_(y.textureNormal)&&p.stageResources.textures.push(l.get(y.textureNormal)),_(y.textureOcclusion)&&p.stageResources.textures.push(l.get(y.textureOcclusion)),_(y.textureEmissive)&&p.stageResources.textures.push(l.get(y.textureEmissive)),_(y.textureMetallicRoughness)&&p.stageResources.textures.push(l.get(y.textureMetallicRoughness))),p.numberOfVertices+=x;const U=I.boundingInfo;_(U)&&(ef(p.boundingBox,U.getBBMin()),ef(p.boundingBox,U.getBBMax()))})}),o}function TKe(e){switch(e){case"BLEND":return Xi.Blend;case"MASK":return Xi.Mask;case"OPAQUE":case null:case void 0:return Xi.Opaque}}function SKe(e,t){switch(t){case Dt.TRIANGLES:return dKe(e);case Dt.TRIANGLE_STRIP:return pKe(e);case Dt.TRIANGLE_FAN:return fKe(e)}}function EKe(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const s of r.parts){const n=s.attributes.normal;if(C(n))return;const o=s.attributes.position,a=o.count,l=M(),c=M(),h=M(),p=d1(al,a),f=d1(pi,a),g=jr(Ae(),s.transform);for(let y=0;y<a;y++){o.getVec(y,c),n.getVec(y,l),Fe(c,c,s.transform),de(h,c,t.center),ID(h,h,t.radius);const v=h[2],b=Ie(h),w=Math.min(.45+.55*b*b,1);ID(h,h,t.radius),Fe(h,h,g),Te(h,h),i+1!==e.model.lods.length&&e.model.lods.length>1&&Cs(h,h,l,v>-1?.2:Math.min(-4*v-3.8,1)),f.setVec(y,h),p.set(y,0,255*w),p.set(y,1,255*w),p.set(y,2,255*w),p.set(y,3,255)}s.attributes.normal=f,s.attributes.color=p}}}var rgt=Object.freeze(Object.defineProperty({__proto__:null,fetch:l1e,gltfToEngineResources:K$,parseUrl:c1e},Symbol.toStringTag,{value:"Module"})),fr;function AKe(e){let t=ls().mat4f64(A.LOCALTRANSFORM).mat4f64(A.GLOBALTRANSFORM).vec4f64(A.BOUNDINGSPHERE).vec3f64(A.MODELORIGIN).mat3f(A.MODEL).mat3f(A.MODELNORMAL).vec2f(A.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(A.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(A.FEATUREATTRIBUTE)),t=t.u8(A.STATE).u8(A.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(fr||(fr={}));class CKe{constructor(t){this.localTransform=t.getField(A.LOCALTRANSFORM,H0),this.globalTransform=t.getField(A.GLOBALTRANSFORM,H0),this.modelOrigin=t.getField(A.MODELORIGIN,yr),this.model=t.getField(A.MODEL,Pd),this.modelNormal=t.getField(A.MODELNORMAL,Pd),this.modelScaleFactors=t.getField(A.MODELSCALEFACTORS,uh),this.boundingSphere=t.getField(A.BOUNDINGSPHERE,bb),this.color=t.getField(A.COLOR,yn),this.featureAttribute=t.getField(A.FEATUREATTRIBUTE,yn),this.state=t.getField(A.STATE,cg),this.lodLevel=t.getField(A.LODLEVEL,cg)}}class RKe extends qr{constructor(t,i){super(),this._capacity=0,this._size=0,this._next=0,this._layout=AKe(t),this._shaderTransformation=i}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,fr.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const i=this._view.state;ht(t>=0&&t<this._capacity&&i.get(t)&fr.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,fr.ACTIVE)?this._setStateFlags(t,fr.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const i=this._view.state;ht(t>=0&&t<this._capacity&&i.get(t)&fr.ALLOCATED,"invalid instance handle"),i.set(t,0),this._size--}setLocalTransform(t,i,r=!0){this._view.localTransform.setMat(t,i),r&&this.updateModelTransform(t)}getLocalTransform(t,i){this._view.localTransform.getMat(t,i)}setGlobalTransform(t,i,r=!0){this._view.globalTransform.setMat(t,i),r&&this.updateModelTransform(t)}getGlobalTransform(t,i){this._view.globalTransform.getMat(t,i)}updateModelTransform(t){const i=this._view,r=jg,s=Sh;i.localTransform.getMat(t,ire),i.globalTransform.getMat(t,Ek);const n=xr(Ek,Ek,ire);se(r,n[12],n[13],n[14]),i.modelOrigin.setVec(t,r),Wl(s,n),i.model.setMat(t,s);const o=L6e(jg,n);o.sort(),i.modelScaleFactors.set(t,0,o[1]),i.modelScaleFactors.set(t,1,o[2]),ew(s,s),lh(s,s),i.modelNormal.setMat(t,s),this._setStateFlags(t,fr.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,i){const r=this._view;r.model.getMat(t,Sh),r.modelOrigin.getVec(t,jg),i[0]=Sh[0],i[1]=Sh[1],i[2]=Sh[2],i[3]=0,i[4]=Sh[3],i[5]=Sh[4],i[6]=Sh[5],i[7]=0,i[8]=Sh[6],i[9]=Sh[7],i[10]=Sh[8],i[11]=0,i[12]=jg[0],i[13]=jg[1],i[14]=jg[2],i[15]=1}applyShaderTransformation(t,i){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i)}getCombinedModelTransform(t,i){return this.getModelTransform(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedLocalTransform(t,i){return this._view.localTransform.getMat(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedMaxScaleFactor(t){let i=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(jg,this,t);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(t){let i=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(jg,this,t);r.sort(),i*=r[1]}return i}getModel(t,i){this._view.model.getMat(t,i)}setFeatureAttribute(t,i){this._view.featureAttribute.setVec(t,i)}getFeatureAttribute(t,i){this._view.featureAttribute.getVec(t,i)}setColor(t,i){this._view.color.setVec(t,i)}getColor(t,i){this._view.color.getVec(t,i)}setVisible(t,i){i!==this.getVisible(t)&&(this._setStateFlag(t,fr.VISIBLE,i),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,fr.VISIBLE)}setHighlight(t,i){i!==this.getHighlight(t)&&(this._setStateFlag(t,fr.HIGHLIGHT,i),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,fr.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&t&&++i;return i}_setStateFlags(t,i){const r=this._view.state;i=r.get(t)|i,r.set(t,i)}_clearStateFlags(t,i){const r=this._view.state;i=r.get(t)&~i,r.set(t,i)}_setStateFlag(t,i,r){r?this._setStateFlags(t,i):this._clearStateFlags(t,i)}_getStateFlag(t,i){return!!(this._view.state.get(t)&i)}_grow(){const t=Math.max(OKe,Math.floor(this._capacity*MKe)),i=this._layout.createBuffer(t);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=t,this._buffer=i,this._view=new CKe(this._buffer)}_findSlot(){const t=this._view.state;let i=this._next;for(;t.get(i)&fr.ALLOCATED;)i=(i+1)%this._capacity;return this._next=(i+1)%this._capacity,i}}const OKe=1024,MKe=2,jg=M(),Sh=Qi(),ire=Ae(),Ek=Ae();class PKe extends md{constructor(t,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=Vn(),this._tmpMat4=Ae(),this._instanceData=t,this._boundingSphere=i}addInstance(t){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);Fe(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*gb(r),i.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class IKe{constructor(t,i){this.thresholdScale=1,this._camera=new Di,this._worldSpaceRadius=t,this._thresholds=i.map(r=>r)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,i){const r=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*i/r,n=this._thresholds;let o=-1;for(let a=0;a<n.length;++a)s>=n[a]*this.thresholdScale&&(o=a);return o}}class $Ke{constructor(t,i){const r=t.renderContext.rctx,{geometry:s,material:n}=i;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const o=n.createBufferWriter(),a=o.vertexBufferLayout,l=o.elementCount(s),c=o.allocate(l);o.write({},s,c,0),this.geometry=s,this.material=n,this.glMaterials=new Vve(n,this._materialRepository),this.vertexBufferLayout=a,this.vbo=si.createVertex(r,mi.STATIC_DRAW,c.buffer),this.vao=new Os(r,Ri,{geometry:Zl(a)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,i,r,s,n,o){const a=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,r,s,(l,c,h,p,f)=>{if(l>=0){if(i!=null&&!i(t.rayBegin,t.rayEnd,l))return;const g={layerUid:o.layerUid,graphicUid:o.graphicUid(n),geometryId:a,triangleNr:h};if((t.results.min.drapedLayerOrder==null||f>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||l<t.results.min.dist)&&t.results.min.set(Rr.LOD,g,l,c,t.transform.transform,f),t.options.store!==zn.MIN&&(t.results.max.drapedLayerOrder==null||f>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||l>t.results.max.dist)&&t.results.max.set(Rr.LOD,g,l,c,t.transform.transform,f),t.options.store===zn.ALL){const y=jq(t.results.min.ray);y.set(Rr.LOD,g,l,c,t.transform.transform,f),t.results.all.push(y)}}})}}class GW{constructor(t,i){this.minScreenSpaceRadius=t,this.components=i}static async create(t,i,r){const s=await Promise.allSettled(i.components.map(o=>t.schedule(()=>new $Ke(t,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(Ts(r)||n.length!==s.length){n.forEach(o=>o.destroy()),qt(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new GW(i.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,i,r,s,n,o){this.components.forEach(a=>a.intersect(t,i,r,s,n,o))}get boundingBox(){if(C(this._boundingBox)){const t=ir();this.components.forEach(i=>{_(i.boundingInfo)&&(ef(t,i.boundingInfo.bbMin),ef(t,i.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(C(this._boundingSphere)){const t=this.boundingBox,i=M();ud(t,i),this._boundingSphere={center:i,radius:.5*OEe(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,i)=>t+i.triangleCount,0)}}class DKe{constructor(t,i,r){this._elementSize=i,this._buffer=si.createVertex(t,mi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,i,r,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(i-t)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,i){const r=t*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(this._array,r,r,s)}resize(t){const i=t*this._elementSize,r=new ArrayBuffer(i);this._array&&(t>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=t}}class LKe{constructor(t){this.modelOriginHi=t.getField(A.MODELORIGINHI,pi),this.modelOriginLo=t.getField(A.MODELORIGINLO,pi),this.model=t.getField(A.MODEL,Pd),this.modelNormal=t.getField(A.MODELNORMAL,Pd),this.color=t.getField(A.INSTANCECOLOR,yn),this.featureAttribute=t.getField(A.INSTANCEFEATUREATTRIBUTE,yn)}}class rre{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){ht(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){ht(this._updating,"not updating"),this.size<FKe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){ht(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),ht(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){ht(this._updating,"not updating"),ht(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(sre,Math.floor(this._capacity*NKe));this._resize(t)}_shrink(){const t=Math.max(sre,Math.floor(this._capacity*UKe));this._resize(t)}_resize(t){if(ht(this._updating,"not updating"),t===this._capacity)return;const i=new DKe(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);ht(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new LKe(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,t),i-r):r>i?(this._buffer.copyRange(r,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const sre=1024,NKe=2,FKe=.3,UKe=.5;let zKe=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map(r=>r.minScreenSpaceRadius);return new IKe(t,i)};class kKe{constructor(t,i,r,s){this.type=Rr.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new Di,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[we.OPAQUE_MATERIAL,we.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=i,this._metadata=r,this._instanceBufferLayout=O_e({instancedDoublePrecision:!0,instanced:i}),this._glInstanceBufferLayout=Zl(this._instanceBufferLayout,1),this._instanceData=new RKe(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),t}get renderStats(){const t=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(t,i){this._context=t;const r=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new rre(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new rre(r,this._instanceBufferLayout)),GW.create(t,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(Ts(i)||n.length!==s.length){n.forEach(o=>o.destroy()),qt(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=zKe(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(i=>i.material.requiresSlot(we.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t,i){if(Ni.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const s=i.equals(this._lastCamera);this._lastCamera.copyFrom(i),s||this._requestUpdateCycle()}const r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(i,r),this.needsUpdates&&this._context.requestRender()}render(t){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;t.rctx.bindVAO();const i=t.pass!==Ue.MATERIAL_HIGHLIGHT&&t.pass!==Ue.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,r=t.pass!==Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;i&&this._renderComponents(t,this._defaultRenderInstanceData),r&&this._renderComponents(t,this._highlightRenderInstanceData)}intersect(t,i,r,s){if(!this.baseMaterial.isVisible())return;const n=M();de(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,are),t.transform.set(are),Fe(lre,r,t.transform.inverse),Fe(cre,s,t.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a);ht(l&fr.ACTIVE,"invalid instance state"),ht(c>=0&&c<this._levels.length,"invaid lod level"),this._levels[c].intersect(t,i,lre,cre,a,this._metadata)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(o):this.octree.forEachAlongRay(r,n,o)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new PKe(this._instanceData,this.baseBoundingSphere),i=this._instanceData,r=i.view?i.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)r.get(s)&fr.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const i=t.eye,r=t.viewForward,s=this.octree.findClosest(r,md.DepthOrder.FRONT_TO_BACK,t.frustum),n=this.octree.findClosest(r,md.DepthOrder.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,Jd),de(Jd,Jd,i);const o=Se(Jd,r)-Jd[3];this._instanceData.view.boundingSphere.getVec(n,Jd),de(Jd,Jd,i);const a=Se(Jd,r)+Jd[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,i){const r=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(h=>{h.beginUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.beginUpdate()});const n=this._instanceData,o=this._instanceData.view,a=n.size,l=n.capacity;let c=this._instanceIndex;i=Math.min(a,i);for(let h=0;h<i;++h){c===0&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&fr.ALLOCATED)){c=(c+1)%l,i++;continue}const g=o.lodLevel.get(c);if(p&fr.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[g].freeTail(),p&fr.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[g].freeTail(),p&fr.REMOVE)n.freeInstance(c);else if(p&fr.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,ore),y=s.selectLevel(ore,n.getCombinedMedianScaleFactor(c))),f=p&~(fr.ACTIVE|fr.TRANSFORM_CHANGED),y>=0&&(p&fr.HIGHLIGHT?(nre(this._highlightRenderInstanceData[y],o,c),f|=fr.HIGHLIGHT_ACTIVE):(nre(this._defaultRenderInstanceData[y],o,c),f|=fr.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(fr.ACTIVE|fr.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octree){const y=!!(p&fr.ACTIVE),v=!!(f&fr.ACTIVE);!y&&v?this._octree.addInstance(c):y&&!v?this._octree.removeInstance(c):y&&v&&p&fr.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%l}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>{h.endUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.endUpdate()})}_renderComponents(t,i){this.levels.forEach((r,s)=>{r.components.forEach(n=>{this._renderComponent(t,i[s],n,s)})})}_renderComponent(t,i,r,s){const n=t.bindParameters;if(i.size===0||!r.material.requiresSlot(n.slot))return;const{rctx:o,pass:a}=t,l=r.glMaterials.load(o,a);if(C(l))return;const c=l.beginSlot(n),h=o.bindTechnique(c,r.material.parameters,n);o.bindVAO(r.vao),c.ensureAttributeLocations(r.vao),c.bindDraw(VKe,n),Ni.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===Ue.MATERIAL&&(h.setUniform4fv("externalColor",ure[Math.min(s,ure.length-1)]),h.setUniform1i("colorMixMode",$0e.replace));const p=o.capabilities.instancing,f=i.capacity,g=i.headIndex,y=i.tailIndex,v=i.firstIndex,b=this._glInstanceBufferLayout,w=(S,x)=>{yq(o,Ri,i.buffer,b,S),p.drawArraysInstanced(c.primitiveType,0,r.vertexCount,x-S),vq(o,Ri,i.buffer,b)};r.material.parameters.transparent&&v!=null?g>y?(ht(v>=y&&v<=g,"invalid firstIndex"),w(v,g),w(y,v)):g<y&&(v<=g?(ht(v>=0&&v<=g,"invalid firstIndex"),w(v,g),w(y,f),w(0,v)):(ht(v>=y&&v<=f,"invalid firstIndex"),w(v,f),w(0,g),w(y,v))):g>y?w(y,g):g<y&&(w(0,g),w(y,f)),o.bindVAO(null)}}function nre(e,t,i){const r=e.allocateHead();BKe(t,i,e.view,r)}function BKe(e,t,i,r){_Ge(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const ore=M(),Jd=ii(),are=Ae(),lre=M(),cre=M(),ure=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],VKe=new yZe;class GKe extends Ef{constructor(t,i,r,s){super(t,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[t,i,r]=_(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:i,height:r}}async doLoad(t){if(!this._drivenProperties.size&&E4(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this.isPrimitive){const r=i.resource?i.resource.primitive:ace;this._resources=await this._createResourcesForPrimitive(r,t)}else this._resources=await this._createResourcesForUrl(i.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return _(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Bs(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,i=Bs(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=r,t.cullFace=s?Zi.None:Zi.Back,t}async _createResourcesForPrimitive(t,i){if(!XWe(t))throw new Error(`Unknown object symbol primitive: ${t}`);const r=this.symbolLayer,s=Rs(FEe(t)),n=za(zM(s)),o=za(q5(n,r)),a=Ie(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:kp,diffuse:kp,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:w,minWorldLength:S,maxWorldLength:x}=f.verticalOffset;h.verticalOffset={screenLength:$o(w),minWorldLength:S||0,maxWorldLength:x!=null?x:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Wu;else{const w=_(r.material)&&r.material.color,S=_(w)?rt.toUnitRGBA(w):Wu;h.externalColor=S}this._fastUpdates=mO(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,i_)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color"));const g=new $b(h),y=Sve(t,g);if(!y)throw new Error(`Unknown object symbol primitive: ${t}`);const v=l3(y).map(w=>({opacity:1,transparent:w.parameters.transparent})),b=await this._createStageResources(y,p);return{lodResources:y,lodRenderer:await this._createLodRenderer(y,i),stageResources:b,symbolSize:o,extentPadding:a,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:v,physicalBasedRenderingEnabled:p,resourceBoundingBox:s,resourceSize:n,pivotOffset:i_}}async _createResourcesForUrl(t,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=mO(this._context.renderer,this._fastVisualVariableConvertOptions(i_,i_,i_,i_)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:N,minWorldLength:V,maxWorldLength:j}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:$o(N),minWorldLength:V||0,maxWorldLength:j!=null?j:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled;const o=s.usePBR,a=await l1e(t,s),l=a.isEsriSymbolResource,c=a.isWosr;this._addDisposeResource(()=>a.remove());const h=CJe(a.lods);OJe(h),h.levels.sort((N,V)=>N.minScreenSpaceRadius-V.minScreenSpaceRadius),h.levels[0].minScreenSpaceRadius=Math.min(2,h.levels[0].minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,g=this._getExternalColorParameters(f),y=Bs(this.symbolLayer,"material","color"),v=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),b=this.needsDrivenTransparentPass,w=l3(h),S=l3(h).map(N=>({opacity:N.parameters.opacity||1,transparent:N.parameters.transparent}));w.forEach(N=>{const V=N.parameters;N.setParameters(g);const j=V.opacity*v,H=j<1||b||V.transparent;N.setParameters({opacity:j,transparent:H}),p.screenSizePerspectiveEnabled&&N.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const x=a.referenceBoundingBox,E=za(zM(x)),R=za(h.levels[0].pivotOffset),O=za(q5(E,this.symbolLayer)),I=Ie(O);gO(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(x,O,E,R))&&w.forEach(N=>N.setParameters(this._fastUpdates.materialParameters));const U=await this._createStageResources(h,o);return{lodResources:h,lodRenderer:await this._createLodRenderer(h,i),stageResources:U,symbolSize:O,extentPadding:I,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:S,physicalBasedRenderingEnabled:o,resourceBoundingBox:x,resourceSize:E,pivotOffset:R}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,i){const r=this._context.stage,s=l3(t);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(s),this._addDisposeResource(()=>r.removeMany(s));const n=sXe(t);r.addMany(n),this._addDisposeResource(()=>r.removeMany(n)),await r.load(n);const o=nXe(t);return r.addMany(o),this._addDisposeResource(()=>r.removeMany(o)),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,O3),os(c,RG(this._fastUpdates.materialParameters,O3,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,O3),tQe(a,this._fastUpdates.materialParameters,O3))}:null,o=new kKe(t,this._optionalFields,s,n);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.hasRenderPlugin(o)&&r.removeRenderPlugin(o)}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(t){const i={};return this._drivenProperties.color?i.externalColor=Wu:_(t)&&_(t.color)?i.externalColor=rt.toUnitRGBA(t.color):(i.externalColor=Wu,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;const r=hO(i.geometry);if(C(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new tu),n=t.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(C(this._resources))return!0;const t=this._drivenProperties.opacity,i=!this.isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=Bs(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this.isPrimitive&&o.setParameters({cullFace:h?Zi.None:Zi.Back})}return!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,ev)}slicePlaneEnabledChanged(){if(C(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(C(this._resources))return!0;const{stageResources:t,isWosr:i}=this._resources;for(const r of t.materials)this.isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,i){if(C(this._resources))return js.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!gO(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return js.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return js.Fast_Update}computeComplexity(){return C(this._resources)?super.computeComplexity():{primitivesPerFeature:AW(this._resources.lodResources.levels[0]).reduce((t,i)=>t+i.indices.get(A.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Cve(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return _(this._resources)}_createAs3DShape(t,i,r,s,n){if(!this._hasLodRenderer()||C(this._resources))return null;const o=this.getFastUpdateAttrValues(t),a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?QC(r.color,r.opacity):null,l=this._context.clippingExtent;if(Mr(i,Gw,this._context.elevationProvider.spatialReference),_(l)&&!dj(l,Gw))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(i,s,Ak,M3),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,hre),f=this._resources.lodRenderer.instanceData,g=f.addInstance();this._instanceIndexToGraphicUid.set(g,n),f.setLocalTransform(g,p,!1),f.setGlobalTransform(g,h),o&&f.setFeatureAttribute(g,o),a&&f.setColor(g,a);const y=new SJe(this,g,kWe,s);return c&&(y.alignedSampledElevation=M3.sampledElevation),y.needsElevationUpdates=ev(s.mode),uO(y,i,this._context.elevationProvider),y}_computeGlobalTransform(t,i,r,s){return ug(t,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),Gw[0]=t.x,Gw[1]=t.y,Gw[2]=s.z,nl(t.spatialReference,Gw,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(t,i,r,s){return sf(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(t,r,s),this._applyAnchor(t,i,s),s}_applyObjectScale(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:t.symbolSize,n=Lte(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||kO(r,r,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const i=t.diff.diff;this._preparePatchTransform(t,i),this._preparePatchColor(t,i)}updateGeometry(t,i){if(C(this._resources))return!0;const r=i&&hO(i);if(C(r))return!1;const s=this.getGeometryElevationMode(i);return t.elevationContext.mode===s&&(this._computeGlobalTransform(r,t.elevationContext,Ak,M3),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=M3.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,Ak,!0),uO(t,r,this._context.elevationProvider),!0)}_preparePatchTransform(t,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||C(this._resources))return;const r=(y,v,b)=>Tt(y!=null&&y.type==="complete"?y.newValue:v,b),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},g=this._resources;this.loadStatus===Cc.LOADED&&t.symbolLayerStatePatches.push(()=>{g.symbolSize=za(q5(g.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((y,v)=>{const b=this._computeLocalTransform(g,f,v,hre),w=y.instanceIndex;g.lodRenderer.instanceData.setLocalTransform(w,b,!0)})}_preparePatchColor(t,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=_(s)?rt.toUnitRGBA(s):Wu;delete r.color;const o=this._resources;C(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return OWe(t.heading,t.tilt,t.roll,r)}_computeAnchor(t,i,r){const s=M();switch(r.anchor){case"center":ne(s,ud(t)),Do(s,s);break;case"top":{const n=ud(t);se(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=ud(t);se(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=ud(t),o=zM(t),a=r.anchorPosition,l=a?Le(a.x,a.y,a.z):pa;P7(s,o,l),fe(s,s,n),Do(s,s);break}default:_(i)?Do(s,i):ne(s,pa)}return s}_applyAnchor(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,i);s&&ga(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,i,r,s){const n=_(t)?za(zM(t)):kp,o=_(t)?this._computeAnchor(t,s,this.symbolLayer):pa,a=this._context.renderCoordsHelper.unitInMeters,l=Lte(_(i)?i:void 0,i,r,a),c=Le(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:_(i)?i:kp,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const Gw=M(),hre=Ae(),Ak=Ae(),O3=ii(),M3=new dM;function jKe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function HKe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function jW(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function qKe(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function WKe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*n-s*r;return o?(o=1/o,e[0]=n*o,e[1]=-r*o,e[2]=-s*o,e[3]=i*o,e):null}function XKe(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function YKe(e){return e[0]*e[3]-e[2]*e[1]}function u1e(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*a+n*l,e[1]=s*a+o*l,e[2]=r*c+n*h,e[3]=s*c+o*h,e}function ZKe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=s*l+o*a,e[2]=r*-a+n*l,e[3]=s*-a+o*l,e}function QKe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1];return e[0]=r*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function JKe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function KKe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function eet(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function tet(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function iet(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function ret(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function h1e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function set(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function net(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Rt*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Rt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Rt*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Rt*Math.max(1,Math.abs(n),Math.abs(c))}function oet(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function aet(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const cet=u1e,uet=h1e;Object.freeze(Object.defineProperty({__proto__:null,copy:jKe,identity:HKe,set:jW,transpose:qKe,invert:WKe,adjoint:XKe,determinant:YKe,multiply:u1e,rotate:ZKe,scale:QKe,fromRotation:JKe,fromScaling:KKe,str:eet,frob:tet,LDU:iet,add:ret,subtract:h1e,exactEquals:set,equals:net,multiplyScalar:oet,multiplyScalarAndAdd:aet,mul:cet,sub:uet},Symbol.toStringTag,{value:"Module"}));class het extends Ar{constructor(t,i,r,s,n,o){super(t,i),this.path=r,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=o}}function d1e(e){return"upVectorAlignment"in e}function p1e(){return[1,0,0,1]}function det(e){return[e[0],e[1],e[2],e[3]]}function pet(e,t,i,r){return[e,t,i,r]}function fet(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:p1e,clone:det,fromValues:pet,createView:fet},Symbol.toStringTag,{value:"Module"}));function DG(){return{up:M(),right:M()}}function met(e,t,i){Fe(e.up,t.up,i),Fe(e.right,t.right,i)}function get(e,t,i){Li(e,Se(i,t.right),Se(i,t.up))}class yet{constructor(){this.pos=M(),this.posES=M(),this.posGS=M(),this.vRight=M(),this.vLeft=M(),this.frame=DG(),this.rotationFrame=DG(),this.rotationRight=lt(),this.rotationAngle=0,this.miterStretch=p1e()}setFrameFromUpVector(t){ne(this.frame.up,t),fe(Cu,this.vLeft,this.vRight),Te(Cu,Cu),oe(Wh,this.frame.up,Se(Cu,this.frame.up)),de(I3,Cu,Wh),Te(I3,I3),_t(this.frame.right,I3,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){ne(this.rotationFrame.up,this.frame.up),ne(this.rotationFrame.right,this.frame.right),Li(this.rotationRight,1,0),oe(Wh,this.frame.up,Se(this.frame.up,this.vLeft)),de(Wh,this.vLeft,Wh),Do(Wh,Wh),Te(Wh,Wh),oe(Cu,this.frame.up,Se(this.frame.up,this.vRight)),de(Cu,this.vRight,Cu),Te(Cu,Cu),_t(LG,this.rotationFrame.up,this.vLeft);const t=Math.sign(Se(LG,this.vRight));if(this.rotationAngle=t*(Math.PI-Hs(Se(Wh,Cu))),Math.abs(this.rotationAngle)>0){const r=j6(Math.cos(.5*this.rotationAngle));jW(this.miterStretch,r-1+1,0,0,1)}const i=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*i))}}class vO{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,i){return this.vertices.push(DA(t)),this.vertexNormals.push(DA(i)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,i=null){return this.poles.push({position:DA(t),normal:i?DA(i):null}),this.poles.length-1}addSegment(t,i=null,r=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),i&&(this.uvIndices.push(i.v0),this.uvIndices.push(i.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,i){for(const r of this.vertices)r[0]+=t,r[1]+=i;for(const r of this.poles)r.position[0]+=t,r.position[1]+=i}static circle(t=20){const r=new vO,s={v0:0,v1:0};r.addPole(Oi(0,0));for(let a=0;a<t;++a){const l=2*a*Math.PI/t,c=Math.cos(l),h=Math.sin(l),p=Oi(c*.5,h*.5),f=Oi(c,h);r.addVertex(p,f),r.addUV(a/t)}r.addUV(1);for(let a=0;a<t-1;++a){const l={v0:a,v1:a+1},c=l;r.addSegment(l,c,s)}const n={v0:t-1,v1:0},o={v0:t-1,v1:t};return r.addSegment(n,o,s),r}static rect(){const r=new vO,s=Oi(.5*-1,.5*-1),n=Oi(.5*1,.5*-1),o=Oi(.5*1,.5*1),a=Oi(.5*-1,.5*1),l=Oi(0,-1),c=Oi(1,0),h=Oi(0,1),p=Oi(-1,0);r.addUV(0),r.addUV(1),r.addPole(Oi(0,.5*1),h),r.addPole(Oi(0,.5*1)),r.addPole(Oi(0,.5*-1)),r.addPole(Oi(0,.5*-1),l);const f={v0:0,v1:1};return r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},f,{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},f,{v0:2,v1:1}),r.addVertex(o,h),r.addVertex(a,h),r.addSegment({v0:4,v1:5},f,{v0:0,v1:0}),r.addVertex(a,p),r.addVertex(s,p),r.addSegment({v0:6,v1:7},f,{v0:1,v1:2}),r}}class vet{constructor(t){this.vertices=[],this.offset=M(),this.xform=Ae(),this.vertices=t;const i=Math.floor((t.length-1)/2);ne(this.offset,this.vertices[i].pos);for(const r of this.vertices)de(r.pos,r.pos,this.offset);ga(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let i=this.vertices[0];i.index=0,se(i.vLeft,0,0,0),i.vLeftLength=0,de(i.vRight,this.vertices[1].pos,i.pos),i.vRightLength=Ie(i.vRight),Te(i.vRight,i.vRight);let r=i;for(let s=1;s<t;++s)i=this.vertices[s],i.index=s,ne(i.vLeft,r.vRight),i.vLeftLength=r.vRightLength,s<t-1?(de(i.vRight,this.vertices[s+1].pos,i.pos),i.vRightLength=Ie(i.vRight),Te(i.vRight,i.vRight)):(ne(i.vRight,i.vLeft),i.vRightLength=i.vLeftLength),r=i}}function _et(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=M(),o=M(),a=M(),l=M(),c=M(),h=M(),p=fi();let f=e.vertices[0];ne(o,t),se(n,0,1,0),Rl.makeOrthoBasisDirUpFallback(f.vRight,o,n,n,a,o,s),ne(f.frame.up,o),ne(f.frame.right,a),i=f;for(let g=1;g<r;++g){f=e.vertices[g],fe(c,f.vLeft,f.vRight);let y=Ie(c);y>0?(y=1/Math.sqrt(y),c[0]=c[0]*y,c[1]=c[1]*y,c[2]=c[2]*y):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),fe(h,i.pos,i.frame.up),SS(f.pos,c,p),Wb(p,Xc(h,f.vLeft),l)?(de(l,l,f.pos),Te(o,l),_t(a,c,o),Te(a,a)):Rl.makeOrthoBasisDirUpFallback(c,i.frame.up,i.frame.right,n,a,o,s),ne(f.frame.up,o),ne(f.frame.right,a),i=f}}class bet{numProfilesPerJoin(){return 1}extrude(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],!1)}}class Ck{constructor(t=.8*Math.PI,i=1){this.cutoffAngle=t,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,i,r){const s=Ret;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){sl(fre,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),met(s,t.frame,fre);for(let o=0;o<i.vertices.length;++o)Ls(i.vertices[o],t.rotationRight)*t.rotationAngle>=0?r(t.index,s,i.vertices[o],i.vertexNormals[o],!1):(J9(O1,i.vertices[o],t.miterStretch),r(t.index,t.frame,O1,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=Ls(i.vertices[o],t.rotationRight)*t.rotationAngle>=0;J9(O1,i.vertices[o],t.miterStretch),r(t.index,t.frame,O1,i.vertexNormals[o],!a)}}}const wet={generateUV:!1};class HW{rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],0,0)}}class dre extends HW{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class P3 extends HW{constructor(t,i=0,r=!1){super(),this.profile=t,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,i){const r=qW;Li(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(t.index,t.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(t,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}}class pre extends HW{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,i){const r=t.frame,s=.5*this.sign,n=O1,o=qW;Li(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(t.index,r,l.position,l.normal,s,0):i(t.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(t.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];Up(n,this.profile.vertices[p],f.position),Fl(n,n,c),f.normal?(id(n,n,f.position),i(t.index,r,n,f.normal,s*h,0)):(zR(o,n),Fl(o,o,c),id(n,n,f.position),i(t.index,r,n,o,s*h,this.sign*h))}}}buildTopology(t,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let f=0;f<this.numSegments-1;++f){const g=s+f*this.profile.vertices.length+o,y=s+f*this.profile.vertices.length+a;this.flip?(i(g,p,h),i(p,g,y)):(i(h,p,g),i(y,g,p)),h=g,p=y}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}}class xet{constructor(t,i,r,s,n,o=wet){this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=i,this.path=t,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}emitTriangle(t,i,r){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=i,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[i],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=i,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}_rebuildGeometry(){const t=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const t=(o,a,l)=>this.emitTriangle(o,a,l);this._triangleCount=0;const i=this.profile.vertices.length,r=this.profile.numSegments,s=this.numExtrusionProfiles-1;let n=3*(2*(r*s));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=i*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let o=0;o<r;++o){const a=this.profile.vertexIndices[2*o],l=this.profile.vertexIndices[2*o+1];for(let c=0;c<s;++c){const h=c*i+a,p=(c+1)*i+l,f=c*i+l;t(h,(c+1)*i+a,p),t(h,p,f)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class f1e{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class m1e extends f1e{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=Eet;se(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=Wh,l=O1,c=Cu,h=LG,p=Cet;let f=0,g=0;if(se(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),se(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),Li(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)_t(c,p,h),f=this.builder.profileRightAxisData[o+3]*t[0],g=this.builder.profileUpAxisData[o+3];else{const v=qW,b=Aet;Li(v,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const w=pq(v);zR(v,v);const S=Ls(l,v);if(Math.abs(S)>w){Li(b,-v[1],v[0]);const x=Ls(l,b);Fl(v,v,w*Math.sign(S)),Fl(b,b,x),id(l,v,b)}se(c,0,0,0)}se(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*f;const y=O1;Li(y,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*y[0]+p[0]*y[1]+c[0]*g,this.vertexAttributeNormal[3*i+1]=h[1]*y[0]+p[1]*y[1]+c[1]*g,this.vertexAttributeNormal[3*i+2]=h[2]*y[0]+p[2]*y[1]+c[2]*g}}createGeometryData(){const t=[[A.POSITION,this.builder.vertexIndices],[A.NORMAL,this.builder.normalIndices]],i=[[A.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[A.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;t.push([A.COLOR,new Uint32Array(r)]),i.push([A.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:i,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,i,r){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},o=s.length/3;lM(t,i,0,o,s,n,void 0,void 0,r)}}class Tet extends f1e{constructor(t,i,r,s){super(t),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new m1e(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[A.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[A.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[A.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[A.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[A.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[A.POSITION,this.builder.pathVertexIndices],[A.PROFILERIGHT,this.builder.vertexIndices],[A.PROFILEUP,this.builder.vertexIndices],[A.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[A.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const Eet=M(),O1=lt(),qW=lt(),Aet=lt(),Wh=M(),Cu=M(),LG=M(),Cet=M(),I3=M(),Ret=DG(),fre=Ae(),Rk=8;function Oet(e,t){e.attributes.add(A.FEATUREVALUE,"vec4");const i=e.vertex;i.code.add(T`bool isCapVertex() {
return featureValue.w == 1.0;
}`),i.uniforms.add(new ke("size")),t.vvSize?(i.uniforms.add(new ke("vvSizeMinSize",F.Pass,r=>r.vvSizeMinSize)),i.uniforms.add(new ke("vvSizeMaxSize",F.Pass,r=>r.vvSizeMaxSize)),i.uniforms.add(new ke("vvSizeOffset",F.Pass,r=>r.vvSizeOffset)),i.uniforms.add(new ke("vvSizeFactor",F.Pass,r=>r.vvSizeFactor)),i.code.add(T`vec2 getSize() {
return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):i.code.add(T`vec2 getSize(){
return size.xy;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",Rk),i.uniforms.add([new Po("vvOpacityValues",F.Pass,r=>r.vvOpacityValues,Rk),new Po("vvOpacityOpacities",F.Pass,r=>r.vvOpacityOpacities,Rk)]),i.code.add(T`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):i.code.add(T`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",bd),i.uniforms.add([new Po("vvColorValues",F.Pass,r=>r.vvColorValues,bd),new b4("vvColorColors",F.Pass,r=>r.vvColorColors,bd)]),i.code.add(T`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):i.code.add(T`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(D4),e.attributes.add(A.PROFILERIGHT,"vec4"),e.attributes.add(A.PROFILEUP,"vec4"),e.attributes.add(A.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(T`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(T`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(T`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(T`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}function Met(e){const t=new Fi,i=Gc(t,e),{vertex:r,fragment:s}=t;return t.varyings.add("vpos","vec3"),t.include(Oet,e),e.output!==Q.Color&&e.output!==Q.Alpha||(t.include(ao),t.include(Pb,e),t.include(mM,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(T`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===Q.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(Qc,e),e.output===Q.Alpha&&(t.include(es,e),s.uniforms.add(new ye("opacity")),s.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===Q.Color&&(t.include(es,e),t.include(Ib,e),t.include(yM,e),t.include(Pb,e),t.include(__e,e),Md(s.uniforms,e),s.uniforms.add([i,new ke("ambient",F.Pass,n=>n.ambient),new ke("diffuse",F.Pass,n=>n.diffuse),new ke("specular"),new ye("opacity"),new ye("lightingGlobalFactor",F.Pass,(n,o)=>o.lighting.globalFactor),new ke("lightingMainIntensity",F.Pass,(n,o)=>o.lighting.mainLight.intensity)]),s.constants.add("ambientBoostFactor","float",$2),s.include(wf),s.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==Q.Depth&&e.output!==Q.Shadow||(t.include(ao,{hasModelTransformation:!1,linearDepth:!0}),r.uniforms.add(new Ft("nearFar",F.Pass,(n,o)=>o.camera.nearFar)),t.varyings.add("depth","float"),r.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(es,e),t.include(dv,e),s.uniforms.add(new ye("timeElapsed")),s.code.add(T`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===Q.Normal&&(t.include(ao),t.include(v0,e),r.uniforms.add(new li("viewNormal",F.Pass,(n,o)=>o.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),r.code.add(T`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(es,e),s.uniforms.add(new dt("waterColor")),s.code.add(T`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===Q.Highlight&&(t.include(ao),t.include(v0,e),t.varyings.add("vnormal","vec3"),r.code.add(T`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(es,e),t.include(xg),s.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const Pet=Object.freeze(Object.defineProperty({__proto__:null,build:Met},Symbol.toStringTag,{value:"Module"})),g1e=new Map([[A.POSITION,0],[A.PROFILERIGHT,1],[A.PROFILEUP,2],[A.PROFILEVERTEXANDNORMAL,3],[A.FEATUREVALUE,4]]);class t5 extends Ki{initializeConfiguration(t,i){i.spherical=t.viewingMode===je.Global,i.doublePrecisionRequiresObfuscation=fM(t.rctx)}initializeProgram(t){const i=t5.shader.get().build(this.configuration);return new Gi(t.rctx,i,g1e)}bindPass(t,i){this.program.bindPass(t,i),this.program.setUniform3fv("size",t.size),this.configuration.output!==Q.Color&&this.configuration.output!==Q.Alpha||this.program.setUniform1f("opacity",t.opacity),this.configuration.output===Q.Color&&(this.program.setUniform3fv("specular",t.specular),this.program.setUniform1f("opacity",t.opacity))}_setPipelineState(t){const i=this.configuration,r=t===gt.NONE,s=t===gt.FrontFace,n=o=>!o.hasSlicePlane&&!(o.transparent||o.doubleSidedMode===Or.None);return Ut({blending:i.output!==Q.Color&&i.output!==Q.Alpha||!i.transparent?null:r?jc:Tg(t),culling:n(i)&&hge,depthTest:{func:hv(t)},depthWrite:r||s?ol:null,colorWrite:Qt,stencilWrite:i.hasOccludees?lf:null,stencilTest:i.hasOccludees?pv:null,polygonOffset:r||s?null:T4})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}t5.shader=new Vi(Pet,()=>import("./Path.glsl.58900e08.js"));class an extends Io{constructor(){super(...arguments),this.output=Q.Color,this.doubleSidedMode=Or.None,this.transparencyPassType=gt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([B({count:Q.COUNT})],an.prototype,"output",void 0),u([B({count:Or.COUNT})],an.prototype,"doubleSidedMode",void 0),u([B({count:gt.COUNT})],an.prototype,"transparencyPassType",void 0),u([B()],an.prototype,"spherical",void 0),u([B()],an.prototype,"receiveShadows",void 0),u([B()],an.prototype,"receiveAmbientOcclusion",void 0),u([B()],an.prototype,"vvSize",void 0),u([B()],an.prototype,"vvColor",void 0),u([B()],an.prototype,"vvOpacity",void 0),u([B()],an.prototype,"hasSlicePlane",void 0),u([B()],an.prototype,"transparent",void 0),u([B()],an.prototype,"hasOccludees",void 0),u([B()],an.prototype,"hasMultipassTerrain",void 0),u([B()],an.prototype,"cullAboveGround",void 0),u([B()],an.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B({constValue:Mt.Disabled})],an.prototype,"pbrMode",void 0),u([B({constValue:!0})],an.prototype,"hasVvInstancing",void 0),u([B({constValue:!1})],an.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],an.prototype,"useFillLights",void 0);class WW extends Tf{constructor(t){super(t,new $et),this.supportsEdges=!0,this._vertexAttributeLocations=g1e,this._configuration=new an,this.vertexBufferLayout=WW.getVertexBufferLayout(this.parameters)}getConfiguration(t,i){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==Q.Color&&t!==Q.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Or.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Or.WindingOrder:Or.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(t){return t!==Ue.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==Ue.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,i,r,s,n,o,a){const l=t;if(!d1e(l))return;const c=l.path,h=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const w=this.parameters.vvSizeOffset,S=this.parameters.vvSizeFactor,x=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,R=c.sizeAttributeValue;h[0]*=He(w[0]+R*S[0],x[0],E[0]),h[1]*=He(w[2]+R*S[2],x[2],E[2])}const p=Math.max(h[0],h[1]),f=t.boundingInfo;if(C(f))return void this._intersectTriangles(c,h,n,o,a);const g=ib(f.bbMin[0]-p,f.bbMin[1]-p,f.bbMin[2]-p,f.bbMax[0]+p,f.bbMax[1]+p,f.bbMax[2]+p),y=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],v=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),b=[v/y[0],v/y[1],v/y[2]];pW(g,n,b,s.tolerance)&&this._intersectTriangles(c,h,n,o,a)}_intersectTriangles(t,i,r,s,n){t.baked.size&&t.baked.size[0]===i[0]&&t.baked.size[1]===i[1]||t.baked.bake(i),t.baked.intersect(r,s,n)}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=r.get(A.POSITION);return zq(s,null,!1,i)}createBufferWriter(){return new Det(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?we.TRANSPARENT_MATERIAL:we.OPAQUE_MATERIAL)||t===we.DRAPED_MATERIAL}createGLMaterial(t){return t.output===Q.Color||t.output===Q.Alpha||t.output===Q.Depth||t.output===Q.Normal||t.output===Q.Highlight||t.output===Q.Shadow&&this.parameters.castShadows?new Iet(t):null}static getVertexBufferLayout(t){let i=ls().vec3f(A.POSITION).vec4f(A.PROFILERIGHT).vec4f(A.PROFILEUP).vec4f(A.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(i=i.vec4f(A.FEATUREVALUE)),i}}class Iet extends cv{_updateParameters(t){return this.ensureTechnique(t5,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(C(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==Q.Color&&this._output!==Q.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class $et extends $W{constructor(){super(...arguments),this.size=[1,1,1],this.ambient=[.2,.2,.2],this.diffuse=[.8,.8,.8],this.specular=[0,0,0],this.opacity=1,this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class Det{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(A.POSITION).length}write(t,i,r,s){const n=o=>{if(i.vertexAttributes.has(o)){const a=i.vertexAttributes.get(o),l=i.indices.get(o);ht(a.size===4);const c=r.getField(o,yn);if(!c)throw new Error("unable to acquire view for "+o);ZS(l,a.data,c,s)}};n(A.PROFILERIGHT),n(A.PROFILEUP),n(A.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(A.FEATUREVALUE)&&n(A.FEATUREVALUE),_4(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}const Let=["polyline"];class Net extends Ef{constructor(t,i,r,s){super(t,i,r,s),this._intrinsicSize=Oi(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=_(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=_(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=mO(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=vO.circle(Bet);break;case"quad":this._profile=vO.rect()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new Ck(0,ket);break;case"bevel":this._extruder=new Ck(0,1);break;case"miter":this._extruder=new Ck(.8*Math.PI,1);break;default:this._extruder=new bet}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new dre,this._endCap=new dre;break;case"butt":default:this._startCap=new P3(this._profile,0),this._endCap=new P3(this._profile,0,!0);break;case"square":this._startCap=new P3(this._profile,-.5),this._endCap=new P3(this._profile,.5,!0);break;case"round":{const g=s==="quad";this._startCap=new pre({profile:this._profile,flip:!1,breakNormals:g,subdivisions:yre}),this._endCap=new pre({profile:this._profile,flip:!0,breakNormals:g,subdivisions:yre});break}}const a=Bs(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=za(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?Zi.None:Zi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Li(this._intrinsicSize,t,i),!aN(this._intrinsicSize[0])||!aN(this._intrinsicSize[1])))throw new Y("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Fl(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled?(Object.assign(f,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new WW(f)):(f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new $b(f)),this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Let,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new tu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const t=Bs(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:i,transparent:r}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,ev)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!gO(this._fastUpdates,i,this._vvConvertOptions))return js.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return js.Fast_Update}getVertexData(t){let i=0;const r=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const g of r)i+=g.length;const l=new Float64Array(3*i),c=new Float64Array(3*i),h=new Float64Array(3*i);let p=0;for(const g of r){s.push({index:p,numVertices:g.length});for(const y of g)l[p++]=y[0],l[p++]=y[1],l[p++]=t.hasZ?y[2]:0}let f=!0;return n.equals(o)?this._copyVertices(l,0,c,0,i):f=Pr(l,n,0,c,o,0,i),o.equals(a)?this._copyVertices(c,0,h,0,i):Pr(c,o,0,h,a,0,i),{pathVertexDataInfos:s,vertexDataGS:l,vertexDataES:c,vertexDataRS:h,projectionSuccess:f,terrainElevation:0}}_copyVertices(t,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=t[i++],r[s++]=t[i++],r[s++]=t[i++]}_createAs3DShape(t,i,r,s){const n=t.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,h=Rs(),p=this._context.renderCoordsHelper;v1e.spatialReference=c;const f=this.getVertexData(n);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(f.pathVertexDataInfos.length>0){for(let g=0;g<f.pathVertexDataInfos.length;++g){const y=f.pathVertexDataInfos[g],v=y.index,b=y.numVertices;if(b<2||_(this._context.clippingExtent)&&(ir(h),Fc(h,f.vertexDataES,3*v,b),!hd(h,this._context.clippingExtent)))continue;const w=[];for(let U=v;U<v+3*b;){const N=U++,V=U++,j=U++,H=new yet;se(H.posGS,f.vertexDataGS[N],f.vertexDataGS[V],f.vertexDataGS[j]),se(H.posES,f.vertexDataES[N],f.vertexDataES[V],f.vertexDataES[j]);const J=MWe(H.posES,this._context.elevationProvider,r,p);se(Xu,f.vertexDataRS[N],f.vertexDataRS[V],f.vertexDataRS[j]),p.setAltitude(Xu,J),se(H.pos,Xu[0],Xu[1],Xu[2]),w.push(H)}const S=new vet(w);y1e(S,this.upVectorAlignment,this._context.renderCoordsHelper);const x=new xet(S,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const U=this._fastUpdates.visualVariables,N=U.size?qm(U.size.field,t):0,V=U.color?qm(U.color.field,t):0,j=U.opacity?qm(U.opacity.field,t):0;E=new Tet(x,N,V,j)}else{const U=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(U[0]*=mre(i.size[0],i.size[2]==="symbol-value"?this.symbolLayer.height||0:i.size[2],this.symbolLayer.width||0),U[1]*=mre(i.size[2],i.size[0]==="symbol-value"?this.symbolLayer.width||0:i.size[0],this.symbolLayer.height||0));let N=null;this._drivenProperties.color&&(N=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(N=N?[N[0],N[1],N[2],i.opacity]:[1,1,1,i.opacity]);const V=new m1e(x);V.bake(U),N&&V.bakeVertexColors(N),E=V}const{vertexAttributes:R,indices:O}=E.createGeometryData(),I=new het(R,O,E,c,this.upVectorAlignment,this.stencilWidth);o.push(I),a.push(this._material),l.push(E.xform)}if(o.length>0){const g={layerUid:this._context.layer.uid,graphicUid:s},y=new Eg({geometries:o,materials:a,transformations:l,metadata:g}),v=new Sf(this,y,o,null,null,Uet,r);return v.alignedSampledElevation=f.terrainElevation,v.needsElevationUpdates=ev(r.mode),v}}else n.paths.length!==0&&n.paths.some(g=>g.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function y1e(e,t,i){switch(t){case"world":for(const r of e.vertices)fe(Kd,r.pos,e.offset),i.worldUpAtPosition(Kd,Xu),r.setFrameFromUpVector(Xu),r.computeRotationAxisAndAngleFromUpVector();break;case"path":fe(Kd,e.vertices[0].pos,e.offset),i.worldUpAtPosition(Kd,Xu),_et(e,Xu);for(const r of e.vertices){const s=Math.sign(Se(r.frame.right,r.vRight));_t(r.rotationFrame.up,r.vRight,r.vLeft),oe(r.rotationFrame.up,r.rotationFrame.up,s),Te(r.rotationFrame.up,r.rotationFrame.up);const n=Se(r.rotationFrame.up,r.frame.up),o=Se(r.rotationFrame.up,r.frame.right);if(oe(Kd,r.frame.up,-o),oe(gre,r.frame.right,n),fe(Kd,Kd,gre),Te(r.rotationFrame.right,Kd),get(r.rotationRight,r.frame,r.rotationFrame.right),Do(Kd,r.vLeft),r.rotationAngle=-s*(Math.PI-Hs(Se(Kd,r.vRight))),Math.abs(r.rotationAngle)>0){const l=j6(Math.cos(.5*r.rotationAngle));jW(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(Math.min(r.vLeftLength,r.vRightLength)*j6(Math.cos(.5*a)))}}}function mre(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function Fet(e,t,i,r){let s=0;for(const n of e.vertices)ug(n.posES,i,t,r,Ok),s+=Ok.sampledElevation,fe(Xu,n.pos,e.offset),r.setAltitude(Xu,Ok.z),de(n.pos,Xu,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function Uet(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;zet.spatialReference=r.spatialReference;for(const a of n){const l=a.geometry;if(!d1e(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;v1e.spatialReference=p,o+=Fet(h,t,i,r),l.upVectorAlignment!=="world"&&y1e(h,l.upVectorAlignment,r),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(a)}return o/n.length}const zet=Sg(0,0,0,null),v1e=Sg(0,0,0,null),Xu=M(),Kd=vi(),gre=vi(),Ok=new dM,ket=3,yre=3,Bet=10;function Vet(e,t,i,r,s=1){if(i.isGeographic&&r===je.Global){const a=new Float64Array(t.typedBuffer.length),l=3*t.count,c=Ci(i);for(let h=0;h<l;h+=3)Fj(t.typedBuffer,h,a,h,c);t=yr.fromTypedArray(a)}Li(Fs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,Ll),Fs[0]=Math.min(Fs[0],Ll[0]),Fs[1]=Math.min(Fs[1],Ll[1]);const n=Fs[0]%s,o=Fs[1]%s;Gu[0]=Fs[0]-n,Gu[1]=Fs[1]-o;for(let a=0;a<t.count;a++)t.getVec(a,Ll),e.setValues(a,(Ll[0]-Gu[0])/s,(Ll[1]-Gu[1])/s,Gu[0]/s,Gu[1]/s)}function _1e(e,t,i,r,s=1){se(Hv,1,0,0),se(qv,0,1,0),se(jw,0,0,1),Het(Mk,t),Get(t,vre)&&jet(vre,Hv,qv,jw,i,Mk),Li(Fs,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Li(Wv,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,Ll);const c=Se(Hv,Ll),h=Se(qv,Ll);Fs[0]=Math.min(Fs[0],c),Fs[1]=Math.min(Fs[1],h),Wv[0]=Math.max(Wv[0],c),Wv[1]=Math.max(Wv[1],h)}const n=Se(jw,Mk);Ik(Hg,Fs[0],Fs[1],n,Hv,qv,jw),Ik(Xv,Wv[0],Fs[1],n,Hv,qv,jw),Ik(Yv,Fs[0],Wv[1],n,Hv,qv,jw),de(Xv,Xv,Hg),oe(Xv,Xv,.5),de(Yv,Yv,Hg),oe(Yv,Yv,.5),fe(Hg,Hg,Xv),fe(Hg,Hg,Yv);const o=Fs[0]%s,a=Fs[1]%s;Gu[0]=Fs[0]-o,Gu[1]=Fs[1]-a;for(let l=0;l<t.count;l++){t.getVec(l,Ll),e.setValues(l,(Se(Hv,Ll)-Gu[0])/s,(Se(qv,Ll)-Gu[1])/s,Gu[0]/s,Gu[1]/s);for(let c=0;c<3;c++)r.set(l,c,Hg[c]),r.set(l,c+3,Xv[c]),r.set(l,c+6,Yv[c])}}const Mk=M(),Ll=M(),vre=fi(),Hv=M(),qv=M(),jw=M(),Fs=lt(),Wv=lt(),Gu=lt(),Hg=M(),Xv=M(),Yv=M();function Get(e,t){const i=e.count-1;return ehe(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function jet(e,t,i,r,s,n){_(s)?(s.basisMatrixAtPosition(n,ep),se($3,ep[0],ep[1],ep[2]),se(D3,ep[4],ep[5],ep[6]),se(Pk,ep[8],ep[9],ep[10])):(se($3,1,0,0),se(D3,0,1,0),se(Pk,0,0,1));const o=e;Se(o,Pk)<0&&oe(o,o,-1),ne(r,o);const a=Se(o,D3),l=Se(o,$3);Math.abs(a)<Math.abs(l)?(V6(t,$3,o,-l),Te(t,t),_t(i,t,o),Te(i,i),oe(i,i,-1)):(V6(i,D3,o,-a),Te(i,i),_t(t,i,o),Te(t,t))}const ep=Ae(),$3=M(),D3=M(),Pk=M();function Het(e,t){se(L3,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,Ll),fe(L3,L3,Ll);oe(e,L3,1/(t.count-1))}const L3=M();function Ik(e,t,i,r,s,n,o){se(e,t*s[0]+i*n[0]+r*o[0],t*s[1]+i*n[1]+r*o[1],t*s[2]+i*n[2]+r*o[2])}function qet(e){const t=new Fi,i=e.output===Q.Depth;Gc(t,e),t.include(ao,{hasModelTransformation:!1,linearDepth:i}),t.include(iw,e),t.attributes.add(A.POSITION,"vec3"),t.varyings.add("vpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float");const{vertex:r,fragment:s}=t;return i&&(t.include(dv,e),r.uniforms.add(new Ft("nearFar",F.Pass,(n,o)=>o.camera.nearFar)),t.varyings.add("linearDepth","float")),r.code.add(T`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),t.include(es,e),t.include(Qc,e),s.include(wf),s.uniforms.add(new dt("eColor")),e.output===Q.Highlight&&t.include(xg),s.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${T.float(co)}) {
      discard;
    }

    ${e.output===Q.Alpha?T`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===Q.Color?T`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===Q.Highlight?T`outputHighlight();`:""};
    ${e.output===Q.Depth?T`outputDepth(linearDepth);`:""};
  }
  `),t}const Wet=Object.freeze(Object.defineProperty({__proto__:null,build:qet},Symbol.toStringTag,{value:"Module"}));class i5 extends Ki{initializeProgram(t){const i=i5.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}bindPass(t,i){this.program.bindPass(t,i),this.program.setUniform4fv("eColor",t.color)}_createPipeline(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:r.output!==Q.Color&&r.output!==Q.Alpha||!r.transparent?null:s?jc:Tg(t),culling:e4(r.cullFace),depthTest:{func:hv(t)},depthWrite:s||n?r.writeDepth&&ol:null,colorWrite:Qt,stencilWrite:r.hasOccludees?lf:null,stencilTest:r.hasOccludees?i?tv:pv:null,polygonOffset:s||n?r.polygonOffset&&Xet:S4(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}i5.shader=new Vi(Wet,()=>import("./ColorMaterial.glsl.7a1b0f6e.js"));const Xet={factor:1,units:1};class fc extends Io{constructor(){super(...arguments),this.output=Q.Color,this.cullFace=Zi.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=gt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([B({count:Q.COUNT})],fc.prototype,"output",void 0),u([B({count:Zi.COUNT})],fc.prototype,"cullFace",void 0),u([B()],fc.prototype,"hasSlicePlane",void 0),u([B()],fc.prototype,"hasVertexColors",void 0),u([B()],fc.prototype,"transparent",void 0),u([B()],fc.prototype,"polygonOffset",void 0),u([B()],fc.prototype,"enableOffset",void 0),u([B()],fc.prototype,"writeDepth",void 0),u([B()],fc.prototype,"hasOccludees",void 0),u([B({count:gt.COUNT})],fc.prototype,"transparencyPassType",void 0),u([B()],fc.prototype,"hasMultipassTerrain",void 0),u([B()],fc.prototype,"cullAboveGround",void 0);class _re extends Tf{constructor(t){super(t,new Zet),this.supportsEdges=!0,this._configuration=new fc}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<x4,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(t,i,r,s,n,o,a){y4(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===we.DRAPED_MATERIAL?!0:Mb(i)===Q.Highlight?t===we.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?we.TRANSPARENT_MATERIAL:we.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:we.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===Q.Color||t.output===Q.Alpha||t.output===Q.Highlight||t.output===Q.Depth&&this.parameters.writeLinearDepth?new Yet(t):null}createBufferWriter(){return new z4(l_e)}}class Yet extends cv{updateParameters(t){return this.ensureTechnique(i5,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==Q.Color&&this._output!==Q.Alpha||this._updateOccludeeState(t),this.updateParameters(t)}}class Zet extends U2{constructor(){super(...arguments),this.color=Vm,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Zi.None,this.hasOccludees=!1}}var Dn;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(Dn||(Dn={}));const NG=.70710678118,bre=NG,Qet=.08715574274;function Jet(e){const t=new Fi;e.draped||t.extensions.add("GL_OES_standard_derivatives");const i=e.output===Q.Depth,{vertex:r,fragment:s}=t;Gc(t,e),t.include(ao,{hasModelTransformation:!1,linearDepth:i}),t.include(iw,e),i&&(t.include(dv,e),r.uniforms.add(new Ft("nearFar",F.Pass,(o,a)=>a.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?r.uniforms.add(new ye("worldToScreenRatio",F.Pass,(o,a)=>1/a.screenToPCSRatio)):t.attributes.add(A.BOUNDINGRECT,"mat3"),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),e.hasMultipassTerrain&&t.varyings.add("depth","float");const n=e.style===Dn.ForwardDiagonal||e.style===Dn.BackwardDiagonal||e.style===Dn.DiagonalCross;return n&&r.code.add(T`
      const mat2 rotate45 = mat2(${T.float(NG)}, ${T.float(-bre)},
                                 ${T.float(bre)}, ${T.float(NG)});
    `),e.draped||(Md(r.uniforms,e),r.uniforms.add(new ye("worldToScreenPerDistanceRatio",F.Pass,(o,a)=>1/a.camera.perScreenPixelRatio)),r.code.add(T`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(T`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(T`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${T.float(Qet)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(T`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${n?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${n?" * rotate45":""};

      ${e.draped?"":T`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${T.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),r.code.add(T`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${i?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),t.include(es,e),s.include(wf),e.draped&&s.uniforms.add(new ye("texelSize")),e.output===Q.Highlight&&t.include(xg),t.include(Qc,e),e.output!==Q.Highlight&&(s.code.add(T`
      const float lineWidth = ${T.float(e.lineWidth)};
      const float spacing = ${T.float(e.patternSpacing)};
      const float spacingINV = ${T.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||s.code.add(T`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),s.uniforms.add(new dt("uColor",F.Pass,o=>o.color)),s.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==Q.Highlight?T`color.a *= ${Ket(e)};`:""}

      if (color.a < ${T.float(co)}) {
        discard;
      }

      ${e.output===Q.Alpha?T`gl_FragColor = vec4(color.a);`:""}

      ${e.output===Q.Color?T`gl_FragColor = color; ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===Q.Highlight?T`outputHighlight();`:""}
      ${e.output===Q.Depth?T`outputDepth(linearDepth);`:""};
    }
  `),t}function Ket(e){function t(i){return e.draped?T`coverage(vuv.${i}, texelSize)`:T`sample(vuv.${i})`}switch(e.style){case Dn.ForwardDiagonal:case Dn.Horizontal:return t("y");case Dn.BackwardDiagonal:case Dn.Vertical:return t("x");case Dn.DiagonalCross:case Dn.Cross:return T`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const ett=Object.freeze(Object.defineProperty({__proto__:null,build:Jet},Symbol.toStringTag,{value:"Module"}));class r5 extends Ki{initializeProgram(t){const i=r5.shader.get().build(this.configuration);return new Gi(t.rctx,i,b1e)}bindPass(t,i){this.program.bindPass(t,i),this.configuration.draped&&this.program.setUniform1f("texelSize",1/i.camera.pixelRatio)}_setPipelineState(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:r.output===Q.Color||r.output===Q.Alpha?s?jc:Tg(t):null,culling:e4(r.cullFace),depthTest:{func:hv(t)},depthWrite:s?r.writeDepth&&ol:w4(t),colorWrite:Qt,stencilWrite:r.hasOccludees?lf:null,stencilTest:r.hasOccludees?i?tv:pv:null,polygonOffset:s||n?r.polygonOffset&&ttt:S4(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}r5.shader=new Vi(ett,()=>import("./Pattern.glsl.3526ac9d.js"));const ttt={factor:1,units:1};class ea extends Io{constructor(){super(...arguments),this.output=Q.Color,this.cullFace=Zi.None,this.transparencyPassType=gt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([B({count:Q.COUNT})],ea.prototype,"output",void 0),u([B({count:Zi.COUNT})],ea.prototype,"cullFace",void 0),u([B({count:Dn.COUNT})],ea.prototype,"style",void 0),u([B({count:gt.COUNT})],ea.prototype,"transparencyPassType",void 0),u([B()],ea.prototype,"hasSlicePlane",void 0),u([B()],ea.prototype,"hasVertexColors",void 0),u([B()],ea.prototype,"polygonOffset",void 0),u([B()],ea.prototype,"writeDepth",void 0),u([B()],ea.prototype,"hasOccludees",void 0),u([B()],ea.prototype,"patternSpacing",void 0),u([B()],ea.prototype,"lineWidth",void 0),u([B()],ea.prototype,"enableOffset",void 0),u([B()],ea.prototype,"draped",void 0),u([B()],ea.prototype,"hasMultipassTerrain",void 0),u([B()],ea.prototype,"cullAboveGround",void 0);const b1e=new Map([[A.POSITION,0],[A.COLOR,3],[A.UVMAPSPACE,4],[A.BOUNDINGRECT,5]]);class XW extends Tf{constructor(t){super(t,new stt),this.supportsEdges=!0,this._vertexAttributeLocations=b1e,this.techniqueConfig=new ea}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<x4,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a){y4(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===we.DRAPED_MATERIAL?!0:Mb(i)===Q.Highlight?t===we.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?we.TRANSPARENT_MATERIAL:we.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===Q.Color||t.output===Q.Alpha||t.output===Q.Highlight||t.output===Q.Depth&&this.parameters.writeLinearDepth?new itt(t):null}createBufferWriter(){const t=ls().vec3f(A.POSITION).vec4u8(A.COLOR).vec4f(A.UVMAPSPACE);return this.parameters.draped||t.mat3f(A.BOUNDINGRECT),new rtt(t)}}class itt extends cv{_updateParameters(t){return this.ensureTechnique(r5,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==Q.Color&&this._output!==Q.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class rtt extends z4{write(t,i,r,s){for(const n of this.vertexBufferLayout.fieldNames){const o=i.vertexAttributes.get(n),a=i.indices.get(n);if(o&&a)switch(n){case A.POSITION:{ht(o.size===3);const l=r.getField(n,pi);l&&v4(a,o.data,t.transformation,l,s);break}case A.COLOR:{ht(o.size===3||o.size===4);const l=r.getField(n,al);l&&tN(a,o.data,o.size,l,s);break}case A.UVMAPSPACE:{ht(o.size===4);const l=r.getField(n,yn);l&&ZS(a,o.data,l,s);break}case A.BOUNDINGRECT:{ht(o.size===9);const l=r.getField(n,Pd);l&&this.writeBoundingRect(a,o.data,t.transformation,l,s);break}}}}writeBoundingRect(t,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],f=i[p],g=i[p+1],y=i[p+2];a[n]=o[0]*f+o[4]*g+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*g+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*g+o[10]*y+o[14];for(let v=3;v<9;++v)a[n+v]=i[p+v];n+=l}}}class stt extends U2{constructor(){super(...arguments),this.color=ri(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Zi.None,this.hasOccludees=!1,this.style=Dn.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function ntt(e,t,i){return att(ott(e),t,i)}function ott(e){return e&&e.pattern||null}function att(e,t,i){return _(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=ri(0,0,0,0),t.transparent=!0),new _re(t)):(t.style=ltt(e.style),t.draped=i.isDraped,new XW(t)):new _re(t)}function ltt(e){switch(e){case"horizontal":return Dn.Horizontal;case"vertical":return Dn.Vertical;case"cross":return Dn.Cross;case"forward-diagonal":return Dn.ForwardDiagonal;case"backward-diagonal":return Dn.BackwardDiagonal;case"diagonal-cross":return Dn.DiagonalCross;default:return}}function ctt(e){return e.material instanceof XW&&!e.material.parameters.draped}function utt(e,t){if(ctt(e)){const i=e.geometry.vertexAttributes,r=i.get(A.POSITION).data,s=i.get(A.UVMAPSPACE).data,n=i.get(A.BOUNDINGRECT).data;_1e(yn.fromTypedArray(s),yr.fromTypedArray(r),t,j0.fromTypedArray(n))}}function htt(e,t,i,r){const s=vve(e,t,i,r),n=e.stageObject.geometryRecords;for(let o=0;o<n.length;o++)utt(n[o],r);return s}const dtt=["polyline","polygon","extent"];class s5 extends Ef{constructor(t,i,r,s){super(t,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(_(this._material))return;const t=Bs(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._material=ntt(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof XW,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(_(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const i=r=>{const s=z_e(t.pattern);return new yT({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:MG(t.patternCap||"butt")})};this._outlineMaterial=i($o(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return _(t)&&t.size&&t.size>0&&_(t.color)&&(C(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,dtt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new tu);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(_(this._material)){const t=this._material.parameters.color,i=Bs(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(_(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=hM(s5.elevationModeChangeTypes,r,s);if(n!==Lr.UPDATE)return n;const o=dh(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){if(_(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),_(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=pO(t.geometry);if(C(s))return null;Xs.renderData=zW(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),Xs.color=i;const n=Xs.renderData.position.length/3;if(this._needsUV&&(Xs.uvMapSpace=new Float32Array(4*n),Xs.boundingRect=new Float64Array(9*n)),Xs.outNum=0,Xs.outGeometries=[],Xs.outTransforms=[],Xs.outMaterials=[],this._createAs3DShapeFill(Xs),this._hasOutline&&this._createAs3DShapeOutline(Xs),this._logGeometryCreationWarnings(Xs.renderData,s.rings,"rings","FillSymbol3DLayer"),Xs.outNum===0)return null;this._needsUV&&_1e(yn.fromTypedArray(Xs.uvMapSpace),yr.fromTypedArray(Xs.renderData.position),this._context.renderCoordsHelper,j0.fromTypedArray(Xs.boundingRect));const o=new Eg({geometries:Xs.outGeometries,materials:Xs.outMaterials,transformations:Xs.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),a=new Sf(this,o,Xs.outGeometries,null,null,htt,r);return a.alignedSampledElevation=Xs.renderData.sampledElevation,a.needsElevationUpdates=dh(r.mode),a}_createAs3DShapeFill(t){const i=t.renderData.polygons;for(const{position:r,mapPosition:s,holeIndices:n,index:o,count:a}of i){if(_(this._context.clippingExtent)&&(ir(Go),Fc(Go,s),!hd(Go,this._context.clippingExtent)))continue;const l=KS(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=Rie({indices:c,attributeData:{position:r,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*o*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*o*t.boundingRect.BYTES_PER_ELEMENT,9*a):null}});t.outGeometries.push(h),t.outMaterials.push(this._material),t.outTransforms.push(Es),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPosition:s,position:n}=i[r];if(_(this._context.clippingExtent)&&(ir(Go),Fc(Go,s),!hd(Go,this._context.clippingExtent)))continue;const o=OG({overlayInfo:null,removeDuplicateStartEnd:Db.REMOVE,attributeData:{position:n,mapPosition:s}}),a=o.vertexAttributes.get(A.POSITION);a.data===n&&(a.data=new Float64Array(n)),t.outGeometries.push(o),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(Es),t.outNum++}}_createAsOverlay(t,i){const r=pO(t.geometry);if(C(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,_(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Yn.renderData=g_e(r,this._context.overlaySR),Yn.color=i;const s=Yn.renderData.position.length/3;return this._needsUV&&(Yn.uvMapSpace=new Float32Array(4*s)),Yn.outNum=0,Yn.outGeometries=[],Yn.outBoundingBox=ir(),Yn.layerUid=this._context.layer.uid,Yn.graphicsUid=t.uid,this._createAsOverlayFill(Yn),this._hasOutline&&this._createAsOverlayOutline(Yn),this._logGeometryCreationWarnings(Yn.renderData,r.rings,"rings","FillSymbol3DLayer"),Yn.outNum===0?null:(this._needsUV&&Vet(yn.fromTypedArray(Yn.uvMapSpace),yr.fromTypedArray(Yn.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),Yn.outNum>0?new V4(this,Yn.outGeometries,Yn.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(t){const i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){if(ir(Go),Fc(Go,r),!hd(Go,this._context.clippingExtent))continue;const a=KS(r,s,3);if(a.length===0)continue;fS(t.outBoundingBox,Go);const l=new Uint32Array(a),c=Rie({indices:l,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null}}),h=new r2(c,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),p=Go;Wi(h.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),t.outGeometries.push(h),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(ir(Go),Fc(Go,s),!hd(Go,this._context.clippingExtent))continue;fS(t.outBoundingBox,Go);const n=OG({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:Db.REMOVE,attributeData:{position:s}}),o=new r2(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),a=Go;Wi(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o),t.outNum++}}_getOutlineOpacity(){const t=Bs(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(_(t)?t.a:0)}_getOutlineColor(){const t=Bs(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return QC(_(t)?rt.toUnitRGB(t):null,i)}test(){return ge(L({},super.test()),{createAsOverlay:(t,i)=>this._createAsOverlay(t,i),createAs3DShape:(t,i,r)=>this._createAs3DShape(t,i,r)})}}s5.elevationModeChangeTypes={definedChanged:Lr.RECREATE,staysOnTheGround:Lr.NONE,onTheGroundChanged:Lr.RECREATE};const Go=Rs(),Xs={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Yn={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},ptt=pe.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class n5{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const i=this.definition.font;return`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()},${t[3]})`}static async fromSymbol(t,i=1){const r=Bs(t,"material","color"),s=Rc(r,Vm,rt.toUnitRGBA),n=Rc(t.size,12,$o),o=t.lineHeight,a=_(t.background)?rt.toUnitRGBA(t.background.color):Vm,l={family:Rc(t.font,"sans-serif",g=>g.family),decoration:Rc(t.font,"none",g=>g.decoration),weight:Rc(t.font,"normal",g=>g.weight),style:Rc(t.font,"normal",g=>g.style)},c=t.halo,h=_(c)&&_(c.color)&&c.size>0?{size:$o(c.size),color:rt.toUnitRGBA(c.color)}:{size:0,color:Vm},p=new n5({color:s,size:n,background:{color:a,padding:_(t.background)?[.65*n,.5*n]:[0,0],borderRadius:_(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=p.fontString(n);try{await document.fonts.load(f)}catch{ptt.warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class ftt{constructor(t,i,r){this._renderer=new M_e(t,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=X$(mtt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new vs(t,{wrap:{s:bt.CLAMP_TO_EDGE,t:bt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:C0.PAD})}}const mtt={canvas:null},gtt=[0,0,1];class ytt extends Ef{constructor(t,i,r,s){super(t,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=E4(this.symbolLayer.size);if(t)throw new Y("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await n5.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const i=t.graphic,r=hO(i.geometry);if(C(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(C(s)||s==="")return null;const n=Cj(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(_(n)&&!pce(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=ge(L({},btt),{verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:WZe(this.symbolLayer.verticalAlignment)});return this._createAs3DShape(i,r,s,o)}createLabel(t,i,r,s){const n=t.graphic,o=hO(n.geometry);if(C(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,i){return wre(t,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Lr.UPDATE}slicePlaneEnabledChanged(t,i){return wre(t,i,r=>{for(const s of r.stageObject.geometryRecords)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=dh(i.elevationContext.mode)||i.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return _tt}_createAs3DShape(t,i,r,s,n,o){const a=this.setGraphicElevationContext(t,new tu,s.elevationOffset),l=Bs(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(C(o)){const H=I_e(s.horizontalPlacement);h=new ftt(r,H,this._textRenderParameters);let J=null;p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{_(J)&&J.release()});const K=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(C(K)||Jc(K))return p.release(),null;J=K}const f=vtt(h,s),g={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(_(p)&&(g.textureId=p.texture.id),_(o)&&(g.textureId=o.id),_(s.verticalOffset)){const{screenLength:H,minWorldLength:J,maxWorldLength:K}=s.verticalOffset;g.verticalOffset={screenLength:$o(H),minWorldLength:J||0,maxWorldLength:K!=null?K:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:H,screenSizePerspectiveSettingsLabels:J}=this._context.sharedResources;g.screenSizePerspective=J.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),g.screenSizePerspectiveAlignment=H}let y;if(l&&(g.shaderPolygonOffset=1e-4),g.hasSlicePlane=this._context.slicePlaneEnabled,_(n)){const H=JSON.stringify(g);y=n.get(H),C(y)&&(y=new QS(g),n.add(H,y))}else y=new QS(g);const v=[y],b=s.translation,w=_(h)?[h.displayWidth,h.displayHeight]:[0,0],S=s.centerOffset,x=gtt,E=[0,0],R=[Rl.createPointGeometry(x,b,null,w,S,E,null)],O=this._context.layer.uid,I=OW(this._context,i,R,v,a,O,c);if(I===null)return null;const U=new Sf(this,I.object,R,C(n)?v:null,p,cO,a);U.alignedSampledElevation=I.sampledElevation,U.needsElevationUpdates=dh(a.mode)||a.mode==="absolute-height";const{displayWidth:N,displayHeight:V}=_(h)?h:s;U.getScreenSize=(H=lt())=>(H[0]=N,H[1]=V,H);const j={labelText:r,elevationOffset:s.elevationOffset};return U.metadata=j,uO(U,i,this._context.elevationProvider),U}}function wre(e,t,i){e&&e.forEach(r=>{const s=t(r);_(s)&&i(s,r.graphic)})}function vtt(e,t){if(t.verticalPlacement==="baseline"){const r=jZe[t.horizontalPlacement],s=_(e)?e.baselineAnchorY:0;return Oi(r,s)}const i=qZe(t.horizontalPlacement,t.verticalPlacement);return Y$[i]}const _tt={mode:"relative-to-ground",offset:0},btt={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},wtt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},xtt=["polyline","polygon","extent"];class Ip extends Ef{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,xtt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new tu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(_(this._material))return;const t=new u_e,i=this.symbolLayer.color;_(i)&&(t.color=rt.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],r],t.transparent=r<1||this.needsDrivenTransparentPass,t.waveDirection=_(this.symbolLayer.waveDirection)?Ip.headingVectorFromAngle(this.symbolLayer.waveDirection):Oi(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=wtt[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new c_e(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(C(this._material))return!0;const t=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:r}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=hM(Ip.elevationModeChangeTypes,r,s);if(n!==Lr.UPDATE)return n;const o=dh(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return _(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=pO(t.geometry);if(C(s))return null;wo.renderData=zW(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);const n=wo.renderData.position.length/3;if(wo.uvCoords=new Float64Array(2*n),wo.outNum=0,wo.outGeometries=[],wo.outTransforms=[],wo.outMaterials=[],this._create3DShapeGeometries(wo),this._logGeometryCreationWarnings(wo.renderData,s.rings,"rings","WaterSymbol3DLayer"),wo.outNum===0)return null;this._createUVCoordsFromVertices(wo.uvCoords,wo.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const o=new Eg({geometries:wo.outGeometries,materials:wo.outMaterials,transformations:wo.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),a=new Sf(this,o,wo.outGeometries,null,null,vve,i);return a.alignedSampledElevation=wo.renderData.sampledElevation,a.needsElevationUpdates=dh(i.mode),a}_createUVCoordsFromVertices(t,i,r,s){const n=Yl(s);nh(qg);for(let l=0;l<r;l++)Li(xre,i[3*l+0],i[3*l+1]),cj(qg,xre);DO(qg,qg,n);const o=qg[0]%Ip.unitSizeOfTexture,a=qg[1]%Ip.unitSizeOfTexture;N3[0]=qg[0]-o,N3[1]=qg[1]-a;for(let l=0;l<r;l++)t[2*l+0]=(i[3*l+0]*n-N3[0])/Ip.unitSizeOfTexture,t[2*l+1]=(i[3*l+1]*n-N3[1])/Ip.unitSizeOfTexture}_create3DShapeGeometries(t){const i=t.renderData.polygons,r=t.uvCoords;for(const{count:s,index:n,position:o,mapPosition:a,holeIndices:l}of i){if(_(this._context.clippingExtent)&&(ir(Wg),Fc(Wg,a),!hd(Wg,this._context.clippingExtent)))continue;const c=KS(a,l,3);if(c.length===0)continue;const h=new Uint32Array(c),p=new Float64Array(r.buffer,2*n*r.BYTES_PER_ELEMENT,2*s),f=Oie({indices:h,attributeData:{position:o,uv0:p,mapPosition:a}});t.outGeometries.push(f),t.outMaterials.push(this._material),t.outTransforms.push(Es),t.outNum++}}_createAsOverlay(t){const i=pO(t.geometry);if(C(i))return null;this._material.renderPriority=this._renderPriority,jo.renderData=g_e(i,this._context.overlaySR);const r=jo.renderData.position.length/3;return jo.uvCoords=new Float64Array(2*r),jo.outNum=0,jo.outGeometries=[],jo.outBoundingBox=ir(),jo.layerUid=this._context.layer.uid,jo.graphicsUid=t.uid,this._createAsOverlayWater(jo),this._logGeometryCreationWarnings(jo.renderData,i.rings,"rings","WaterSymbol3DLayer"),jo.outNum===0?null:(this._createUVCoordsFromVertices(jo.uvCoords,jo.renderData.position,r,this._context.overlaySR),jo.outNum>0?new V4(this,jo.outGeometries,jo.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(t){const i=t.uvCoords,r=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(ir(Wg),Fc(Wg,s),!hd(Wg,this._context.clippingExtent))continue;fS(t.outBoundingBox,Wg);const l=KS(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=new Float64Array(i.buffer,2*o*i.BYTES_PER_ELEMENT,2*a),p=Oie({indices:c,attributeData:{position:s,uv0:h}}),f=new r2(p,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),g=Wg;Wi(f.boundingSphere,.5*(g[0]+g[3]),.5*(g[1]+g[4]),0,.5*Math.sqrt((g[3]-g[0])*(g[3]-g[0])+(g[4]-g[1])*(g[4]-g[1]))),t.outGeometries.push(f),t.outNum++}}static headingVectorFromAngle(t){const i=lt(),r=YN(t);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return ge(L({},super.test()),{create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()})}}Ip.unitSizeOfTexture=100,Ip.elevationModeChangeTypes={definedChanged:Lr.RECREATE,staysOnTheGround:Lr.NONE,onTheGroundChanged:Lr.RECREATE};const N3=lt(),qg=Gt(),xre=lt(),Wg=Rs(),wo={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},jo={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Ttt=pe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function Stt(e,t,i,r){const s=Tre[e.type]&&Tre[e.type][t.type]||Ett[t.type];return s?new s(e,t,i,r):(Ttt.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const Ett={icon:yO,object:GKe,line:H4,path:Net,fill:s5,extrude:PZe,text:ytt,water:Ip},Tre={"mesh-3d":{fill:xJe}};class Att extends EW{constructor(t,i,r){super(i.schedule),this._symbol=t,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let i=0;i<t.symbolLayers.length;i++){const r=this.symbolLayers[i];C(r)||(r.symbol=t,r.symbolLayer=t.symbolLayers.items[i])}}get symbol(){return this._symbol}async doLoad(t){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;F3.renderPriority=1-(1+n)/r,F3.renderPriorityStep=1/r,F3.ignoreDrivers=o._ignoreDrivers;const a=Stt(this.symbol,o,this._context,F3);s.push(HN(t,()=>{this.symbolLayers[n]=null,a.destroy()})),this.symbolLayers[n]=a}await pF(this.symbolLayers,async(n,o)=>{if(_(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}});for(const n of s)n==null||n.remove();if(s.length=0,qt(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const i=this.symbolLayers[t];return _(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,i){const r=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=_(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new OXe(r,i||this,s,t.layer,n)}get complexity(){return RW(this.symbolLayers.map(t=>Bs(t,"complexity")))}globalPropertyChanged(t,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.graphics[s];return l instanceof Sf?l:null};if(_(n)&&!n.globalPropertyChanged(t,i,o))return!1}return!0}applyRendererDiff(t,i){return this.loadStatus!==Cc.LOADED?js.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==js.Recreate_Symbol&&_(s)?Math.min(r,s.applyRendererDiff(t,i)):r,js.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===Cc.FAILED||t.diff.type!=="partial")return;const i=t.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(C(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.graphics[n];_(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(C(s))continue;const n=t.graphics[r];if(C(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(C(r))continue;const s=t.graphics[i];_(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,i=0,r=0;return this.symbolLayers.forEach(s=>{C(s)||(s.loadStatus===Cc.LOADING?t++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:t,slow:i,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)_(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const F3={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class Ctt extends EW{constructor(t,i,r){super(i),this.symbol=t,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const i=await this.symbol.fetchSymbol({signal:t});i.id=this.symbol.id,this.graphics3DSymbol=this.convert(i),_(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:CW}globalPropertyChanged(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,i)}applyRendererDiff(t,i){return _(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,i):js.Recreate_Symbol}prepareSymbolPatch(t){_(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,i)}onRemoveGraphic(){}getFastUpdateStatus(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){_(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function YW(e){return e instanceof Ctt?e.graphics3DSymbol:e instanceof Att?e:null}const _O=pe.getLogger("esri.views.3d.layers.graphics.labelPlacement");function Rtt(e){const t=Ftt(e);if(C(t))return null;const i=Ott(e,t);if(C(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return Ptt({anchor:r,verticalOffset:t.verticalOffset,screenOffset:lt(),centerOffset:ri(0,0,0,-1),centerOffsetUnits:"world",translation:M(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function Ott(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=gd[i],s=r||bN(e);return i&&!r&&_O.warnOncePerTick(`the requested label placement '${i}' is not currently supported in SceneView`),Mtt(s,e)}function ZW(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=YW(t);return _(i)?i.symbol.symbolLayers.getItemAt(0):null}function Mtt(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(C(i))return null;if(_(t.disablePlacement))return t.labelClass.labelPlacement?(_O.warnOncePerTick(Sre(e.placement,t.disablePlacement.logEntityDescription)),bN(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return _O.warnOncePerTick(Sre(e.placement,`'${r}' geometries`)),bN(t);break;case"point":case"mesh":return e}return e}function Sre(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView`}function bN(e){const t=e.graphics3DGraphic.graphic.geometry;if(C(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=ZW(e);return _(i)&&i.type==="extrude"?gd["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return gd["above-center"];default:return}}function Ptt(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(C(r))return null;switch(r.type){case"point":$tt(e,t,i);break;case"polygon":Itt(e,t,i);break;case"mesh":QW(e,t,i.graphics3DGraphic.graphics[0])}return e}function Itt(e,t,i){const r=ZW(i);if(!C(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.graphics[0];_(s)?(s.getBoundingBoxObjectSpace(rR),ud(rR,e.translation),e.translation[2]=Vb(rR)/2):se(e.translation,0,0,0),QW(e,t,s);break}}}function $tt(e,t,i){const r=ZW(i);if(C(r))return;const s=i.graphics3DGraphic.graphics[0];switch(_(s)?s.getCenterObjectSpace(e.translation):se(e.translation,0,0,0),r.type){case"icon":case"text":Dtt(e,t,i,s);break;case"object":QW(e,t,s)}}function Dtt(e,t,i,r){const{graphics3DGraphic:s}=i,n=_(r)?r.getScreenSize():null;if(!s.isDraped&&_(n)){const o=Ltt(i);UE[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),UE[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=UE[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=UE[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=UE[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(gd[i.labelClass.labelPlacement]&&_O.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function Ltt(e,t=Utt){const{graphics3DGraphic:i}=e,r=i.graphics[0],s=_(r)?r.stageObject.geometryRecords[0].material:null;if(s&&s instanceof QS){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function QW(e,t,i){const r=_(i)?i.getBoundingBoxObjectSpace(rR):rR,s=Le(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Ie(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function Ntt(e){return e==="above-center"}function Ftt(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=YW(r.graphics3DSymbol),n=Ks(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=gd[t]||bN(e);return _(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Ere(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(C(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?Ntt(o.placement)?{placement:"above-center",verticalOffset:Ere(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(_O.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function Ere(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const gd={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Are={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in Are){const t=Are[e],i=gd[e];t.forEach(r=>{gd[r]=i})}Object.freeze&&(Object.freeze(gd),Object.keys(gd).forEach(e=>{Object.freeze(gd[e]),Object.freeze(gd[e].normalizedOffset)}));const UE=[0,0],Utt=[0,0],rR=Rs();class Cre{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,i){this._materials.set(t,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}var FG;const $k=512,Dk=4096,ztt=.85,ktt=.95;let qx=FG=class extends be{constructor(e){super(e),this.type=Id.Texture,this.id=Xa(),this.events=new qr,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=it(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,flipped:!0,samplingMode:Je.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return _(this._glTexture)||(this._glTexture=new ot(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(yt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=mn(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=it(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",$k.toString()),e.setAttribute("height",$k.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=$k){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=nS(i),i=Math.min(i,Dk),i}_resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,_(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=zE,e.cursor.y=zE+Rre,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this.atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(A.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+zE,a=n+zE+Rre;if(i.cursor.x+o<i.size.width&&i.cursor.y+a<i.size.height)this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+a+i.lineHeight<i.size.height)){const l=this._getExpectedAtlasUsage(),c=l>ztt&&i.size.width<Dk;return c&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!c&&l>ktt&&i.size.width===Dk?(this._processRemovals(),vT.OK):(this._repack(),vT.REPACK)}i.cursor.x=zE,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return vT.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const i=this.stageObjects.get(t);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(i=>{i.geometries[0].vertexAttributes.get(A.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(A.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],i.geometryVertexAttrsUpdated(i.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if(Us(this.elementsToAddOrUpdate,(s,n)=>{const o=this.elements.get(n);if(o&&o.rendered){const a=this.stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this.elements.get(n);c.get(A.UV0).data=new Float32Array(h.placement.uvMinMax),c.get(A.SIZE).data=new Float32Array([h.placement.size.displayWidth,h.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this.elementsToAddOrUpdate.get(n),t)===vT.REPACK&&(i=!0,!0)}),i)return void this.runTask(P2,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),Us(this.elementsToRender,(s,n)=>(this._processRenderingRequest(s),this.elementsToRender.delete(n),r=!0,e.madeProgress(),e.done)),r&&_(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&FG.test.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((i,r)=>e.push({element:i,key:r}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((i,r)=>i.key.localeCompare(r.key)),this.elements.clear();for(const{element:i,key:r}of e)this.elements.set(r,i);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,_resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};qx.test={orderedRepackingEnabled:!1},u([d({constructOnly:!0})],qx.prototype,"view",void 0),u([d({type:Boolean})],qx.prototype,"updating",void 0),qx=FG=u([P("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],qx);const zE=2,Rre=2;var vT;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(vT||(vT={}));const Ore=pe.getLogger("esri.views.3d.layers.graphics.Labeler");let V_=class extends be{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Jt,this._handles.add([xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(yt.LABELER,this)]),this._textTextureAtlas=new qx({view:this.view}),this._hudMaterialCollection=new Cre(this.view._stage),this._calloutMaterialCollection=new Cre(this.view._stage)}dispose(){this._handles=ct(this._handles),this._textTextureAtlas=it(this._textTextureAtlas),this._hudMaterialCollection=it(this._hudMaterialCollection),this._calloutMaterialCollection=it(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,i)=>{this._labels.set(i,t),t.graphics3DGraphic.setVisibilityFlag($c.USER_SETTING,!0,$n.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,i)=>{t.graphics3DGraphic.setVisibilityFlag($c.USER_SETTING,!1,$n.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(Btt(t)){if(!Mre(t)){if(Vtt(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),Lk(t)){this._dirty=!0;continue}if(!Mre(t))continue}Us(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textTextureResources.initialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),qt(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter(a=>!!a.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let o=!1;await pF(s,async(a,l)=>{const c=a.symbol,h=YW(i.getOrCreateGraphics3DSymbol(c));if(C(h))return void Ore.error("Failed to create Graphics3DSymbol for label");await h.load(),qt(t);let p=null;Cj(c)&&c.hasVisibleCallout()&&(p=EXe(c,i.symbolCreationContext),await p.load(),qt(t));const f=await Ad(fve(a,e.layer.fieldsIndex,this.view.spatialReference));if(qt(t),f.ok===!0){const g=await this._createTextRenderParameters(h.symbol);qt(t),n[l]={labelClass:a,labelFunction:f.value,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:p,calloutSymbolLayerIndex:0,textRenderParameters:g}}else Ore.error(`Label expression failed to evaluate: ${f.error}`),o=!0}),qt(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Tr(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?n5.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced,i.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffsetUnits:i.centerOffsetUnits,horizontalPlacement:Bie(i.anchor),verticalPlacement:HZe(i.anchor),verticalOffset:i.verticalOffset,debugDrawLabelBorder:Ni.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return Xg.graphic=t,Xg.renderingInfo=null,Xg.layer=r,s.createLabel(Xg,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){const n={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return Xg.graphic=e,Xg.renderingInfo=n,Xg.layer=s,i.createGraphics3DGraphic(Xg)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:i}=e,r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const o=t.graphic,a=r.layer,l=BV(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=i.textRenderers[h],f=i.labelPlacements[h];if(C(p)||C(f))continue;const g=s[h],y=g.graphics3DSymbol,v=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,b=y.symbolLayers[0];if(!b)continue;b.setElevationInfoOverride(r.elevationInfoOverride);const w=this._createTextSymbolGraphic(p,o,f,a,b);if(!w)return!1;w._labelClass=g.labelClass,w._labelIndex=h,t.addLabelGraphic(w,c,r.stageLayer),t.setVisibilityFlag($c.USER_SETTING,l,$n.LABEL),t.clearVisibilityFlag($c.SCALE_RANGE,$n.LABEL),t.setVisibilityFlag($c.DECONFLICTION,!1,$n.LABEL),n=!0;const S=g.graphics3DCalloutSymbolLayer;if(S&&f.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const x=this._createLineCalloutGraphic(o,v,S,f,a);_(x)&&(g.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(x,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(i._labelClass==null)continue;const r=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];r!=null&&r.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const w=a.needsHydrationToEvaluate()?bWe(s,i.layer):s;l=a.evaluate(w)}catch{l=null}else l=a.evaluate(s);if(C(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,g=i.disablePlacement,y=Rtt({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:g});if(C(y))continue;const v=Bie(y.anchor),b=I_e(v);t.textRenderers[n]=new M_e(l,b,o.textRenderParameters),t.labelPlacements[n]=y}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const i={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const r=e.labels.get(i);r&&(this._removeGraphic(e,r.graphics3DGraphic),this._addGraphic(e,r.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach(n=>{const o=n.graphics3DGraphic;r.set(o.graphic.uid,o)});const s=n=>n.labelGraphics[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const n=o=>o.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new Bve({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>BV(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textTextureResources.initialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>Lk(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,i)=>t+(Lk(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Btt(e){return e.active&&BV(e.layer)}function Lk(e){return e.labelClassPromise&&!!e.labelClassAbortController}function Mre(e){return e.labelClassContexts&&e.labelClassContexts.length}function Vtt(e){return e.labelClassContexts===null}u([d({constructOnly:!0})],V_.prototype,"view",void 0),u([d({constructOnly:!0})],V_.prototype,"deconflictor",void 0),u([d()],V_.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],V_.prototype,"updating",null),V_=u([P("esri.views.3d.layers.graphics.Labeler")],V_);const Xg=new CXe(null,null,null);class Gtt{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new Jt}loadGLTF(t,i,r){const s=r?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,s,n=>s1e(new i1e(n.streamDataRequester),t,n,r),i)}loadWOSR(t,i){const r=`wosr:${t}:${i.disableTextures}`;return this._fromCache(this.wosrCache,r,s=>n1e(t,s),i)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,i,r,s){return new Promise((n,o)=>{if(Ts(s))return void o(gi());const a=Lo(s,()=>{this._remove(t,i),o(gi())}),l=t.get(i);if(l)return this.evictHandles.remove(i),l.refCount++,void l.item.then(n,o);const c=new AbortController,h=ge(L({},s),{signal:c.signal}),p={refCount:1,abortController:c,item:r(h).then(f=>(p.abortController=null,f.remove=()=>this._remove(t,i),f))};t.set(i,p),p.item.then(f=>{_(a)&&a.remove(),n(f)},f=>{_(a)&&a.remove(),o(f)})})}_remove(t,i){const r=t.get(i);r&&(r.refCount--,r.refCount===0&&this.evictHandles.add(Dwe(()=>{t.delete(i),_(r.abortController)&&r.abortController.abort()},Htt),i))}}const jtt=1e4;let Htt=jtt;class ad{constructor(t,i,r,s=null){this.lij=[0,0,0],this.extent=Gt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Co.VISIBLE_ON_SURFACE,screenRect:Gt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,i,r,s)}acquire(t,i,r,s){this.tilingScheme=s,this.id=ad.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(i,r,s,this.tilingScheme),t[1].acquire(i,r+1,s,this.tilingScheme),t[2].acquire(i,r,s+1,this.tilingScheme),t[3].acquire(i,r+1,s+1,this.tilingScheme),t):[new ad(i,r,s,this.tilingScheme),new ad(i,r+1,s,this.tilingScheme),new ad(i,r,s+1,this.tilingScheme),new ad(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,ig(t.measures.screenRect,this.measures.screenRect)}static id(t,i,r){return`${t}/${i}/${r}`}}var Co;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Co||(Co={}));class t0{constructor(t){this.renderCoordsHelper=t,this.frustum=sO(),this._points=xye(),this.lines=new Array(12),this._origin=M(),this._direction=M(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:M(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){Tye(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),ne(this._origin,t.eye),ne(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let i=0;i<this._points.length;i++)ne(this._points[i],t[i]);Sye(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return m0(this.frustum,t)}intersectsRay(t){return u7e(this.frustum,t)}intersectsLineSegment(t,i){return h7e(this.frustum,t,i)}intersectsPoint(t){return Eye(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const r=i+4;Nk(this.lines[i],t[i],t[r]),Nk(this.lines[i+4],t[i],i===3?t[0]:t[i+1]),Nk(this.lines[i+8],t[r],i===3?t[4]:t[r+1])}}}function Nk(e,t,i){e.origin=t,e.endpoint=i,dg(e.direction,t,i)}t0.planePointIndices=p7e,t0.nearFarLineIndices=[[Qe.NEAR_BOTTOM_LEFT,Qe.FAR_BOTTOM_LEFT],[Qe.NEAR_BOTTOM_RIGHT,Qe.FAR_BOTTOM_RIGHT],[Qe.NEAR_TOP_RIGHT,Qe.FAR_TOP_RIGHT],[Qe.NEAR_TOP_LEFT,Qe.FAR_TOP_LEFT]];const w1e=.5*Math.PI,qtt=w1e/Math.PI*180;class Wtt{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:M(),direction:M()};for(let i=0;i<4;i++)this.extent[i]={origin:M(),direction:M(),cap:{next:null,direction:M()}},this.planes[i]=fi();this.planes[cr.NEAR]=fi(),this.planes[cr.FAR]=fi(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,i,r,s=!0){const n=this.extent;this._toRenderBoundingExtent(t,i,r),fe(this.center.origin,n[0].origin,n[2].origin),oe(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),s||oe(this.center.direction,this.center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this.renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,dg(a.cap.direction,a.origin,l.origin),AR(a.direction,a.cap.direction,a.origin,this.planes[o]),s||oe(a.direction,a.direction,-1)}AR(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[cr.NEAR]),s?FV(this.planes[cr.NEAR],this.planes[cr.FAR]):(xF(this.planes[cr.FAR],this.planes[cr.NEAR]),FV(this.planes[cr.NEAR],this.planes[cr.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=i,this.minGlobalAltitude=.9*Ci(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,i,r=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===je.Global){const n=this.maxSpanSpatialReference.isGeographic?qtt:w1e*i;if(this.maxSpan>n)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const n=this.extent[0];return!(r||!t.intersectsRay(Xc(n.origin,n.direction)))}for(let n=0;n<this.extent.length;n++){const o=this.extent[n];if(!r&&t.intersectsRay(Xc(o.origin,o.direction))||t.intersectsLineSegment(F1(o.origin,o.cap.next,Ytt),o.cap.direction))return!0}const s=r?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(V9e(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,i,r){uj(t,Eh),Eh[2]=r,nl(i,Eh,Fk,this.renderCoordsHelper.spatialReference),jr(Pre,Fk),ir(pl);for(const{x0:n,x1:o,y0:a,y1:l}of Xtt)for(let c=0;c<5;c++){const h=c/4;Eh[0]=ti(t[n],t[o],h),Eh[1]=ti(t[a],t[l],h),Eh[2]=r,kn(Eh,i,Eh,this.renderCoordsHelper.spatialReference),Fe(Eh,Eh,Pre),ef(pl,Eh)}se(this.extent[0].origin,pl[0],pl[1],pl[2]),se(this.extent[1].origin,pl[3],pl[1],pl[2]),se(this.extent[2].origin,pl[3],pl[4],pl[2]),se(this.extent[3].origin,pl[0],pl[4],pl[2]);for(let n=0;n<4;++n)Fe(this.extent[n].origin,this.extent[n].origin,Fk)}_toRenderBoundingExtentLocal(t,i,r){vF(t,i,Ff,this.renderCoordsHelper.spatialReference),se(this.extent[0].origin,Ff[0],Ff[1],r),se(this.extent[1].origin,Ff[2],Ff[1],r),se(this.extent[2].origin,Ff[2],Ff[3],r),se(this.extent[3].origin,Ff[0],Ff[3],r)}_toRenderBoundingExtent(t,i,r){switch(this.renderCoordsHelper.viewingMode){case je.Global:this._toRenderBoundingExtentGlobal(t,i,r);break;case je.Local:this._toRenderBoundingExtentLocal(t,i,r);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(Se(this.center.direction,t.direction)<0)return!0;for(let i=0;i<4;i++){const r=this.extent[i];if(Se(r.direction,t.direction)<0)return!0}return!1}}const Xtt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Eh=M(),Fk=Ae(),Pre=Ae(),pl=Rs(),Ff=Gt(),Ytt=nv();class Ztt{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new t0(t),this.extendedFrustum=new t0(t),this.intersector=new Wtt({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,i){this.surfaceElevation=i,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>i,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return Co.INVISIBLE;const i=this.renderCoordsHelper.viewingMode===je.Global&&t.lij[0]>=Qtt&&t.lij[0]<Jtt,r=this._getOrCalculateSingleTileVisibility(t,!i);return r!==Co.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(t):r}_shortenFrustumFarPlane(t){const i=t0.nearFarLineIndices,r=t.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];de(nc,l,a),oe(nc,nc,eit),fe(r[o],a,nc)}t.updatePoints(r)}_calculateAggregatedChildrenVisibility(t){let i=Co.INVISIBLE;const r=this.cache.get(t.id);if(r!=null)return r;const s=Lre.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Co.INVISIBLE&&(i=o,o===Co.VISIBLE_ON_SURFACE))break}return Lre.release(s),this.cache.set(t.id,i),i}_getOrCalculateSingleTileVisibility(t,i){const r=this.cache.get(t.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(t);return i&&this.cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===je.Global&&t.lij[0]<Ktt?this._calculateSingleTileVisibilitySided(t,!1)===Co.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,i){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,i);const r=Ci(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,r)?this.intersector.isVisibleInFrustum(this.frustum,r,!0)?Co.VISIBLE_ON_SURFACE:Co.VISIBLE_WHEN_EXTENDED:Co.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const i=this.renderCoordsHelper.worldUpAtPosition(t.eye,nc);this.aboveGround||Do(i,i);const r=Hs(-Se(i,t.viewForward));if(this.allTilesInvisible=r>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=r>t.fovY/2,!this.hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this.renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this.renderCoordsHelper.worldUpAtPosition(l,nc),a){case Qe.FAR_BOTTOM_LEFT:case Qe.FAR_TOP_LEFT:case Qe.NEAR_BOTTOM_LEFT:case Qe.NEAR_TOP_LEFT:UV(this.extendedFrustum.planes[cr.LEFT],nc,nc);break;case Qe.FAR_BOTTOM_RIGHT:case Qe.FAR_TOP_RIGHT:case Qe.NEAR_BOTTOM_RIGHT:case Qe.NEAR_TOP_RIGHT:UV(this.extendedFrustum.planes[cr.RIGHT],nc,nc)}oe(nc,nc,s.direction),this.renderCoordsHelper.intersectInfiniteManifold(Xc(l,nc),s.zWithMargin,l)}}if(this.extendedFrustum.updatePoints(n),Oo(n[Qe.NEAR_BOTTOM_LEFT],n[Qe.NEAR_BOTTOM_RIGHT],n[Qe.NEAR_TOP_RIGHT],$re),Oo(n[Qe.NEAR_BOTTOM_RIGHT],n[Qe.NEAR_TOP_RIGHT],n[Qe.NEAR_TOP_LEFT],Dre),Se($re,Dre)<0){const o=this.extendedFrustum.mutablePoints;this.aboveGround?[o[Qe.NEAR_BOTTOM_LEFT],o[Qe.NEAR_BOTTOM_RIGHT]]=[o[Qe.NEAR_BOTTOM_RIGHT],o[Qe.NEAR_BOTTOM_LEFT]]:[o[Qe.NEAR_TOP_LEFT],o[Qe.NEAR_TOP_RIGHT]]=[o[Qe.NEAR_TOP_RIGHT],o[Qe.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-Ire;return{zWithMargin:t,pointIndices:t0.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+Ire;return{zWithMargin:t,pointIndices:t0.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<t}}}const Qtt=2,Jtt=6,Ktt=12,eit=.95,Ire=1,nc=M(),$re=fi(),Dre=fi(),Lre=new as(Array,e=>{e.length!==4&&(e[0]=new ad,e[1]=new ad,e[2]=new ad,e[3]=new ad)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class tit{constructor(t){this.camera=new Di,this.focusOnMap=[0,0],this.screenRect=Gt(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new Ztt(t.renderCoordsHelper)}begin(t,i,r){this.camera.copyFrom(t),this.surfaceElevation=r,this.focusOnMap[0]=i.x,this.focusOnMap[1]=i.y,wEe(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=SEe(t.extent,this.focusOnMap),t.measures.visibility!==Co.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const i=iit,r=1<<i,s=t.measures.screenRect;nh(s);let n=0;const o=t.lij[0]+i,a=t.lij[1]<<i,l=t.lij[2]<<i,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===Co.VISIBLE_WHEN_EXTENDED?this.tileSize*rit:this.tileSize}_computeScreenArea(t,i,r,s,n){const o=t.measures.visibility===Co.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,Yg),nh(Uk);for(let a=0;a<4;a++)cj(Uk,Yg[a]);return S0(n,Uk,n),vee(Yg[0],Yg[1],Yg[2])+vee(Yg[0],Yg[2],Yg[3])}_projectToScreen(t,i,r,s,n){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,i,r,kE),this._toRenderCoords(kE,0,3,Zg[0]),this._toRenderCoords(kE,2,3,Zg[1]),this._toRenderCoords(kE,2,1,Zg[2]),this._toRenderCoords(kE,0,1,Zg[3]),s&&(this._projectToPlane(Zg,this.camera.frustum[cr.NEAR]),this._projectToPlane(Zg,this.camera.frustum[cr.TOP]),this._projectToPlane(Zg,this.camera.frustum[cr.BOTTOM]));for(let o=0;o<4;o++)this.camera.projectToRenderScreen(Zg[o],Nre),this.camera.renderToScreen(Nre,n[o])}_projectToPlane(t,i){for(let s=0;s<4;s++)VE[s]=mr(i,t[s]);const r=Math.max(VE[0],VE[1],VE[2],VE[3]);if(r>0){const s=oe(BE,i,-r);for(let n=0;n<4;n++)fe(t[n],t[n],s)}}_toRenderCoords(t,i,r,s){return BE[0]=t[i],BE[1]=t[r],BE[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(BE,this.tilingScheme.spatialReference,s),s}}const Uk=Gt(),iit=2,rit=5,Yg=[Vr(),Vr(),Vr(),Vr()],kE=Gt(),BE=M(),Zg=[M(),M(),M(),M()],VE=[0,0,0,0],Nre=no();function sgt(e,t,i){if(C(e)||C(i))return!1;let r=!0;return Ns[0]=e.xmin!=null?e.xmin:0,Ns[1]=e.ymin!=null?e.ymin:0,Ns[2]=e.zmin!=null?e.zmin:0,r=r&&Pr(Ns,e.spatialReference,0,t,i,0,1),Ns[0]=e.xmax!=null?e.xmax:0,Ns[1]=e.ymax!=null?e.ymax:0,Ns[2]=e.zmax!=null?e.zmax:0,r=r&&Pr(Ns,e.spatialReference,0,t,i,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),r}function x1e(e,t,i){if(C(e)||C(i))return!1;let r=!0;return Ns[0]=e.xmin!=null?e.xmin:0,Ns[1]=e.ymin!=null?e.ymin:0,Ns[2]=e.zmin!=null?e.zmin:0,r=r&&Pr(Ns,e.spatialReference,0,Ns,i,0,1),t[0]=Ns[0],t[1]=Ns[1],Ns[0]=e.xmax!=null?e.xmax:0,Ns[1]=e.ymax!=null?e.ymax:0,Ns[2]=e.zmax!=null?e.zmax:0,r=r&&Pr(Ns,e.spatialReference,0,Ns,i,0,1),t[2]=Ns[0],t[3]=Ns[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),r}const Ns=M(),sit=pe.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let Rn=class extends be{constructor(e){super(e),this.tiles=new St,this.tileSize=512,this._idToTile=new Map,this._handles=new Jt,this._clients=new Set,this._dirty=!1,this._newTiles=new Vt}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(_(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void sit.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||_(t)&&e&&t.equals(e))return;const i=_(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if(C(this.filterExtent)||!this.tilingScheme)return null;const e=Gt();return x1e(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([xe(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Qr),xe(()=>{var e,t,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),xs)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(yt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=mn(this._frameWorker),this._handles=ct(this._handles)}addClient(){const e=oit();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(P2))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),_(this._frameWorker)&&(this._frameWorker.priority=yt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&_(this._frameWorker)&&(this._frameWorker.priority=yt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new tit({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new ad(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,i)=>{const r=t.measures.screenRect,s=i.measures.screenRect;return r[1]+r[3]-(s[1]+s[3])}),nh(U3);for(let t=0;t<e.length;t++)if(S0(U3,e.data[t].measures.screenRect,U3),F0(U3)>ait)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!nF(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==Co.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(r=>{const s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===Co.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([d({constructOnly:!0})],Rn.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Rn.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],Rn.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],Rn.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],Rn.prototype,"focus",void 0),u([d({constructOnly:!0})],Rn.prototype,"viewState",void 0),u([d({constructOnly:!0})],Rn.prototype,"terrain",void 0),u([d()],Rn.prototype,"tiles",void 0),u([d()],Rn.prototype,"tileSize",void 0),u([d({readOnly:!0})],Rn.prototype,"tilingScheme",null),u([d()],Rn.prototype,"filterExtent",null),u([d({readOnly:!0})],Rn.prototype,"filterExtentRect",null),u([d({readOnly:!0})],Rn.prototype,"rootTileIds",null),u([d({value:!1})],Rn.prototype,"suspended",null),u([d({readOnly:!0})],Rn.prototype,"updating",null),Rn=u([P("esri.views.3d.layers.support.FeatureTileTree3D")],Rn);let nit=0;function oit(){return nit++}const U3=Gt(),ait=10;class sv{constructor(t,i){this.owner=i,this.properties={},this.afterDispatchHandle=null;for(const r in t){const s=t[r],n=new Soe(s,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=Foe(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const i=this.properties[t];for(const r of i.acquired)YX(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this.properties=null,this.owner=null}get(t){const i=this.owner._get(t),r=this.properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this.properties){const i=this.properties[t];let r=0;for(const s of i.acquired)YX(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}}let Cn=class extends be{constructor(){super(...arguments),this._propertiesPool=new sv({camera:Di},this),this._lastSeenCameraProjectionValues=new Di,this.events=new qr,this.viewingMode=je.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new om({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new sv({camera:Di},this)}createInitialCamera(){if(this.viewingMode===je.Global){const e=Ci(this.spatialReference).radius;this.camera=new Di(Le(4*e,0,0),Le(e,0,0),Le(0,0,1))}else this.camera=new Di(Le(0,0,100),Le(0,0,0),Le(0,1,0))}get animation(){return this.cameraController instanceof nO&&_(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==uu&&uu.copyFrom(e),uu.computeUp(this.viewingMode),Fre.camera=uu,this.events.emit("before-camera-change",Fre);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,uu)&&(this._lastSeenCameraProjectionValues.copyFrom(uu),Ure.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",Ure)),(!t||!t.equals(uu))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(uu)),this._cameraChanged=!t||!t.almostEquals(uu),this._cameraChanged)){const i=Foe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return _(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=_(e)?e.clone():null}get fixedContentCamera(){return _(this._contentCamera)}get isGlobal(){return this.viewingMode===je.Global}get isLocal(){return this.viewingMode===je.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(xe(()=>e.state,t=>{t!==Cr.Finished&&t!==Cr.Stopped||(this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i)))},Qr)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Cr.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Cr.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();uu.copyFrom(this._get("camera")),e(uu),this.camera=uu,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Ot.TOP]!==t.padding[Ot.TOP]||e.padding[Ot.RIGHT]!==t.padding[Ot.RIGHT]||e.padding[Ot.BOTTOM]!==t.padding[Ot.BOTTOM]||e.padding[Ot.LEFT]!==t.padding[Ot.LEFT]}};u([d({readOnly:!0,type:DS})],Cn.prototype,"animation",null),u([d({type:Di})],Cn.prototype,"camera",null),u([d()],Cn.prototype,"pixelRatio",null),u([d({})],Cn.prototype,"_contentCamera",void 0),u([d({type:Di})],Cn.prototype,"contentCamera",null),u([d({readOnly:!0})],Cn.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],Cn.prototype,"constraints",void 0),u([d({readOnly:!0})],Cn.prototype,"events",void 0),u([d({readOnly:!0})],Cn.prototype,"isGlobal",null),u([d({readOnly:!0})],Cn.prototype,"isLocal",null),u([d({readOnly:!0})],Cn.prototype,"viewingMode",void 0),u([d({readOnly:!0})],Cn.prototype,"spatialReference",void 0),u([d({readOnly:!0})],Cn.prototype,"navigating",null),u([d({readOnly:!0})],Cn.prototype,"stationary",null),u([d()],Cn.prototype,"_cameraChanged",void 0),u([d()],Cn.prototype,"cameraController",null),Cn=u([P("esri.views.3d.state.ViewState")],Cn);const lit=Cn,uu=new Di,Fre={camera:null},Ure={camera:null};function cit(e,t,i){return e===je.Global?new hit(i):new uit(t,i)}class uit{constructor(t,i){this.elevationProvider=t,this._referenceEllipsoid=Ci(i),this.unitInMeters=Yl(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){n||(n={near:0,far:0});let o=t[2]*this.unitInMeters;const a=o,l=o-s,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(o=l>=0?a-this.unitInMeters*c.min:this.unitInMeters*c.max-a);const h={x:(r=_(r)?r:new ni({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);de(Zv,i,t),Hw[0]=Zv[0]>0?r.xmax:r.xmin,Hw[1]=Zv[1]>0?r.ymax:r.ymin,Hw[2]=Zv[2]>0?p/2:-p/2,de(Hw,Hw,t),Te(Zv,Zv);const f=1.1*Se(Hw,Zv)*this.unitInMeters,g=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),v=y*fit*this.unitInMeters,b=y*mit*this.unitInMeters;let w=He((o-b)/(v-b),0,1);w*=w*w;let S=ti(g,f,w);return S*=Math.max(Math.log(Math.abs(l)),1),S=Math.min(S,Math.max(34064e4,p)),S/=this.unitInMeters,T1e(S,dit,this.unitInMeters,n)}}class hit{constructor(t){this._referenceEllipsoid=Ci(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});const o=Ie(t)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),c=Math.max(l,Math.abs(o));return T1e(1.2*Math.sqrt(c*(c+2*a)),He(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function T1e(e,t,i,r){const s=pit/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const dit=2e4,pit=2,fit=.001,mit=1e-4,Hw=M(),Zv=M();let eD=class extends be{constructor(e){super(e),this.handles=new Jt}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;dye(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{D2(this.view,e,eh.EYE_AND_CENTER)})}};u([d({constructOnly:!0})],eD.prototype,"view",void 0),eD=u([P("esri.views.3d.state.ElevationCollisionConstraint")],eD);let uC=class extends be{constructor(e){super(e),this._handles=new Jt,this.nearFarHeuristic=cit(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([xe(()=>{var e,t,i,r;return[(e=this.view.constraints)==null||(t=e.clipDistance)==null?void 0:t.near,(i=this.view.constraints)==null||(r=i.clipDistance)==null?void 0:r.far]},()=>this._clipDistanceNearFarChanged(),{equals:TI}),xe(()=>{var e,t;return(e=this.view.constraints)==null||(t=e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),xe(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Qr),xe(()=>{var e,t,i,r;return[(e=this.view.constraints)==null||(t=e.altitude)==null?void 0:t.min,(i=this.view.constraints)==null||(r=i.altitude)==null?void 0:r.max]},()=>this._updateAltitude(),{sync:!0,equals:TI}),xe(()=>{var e,t;return(e=this.view.constraints)==null||(t=e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),Qr),xe(()=>{var e,t;return(e=this.view.constraints)==null||(t=e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),Qr),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Qr),xe(()=>{var e,t,i,r,s,n;return[(e=this.view.map)==null||(t=e.ground)==null||(i=t.navigationConstraint)==null?void 0:i.type,(r=this.view.state)==null||(s=r.constraints)==null||(n=s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),{sync:!0,equals:TI})]),this.view.state.isLocal&&this._handles.add(xe(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Bi)),this._updateNearFar(),this.view.state.viewingMode!==je.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new eD({view:this.view}))}destroy(){this._handles=ct(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var e;const t=(e=this.view.constraints)==null?void 0:e.clipDistance;t&&t.mode!=="auto"&&this.view.state.updateCamera(i=>(this._updateCameraNearFarManual(i,t),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,c4(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var e,t,i;const r=(e=this.view.map)==null||(t=e.ground)==null||(i=t.navigationConstraint)==null?void 0:i.type,s=!r||r==="stay-above",n=this.view.state.constraints.collision;if(s!==n.enabled){n.enabled=s,s&&this._reapplyConstraints(ur.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==je.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt($t(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(el(i))}}_updateLocalSurfaceDistance(e){if(C(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=ur.ALL){this.view.state.updateCamera(t=>Kr(this.view,t,{selection:e,interactionType:zt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:gn.TUMBLE}))}};u([d({constructOnly:!0})],uC.prototype,"view",void 0),u([d({readOnly:!0})],uC.prototype,"surfaceCollisionConstraint",void 0),uC=u([P("esri.views.3d.state.ConstraintsManager")],uC);let _T=class extends E1{constructor(e){super(e),this.handles=new Jt}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Cr.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){dye(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),D2(this.view,e,eh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Cr.Stopped)})}};u([d({constructOnly:!0})],_T.prototype,"view",void 0),u([d({constructOnly:!0})],_T.prototype,"desiredCamera",null),_T=u([P("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],_T);const git=.66;function S1e(e){return 360-k7.normalize(e)}function o5(e){return k7.normalize(360-e)}function z3(e){return _(e)&&e.resolver&&e.resolver.reject(),null}function yit(e,t){return _(e)&&e.resolver&&e.resolver.resolve(t),t}function E1e(e,t,i,r=null){if(!t)return z3(r);const s=e.spatialReference||Ke.WGS84;if(_(t.camera)){const c=Ub(t.camera.position,s);if(C(c))return z3(r);const h=t.camera.clone();return h.position=c,yit(r,h)}if(C(t.targetGeometry))return z3(r);const n=t.get("targetGeometry.spatialReference");if(n&&!T0(n,s))return z3(r);const o=YS(e,e.state.camera);let a=lo.ADJUST;if(t.rotation!=null&&(o.heading=S1e(t.rotation),a=lo.LOCKED),i!=null&&(o.tilt=i),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?lW(e,t.scale,c.latitude):e.state.camera.distance,r0e(e,p,h,o,a,r)}const l=t.targetGeometry.extent;return WC(e,l,o.heading,o.tilt,a,r)}function vit(e,t,i=null){return C(i)&&(i=new Cd),eX(e,null,t.clone(),i)}async function _it(e,t,i){const r=Oit(e,t);if(!r)throw new Y("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new il({fov:e.camera.fov}),n=new Cd({camera:s});if(r.target instanceof Cd)return Qv(await xit(e,r.target,r,i,n));if(r.target instanceof il)return Qv(C1e(e,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof ni){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return Qv(o||c?await UG(e,r,r.target.center,s,i,n):await Ait(e,r,r.target,s,i,n))}const a={boundingBox:ir(),hasZ:!1,screenSpaceObjects:[]},l=o?bit(e,r):void 0;if(await A1e(e,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(ud(a.boundingBox,Jr),Ec.x=Jr[0],Ec.y=Jr[1],Ec.z=Jr[2],Ec.spatialReference=e.spatialReference,isFinite(Ec.z)&&a.hasZ?c=aF(a.boundingBox):(Ec.z=void 0,c=EEe(pj(a.boundingBox,Pit))),o||c)return Qv(await UG(e,r,Ec,s,i,n));const h=Mit(e,a.screenSpaceObjects);return Qv(await Rit(e,r,Ec,a.boundingBox,h,s,i,n))}return r.position?Qv(Sit(e,r,s,n)):Qv(await Eit(e,r,s,i,n))}function JW(e,t){return t.scale==null&&t.zoom!=null?o0e(e,t.zoom):t.scale}function bit(e,t){return Lje(e,JW(e,t))}function KW(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=S1e(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function eX(e,t,i,r){const s=e.spatialReference||Ke.WGS84;return t=_(t)?t:Sm(e,i),C(t)||(r.targetGeometry=z0(t.center,e.renderSpatialReference,s),r.scale=a0e(e,t),r.rotation=o5(i.heading),r.camera=i),r}function wN(e,t,i){if(!t)return;if(!T0(t.spatialReference,e.spatialReference))throw new Y("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let o;switch(t.type){case"point":o=t;break;case"multipoint":case"polyline":o=t.extent.center;break;case"mesh":o=t.origin;break;case"extent":o=t.center;break;case"polygon":o=t.centroid}o&&T0(o,e.basemapTerrain.spatialReference)?Jr[2]=Tt(Vp(e.elevationProvider,o),0):Jr[2]=0}(0,Iit[t.type])(t,o=>{r.push(o[0],o[1],o[2])},Jr);const s=r.length/3;if(s===0)return;const n=new Array(r.length);if(Pr(r,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(i.hasZ=!0);for(let o=0;o<n.length;o+=3)t.hasZ?(Jr[0]=n[o+0],Jr[1]=n[o+1],Jr[2]=n[o+2]):(Jr[0]=n[o+0],Jr[1]=n[o+1]),ef(i.boundingBox,Jr)}}async function wit(e,t,i,r){const s=await Ad(e.whenViewForGraphic(t));if(s.ok===!1||C(s.value)||!("whenGraphicBounds"in s.value))return void wN(e,t.geometry,r);const n=s.value,o=await Ad(n.whenGraphicBounds(t,{minDemResolution:i}));if(o.ok===!1)return void wN(e,t.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;fS(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function A1e(e,t,i,r){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return Ec.x=s,Ec.y=n,Ec.z=void 0,Ec.spatialReference=e.spatialReference.isGeographic?e.spatialReference:Ke.WGS84,void wN(e,Ec,r)}t&&typeof t.map=="function"?await Ka(t.map(s=>A1e(e,s,i,r))):t instanceof tl?wN(e,t,r):t instanceof ho&&await wit(e,t,i,r)}async function xit(e,t,i,r,s){if(_(t.camera))return C1e(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=_(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=o5(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=JW(e,i);n!=null&&(s.scale=n);const o=new F2(r);return E1e(e,s,i.tilt,o),s.camera=await o.resolver.promise,s}function C1e(e,t,i){const r=e.spatialReference,s=Ub(t.position,r);return C(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,eX(e,null,t,i))}function Tit(e,t,i,r,s,n){const o=e.renderSpatialReference;return Mr(i.position,B3,o),Mr(t,zk,o),n.targetGeometry=new We(t),s.position=new We(i.position),de(xN,zk,B3),d4(e,B3,xN,r.up,s),n.scale=Rb(e,Yi(B3,zk),n.targetGeometry.latitude),n.rotation=o5(s.heading),n.camera=s,n}async function UG(e,t,i,r,s,n){if(C(i))throw new Y("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=tw(e);if(t.position)return Tit(e,n.targetGeometry,t,o,r,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=oe(Jr,o.viewForward,-l);o.eye=fe(Jr,o.center,c),n.scale=Rb(e,l,i.latitude)}YS(e,o,r);const a=KW(r,t)?lo.LOCKED:lo.ADJUST;if(!t.zoomFactor){n.scale=JW(e,t),n.scale==null&&(Mr(i,Jr,e.renderSpatialReference),Eye(o.frustum,Jr)?n.scale=Rb(e,Yi(o.eye,Jr),i.latitude):n.scale=a0e(e,o));const l=new F2(s);i0e(e,n.targetGeometry,n.scale,r,a,l),n.camera=await l.resolver.promise}return n}function Sit(e,t,i,r){const s=tw(e);return ne(xN,s.viewForward),d4(e,s.eye,xN,s.up,kk),i.position=new We(t.position),i.heading=t.heading!=null?t.heading:kk.heading,i.tilt=t.tilt!=null?t.tilt:kk.tilt,eX(e,null,i,r)}async function Eit(e,t,i,r,s){const n=tw(e);return UG(e,t,z0(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}async function Ait(e,t,i,r,s,n){n.targetGeometry=i.clone();const o=tw(e);YS(e,o,r);const a=KW(r,t)?lo.LOCKED:lo.ADJUST,l=new F2(s);return WC(e,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function Cit(e,t,i,r,s){let n=0;i.hasZ?n=i.z:e.basemapTerrain&&(n=Vp(e.elevationProvider,i)),se(Jr,i.x,i.y,n),nl(e.spatialReference,Jr,zre,e.renderSpatialReference),Wl(k3,zre),lh(k3,k3),ir(GE);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const v=o[y];let b=r[v[2]];isFinite(b)||(b=n),se(Jr,r[v[0]],r[v[1]],b),kn(Jr,e.spatialReference,Jr,e.renderSpatialReference),ef(GE,so(Jr,Jr,k3))}const a=p2(GE),l=Vb(GE),c=f2(GE),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,g=.5*l*p+.5*Math.max(a,c);return Math.max(f,g)/s}async function Rit(e,t,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=tw(e),c=Cit(e,l,i,r,s);YS(e,l,n);const h=KW(n,t)?lo.LOCKED:lo.ADJUST;a.scale=Rb(e,c,a.targetGeometry.latitude);const p=new F2(o);return i0e(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function Oit(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const r in t)i[r]=t[r];t.center&&!i.target&&(i.target=t.center)}return i}function Qv(e){return e&&_(e.camera)&&(e.rotation=o5(e.camera.heading)),e}function Mit(e,t){const i=git;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}const Jr=M(),zre=Ae(),k3=Qi(),GE=Rs(),Pit=Gt(),xN=M(),B3=M(),zk=M(),kk={heading:0,tilt:0},Ec=new We,Iit={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.hasZ?(t(se(i,e.xmin,e.ymin,e.zmin)),t(se(i,e.xmax,e.ymin,e.zmin)),t(se(i,e.xmin,e.ymax,e.zmin)),t(se(i,e.xmax,e.ymax,e.zmin)),t(se(i,e.xmin,e.ymin,e.zmax)),t(se(i,e.xmax,e.ymin,e.zmax)),t(se(i,e.xmin,e.ymax,e.zmax)),t(se(i,e.xmax,e.ymax,e.zmax))):(t(se(i,e.xmin,e.ymin,i[2])),t(se(i,e.xmax,e.ymin,i[2])),t(se(i,e.xmin,e.ymax,i[2])),t(se(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)t(se(i,r[s+0],r[s+1],r[s+2]))}};class $it{constructor(t,i,r){this.target=t,this.options=i,this.view=r,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((s,n)=>{this.resolveCallback=s,this.rejectCallback=n;const o=new AbortController;_(this.options.signal)&&Lo(this.options.signal,()=>{this.abort()}),this.abortController=o,this.waitForReady()})}then(t,i){return this.promise.then(t,i)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(gi());break;case"wait-for-animation-finish":!t&&_(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(gi())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await ab(()=>this.view.ready,this.abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,_it(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const i=this._getCameraFromViewpoint(t);if(!C(i))if(this.options.animate){if(C(this.animationController))return;this.startAnimation(i,this.animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const i=!!(this.target instanceof Cd&&this.target.camera||this.target instanceof il),r=t.camera;if(C(r))return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new Y("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=Sm(this.view,r);return C(s)?(this.reject(new Y("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}startAnimation(t,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(C(r))return void this.reject(new Y("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.active||C(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new _T({view:this.view,desiredCamera:t.camera}),D2(this.view,t.camera,eh.EYE_AND_CENTER)):Kr(this.view,t.camera),i.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof zm&&_(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):_(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!C(this.view.state))switch(i.state){case Cr.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Cr.Ready:case Cr.Rejected:case Cr.Running:case Cr.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t,i=null;const r=this.view.state.cameraController;return r instanceof zm&&(r.updateStateFromViewAnimation(),r.active&&(t=r,i=t.viewAnimation)),t!=null||(t=new zm({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(_(i)&&i.stop(),this.reject(new Y("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const hu=pe.getLogger("esri.views.3d.state.ViewStateManager");let Zs=class extends be{constructor(e){super(e),this.propertiesPool=new sv({frustum:t0},this),this.handles=new Jt,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=YS(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(Sm(this.view,e),{applyConstraints:!1})||hu.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=YS(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=Sm(this.view,e);C(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=za(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([xe(()=>this.contentCamera,()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),xe(()=>this.zoom,n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),xe(()=>this.view.state.camera,n=>{const o=fa(r,n.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():hu.error("#center=","Invalid center",e):hu.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):hu.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=Mje(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return _(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||hu.error("#extent=","Invalid extent",e):hu.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):hu.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Rb(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||hu.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[Ot.TOP]/i),n=Math.round(t[Ot.RIGHT]/i),o=Math.round(t[Ot.BOTTOM]/i),a=Math.round(t[Ot.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,V3),this.view.state.updateCamera(t=>t.padding=V3))}_paddingToArray(e,t,i){e?Wi(i,e.top||0,e.right||0,e.bottom||0,e.left||0):Wi(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return Ed((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?vit(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||hu.error("#viewpoint=","Invalid viewpoint",e);else{const t=_(e.camera)?e.camera.position:e.targetGeometry,i=_(t)&&t.spatialReference;hu.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else hu.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?n0e(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||hu.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(_(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),i!=null){const r=i/Math.max(this.view.width,this.view.height);e=Math.min(e,r)}return e}get _devicePixelRatio(){return C(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([ma(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera))]),xe(()=>this.view.state.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.handles.add(Y1({prepare:()=>this._prepareFrame()})),this.handles.add(xe(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(G3)})),this.handles.add(ma(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new uC({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===je.Local&&this.handles.add(Rd(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(G3),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),G3)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(G3),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i=L({animate:!0},t);return _(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new $it(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(tw(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera(r=>{i.stepController(e,r)}),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){_(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of Nit){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(C(e)||this.cameraSetByUser)return;if(e instanceof il)return void this.setStateCamera(Sm(this.view,e),{applyConstraints:!1});if(e instanceof Cd){if(e.targetGeometry instanceof ni){const s=WC(this.view,e.targetGeometry,0,.5,lo.LOCKED);return void(_(s)&&this.setStateCamera(Sm(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}const t=WC(this.view,e,0,.5,lo.LOCKED);_(t)&&this.setStateCamera(Sm(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&Lit.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!C(e)&&(e instanceof Cd?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof il?this.isCompatible(e.position):e.spatialReference&&T0(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Fit){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=Qg){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=aO(this.view,r,s,e,t,lo.ADJUST);return C(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=WC(this.view,e,t,i,lo.ADJUST,Uit);return _(r)?Sm(this.view,r):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,s=lW(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(o0e(this.view,e))}_viewpointToCamera(e){return Sm(this.view,E1e(this.view,e))}setStateCamera(e,t){return!(C(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&Kr(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new _T({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{container:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._devicePixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(r!==0&&s!==0&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===r&&n.fullHeight===s&&n.pixelRatio===i||(Qg.copyFrom(n),Qg.pixelRatio!==i&&(this._paddingToArray(this.padding,i,V3),Qg.padding=V3),Qg.fullWidth=r,Qg.fullHeight=s,Qg.pixelRatio=i,this.view.state.camera=Qg)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?c4(this.view,e.eye):0;e.relativeElevation=i-r}};u([d({type:il,dependsOn:["view.state.camera","ready"]})],Zs.prototype,"camera",null),u([d({type:il,dependsOn:["view.state.contentCamera","ready"]})],Zs.prototype,"contentCamera",null),u([d({type:We})],Zs.prototype,"center",null),u([d({type:ni})],Zs.prototype,"extent",null),u([d({readOnly:!0})],Zs.prototype,"frustum",null),u([d({readOnly:!0})],Zs.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],Zs.prototype,"ready",void 0),u([d({type:Number})],Zs.prototype,"scale",null),u([d()],Zs.prototype,"padding",null),u([d({readOnly:!0})],Zs.prototype,"screenCenter",null),u([d({constructOnly:!0})],Zs.prototype,"view",void 0),u([d({type:Cd})],Zs.prototype,"viewpoint",null),u([d({type:Number})],Zs.prototype,"zoom",null),u([d()],Zs.prototype,"maximumPixelRatio",null),u([d()],Zs.prototype,"_devicePixelRatio",null),u([d()],Zs.prototype,"_windowDevicePixelRatio",void 0),u([d()],Zs.prototype,"_devicePixelRatioOverride",void 0),u([d()],Zs.prototype,"_maximumPixelRatioOverride",void 0),Zs=u([P("esri.views.3d.state.ViewStateManager")],Zs);const Dit=Zs,Lit=["camera","viewpoint","extent","scale","center","zoom"],Nit=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Fit={heading:0,tilt:0},Uit=new il,Qg=new Di,V3=ii(),G3="pending-initial-view";class zit{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this.view=r,this.externalIntersectionHandlers=new Vt,this.tolerance=XS,this.tmpRay=Ln(),this.tmpRegion=Gt(),this.validateHUDIntersector=hh(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,i){return this.intersectRay(this._getPickRay(t,this.tmpRay),kre(this.viewingMode),i)}intersectScreenFreePointFallback(t,i){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),i)}intersectRayFreePointFallback(t,i){return this.intersectRay(t,kre(this.viewingMode),i)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=zn.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(q3,r,s),q3[0]+=.0466,q3[1]-=.0123,tW(t,q3,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this.tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){const s=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);const s=i.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||xf(s)&&s.intersector!==Rr.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=XS){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===Rr.TERRAIN?1:r.type===Rr.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===Rr.TERRAIN?1:r.type===Rr.TERRAIN?-1:0)}_getPickRay(t,i){const r=this.view.state.camera;return Rye(r,t,i)}_intersectRayFreePointLocal(t,i){if(this.viewingMode!==je.Local||C(t))return!1;const r=this.view.renderDataExtent;if(C(r))return fe(i,t.origin,Te(Ge.get(),t.direction)),!0;const s={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return fe(i,t.origin,Te(Ge.get(),t.direction)),!0;const o=this.view.state.camera,a=Math.max(0,r.xmin-o.eye[0],o.eye[0]-r.xmax),l=Math.max(0,r.ymin-o.eye[1],o.eye[1]-r.ymax),c=Math.sqrt(a*a+l*l),h=Math.abs(o.relativeElevation)+Number.MIN_VALUE,p=Math.max(0,Math.log(n/h))**2;let f=n/Math.max(1,p);f=Math.max(f,Math.min(c,n));const g=oe(Ge.get(),t.direction,f/Ie(t.direction));return fe(i,t.origin,g),!0}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){if(C(t))return null;const n=_(i)?i.mode:"absolute-height",o=_(i)?Tt(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this.view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,a,H3)){const S=this.view.computeMapPointFromVec3d(H3);return S.z-=o,S}return null}const c=this.view.state.camera,h=Ge.get();c.projectToRenderScreen(t.origin,h);const p=new Bre(null,this._forEachLayer),f=this.view.slicePlane,g=_(f)?Uee(f):null,y=hh(this.viewingMode);y.options.store=zn.MIN,y.options.verticalOffset=l;const v=t.origin,b=fe(Ge.get(),v,t.direction);y.reset(v,b,c),y.point=h;const w=_(s)?"type"in s&&s.type==="graphics"?S=>S.metadata.layerUid!==s.uid:S=>S.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const S=x=>(C(w)||w(x))&&x.metadata&&x.metadata.isElevationSource;y.intersect(p.layers,h,this.tolerance,null,S),this.externalIntersectionHandlers.forAll(x=>{if(x.type===Rr.I3S||x.type===Rr.TERRAIN){const E=x.slicePlaneEnabled?g:null;x.intersect(y,E,y.rayBegin,y.rayEnd,h)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(S=>{if(S.isGround){const x=S.slicePlaneEnabled?g:null;S.intersect(y,x,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(H3)){const S=this.view.computeMapPointFromVec3d(H3);return S.z=r,S}return null}computeIntersection(t,i,r){if(C(t))return;const s=this.view.state.camera,n=Ge.get();s.projectToRenderScreen(t.origin,n);const o=new Bre(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=t.origin,l=fe(Ge.get(),t.origin,t.direction);i.reset(a,l,s),i.intersect(o.layers,n,this.tolerance);const c=this.view.slicePlane,h=_(c)?Uee(c):null;i.intersect(o.sliceableLayers,n,this.tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this.externalIntersectionHandlers.forAll(g=>{if(i.options.isFiltered=!o.filterLayerUid(g.layerUid),g.isGround&&p||!i.options.isFiltered){const y=g.slicePlaneEnabled?h:null;g.intersect(i,y,a,l,n)}});const f=Ge.get();if(r&&r.enableDraped&&i.results.ground.getIntersectionPoint(f)){const g=this.view.basemapTerrain.overlayManager.renderer,y=this.view.renderCoordsHelper.spatialReference,v=Ge.get();this.view.renderCoordsHelper.fromRenderCoords(f,v,this.view.spatialReference),v[2]=Tt(this.view.elevationProvider.getElevation(f[0],f[1],f[2],y,"ground"),0),g.intersect(i,v,i.results.ground,b=>o.filterRenderGeometry(b))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){const i=t.results.hud;ig(this.tmpRegion,DB);const r=this.view.state.camera,s=[],n=this.tmpRegion,o=w=>{const S=new Bit(w);r.projectToRenderScreen(w.target.center,S.screenPoint),S.screenPoint[0]=Math.floor(S.screenPoint[0]),S.screenPoint[1]=Math.floor(S.screenPoint[1]),s.push(S),cj(n,S.screenPoint)};t.sortResults(i.all),_(i.min.dist)&&o(i.min);for(const w of i.all)i.min.target.object!==w.target.object&&i.max.target.object!==w.target.object&&o(w);if(_(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-hC),h=Math.max(0,n[1]-hC),p=Math.min(Lp(n)+2*hC,a-c),f=Math.min(F0(n)+2*hC,l-h),g=new Uint8Array(p*f*4);this.view._stage.renderView.readHUDVisibility(c,h,p,f,g);let y=!0;const v=C(t.results.max.dist);let b=0;for(const w of s)for(const S of kit)if(g[4*(Math.min(w.screenPoint[0]+S[0],a)-n[0]+(Math.min(w.screenPoint[1]+S[1],l)-n[1])*p)]){y&&(t.results.min.copy(w.result),y=!1),v&&t.results.max.copy(w.result),t.options.store===zn.ALL&&t.results.all.splice(b++,0,w.result);break}}}const hC=1,kit=(()=>{const e=[],t=hC;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})();class Bit{constructor(t){this.result=t,this.screenPoint=no()}}let j3;function kre(e){return j3&&j3.viewingMode===e||(j3=hh(e)),j3}class Bre{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,i(r=>{r.isPickable&&this.filterLayerUid(r.apiLayerUid)&&(r.isSliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){const{include:i,exclude:r}=this;return C(t)?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function Vre(e){return typeof e=="object"&&"intersect"in e}const H3=M(),q3=no();class ngt{constructor(t,i){this.spatialReference=t,this.view=i}getElevation(t,i,r){return this.view.elevationProvider.getElevation(t,i,0,this.spatialReference,r)}async queryElevation(t,i,r,s,n){return this.view.elevationProvider.queryElevation(t,i,0,this.spatialReference,n,r,s)}}class Vit{constructor(t,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=ge(L({},s),{ignoreInvisibleLayers:!0}),this._frameTask=t.registerTask(yt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,r,s=0){return new Promise((n,o)=>{const a={x:t,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),Lo(r,()=>{p7(this._queries,a),o(gi())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return void t.forEach(c=>c.result.reject());const r=t.map(c=>[c.x,c.y]),s=t.reduce((c,h)=>Math.min(c,h.minDemResolution),1/0),n=new zb({points:r,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,a=_(o)?o.signal:t[0].signal;if(_(o)){let c=0;t.forEach(h=>Lo(h.signal,()=>{c++,h.result.reject(gi()),c===t.length&&o.abort()}))}const l=ge(L({},this._queryOptions),{minDemResolution:s,signal:a});i.queryElevation(n,l).then(c=>{t.forEach((h,p)=>{_(h.signal)&&h.signal.aborted?h.result.reject(gi()):h.result.resolve(c.geometry.points[p][2])})}).catch(c=>{t.forEach(h=>h.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let dC=class extends qr.EventedMixin(be){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=ct(this._elevationQuery)}get elevationQuery(){return C(this._elevationQuery)&&(this._elevationQuery=new Vit(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&r.equals(o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=W3(n,this.im,e,t,i,r,s),C(n)&&(n=W3(n,this.ground,e,t,i,r,s)),s==="scene"&&(n=W3(n,this.scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,o=0){const a=Qm();return this.elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=W3(l,this.scene,e,t,i,r,s)),a.resolve(l)}).catch(l=>{Tr(l)?a.reject(l):a.resolve(this.getElevation(e,t,i,r,s))}),a.promise}register(e,t){this.handles.set(t,t.on("elevation-change",i=>this.emit("elevation-change",i))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function W3(e,t,i,r,s,n,o){for(const a of t){const l=a.getElevation(i,r,s,n,o);_(l)&&(e=_(e)?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],dC.prototype,"view",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],dC.prototype,"spatialReference",void 0),dC=u([P("esri.views.3d.support.CombinedElevationProvider")],dC);class _0{static isValidProfile(t){return t in _0.profiles}static getDefaultProfile(){return ue("trident")||ue("esri-iPhone")?"low":"medium"}static apply(t,i){const r=_0.profiles[t];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable;{const s=i.sceneService["3dObject"],n=r.sceneService["3dObject"];s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumRenderResolution=r.maximumRenderResolution,i.maximumPixelRatio=r.maximumPixelRatio}}function Gre(){const e=!!ue("esri-mobile"),t=!!ue("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ue("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}_0.debug={reset(){const e=Gre();for(const t in e)_0.profiles[t]=e[t]}},function(e){e.profiles=Gre()}(_0||(_0={}));const tD=_0;function tX(){return new Float32Array(4)}function Git(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ph(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function jit(e,t){return new Float32Array(e,t,4)}function R1e(){return tX()}function O1e(){return ph(1,1,1,1)}function M1e(){return ph(1,0,0,0)}function P1e(){return ph(0,1,0,0)}function I1e(){return ph(0,0,1,0)}function $1e(){return ph(0,0,0,1)}const Hit=R1e(),qit=O1e(),Wit=M1e(),Xit=P1e(),Yit=I1e(),Zit=$1e();Object.freeze(Object.defineProperty({__proto__:null,create:tX,clone:Git,fromValues:ph,createView:jit,zeros:R1e,ones:O1e,unitX:M1e,unitY:P1e,unitZ:I1e,unitW:$1e,ZEROS:Hit,ONES:qit,UNIT_X:Wit,UNIT_Y:Xit,UNIT_Z:Yit,UNIT_W:Zit},Symbol.toStringTag,{value:"Module"}));let _p=class extends be{constructor(){super(...arguments),this.color=new rt([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new rt([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=rt.toUnitRGBA(e.color),i=_(e.haloColor)?rt.toUnitRGBA(e.haloColor):t,r=rt.toUnitRGBA(e.shadowColor);return{color:ph(t[0],t[1],t[2],t[3]),haloColor:ph(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:ri(r[0],r[1],r[2],r[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};u([d({type:rt})],_p.prototype,"color",void 0),u([d({type:rt})],_p.prototype,"haloColor",void 0),u([d()],_p.prototype,"haloOpacity",void 0),u([d()],_p.prototype,"fillOpacity",void 0),u([d()],_p.prototype,"shadowOpacity",void 0),u([d({type:rt})],_p.prototype,"shadowColor",void 0),u([d()],_p.prototype,"shadowDifference",void 0),_p=u([P("esri.views.3d.support.HighlightOptions")],_p);const zG=_p;function Qit(e,t,i){const r=Wae(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let G_=class extends _e{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(r=>r.toJSON()),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:u2(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],G_.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],G_.prototype,"outSpatialReference",void 0),u([d()],G_.prototype,"transformation",void 0),u([d()],G_.prototype,"transformForward",void 0),G_=u([P("esri.rest.support.ProjectParameters")],G_);const iX=G_,Jit=As(iX);async function D1e(e,t,i){t=Jit(t);const r=Nde(e),s=L(ge(L({},r.query),{f:"json"}),t.toJSON()),n=t.outSpatialReference,o=u2(t.geometries[0]),a=y$e(s,i);return Pi(r.path+"/project",a).then(({data:{geometries:l}})=>Qit(l,o,n))}async function rX(e=null,t){var i,r;if(rr.geometryServiceUrl)return rr.geometryServiceUrl;if(!e)throw new Y("internal:geometry-service-url-not-configured");let s;s="portal"in e?e.portal||Hl.getDefault():e,await s.load({signal:t});const n=(i=s.helperServices)==null||(r=i.geometry)==null?void 0:r.url;if(!n)throw new Y("internal:geometry-service-url-not-configured");return n}async function Kit(e,t,i=null,r){const s=await rX(i,r),n=new iX;n.geometries=[e],n.outSpatialReference=t;const o=await D1e(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new Y("internal:geometry-service-projection-failed")}var ert=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:rX,projectGeometry:Kit},Symbol.toStringTag,{value:"Module"}));class trt{constructor(t,i){this.spatialReference=i,this.unitInMeters=Yl(this.spatialReference,Ci(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=rX(t&&t.get("portalItem")).catch(()=>{throw new Y("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?r=t:(r=[t],s=!1);const n=r.map(l=>l instanceof We?l:new We(l,this.spatialReference)),o=new iX({geometries:n,outSpatialReference:Ke.WGS84}),a=(await D1e(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return s?a:a[0]}}let Rp=class extends be{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};u([d()],Rp.prototype,"minTotalNumberOfFeatures",void 0),u([d()],Rp.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],Rp.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],Rp.prototype,"snapshotAvailable",void 0),u([d()],Rp.prototype,"polygonLodFactor",void 0),u([d()],Rp.prototype,"polylineLodFactor",void 0),Rp=u([P("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Rp);let Wp=class extends be{constructor(){super(...arguments),this.lodFactor=1}};u([d()],Wp.prototype,"lodFactor",void 0),Wp=u([P("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Wp);let TN=class extends Wp{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};TN=u([P("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],TN);let Am=class extends be{constructor(){super(...arguments),this["3dObject"]=new TN,this.point=new Wp,this.integratedMesh=new Wp,this.pointCloud=new Wp,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:TN})],Am.prototype,"3dObject",void 0),u([d({type:Wp})],Am.prototype,"point",void 0),u([d({type:Wp})],Am.prototype,"integratedMesh",void 0),u([d({type:Wp})],Am.prototype,"pointCloud",void 0),u([d()],Am.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Am=u([P("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Am);let Xy=class extends be{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};u([d()],Xy.prototype,"lodBias",void 0),u([d()],Xy.prototype,"angledSplitBias",void 0),u([d()],Xy.prototype,"reduceTileLevelDifferences",void 0),u([d()],Xy.prototype,"textureFadeDuration",void 0),Xy=u([P("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Xy);let bT=class extends be{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],bT.prototype,"pixelRatio",void 0),u([d()],bT.prototype,"maxTotalNumberOfFeatures",void 0),bT=u([P("esri.views.3d.support.QualitySettings.HeatmapSettings")],bT);let $a=class extends be{constructor(){super(...arguments),this.graphics3D=new Rp,this.sceneService=new Am,this.tiledSurface=new Xy,this.heatmap=new bT,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};u([d({type:Rp})],$a.prototype,"graphics3D",void 0),u([d({type:Am})],$a.prototype,"sceneService",void 0),u([d({type:Xy})],$a.prototype,"tiledSurface",void 0),u([d({type:bT})],$a.prototype,"heatmap",void 0),u([d()],$a.prototype,"antialiasingEnabled",void 0),u([d()],$a.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],$a.prototype,"highQualityTransparency",void 0),u([d()],$a.prototype,"memoryLimit",void 0),u([d()],$a.prototype,"additionalCacheMemory",void 0),u([d()],$a.prototype,"frameRate",void 0),u([d()],$a.prototype,"maximumRenderResolution",void 0),u([d()],$a.prototype,"maximumPixelRatio",void 0),$a=u([P("esri.views.3d.support.QualitySettings.QualitySettings")],$a);const jre=$a;class SN{constructor(t,i,r,s){this.viewingMode=t,this.spatialReference=i,this.unitInMeters=r,this.coordinateSystem=s,this._coordinateSystem=cMe(s)}set extent(t){t&&uMe(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return vMe(this.coordinateSystem,t)}setAltitude(t,i,r=t){return mhe(this.coordinateSystem,r,i,t)}setAltitudeOfTransformation(t,i){_Me(this.coordinateSystem,i,t,i)}worldUpAtPosition(t,i){return fMe(this.coordinateSystem,t,i)}worldBasisAtPosition(t,i,r){return mMe(this.coordinateSystem,t,i,r)}basisMatrixAtPosition(t,i){const r=this.worldBasisAtPosition(t,Bc.X,Ge.get()),s=this.worldBasisAtPosition(t,Bc.Y,Ge.get()),n=this.worldBasisAtPosition(t,Bc.Z,Ge.get());return yf(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}intersectManifoldClosestSilhouette(t,i,r){return sU(this.coordinateSystem,i,this._coordinateSystem),yMe(this._coordinateSystem,t,r),r}intersectManifold(t,i,r){sU(this.coordinateSystem,i,this._coordinateSystem);const s=Ge.get();return gMe(this._coordinateSystem,t,s)?ne(r,s):null}intersectInfiniteManifold(t,i,r){if(this.viewingMode===je.Global)return this.intersectManifold(t,i,r);sU(this.coordinateSystem,i,this._coordinateSystem);const s=this._coordinateSystem.value,n=Ge.get();return Wb(s.plane,t,n)?ne(r,n):null}toRenderCoords(t,i,r){return ZL(t)?Mr(t,i,this.spatialReference):kn(t,i,r,this.spatialReference)}fromRenderCoords(t,i,r=null){return ZL(i)?(_(r)&&(i.spatialReference=r),fue(t,this.spatialReference,i)):i instanceof Ke?z0(t,this.spatialReference,i):kn(t,this.spatialReference,i,r)?i:null}static create(t,i){switch(t){case je.Local:return new SN(je.Local,i,Yl(i),pMe());case je.Global:return new SN(je.Global,i,1,dMe(i))}}static renderUnitScaleFactor(t,i){return Hre(t)/Hre(i)}}function Hre(e){if(QL(e,je.Global))return 1;const t=ghe(!1,e);return Yl(t)}var zp;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(zp||(zp={}));const irt=(()=>{const e=new Array;return e[zp.ELEVATION]=10,e[zp.BASEMAP]=10,e[zp.I3S_INDEX]=10,e[zp.I3S_DATA]=10,e[zp.SYMBOLOGY]=5,e})(),rrt=30;function L1e(e){return typeof e.getUsedMemory=="function"}const srt=pe.getLogger("esri.views.3d.support.MemoryController");function nrt(e){return new Ru({view:e})}const X3=1,Bk=1,ort=.75,art=.6,qre=1.3;let Ru=class extends be{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new HH,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(X3),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new p4e(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<art&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(X3);else if(e)(this._memoryPredicted>1.1*Bk||this._memoryUsed>Bk)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/qre),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>Bk)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/qre),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<ort&&this._quality<X3){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),X3))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;_(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(L1e(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);srt.warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([d({constructOnly:!0})],Ru.prototype,"view",void 0),u([d()],Ru.prototype,"maxMemory",null),u([d()],Ru.prototype,"additionalCacheMemory",null),u([d()],Ru.prototype,"memoryFactor",null),u([d()],Ru.prototype,"updating",null),u([d()],Ru.prototype,"usedMemory",null),u([d()],Ru.prototype,"_quality",void 0),u([d()],Ru.prototype,"_memoryUsed",void 0),u([d()],Ru.prototype,"_updating",void 0),Ru=u([P("esri.views.3d.support.MemoryController")],Ru);class lrt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class crt{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new urt}}class urt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class hrt{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new crt(n))}hasQuota(t){const i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){const i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const i=this._clients[t.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,ht(i.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){const i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const t=this;return{set workerFunc(i){t._workerFunc=i}}}}let iD=class extends be{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new hrt((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(yt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=mn(this._frameTask),this._tasks.forEach(e=>rh(e.abortController)),this._loadQueue=ct(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=Qm();s.__signal=_(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return Lo(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){const o=new frt(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){UN(e.resolvers,t),t.reject(gi()),e.resolvers.length===0&&(e.status===Pu.DOWNLOADING&&(e.status=Pu.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=Pu.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=mrt(_(r)&&r.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(ht(e.status===Pu.DOWNLOADING),e.status=Pu.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();qt(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==Pu.DOWNLOADED&&(t.err=t.err||gi()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Tr(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)Tr(t)?r.reject(t):r.reject(new Y("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const s=i<=0?e.result:re(e.result);r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Pu.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=Pu.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=Pi(e.url,ge(L({},e.options),{responseType:r,timeout:i,signal:s}));let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===Pu.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=prt(c);if(r="image",e.size=c.byteLength,h==="unknown")return e.request=Pi(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(g=>o(g.data),a);const p=new Blob([c],{type:h}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=Pi(f,{responseType:r,timeout:i,signal:s}),e.request.then(g=>o(new bO(g.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],iD.prototype,"updating",void 0),iD=u([P("esri.views.3d.support.StreamDataLoader")],iD);const drt={numRetries:0};function prt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class bO{constructor(t,i,r){this.image=t,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}}class frt extends lrt{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Pu.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=drt.numRetries}}function mrt(e,t,i){return`${e}:${t}:${i}`}var Pu;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(Pu||(Pu={}));let Y3=class extends be{constructor(){super(...arguments),this.updating=!1}};function grt(e,t=()=>performance.now()){return new kG.ResourceController({view:e,now:t})}var kG;u([d({readOnly:!0})],Y3.prototype,"updating",void 0),Y3=u([P("esri.views.3d.support.ResourceController")],Y3),function(e){let t=class extends Y3{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=$S,this._cameraChangeTime=0,this._handles=new Jt,this._frameTask=null,this._state=un.IDLE}initialize(){this._cameraChangeTime=this.now(),this._scheduler=h6e(this.now),this._memoryController=nrt(this.view),this._streamDataLoader=new iD,this._streamDataLoader.setup(rrt,irt,this._scheduler),this._handles.add([xe(()=>{var r;return(r=this.view.state)==null?void 0:r.camera},(r,s)=>this._cameraChangedHandler(r,s),Qr),xe(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Y1({update:r=>this._frame(r)}),this._scheduleTask=this._scheduler.registerTask(yt.RESOURCE_CONTROLLER)}destroy(){this._handles=ct(this._handles),this._scheduleTask.remove(),this._frameTask=mn(this._frameTask),this._streamDataLoader=ct(this._streamDataLoader),this._memoryController=ct(this._memoryController),this._scheduler=ct(this._scheduler)}get updating(){var r,s,n;return!!((r=this._memoryController)!=null&&r.updating||(s=this._streamDataLoader)!=null&&s.updating||(n=this._scheduleTask)!=null&&n.updating)}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(r,s,n){return this._scheduleTask.schedule(r,s,n)}createStreamDataRequester(r){const s=this._streamDataLoader;return{request:(n,o,a)=>s.request(n,o,r,a),get busy(){return!s.hasDownloadSlots(r)}}}_frame(r){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(S7(r.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(r)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(r,s){r&&s&&r.almostEquals(s)||(this._cameraChangeTime=this._scheduler.now,this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=un.ANIMATING:this.view.interacting?this._state=un.INTERACTING:(this._state===un.ANIMATING&&(this._cameraChangeTime=0),this._scheduler.now-this._cameraChangeTime<=i?this._state=un.INTERACTING:this._state=un.IDLE)}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r),state:this._state}}};u([d({constructOnly:!0})],t.prototype,"view",void 0),u([d({constructOnly:!0})],t.prototype,"now",void 0),u([d()],t.prototype,"_scheduler",void 0),u([d()],t.prototype,"_memoryController",void 0),u([d()],t.prototype,"_streamDataLoader",void 0),u([d()],t.prototype,"_scheduleTask",void 0),u([d({readOnly:!0})],t.prototype,"updating",null),t=u([P("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const i=300}(kG||(kG={}));function yrt(e){return"performanceInfo"in e}const qw=M(),vrt=M(),Uf=M(),zf=M();function _rt(e,t,i=0){const r=e.extent;if(C(r))return!1;if(i===0)return Ple(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return TEe(r,t,i*s)}function Z3(e,t,i,r){ne(qw,i),qw[r]=t[r];const s=de(qw,qw,t),n=de(vrt,e,t),o=Se(n,s),a=Se(s,s);let l;l=o<=0?t:a<=o?i:fe(qw,t,oe(s,s,o/a));const c=de(qw,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function brt(e,t,i){const r=e.extent;if(C(r))return 0;Uf[0]=r[0],Uf[1]=r[1],Uf[2]=i,zf[0]=r[2],zf[1]=r[3],zf[2]=i;let s=1/0,n=1/0;return t[0]<Uf[0]?s=Z3(t,Uf,zf,0):t[0]>zf[0]&&(s=Z3(t,zf,Uf,0)),t[1]<Uf[1]?n=Z3(t,Uf,zf,1):t[1]>zf[1]&&(n=Z3(t,zf,Uf,1)),Math.min(s,n)}function wrt(e,t,i){if(C(e))return cq();if(e.spatialReference.isGeographic&&!hb(e.spatialReference))return new Y("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=br.checkUnsupported(e);if(_(r))return r;if(C(i))return new Y("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=xrt(e,i);if(s)return s;const n=e.spatialReference;return _(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new Y("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function xrt(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],o=Mle(t),a=Gt();br.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>aT){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new Y("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:aT})}return null}const Trt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:_rt,tiltToExtentEdge:brt,checkIfTileInfoSupportedForViewSR:wrt},Symbol.toStringTag,{value:"Module"}));function Srt(){return!0}function Ert(){return 0}function Art(e,t){if(C(e))return cq();const i=e.lods.length-1,r=e.spatialReference,s=hb(r)||pf(r)||ff(r);if(r.isWebMercator){if(!br.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new Y("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new Y("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!br.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new Y("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new Y("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return _(t)&&!e.spatialReference.equals(t)?new Y("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const Crt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:Srt,tiltToExtentEdge:Ert,checkIfTileInfoSupportedForViewSR:Art},Symbol.toStringTag,{value:"Module"})),Rrt={[je.Global]:Crt,[je.Local]:Trt};function Kh(e,t){e||console.warn("Terrain: "+t)}function BG(e){return sX(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function EN(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function sX(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function N1e(e){return(e==null?void 0:e.type)==="tile-3d"}function AN(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function Ort(e){return(e==null?void 0:e.type)==="wmts-3d"}function rD(e){return(e==null?void 0:e.type)==="elevation-3d"}function jT(e){return e&&(N1e(e)||sX(e)||rD(e)||AN(e)||Ort(e))}function Mrt(e){var t;const i=e==null||(t=e.sourceLayerInfo)==null?void 0:t.data;return _(i)&&"type"in i&&i.type==="raster-tile"}function Prt(e){var t;const i=e==null||(t=e.sourceLayerInfo)==null?void 0:t.data;return _(i)&&"type"in i&&i.type==="vector-tile"}function Irt(e){var t;const i=e==null||(t=e.sourceLayerInfo)==null?void 0:t.data;return _(i)&&"type"in i&&i.type==="tile-texture"}function $rt(e){var t;const i=e==null||(t=e.sourceLayerInfo)==null?void 0:t.data;return i instanceof HTMLImageElement||i instanceof bO||i instanceof HTMLCanvasElement||i instanceof ImageData}function HT(e){return _(e)&&"release"in e&&e.release(),null}function Wre(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function a5(e,t,i,r){return Rrt[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function l5(e,t,i){let r=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=Drt(e,t,i);r=n.tileInfo,s=n.fullExtent}else{s=EN(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=i===je.Local;if(EN(e))r=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!Lrt(t)||Nrt.force512VTL,a=e.tileInfo.spatialReference.isGeographic;r=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=e.tileInfo}return _(r)&&_(s)&&a5(r,s,t,i)==null?{tileInfo:r,fullExtent:s}:null}function Drt(e,t,i){const r=CMe(e);if(_(r)){if(!St.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>a5(n.tileInfo,n.fullExtent,t,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function Lrt(e){return e.isWGS84||e.isWebMercator||Tae(e)||!dR(e)}const Nrt={force512VTL:!1};class Frt{constructor(t,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=jT(t)?i.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),yrt(t)){const r=t.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}}class Urt{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const i=t.resourceController.memoryController;this.totalMemory=i.maxMemory*db.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const r=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=_(r)?r.usedMemory:0,t.allLayerViews.items.forEach(s=>{(L1e(s)||jT(s))&&this.layerPerformanceInfos.push(new Frt(s,t))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}}class zrt extends lT{constructor(t,i,r,s){super(i,s),this._streamDataRequester=t,this._parameters=r}async fromUrl(t,i,r){qt(r);const s=_(r)&&r.signal,n=this.makeUid(t,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a},this._textureRequests.set(n,o),o.textureAsync=l.then(async c=>{const h=this._createTexture(t,c,i);return o.texture=h,o.abortController=null,this._stage.add(h),await this._stage.load(h),{uid:n,texture:h,release:()=>this._release(n)}},c=>{throw o.abortController=null,c})}return o.referenceCount++,new Promise((a,l)=>{Lo(s,()=>{l(gi())}),o.textureAsync.then(a,l)}).catch(a=>{throw this._release(n),a})}_createTexture(t,i,r){const s=ge(L({},this._parameters),{powerOfTwoResizeMode:C0.PAD});if(bj(t)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new vs(i,s)}}class krt{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(zp.SYMBOLOGY),this.textures=new zrt(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:bt.CLAMP_TO_EDGE,t:bt.CLAMP_TO_EDGE}},t.resourceController.scheduler);const i=Ci(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=v0e(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=EHe(t.viewingMode,i)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return sh();this.graphicsOwners.push(t);const i=xe(()=>{var r;return(r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),sh(()=>{i.remove(),UN(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new Jt;const i=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([xe(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Qr),this.viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;Q3.distance=t.centerOnSurfaceInfrequent.distance,Q3.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(Q3),this.screenSizePerspectiveSettingsLabels.update(Q3),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const Q3={distance:0,fovY:0};class $y{constructor(t,i,r=""){this.graphics=t,this._symbol=new Ju({symbolLayers:[new Ic({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new rg({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(t,i){if(C(i))return;this.hide();const r=new We({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new ho({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){_(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let i0=class extends be{constructor(e){super(e),this.handles=new Jt}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],i0.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],i0.prototype,"surface",void 0),u([d({constructOnly:!0})],i0.prototype,"state",void 0),i0=u([P("esri.views.3d.support.PointOfInterest")],i0);const Brt=Array;let vc=class extends i0{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new sv({location:We,renderLocation:Brt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=M(),this.tmpPoint=new We}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(ma(()=>{var t,i;return(t=this.map)==null||(i=t.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Yi(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Rb(i,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{Tr(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(Vk,this._estimatedSurfaceAltitude,this._camera.eye),da(this._get("renderLocation"),Vk)||this._set("renderLocation",ne(this._propertiesPool.get("renderLocation"),Vk))}};u([d({constructOnly:!0})],vc.prototype,"scheduler",void 0),u([d({constructOnly:!0})],vc.prototype,"cache",void 0),u([d({constructOnly:!0})],vc.prototype,"task",void 0),u([d({constructOnly:!0})],vc.prototype,"cameraName",void 0),u([d({readOnly:!0})],vc.prototype,"location",null),u([d({constructOnly:!0})],vc.prototype,"map",void 0),u([d({readOnly:!0})],vc.prototype,"renderLocation",void 0),u([d({readOnly:!0})],vc.prototype,"scale",null),u([d({readOnly:!0})],vc.prototype,"updating",null),vc=u([P("esri.views.3d.support.CameraOnSurface")],vc);const Vk=M(),Vrt=Array;let Al=class extends i0{constructor(e){super(e),this._propertiesPool=new sv({location:We,renderLocation:Vrt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=M(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=mn(this._frameWorker),this._propertiesPool=ct(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=jrt;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=Hrt;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(ne(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Yi(this._camera.eye,e):(oe(e,this._camera.viewForward,this._get("distance")),fe(e,e,this._camera.eye)),da(this._get("renderLocation"),e)||this._set("renderLocation",ne(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=Ci(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=ua(i.eye),o=n<s*s,a=Yi(i.eye,t);if(o&&a>r/4){const l=s-Math.sqrt(n);return oe(t,i.viewForward,l),fe(t,t,i.eye),!0}}else{const r=this.surface.ready?this.surface.extent:null;_(r)&&vF(r,this.surface.spatialReference,jE,this.renderCoordsHelper.spatialReference)&&(t[0]=He(t[0],jE[0],jE[2]),t[1]=He(t[1],jE[1],jE[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Ni.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=Yi(i,e),s=Yi(i,t);if(Math.abs(s-r)/r>Grt)return!0}return!1}};u([d({constructOnly:!0})],Al.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Al.prototype,"task",void 0),u([d({constructOnly:!0})],Al.prototype,"cameraName",void 0),u([d()],Al.prototype,"distance",void 0),u([d({constructOnly:!0})],Al.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Al.prototype,"location",null),u([d({readOnly:!0})],Al.prototype,"renderLocation",void 0),u([d()],Al.prototype,"updating",void 0),Al=u([P("esri.views.3d.support.CenterOnSurface")],Al);const Grt=.05,jrt=M(),Hrt=M(),jE=Gt();class qrt{constructor(t){this.handles=new Jt,this.events=new qr,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this.handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Wrt)}}const Wrt={},Xrt=Array;let bp=class extends i0{constructor(e){super(e),this._propertiesPool=new sv({location:We,renderLocation:Xrt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([xe(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),xe(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(yt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,Xre);const s=Math.max(0,(Math.acos(Se(Xre,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!sS(e,t)){const l=this._propertiesPool.get("renderLocation");ne(l,t),this._set("renderLocation",l)}return}const n=1-He(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(Yre);const a=this._propertiesPool.get("renderLocation");Cs(a,t,Yre,o),e&&sS(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(no());if(i[1]=t.aboveGround?t.padding[Ot.BOTTOM]:t.fullHeight-t.padding[Ot.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,HE)){de(HE,HE,t.eye);const s=Te(HE,HE);if(this.renderCoordsHelper.intersectManifold(Xc(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],bp.prototype,"_dirty",void 0),u([d({constructOnly:!0})],bp.prototype,"scheduler",void 0),u([d({constructOnly:!0})],bp.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],bp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],bp.prototype,"updating",null),u([d({readOnly:!0})],bp.prototype,"location",null),u([d({readOnly:!0})],bp.prototype,"renderLocation",void 0),bp=u([P("esri.views.3d.support.CenterOnSurface")],bp);const Xre=M(),HE=M(),Yre=M();let pm=class extends be{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Jt}get renderLocation(){if(!this.location)return null;const e=M();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([xe(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),ma(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||C(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=uj(this.surfaceView.extent),t=new We({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{Tr(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",t)}};u([d({constructOnly:!0})],pm.prototype,"view",void 0),u([d({constructOnly:!0})],pm.prototype,"cache",void 0),u([d({readOnly:!0,aliasOf:"view.map.ground"})],pm.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain"})],pm.prototype,"surfaceView",void 0),u([d({readOnly:!0})],pm.prototype,"location",void 0),u([d({readOnly:!0})],pm.prototype,"renderLocation",null),pm=u([P("esri.views.3d.terrain.StableSurfaceCenter")],pm);let fm=class extends be{constructor(){super(...arguments),this.handles=new Jt,this._tileGeometryUpdateExtent=nh(),this._tileGeometryUpdateSpatialReference=null,this.events=new qr,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(yt.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=ct(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Yrt),nh(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,S0(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=Zrt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,Jv,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,Kv,t),Jv[0]<Kv[0]?(r[0]=Jv[0],r[2]=Kv[0]):(r[0]=Kv[0],r[2]=Jv[0]),Jv[1]<Kv[1]?(r[1]=Jv[1],r[3]=Kv[1]):(r[1]=Kv[1],r[3]=Jv[1]),nF(r,e)}};u([d({constructOnly:!0})],fm.prototype,"state",void 0),u([d({constructOnly:!0})],fm.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],fm.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],fm.prototype,"scheduler",void 0),u([d({constructOnly:!0})],fm.prototype,"surface",void 0),u([d({readOnly:!0})],fm.prototype,"updating",void 0),fm=u([P("esri.views.3d.support.SurfaceGeometryUpdates")],fm);const Yrt={},Jv=M(),Kv=M(),Zrt=nh();let Eo=class extends be{constructor(e){super(e),this._handles=new Jt,this._tmpRay=Ln(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new sv({renderPointOfView:Qrt},this),this.renderPointOfView=M(),this._pois=new Array,this._debugCenters=new Map}initialize(){var e;const{state:t,basemapTerrain:i,renderCoordsHelper:r,map:s}=this.view;this._surfaceIntersector=hh(t.viewingMode),t.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=zn.MIN,this._contentIntersector=hh(t.viewingMode);const n=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(e=this.view.basemapTerrain)==null?void 0:e.elevationQueryCache,l={state:t,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new Al(ge(L({},l),{task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n}))),this._set("centerOnSurfaceFrequent",new Al(ge(L({},l),{task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:n}))),this._set("contentCenterOnSurface",new Al(ge(L({},l),{task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:n,cameraName:"contentCamera"}))),this._set("centerOnContent",new Al(ge(L({},l),{task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new vc(ge(L({},l),{cache:a,task:yt.POINT_OF_INTEREST_INFREQUENT,map:s}))),this._set("contentCameraOnSurface",new vc(ge(L({},l),{cache:a,task:yt.POINT_OF_INTEREST_INFREQUENT,map:s,cameraName:"contentCamera"}))),this._set("surfaceGeometryUpdates",new fm(ge(L({},l),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new qrt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new pm({cache:a,view:this.view})),this._set("focus",new bp({state:t,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new $y(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new $y(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new $y(c,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new $y(c,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new $y(c,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new $y(c,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new $y(c,"green","Focus")),this._handles.add([xe(()=>t.camera,h=>this._cameraChanged(h),Qr),xe(()=>i.extent,()=>this._updateCenterPointsOfInterest()),Rd(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),Qr),ma(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),ma(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Rd(()=>Ni.SHOW_POI,h=>this._setDebug(h),Bi)]),this._cameraChanged(this.view.state.camera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!!((e=this.surfaceGeometryUpdates)!=null&&e.updating||this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return C(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Ww,Krt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ww):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(C(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=fe(Ww,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(Ww)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ww)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=tW(t,e,Jrt);if(C(r))return null;const s=r.origin,n=fe(Ww,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;da(this.renderPointOfView,t)||this._set("renderPointOfView",ne(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(xe(()=>t.renderLocation,i=>this._debugCenters.get(t).show(i,t.renderCoordsHelper.spatialReference),Bi),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],Eo.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],Eo.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],Eo.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],Eo.prototype,"contentCenterOnSurface",void 0),u([d({readOnly:!0})],Eo.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],Eo.prototype,"contentCameraOnSurface",void 0),u([d({readOnly:!0})],Eo.prototype,"focus",void 0),u([d({readOnly:!0})],Eo.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],Eo.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],Eo.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],Eo.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],Eo.prototype,"view",void 0),u([d({readOnly:!0})],Eo.prototype,"updating",null),Eo=u([P("esri.views.3d.support.PointsOfInterest")],Eo);const Qrt=Array,Ww=M(),Jrt=Ln(),Krt={exclude:new Set([c1])};class est{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,i){this.store.put(t,i,i.values.byteLength+256)}}const tst=pe.getLogger("esri.core.workers.WorkerHandle");class F1e{constructor(t,i,r,s={}){this._mainMethod=i,this._listeners=[],this._promise=Nce(t,ge(L({},s),{schedule:r})).then(n=>{if(this._thread===void 0){this._thread=n,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const o of this._listeners)this._connectListener(o)}else n.close()}),this._promise.catch(n=>tst.error(`Failed to initialize ${t} worker: ${n}`))}on(t,i){const r={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),sh(()=>{r.removed=!0,p7(this._listeners,r),this._thread&&_(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,i){return this.invokeMethod(this._mainMethod,t,i)}invokeMethod(t,i,r){if(this._thread){const s=this.getTransferList(i,t);return this._thread.invoke(t,i,{transferList:s,signal:r})}return this._promise?this._promise.then(()=>(qt(r),this.invokeMethod(t,i,r))):Promise.reject(null)}broadcast(t,i){return this._thread?Promise.all(this._thread.broadcast(i,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,i)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(i=>{t.removed||(t.threadHandle=i)})}}class Zre extends F1e{constructor(t=null){super("LercWorker","_decode",t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,r){return t&&t.byteLength!==0?this.invoke({buffer:t,options:i},r):Promise.resolve(null)}getTransferList(t){return[t.buffer]}release(){--this.ref<=0&&(sR.forEach((t,i)=>{t===this&&sR.delete(i)}),this.destroy())}}const sR=new Map;function U1e(e=null){let t=sR.get(e);return t||(_(e)?(t=new Zre(i=>e.schedule(i)),sR.set(e,t)):(t=new Zre,sR.set(null,t))),++t.ref,t}function Xm(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function z1e(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ist(e,t,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function rst(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Xm,clone:z1e,fromValues:ist,createView:rst},Symbol.toStringTag,{value:"Module"}));var Qre,Il,Jre,Kre,ese;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(Qre||(Qre={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(Il||(Il={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(Jre||(Jre={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(Kre||(Kre={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(ese||(ese={}));class sst{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class ogt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function agt(e,t,i,r,s,n){const o=i-s;if(o>=0)return(t>>o)+(r-(n<<o))*(e>>o);const a=-o;return t-(n-(r<<a))*(e>>a)<<a}class lgt{constructor(t,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,i,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function nst(e,t,i,r,s,n){const o=t[r++];for(let a=0;a<o;a++){const l=new sst(n);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];const c=t[r++];for(let f=0;f<c;f++){const g=t[r++],y=t[r++],v=t[r++],b=t[r++],w=!!t[r++],S=t[r++],x=i[r++],E=i[r++],R=t[r++],O=t[r++];l.colliders.push({xTile:g,yTile:y,dxPixels:v,dyPixels:b,hard:w,partIndex:S,width:R,height:O,minLod:x,maxLod:E})}const h=e[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([e[r++],e[r++]]);const p=e[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[r++],e[r++]]);s.push(l)}return r}function cgt(e,t,i){for(const[r,s]of e.symbols)ost(e,t,i,s,r)}function ost(e,t,i,r,s){const n=e.layerData.get(s);if(n.type===Il.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class c5{constructor(t,i){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let r=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return C(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){C(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class ast extends c5{constructor(t,i){super(t,i),this.type=Il.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){_(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),_(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),_(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=si.createVertex(t,mi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=si.createIndex(t,mi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new Os(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class lst extends c5{constructor(t,i){super(t,i),this.type=Il.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){_(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),_(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),_(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,_(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),_(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),_(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=si.createVertex(t,mi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=si.createIndex(t,mi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=si.createVertex(t,mi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=si.createIndex(t,mi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new Os(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new Os(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class cst extends c5{constructor(t,i,r){super(t,i),this.type=Il.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const g=s[a++],y=s[a++],v=s[a++];this.iconPerPageElementsMap.set(g,[y,v])}const c=s[a++];for(let f=0;f<c;f++){const g=s[a++],y=s[a++],v=s[a++];this.glyphPerPageElementsMap.set(g,[y,v])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=nst(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[i,r]of this.iconPerPageElementsMap)t+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3}doDestroy(){_(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),_(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),_(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),_(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,_(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),_(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),_(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),_(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,i=this.iconOpacityBuffer;t.length>0&&t.byteLength===i.size&&i.setSubData(t);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r)}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=si.createVertex(t,mi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=si.createIndex(t,mi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=si.createVertex(t,mi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=si.createIndex(t,mi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=si.createVertex(t,mi.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=si.createVertex(t,mi.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new Os(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new Os(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class ust extends c5{constructor(t,i){super(t,i),this.type=Il.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){_(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),_(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),_(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=si.createVertex(t,mi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=si.createIndex(t,mi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new Os(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const ugt=!0,hgt=32,tse=200,hst=1/ue("mapview-transitions-duration");class dst extends qr{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const i=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return C(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Qm(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Qm(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*hst;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class $p{constructor(t,i,r,s){this.set(t,i,r,s)}static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new $p(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new $p(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new $p(t,i,r,s),new $p(t,i,r+1,s),new $p(t,i+1,r,s),new $p(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}$p.pool=new as($p,null,null,25,50);class pst extends dst{constructor(t,i,r,s,n,o=s,a=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new $p(t),this.x=i,this.y=r,this.width=s,this.height=n,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,i){const r=i/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[n,o]=t.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*r,l=this.height/this.rangeY*r;Cq(s,a,0,0,0,l,0,n,o,1),r4(this.transforms.dvs,t.displayViewMat3,s)}}class CN extends pst{constructor(t,i,r,s,n,o,a=null){super(t,i,r,s,n,4096,4096),this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=o,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<tse}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<tse)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let i=!1;for(const r of t)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Il.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(k1e.delete(this),CN._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let i=!1;if(t){const{bucketsWithData:r,emptyBuckets:s}=t,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===Il.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===Il.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,i){super.setTransform(t,i);const r=i/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*r,n=this.height/this.rangeY*r,o=[0,0];t.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;Rq(a),NL(a,a,o),Oq(a,a,Math.PI*t.rotation/180),Mq(a,a,[s,n,1])}_createTransforms(){return{dvs:Xm(),tileMat3:Xm(),tileUnitsToPixels:Xm()}}static _destroyRenderBuckets(t){if(!t)return;const i=new Set;t.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),t.clear()}_createRenderBuckets(t){const i=new Map,r=new Map;for(const s of t){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(t,i){let r=i.get(t);if(r)return r;switch(new Uint32Array(t)[0]){case Il.FILL:r=new lst(t,this.styleRepository);break;case Il.LINE:r=new ast(t,this.styleRepository);break;case Il.SYMBOL:r=new cst(t,this.styleRepository,this);break;case Il.CIRCLE:r=new ust(t,this.styleRepository)}return i.set(t,r),r}_deleteLayerData(t){if(!this.layerData.has(t))return;const i=this.layerData.get(t);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(t),this.layerCount--}}const k1e=new Map;function fst(){k1e.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(i=>console.log(i)),console.log("========"),e[1].forEach(i=>console.log(i))})}const mst=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(i){super.postscript(i),Xme(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const i=new AbortController,r=i.signal;this.handles.add(sh(()=>i.abort())),await ab(()=>{var n;return(n=this.view.defaultsFromMap)==null?void 0:n.heightModelInfoReady},r),qt(r);const s=A6e(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(s)throw s}canResume(){const i=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return super.canResume()&&(!i||!i.minScale||!i.maxScale||i.minScale>=i.maxScale)}getSuspendInfo(){const i=super.getSuspendInfo(),r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return r&&r.minScale&&r.maxScale&&r.minScale<r.maxScale&&(i.outsideScaleRange=!0),i}};return u([d()],t.prototype,"view",void 0),u([d()],t.prototype,"slicePlaneEnabled",void 0),t=u([P("esri.views.3d.layers.LayerView3D")],t),t},gst={value:.5,readOnly:!0},B1e={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}},yst=e=>{let t=class extends e{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataLevelRange(){const i=this.tileInfo.lods,r=i[0].scale,s=i[i.length-1].scale;return this.levelRangeFromScaleRange(r,s)}get displayLevelRange(){const i=this.tileInfo.lods,r=this.layer.minScale||i[0].scale,s=this.layer.maxScale||i[i.length-1].scale,n=this.levelRangeFromScaleRange(r,s);return this.layer.maxScale&&n.maxLevel++,n}getTileUrl(i,r,s){return this.layer.getTileUrl(i,r,s)}_addTilingSchemeMatchPromise(){if(C(this.fullExtent))return this.addResolvingPromise(Promise.reject(new Y("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const i=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(_(i))return this.addResolvingPromise(Promise.reject(i));const r=ab(()=>{var s,n;return(s=this.view)==null||(n=s.basemapTerrain)==null?void 0:n.tilingSchemeLocked}).then(()=>{const s=this.view.basemapTerrain.tilingScheme,n=this._getTileInfoCompatibilityError(this.tileInfo,s);if(n)throw n});this.addResolvingPromise(r)}_getTileInfoSupportError(i,r){const s=a5(i,r,this.view.spatialReference,this.view.state.viewingMode);if(s){const n={layer:this.layer,error:s};let o;switch(s.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":o=new Y("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",n);break;default:o=new Y("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",n)}return o}return null}_getTileInfoCompatibilityError(i,r){return r.compatibleWith(i)?null:new Y("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(i,r){const s={minLevel:0,maxLevel:1/0},n=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!n)return s;const o=n.levels[0],a=l=>{const c=Math.log(o.scale/l)/Math.LN2;return .5-Math.abs(.5-c%1)<1e-9?Math.round(c):Math.ceil(c)};return i!=null&&i>0&&(s.minLevel=Math.max(0,a(i))),r!=null&&r>0&&(s.maxLevel=Math.max(0,a(r))),s}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return u([d({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),u([d({readOnly:!0})],t.prototype,"updating",void 0),u([d(B1e)],t.prototype,"updatingProgress",void 0),u([d(gst)],t.prototype,"updatingProgressValue",void 0),u([d()],t.prototype,"fullExtent",null),u([d({readOnly:!0})],t.prototype,"isOpaque",null),u([d({readOnly:!0})],t.prototype,"dataLevelRange",null),u([d({readOnly:!0})],t.prototype,"displayLevelRange",null),u([d()],t.prototype,"layer",void 0),u([d()],t.prototype,"tileInfo",void 0),t=u([P("esri.views.3d.layers.TiledLayerView3D")],t),t};let mc=class extends Fd(KN(v2(qr.EventedMixin(be)))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if(e.name!=="layerview:create-error"){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";throw pe.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e),e}})}get fullOpacity(){return Tt(this.get("layer.opacity"),1)*Tt(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&this.layer.legendEnabled===!0}get updating(){var e;return!!((e=this.updatingHandles)!=null&&e.updating||this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){var e;return((e=this.layer)==null?void 0:e.visible)===!0}set visible(e){e!==void 0?this._override("visible",e):this._clearOverride("visible")}canResume(){var e,t,i;return this.visible&&((e=this.layer)==null?void 0:e.loaded)&&!((t=this.parent)!=null&&t.suspended)&&((i=this.view)==null?void 0:i.ready)||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{},t=this;return t.view&&t.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};u([d()],mc.prototype,"fullOpacity",null),u([d()],mc.prototype,"layer",void 0),u([d()],mc.prototype,"parent",void 0),u([d({readOnly:!0})],mc.prototype,"suspended",null),u([d({readOnly:!0})],mc.prototype,"suspendInfo",null),u([d({readOnly:!0})],mc.prototype,"legendEnabled",null),u([d({type:Boolean,readOnly:!0})],mc.prototype,"updating",null),u([d({readOnly:!0})],mc.prototype,"updatingProgress",null),u([d()],mc.prototype,"visible",null),u([d()],mc.prototype,"view",void 0),mc=u([P("esri.views.layers.LayerView")],mc);const vst=mc;let pC=class extends yst(mst(vst)){constructor(){super(...arguments),this.type="elevation-3d"}initialize(){var e,t,i,r,s;const n=(e=this.view)==null||(t=e.map)==null?void 0:t.allLayers,o=n&&n.includes(this.layer),a=(i=this.view)==null||(r=i.map)==null||(s=r.ground)==null?void 0:s.layers,l=a&&a.includes(this.layer);if(o&&!l){const c=new Y("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground");this.addResolvingPromise(Promise.reject(c))}this._addTilingSchemeMatchPromise()}};u([d()],pC.prototype,"layer",void 0),u([d({readOnly:!0,aliasOf:"layer.tileInfo"})],pC.prototype,"tileInfo",void 0),pC=u([P("esri.views.3d.layers.ElevationLayerView3D")],pC);const V1e=pC;var _st=Object.freeze(Object.defineProperty({__proto__:null,default:V1e},Symbol.toStringTag,{value:"Module"}));class nX{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class bst{constructor(t,i,r){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i;const s=r.noDataValue,n=r.values;let o=1/0,a=-1/0,l=!0,c=!1;for(let h=0;h<n.length;h++){const p=n[h];p!==s?(o=p<o?p:o,a=p>a?p:a,l=!1):c=!0}l&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:s,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(i[2]-i[0]),dy:(r.width-1)/(i[3]-i[1]),x0:i[0],y1:i[3]},this.bounds=[o,a],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.width,h=this.samplerData.pixelData,p=.5*FR;let f=(c-1)/o,g=(r-this.j*o)*f,y=(i-this.i*o)*f;if(f<1){const v=Math.floor(g),b=Math.floor(y),w=v+b*c,S=h[w],x=h[w+1],E=h[w+c],R=h[w+c+1];if(S+x+E+R<p){const O=g-v,I=y-b,U=OP(S,x,E,R,O,I),N=OP(S,x,E,R,O+f,I),V=OP(S,x,E,R,O,I+f),j=OP(S,x,E,R,O+f,I+f);return s.min=Math.min(U,N,V,j),s.max=Math.max(U,N,V,j),s}g=v,y=b,f=1}else g=Math.floor(g),y=Math.floor(y),f=Math.ceil(f);for(let v=g;v<=g+f;v++)for(let b=y;b<=y+f;b++){const w=h[v+b*c];w<p?(a=Math.min(a,w),l=Math.max(l,w)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}function G1e(e,t,i){if(C(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=He(r.dy*(r.y1-t),0,s),o=He(r.dx*(e-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.width,h=a*c+l,p=r.pixelData,f=p[h],g=p[h+1],y=h+c,v=p[y],b=p[y+1];if(f+v+g+b<.5*FR){n-=a,o-=l;const w=f+(g-f)*o;return w+(v+(b-v)*o-w)*n}}return null}function Yu(e,t,i){const r=G1e(e,t,i);return _(r)?r:0}let Ou=class extends be{constructor(e){super(e),this._handles=new Jt}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const r=j1e(i.fullExtent,this.viewSpatialReference);_(r)&&e.push(Mle(r))}}),e}};function wst(e,t){return e===je.Global?new VG(t):new GG(t)}u([d({readOnly:!0})],Ou.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],Ou.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],Ou.prototype,"stencilEnabledExtents",null),u([d()],Ou.prototype,"viewSpatialReference",void 0),u([d()],Ou.prototype,"tilingScheme",void 0),u([d()],Ou.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],Ou.prototype,"layers",void 0),u([d({constructOnly:!0})],Ou.prototype,"layerViews",void 0),Ou=u([P("esri.views.3d.terrain.ExtentHelper")],Ou);let VG=class extends Ou{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?$me:Dke}};VG=u([P("esri.views.3d.terrain.ExtentHelperGlobal")],VG);let GG=class extends Ou{_computeLayerViewsExtent(){const e=nh(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=j1e("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);S0(e,o,e)}});const i=IB(e)?e:null,r=this._get("layerViewsExtent");return I1(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=nh();this.layers.forEach(n=>{if(n.loaded&&NC(n)){const o=l5(n,t,je.Local);if(C(o))return;const{tileInfo:a,fullExtent:l}=o;_(a)&&_(l)&&(EN(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&S0(i,l,i)}}),S0(i,this.defaultTiledLayersExtent,i);const r=IB(i)?i:null,s=this._get("tiledLayersExtent");return I1(r,s)?s:r}};function j1e(e,t){return _(e)&&!e.spatialReference.equals(t)?hue(e,e.spatialReference,t):e}GG=u([P("esri.views.3d.terrain.ExtentHelperLocal")],GG);var Ht;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(Ht||(Ht={}));const j_=[Ht.ELEVATION,Ht.MAP];function H1e(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.search(".glsl")!==-1&&delete t[r]}}const xst=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Jg,Da=class extends be{constructor(e){super(e),this._handles=new Jt,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ue("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Ni.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return _(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Ci(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new qh({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=hh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this._setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var i;return(i=e._stage)==null?void 0:i.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this._setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this._setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateDrapeTargets()),xe(()=>{var t,i,r;return[(t=e.pointsOfInterest)==null?void 0:t.renderPointOfView,(i=e.pointsOfInterest)==null||(r=i.centerOnSurfaceFrequent)==null?void 0:r.location]},()=>this.setPlacementDirty()),xe(()=>{var t;return(t=e.state)==null?void 0:t.pixelRatio},()=>this.setPlacementDirty(),Qr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),Y1({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,bs.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(yt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,bs.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,bs.BACKGROUND,t)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),_(Jg)&&(Jg.hide(),Jg=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;_(e)&&_(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new L0(-20037508342787e-6,20037508342787e-6):new L0(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Cp)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&_(e.setDrapingExtent)&&_(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this._updateDrapeTarget(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateDrapeTargets(){this._drapeTargets.forEach(e=>this._updateDrapeTarget(e))}_updateDrapeTarget(e){e.setDrapingTextures(this.renderer.overlays)}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this._setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,bs.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const i=GXe(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,kf);const r=Lp(kf.inner)/Lp(kf.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(gs.INNER,kf.inner,i,1*kf.pixelRatioAdjustment,kf.mapUnitsPerPixel),n=this._updateOverlay(gs.OUTER,kf.outer,i,r*kf.pixelRatioAdjustment,kf.mapUnitsPerPixel);s!==Op.EXTENT&&n!==Op.EXTENT||(this._drapeSources.forEach(o=>this._updateDrapeSourceExtent(o)),this.surface.updateTileOverlayParams(t)),s===Op.NONE&&n===Op.NONE||this._setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return Op.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,Tst(t,n.extent)&&i===n.resolution)return o===s?Op.NONE:Op.RERENDER_ONLY;ig(n.extent,t),n.resolution=i;const a=uj(n.extent);return n.renderLocalOrigin=KC(a[0],a[1],0,"OV_"+this._latestOriginId++),Op.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[gs.INNER],r=this.renderer.overlays[gs.OUTER],s=GI(e.extent,this.surface.extent,ise);this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,gs.INNER,t),this._setTileOverlayData(s,gs.OUTER,t)):(this._clearTileOverlayData(gs.INNER,t),this._clearTileOverlayData(gs.OUTER,t))}else this._clearTileOverlayData(gs.INNER,t),this._clearTileOverlayData(gs.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[gs.INNER],i=this.renderer.overlays[gs.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;const r=this.renderer.overlays[t].extent,s=Lp(r),n=F0(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,Lp(e)/s,F0(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){H1e(),await this.renderer.reloadShaders(),this._setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||_(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}_setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Est,t,i);if(C(s))return!1;const n=s.origin,o=fe(J3,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=He(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=J3;x2(Ci(this.view.spatialReference).radius+a,Xc(e.eye,e.viewForward),c),de(c,c,e.eye);const h=N0.normalize(COe(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:r;i=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=ri(0,h,1,0),f=Lc(p,p,e.projectionMatrix)[1],g=He(.5+.5*f,0,1);i=g===1||g===0?.5:l?g*r:1-(1-g)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&$7(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=M();this._findHorizonBasedPointOfInterest(e,s)||ne(s,r);const n=Math.max(.1,Yi(e.eye,s)),o=Z0(this.view.renderCoordsHelper,r,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);Ni.OVERLAY_SHOW_CENTER?(C(Jg)&&(Jg=new $y(this.view.graphics,"red")),Jg.show(s,this._renderSR)):_(Jg)&&Jg.hide(),this._overlaySREqualsRenderSR||kn(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&_(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&_(this._spatialReference)?1/Ci(this._spatialReference).metersPerDegree:1,p=e.perRenderPixelRatio*n*h;i.mapUnitsPerPixel=p/this._worldToPCSRatio;let f=t*p/2,g=!1,y=c?90:1/0;this._isSpherical&&_(l)&&_(this._spatialReference)&&(this._spatialReference.isWebMercator?(f/=Math.cos(DD(s[1])),y=l[3]):(g=!0,f/=Ci(this._spatialReference).metersPerDegree,y=90),f>=y&&(f=y,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;g&&(v=1/Math.max(.2,Math.cos(Math.abs($t(s[1])))),f*v>180&&(v=180/f),i.mapUnitsPerPixel*=v);const b=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/b)*b);const w=f*v,S=32,x=.5*t/(S*w),E=.5*t/(S*f);s[0]=Math.round(s[0]*x)/x,s[1]=Math.round(s[1]*E)/E;const R=i.inner;R[0]=s[0]-w,R[1]=s[1]-f,R[2]=s[0]+w,R[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(R,1/0,y);const O=i.outer;if(6*w>Lp(l))ig(O,l);else if(a<=.25*Math.PI)O[0]=R[0]-w,O[1]=R[1]-f,O[2]=R[2]+w,O[3]=R[3]+f;else{kn(e.eye,this._renderSR,J3,this._spatialReference),Up(e_,s,J3);let U=-Math.atan2(e_[1],e_[0])+.125*Math.PI;U<0&&(U+=2*Math.PI);const N=Math.floor(U/(.25*Math.PI));DO(e_,xst[N],2*f),e_[0]*=v,e_[2]*=v,L7(O,R,e_)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-y),O[3]=Math.min(O[3],y);else{const U=GI(R,l,ise),N=GI(O,l,Sst);SY(U,N)&&(O[2]=O[0],O[3]=O[1])}const I=Math.abs(R[2]-R[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,I),i.pixelRatioAdjustment=i.mapUnitsPerPixel/I}_drawOverlayTextures(e,t,i=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[gs.INNER],i),n=this._drawOverlay(e[gs.OUTER],i);s!==US.CHANGED&&n!==US.CHANGED||this.surface.updateTileOverlayParams(bs.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateDrapeTargets(),r?(this.surface.requestRender(t),t===bs.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(bs.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!C(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):nF(e,t))}_rectInsideRect(e,t){return!C(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:SY(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),zD(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function Tst(e,t){const r=Ni.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}u([d()],Da.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],Da.prototype,"running",null),u([d()],Da.prototype,"_placementDirty",void 0),u([d()],Da.prototype,"_contentUpdated",void 0),u([d()],Da.prototype,"_isSpherical",null),u([d()],Da.prototype,"_worldToPCSRatio",null),u([d()],Da.prototype,"renderer",void 0),u([d({constructOnly:!0})],Da.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"surface.suspended"})],Da.prototype,"suspended",void 0),u([d({readOnly:!0})],Da.prototype,"updating",null),u([d({type:Boolean})],Da.prototype,"hasHighlights",null),u([d({type:Boolean})],Da.prototype,"rendersOccluded",null),Da=u([P("esri.views.3d.terrain.OverlayManager")],Da);const e_=ii(),J3=M(),kf={inner:Gt(),outer:Gt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},ise=Gt(),Sst=Gt(),Est=Ln();var Op;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(Op||(Op={}));class Ast{constructor(){this.edges=[null,null,null,null],this.cornerElevations=[0,0,0,0],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class Cst{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new Ast}}function Rst(e){return e===nt.NORTH_EAST?nt.SOUTH_WEST:e===nt.NORTH_WEST?nt.SOUTH_EAST:e===nt.SOUTH_WEST?nt.NORTH_EAST:nt.NORTH_WEST}function Ost(e){return e===nt.NORTH?nt.SOUTH:e===nt.EAST?nt.WEST:e===nt.SOUTH?nt.NORTH:nt.EAST}const jG=[nt.NORTH,nt.EAST,nt.SOUTH,nt.WEST],rse=[nt.NORTH_EAST,nt.SOUTH_EAST,nt.SOUTH_WEST,nt.NORTH_WEST];class wO{constructor(t,i){this._factoryCallback=t,this._lengthCallback=i,this._pool=new Map}acquire(t){if(!wO.test.disabled){const i=this._pool.get(t);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(t)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+i+s),i}}release(t){if(wO.test.disabled)return;const i=this._lengthCallback(t);let r=this._pool.get(i);r||(r=new Vt({shrink:!0}),this._pool.set(i,r)),r.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}wO.test={disabled:!1};class Mst{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=ir(),this.numSurfaceIndices=0,this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=ii(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class oX{constructor(t,i,r,s,n){this._buf=t,this._localOrigin=i,this.offset0=r,this.stride=s,this.count=n}getVertexOffset(t){return 0<=t&&t<this.count,this.offset0+this.stride*t}getVertex(t){const i=this.getVertexOffset(t)*V1;return Le(this._buf[i+0]+this._localOrigin[0],this._buf[i+1]+this._localOrigin[1],this._buf[i+2]+this._localOrigin[2])}setVertex(t,i){const r=this.getVertexOffset(t)*V1;for(let s=0;s<3;++s)this._buf[r+s]=i[s]-this._localOrigin[s]}getValue(t){const i=t*(this.count-1);0<=i&&i<=this.count-1;const r=Math.floor(i),s=Math.ceil(i),n=i-r,o=this.getVertex(r),a=this.getVertex(s),l=M();return Cs(l,o,a,n)}}const Pst=ls().vec3f(A.POSITION).vec2f(A.UV0),aX=new wO(e=>Pst.createBuffer(e),e=>e.count);function Ist(){aX.clear()}function q1e(e){return aX.acquire(e)}function $st(e){aX.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}class qT{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=ct(this._current),this._next=ct(this._next),this._waiting=ct(this._waiting),this._delayed=ct(this._delayed)}get current(){if(C(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=qT.test.fadeMoment;if(_(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,Ym.Immediate),this._delayed=null)),_(this._next)){t=t||performance.now();const i=this._fadeDuration,r=_(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==Fn.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(ct(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(C(this._next))return 1;const t=qT.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return _(this._next)||_(this._delayed)}push(t,i=Ym.Immediate){this._delayed=ct(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),C(this._current))return void(this._current=t);const r=qT.test.fadeMoment||performance.now();return i!==Ym.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):C(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(C(t)||(ct(this._waiting),this._waiting=t))}get _fadeDuration(){return C(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}}var Ym;qT.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(Ym||(Ym={}));class W1e{constructor(){this._queue=new Vt,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),_(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class Dst{constructor(){this.q=new Vt}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!C(t)){this.q.pushArray(t);for(let i=0;i<this.q.length;++i){const r=this.q.data[i];r.isLeaf||this.q.pushArray(r.children)}}}next(){return this.q.pop()}}function nR(e,t,i){if(C(t)||C(t.fullExtent))return!1;const r=t.fullExtent,s=e.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function X1e(e,t){t.sort((i,r)=>Y1e(i,r,e))}function Y1e(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:0}function Lst(e,t){const i=new Map;e.forAll(r=>i.set(r.lij,r.distanceToSquared(t))),e.sort((r,s)=>i.get(r.lij)-i.get(s.lij))}function Nst(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function Fst(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i&&n.loadable)return!0}}return!1}function dgt(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}class lX{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,Fn.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return _(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),s=BG(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?nR:()=>!0;let h=this.tile;const p=h.level;let f;const g=this._tileLayerInfo.upsampleInfo,y=g?g.tile.level:-1,v=Bs(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const b=h.level,w=p-b,S=h.layerInfo[i][t];if(S.data&&w>=a){b>y&&this._setUpsampleTile(h),S.dataInvalidated&&(f=h);break}if((C(v)||v.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&b<=o&&!S.data&&!S.dataMissing&&((C(f)||h.level===n||b%Ime==0||p-f.level<a)&&(f=h),w>=l))break;h=h.parent}return _(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,Fn.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class Ust extends lX{get _desiredMinLevelDelta(){throw sse}get _progressiveLevelModulo(){throw sse}dispose(){}}const sse=new Error("Abstract method called on TileAgent"),fl=new Ust;class Z1e extends lX{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return R$(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class Q1e extends lX{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Ime}}var W1,Nb;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(W1||(W1={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(Nb||(Nb={}));function zst(e){e.attributes.add(A.POSITION,"vec2"),e.attributes.add(A.UV0,"vec2"),e.vertex.uniforms.add(new ye("u_scale")),e.vertex.uniforms.add(new Ft("u_offset")),e.varyings.add("v_texcoord","vec2"),e.vertex.code.add(T`void main(void) {
v_texcoord = uv0 * u_scale + u_offset;
gl_Position = vec4(position, 0.0, 1.0);
}`)}function kst(e){e.fragment.uniforms.add([new et("u_colormap"),new ye("u_colormapOffset",F.Pass,t=>t.colormap.u_colormapOffset),new ye("u_colormapMaxIndex",F.Pass,t=>t.colormap.u_colormapMaxIndex),new ye("u_opacity",F.Pass,t=>t.common.u_opacity)]),e.fragment.code.add(T`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
vec4 color = texture2D(u_colormap, clrPosition);
result = vec4(color.rgb, 1.0) * color.a * u_opacity;
}
return result;
}`)}function Bst(e){e.fragment.uniforms.add(new et("u_transformGrid")),e.fragment.uniforms.add(new Ft("u_transformSpacing")),e.fragment.uniforms.add(new Ft("u_transformGridSize")),e.fragment.uniforms.add(new Ft("u_targetImageSize")),e.fragment.code.add(T`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}class Vst extends qs{constructor(t){super(),this.common=t}}function Gst(e){e.include(Bst),e.fragment.uniforms.add([new et("u_image"),new _b("u_flipY",F.Pass,t=>t.common.u_flipY),new _b("u_applyTransform",F.Pass,t=>t.common.u_applyTransform)]),e.fragment.code.add(T`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}class u5 extends Vst{constructor(t,i,r,s){super(i),this.basic=t,this.colormap=r,this.symbolizer=s}}class jst extends u5{}class Hst extends u5{}function qst(e){const t=new Fi;return t.include(zst),t.include(Gst),t.include(kst),e.colorizerType===W1.Stretch?Xst(t,e):e.colorizerType===W1.Lut?Wst(t):e.colorizerType===W1.Hillshade&&Yst(t,e),t}function Wst(e){e.fragment.code.add(T`void main() {
vec2 pixelLocation = getPixelLocation(v_texcoord);
if (isOutside(pixelLocation)) {
gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = colormap(currentPixel, true);
}`)}function Xst(e,t){e.fragment.uniforms.add([new z2("u_bandCount",F.Pass,r=>r.symbolizer.u_bandCount),new Po("u_minCutOff",F.Pass,r=>r.symbolizer.u_minCutOff,3),new Po("u_maxCutOff",F.Pass,r=>r.symbolizer.u_maxCutOff,3),new Po("u_factor",F.Pass,r=>r.symbolizer.u_factor,3),new ye("u_minOutput",F.Pass,r=>r.symbolizer.u_minOutput),new ye("u_maxOutput",F.Pass,r=>r.symbolizer.u_maxOutput),new _b("u_useGamma",F.Pass,r=>r.symbolizer.u_useGamma),new Po("u_gamma",F.Pass,r=>r.symbolizer.u_gamma,3),new Po("u_gammaCorrection",F.Pass,r=>r.symbolizer.u_gammaCorrection,3),new ye("u_opacity",F.Pass,r=>r.common.u_opacity)]),e.fragment.code.add(T`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?T`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:T`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`;e.fragment.code.add(T`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===Nb.Noop?T`
        gl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;`:T`
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }`}
      }`)}function Yst(e,t){const i=e.fragment;i.uniforms.add([new z2("u_hillshadeType",F.Pass,s=>s.symbolizer.u_hillshadeType),new Po("u_sinZcosAs",F.Pass,s=>s.symbolizer.u_sinZcosAs,6),new Po("u_sinZsinAs",F.Pass,s=>s.symbolizer.u_sinZsinAs,6),new Po("u_cosZs",F.Pass,s=>s.symbolizer.u_cosZs,6),new Po("u_weights",F.Pass,s=>s.symbolizer.u_weights,6),new Ft("u_factor",F.Pass,s=>s.symbolizer.u_factor),new ye("u_minValue",F.Pass,s=>s.symbolizer.u_minValue),new ye("u_maxValue",F.Pass,s=>s.symbolizer.u_maxValue),new Ft("u_srcImageSize",F.Pass,s=>s.common.u_srcImageSize)]),i.include(wf),i.code.add(T`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(rgb.xyz);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),i.code.add(T`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?T`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:T`hillshade *= alpha;
gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);`;i.code.add(T`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Zst=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:u5,ColorizerStretchUniforms:jst,ColorizerHillshadeUniforms:Hst,build:qst},Symbol.toStringTag,{value:"Module"}));function Qst(e,t,i="nearest",r=!1){var s;const n=!(r&&t.pixelType==="u8"),o=n?Ct.FLOAT:Ct.UNSIGNED_BYTE,a=t.pixels==null||t.pixels.length===0?null:n?t.getAsRGBAFloat():t.getAsRGBA(),l=(s=e.capabilities.textureFloat)==null?void 0:s.textureFloatLinear,c={width:t.width,height:t.height,target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===xi.WEBGL2&&n?mt.RGBA32F:ze.RGBA,samplingMode:!l||i!=="bilinear"&&i!=="cubic"?Je.NEAREST:Je.LINEAR,dataType:o,wrapMode:bt.CLAMP_TO_EDGE,flipped:!1};return new ot(e,c,a)}function Jst(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=t,a=i[0]>1,l={width:a?4*n:n,height:o,target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===xi.WEBGL2?mt.RGBA32F:ze.RGBA,dataType:Ct.FLOAT,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),g=2*(p*o+h);c[f]=r[g],c[f+1]=r[g+1],c[f+3]=r[g]===-1?0:1}return new ot(e,l,c)}function nse(e,t){const i={width:t.length/4,height:1,target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,flipped:!1};return new ot(e,i,t)}function Kst(e,t,i,r=1,s=!0,n=!1){return{u_flipY:s,u_isFloatTexture:n,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:null,u_transformGridSize:e?e.size:null,u_targetImageSize:t,u_srcImageSize:i}}function ent(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:null}}function tnt(e,t){return{u_scale:e,u_offset:t}}function int(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function rnt(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}function snt(e,t){const i=e.gl,r=t.glName,s=i.getProgramParameter(r,i.ACTIVE_UNIFORMS),n=new Map;let o;for(let a=0;a<s;a++)o=i.getActiveUniform(r,a),o&&n.set(o.name,{location:i.getUniformLocation(r,o.name),info:o});return n}function ose(e,t,i){Object.keys(i).forEach(r=>{const s=t.get(r)||t.get(r+"[0]");s&&nnt(e,r,i[r],s)})}function nnt(e,t,i,r){if(r===null||i==null)return!1;const{info:s}=r;switch(s.type){case ia.FLOAT:s.size>1?e.setUniform1fv(t,i):e.setUniform1f(t,i);break;case ia.FLOAT_VEC2:e.setUniform2fv(t,i);break;case ia.FLOAT_VEC3:e.setUniform3fv(t,i);break;case ia.FLOAT_VEC4:e.setUniform4fv(t,i);break;case ia.FLOAT_MAT3:e.setUniformMatrix3fv(t,i);break;case ia.FLOAT_MAT4:e.setUniformMatrix4fv(t,i);break;case ia.INT:s.size>1?e.setUniform1iv(t,i):e.setUniform1i(t,i);break;case ia.BOOL:e.setUniform1i(t,i?1:0);break;case ia.INT_VEC2:case ia.BOOL_VEC2:e.setUniform2iv(t,i);break;case ia.INT_VEC3:case ia.BOOL_VEC3:e.setUniform3iv(t,i);break;case ia.INT_VEC4:case ia.BOOL_VEC4:e.setUniform4iv(t,i);break;default:return!1}return!0}const ase={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class lse{constructor(t,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.scale=1,this.offset=[0,0],this.opacity=1,this.lij=t,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=it(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?ge(L({},ase),{maxCutOff:[1,1,1],factor:[1,1,1]}):this._symbolizerParameters||ase}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){_(t)&&t.length>0?this._bandIds&&t.every((i,r)=>!!this._bandIds[r]&&i===this._bandIds[r])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,_(this._rasterTexture)){const i=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(i==="bilinear"?Je.LINEAR:Je.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=it(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((C(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),_(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&C(this._transformGridTexture)&&(this._transformGridTexture=Jst(t,this.transformGrid))),!0)}getUniforms(){const t=tnt(this.scale,this.offset),{symbolizerParameters:i,transformGrid:r,width:s,height:n,opacity:o}=this,a=Kst(r,[s,n],[this.source.width,this.source.height],o),l=ent(i.colormap,i.colormapOffset),c=this.symbolizerParameters.type==="stretch"?int(this.symbolizerParameters):null,h=this.symbolizerParameters.type==="hillshade"?rnt(this.symbolizerParameters):null;return new u5(t,a,l,c||h)}bindRasterTextures(t){t.bindTexture("u_image",this._rasterTexture),t.bindTexture("u_transformGrid",this._transformGridTexture),t.bindTexture("u_colormap",this._colormapTexture)}get memoryUsage(){if(C(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(i=>_(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=it(this._rasterTexture),this._transformGridTexture=it(this._transformGridTexture),this._colormapTexture=it(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=it(this._rasterTexture));const s=C(i)&&C(this.bandIds)||_(i)&&_(this.bandIds)&&i.join("")===this.bandIds.join("");if(_(this._rasterTexture)&&s)return;this._rasterTexture=it(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Qst(t,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=it(this._colormapTexture),this._colormapTexture=nse(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=nse(t,r),void(this._colormap=r)):(this._colormapTexture=it(this._colormapTexture),void(this._colormap=null))}}class sD{constructor(){this.waitingAgents=new Vt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const i=Gk.acquire();return i._init(t),i}release(){this.dispose(),nD.delete(this),Gk.release(this)}dispose(){this.loadingAgent=it(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=HT(this._data)}static prune(){Gk.prune(0)}_init(t){this.waitingAgents.clear(),this._data=HT(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=rh(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t===i||C(i))this._unsetUpsampleInfo();else{if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),Nst(t,i,this._upsampleInfo)}}get data(){return this._data}set data(t){HT(this._data),this._data=t}}const Gk=new as(sD,null,()=>{}),nD=new Map;function ont(){nD.size>0&&(console.log(`${nD.size} live TilePerLayerInfo allocations:`),nD.forEach(e=>console.log(e,`
`)))}class Yy{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var Et;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(Et||(Et={}));const jk=M(),Xw=M(),bn=M(),ant=.1;class lnt{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class cX{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=Gt(),this._elevationBounds=lt(),this.layerInfo=[[],[]],this.extentInRadians=Gt(),this.centerAtSeaLevel=M(),this._center=[M(),Vn(),M()],this.up=M7(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=qE,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){uX.prune(0),hX.prune(0),sD.prune()}get usedMemory(){return this._usedMemory===qE&&this._updateMemoryUsed(),this._usedMemory+(this.isCached?0:this.mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){this._usedMemory===qE&&this._updateMemoryUsed();let t=this._mapTileMemory;for(const{data:i}of this.layerInfo[Ht.MAP])i instanceof CN&&(t+=i.memoryUsage);return t}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[sa.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===e2.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,i,r){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=Ci(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[sa.MIDDLE][3]=0,this.vlevel=t?t[0]:0,i&&i.elevationBounds?Bn(this._elevationBounds,i.elevationBounds):Li(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of j_){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=sD.acquire(this._surface.upsampleInfoPool),s===Ht.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,uq)}release(){Kh(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of j_){for(const i of this.layerInfo[t])i.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this._usedMemory=qE}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){const t=this.cachedMemory;t>0&&(this._surface.upsampleMapCache.put(this.key,this,t),this.setMemoryDirty())}}setMemoryDirty(){this._usedMemory=qE}get cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_updateMemoryUsed(){this._usedMemory=0,this._mapTileMemory=0;const t=this.cpuImageMemorySize;for(const{data:i}of this.layerInfo[Ht.MAP])i instanceof Yy?this._mapTileMemory+=R0(i.texture):i instanceof HTMLImageElement||i instanceof bO?this._mapTileMemory+=t:i instanceof lse&&(this._mapTileMemory+=i.memoryUsage);for(const i of this.layerInfo[Ht.ELEVATION])this._usedMemory+=i.data?t:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=R0(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this.cachedMemory)}getUsedMemoryForLayer(t,i){const r=this.layerInfo[t][i];if(!r||!r.data)return 0;if(t!==Ht.MAP||this.isCached){if(t===Ht.ELEVATION)return this.cpuImageMemorySize}else{const s=r.data;if(s instanceof Yy)return R0(s.texture);if(s instanceof HTMLImageElement||s instanceof bO)return this.cpuImageMemorySize;if(s instanceof CN||s instanceof lse)return s.memoryUsage}return 0}updateScreenDepth(t){const i=this._center[sa.MIDDLE],r=t,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this._screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(t,i,r){if(_(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return Et.NONE;const s=this.level;de(jk,this._center[sa.MIDDLE],i);let n=ua(jk),o=sa.MIDDLE;de(Xw,this._center[sa.TOP],i);const a=ua(Xw);a<n&&(n=a,o=sa.TOP),de(Xw,this._center[sa.BOTTOM],i);const l=ua(Xw);if(l<n&&(n=l,o=sa.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return Et.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,f=()=>{const b=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return b!==this.vlevel?(this.vlevel=b,Et.VSPLITMERGE):Et.NONE_HIT_MAXLOD};if(r===e2.ON&&this._surface.snapLevel-s===1)return s>=t.maxLod?f():Et.SPLIT;const g=Se(this.up,jk),y=this._elevationBounds[1]-this._elevationBounds[0],v=y/this.edgeLen;if(t.aboveGround&&g>0&&v<.001&&g/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-v>0)return Et.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,Et.VSPLITMERGE):Et.NONE;if(s>=t.maxLod)return f();if(s>6){de(Xw,this._center[o],i),oe(bn,this.up,g),de(bn,bn,Xw);const b=ua(bn);if(b>this.radius*this.radius){oe(bn,bn,this.radius/Math.sqrt(b)),fe(bn,bn,this._center[o]),de(bn,i,bn);const w=Math.min(1,(Math.abs(Se(bn,this.up))+.5*y+this._curvatureHeight)/Ie(bn)),S=ant/t.angledSplitBias,x=t.fovY*c*2;if(w*(this._edgeLen/x)<S*t.relativeHeightLimit)return Et.NONE}}return Et.SPLIT}setChildren(t,i,r,s){Kh(!!(t&&i&&r&&s),"Null child passed"),this._children[0]=t,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,i;return(t=(i=this.renderData)==null?void 0:i.hasGeometry)!=null&&t}prepareToLoad(t){this.refMapData();for(const i of j_)this._createOrUpdateAgents(0,i);t.updateTileGeometryState(this)}load(t){this.prepareToLoad(t),this.loadPrepared(t)}loadPrepared(t){t.loadTile(this)}unload(t){t.unloadTile(this);for(const i of j_){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==fl&&(K3(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(Et.GEOMETRY),this.resetPendingUpdate(Et.TEXTURE_NOFADING),this.resetPendingUpdate(Et.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[Ht.MAP];for(const i of t)i.loadingAgent&&i.loadingAgent!==fl&&(K3(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(I1(t,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;_(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(Et.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){const r=this.layerInfo[i][t];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of j_){const i=this.layerInfo[t];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==fl&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(Et.SPLIT)||t!==Ht.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===Et.SPLIT||t===Et.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){const s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),r.dataArrived(this),!0;if(s.requestPromise)return!0;rh(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return ua(de(bn,this._center[sa.MIDDLE],t))}containsPoint(t){const i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}unrequestLayerData(t,i,r){const s=this.layerInfo[i][t],n=s.waitingAgents,o=n.removeUnordered(r)!=null;Kh(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this._updateMemoryUsed())}dataArrived(t,i,r){const s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this._updateMemoryUsed()}dataMissing(t,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${t} error ${r}`);const s=this.layerInfo[i][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this._updateMemoryUsed()}updateRenderData(t,i){switch(t){case Ht.MAP:return this._updateTexture(i);case Ht.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===Fn.FADING?Et.TEXTURE_NOFADING:Et.TEXTURE_FADING),this.setPendingUpdate(t===Fn.FADING?Et.TEXTURE_FADING:Et.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Et.GEOMETRY);for(const t of this.layerInfo[Ht.ELEVATION])t.pendingUpdates|=Et.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const t=this._elevationBounds;Li(t,Number.MAX_VALUE,-Number.MAX_VALUE);const i=this.layerInfo[Ht.ELEVATION];let r=!0;for(const s of i)_(s.elevationBounds)&&(t[0]=Math.min(t[0],s.elevationBounds.min),t[1]=Math.max(t[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(r=!1));r&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,i=.5*(t[0]+t[1]);oe(bn,this.up,i),fe(this._center[sa.MIDDLE],this.centerAtSeaLevel,bn),oe(bn,this.up,t[0]),fe(this._center[sa.TOP],this.centerAtSeaLevel,bn),oe(bn,this.up,t[1]),fe(this._center[sa.BOTTOM],this.centerAtSeaLevel,bn)}findElevationBoundsForLayer(t,i){const r=this.layerInfo[Ht.ELEVATION][t];if(_(r.elevationBounds)&&r.elevationBounds.level>=i)return;const s=this._surface.layerViewByIndex(t,Ht.ELEVATION),n=BG(s);if(!nR(this,n,!1))return;const o=unt;let a=!1;if(r.data){const l=r.data;o.min=l.bounds[0],o.max=l.bounds[1],o.hasNoDataValues=l.hasNoDataValues,o.level=this.level,a=!0}else{let l,c,h=0;for(let p=this._parent;p&&(!c||h<R$(this.level))&&(h=this.vlevel-p.level,l=c||l,c=p.layerInfo[Ht.ELEVATION][t].data,!(!c&&l&&h>=R$(this.level)));p=p.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=c.level,a=!0))}a&&(C(r.elevationBounds)&&(r.elevationBounds=new nX),r.elevationBounds.copyFrom(o))}modifyLayers(t,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==fl&&(K3(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:sD.acquire(this._surface.upsampleInfoPool)}this._updateMemoryUsed()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,Fn.FADING))}updateAgents(t){if(this.renderData){const i=this.layerInfo[t];for(const r of i)r.loadingAgent===fl&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of j_){const i=this._isSuspended(t);for(const r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==fl&&(r.loadingAgent.setSuspension(i),r.loadingAgent===fl&&this.updateRenderData(t,Fn.FADING))}}removeLayerAgent(t,i){const r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==fl&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){const r=this.layerInfo[i][t];r.loadingAgent=fl,r.data||r.upsampleInfo||this._createOrUpdateAgents(t+1,i)}_createOrUpdateAgents(t,i){const r=this._isSuspended(i),s=this.layerInfo[i];for(let n=t;n<s.length;++n){const o=s[n];let a=!1;const l=this._surface.layerViewByIndex(n,i),c=BG(l);if(o.loadingAgent?nR(this,c,!1)?(o.loadingAgent!==fl&&o.loadingAgent.setSuspension(r),o.loadingAgent!==fl&&(a=o.loadingAgent.update())):o.dispose():nR(this,c,!1)&&(o.loadingAgent=cnt(this,n,i,r),a=o.loadingAgent.startLoading(),a?o.loadingAgent===fl&&this.setPendingUpdate(Et.GEOMETRY):(K3(o.loadingAgent),o.loadingAgent=fl)),o.loadingAgent===fl&&this.updateRenderData(i,Fn.FADING),a&&l.isOpaque)return}}_isWithinExtent(t){const i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){const i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationBasedVerticesPerSide(t){const i=this.vlevel-this.level,r=Math.max(this.level-t,R$(this.level)-i);return He(1+(this.maxTesselation>>r),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(t,i){if(!t)return null;const r=this.surface.rootTiles;if(_(r)){for(const s of r)if(hnt(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(t,i){const r=this.lij,s=this.getNeighborLIJ(r,t);return s?dnt(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(t,i){const r=t===nt.NORTH_EAST?1:t===nt.NORTH_WEST?0:t===nt.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||i&&i(s));)s=s.children[r];return s}findNeighborCornerTileExact(t,i){var r;return(r=this.findNeighborTile(t,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(HG(t),i)}forAllSubtreeOnSide(t,i){const r=t===nt.NORTH?[0,1]:t===nt.NORTH_EAST?[1]:t===nt.EAST?[1,3]:t===nt.SOUTH_EAST?[3]:t===nt.SOUTH?[2,3]:t===nt.SOUTH_WEST?[2]:t===nt.WEST?[0,2]:[0],s=n=>{i(n)||n.isLeaf||r.forEach(o=>s(n.children[o]))};s(this)}forallNeighbors(t){mse.forEach(i=>this.findNeighborCornerTileExact(i,t)),WE.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||t(s)))==null?void 0:r.forAllSubtreeOnSide(qk(i),t)})}getNeighborEdgeStartVertexIndex(t,i){const r=i!=null?i:this.findNeighborTile(WE[t],h=>h.isLoaded);if(!r||!this.isLoaded||!r.isLoaded)return 0;const s=this.level-r.level;if(s===0)return 0;const n=2**s,o=(1&t)==1,a=o?0:1,l=r.lij[a+1]*n,c=this.lij[a+1]-l;return o?n-1-c:c}_updateNeighborsWithChangedEdgeResolution(){for(let t=0;t<4;++t)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]){const i=WE[t],r=this.findNeighborTile(i,s=>s.isLoaded||s.level===this.level);if(!r)continue;if(!r.isLoaded){r.isLeaf;const s=(t+2)%4,n=qk(i);r.forAllSubtreeOnSide(n,o=>o.isLoaded?(o.updateEdgeAfterResolutionChange(s),!0):(o.isLeaf,!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(t=this.level){this._forEachLoadedNeighbor(i=>this._updateNeighbor(i)),WE.forEach(i=>{const r=this.findNeighborTile(i,s=>s.isLoaded&&s.level<t);r==null||r.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(t){this.renderData.updateEdgeAfterResolutionChange(t)}_forEachLoadedNeighbor(t){const i=this.level,r=s=>s.level===i||s.isLoaded;WE.forEach((s,n)=>{var o,a;const l=this.findNeighborTile(s,r);l!=null&&l!==this&&l.forAllSubtreeOnSide(qk(s),h=>!!h.isLoaded&&(t(h),!0));const c=(o=this.renderData)==null||(a=o.geometryState)==null?void 0:a.neighborData;c&&(c.modifiedEdgeResolutions[n]=!1)}),mse.forEach(s=>{var n;const o=(n=this.findNeighborTile(s,r))==null?void 0:n.findCorner(HG(s),a=>a.isLoaded);!o||pnt(this,o,s),o!=null&&o.isLoaded&&t(o)})}_updateNeighbor(t){t!=null&&t.isLoaded&&t.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(t,i){const r=fse(i)?-1:pse(i)?1:0,s=hse(i)?-1:dse(i)?1:0,n=[t[0],t[1]+r,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Rt>=this.surface.extent[1]}compareLIJs(t){const i=this.lij,r=i[0],s=t[0];if(r===s)return[i,t];const n=r-s;if(n<0){const o=2**-n;return[[s,i[1]*o,i[2]*o],t]}{const o=2**n;return[i,[r,t[1]*o,t[2]*o]]}}checkGeometryWaterproofness(){}shouldHaveNeighbor(t){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(fse(t)&&i[3]+s>=r[3]||pse(t)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&hse(t)&&i[0]-s<=r[0])&&!(!n&&dse(t)&&i[2]+s>=r[2])}}function cnt(e,t,i,r){const s=i===Ht.ELEVATION?hX.acquire():uX.acquire();return s.init(e,t,i,r),s}function K3(e){e.dispose(),e instanceof Z1e?hX.release(e):e instanceof Q1e&&uX.release(e)}const uX=new as(Q1e),hX=new as(Z1e),unt=new nX,qE=-1;var sa;function hnt(e,t){const i=e.level,r=t[0];if(i>r)return!1;const s=r-i,n=t[1]>>s,o=t[2]>>s;return n===e.lij[1]&&o===e.lij[2]}function dnt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Hk(e,t,i){return Math.abs(e-t)<=i}function pnt(e,t,i){return!(!e||!t||t===e)&&(e.level>=t.level?cse(e,t,i):cse(t,e,HG(i)))}function cse(e,t,i){e.level>=t.level;const r=fnt(i),s=mnt(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=Hk(a[0],l[0],c)||e.surface.isGlobal&&Hk(a[0],-l[0],c),p=Hk(a[1],l[1],c);return h&&p?!0:e.level===t.level||!h&&!p?!1:h?use([o[1],o[3]],[n[1],n[3]],c):use([o[0],o[2]],[n[0],n[2]],c)}function use(e,t,i=Rt){return e[0]-i<=t[0]&&t[0]<=t[1]&&t[1]<=e[1]+i}function HG(e){return e===nt.NORTH_EAST?nt.SOUTH_WEST:e===nt.NORTH_WEST?nt.SOUTH_EAST:e===nt.SOUTH_WEST?nt.NORTH_EAST:nt.NORTH_WEST}function qk(e){return e===nt.NORTH?nt.SOUTH:e===nt.EAST?nt.WEST:e===nt.SOUTH?nt.NORTH:nt.EAST}function fnt(e){return e===nt.NORTH_WEST||e===nt.SOUTH_WEST}function mnt(e){return e===nt.NORTH_WEST||e===nt.NORTH_EAST}function hse(e){return e===nt.NORTH_WEST||e===nt.WEST||e===nt.SOUTH_WEST}function dse(e){return e===nt.NORTH_EAST||e===nt.EAST||e===nt.SOUTH_EAST}function pse(e){return e===nt.SOUTH_EAST||e===nt.SOUTH||e===nt.SOUTH_WEST}function fse(e){return e===nt.NORTH_EAST||e===nt.NORTH||e===nt.NORTH_WEST}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(sa||(sa={}));const WE=[nt.NORTH,nt.EAST,nt.SOUTH,nt.WEST],mse=[nt.NORTH_EAST,nt.SOUTH_EAST,nt.SOUTH_WEST,nt.NORTH_WEST];class gnt{constructor(t,i){this.values=t,this.numSurfaceIndices=i}}const ynt=65536;function vnt(e,t,i,r,s,n,o,a){const l=s[0],c=s[1],h=s[2],p=s[3],f=e.numVerticesPerSide,g=f-1,y=(f-2)**2,v=n&&(a===Vu.HAS_SOUTH_POLE||a===Vu.HAS_BOTH_POLES),b=n&&(a===Vu.HAS_NORTH_POLE||a===Vu.HAS_BOTH_POLES),w=6,S=((v?1:0)+(b?1:0))*w*(g+1),x=r.tile,E=e.neighborData,R=E.edges,O=E.edgeResolutions.reduce((ve,qe)=>ve+qe+1,0),I=q1e(y+S+O),U=I.position.typedBuffer,N=I.uv0.typedBuffer,V=r.geometryInfo,j=V.boundingBox;ir(j);const H=t[2]-t[0],J=t[3]-t[1],K=h-l,he=p-c,le=i[0],$=i[1],z=i[2];for(let ve=0;ve<=g;ve++){const qe=l+ve/g*K;Wk[ve]=Math.sin(qe),Xk[ve]=Math.cos(qe)}let k=0;const G=e.samplerData,W=E.cornerElevations;x.level;const ee=n?(ve,qe)=>Math.PI/2-2*Math.atan(Math.exp(-ve/ai.radius)):(ve,qe)=>c+qe*he;(()=>{for(let ve=1;ve<=g-1;ve++){const qe=ve/g,Ce=t[1]+qe*J,Re=ee(Ce,qe),Oe=Math.cos(Re),Ve=Math.sin(Re);for(let nr=1;nr<=g-1;nr++){const Ti=nr/g,hi=t[0]+Ti*H,tn=Wk[nr],Sr=Xk[nr],Er=o.radius+Yu(hi,Ce,G),Ps=Sr*Oe*Er-le,zo=tn*Oe*Er-$,ft=Ve*Er-z;wT(Ps,zo,ft,j);const Gn=V1*k;U[Gn+0]=Ps,U[Gn+1]=zo,U[Gn+2]=ft,N[Gn+0]=Ti,N[Gn+1]=qe,++k}}})(),V.numVerticesPerSide=e.numVerticesPerSide,V.vertexAttributes=I,Wi(V.uvOffsetAndScale,0,0,1,1);const q=r.localOrigin;J1e(V,q),(()=>{const ve=V.vertexAttributes.position.typedBuffer,qe=Ce=>{var Re,Oe,Ve;const nr=R[Ce],Ti=E.edgeResolutions[Ce],hi=Ce===1||Ce===3,tn=(Ce===1?Ti:0)/Ti,Sr=(Ce===0?Ti:0)/Ti,Er=t[0]+tn*H,Ps=t[1]+Sr*J,zo=l+tn*K,ft=n?Math.PI/2-2*Math.atan(Math.exp(-Ps/ai.radius)):Ps*Math.PI/180,Gn=Ce===0?W[3]:Ce===1?W[1]:W[2],jn=Ce===0||Ce===1?W[0]:Ce===2?W[1]:W[3],wa=Ti+1,rn=nr==null?void 0:nr.neighborTile,Ql=x.level-((Re=rn==null?void 0:rn.level)!=null?Re:x.level),Ag=2**Ql,Jl=Ti*Ag,rw=(Lt=>{if(!Lt)return 0;const vn=Ti,vr=hi?0:1,cl=Lt.lij[vr+1]*Ag,st=x.lij[vr+1]-cl;return(hi?Ag-1-st:st)*vn})(rn),ll=rn==null?void 0:rn.extent,sw=(Ce+2)%4,mv=ll?sw===1?ll[2]:ll[0]:Er,k2=ll?sw===0?ll[3]:ll[1]:Ps;let gv=mv,yv=k2;const Nr=rn==null||(Oe=rn.renderData)==null||(Ve=Oe.geometryState)==null?void 0:Ve.samplerData,ko=Ql===0?(Lt,vn,vr)=>.5*(vr+Yu(Lt,vn,G)):(Lt,vn,vr)=>vr,Kl=(Lt,vn,vr)=>{const cl=(rw+Lt)/Jl;yv=ll[1]*(1-cl)+ll[3]*cl;const st=Yu(gv,yv,Nr);return ko(vn,vr,st)},B2=(Lt,vn,vr)=>{const cl=(rw+Lt)/Jl;gv=ll[0]*(1-cl)+ll[2]*cl;const st=Yu(gv,yv,Nr);return ko(vn,vr,st)},nw=rn?hi?Kl:B2:(Lt,vn,vr)=>Yu(vn,vr,G),ow=(Lt,vn,vr)=>Lt===0?Gn:Lt===wa-1?jn:nw(Lt,vn,vr),aw=k;let iu=tn,xM=Er,vv=zo,lw=Sr,V2=Ps,_v=ft,TM=Math.sin(vv),SM=Math.cos(vv),G2=Math.cos(_v),EM=Math.sin(_v);const A5=hi?n?()=>Math.PI/2-2*Math.atan(Math.exp(-V2/ai.radius)):()=>c*(1-lw)+p*lw:()=>ft,ce=hi?Lt=>{lw=Lt,V2=t[1]*(1-Lt)+t[3]*Lt,_v=A5(),G2=Math.cos(_v),EM=Math.sin(_v)}:Lt=>{iu=Lt,xM=t[0]*(1-Lt)+t[2]*Lt,vv=l*(1-iu)+h*iu,TM=Math.sin(vv),SM=Math.cos(vv)};for(let Lt=0;Lt<wa;++Lt){ce(Lt/Ti);const vn=ow(Lt,xM,V2),vr=o.radius+vn,cl=SM*G2*vr-le,st=TM*G2*vr-$,bv=EM*vr-z;wT(cl,st,bv,j);const is=V1*k;U[is+0]=cl,U[is+1]=st,U[is+2]=bv,N[is+0]=iu,N[is+1]=lw,++k}V.outerEdges[Ce]=new oX(ve,q,aw,1,wa)};for(let Ce=0;Ce<4;++Ce)qe(Ce)})();const te=[],Ee=(ve,qe)=>{const Ce=qe*f;wT(-le,-$,-z+ve*o.radius,j),te.push({connectedRowOffset:Ce,connectedOuterEdgeOffset:ve===1?0:2,rowOffset:k,latitudeResolution:w});const Re=ve===-1?t[1]:t[3],Oe=Math.PI/2-2*Math.atan(Math.exp(-Re/ai.radius)),Ve=ve*Math.PI/2-Oe,nr=.99*(ve===1?1:-1);for(let Ti=1;Ti<=w;++Ti){const hi=Oe+Ve*(Ti/w),tn=Math.cos(hi),Sr=Math.sin(hi);for(let Er=0;Er<=g;Er++){const Ps=Er/g,zo=Wk[Er],ft=Xk[Er],Gn=o.radius+0,jn=ft*tn*Gn-le,wa=zo*tn*Gn-$,rn=Sr*Gn-z;wT(jn,wa,rn,j);const Ql=V1*k;U[Ql+0]=jn,U[Ql+1]=wa,U[Ql+2]=rn,N[Ql+0]=Ps,N[Ql+1]=nr,++k}}};v&&Ee(-1,0),b&&Ee(1,g),K1e(V,e.numVerticesPerSide,te,[0,f-1],[0,f-1],e.wireframe),r.intersectionData=null;for(let ve=0;ve<4;++ve)V.outerEdges[ve].count,E.edgeResolutions[ve]+1}function J1e(e,t){const i=e.numVerticesPerSide-2;for(let r=0;r<4;++r){const s=r===0||r===2,n=(r===0?i-1:0)*i+(r===1?i-1:0),o=(s?0:1)*i+(s?1:0),a=e.vertexAttributes.position.typedBuffer;e.innerEdges[r]=new oX(a,t,n,o,i)}}function _nt(e,t,i,r,s,n){const o=t[0],a=t[1],l=t[2]-o,c=t[3]-a,h=e.clippingArea,p=_(h)?Math.max(0,(h[0]-t[0])/l):0,f=_(h)?Math.max(0,(h[1]-t[1])/c):0,g=_(h)?Math.min(1,(h[2]-t[0])/l):1,y=_(h)?Math.min(1,(h[3]-t[1])/c):1,v=g>p?1/(g-p):1,b=y>f?1/(y-f):1,w=-p*v,S=-f*b,x=e.numVerticesPerSide,E=x-1,R=(x-2)**2,O=e.neighborData.edgeResolutions.reduce((Oe,Ve)=>Oe+Ve+1,0),I=q1e(R+O),U=I.position.typedBuffer,N=I.uv0.typedBuffer,V=n.geometryInfo,j=V.boundingBox;ir(j);let H=0;const J=ai.radius,K=e.samplerData,he=_(h)?h:[-1/0,-1/0,1/0,1/0];Math.max(t[0],he[0]),Math.max(t[1],he[1]),Math.min(t[2],he[2]),Math.min(t[3],he[3]);const le=_(h)?[t[3]>h[3],t[2]>h[2],t[1]<h[1],t[0]<h[0]]:[!1,!1,!1,!1],$=n.tile.level,z=e.neighborData.edges,k=e.neighborData.cornerElevations;let G=S,W=a;const ee=_(h)?()=>{W<h[1]?(W=h[1],G=0):W>h[3]&&(W=h[3],G=1)}:()=>{};let q=w,te=o;const Ee=_(h)?()=>{te<h[0]?(te=h[0],q=0):te>h[2]&&(te=h[2],q=1)}:()=>{};!_(h)||(Math.max(Math.floor(E*(h[1]-a)/c),0),Math.min(Math.ceil(E*(h[3]-a)/c),x-1)),!_(h)||(Math.max(Math.floor(E*(h[0]-o)/l),0),Math.min(Math.ceil(E*(h[2]-o)/l),x-1));const ve=i[0],qe=i[1],Ce=i[2],Re=s?Oe=>(Math.PI/2-2*Math.atan(Math.exp(-Oe/J)))*J-qe:Oe=>Oe*r-qe;(()=>{for(let Oe=1;Oe<=E-1;Oe++){const Ve=Oe/E;G=S+Ve*b,W=a+Ve*c,ee();const nr=W,Ti=Re(nr);for(let hi=1;hi<=E-1;hi++){const tn=hi/E;q=w+tn*v,te=o+tn*l,Ee();const Sr=te,Er=Yu(Sr,nr,K),Ps=Sr*r-ve,zo=Er-Ce;wT(Ps,Ti,zo,j);const ft=V1*H;U[ft+0]=Ps,U[ft+1]=Ti,U[ft+2]=zo,N[ft+0]=q,N[ft+1]=G,++H}}})(),V.numVerticesPerSide=e.numVerticesPerSide,V.vertexAttributes=I,Wi(n.geometryInfo.uvOffsetAndScale,p,f,g-p,y-f),J1e(V,n.localOrigin);{const Oe=e.neighborData,Ve=V.vertexAttributes.position.typedBuffer,nr=n.localOrigin,Ti=hi=>{const tn=z[hi],Sr=Oe.edgeResolutions[hi],Er=hi===1||hi===3;let Ps=hi===1?Sr:0,zo=hi===0?Sr:0;const ft=Er?0:1,Gn=Er?1:0,jn=Ps/Sr,wa=zo/Sr;q=w+jn*v,G=S+wa*b,te=t[0]+jn*l,W=t[1]+wa*c,Ee(),ee();const rn=Sr+1,Ql=H,Ag=k[hi===0?3:hi===1?1:2],Jl=1-(1&hi),rw=le[3-(1&hi)],ll=le[Jl],sw=k[hi===0||hi===1?0:hi===2?1:3],mv=tn,k2=_(mv)?(Nr,ko)=>{const Kl=Yu(Nr,ko,mv.neighborSamplerData);return mv.neighborTile.level===$?.5*(Kl+Yu(Nr,ko,K)):Kl}:(Nr,ko)=>Yu(Nr,ko,K),gv=le[hi]?(Nr,ko,Kl)=>Yu(ko,Kl,K):(Nr,ko,Kl)=>Nr!==0||rw?Nr!==Sr||ll?k2(ko,Kl):sw:Ag,yv=Er?Nr=>{G=S+Nr*b,W=t[1]*(1-Nr)+t[3]*Nr,ee()}:Nr=>{q=w+Nr*v,te=t[0]*(1-Nr)+t[2]*Nr,Ee()};for(let Nr=0;Nr<rn;++Nr){yv(Nr/Sr);const ko=te,Kl=W,B2=gv(Nr,ko,Kl),nw=ko*r-ve,ow=Re(Kl),aw=B2-Ce;wT(nw,ow,aw,j);const iu=V1*H;U[iu+0]=nw,U[iu+1]=ow,U[iu+2]=aw,N[iu+0]=q,N[iu+1]=G,++H,Ps+=ft,zo+=Gn}V.outerEdges[hi]=new oX(Ve,nr,Ql,1,rn)};(()=>{for(let hi=0;hi<4;++hi)Ti(hi)})()}K1e(V,e.numVerticesPerSide,[],[0,x-1],[0,x-1],e.wireframe),n.intersectionData=null}function K1e(e,t,i,r,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,r[1])-Math.max(1,r[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=jG.map((x,E)=>E===0&&s[1]<t-2||E===1&&r[1]<t-2||E===2&&s[0]>1||E===3&&r[0]>1),h=3*(l+e.outerEdges.reduce((x,E,R)=>x+(c[R]?0:o-2+E.count-1),0)+i.reduce((x,E)=>x+o*(2*(E.latitudeResolution-1)+1),0))*(n?2:1),p=new(a>ynt?Uint32Array:Uint16Array)(h);let f=0;const g=n?(x,E,R)=>{p[f++]=x,p[f++]=E,p[f++]=E,p[f++]=R,p[f++]=R,p[f++]=x}:(x,E,R)=>{p[f++]=x,p[f++]=E,p[f++]=R},y=t-2,v=o-2;(()=>{for(let x=Math.max(s[0],1)-1;x<Math.min(s[1],t-2)-1;++x)for(let E=Math.max(r[0],1)-1;E<Math.min(r[1],t-2)-1;++E){const R=x*y+E,O=R+1,I=O+y,U=I-1;g(R,O,I),g(I,U,R)}})(),(()=>{for(let x=0;x<4;++x){if(c[x])continue;const E=e.outerEdges[x],R=e.innerEdges[x];let O=0,I=0;const U=E.count,N=R.count;E.count;const V=x===1||x===2?(j,H,J)=>g(j,H,J):(j,H,J)=>g(j,J,H);for(;O<U-1||I<N-1;){const j=R.getVertexOffset(I),H=E.getVertexOffset(O),J=O<U-1,K=I<N-1,he=J?0+o*(O+.5)/(U-1):0,le=K?1+v*(I+.5)/(N-1):0;J&&(!K||he<=le)?(++O,V(j,H,E.getVertexOffset(O))):(++I,V(j,H,R.getVertexOffset(I)))}}})();const b=x=>{let E=e.outerEdges[x.connectedOuterEdgeOffset].offset0;for(let R=0;R<x.latitudeResolution;++R){const O=R===0?x.rowOffset:E+t;for(let I=0;I<o;I++)g(E,E+1,O+I),R<x.latitudeResolution-1&&g(E+1,O+I+1,O+I),++E;E=O}};i.forEach(b);const w=new gnt(p,h);e.indices=w.values,e.numSurfaceIndices=w.numSurfaceIndices;const S=w.numSurfaceIndices;e.indexCount=S}function wT(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}const Wk=new Array(uq+1),Xk=new Array(uq+1);class bnt extends cX{constructor(t,i,r){super(),this.horizontalScaleFactor=1,this.isWebmercatorOnPlateeCaree=!1,this.extentInRenderSR=Gt(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=_(s)&&Sae(s),a=o&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=a,this.isWebmercatorOnPlateeCaree=o&&n.isWebMercator;const l=this.extentInRenderSR,c=this.extent;if(this.isWebmercatorOnPlateeCaree){const h=Le(c[0],c[1],0);kn(h,Ke.WebMercator,h,Ke.PlateCarree);const p=Le(c[2],c[3],0);kn(p,Ke.WebMercator,p,Ke.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*a;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[sa.MIDDLE][3]=o}_isVisible(t){return d7e(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return IEe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,i,r,s){return eI[0]=1/i[0],eI[1]=1/i[1],eI[2]=1/i[2],fW(this._aabb(),t,eI,r,s)}createGeometry(t,i){_nt(t,this.extent,i,this.horizontalScaleFactor,this.isWebmercatorOnPlateeCaree,this.renderData),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}}const eI=M();var xO;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(xO||(xO={}));class wnt extends cX{constructor(t,i,r){super(),this.obb=new Array(8),this.isWebMercator=!1;for(let s=0;s<8;s++)this.obb[s]=M();t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r),this.isWebMercator=r.tilingScheme.spatialReference.isWebMercator;const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=ti(o,l,.5),p=ti(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),eE(this.centerAtSeaLevel,p,h,this.ellipsoid.radius,0);const g=za(this.centerAtSeaLevel);Te(g,g),this.up=g,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)se(this._center[Zh.MIDDLE],0,0,0),se(this._center[Zh.TOP],0,0,0),se(this._center[Zh.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=Ci(this.surface.spatialReference)),this._center[Zh.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(fa(this._center[Zh.MIDDLE],this.obb[0]),fa(this._center[Zh.MIDDLE],this.obb[1]));this._center[Zh.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!m0(t,this._center[Zh.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const i=this.obb;for(let r=0;r<Q0.NUM;r++){const s=r===cr.NEAR,n=t[r];s&&(XE[0]=n[0],XE[1]=n[1],XE[2]=n[2],XE[3]=n[3]-this.surface.view.state.camera.near);const o=s?XE:n;let a;for(a=0;a<8;a++){const l=i[a];if(o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]<0)break}if(a===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(t,i){const r=this._getPatchType(this.lij[1],this.lij[0]);vnt(t,this.extent,i,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,r),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,i=this.obb;for(let r=0;r<2;r++){const s=this.elevationBounds[r];let n=4*r;eE(i[n++],t[0],t[1],this.ellipsoid.radius,s),eE(i[n++],t[0],t[3],this.ellipsoid.radius,s),eE(i[n++],t[2],t[3],this.ellipsoid.radius,s),eE(i[n++],t[2],t[1],this.ellipsoid.radius,s)}if(this.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case Vu.HAS_NORTH_POLE:se(i[1],0,0,this.ellipsoid.radius),se(i[2],0,0,this.ellipsoid.radius),se(i[5],0,0,this.ellipsoid.radius),se(i[6],0,0,this.ellipsoid.radius);break;case Vu.HAS_SOUTH_POLE:se(i[0],0,0,-this.ellipsoid.radius),se(i[3],0,0,-this.ellipsoid.radius),se(i[4],0,0,-this.ellipsoid.radius),se(i[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,i){return t===(1<<i)-1?t===0?Vu.HAS_BOTH_POLES:Vu.HAS_SOUTH_POLE:t===0?Vu.HAS_NORTH_POLE:Vu.REGULAR}intersectsRay(t,i,r,s){const n=this._center[Zh.MIDDLE],o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*p-l,g=i[1]*p-c,y=i[2]*p-h;return f*f+g*g+y*y<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<gse.length?gse[this.level]+1:2}}const gse=[128,64,32,16,16,8,8,4],XE=fi();var Zh;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Zh||(Zh={}));class xnt{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}class Tnt{constructor(){this.geometryInfo=new Mst,this.intersectionData=null,this.geometryState=null,this._textureRef=new qT(()=>this.tile.surface.textureFadeDuration),this.overlay=new xnt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1}init(t){this.tile=t,this.clear();const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,ir(i.boundingBox),i.numSurfaceIndices=0,i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new Cst,this.localOrigin=null,this.overlay.clear()}clear(){const t=this.releaseGeometry();return this.releaseTexture(),this._textureRef.clear(),t}updateGeometryIfChanged(t,i){const r=this.updateGeometryStateAndPrepareForGeometryGeneration(i);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(r,t)}updateNeighborDataAndGeometryIfNeeded(t=!1,i=this.vao.context){const r=this._updateNeighborData(),s=t||this._geometryStateChangedSinceLastUpdate||r;return s&&(this._updateGeometry(i),this._geometryStateChangedSinceLastUpdate=!1),s}_calculateEdgeResolution(t,i){const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const h=r.surface.extent;if(_(h)&&(t===0&&r.extent[3]>h[3]||t===1&&r.extent[2]>h[2]||t===2&&r.extent[1]<h[1]||t===3&&r.extent[0]<h[0]))return s}const n=r.level,o=jG[t],a=i||r.findNeighborTile(o,h=>h.isLoaded||h.level===n);var l;if(!a||a.isLeaf&&!a.isLoaded)return C((l=r.surface)==null?void 0:l.rootTiles)||r.surface.updatingRootTiles||r.shouldHaveNeighbor(o),s;if(a.isLoaded){const h=a,p=h.renderData.geometryState,f=n-h.level;if(f===0){const v=p.numVerticesPerSide-1;return Math.max(v,s)}const g=2**f,y=p.neighborData.edgeResolutions[(t+2)%4]/g;return Math.max(1,y)}a.isLeaf;let c=s;return a.forAllSubtreeOnSide(Ost(o),h=>h===r||(h.isLoaded?(c=Math.max(c,2**(h.level-n)),!0):(h.isLeaf,!1))),c}_updateNeighborData(){const t=this.tile,i=c=>c.isLoaded||c.level===t.level,r=c=>c.isLoaded,s=[null,null,null,null],n=[null,null,null,null];(()=>{for(let c=0;c<4;++c){const h=t.findNeighborTile(jG[c],i);s[c]=h,n[c]=h!=null&&h.isLoaded?h:null}})();const o=[null,null,null,null];(()=>{for(let c=0;c<4;++c)o[c]=t.findNeighborTile(rse[c],r)})();const a=this.geometryState.neighborData;let l=!1;return(()=>{for(let c=0;c<4;++c){const h=a.edgeResolutions[c],p=s[c],f=this._calculateEdgeResolution(c,p);a.edgeResolutions[c]=f,h!==f&&(l=!0,p&&p!==t&&!p.isLoaded&&p.level===t.level&&(a.modifiedEdgeResolutions[c]=!0))}})(),(()=>{const c=[null,null,null,null],h=(g,y)=>{let v=1/0;for(let E=0;E<4;++E){const R=rse[E],O=g[E];if(O){const I=O.findCorner(Rst(R),U=>(U==null?void 0:U.isLoaded)||U===t);c[E]=I,v=Math.min(v,I.level)}else c[E]=null}for(let E=0;E<4;++E){const R=c[(E+3)%4],O=c[E];if(R&&R.level<t.level&&R===O){const I=R,U=(1&E)==1,N=(t.getNeighborEdgeStartVertexIndex(E,I)+(y===0||y===1&&!U||y===3&&U?1:0))/2**(t.level-I.level),V=U?y===0||y===1?I.extent[0]:I.extent[2]:ti(I.extent[0],I.extent[2],N),j=U?ti(I.extent[1],I.extent[3],N):y===0||y===3?I.extent[1]:I.extent[3];return Yu(V,j,I.renderData.geometryState.samplerData)}}let b=0,w=0;for(let E=0;E<4;++E){const R=c[E];if(R&&R.level===v){var S,x;const O=E===0||E===1,I=E===0||E===3,U=R.extent;w+=Yu(U[O?0:2],U[I?1:3],(S=R.renderData)==null||(x=S.geometryState)==null?void 0:x.samplerData),b++}}return b?w/b:0},p=this.geometryState.neighborData.cornerElevations,f=(g,y)=>{const v=h(y,g);return p[g]!==v&&(p[g]=v,!0)};for(let g=0;g<4;++g){const y=o[g],v=n[g],b=[y,n[(g+1)%4],t,v],w=b.map((x,E)=>b[(E+4-g)%4]),S=f(g,w);l||(l=S)}})(),(()=>{const c=(f,g)=>{if(f==null||!f.isLoaded||f.lij[0]>t.lij[0])return null;const y=f.renderData.geometryState;return{neighborSamplerData:y.samplerData,neighborEdgeOverlapResolution:y.neighborData.edgeResolutions[g+2],version:y.samplerDataVersion,neighborVerticesPerSide:y.numVerticesPerSide,neighborTile:f}},h=a.edges;for(let f=0;f<4;++f){var p;const g=n[f];g&&(g==null||g.isLoaded,(g==null?void 0:g.lij[0])<=t.lij[0],void 0);const y=h[f],v=y==null?void 0:y.version,b=c(g,f),w=(p=b==null?void 0:b.version)!=null?p:null,S=y!=null!=(b!=null),x=y&&b&&v!==w,E=y&&b&&(y==null?void 0:y.neighborTile)!==(b==null?void 0:b.neighborTile),R=S||x||E;l||(l=R),!R&&v||(h[f]=b)}})(),l}updateEdgeAfterResolutionChange(t){var i,r;const s=this._calculateEdgeResolution(t),n=this.geometryState.neighborData.edgeResolutions,o=n[t];((i=(r=this.geometryState.neighborData.edges[t])==null?void 0:r.neighborTile.level)!=null?i:0)<=this.tile.level,s!==o&&(n[t]=s,this._updateGeometry(this.vao.context))}_updateGeometry(t){this._releaseGeometry(),this._createGeometry(t)}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,i){return _(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),C(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){_(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(t){const i=this._getElevationInfo(),r=i.samplerData?this.tile.getElevationBasedVerticesPerSide(i.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),s=Math.max(r,5);let n=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;return o.numVerticesPerSide!==s&&(o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),i.changed&&(o.samplerData=i.samplerData,o.samplerDataVersion++,a=!0),I0(o.clippingArea,n)||(o.clippingArea=n,a=!0),o.wireframe!==t&&(o.wireframe=t,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),this._hasGeometry=!0,a}_createGeometry(t){this.tile.createGeometry(this.geometryState,this.localOrigin);const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=t.gl;this._vao=new Os(t,Ri,{geometry:Zl(i.layout)},{geometry:si.createVertex(t,s.STATIC_DRAW,i.buffer)},si.createIndex(t,s.STATIC_DRAW,r)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,$st(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,i=Ym.Immediate){_(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,i=this.tile.layerInfo[Ht.ELEVATION],r=i.length;let s=new Array(r),n=0,o=0,a=!1;for(let l=0;l<r;l++){const c=i[l];if(c.upsampleInfo){const h=c.upsampleInfo.tile,p=h.layerInfo[Ht.ELEVATION][l].data,f=p&&p.samplerData;t&&t[n]===f||(a=!0),s[n++]=f,o=Math.max(o,h.lij[0])}else if(c.data){const h=this.tile.surface.layerViewByIndex(l,Ht.ELEVATION);if(nR(this.tile,h.layer,!1)){const p=c.data;t&&t[n]===p.samplerData||(a=!0),s[n++]=p.samplerData,o=this.tile.level}}}return _(t)&&t.length!==n&&(a=!0),n>0?s.length=n:s=null,{changed:a,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const t=Rc(this.intersectionData,0,i=>i.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return _(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){}}class Snt{constructor(){this.extent=ii(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class Ent{constructor(){this._queries=new Vt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Vt({initialSize:30}),this._queryPool=new as(Snt)}queryVisibleLevelRange(t,i,r,s){const n=this._queryPool.acquire();Dc(n.extent,t),n.minLevel=i||-Number.MAX_VALUE,n.maxLevel=r!=null?r:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const i=this._queries.data[t];this._queryPool.release(i),i.callback(t>=this._queriesInvPtr),i.callback=null}this._queries.clear()}scaleQueriesForTile(t){const i=t.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}}var fh;(function(e){e[e.NoAlpha=0]="NoAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.OneMinusSourceAlpha=2]="OneMinusSourceAlpha",e[e.COUNT=3]="COUNT"})(fh||(fh={}));function Ant(){const e=new Fi;return e.attributes.add(A.POSITION,"vec2"),e.attributes.add(A.UV0,"vec2"),e.vertex.uniforms.add(new ye("scale",F.Pass,t=>t.scale)),e.vertex.uniforms.add(new Ft("offset",F.Pass,t=>t.offset)),e.fragment.uniforms.add(new et("tex",F.Pass,t=>t.texture)),e.fragment.uniforms.add(new ye("opacity",F.Pass,t=>t.opacity)),e.varyings.add("uv","vec2"),e.vertex.code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
}`),e.fragment.code.add(T`void main() {
vec4 color = texture2D(tex, uv);
gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
}`),e}const Cnt=Object.freeze(Object.defineProperty({__proto__:null,build:Ant},Symbol.toStringTag,{value:"Module"}));class Rnt extends qs{constructor(){super(...arguments),this.scale=1,this.offset=sg,this.opacity=1,this.texture=null}}class TO extends Ki{initializeProgram(t){const i=TO.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){const t=this.configuration.mode===fh.OneMinusSourceAlpha?ah(Me.ONE,Me.ONE_MINUS_SRC_ALPHA):this.configuration.mode===fh.SourceAlpha?ah(Me.ZERO,Me.SRC_ALPHA):null;return Ut({blending:t,colorWrite:Qt})}}TO.shader=new Vi(Cnt,()=>import("./BlendLayers.glsl.00690ca9.js"));class qG extends _a{constructor(){super(...arguments),this.mode=fh.NoAlpha}}u([B({count:fh.COUNT})],qG.prototype,"mode",void 0);class Yk{constructor(t,i,r,s,n,o,a){this.texture=t,this.type=i,t.retain(),this.offsetAndScale=ri(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Le(s,a?o:0,n)}destroy(){this.texture.release()}}function Ont(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Mnt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function Pnt(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e}function ebe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function Int(e){return e[0]*e[3]-e[1]*e[2]}function tbe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],p=i[2],f=i[3],g=i[4],y=i[5];return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*p+n*f,e[3]=s*p+o*f,e[4]=r*g+n*y+a,e[5]=s*g+o*y+l,e}function dX(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function ibe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function pX(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*h+a,e[5]=s*c+o*h+l,e}function $nt(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function Dnt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function fX(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function Lnt(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function Nnt(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function Fnt(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function rbe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function Unt(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function znt(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function knt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function Bnt(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],f=t[4],g=t[5];return Math.abs(i-l)<=Rt*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=Rt*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=Rt*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=Rt*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=Rt*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-g)<=Rt*Math.max(1,Math.abs(a),Math.abs(g))}const Vnt=tbe,Gnt=rbe;Object.freeze(Object.defineProperty({__proto__:null,copy:Ont,identity:Mnt,set:Pnt,invert:ebe,determinant:Int,multiply:tbe,rotate:dX,scale:ibe,translate:pX,fromRotation:$nt,fromScaling:Dnt,fromTranslation:fX,str:Lnt,frob:Nnt,add:Fnt,subtract:rbe,multiplyScalar:Unt,multiplyScalarAndAdd:znt,exactEquals:knt,equals:Bnt,mul:Vnt,sub:Gnt},Symbol.toStringTag,{value:"Module"}));function sbe(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function jnt(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Hnt(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function qnt(e,t){return new Float32Array(e,t,6)}function nbe(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function Wnt(e,t,i,r=0,s=0,n=2){const o=s||t.length/n;for(let a=r;a<o;a++)nbe(e,t,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,create:sbe,clone:jnt,fromValues:Hnt,createView:qnt,transform:nbe,transformMany:Wnt},Symbol.toStringTag,{value:"Module"}));function oD(){return[1,0,0,1,0,0]}function Xnt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Ynt(e,t,i,r,s,n){return[e,t,i,r,s,n]}function Znt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:oD,clone:Xnt,fromValues:Ynt,createView:Znt},Symbol.toStringTag,{value:"Module"}));function Qnt(e){return e instanceof Float32Array&&e.length>=2}function Jnt(e){return Array.isArray(e)&&e.length>=2}function Zk(e){return Qnt(e)||Jnt(e)}const Knt=96,eot=39.37;function mX(e,t){return t.type?Li(e,t.x,t.y):Bn(e,t)}function tot(e){return Yl(e)}function iot(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const rot=function(){const e=lt();return function(t,i,r){const s=i.targetGeometry;mX(e,s);const n=.5*h5(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();function h5(e){return e.scale*sot(e.targetGeometry)}function sot(e){return _(e)&&qc(e.spatialReference)?1/(tot(e.spatialReference)*eot*Knt):1}function not(e){return YN(e.rotation)||0}const gX=function(){const e=lt(),t=lt(),i=lt();return function(r,s,n,o,a,l){return fq(e,s),Fl(t,n,.5*l),Li(i,1/o*l,-1/o*l),fX(r,t),a&&dX(r,r,a),ibe(r,r,i),pX(r,r,e),r}}(),oot=function(){const e=lt();return function(t,i,r,s){const n=h5(i),o=not(i);return mX(e,i.targetGeometry),gX(t,e,r,n,o,s)}}(),aot=function(){const e=lt();return function(t,i,r,s){const n=h5(i);return mX(e,i.targetGeometry),gX(t,e,r,n,0,s)}}();function lot(e){if(e.isWrappable){const t=x0(e);return t.valid[1]-t.valid[0]}return 0}function cot(e,t){return Math.round(lot(e)/t)}var WG;const Bf=[0,0];let Dy=WG=class extends _e{constructor(e){super(e),this._viewpoint2D={center:lt(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new ni,this.id=0,this.inverseTransform=oD(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=oD(),this.transformNoRotation=oD(),this.displayMat3=Xm(),this.displayViewMat3=Xm(),this.viewMat3=Xm(),this.viewMat2d=sbe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=iot(i,e.viewpoint),this._set("size",Bn(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new WG({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return Zk(t)?F_(e,t,this.inverseTransform):(Bf[0]=t,Bf[1]=i,F_(e,Bf,this.inverseTransform))}toScreen(e,t,i){return Zk(t)?F_(e,t,this.transform):(Bf[0]=t,Bf[1]=i,F_(e,Bf,this.transform))}toScreenNoRotation(e,t,i){return Zk(t)?F_(e,t,this.transformNoRotation):(Bf[0]=t,Bf[1]=i,F_(e,Bf,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return gX(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Cd({targetGeometry:new We(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=h5(o),this.rotation=r,this.scale=i,this.spatialReference=t,Bn(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;Cq(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=Rq(this.viewMat3),h=Bu(n[0]/2,n[1]/2),p=Bu(-n[0]/2,-n[1]/2),f=YN(r);NL(c,c,h),Oq(c,c,f),NL(c,c,p),r4(this.displayViewMat3,this.displayMat3,c);const g=fX(this.viewMat2d,h);return dX(g,g,f),pX(g,g,p),rot(this.extent,o,n),oot(this.transform,o,n,s),ebe(this.inverseTransform,this.transform),aot(this.transformNoRotation,o,n,s),this.worldScreenWidth=cot(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],Dy.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],Dy.prototype,"pixelRatio",null),u([d({json:{write:!0}})],Dy.prototype,"size",null),u([d()],Dy.prototype,"spatialReference",void 0),u([d({type:Cd,json:{write:!0}})],Dy.prototype,"viewpoint",null),Dy=WG=u([P("esri.views.2d.ViewState")],Dy);const uot=Dy,hot=.125;class dot{constructor(){this._renderParams={context:null,drawPhase:1,state:new uot({viewpoint:new Cd({targetGeometry:new We(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,i,r,s,n,o,a,l,c,h){const p=o.adjustLevel(i[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const g=o.getScale(i[0]),[y,v]=o.getShift(i,a*g),b=hot*a*g/c,w=r.transforms.dvs;w[0]=b,w[4]=-b,w[6]=-1-y-l[0]*a*2,w[7]=1+v+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(t),r.triangleCount=0,s.drawTile(f,r,n)}}class d5 extends Ki{initializeProgram(t){const i=d5.shader.get().build(this.configuration),r=new Gi(t.rctx,i,Ri);return this._uniformLocationInfos=snt(t.rctx,r),r}initializePipeline(){const t=this.configuration.mode===fh.OneMinusSourceAlpha?ah(Me.ONE,Me.ONE_MINUS_SRC_ALPHA):this.configuration.mode===fh.SourceAlpha?ah(Me.ZERO,Me.SRC_ALPHA):null;return Ut({blending:t,colorWrite:Qt})}bindPass(t){this.program.bindPass(t,null),ose(this.program,this._uniformLocationInfos,t.basic),ose(this.program,this._uniformLocationInfos,t.common)}}d5.shader=new Vi(Zst,()=>import("./RasterColorizer.glsl.6dbd5ecd.js"));class fC extends _a{constructor(){super(...arguments),this.mode=fh.OneMinusSourceAlpha,this.colorizerType=W1.Stretch,this.stretchType=Nb.Noop,this.applyColormap=!0}}u([B({count:fh.COUNT})],fC.prototype,"mode",void 0),u([B({count:W1.COUNT})],fC.prototype,"colorizerType",void 0),u([B({count:Nb.COUNT})],fC.prototype,"stretchType",void 0),u([B()],fC.prototype,"applyColormap",void 0);class pot{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}release(t){this._getPool(t.width).release(t)}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let i=this._pools.get(t);if(!i){const r=hr.bind(hr,this._rctx,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.DEPTH_RENDER_BUFFER,width:t,height:t});i=new as(r),this._pools.set(t,i)}return i}}class fot{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._vectorTileHelper=new dot,this._bindParameters=new o4(null,null,null),this._vaoQuad=ba(this._rctx,tM),this._fboPool=new pot(this._rctx)}dispose(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null),this._vaoQuad=it(this._vaoQuad),this._vectorTileHelper=it(this._vectorTileHelper),this._applyOpacityTechnique=$i(this._applyOpacityTechnique),this._blendLayersTechnique=$i(this._blendLayersTechnique)}get blendLayersTechnique(){if(C(this._blendLayersTechnique)){const t=new qG;t.mode=fh.OneMinusSourceAlpha,this._blendLayersTechnique=this._techniqueRepository.acquire(TO,t)}return this._blendLayersTechnique}get applyOpacityTechnique(){if(C(this._applyOpacityTechnique)){const t=new qG;t.mode=fh.SourceAlpha,this._applyOpacityTechnique=this._techniqueRepository.acquire(TO,t)}return this._applyOpacityTechnique}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Dt.TRIANGLE_STRIP,0,oo(this._vaoQuad,"geometry"))}drawRasterData(t,i){if(C(i.texture))return;const r=this._rctx.bindTechnique(t,i,this._bindParameters);this._render(r)}drawImageryTileData(t,i=1){const r=t.sourceLayerInfo.data;if(!r.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,Ht.MAP).ensureSymbolizerParameters(r);const s=this._getRasterColorizerTechnique(r),n=this._rctx,o=n.bindTechnique(s);r.bind(n)&&(r.opacity=i,r.scale=t.scale,r.offset=t.offset,r.bindRasterTextures(o),s.bindPass(r.getUniforms()),this._render(o),n.bindVAO())}_getRasterColorizerTechnique(t){const i=t.symbolizerParameters,r=["stretch","lut","hillshade"].indexOf(i.type);return C(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new fC,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.colorizerType=r,this._rasterColorizerConfig.applyColormap=!!i.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?Nb.Noop:Nb.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(d5,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,i,r,s,n,o,a){const l=this._rctx,c=r.sourceLayerInfo.data,h=r.tile.surface.layerViewByIndex(r.layerIndex,Ht.MAP);let p;return t.bindPipelineState(l),i.opacity<1?(p=this._fboPool.acquire(o),l.bindFramebuffer(p),l.setClearColor(1,1,1,0),l.clearSafe(ki.COLOR_BUFFER_BIT|ki.DEPTH_BUFFER_BIT)):a&&l.clearSafe(ki.DEPTH_BUFFER_BIT),this._vectorTileHelper.render(l,r.sourceLod,c,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/r.scale),r.offset,n,s),!_(p)||(l.bindFramebuffer(this._currentlyBoundfbo),i.texture=p.colorTexture,i.offset=sg,i.scale=1,this.drawRasterData(t,i),this._fboPool.release(p),a)}bindPool(t){this._currentlyBoundfbo=this._fboPool.acquire(t),this._rctx.bindFramebuffer(this._currentlyBoundfbo),this._rctx.setViewport(0,0,t,t),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(ki.COLOR_BUFFER_BIT|ki.DEPTH_BUFFER_BIT)}releasePool(){this._rctx.bindFramebuffer(null),this._fboPool.release(this._currentlyBoundfbo)}cleanupFBOPool(t,i){t===this._lastPixelRatio&&i===this._lastNumLayers||(this._fboPool.clear(),this._lastPixelRatio=t,this._lastNumLayers=i)}}class mot{constructor(t,i,r){this._rctx=t,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new Rnt,this._backgroundIsGrid=!1,this._backgroundTexture=null,this._backgroundColor=null,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new fot(this._rctx,this._techniqueRepository),this._blackTex=new Yy(nee(this._rctx,[0,0,0,1]))}dispose(){this._composition=it(this._composition),this._backgroundTexture=$i(this._backgroundTexture),this._blackTex=$i(this._blackTex)}get backgroundIsGrid(){return this._backgroundIsGrid}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,i){const r=t.layerInfo[Ht.MAP];for(const v of r)v.pendingUpdates&=~(Et.TEXTURE_NOFADING&Et.TEXTURE_FADING);if(!t.renderData)return;const s=t.surface,n=s.baseOpacity;let o=0,a=0,l=this.tileSize,c=!1;const h=s.view.state.pixelRatio;let p=r.length,f=0;for(;f<r.length&&!c;f++){const v=s.layerViewByIndex(f,Ht.MAP),b=v.fullOpacity;if(Jk[f]=b,bhe(v.layer)&&p>=r.length&&(p=f),b===0)continue;++a;const w=Qk(t,f,Kk);w&&(AN(v)?l=Math.max(l,this.tileSize*h):n===1&&b===1&&(v.isOpaque||this._dataToTexture(w)&&w.sourceLayerInfo.data.descriptor.isOpaque)&&(c=!0),++o)}this._composition.cleanupFBOPool(h,r.length),l=got(l);const g=l/this.tileSize,y=f-1;o!==0?o===1&&(c||this._backgroundIsGrid||_(this._backgroundColor))&&this._useLayerTexture(t,y,p,Jk[y])||this._composeMapLayers(t,i,y,p,c,Jk,l,g):this._useBackgroundTexture(t,a)}_useBackgroundTexture(t,i){let r=Ym.Immediate;(t.surface.view.layerViewManager.updating||i>0)&&(r=Ym.Delayed),this._backgroundTexture&&C(t.renderData.textureReference)&&(r=Ym.Immediate),t.renderData.setTextureReference(_(this._backgroundTexture)?new Yk(this._backgroundTexture,Fn.FADING,yse,t.surface.baseOpacity,1,1,!1):null,r)}_useLayerTexture(t,i,r,s){const n=i<r,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=Qk(t,i,Kk);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new Yk(l.sourceLayerInfo.data,Fn.FADING,l,o,s,a,!0)),!0)}_composeMapLayers(t,i,r,s,n,o,a,l){const c=this._rctx;this._composition.bindPool(a);let h=!1;!n&&_(this._backgroundTexture)&&(this._passParameters.texture=this._backgroundTexture.texture,this._passParameters.offset=sg,this._passParameters.scale=1,this._passParameters.opacity=1,this._composition.drawRasterData(this._composition.blendLayersTechnique,this._passParameters));const p=t.surface.baseOpacity;let f=!1,g=Je.LINEAR_MIPMAP_LINEAR;for(let S=r;S>=0;S--){const x=Qk(t,S,Kk);x&&(S<s&&p<1&&!f&&(this._passParameters.texture=this._blackTex.texture,this._passParameters.offset=sg,this._passParameters.scale=1,this._passParameters.opacity=p,this._composition.drawRasterData(this._composition.applyOpacityTechnique,this._passParameters),f=!0),o[S]!==0&&(Prt(x)?(this._passParameters.opacity=o[S],h=this._composition.drawVectorData(this._composition.blendLayersTechnique,this._passParameters,x,l,this.tileSize,a,h)):Mrt(x)?(this._composition.drawImageryTileData(x,o[S]),this._hasNearestInterpolation(x)&&(g=Je.NEAREST)):this._dataToTexture(x)&&(this._passParameters.texture=x.sourceLayerInfo.data.texture,this._passParameters.offset=x.offset,this._passParameters.scale=x.scale,this._passParameters.opacity=o[S],this._composition.drawRasterData(this._composition.blendLayersTechnique,this._passParameters))))}const y=t.renderData.ensureTexture(a,()=>this._buildTexture(a,g)),v=c.bindTexture(y.texture,ot.TEXTURE_UNIT_FOR_UPDATES),b=y.descriptor;c.gl.copyTexImage2D(pt.TEXTURE_2D,0,b.pixelFormat,0,0,b.width,b.height,0),y.generateMipmap(),c.bindTexture(v,ot.TEXTURE_UNIT_FOR_UPDATES),this._composition.releasePool();const w=f?1:p;t.renderData.setTextureReference(new Yk(y,i,yse,w,1,1,!1))}_hasNearestInterpolation(t){const i=t.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(t){return $rt(t)&&this._rasterDataToTexture(t),Irt(t)}_rasterDataToTexture(t){const i=t.sourceLayerInfo;i.data=this._buildTexture(i.data),t.tile.setMemoryDirty()}setBackground(t,i){$i(this._backgroundTexture),this._backgroundIsGrid=i,t instanceof HTMLImageElement?(this._backgroundTexture=this._buildTexture(t),this._backgroundColor=null):(this._backgroundTexture=new Yy(nee(this._rctx,ri(t[0]||0,t[1]||0,t[2]||0,1))),this._backgroundColor=Le(t[0]||0,t[1]||0,t[2]||0))}_buildTexture(t,i=Je.LINEAR_MIPMAP_LINEAR){if(C(t))return null;const r={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")r.width=r.height=t,n=new Yy(new ot(s,r));else if(t instanceof bO)r.isOpaque=t.isOpaque,n=new Yy(new ot(s,r,t.image)),t.release();else try{n=new Yy(new ot(s,r,t))}catch{n=new Yy(Tge(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,ot.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,ot.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function got(e){const t=nS(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}function Qk(e,t,i){i.layerIndex=t;const r=e.layerInfo[Ht.MAP][t];if(r.data)return Li(i.offset,0,0),i.tile=e,i.scale=1,i.sourceLod=e.lij,i.sourceLayerInfo=r,i;const s=r.upsampleInfo;if(s){const n=s.tile.layerInfo[Ht.MAP][t];return i.tile=s.tile,Bn(i.offset,s.offset),i.scale=s.scale,i.sourceLod=s.tile.lij,i.sourceLayerInfo=n,i}return null}const Jk=new Array,Kk={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},yse={offset:[0,0],scale:1},obe=40,vse=20,yot=.8,vot=15,mC=1e-6;function _ot(e,t,i){const r=t,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(r[a]<l){if(s[a]<=mC)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-mC){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(r[a]>l){if(s[a]>=-mC)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=mC){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class _se{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}}class s2{constructor(t,i,r,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=s,this.rayDirection=M(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=r-i,o=n<=abe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=Sot(t,i,r,s.data,s.stride),l=(c,h,p)=>{const f=xot(o,a,c,h),g=h-c;if(g<=vse){const x=new _se(f,void 0,0,c,h);return this.bspNodeTree.push(x),x}const{axis:y,midValue:v}=Tot(f),b=wot(o,a,c,h,y,v),w=(x,E)=>{if(p>vot)return;const R=E-x;return R<vse||R>=yot*g?void 0:l(x,E,p+1)},S=new _se(f,y,v,b.next,b.mid);return this.bspNodeTree.push(S),S.leftNode=w(c,b.next),S.rightNode=w(b.mid,h),S};l(0,n,0),this.triangleVertexIndices=Eot(o,t,i,r)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],l=o[1],c=o[2],h=this.rayDirection,p=h[0],f=h[1],g=h[2];for(let y=t,v=3*t;y<i;++y){const b=r[v]*n,w=s[b],S=s[b+1],x=s[b+2],E=r[v+1]*n,R=s[E],O=s[E+1],I=s[E+2],U=r[v+2]*n,N=s[U],V=s[U+1],j=s[U+2];v+=3;const H=R-w,J=O-S,K=I-x,he=N-w,le=V-S,$=j-x,z=f*$-le*g,k=g*he-$*p,G=p*le-he*f,W=H*z+J*k+K*G;if(Math.abs(W)<=Number.EPSILON)continue;const ee=a-w,q=l-S,te=c-x,Ee=ee*z+q*k+te*G;if(W>0){if(Ee<0||Ee>W)continue}else if(Ee>0||Ee<W)continue;const ve=q*K-J*te,qe=te*H-K*ee,Ce=ee*J-H*q,Re=p*ve+f*qe+g*Ce;if(W>0){if(Re<0||Ee+Re>W)continue}else if(Re>0||Ee+Re<W)continue;const Oe=(he*ve+le*qe+$*Ce)/W;if(Oe>=0){const Ve=this.indices[y]+this.firstTriangleIndex,nr=dW(H,J,K,he,le,$,bot);this.callback(Oe,nr,Ve,!1)}}}s2.numFacesTested+=i-t}intersectRay(t,i){s2.numFacesTested=0;const r=Le(t.r0[0],t.r0[1],t.r0[2]),s=Le(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<mC)return;this.rayOrigin=r;const l=this.rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this.callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,i,r){const s=this.rayOrigin,n=this.rayDirection;if(!_ot(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=i,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=r;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}s2.numFacesTested=0;const bot=M(),Yw=[1/0,1/0,1/0],Zw=[-1/0,-1/0,-1/0];function wot(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=r;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function xot(e,t,i,r){if(r<=i)return ib(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[i];for(let n=0;n<3;++n)Yw[n]=t[s+0+n],Zw[n]=t[s+3+n]}for(let s=i+1;s<r;++s){const n=6*e[s];for(let o=0;o<3;++o)Yw[o]=Math.min(Yw[o],t[n+0+o]),Zw[o]=Math.max(Zw[o],t[n+3+o])}return ib(Yw[0],Yw[1],Yw[2],Zw[0],Zw[1],Zw[2])}function Tot(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function Sot(e,t,i,r,s){const n=i-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const g=r[c+f],y=r[h+f],v=r[p+f];o[6*a+f]=Math.min(g,y,v),o[6*a+3+f]=Math.max(g,y,v)}}return o}function Eot(e,t,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=abe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+i);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const abe=65535;var ld;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(ld||(ld={}));class Aot extends qs{constructor(){super(...arguments),this.overlayOpacity=1}}function bse(e,t){e.fragment.uniforms.add([new et("ovColorTex",F.Pass,i=>i.ovColorTex),new ye("overlayOpacity",F.Pass,i=>i.overlayOpacity)]),lbe(e,t)}function Cot(e,t){e.fragment.uniforms.add([new et("ovColorTex",F.Draw,i=>i.ovColorTex),new ye("overlayOpacity",F.Draw,i=>i.overlayOpacity)]),lbe(e,t)}function lbe(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==Mt.Water&&t.pbrMode!==Mt.WaterOnIntegratedMesh||e.include(a_e,t);const{vertex:i,fragment:r}=e;e.varyings.add("vtcOverlay","vec4"),i.uniforms.add([new dt("overlayTexOffset"),new dt("overlayTexScale")]),i.code.add(T`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(T`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(T`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==Mt.Water&&t.pbrMode!==Mt.WaterOnIntegratedMesh||(r.uniforms.add([new ke("lightingMainDirection",F.Pass,(s,n)=>n.lighting.lightingMainDirection),new ke("lightingMainIntensity",F.Pass,(s,n)=>n.lighting.mainLight.intensity)]),r.code.add(T`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Rot(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(T`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function Oot(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new dt("texOffsetAndScale")),e.fragment.uniforms.add(new et("tex")),e.fragment.uniforms.add(new ke("textureOpacities"));const i=t.textureFadingEnabled&&!t.renderOccluded;i&&(e.vertex.uniforms.add(new dt("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new et("texNext")),e.fragment.uniforms.add(new ke("nextTexOpacities")),e.fragment.uniforms.add(new ye("fadeFactor"))),e.vertex.code.add(T`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${i?T`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:T``}
  }`),t.useGrid?(e.fragment.code.add(T`float lineFactorAtPosition(float value) {
float pos = value * 129.0;
if(pos < 0.5 || pos > 128.5) {
return 1.0;
}
pos = pos + 0.5;
float modulo = mod(pos, 16.0);
return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
}
float lineFactorAtUV(vec2 uv) {
return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
}
float lineFactor(vec2 uv) {
vec2 offset = fwidth(uv) * 0.25;
return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
}
vec4 gridColor(vec2 uv) {
float line = lineFactor(uv) * 0.1 + 0.9;
float backgroundOpacity = textureOpacities.y;
return vec4(1.0, 0.972, 0.918, 1.0) * line * backgroundOpacity;
}`),e.fragment.code.add(T`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
vec4 grid = gridColor(uv);
float alpha = opacities.z * color.a;
return mix(grid, color, alpha) * opacities.x;
}`)):t.hasBackgroundColor?(e.fragment.uniforms.add(new ke("backgroundColor")),e.fragment.code.add(T`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
if (opacities.y <= 0.0) {
return color * opacities.z * opacities.x;
}
float alpha = opacities.z * color.a;
float backgroundOpacity = opacities.y;
return mix(vec4(backgroundColor, 1.0) * backgroundOpacity, color, alpha) * opacities.x;
}`)):e.fragment.code.add(T`vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
return color;
}`),i?e.fragment.code.add(T`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(T`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class cbe extends Aot{}function Mot(e){const t=new Fi;t.include(R_e,{name:"Terrain Shader",output:e.output}),t.attributes.add(A.POSITION,"vec3"),t.attributes.add(A.UV0,"vec2");const{vertex:i,fragment:r}=t;if(i.uniforms.add(new li("proj",F.Pass,(s,n)=>n.camera.projectionMatrix)),i.uniforms.add(new li("view")),i.uniforms.add(new ke("origin")),r.uniforms.add(new ke("origin")),e.output===Q.Color){t.include(ao),t.include(v0,e),t.include(Oot,e),t.include(Ib,e);const s=e.overlayMode!==ld.Disabled,n=e.overlayMode===ld.EnabledWithWater;s&&t.include(bse,ge(L({},e),{pbrMode:Mt.Water})),n&&t.include(Rot,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&i.uniforms.add(new li("viewNormal",F.Pass,(a,l)=>l.camera.viewInverseTransposeMatrix));const o=e.receiveShadows&&!e.renderOccluded;o&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(i.uniforms.add(new ke("lightingMainDirection",F.Pass,(a,l)=>l.lighting.lightingMainDirection)),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(i.uniforms.add(new dt("screenSizePerspective")),t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),i.code.add(T`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        ${e.atmosphere?T`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?T`vuv = uv;`:""}
        ${e.screenSizePerspective?T`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${o?T`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${s?T`setOverlayVTC(uv);`:""}
        ${n?T`forwardVertexTangent(vnormal);`:T``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(es,e),t.include(Ib,e),t.include(yM,e),t.include(Pb,e),r.uniforms.add([new ke("cameraPosition"),new ke("viewDirection"),new ye("lightingGlobalFactor",F.Pass,(a,l)=>l.lighting.globalFactor),new ke("lightingMainDirection",F.Pass,(a,l)=>l.lighting.lightingMainDirection),new ke("lightingMainIntensity",F.Pass,(a,l)=>l.lighting.mainLight.intensity)]),r.constants.add("ambientBoostFactor","float",$2),e.screenSizePerspective&&r.uniforms.add(new dt("screenSizePerspective")),n&&(r.uniforms.add(new et("ovWaterTex",F.Pass,a=>a.ovWaterTex)),r.uniforms.add(new li("view"))),r.code.add(T`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),r.code.add(T`
      void main() {
        ${o?T`float shadow = readShadowMap(vpos, linearDepth);`:T`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${s?T`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?T`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?T`atm + tileColor.rgb;`:T`tileColor.rgb;`}
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${n?T`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?T`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?T`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==Q.Depth&&e.output!==Q.Shadow||(t.include(ao,{hasModelTransformation:!1,linearDepth:!0}),t.include(dv,{output:e.output}),t.include(v0,e),t.varyings.add("linearDepth","float"),i.uniforms.add(new Ft("nearFar",F.Pass,(s,n)=>n.camera.nearFar)),i.code.add(T`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vec3 vpos = position;
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
}`),r.code.add(T`void main() {
outputDepth(linearDepth);
}`)),e.output===Q.Normal&&(t.include(ao),t.include(v0,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),i.uniforms.add(new li("viewNormal",F.Pass,(s,n)=>n.camera.viewInverseTransposeMatrix)),i.code.add(T`void main(void) {
vec3 normal = getLocalUp(position, origin);
vec2 uv = uv0;
vpos = position;
gl_Position = transformPosition(proj, view, vpos);
vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
}`),r.code.add(T`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===Q.Highlight&&(t.include(ao),t.include(v0,e),t.include(bse,e),i.code.add(T`void main() {
vec3 vnormal = getLocalUp(position, origin);
vec2 uv = uv0;
setOverlayVTC(uv);
gl_Position = transformPosition(proj, view, position);
}`),t.include(xg),r.code.add(T`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const Pot=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:cbe,build:Mot},Symbol.toStringTag,{value:"Module"}));class p5 extends Ki{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,i){i.spherical=t.viewingMode===je.Global}initializeProgram(t){const i=p5.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Ut({blending:i.renderOccluded?ah(Me.ONE,Me.ONE_MINUS_SRC_ALPHA):null,culling:r&&mq,depthTest:!i.renderOccluded&&{func:Ji.LESS},depthWrite:!i.renderOccluded&&ol,colorWrite:Qt,stencilTest:t?cYe(Za.IntegratedMeshMaskExcluded):null})}getPipelineState(t,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,i)}}p5.shader=new Vi(Pot,()=>import("./Terrain.glsl.3ddf12c3.js"));class ps extends Io{constructor(){super(...arguments),this.output=Q.Color,this.overlayMode=ld.Disabled,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.hasBackgroundColor=!1,this.useGrid=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1}}u([B({count:Q.COUNT})],ps.prototype,"output",void 0),u([B({count:ld.COUNT})],ps.prototype,"overlayMode",void 0),u([B()],ps.prototype,"spherical",void 0),u([B()],ps.prototype,"atmosphere",void 0),u([B()],ps.prototype,"receiveShadows",void 0),u([B()],ps.prototype,"hasSlicePlane",void 0),u([B()],ps.prototype,"backfaceCullingEnabled",void 0),u([B()],ps.prototype,"stencilEnabled",void 0),u([B()],ps.prototype,"textureFadingEnabled",void 0),u([B()],ps.prototype,"hasBackgroundColor",void 0),u([B()],ps.prototype,"useGrid",void 0),u([B()],ps.prototype,"renderOccluded",void 0),u([B()],ps.prototype,"hasScreenSpaceReflections",void 0),u([B()],ps.prototype,"tileBorders",void 0),u([B()],ps.prototype,"screenSizePerspective",void 0),u([B()],ps.prototype,"receiveAmbientOcclusion",void 0),u([B({constValue:!0})],ps.prototype,"isGround",void 0),u([B({constValue:Mt.Disabled})],ps.prototype,"pbrMode",void 0),u([B({constValue:!1})],ps.prototype,"highStepCount",void 0),u([B({constValue:!1})],ps.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],ps.prototype,"useFillLights",void 0),u([B({constValue:ue("enable-feature:clouds-reflections")})],ps.prototype,"hasCloudsReflections",void 0);const e6=7,Iot=10,t6=Rs(),tI=ii();let ta=class extends be{constructor(e){super(e),this.type=Rr.TERRAIN,this.isGround=!0,this.tileSize=256,this._passParameters=new cbe,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new Ent,this.renderDataPool=new as(Tnt),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new W1e,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this.castShadows=!0,this._ssrEnabled=!1,this.emptyTex=null,this.tileRenderer=null,this.tileBackgroundInitialized=!1,this.tileBackgroundUpdating=!1,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=wr.Occlude}get isGlobal(){return this.stage.viewingMode===je.Global}initialize(){const e=[we.OPAQUE_TERRAIN,we.TRANSPARENT_TERRAIN,we.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),Ist()}get updating(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}get canRender(){return this.visible&&!!this._rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return c1}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?pN:wr.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,this.tileRenderer&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,Et.TEXTURE_FADING)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(e,t===Et.TEXTURE_FADING?Fn.FADING:Fn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[Ht.ELEVATION])t.pendingUpdates&=~Et.GEOMETRY;e.resetPendingUpdate(Et.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=Iot-e6,i=Math.max(0,Math.floor((e.level-t)/e6)*e6);if(this.isGlobal&&i===0)return pa;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{t.isLoaded&&(this.updateTileGeometry(t),t.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(e=bs.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}setTileBackground(e){this.tileBackground=e,this._updateTileBackground()}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this._techniqueConfiguration=new ps,this.tileRenderer=new mot(this.rctx,this.tileSize,this._techniqueRepository),this.tileBackground&&this._updateTileBackground(),this.emptyTex=Tge(this.rctx)}uninitializeRenderContext(){this.emptyTex!=null&&(this.emptyTex.dispose(),this.emptyTex=null),this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=Dot,n=Lot;de(s,r,i),se(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===zn.MIN,h=!!e.results.ground.target,p=mGe(e.verticalOffset),f=e.tolerance;let g,y=c&&_(o.dist)?o.dist:1/0;const v=w=>{const S=w.renderData;if(S==null||!S.vao)return;const x=S.geometryInfo;oF(t6,x.boundingBox);const E=S.localOrigin;_(p)&&(p.localOrigin=E,p.applyToAabb(t6));const R=t6;if(Qw[0]=i[0]-E[0],Qw[1]=i[1]-E[1],Qw[2]=i[2]-E[2],!fW(R,Qw,n,f,y))return;const O=(J,K,he)=>{J.set(this.type,w,K,he,Es),y=c&&_(o.dist)?o.dist:1/0},I=(J,K)=>{if(_(K)&&J>=0&&(e.options.backfacesTerrain||Se(K,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(i,r,J))){if((l.dist==null||J<l.dist)&&O(l,J,K),e.options.isFiltered)return;e.options.store===zn.ALL&&(C(g)?(g=jq(e.ray),O(g,J,K),e.results.all.push(g)):J<g.dist&&O(g,J,K)),(o.dist==null||J<o.dist)&&O(o,J,K),e.options.store!==zn.MIN&&(a.dist==null||J>a.dist)&&O(a,J,K)}},U=Not;de(U,r,E);const N=x.indices,V=x.vertexAttributes,j={data:V.getField(A.POSITION,pi).typedBuffer,size:3,stride:V.stride/4},H=x.indexCount/3;if(C(p)&&H>obe){const J=w.renderData;C(J.intersectionData)&&(J.intersectionData=new s2(N,0,H,j)),J.intersectionData.intersectRay({r0:Qw,r1:U},I)}else lM(Qw,U,0,H,N,j,null,p,I)},b=this._rootTiles;_(b)&&(()=>{const w=this.tileIterator;w.reset(b);const S=e.options.invisibleTerrain;for(;!w.done;){const x=w.next();!(x.visible||S&&x.intersectsClippingArea)||!_(p)&&!x.intersectsRay(i,s,f,y)||h&&this._useStencilForTile(x)?w.skipSubtree():v(x)}})()}prepareTechnique(e){if(e.bindParameters.slot===we.OCCLUDED_TERRAIN){if((e.renderOccludedMask&pN)==0)return null}else{const t=this.opaque?we.OPAQUE_TERRAIN:we.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case Ue.MATERIAL:{this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?ld.Disabled:this.overlayRenderer.hasWater?ld.EnabledWithWater:ld.Enabled;const t=e.bindParameters.slot===we.OCCLUDED_TERRAIN?Ao.Occluded:Ao.ColorAndWater;return this._updateTechnique(Q.Color,t===Ao.Occluded)}case Ue.MATERIAL_DEPTH_SHADOWMAP_ALL:case Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this.castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Q.Shadow,!1)):null;case Ue.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Q.Depth,!1));case Ue.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Q.Normal,!1);case Ue.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Q.Highlight,!1)):null}return null}render(e,t){const i=e.pass,r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,i){case Ue.MATERIAL:{const s=e.bindParameters.slot===we.OCCLUDED_TERRAIN?Ao.Occluded:Ao.ColorAndWater;this._renderMaterialPass(e,t,s);break}case Ue.MATERIAL_DEPTH_SHADOWMAP_ALL:case Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this.castShadows&&r&&this._renderAuxiliaryPass(e,t,Ao.None);break;case Ue.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,Ao.None);break;case Ue.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,Ao.None);break;case Ue.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,Ao.Highlight),e.rctx.clearSafe(ki.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._updatePassParameters(i),this._ssrEnabled=e.bindParameters.ssr.enabled;const s=r.bindTechnique(t,this._passParameters,e.bindParameters),n=e.bindParameters.camera.viewMatrix;se(iI,n[12],n[13],n[14]),Te(iI,iI),s.setUniform3fv("viewDirection",iI),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._updatePassParameters(i);const s=r.bindTechnique(t,this._passParameters,e.bindParameters),n=e.bindParameters.camera;e.pass!==Ue.MATERIAL_DEPTH&&e.pass!==Ue.MATERIAL_DEPTH_SHADOWMAP_ALL&&e.pass!==Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||s.setUniform2fv("nearFar",n.nearFar),this._renderPatchGroupsAuxiliary(e,t,i)}_updateTileBackground(){if(!this.tileRenderer)return;this.tileBackgroundUpdating=!0;const e=()=>{this.tileBackgroundInitialized=!0,this.tileBackgroundUpdating=!1,this._techniqueConfiguration.useGrid=this.tileRenderer.backgroundIsGrid,this._techniqueConfiguration.hasBackgroundColor=!this.tileRenderer.backgroundIsGrid&&_(this.tileRenderer.backgroundColor),this.allTiles.forAll(t=>this.tileRenderer.updateTileTexture(t,Fn.FADING)),this.setNeedsRender()};if(typeof this.tileBackground=="string"){const t=this.tileBackground;ch(t).then(i=>{t===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(i,this.tileBackground===Dme),e())})}else{const t=this.tileBackground?rt.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(t,!1),e()}}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==xO.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>X1e(this.renderOrder,t)),e.sort((t,i)=>Y1e(t[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){const e=this._rootTiles;if(!C(e)){e[0].surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const t of e)this._rebuildPatchGroupsForRootTile(t)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const i=t.next(),r=i.renderData;if(!r||i.visible)if(i.rendered){if(r){const s=this._patchGroups.get(r.localOrigin)||new Array;this._patchGroups.set(r.localOrigin,s),s.push(i),(!this.highestVisibleLODTile||i.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=i),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){const r=e.bindParameters.camera;t.program.setUniformMatrix4fv("proj",r.projectionMatrix);const s=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(n=>{const o=n[0].renderData.localOrigin;this._bindPatchGroupData(t.program,o,e.bindParameters);for(let a=0;a<n.length;a++)this._renderPatch(e,t,n[a],Dt.TRIANGLES,s,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.rctx,s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=v0e(this.stage.viewingMode,this.ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this.stencilEnabledLayerExtents.length>0,a=i===Ao.Occluded;a&&(n.bindTexture("tex",this.emptyTex),n.setUniform1f("blend",1),n.setUniform4fv("texOffsetAndScale",Vm));const l=_(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:pa;this._techniqueConfiguration.hasBackgroundColor&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Dt.LINES:Dt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(h=>{const p=h[0].renderData.localOrigin;this._bindPatchGroupData(n,p,e.bindParameters),this.numOriginsRendered++;for(let f=0;f<h.length;f++){const g=h[f],y=g.renderData.textureReference;if(!C(y)){if(!a){this._scaleRangeQueries.scaleQueriesForTile(g),wse(g.renderData.geometryInfo.uvOffsetAndScale,y.offsetAndScale,tI),n.setUniform4fv("texOffsetAndScale",tI),n.bindTexture("tex",y.texture.texture);const v=g.renderData.textureFadeFactor,b=v<1?g.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&_(b)&&v<1?(wse(g.renderData.geometryInfo.uvOffsetAndScale,b.offsetAndScale,tI),n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",tI),n.setUniform3fv("nextTexOpacities",b.opacities),n.bindTexture("texNext",b.texture.texture)):n.setUniform1f("fadeFactor",1),g.renderData.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,t,g,c,o,i),g.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),r.bindVAO(null)}_renderPatch(e,t,i,r,s,n){const o=i.renderData,a=o.vao,l=a.indexBuffer;if(C(l))return;const c=t.program;n!==Ao.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,h,l.indexType,0)}_bindPatchGroupData(e,t,i){e.bindDraw(new r_e(t),i),e.setUniform3fv("origin",t),ga(xse,i.camera.viewMatrix,t),e.setUniformMatrix4fv("view",xse);const r=i.camera.eye;e.setUniform3f("cameraPosition",r[0]-t[0],r[1]-t[1],r[2]-t[2])}_updatePassParameters(e){if(this._passParameters.ovColorTex=this._passParameters.ovWaterTex=null,this._techniqueConfiguration.overlayMode===ld.Disabled||e===Ao.None)return;const t=this.overlayRenderer.overlays;if(t.length>gs.INNER){const i=t[gs.INNER];this._passParameters.ovColorTex=i.getColorTexture(e),this._techniqueConfiguration.overlayMode===ld.EnabledWithWater&&(this._passParameters.ovWaterTex=i.getNormalTexture(e))}}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===Q.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground,this._techniqueConfiguration.hasScreenSpaceReflections=this._ssrEnabled),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(p5,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};u([d()],ta.prototype,"tileBackgroundInitialized",void 0),u([d()],ta.prototype,"tileBackgroundUpdating",void 0),u([d({constructOnly:!0})],ta.prototype,"overlayRenderer",void 0),u([d({constructOnly:!0})],ta.prototype,"stage",void 0),u([d({readOnly:!0})],ta.prototype,"isGlobal",null),u([d({constructOnly:!0})],ta.prototype,"allTiles",void 0),u([d({constructOnly:!0})],ta.prototype,"ellipsoidRadius",void 0),u([d({readOnly:!0})],ta.prototype,"updating",null),u([d({value:!1})],ta.prototype,"renderingDisabled",null),u([d()],ta.prototype,"renderPatchBorders",null),u([d()],ta.prototype,"cullBackFaces",null),u([d({value:xO.FRONT_TO_BACK})],ta.prototype,"renderOrder",null),u([d()],ta.prototype,"wireframe",null),ta=u([P("esri.views.3d.terrain.TerrainRenderer")],ta);const $ot=ta;function wse(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3]}const xse=Ae(),iI=M(),Dot=M(),Lot=M(),Qw=M(),Not=M();class Fot{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let wp=class extends be{constructor(e){super(e),this._handles=new Jt}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(xe(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=ct(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!NC(t)||t.isRejected())&&!(t.isFulfilled()&&!Uot(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||EN(t)))),e)if(e.isResolved()){const t=l5(e,this.viewSpatialReference,this.viewingMode);if(_(t)){const i=new br(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===je.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=br.makeWebMercatorAuxiliarySphere(t):hb(e.spatialReference)&&(e=br.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(xe(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===je.Global){const e=this.extentHelper.viewSpatialReference,t=hb(e)||pf(e)||ff(e);e.isWebMercator?this.tilingScheme=br.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=br.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;_(e)&&!I1(e,this.extent)&&(this.tilingScheme=br.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Uot(e,t,i){return _(l5(e,t,i))}u([d()],wp.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],wp.prototype,"extent",void 0),u([d({value:!1})],wp.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],wp.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],wp.prototype,"layers",void 0),u([d({constructOnly:!0})],wp.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],wp.prototype,"viewingMode",void 0),wp=u([P("esri.views.3d.terrain.TilingSchemeLogic")],wp);class zot{constructor(){this.offset=lt(),this.scale=0,this.tile=null}init(t,i,r,s){this.tile=t,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const Ah=pe.getLogger("esri.views.3d.terrain.TerrainSurface"),kot=.25;let Xt=class extends qr.EventedMixin(be){constructor(e){var t,i;super(e),this._elevationBounds=new nX,this._iteratorPool=new as(W1e,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new Dst,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=YE,this._performanceInfo=new Fot,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=M(),this._eyePosSurfaceSR=M(),this._splitLimits=new lnt,this._snapLevel=1/0,this._frustum=sO(),this._viewProjectionMatrix=Ae(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Jt,this._watchUpdatingTracking=new jp,this._frameTask=$S,this._allTiles=new Vt,this._upsampleInfoPool=new as(zot),this._rootTilesExtent=Gt(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundImage=Dme,this.backgroundColor=null,this._updatingRootTiles=!1,this._layerViewsDirty=!1,this._isGlobal=!((t=e.view)!=null&&(i=t.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=U1e(this.view.resourceController),this._tilePool=this.view.state.isLocal?new as(bnt):new as(wnt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new est(e.newCache("elevation-query")),this._set("overlayManager",new Da({surface:this})),this._handles.add([xe(()=>this.overlayManager.hasHighlights,s=>this._renderer.setNeedsHighlight(s)),xe(()=>this.overlayManager.rendersOccluded,s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new $ot({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:Ci(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([xe(()=>this.baseOpacity,s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},xs),xe(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),Qr),xe(()=>this._background,()=>{this._handleLayerViewChanges(),this._renderer.setTileBackground(this._background)},xs),xe(()=>this.view.pointsOfInterest,s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),xe(()=>Ni.TERRAIN_TILE_TREE_SHOW_TILES,s=>{s&&!this._treeDebugger?import("./TerrainTileTree3DDebugger.a44228bc.js").then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&Ni.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=ct(this._treeDebugger))},Bi)]),this._extentHelper=wst(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new IS({getCollections:()=>{var s,n,o;return(s=this.view)==null||(n=s.defaultsFromMap)==null||(o=n.mapCollections)==null?void 0:o.map(({layers:a})=>a)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}):this.view.map.allLayers,i=new wp({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(zp.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(zp.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(yt.TERRAIN_SURFACE,this),this._handles.add([xe(()=>this._extentHelper.stencilEnabledExtents,s=>this._renderer.setStencilEnabledLayerExtents(s),Bi),xe(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Qr),xe(()=>this.extent,()=>this._updateRootTiles(),Bi),this.view.on("resize",()=>this._viewChangeUpdate()),xe(()=>{var s,n;const o=this.view,a=o.state;return[this.lodBias,this.lodSnapping,(s=o.resourceController)==null||(n=s.memoryController)==null?void 0:n.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),xs),xe(()=>{var s,n;return(s=this.view.qualitySettings)==null||(n=s.tiledSurface)==null?void 0:n.textureFadeDuration},s=>this._renderer.textureFadingEnabled=s>0,Bi),xe(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Qr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=$i(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=ct(this._upsampleMapCache),this._elevationQueryCache=ct(this._elevationQueryCache),this._set("tilingSchemeLogic",ct(this.tilingSchemeLogic)),this._extentHelper=ct(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",ct(this.overlayManager)),this._tilePool=ct(this._tilePool),cX.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=ct(this._renderer),this._iteratorPool=ct(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=ct(this._upsampleInfoPool),fst(),ont()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,t;const i=(e=this.view.pointsOfInterest)==null||(t=e.contentCameraOnSurface)==null?void 0:t.scale;if(i){const r=this.view.state.contentCamera;let s=d4(this.view,r.eye,r.viewForward,r.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,o=n0e(this.view,i)-n;Math.abs(this._snapLevel-o)>kot&&(Math.round(o)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=o)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?e2.ON:e2.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(C(t)||C(e))return null;const i=Gt(),r=x1e(t,i,e)?i:null,s=this._get("extent");return I1(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=GI(this.groundExtent,this._userClippingExtent,Gt()),t=this._get("extent");return I1(e,t)?t:e}get groundExtent(){return _(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._renderer.updating||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return _(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(e=(t=this.tilingScheme)==null?void 0:t.spatialReference)!=null?e:null}get _background(){return this.backgroundColor!=null?this.backgroundColor:this.backgroundImage}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){var e,t;const i=!this.renderingDisabled&&!this.opaque;(e=this.view)==null||(t=e._stage)==null||t.renderView.setRenderParameters({transparentTerrain:i})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,Ch);return C(s)?null:G1e(Ch[0],Ch[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=Ch){var n;const o=this.rootTiles;if(C(o)||!o.length||o[0].layerInfo[Ht.ELEVATION].length===0)return null;if(s[0]=e,s[1]=t,s[2]=i,!kn(s,r,s,(n=this.tilingScheme)==null?void 0:n.spatialReference))return Ah.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let a of o){if(!a.containsPoint(s))continue;for(;a&&!a.rendered&&!a.isLeaf;){let c=0;s[0]>.5*(a.extent[0]+a.extent[2])&&(c+=1),s[1]<.5*(a.extent[1]+a.extent[3])&&(c+=2),a=a.children[c]}const l=a.renderData;return l&&l.geometryState.samplerData?a:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!Mr(e,Ch,this.spatialReference))return Ah.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(_(t)){for(let i of t)if(i.containsPoint(Ch)){for(;i.children[0]!=null;){let r=0;Ch[0]>i.children[0].extent[2]&&(r+=1),Ch[1]<i.children[0].extent[1]&&(r+=2),i=i.children[r]}return this._getLodBiasCorrectedScale(i.level)}}}return 1e100}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!Mr(e,Ch,this.spatialReference))return Ah.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Ch[3]=t;let i=null;const r=n=>{if(n&&xEe(n.extent,Ch))if(n.children[0]!=null)for(const o of n.children)r(o);else{const o=this._getLodBiasCorrectedScale(n.level);i=i==null?o:Math.min(i,o)}},s=this.rootTiles;if(_(s))for(const n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1,this._renderer.isTransparent=this._allTransparentSurfaceLayers();const i=t!==this._renderer.opaque;i&&this._updateTransparentTerrain(),this._updateTileTextures(i?Fn.UNFADED:Fn.IMMEDIATE)}_updateTilingScheme(){const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(Kh(!!e,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return rI[0]=e,rI[1]=t,rI[2]=i,s.init(rI,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=Got;let r=t.rootTilesInExtent(e,i,5*aT);if(_(this.rootTiles)){if(r.length>aT)return void Ah.warn(Lke);const s=this.rootTiles.map(o=>o.lij),n=Lwe(s,r,Tse);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this.rootTiles.filter(a=>!(n.removed.findIndex(l=>Tse(l,a.lij))>-1)||(this._purgeTile(a,!0),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>aT&&(Ah.warn(Nke),r=t.rootTilesInExtent(e,i,aT)),this._setRootTiles(r.map(s=>this._newRootTile(s)));I1(i,this._rootTilesExtent)||(this._rootTilesExtent=Gt(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(s=>{s.isLoaded&&this._prepareToLoadTile(s)}),this._allTiles.forAll(s=>{s.isLoaded&&(this._updateTileGeometry(s),s.updateNeighborsAfterGeometryChange())}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===Et.SPLIT&&t.setPendingUpdate(Et.SPLIT),this._loadTile(t),t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),_(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(Et.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(C(e))return;const t=Fst(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(Et.GEOMETRY)&&this._updateTileGeometry(l),l.setPendingUpdate(Et.RENDERDATA);const c=l.computeVisibility();s||c?(l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),r=Math.max(l.elevationBounds[1],r))):a.skipSubtree()}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(C(this._splitLimits.frustum)&&(this._splitLimits.frustum=sO()),VL(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,VL(this._frustum,e.frustum),xr(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),ne(this._eyePosRenderSR,t.eye),kn(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(ube(e)?(this._loadChildren(e),this._checkTileNeighborsWaterproofness(e),e.children.forEach(t=>t.checkGeometryWaterproofness())):Vot(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),e.updateNeighborsAfterGeometryChange(),this._elevationUpdate(e),this._usedMemory=YE}_updateTileTexture(e,t){const i=e.resetPendingUpdate(Et.TEXTURE_FADING)?Et.TEXTURE_FADING:!!e.resetPendingUpdate(Et.TEXTURE_NOFADING)&&Et.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=YE,t.madeProgress())}_elevationUpdate(e){sI.spatialReference=this.spatialReference,sI.tile=e,sI.extent=e.extent,this.emit("elevation-change",sI)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const i=t.next();if(i.loadable){const r=i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(r===Et.SPLIT){i.resetPendingUpdate(Et.MERGE),i.isLeaf&&(i.setPendingUpdate(Et.SPLIT),t.skipSubtree());continue}i.resetPendingUpdate(Et.SPLIT)&&i.updateAgentSuspension(),r===Et.VSPLITMERGE&&i.updateAgents(Ht.ELEVATION)}if(t.skipSubtree(),!i.isLeaf){i.setPendingUpdate(Et.MERGE),i.resetPendingUpdate(Et.SPLIT);const r=this._iteratorPool.acquire();r.resetOne(i);for(let s=r.next();!r.done;s=r.next())this._updateClippingStatus(s),s.updateVisibility(),s.loadable&&s.updateScreenDepth(this._viewProjectionMatrix);r.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(Lst(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=0;for(;!e.done;){let r=!1;i=0;const s=!this._allTiles.some(n=>{if(i+=n.usedMemory,n.resetPendingUpdate(Et.MERGE)){if(!t)return n.setPendingUpdate(Et.MERGE),e.done;this._mergeTile(n),r=!0,e.madeProgress()}else n.resetPendingUpdate(Et.SPLIT)&&(this._splitTile(n),r=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(Et.RENDERDATA)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(this._usedMemory=i,!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}i===0&&(this._allTilesDirty=!0),this._sortTiles(e)}_updateElevation(e){return this._allTiles.some(t=>(t.resetPendingUpdate(Et.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(bs.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*Ike}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=He(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){_(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&e.updateNeighborsAfterGeometryChange(),this._tilePool.release(e),i}_unloadTile(e){e.unload(this._renderer)}_splitTile(e){Kh(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(Et.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){nI.spatialReference=this.spatialReference,nI.extent=e.extent,nI.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",nI)}_createTile(e,t,i,r){Kh(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===Et.SPLIT&&s.setPendingUpdate(Et.SPLIT)),s}_mergeTile(e){Kh(!e.hasPendingUpdate(Et.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Kh(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),e.updateNeighborsAfterGeometryChange(),this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){}_loadChildren(e){this._checkTileAndNeighborsWaterproofness(e),Kh(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(i=>this._prepareToLoadTile(i)),t.forEach(i=>this._loadTilePrepared(i)),e.updateNeighborsAfterGeometryChange(e.level+1),t.forEach(i=>i.updateNeighborsWithChangedEdgeResolution()),t.forEach(i=>i.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(e)}_loadParent(e){this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),t.updateNeighborsAfterGeometryChange(),this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const i=e.children[t];this._unloadChildren(i),this._unloadTile(i)}}_postLoadTile(e){e.setPendingUpdate(Et.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,i){const r=new bst(e.lij,e.extent,i);e.dataArrived(t,Ht.ELEVATION,r);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=P2){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),jT(s))if(this._basemapLayerViewHandles.has(s.uid)){const n=this._layerClassFromLayerView(s),o=this._layerIndexByUid[n].get(s.uid);o<r&&(t=!0),r=o}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allTransparentSurfaceLayers(),e.madeProgress()}_allTransparentSurfaceLayers(){var e,t;let i=((e=this.view.map)==null||(t=e.ground)==null?void 0:t.opacity)===0;for(const r of this.view.allLayerViews.items)if(jT(r)&&!rD(r)&&!bhe(r.layer)&&r.fullOpacity!==0)return i=!1,i;return i}_layerClassFromLayerView(e){return rD(e)?Ht.ELEVATION:Ht.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push(xe(()=>e.suspended,()=>this._updateTiledLayers())),t.push(xe(()=>e.fullOpacity,()=>this._updateTileTextures(Fn.UNFADED))),t.push(xe(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),e.on("data-changed",()=>{const r=this._layerIndexByUid[i].get(e.uid);r!=null&&this._invalidateLayerData(r,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let i=0;i<t.length;i++)t[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;const r=nh();e.forEach(s=>{const n=s.layer;if(!n||s.suspended||!jT(s))return;const o=s.fullExtent;if(!o)return void Ah.warn("Terrain: Map or elevation layer does not have fullExtent: "+n.id);S0(r,o,r);const a=this._layerClassFromLayerView(s);if(a===Ht.MAP){const l=s.displayLevelRange;l.maxLevel!==1/0&&(i===null||l.maxLevel>i)&&(i=l.maxLevel)}t[a].push(s)});for(const s of j_){const n=this._layerViews[s],o=t[s];o.reverse();const a=o.length;let l=n.length!==a;const c=new Array(a),h=new Array(n.length);this._layerIndexByUid[s].clear();for(let p=0;p<a;p++){const f=o[p].uid;this._layerIndexByUid[s].set(f,p);const g=n.indexOf(o[p]);c[p]=g,p!==g&&(l=!0),g>-1&&(h[g]=p)}if(l){const p=this._postorderIterator;for(p.reset(this.rootTiles);!p.done;)p.next().modifyLayers(h,c,s);this._layerViews[s]=o,this._restartAllAgents(s),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===Ht.ELEVATION&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(Ht.MAP),e===Fn.IMMEDIATE?this.renderer.updateTileTexture(t,Et.TEXTURE_NOFADING):t.updateRenderData(Ht.MAP,e)}),this._renderer.isTransparent=this._allTransparentSurfaceLayers()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=bs.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||AN(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],ge(L({},r),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Tr(o)||this._dataMissing(e,i,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){return t===Ht.ELEVATION?this._requestElevationTileData(e,i,r):this._requestMapTileData(e,i,r)}_requestElevationTileData(e,t,i){if(!rD(t))return void Kh(!1,"_requestElevationTileData can only be called for elevation layer views");const r=o=>{if(--this._asyncWorkItems,Ts(i))return;const a=this._layerIndexByUid[Ht.ELEVATION].get(t.uid);a!=null?(this._usedMemory=YE,this.requestUpdate(),this._elevationDataArrived(e,a,o)):Ah.warn("TerrainSurface: received data from unknown layer %d %s",Ht.ELEVATION,e.lij.toString())},s=o=>{--this._asyncWorkItems,Tr(o)||(this._dataMissing(e,Ht.ELEVATION,t,o),this.requestUpdate())};if(++this._asyncWorkItems,Wre(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:FR,signal:i.signal}).then(o=>{if(Ts(i))return Ah.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void s(gi());this._frameTask.schedule(()=>r(o),i.signal,s)},s);const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:FR},i.signal)).then(o=>{r({values:o.pixelData,width:o.width,height:o.height,noDataValue:o.noDataValue,minValue:o.minValue,maxValue:o.maxValue})},s)}_requestMapTileData(e,t,i){if(t instanceof V1e)return Promise.reject();++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,HT(h),Ts(i)||(this._dataMissing(e,Ht.MAP,t,c),this.requestUpdate())},s=c=>h=>r(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Ts(i)?HT(c):this._mapTileDataArrived(e,t,c)},i.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(AN(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],i).then(n,o)}if(sX(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,o);if(N1e(t)&&Wre(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(c=>{if(Ts(i))return Ah.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(gi());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);vUe(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(n,o)}_mapTileDataArrived(e,t,i){const r=this._layerIndexByUid[Ht.MAP].get(t.uid);r!=null?e.dataArrived(r,Ht.MAP,i):(HT(i),Ah.warn("TerrainSurface: received data from unknown layer"))}_dataMissing(e,t,i,r){const s=this._layerIndexByUid[t].get(i.uid);s!=null?e.dataMissing(s,t,r):Ah.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(this._usedMemory===YE&&(this._usedMemory=0,this._allTiles.forAll(e=>this._usedMemory+=e.usedMemory)),this._usedMemory):0}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._layerIndexByUid[i].get(e.uid);return this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(C(e)||C(this.rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this.rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this.rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return Kh(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{_(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){i6.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&i6.push(i)});const t=i6.toArray();return X1e(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){}get isGlobal(){return this._isGlobal}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}};u([d()],Xt.prototype,"_renderer",void 0),u([d()],Xt.prototype,"_hasPendingUpdates",void 0),u([d()],Xt.prototype,"_asyncWorkItems",void 0),u([d()],Xt.prototype,"_allTilesDirty",void 0),u([d()],Xt.prototype,"_allTilesSorted",void 0),u([d()],Xt.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],Xt.prototype,"_watchUpdatingTracking",void 0),u([d()],Xt.prototype,"_frameTask",void 0),u([d({readOnly:!0})],Xt.prototype,"snapLevel",null),u([d({readOnly:!0})],Xt.prototype,"lodSnapping",null),u([d({constructOnly:!0})],Xt.prototype,"view",void 0),u([d()],Xt.prototype,"_userClippingExtent",null),u([d()],Xt.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],Xt.prototype,"extent",null),u([d({readOnly:!0})],Xt.prototype,"groundExtent",null),u([d({readOnly:!0})],Xt.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],Xt.prototype,"updating",null),u([d(B1e)],Xt.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],Xt.prototype,"updatingProgressValue",null),u([d()],Xt.prototype,"_maxNumUpdating",void 0),u([d({aliasOf:"view.map.ground.opacity"})],Xt.prototype,"baseOpacity",void 0),u([d({readOnly:!0})],Xt.prototype,"overlayManager",void 0),u([d({readOnly:!0})],Xt.prototype,"viewingMode",null),u([d()],Xt.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],Xt.prototype,"ready",null),u([d({value:xO.FRONT_TO_BACK})],Xt.prototype,"renderOrder",null),u([d({readOnly:!0})],Xt.prototype,"rootTiles",void 0),u([d({readOnly:!0})],Xt.prototype,"spatialReference",null),u([d()],Xt.prototype,"backgroundImage",void 0),u([d({type:rt,aliasOf:"view.map.ground.surfaceColor"})],Xt.prototype,"backgroundColor",void 0),u([d()],Xt.prototype,"_background",null),u([d({value:!1})],Xt.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],Xt.prototype,"tilingScheme",void 0),u([d({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],Xt.prototype,"tilingSchemeLocked",void 0),u([d({readOnly:!0})],Xt.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],Xt.prototype,"velvetOverground",null),u([xt("_renderer.wireframe")],Xt.prototype,"wireframe",void 0),u([d({value:!1})],Xt.prototype,"suspended",null),u([d({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],Xt.prototype,"textureFadeDuration",void 0),u([d()],Xt.prototype,"_layerViewsDirty",void 0),u([xt("_renderer.renderPatchBorders")],Xt.prototype,"renderPatchBorders",void 0),u([xt("_renderer.renderingDisabled")],Xt.prototype,"renderingDisabled",void 0),Xt=u([P("esri.views.3d.terrain.TerrainSurface")],Xt);const Bot=Xt;function Tse(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function ube(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>ube(t)))}function Vot(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const YE=-1,Ch=ii(),Got=Gt(),rI=[0,0,0],i6=new Vt,sI={spatialReference:null,tile:null,extent:null,context:"ground"},nI={spatialReference:null,extent:null,scale:0};let gC=class extends be{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,i)=>this.commitLayer(i,e))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((r,s)=>{const n=this._ensureGeomRecord(e,s);r.forEach((o,a)=>{const l=o[0],c=o[1],h=o[2];let p=!1;if(c&Yt.Geometry.UPDATE){const f=n.get(a);if(f){const g=f[1];if(h&Yt.State.TRANSFORMATION){const y=this.model.getObject(s);this.model.updateRenderGeometryTransformation(y,l,g)&&(p=!0)}p||t.updates.push({renderGeometry:g,updateType:h})}else ht(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(c&Yt.Geometry.REMOVE||p){const f=n.get(a);f?(t.removes.push(f[1]),n.delete(a),f[0].disposed&&Ob.pool.release(f[0])):c===Yt.Geometry.REMOVE&&ht(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(c&Yt.Geometry.ADD||p){const f=this.model.getObject(s);if(_(f)){const g=this.model.getRenderGeometry(f,l),y=[l,g];t.adds.push(g),n.set(a,y)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s[1])))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,Yt.Geometry.UPDATE,0,0,Yt.Geometry.UPDATE,Yt.Geometry.ADD|Yt.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(Yt.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(Yt.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(Yt.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,Yt.Geometry.UPDATE,0,0,Yt.Geometry.UPDATE,Yt.Geometry.ADD|Yt.Geometry.REMOVE,Yt.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((i,r)=>{const s=this.model.getObject(r);s&&s.hasVolativeTransformation()&&i.forEach(n=>{n[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r[0],t,Yt.Geometry.UPDATE,0,0,Yt.Geometry.UPDATE,Yt.Geometry.ADD|Yt.Geometry.REMOVE,Yt.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,Yt.Geometry.ADD,Yt.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,Yt.Geometry.REMOVE,Yt.Geometry.ADD,Yt.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,s,n,o,a,l){i=Tt(i,this._getParentLayerId(e));const c=e.id,h=t.id,p=this._ensureDirtyRecord(i,c),f=p.get(h);if(f){const g=f[1];g&s?(p.delete(h),f[0].disposed&&Ob.pool.release(f[0])):g&n?(f[1]=r,f[2]=l):g&o?f[2]|=l:g&a||ht(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else p.set(h,[t,r,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return Us(this._dirtyGeomRecords,e=>Us(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return _(e.parentLayer)?e.parentLayer.id:Nxe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;const o=[];s.forEach(a=>{const l=a[1];o[l]||(o[l]=[]),o[l].push(a[0].geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,i)=>t+i.size,0)}}}};u([d({constructOnly:!0})],gC.prototype,"model",void 0),u([d()],gC.prototype,"dirty",void 0),gC=u([P("esri.views.3d.webgl-engine.lib.ModelDirtySet")],gC);const jot=gC;let aD=class extends be{constructor(){super(...arguments),this.dirtySet=new jot({model:this}),this._content=new Map,this._originFactory=new LW(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;ht(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),cN(e)&&this.dirtySet.layerAdded(e)}remove(e){ht(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),cN(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)_(t)&&(ht(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)ht(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{geometry:i,material:r,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new r2(i,r,{id:s,boundingInfo:i.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=o||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,i){if(C(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<Id.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],aD.prototype,"dirtySet",void 0),aD=u([P("esri.views.3d.webgl-engine.parts.Model")],aD);function Hot(){const e=new Float32Array(4);return e[3]=1,e}function hbe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function qot(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function dbe(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:Hot,clone:hbe,fromValues:qot,createView:dbe},Symbol.toStringTag,{value:"Module"}));const n2=1e-6,ZE=[0,0,0],oI=[0,0,0];function Wot(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new iat(e);lD(ZE,n.minProj,n.maxProj),p1(ZE,ZE,.5),ju(oI,n.maxProj,n.minProj);const o=XG(oI),a=new rat;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],g=[0,0,0],y=[0,0,0];switch(Xot(n,e,y,l,c,h,p,f,g,a)){case 1:return void Cse(ZE,oI,t);case 2:return void tat(e,p,t)}Yot(e,y,l,c,h,p,f,g,a),pbe(e,a.b0,a.b1,a.b2,XT,YT);const v=[0,0,0];ju(v,YT,XT),a.quality=XG(v),a.quality<o?fbe(a.b0,a.b1,a.b2,XT,YT,v,t):Cse(ZE,oI,t)}function Xot(e,t,i,r,s,n,o,a,l,c){return Zot(e,r,s),YG(r,s)<n2?1:(ju(o,r,s),eo(o,o),Qot(t,r,o,n)<n2?2:(ju(a,s,n),eo(a,a),ju(l,n,r),eo(l,l),Hu(i,a,o),eo(i,i),H_(t,i,o,a,l,c),0))}const QE=[0,0,0],JE=[0,0,0],du=[0,0,0],pu=[0,0,0],fu=[0,0,0],Kg=[0,0,0],ey=[0,0,0],ty=[0,0,0];function Yot(e,t,i,r,s,n,o,a,l){Jot(e,t,i,QE,JE),QE[0]!==void 0&&(ju(du,QE,i),eo(du,du),ju(pu,QE,r),eo(pu,pu),ju(fu,QE,s),eo(fu,fu),Hu(Kg,pu,n),eo(Kg,Kg),Hu(ey,fu,o),eo(ey,ey),Hu(ty,du,a),eo(ty,ty),H_(e,Kg,n,pu,du,l),H_(e,ey,o,fu,pu,l),H_(e,ty,a,du,fu,l)),JE[0]!==void 0&&(ju(du,JE,i),eo(du,du),ju(pu,JE,r),eo(pu,pu),ju(fu,JE,s),eo(fu,fu),Hu(Kg,pu,n),eo(Kg,Kg),Hu(ey,fu,o),eo(ey,ey),Hu(ty,du,a),eo(ty,ty),H_(e,Kg,n,pu,du,l),H_(e,ey,o,fu,pu,l),H_(e,ty,a,du,fu,l))}function Zot(e,t,i){let r=YG(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=YG(e.maxVert[n],e.minVert[n]);o>r&&(r=o,s=n)}kl(t,e.minVert[s]),kl(i,e.maxVert[s])}const mu=[0,0,0];function Qot(e,t,i,r){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){mu[0]=s[l]-t[0],mu[1]=s[l+1]-t[1],mu[2]=s[l+2]-t[2];const c=i[0]*mu[0]+i[1]*mu[1]+i[2]*mu[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=mu[0]*mu[0]+mu[1]*mu[1]+mu[2]*mu[2]-c*c/h;p>o&&(o=p,a=l)}return kl(r,s,a),o}const Js=[0,0];function Jot(e,t,i,r,s){eat(e,t,Js,s,r);const n=gbe(i,t);Js[1]-n2<=n&&(r[0]=void 0),Js[0]+n2>=n&&(s[0]=void 0)}const Sse=[0,0,0],Ese=[0,0,0],Ase=[0,0,0],Jw=[0,0,0],Kw=[0,0,0],aI=[0,0,0];function H_(e,t,i,r,s,n){if(mbe(t)<n2)return;Hu(Sse,i,t),Hu(Ese,r,t),Hu(Ase,s,t),WT(e,t,Js),Kw[1]=Js[0],Jw[1]=Js[1],aI[1]=Jw[1]-Kw[1];const o=[i,r,s],a=[Sse,Ese,Ase];for(let l=0;l<3;++l){WT(e,o[l],Js),Kw[0]=Js[0],Jw[0]=Js[1],WT(e,a[l],Js),Kw[2]=Js[0],Jw[2]=Js[1],aI[0]=Jw[0]-Kw[0],aI[2]=Jw[2]-Kw[2];const c=XG(aI);c<n.quality&&(kl(n.b0,o[l]),kl(n.b1,t),kl(n.b2,a[l]),n.quality=c)}}const Kot=[0,0,0];function WT(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*t[0]+r[n+1]*t[1]+r[n+2]*t[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function eat(e,t,i,r,s){const{data:n,size:o}=e;kl(r,n),kl(s,r),i[0]=gbe(Kot,t),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<i[0]&&(i[0]=l,kl(r,n,a)),l>i[1]&&(i[1]=l,kl(s,n,a))}}function Cse(e,t,i){kl(i.center,e),p1(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const Vf=[0,0,0],ex=[0,0,0],KE=[0,0,0],XT=[0,0,0],YT=[0,0,0],Rse=[0,0,0];function tat(e,t,i){kl(Vf,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?Vf[0]=0:Math.abs(t[1])>Math.abs(t[2])?Vf[1]=0:Vf[2]=0,mbe(Vf)<n2&&(Vf[0]=Vf[1]=Vf[2]=1),Hu(ex,t,Vf),eo(ex,ex),Hu(KE,t,ex),eo(KE,KE),pbe(e,t,ex,KE,XT,YT),ju(Rse,YT,XT),fbe(t,ex,KE,XT,YT,Rse,i)}function pbe(e,t,i,r,s,n){WT(e,t,Js),s[0]=Js[0],n[0]=Js[1],WT(e,i,Js),s[1]=Js[0],n[1]=Js[1],WT(e,r,Js),s[2]=Js[0],n[2]=Js[1]}const lI=[0,0,0],tp=[1,0,0,0,1,0,0,0,1],tx=[0,0,0];function fbe(e,t,i,r,s,n,o){tp[0]=e[0],tp[1]=e[1],tp[2]=e[2],tp[3]=t[0],tp[4]=t[1],tp[5]=t[2],tp[6]=i[0],tp[7]=i[1],tp[8]=i[2],sat(o.quaternion,tp),lD(tx,r,s),p1(tx,tx,.5),p1(o.center,e,tx[0]),p1(lI,t,tx[1]),lD(o.center,o.center,lI),p1(lI,i,tx[2]),lD(o.center,o.center,lI),p1(o.halfSize,n,.5)}const oc=7;class iat{constructor(t){this.minVert=new Array(oc),this.maxVert=new Array(oc);const i=64*oc;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,oc),r+=8*oc,this.maxProj=new Float64Array(this.buffer,r,oc),r+=8*oc;for(let l=0;l<oc;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<oc;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<oc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(oc),n=new Array(oc),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<oc;++l){let c=s[l];kl(this.minVert[l],o,c),c=n[l],kl(this.maxVert[l],o,c)}}}class rat{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function XG(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function lD(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function ju(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function p1(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function kl(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function Hu(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o}function eo(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function mbe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function YG(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function gbe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function sat(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1);e[r]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+r]+t[3*r+s])*o,e[n]=(t[3*n+r]+t[3*r+n])*o}}const oR=vf(),M1=M(),nat=M(),oat=Qi();class pgt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:O7(this.buffer,56*a+0),halfSize:Oge(this.buffer,56*a+24),quaternion:dbe(this.buffer,56*a+36)}}}function ybe(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:ts(e),halfSize:LL(t),quaternion:hbe(i)}}function aat(e){return ybe(e.center,e.halfSize,e.quaternion)}function fgt(e,t){ne(t.center,e.center),ne(t.halfSize,e.halfSize),Age(t.quaternion,e.quaternion)}function mgt(e,t){return t=t||ybe(),Wot(e,t),t}function q_(e,t){const i=mr(t,e.center),r=f5(e,t);return i>r?1:i<-r?-1:0}function ggt(e,t){t||(t=Rs());const i=Pq(oat,e.quaternion),r=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),s=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),n=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+r,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function ygt(e,t){return mr(t,e.center)-f5(e,t)}function vgt(e,t){return mr(t,e.center)+f5(e,t)}function _gt(e,t){return q_(e,t[0])<=0&&q_(e,t[1])<=0&&q_(e,t[2])<=0&&q_(e,t[3])<=0&&q_(e,t[4])<=0&&q_(e,t[5])<=0}function bgt(e,t,i,r=0){iM(oR,e.quaternion),de(M1,t,e.center);const s=D0(M1,M1,oR),n=D0(nat,i,oR);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+e.halfSize[l]-s[l])/n[l],h=(-r-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+r||s[l]<-e.halfSize[l]-r)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function f5(e,t){iM(oR,e.quaternion),D0(M1,t,oR);const i=e.halfSize;return Math.abs(M1[0]*i[0])+Math.abs(M1[1]*i[1])+Math.abs(M1[2]*i[2])}function wgt(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],D0(r,r,e.quaternion),fe(r,r,e.center)}}function lat(e){return D7(e.halfSize)}class cat{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}componentCount(){const t=this._indexRanges;let i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];return i}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=uat(t)}forEachComponent(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=t[n],l=t[o];i[s]=a,i[s+1]=l-a}return i}}function uat(e){const t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}class hat extends P4{constructor(t,i){super(),this.pickability=null,this.highlightCounts=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=f7(i);const r=this.count;this.visibility=new cat(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return C(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return C(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return C(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((C(this.cachedHighlightRanges)||C(this.cachedDefaultRanges))&&_(this.highlightCounts)){const{highlightRanges:t,defaultRanges:i}=dat(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=i}}}function dat(e,t,i){const r=[],s=[];let n=i.length,o=i.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}class ZG extends P4{constructor(){super(...arguments),this.visible=ZT.Hidden}}var ZT;u([Kn()],ZG.prototype,"renderable",void 0),u([Kn()],ZG.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(ZT||(ZT={}));function pat(e){return typeof e=="function"}function fat(e,t,i,r){if(i>=t)return e;e==null&&(e=mat());const s=e.isVisibleBit;let n=e.data;const o=_be(n),a=i/o|0,l=i-o*a,c=(t-1)/o|0,h=n,p=r===s;if(!(i<h.length*o)&&p){const g=a+1,y=Math.ceil(h.length*1.5),v=c+1;let b=Math.max(g,y);b=Math.min(b,v),n=new Uint32Array(b),n.set(h)}return a<n.length&&(n[a]=yat(n[a],l,p)),e.data=n,e}function vbe(e,t){if(e==null)return!0;const{isVisibleBit:i,data:r}=e,s=_be(r);return t<r.length*s?gat(i,r,t,s):!e.isVisibleBit}function mat(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function gat(e,t,i,r){const s=i/r|0,n=i-s*r;return vat(t[s],n)===e}function _be(e){return e.BYTES_PER_ELEMENT*8}function yat(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function vat(e,t){return(e&1<<t)!=0}class _at{constructor(t,i){this._indices=_(t.indices)?t.indices:WS(t.positions.length/3),this._positions=new pi(t.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(t,i){if(_(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*t+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(t,i)}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,o){const a={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},l=this._indices,c=this._components.offsets,h=M0e(t,i,bat);this._components.visibility.forEachComponent(p=>{if(!vbe(this._components.pickability,p))return!0;const f=this.getComponentAabb(p,wat);if(_(n)&&n.applyToAabb(f),!pW(f,t,h,r))return!0;const g=c[p]/3,y=c[p+1]/3,v=(w,S,x)=>{o(p,w,so(S,S,s),x)},b=y-g;return C(n)&&b>obe?(this._componentIntersectionData[p]==null&&(this._componentIntersectionData[p]=new s2(this._indices,g,y,a)),this._componentIntersectionData[p].intersectRay({r0:t,r1:i},v)):lM(t,i,g,y,l,a,void 0,n,v),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);for(let i=0;i<t;i++)this._computeAABB(i)}_computeAABB(t){const i=this._indices,r=this._positions,s=this._components.offsets,n=s[t],o=s[t+1],a=[0,0,0],l=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(let p=n;p<o;p++){const f=i[p];r.getVec(f,a),nae(l,l,a),oae(c,c,a)}let h=6*t;this._perComponentAabbs[h++]=l[0],this._perComponentAabbs[h++]=l[1],this._perComponentAabbs[h++]=l[2],this._perComponentAabbs[h++]=c[0],this._perComponentAabbs[h++]=c[1],this._perComponentAabbs[h]=c[2]}get positions(){return this._positions}get indices(){return this._indices}}const bat=M(),wat=Rs();class xat{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}dispose(){this.material.dispose(),this.geometry.dispose()}}class bbe extends P4{constructor(t,i,r,s){super(),this.primitiveType=i,this.parameters=r,this.indexed=s,this.vao=t}}u([Kn()],bbe.prototype,"vao",void 0);function Tat(e,t){return{near:e,far:t}}function wM(e){return e?SO(e,1/0,-1/0):Tat(1/0,-1/0)}function SO(e,t,i){return e.near=t,e.far=i,e}function o2(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function cI(e,t){return e.near<=t&&t<=e.far}const QG={near:0,far:0};function Sat(e,t){const i=wM(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=o.obb,l=Se(Qp(gc,a.center,r),n),c=f5(a,n);if(cI(i,l-c)&&cI(i,l+c))return;const h=Oat(a,s);if(h===-1)return;if(h===0)return Gf.far=l+c,Gf.near=l-c,void o2(i,Gf);const p=uI.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<uI.length;o++){const a=uI.data[o];if(cI(i,a.near)&&cI(i,a.far))continue;Gf.far=a.far,Gf.near=1/0,Rat(a.object.obb,r,Eat,c=>{let h=Aat;for(let p=0;p<wbe&&c.length>0;p++){if((a.mask&1<<p)==0)continue;Cat(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){se(Fa,c.data[p+0],c.data[p+1],c.data[p+2]);const f=Se(Qp(Fa,Fa,r),n);Gf.near=Math.min(Gf.near,f)}})===0&&(Gf.near=0),o2(i,Gf)}return uI.length=0,i}const uI=new Vt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),Gf=wM(),Fa=M(),t_=M(),Eat=new Vt({deallocator:null}),Aat=new Vt({deallocator:null});function Cat(e,t,i){i.length=0;const r=t.length-3;r6(Fa,t,r);const s=mr(e,Fa);s<=0&&(i.push(Fa[0]),i.push(Fa[1]),i.push(Fa[2]));let n=0,o=s;for(;n<r;n+=3){r6(t_,t,n);const a=mr(e,t_);o*a<0&&(Cs(Fa,t_,Fa,a/(a-o)),Ua(i,Fa)),a<=0&&Ua(i,t_),o=a,ne(Fa,t_)}o*s<0&&(r6(t_,t,r),Cs(Fa,t_,Fa,s/(s-o)),Ua(i,Fa))}function r6(e,t,i){return se(e,t.data[i+0],t.data[i+1],t.data[i+2])}function Ua(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function Rat(e,t,i,r){iM(Mse,e.quaternion),Qp(gc,t,e.center),D0(gc,gc,Mse);const s=8*((gc[0]<-e.halfSize[0]?-1:gc[0]>e.halfSize[0]?1:0)+3*(gc[1]<-e.halfSize[1]?-1:gc[1]>e.halfSize[1]?1:0)+9*(gc[2]<-e.halfSize[2]?-1:gc[2]>e.halfSize[2]?1:0)+13),n=Ose[s];if(n===0)return n;Pq(hI,e.quaternion),Mq(hI,hI,e.halfSize);const o=(a,l)=>{const c=Ose[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),so(a,a,hI),fe(a,e.center,a)};return i.length=0,Ua(i,o(s6,0)),Ua(i,o(Pse,1)),Ua(i,o(gc,2)),Ua(i,o(Ise,3)),r(i),n===1||(i.length=0,Ua(i,s6),Ua(i,Ise),Ua(i,o(gc,4)),Ua(i,o($se,5)),r(i),n===2||(i.length=0,Ua(i,s6),Ua(i,$se),Ua(i,o(gc,6)),Ua(i,Pse),r(i))),n}const Ose=(()=>{const e=new Int8Array(216);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),wbe=4;function Oat(e,t){let i=0;for(let r=0;r<wbe;r++){const s=q_(e,t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const hI=Qi(),Mse=vf(),gc=M(),s6=M(),Pse=M(),Ise=M(),$se=M();class Mat{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?Sat(t,this._objects.visibleObjects):null}}function Pat(e){const t=ls().vec3f(A.POSITION);return e.normals&&t.vec2i16(A.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===Gs.Default?t.vec2f(A.UV0):e.textureCoordinates===Gs.Atlas&&(t.vec2f(A.UV0),t.vec4u16(A.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(A.COLOR,{glNormalized:!0}),t.alignTo(4)}var wd;function Iat(e,t){switch(t.componentData){case wd.Varying:return $at(e);case wd.Uniform:return Dat(e);case wd.COUNT:return;default:t.componentData}}function $at(e){const{vertex:t,fragment:i}=e;t.uniforms.add([new et("componentColorTex"),new Ft("componentColorTexInvDim")]),e.attributes.add(A.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(T_e),t.code.add(T`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),i.code.add(T`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}function Dat(e){const{vertex:t,fragment:i}=e;t.uniforms.add(new dt("externalColor",F.Draw,r=>r.componentParameters.externalColor)),i.uniforms.add(new z2("externalColorMixMode",F.Draw,r=>r.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(T`vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(T`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(wd||(wd={}));var Zu;function Lat(e,t){const i=e.vertex;switch(i.code.add(T`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case Zu.None:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Zu.Opaque:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Zu.Transparent:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Zu||(Zu={}));var Xp;function xgt(e){return e&&pf(e)?Xp.Mars:e&&ff(e)?Xp.Moon:Xp.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(Xp||(Xp={}));var Dse,Pc;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Dse||(Dse={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(Pc||(Pc={}));class ui extends _a{constructor(){super(...arguments),this.output=Q.Color,this.textureCoordinateType=Gs.None,this.componentData=wd.Uniform,this.cullFace=Zi.Back,this.vertexDiscardMode=Zu.None,this.doubleSidedMode=Or.WindingOrder,this.alphaDiscardMode=Xi.Opaque,this.integratedMeshMode=Pc.None,this.transparencyPassType=gt.NONE,this.ellipsoidMode=Xp.Earth,this.pbrMode=Mt.Disabled,this.normalType=gr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1}}u([B({count:Q.COUNT})],ui.prototype,"output",void 0),u([B({count:Gs.COUNT})],ui.prototype,"textureCoordinateType",void 0),u([B({count:wd.COUNT})],ui.prototype,"componentData",void 0),u([B({count:Zi.COUNT})],ui.prototype,"cullFace",void 0),u([B({count:Zu.COUNT})],ui.prototype,"vertexDiscardMode",void 0),u([B({count:Or.COUNT})],ui.prototype,"doubleSidedMode",void 0),u([B({count:Xi.COUNT})],ui.prototype,"alphaDiscardMode",void 0),u([B({count:Pc.COUNT})],ui.prototype,"integratedMeshMode",void 0),u([B({count:gt.COUNT})],ui.prototype,"transparencyPassType",void 0),u([B({count:Xp.COUNT})],ui.prototype,"ellipsoidMode",void 0),u([B({count:Mt.COUNT})],ui.prototype,"pbrMode",void 0),u([B({count:gr.COUNT})],ui.prototype,"normalType",void 0),u([B()],ui.prototype,"spherical",void 0),u([B()],ui.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],ui.prototype,"hasVertexColors",void 0),u([B()],ui.prototype,"hasNormals",void 0),u([B()],ui.prototype,"hasSlicePlane",void 0),u([B()],ui.prototype,"hasBaseColorTexture",void 0),u([B()],ui.prototype,"receiveAmbientOcclusion",void 0),u([B()],ui.prototype,"receiveShadows",void 0),u([B()],ui.prototype,"blendingEnabled",void 0),u([B()],ui.prototype,"hasScreenSpaceReflections",void 0),u([B()],ui.prototype,"hasPolygonOffset",void 0),u([B()],ui.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([B()],ui.prototype,"hasEmissionTexture",void 0),u([B()],ui.prototype,"hasOcclusionTexture",void 0),u([B()],ui.prototype,"hasNormalTexture",void 0),u([B()],ui.prototype,"hasOccludees",void 0),u([B()],ui.prototype,"hasMultipassTerrain",void 0),u([B()],ui.prototype,"cullAboveGround",void 0),u([B()],ui.prototype,"isGround",void 0),u([B({constValue:F.Draw})],ui.prototype,"pbrTextureBindType",void 0),u([B({constValue:!0})],ui.prototype,"hasSliceHighlight",void 0),u([B({constValue:!1})],ui.prototype,"hasSliceInVertexProgram",void 0),u([B({constValue:!1})],ui.prototype,"useCustomDTRExponentForWater",void 0),u([B({constValue:!1})],ui.prototype,"hasVertexTangents",void 0),u([B({constValue:!0})],ui.prototype,"supportsTextureAtlas",void 0),u([B({constValue:!1})],ui.prototype,"highStepCount",void 0),u([B({constValue:!1})],ui.prototype,"instancedDoublePrecision",void 0),u([B({constValue:!0})],ui.prototype,"useFillLights",void 0),u([B({constValue:ue("enable-feature:clouds-reflections")})],ui.prototype,"hasCloudsReflections",void 0);function Lse(e,t){e.include(iw,t),e.fragment.include(fO);const i=e.fragment;i.uniforms.add(new dt("baseColor")),i.uniforms.add(new ye("objectOpacity")),t.hasVertexColors?i.code.add(T`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(T`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(T`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Nse(e,t){const i=e.fragment;switch(t.doubleSidedMode){case Or.None:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Or.View:e.include(VT,t),i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Or.WindingOrder:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Or.COUNT:}switch(t.normalType){case gr.Attribute:case gr.CompressedAttribute:e.include(L4,t),i.code.add(T`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case gr.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(VT,t),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case gr.Ground:t.spherical?(e.include(VT,t),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(T`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(T`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case gr.COUNT:}}function Nat(e,t){const i=e.fragment;if(t.hasBaseColorTexture){e.include(Tq,t);const r=t.textureCoordinateType===Gs.Atlas;i.uniforms.add(FT("baseColorTexture",F.Draw,s=>s.texture,r)),r?(e.include(Dge),i.code.add(T`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):i.code.add(T`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(T`vec4 readBaseColorTexture() { return vec4(1.0); }`)}const xbe=new Map([[A.POSITION,0],[A.NORMAL,1],[A.NORMALCOMPRESSED,1],[A.COLOR,2],[A.UV0,3],[A.UVREGION,4],[A.COMPONENTINDEX,5]]);function Fat(e){const t=new Fi;t.include(VT,e),t.include(L4,e),t.include(iw,e),t.include(jm,e),t.include(mM,e),t.include(Iat,e),t.include(dZe,e),t.include(Eqe,e),t.include(Nat,e),t.include(Lat,e);const{vertex:i,fragment:r}=t;r.uniforms.add(new li("view")),e.pbrMode!==Mt.Normal&&e.pbrMode!==Mt.Schematic||(t.include(Eq,e),e.hasNormalTexture&&t.include(C_e,e)),e.output===Q.Shadow&&e.componentData===wd.Varying?i.code.add(T`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(T`#define discardShadows(castShadows) {}`);const s=e.integratedMeshMode===Pc.ColorOverlay||e.integratedMeshMode===Pc.ColorOverlayWithWater,n=s&&e.output===Q.Color&&e.pbrMode===Mt.WaterOnIntegratedMesh;return s&&(t.include(Ib,e),t.include(Cot,e),e.spherical?i.code.add(T`
      const float invEllipsoidRadius = ${T.float(1/(e.ellipsoidMode===Xp.Earth?ai.radius:e.ellipsoidMode===Xp.Mars?Gp.radius:Jm.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(T`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),n&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3"),t.varyings.add("posView","vec3")),i.code.add(T`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${T.float(co)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${n?T`
        posView = positionView();
        ${e.spherical?T`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:T`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${s?T`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `),e.output===Q.Alpha&&(r.include(Zc),t.include(Qc,e),t.include(Lse,e),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===Q.Color&&(r.include(Zc),t.include(Qc,e),t.include(Lse,e),t.include(Nse,e),t.include(Ib,e),e.receiveShadows?(t.include(N4,e),r.code.add(T`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(T`float evaluateShadow() { return 0.0; }`),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`
        vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),e.pbrMode===Mt.Normal||e.pbrMode===Mt.Schematic?(r.uniforms.add(new ke("lightingMainIntensity",F.Pass,(o,a)=>a.lighting.mainLight.intensity)),r.code.add(T`
        ${e.pbrMode===Mt.Normal?T`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?r.code.add(T`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(T`vec3 shadingNormal = normalVertex;`),r.code.add(T`${e.spherical?T`vec3 normalGround = normalize(positionWorld());`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(T`vec3 viewDir = normalize(vPositionWorldCameraRelative);
float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);`)):(e.receiveShadows?r.code.add(T`float shadow = evaluateShadow();`):e.spherical?(r.uniforms.add(new ye("lightingGlobalFactor",F.Pass,(o,a)=>a.lighting.globalFactor)),r.code.add(T`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(T`float shadow = 0.0;`),n&&r.uniforms.add(new et("ovNormalTex",F.Draw,o=>o.ovNormalTex)),r.code.add(T`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${n?T`
          vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, posView, positionWorld());
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),r.code.add(T`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==Q.Depth&&e.output!==Q.Shadow||(t.include(dv,e),r.code.add(T`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===Q.Normal&&(t.include(Nse,e),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===gr.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===Q.Highlight&&(t.include(xg),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?T`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `)),t}const Uat=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:xbe,build:Fat},Symbol.toStringTag,{value:"Module"}));class yX extends t_e{constructor(){super(...arguments),this.slicePlaneLocalOrigin=M(),this.origin=this.slicePlaneLocalOrigin}}var $l,Pn;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})($l||($l={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(Pn||(Pn={}));class zat extends yX{constructor(){super(...arguments),this.identifier=$l.Material,this.transparent=!1,this.integratedMesh=!1}}class kat extends yX{constructor(){super(...arguments),this.identifier=$l.ShadowMap}}class Bat extends yX{constructor(){super(...arguments),this.identifier=$l.Highlight}}class m5 extends Ki{bindPass(t,i){const r=this.program;r.bindPass(t,i),t.identifier===$l.Material&&r.setUniformMatrix3fv("transformNormalViewFromGlobal",t.transformNormalViewFromGlobal)}bindDraw(t,i){const r=this.program;if(r.bindDraw(t,i),r.rebindTextures(),_(this._material)&&this._material.isIntegratedMesh){const s=this._material.overlayTexScale,n=this._material.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[t.toMapSpace[0]*s[0]+n[0],t.toMapSpace[1]*s[1]+n[1],t.toMapSpace[0]*s[2]+n[2],t.toMapSpace[1]*s[3]+n[3]]),this.program.setUniform4fv("overlayTexScale",[t.toMapSpace[2]*s[0],t.toMapSpace[3]*s[1],t.toMapSpace[2]*s[2],t.toMapSpace[3]*s[3]])}this._material=t,r.setUniform4fv("baseColor",t.baseColor),r.setUniform1f("objectOpacity",t.objectOpacity),t.componentParameters.type===wd.Varying&&t.componentParameters.texture.bind(r,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(t,i){i.spherical=t.viewingMode===je.Global,i.doublePrecisionRequiresObfuscation=fM(t.rctx)}initializeProgram(t){const i=m5.shader.get(),r=i.build(this.configuration);return new Gi(t.rctx,r,i.attributeLocations)}_setPipelineState(t){const i=this.configuration,r=i.integratedMeshMode!==Pc.None,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:i.output!==Q.Color&&i.output!==Q.Alpha||!i.blendingEnabled?null:s?jc:Tg(t),culling:e4(i.cullFace),depthTest:{func:hv(t)},depthWrite:s||n?ol:null,colorWrite:Qt,stencilWrite:r||i.hasOccludees?lf:null,stencilTest:r?uYe(Za.IntegratedMeshMaskExcluded):i.hasOccludees?pv:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:T4})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}m5.shader=new Vi(Uat,()=>import("./ComponentShader.glsl.c2c89ed1.js"));class Vat extends qs{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class vX{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function er(e={}){return(t,i)=>{var r;const s=(r=t._parameterCount)!=null?r:0;if(t._parameterCount=s+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[s]},set(o){const a=this[s];if(a==null)this[s]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[s]},set(n){this[s]!==n&&(e.dispose&&this[s]&&this[s].dispose(),this[s]=n,this._setDirty())}})}}function Fse(){return(e,t)=>{var i;const r=(i=e._parameterCount)!=null?i:0;e._parameterCount=r+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(r),Object.defineProperty(e,t,{get(){return this[r]},set(s){this[r]!==s&&(this[r]=s,this._setDirty())}})}}class g5{constructor(t){this._low=vi(),this._high=vi(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const i=this._low,r=this._high;ne(i,t),Qp(r,t,i)}setElements(t,i,r){se(Use,t,i,r),this.set(Use)}get(t){return fe(t,this._low,this._high)}getLowScaled(t){return oe(t,this._low,1)}}const Use=M();class Yr extends Vat{constructor(t,i){super(),this.toMapSpace=i,this.overlayOpacity=1,this.baseColor=ph(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ai(1,1,.5),this.emissiveFactor=Ai(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.overlayTexOffset=ri(-1,-1,-1,-1),this.overlayTexScale=ri(0,0,0,0),this.overlayColor=null,this.overlayHighlight=null,this.ovNormalTex=null,this.ovColorTex=null,this.objectOpacity=1,this.commonMaterialParameters=new cD,this.componentParameters=new QT,this.textureAlphaCutoff=nN,this.alphaDiscardMode=Xi.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Xp.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new ui;const r=new g5(t.position),s=z1e(t.rotationScale);ew(s,s),this.transformNormalGlobalFromModel=lh(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=$i(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return _(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return _(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return _(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return _(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return _(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,i,r,s){const n=this._techniqueConfiguration;if(n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetalnessAndRoughnessTexture=_(this.metallicRoughnessTexture),n.hasEmissionTexture=_(this.emissionTexture),n.hasOcclusionTexture=_(this.occlusionTexture),n.hasNormalTexture=_(this.normalTexture),n.transparencyPassType=i.identifier===$l.Material&&r.transparencyPassType!=null?r.transparencyPassType:gt.NONE,n.hasMultipassTerrain=i.identifier===$l.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===$l.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,this.dirty){n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Or.View:Or.None,n.hasBaseColorTexture=_(this.baseColorTexture);const a=this._computeWhichMaterialPass();n.blendingEnabled=a===ra.Transparent||a===ra.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?this.overlayColor?this.ovNormalTex?Pc.ColorOverlayWithWater:Pc.ColorOverlay:Pc.NoOverlay:Pc.None,n.isGround=this.isIntegratedMesh,n.hasPolygonOffset=this.polygonOffsetEnabled,this._setClean()}const o=this.hasParametersFromSource&&C(this.baseColorTexture);return n.pbrMode=n.integratedMeshMode===Pc.ColorOverlayWithWater?Mt.WaterOnIntegratedMesh:this.usePBR?o?Mt.Schematic:Mt.Normal:Mt.Disabled,n.normalType=n.integratedMeshMode===Pc.None?n.hasNormals?gr.CompressedAttribute:gr.ScreenDerivative:gr.Ground,n.hasSlicePlane=_(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===$l.ShadowMap?(n.output=Q.Shadow,n.vertexDiscardMode=Zu.None):i.identifier===$l.Highlight?(n.output=Q.Highlight,n.vertexDiscardMode=Zu.None):(this._computeWhichMaterialPass()===ra.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?Zu.Opaque:Zu.Transparent:n.vertexDiscardMode=Zu.None,n.output=Gat(i.subPass),i.subPass===Pn.Alpha&&(n.hasOccludees=r.hasOccludees),i.subPass===Pn.Color?(n.receiveAmbientOcclusion=r.ssaoHelper.ready,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled):(n.receiveAmbientOcclusion=!1,n.receiveShadows=!1)),i.identifier===$l.Material&&i.subPass===Pn.Color?this.ovColorTex=this.overlayColor:i.identifier===$l.Highlight?this.ovColorTex=this.overlayHighlight:this.ovColorTex=null,this._technique=t.releaseAndAcquire(m5,n,this._technique),this._technique}submit(t,i){if(this.objectOpacity===0)return;const r=i.renderable.geometry,s=i.components,n=i.renderable.meta.cameraDepthSquared,o=s.geometryRanges,a=s.highlightRanges,l=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case ra.Opaque:t.materialOpaque.submitDraw(this,r,o,n);break;case ra.Transparent:t.materialTransparent.submitDraw(this,r,o,n);break;case ra.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,r,o,n),t.materialTransparent.submitDraw(this,r,o,n);break;case ra.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,r,o,n),this.overlayHighlight&&t.highlightIntegratedMesh.submitDraw(this,r,o,n)}const c=this.componentParameters.castShadows!==ws.None;c&&t.shadowMap.submitDraw(this,r,o,n),_(a)&&(t.highlight.submitDraw(this,r,a,n),c&&t.highlightShadowMap.submitDraw(this,r,a,n)),c&&_(l)&&t.defaultShadowMap.submitDraw(this,r,l,n)}get attributeLocations(){return xbe}_computeWhichMaterialPass(){return this.isIntegratedMesh?ra.IntegratedMesh:this.objectOpacity<1?ra.Transparent:this.componentParameters.opaqueOverride===ws.All?ra.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Xi.Blend||this.alphaDiscardMode===Xi.MaskBlend?ra.Transparent:this.componentParameters.transparent===ws.None?ra.Opaque:this.componentParameters.transparent===ws.All?ra.Transparent:ra.OpaqueAndTransparent}}var zse,ra,ws;u([er({vectorOps:fae})],Yr.prototype,"baseColor",void 0),u([er()],Yr.prototype,"usePBR",void 0),u([er()],Yr.prototype,"hasParametersFromSource",void 0),u([er({vectorOps:sY})],Yr.prototype,"mrrFactors",void 0),u([er({vectorOps:sY})],Yr.prototype,"emissiveFactor",void 0),u([er({dispose:!0})],Yr.prototype,"baseColorTexture",void 0),u([er({dispose:!0})],Yr.prototype,"metallicRoughnessTexture",void 0),u([er({dispose:!0})],Yr.prototype,"emissionTexture",void 0),u([er({dispose:!0})],Yr.prototype,"occlusionTexture",void 0),u([er({dispose:!0})],Yr.prototype,"normalTexture",void 0),u([er({vectorOps:{equals:Z1,copy:Dc}})],Yr.prototype,"overlayTexOffset",void 0),u([er({vectorOps:{equals:Z1,copy:Dc}})],Yr.prototype,"overlayTexScale",void 0),u([er()],Yr.prototype,"overlayColor",void 0),u([er()],Yr.prototype,"overlayHighlight",void 0),u([er()],Yr.prototype,"ovNormalTex",void 0),u([er()],Yr.prototype,"objectOpacity",void 0),u([Fse()],Yr.prototype,"commonMaterialParameters",void 0),u([Fse()],Yr.prototype,"componentParameters",void 0),u([er()],Yr.prototype,"textureAlphaCutoff",void 0),u([er()],Yr.prototype,"alphaDiscardMode",void 0),u([er()],Yr.prototype,"isIntegratedMesh",void 0),u([er()],Yr.prototype,"polygonOffsetEnabled",void 0),u([er()],Yr.prototype,"ellipsoidMode",void 0),u([er()],Yr.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(zse||(zse={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(ra||(ra={}));class cD extends vX{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Zi.Back,this.hasSlicePlane=!0}}u([er()],cD.prototype,"doubleSided",void 0),u([er()],cD.prototype,"cullFace",void 0),u([er()],cD.prototype,"hasSlicePlane",void 0);class QT extends vX{constructor(){super(...arguments),this.externalColor=ph(1,1,1,1),this.externalColorMixMode=zs.Multiply,this.castShadows=ws.All}get transparent(){return this.externalColor[3]<1?ws.All:ws.None}get opaqueOverride(){return this.externalColorMixMode===zs.Replace&&this.externalColor[3]===1?ws.All:ws.None}get visible(){return this.externalColor[3]>0?ws.All:ws.None}get type(){return wd.Uniform}}u([er({vectorOps:fae})],QT.prototype,"externalColor",void 0),u([er()],QT.prototype,"externalColorMixMode",void 0),u([er()],QT.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(ws||(ws={}));class yC extends vX{constructor(){super(...arguments),this.texture=null,this.transparent=ws.None,this.opaqueOverride=ws.None,this.castShadows=ws.None}get type(){return wd.Varying}}function Gat(e){switch(e){case Pn.Color:return Q.Color;case Pn.Alpha:return Q.Alpha;case Pn.Depth:return Q.Depth;case Pn.Normal:return Q.Normal}}u([er()],yC.prototype,"texture",void 0),u([er()],yC.prototype,"transparent",void 0),u([er()],yC.prototype,"opaqueOverride",void 0),u([er()],yC.prototype,"castShadows",void 0);class jat{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class Hat{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.textureWidth=4096,this.dirty=!0,this.texture=new ot(this.rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new al(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,i,r,s,n,o){const a=t*this.fieldCount+i;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,s),this.data.set(a,2,n),this.data.set(a,3,o)}setDataElement(t,i,r,s){const n=t*this.fieldCount+i;this.dirty=!0,this.data.set(n,r,s)}resizeToFit(t){const i=t*this.fieldCount;if(i>=this.data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new al(new ArrayBuffer(4*r));s.typedBuffer.set(this.data.typedBuffer),this.data=s}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,i=this.texture.descriptor.height;this.data.count>t*i&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,i,r){t.bindTexture(i,this.texture),t.setUniform2f(r,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const Tbe=65536;class qat{constructor(t,i=1){this.textureBuffer=new Hat(t,i),this.indexManager=new jat(Tbe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class Sbe{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const r of this.buffers)if(r.availableCount>=t)return r;if(t>Tbe)return null;const i=new qat(this.rctx,this.fieldCount);return this.buffers.push(i),i}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const kse=pe.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Wat{constructor(t){this._renderManager=t,this._objects=[new Vt,new Vt],this._renderSubmit=new Mat(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new Sbe(t.rctx)}dispose(){ht(this._objects[ZT.Hidden].length===0&&this._objects[ZT.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const i=new ZG;return i.toMapSpace=t.toMapSpace,i.transform=t.transform,i.obb=aat(t.obb),i.components=new hat(this._componentBufferManager,t.geometry.componentOffsets),i.renderable=this._createRenderable(t,i.components),i.intersectionGeometry=new _at(t.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(t){const i=t;this._objects[i.visible].removeUnordered(i),i.dispose(),this._notifyDirty()}setObjectVisibility(t,i){const r=t;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(t){const i=t.camera.eye;this.visibleObjects.forAll(r=>{const s=fa(i,r.obb.center);r.renderable.meta.cameraDepthSquared=s})}getMaterial(t){return t.renderable.material}updateMaterial(t,i){const r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){const r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){const i=t,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){const r=t,s=r.renderable.material;if(pat(i)){const n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:tX(),externalColorMixMode:zs.Multiply},c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,g=0,y=0,v=!1,b=0;for(let w=0;w<n.count;w++)i(w,l),f+=+(l.externalColor[3]<1),g+=+(l.externalColorMixMode===zs.Replace&&l.externalColor[3]===1),y+=+l.castShadows,x_e(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[w],0,h[0],h[1],h[2],h[3]),v=v||w>0&&b!==p[0],b=p[0],l.pickable!==vbe(n.pickability,w)&&(n.pickability=fat(n.pickability,n.count,w,l.pickable));v?(s.componentParameters=new yC,s.componentParameters.castShadows=n6(y,n.count),s.componentParameters.transparent=n6(f,n.count),s.componentParameters.opaqueOverride=n6(g,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new QT,s.componentParameters.castShadows=l.castShadows?ws.All:ws.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode)}else s.componentParameters=new QT,s.componentParameters.castShadows=i.castShadows?ws.All:ws.None,s.componentParameters.externalColor=i.externalColor,s.componentParameters.externalColorMixMode=i.externalColorMixMode;this._notifyDirty()}getComponentAabb(t,i,r){return t.intersectionGeometry.getComponentAabb(i,r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}intersect(t,i,r,s,n,o){const a=t;_(n)&&(n.localOrigin=a.transform.position);const l=ew(Bse,a.transform.rotationScale);Qp(dI,i,a.transform.position),Qp(pI,r,a.transform.position),so(dI,dI,l),so(pI,pI,l);const c=lh(Bse,l);return a.intersectionGeometry.intersect(dI,pI,s,c,n,o)}addEdges(t,i,r,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(t,n.transform,{center:n.obb.center,radius:lat(n.obb)},a,o,l,r,s)}addComponentHighlight(t,i){const r=t.components;C(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(t,i){const r=t.components;if(C(r.highlightCounts))return void kse.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else kse.warn("Removing non-existing highlight.")}clearHighlights(t){const i=t.components;_(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[ZT.Visible]}_createRenderable(t,i){const r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=si.createVertex(r,mi.STATIC_DRAW,s.vertices.data),a=Ks(s.indices,v=>si.createIndex(r,mi.STATIC_DRAW,v)),l=Zl(Pat(n)),c=new Uint16Array(s.vertices.count);for(let v=0;v<i.count;v++){const b=i.offsets[v],w=i.offsets[v+1],S=i.materialDataIndices[v];if(_(s.indices))for(let x=b;x<w;x++)c[s.indices[x]]=S;else for(let x=b;x<w;x++)c[x]=S}const h=si.createVertex(r,mi.STATIC_DRAW,c.buffer),p=new Yr(t.transform,t.toMapSpace),f=new Os(r,p.attributeLocations,{data:l,componentIndices:Xat},{data:o,componentIndices:h},a),g=new bbe(f,Dt.TRIANGLES,n,_(a)),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(_(a)?a.byteSize:0)};return new xat(p,g,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const Xat=Zl(ls().u16(A.COMPONENTINDEX));function n6(e,t){return e===t?ws.All:e===0?ws.None:ws.Some}const Bse=Xm(),dI=M(),pI=M();class Ebe extends qs{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function Yat(e){const t=new Fi;t.include(uv);const i=t.fragment;switch(e.function){case Ul.Standard:i.uniforms.add(new et("tex",F.Pass,r=>r.texture)),e.hasOpacityFactor?(i.uniforms.add(new ye("opacity",F.Pass,r=>r.opacity)),i.code.add(T`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):i.code.add(T`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case Ul.OverlayWithTransparency:i.uniforms.add(new et("tex",F.Pass,r=>r.texture)),i.uniforms.add(new z2("overlayIdx",F.Pass,r=>r.overlayIndex)),e.hasOpacityFactor&&i.uniforms.add(new ye("opacity",F.Pass,r=>r.opacity)),i.code.add(T`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case Ul.TransparentToHUDVisibility:i.uniforms.add(new et("tex",F.Pass,r=>r.texture)),i.code.add(T`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case Ul.Transparency:i.uniforms.add([new et("colorTexture",F.Pass,r=>r.colorTexture),new et("alphaTexture",F.Pass,r=>r.alphaTexture),new et("frontFaceTexture",F.Pass,r=>r.frontFaceTexture)]),i.code.add(T`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case Ul.COUNT:break;default:e.function}return t}const Zat=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:Ebe,build:Yat},Symbol.toStringTag,{value:"Module"}));class EO extends Ki{initializeProgram(t){const i=EO.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}initializePipeline(){if(this.configuration.function===Ul.TransparentToHUDVisibility)return Ut({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case ro.None:return Ut({colorWrite:Qt});case ro.Alpha:return Ut({blending:po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),colorWrite:Qt});default:return Ut({blending:ah(Me.ONE,Me.ONE_MINUS_SRC_ALPHA),colorWrite:Qt})}}}EO.shader=new Vi(Zat,()=>import("./Compositing.glsl.aaf17cba.js"));class Qat{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._configuration=new W$,this._passParameters=new Ebe}dispose(){this._vao=it(this._vao)}compositeTransparent(t,i,r,s,n=1){this._configuration.alphaMode=ro.Alpha,this._configuration.function=Ul.Transparency,this._configuration.hasOpacityFactor=n!==1,this._passParameters.colorTexture=i,this._passParameters.alphaTexture=r,this._passParameters.frontFaceTexture=s;const o=this._rctx,a=this._techniqueRepository.acquire(EO,this._configuration);o.bindTechnique(a,this._passParameters,t);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Dt.TRIANGLE_STRIP,0,oo(l,"geometry")),a.release()}composite(t,i,r=ro.None,s=1,n=Ul.Standard,o=gs.INNER){const a=this._rctx;this._configuration.alphaMode=r,this._configuration.function=n,this._configuration.hasOpacityFactor=s!==1,this._passParameters.overlayIndex=o,this._passParameters.texture=i,this._passParameters.opacity=s;const l=this._techniqueRepository.acquire(EO,this._configuration);a.bindTechnique(l,this._passParameters,t);const c=this._ensureVAO();a.bindVAO(c),a.drawArrays(Dt.TRIANGLE_STRIP,0,oo(c,"geometry")),l.release()}_ensureVAO(){return C(this._vao)&&(this._vao=ba(this._rctx)),this._vao}}const Jat=1e4,JG=100,Kat=500,elt=500,tlt=.1;function ilt(e,t,i){return gW(t,e)*(i[1]-i[0])+i[0]}function rlt(e,t,i){if(t.size<Jat)return hlt.compute(e,t);const r=wM();return i.forAll(s=>{s.isVisible&&o2(r,slt(e,s))}),r}function slt(e,t){if(!t.isVisible)return;const i=wM(),r=t.getSpatialQueryAccelerator();return _(r)?nlt(i,e,r):olt(i,e,t.objects),i}function nlt(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.isVisible,a=i.objectCount;if(a<Kat)SO(Nu,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,md.DepthOrder.FRONT_TO_BACK,Nu,(l,c)=>{KG(e,t,l),Nu.far=e.near,c.setRange(Nu)},n,o),SO(Nu,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,md.DepthOrder.BACK_TO_FRONT,Nu,(l,c)=>{KG(e,t,l),Nu.near=e.far,c.setRange(Nu)},n,o);else{const l=Math.max(Math.min(a,elt),Math.ceil(a*tlt)),c=i.findClosest(s,md.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,md.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(Vse(e,t,c.boundingVolumeWorldSpace.bounds),Vse(e,t,h.boundingVolumeWorldSpace.bounds))}}function olt(e,t,i){ix.clear(),i.forAll(r=>{r.isVisible&&r.geometryRecords.length!==0&&ix.add(r)}),ix.empty||(ix.sort(t),SO(Nu,t.near,Math.min(e.near,t.far)),ix.forEachInDepthRange(Nu,md.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<e.near&&KG(e,t,r)}),SO(Nu,Math.max(e.far,t.near),t.far),ix.forEachInDepthRange(Nu,md.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function KG(e,t,i){if(!i.isVisible||!m0(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=ult;i.geometryRecords.forEach(n=>{xr(s,r,n.getShaderTransformation());const o=gb(s);Abe(e,t,n.geometry.boundingInfo,s,o)})}function Abe(e,t,i,r,s){if(C(i))return;const n=t.eye,o=t.viewForward;Fe(to,i.center,r);const a=o[0]*(to[0]-n[0])+o[1]*(to[1]-n[1])+o[2]*(to[2]-n[2]);if(to[3]=i.radius*s,!(a-to[3]>e.near&&a+to[3]<e.far)&&m0(t.frustum,to))if(i.radius>JG&&i.getChildren()){const l=i.getChildren();for(let c=0;c<8;++c)l[c]&&Abe(e,t,l[c],r,s)}else e7.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function Vse(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}class alt{constructor(){this._items=new Vt({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const i=t.eye,r=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===md.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}}}class llt{constructor(){this.view=Ae(),this.viewProj=Ae(),this.frustum=sO(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,i){this._reset(),os(this.view,t.viewMatrix),xr(this.viewProj,t.projectionMatrix,this.view),VL(this.frustum,t.frustum);const r=this.view,s=r[2],n=r[6],o=r[10],a=r[14],l=this.range;let c=0;if(i.forEach(g=>{if(!g.instanceParameters.visible||!g.castShadow)return;let y;g.hasShaderTransformation?(g.computeBoundingSphere(g.getShaderTransformation(),to,1),y=to):y=g.boundingSphere;const v=s*y[0]+n*y[1]+o*y[2]+a,b=v-y[3],w=v+y[3];this.geometries[c]=g,this.near[c]=-w,this.far[c]=-b,++c}),this.geometries.length===0)return l;for(let g=0;g<this.geometries.length;++g)this.near[g]>l.far&&(l.far=this.near[g]),this.near[g]>2&&this.far[g]<l.near&&(l.near=this.far[g]);const h=this.looseRange;h.near=Math.max(.5*l.near,2),h.far=2*l.far;let p=0,f=0;for(let g=0;g<this.geometries.length;++g)this.near[g]<l.near&&(this.near[g]>=h.near?l.near=this.near[g]:this.nearCandidates[p++]=g),this.far[g]>l.far&&(this.far[g]<=h.far?l.far=this.far[g]:this.farCandidates[f++]=g);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return l;this.nearCandidates.sort((g,y)=>this.near[g]<this.near[y]?-1:this.near[g]>this.near[y]?1:0),this.farCandidates.sort((g,y)=>this.far[g]<this.far[y]?1:this.far[g]>this.far[y]?-1:0);for(let g=0;g<this.nearCandidates.length;++g){const y=this.nearCandidates[g];if(this.near[y]<l.near){const v=this.geometries[y],b=v.boundingInfo;this._includeNearBoundingInfoRec(b,v.getShaderTransformation())}}for(let g=0;g<this.farCandidates.length;++g){const y=this.farCandidates[g];if(this.far[y]>l.far){const v=this.geometries[y],b=v.boundingInfo;this._includeFarBoundingInfoRec(b,v.getShaderTransformation())}}return l}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,i){if(C(t))return;const r=t.getCenter();Fe(to,r,i);const s=gb(i),n=to[0],o=to[1],a=to[2],l=t.getBSRadius()*s,c=this.frustum;if(c[0][0]*n+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*n+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*n+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*n+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const h=this.view[2]*n+this.view[6]*o+this.view[10]*a+this.view[14],p=h+l;if(!(-(h-l)<2||-p>=this.range.near))if(-p>this.looseRange.near)this.range.near=-p;else{if(l>JG){const f=t.getChildren();if(f!==void 0){for(let g=0;g<8;++g)f[g]!==void 0&&this._includeNearBoundingInfoRec(f[g],i);return}}e7.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,i){if(C(t))return;let r=t.getBSRadius();const s=t.getCenter();Fe(to,s,i);const n=gb(i),o=to[0],a=to[1],l=to[2];r*=n;const c=this.frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>r||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>r||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>r||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>r)return;const h=this.view[2]*o+this.view[6]*a+this.view[10]*l+this.view[14]-r;if(!(-h<=this.range.far))if(-h<this.looseRange.far)this.range.far=-h;else{if(r>JG){const p=t.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&this._includeFarBoundingInfoRec(p[f],i);return}}e7.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}}class clt{constructor(){this.modelViewProj=Ae(),this.clipPosition=[ii(),ii(),ii(),ii(),ii(),ii(),ii(),ii()]}unionDepthRangeWithAABB(t,i,r,s,n){const o=this.modelViewProj;xr(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this.clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this.clipPosition[o6[l][0]],h=this.clipPosition[o6[l][1]],p=this.clipPosition[o6[l][2]],f=this._clipTriangle(c,h,p);let g=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){g=!1;break}if(!g){a=!0;for(let y=0;y<f.length;++y){const v=f[y][3];v<t.near&&(t.near=v),v>t.far&&(t.far=v)}}}return a}_inside(t,i){return i===0?t[0]>=-t[3]:i===1?t[1]>=-t[3]:i===2?t[0]<=t[3]:i===3?t[1]<=t[3]:void ht(!1)}_intersect(t,i,r){let s=0;return r===0?s=(-t[3]-t[0])/(i[0]-t[0]+i[3]-t[3]):r===1?s=(-t[3]-t[1])/(i[1]-t[1]+i[3]-t[3]):r===2?s=(t[3]-t[0])/(i[0]-t[0]-i[3]+t[3]):r===3&&(s=(t[3]-t[1])/(i[1]-t[1]-i[3]+t[3])),U7(ii(),t,i,s)}_clipTriangle(t,i,r){let s=[t,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const o6=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],to=Vn(),ult=Ae(),Nu=wM(),ix=new alt,hlt=new llt,e7=new clt;class dlt extends qs{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function plt(){const e=new Fi;return e.attributes.add(A.POSITION,"vec2"),e.vertex.uniforms.add(new dt("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(T`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new et("textureInput")),e.fragment.uniforms.add(new et("textureMask")),e.fragment.uniforms.add(new et("textureOverlay")),e.fragment.uniforms.add(new _b("maskEnabled",F.Pass,t=>t.maskEnabled)),e.fragment.uniforms.add(new _b("overlayEnabled",F.Pass,t=>t.overlayEnabled)),e.fragment.code.add(T`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function flt(e){const t=import("./mask-svg.d736db49.js"),i=import("./overlay-svg.ddc1dd43.js"),r=ch((await t).default,{signal:e}),s=ch((await i).default,{signal:e}),n={mask:await r,overlay:await s};return qt(e),n}let Wx=class extends be{constructor(){super(...arguments),this._handles=new Jt,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new dlt,this.events=new qr,this.attributeLocations=new Map([[A.POSITION,0]]),this.tmpScreenPoint=Vr(),this.tmpRenderPoint=lEe()}get updating(){return C(this._imageSources)&&_(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};_(this._magnifier)&&this._handles.add(xe(()=>Ks(this._magnifier,i=>i.version),t)),t()}get enabled(){return _(this._validMagnifier)}get _validMagnifier(){return _(this._magnifier)&&this._magnifier.visible&&_(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return _(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),_(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if(C(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),C(this._resources))return;this._passParameters.maskEnabled=i.maskEnabled,this._passParameters.overlayEnabled=i.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,t);const o=this._resources.textures,a=Math.ceil(1/this.factor*s);o.input.resize(a,a);const l=t.camera.fullWidth,c=t.camera.fullHeight;Mm(i.position,this.tmpScreenPoint);const h=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),p=.5*a,f=.5*a;h[0]=He(h[0],p,l-p-1),h[1]=He(h[1],f,c-f-1);const g=Math.floor(h[0]-p),y=Math.floor(h[1]-f);n.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,g,y,a,a,0);const v=i.offset.x*r,b=i.offset.y*r,w=(h[0]+v)/l*2-1,S=(h[1]-b)/c*2-1,x=s/l*2,E=s/c*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",o.overlay),n.bindTexture("textureMask",o.mask),n.setUniform4f("drawPosition",w,S,x,E),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Dt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(C(e))return;const t=e.maskUrl,i=e.overlayUrl;!_(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),_(this._imageSources)||_(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:PO(async r=>{const s=C(t)||C(i)?flt(r):null,n=_(t)?ch(t,{signal:r}):s.then(a=>a.mask),o=_(i)?ch(i,{signal:r}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(_(this._resources)){if(this._resources.textures.size!==t){const r=this._createTextureResources(e,t);if(C(r))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=r}return}const i=this._createTextureResources(e,t);C(i)||(this._resources={textures:i,program:this._createProgram(e),vao:ba(e,gq,this.attributeLocations,0,1),pipelineState:Ut({blending:ah(Me.ONE,Me.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Qt})})}_disposeResources(){C(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(C(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new ot(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!0,preMultiplyAlpha:!bj(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new ot(e,{target:pt.TEXTURE_2D,pixelFormat:ze.ALPHA,internalFormat:ze.ALPHA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!0},this._imageSources.mask);return{input:new ot(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){return new Gi(e,plt(),this.attributeLocations)}};u([d()],Wx.prototype,"_imageSources",void 0),u([d()],Wx.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],Wx.prototype,"updating",null),Wx=u([P("esri/views/3d/webgl-engine/lib/MagnifierHelper")],Wx);const mlt=.5,glt=1e3/30;var AO;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(AO||(AO={}));class iy{constructor(t,i,r=AO.FrontToBack){this._rctx=t,this._techniqueRepository=i,this._sorting=r,this._draws=new Vt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=t,n.depthSquaredHint=s,n.indexType=i.indexed?i.vao.indexBuffer.indexType:0}dispatch(t,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===gt.NONE||(r.bindTechnique(l,t,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.bindDraw(c.material,i),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const g=uD.get(c.indexType);for(let y=0;y<f;y+=2){const v=p[y],b=p[y+1];r.drawElements(h.primitiveType,b,c.indexType,v*g)}}else for(let g=0;g<f;g+=2){const y=p[g],v=p[g+1];r.drawArrays(h.primitiveType,y,v)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===AO.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}}const uD=new Map;uD.set(ut.UNSIGNED_BYTE,1),uD.set(ut.UNSIGNED_SHORT,2),uD.set(ut.UNSIGNED_INT,4);class ylt{constructor(t,i){this.rctx=t,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new zat,this._shadowPassParameters=new kat,this._highlightPassParameters=new Bat,this._systems=new Set,this._passes={materialOpaque:new iy(t,i),materialTransparent:new iy(t,i,AO.BackToFront),materialIntegratedMesh:new iy(t,i),shadowMap:new iy(t,i),highlight:new iy(t,i),highlightIntegratedMesh:new iy(t,i),highlightShadowMap:new iy(t,i),defaultShadowMap:new iy(t,i)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,{camera:t}));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case we.OPAQUE_MATERIAL:switch(t.pass){case Ue.MATERIAL:return this._materialPassParameters.subPass=Pn.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case Ue.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Pn.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case Ue.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Pn.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case Ue.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case Ue.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case Ue.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters)}return;case we.TRANSPARENT_MATERIAL:switch(t.pass){case Ue.MATERIAL:return this._materialPassParameters.subPass=Pn.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case Ue.MATERIAL_ALPHA:return this._materialPassParameters.subPass=Pn.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case Ue.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Pn.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case Ue.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Pn.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case we.INTEGRATED_MESH:switch(t.pass){case Ue.MATERIAL:return this._materialPassParameters.subPass=Pn.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case Ue.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Pn.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case Ue.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Pn.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case Ue.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[we.OPAQUE_MATERIAL,we.TRANSPARENT_MATERIAL,we.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(t);_(s)&&o2(i,s,i)}),i}_configure(t){const i=t.pass===Ue.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===Ue.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:t.pass===Ue.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,i)}_updateParameters(t,i){const r=t.bindParameters.camera,s=r.viewInverseTransposeMatrix;se(a6,s[3],s[7],s[11]),l6.set(a6),ne(i.transformWorldFromViewTH,l6.high),ne(i.transformWorldFromViewTL,l6.low),ne(i.slicePlaneLocalOrigin,a6),Wl(i.transformViewFromCameraRelativeRS,r.viewMatrix),os(i.transformProjFromView,r.projectionMatrix),i.identifier===$l.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===we.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===we.INTEGRATED_MESH,lh(Gse,i.transformViewFromCameraRelativeRS),ew(i.transformNormalViewFromGlobal,Gse))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const a6=M(),Gse=Qi(),l6=new g5,vlt=8.6,_lt=.4;function blt(){const e=new Fi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(A.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(A.UV0,"vec2"),t.uniforms.add(new et("coverageTex",F.Pass,n=>n.coverageTexture)),r.add(T`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new et("tex",F.Pass,n=>n.blurColorTexture)),i.uniforms.add(new et("origin",F.Pass,n=>n.highlightColorTexture)),i.uniforms.add(new dt("uColor",F.Pass,n=>n.color)),i.uniforms.add(new dt("haloColor",F.Pass,n=>n.haloColor)),i.uniforms.add(new dt("opacities",F.Pass,n=>Wi(wlt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",vlt),i.constants.add("blurSize","float",_lt),s.add(T`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const wlt=ii(),xlt=Object.freeze(Object.defineProperty({__proto__:null,build:blt},Symbol.toStringTag,{value:"Module"}));class y5 extends Ki{initializeProgram(t){const i=y5.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({blending:po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),colorWrite:Qt})}}y5.shader=new Vi(xlt,()=>import("./HighlightApply.glsl.d3ce5e23.js"));class Cbe extends qs{constructor(){super(...arguments),this.blurSize=lt()}}function Tlt(){const e=new Fi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(A.POSITION,"vec2"),e.attributes.add(A.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new et("coverageTex",F.Pass,n=>n.coverageTexture)),i.uniforms.add(new Ft("blurSize",F.Draw,n=>n.blurSize)),r.add(T`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new et("tex",F.Draw,n=>n.blurInputTexture)),s.add(T`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const Slt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Cbe,build:Tlt},Symbol.toStringTag,{value:"Module"}));class v5 extends Ki{initializeProgram(t){const i=v5.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({colorWrite:Qt})}}v5.shader=new Vi(Slt,()=>import("./HighlightBlur.glsl.988b9e5d.js"));class Rbe extends qs{constructor(){super(...arguments),this.invFramebufferDim=lt()}}function Elt(){const e=new Fi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(A.POSITION,"vec2"),r.add(T`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new et("tex",F.Draw,n=>n.inputTexture)),i.uniforms.add(new Ft("invFramebufferDim",F.Draw,n=>n.invFramebufferDim)),s.add(T`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const Alt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Rbe,build:Elt},Symbol.toStringTag,{value:"Module"}));class _5 extends Ki{initializeProgram(t){const i=_5.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({colorWrite:Qt})}}_5.shader=new Vi(Alt,()=>import("./HighlightDownsample.glsl.44a276ae.js"));class jse extends qs{constructor(){super(...arguments),this.color=ph(1,0,1,1),this.haloColor=ph(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=ri(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const Clt=32;class Rlt{constructor(t,i){this._techniqueRep=t,this._rctx=i,this.viewportToRestore=ii(),this._passParameters=new jse,this._downsampleDrawParameters=new Rbe,this._blurDrawParameters=new Cbe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=ba(this._rctx);const t={colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE,width:0,height:0},i={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new hr(this._rctx,t,i),this.blur1Fbo=new hr(this._rctx,t,i);const r=new _a;this._blurTechnique=this._techniqueRep.acquire(v5,r),this._downsampleTechnique=this._techniqueRep.acquire(_5,r),this._applyTechnique=this._techniqueRep.acquire(y5,r)}dispose(){if(this._blurTechnique=$i(this._blurTechnique),this._downsampleTechnique=$i(this._downsampleTechnique),this._applyTechnique=$i(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=it(this.blur0Fbo),this.blur1Fbo=it(this.blur1Fbo)}setDefaultOptions(t){this._passParameters=L(L({},new jse),t)}render(t,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=t.camera;Dc(this.viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this.quadVAO);let p=null;this._gridUpdateResources(i,Clt),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this.blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(ki.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,Li(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,oo(p,"geometry")),h.bindFramebuffer(this.blur1Fbo),h.clear(ki.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,Li(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,oo(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,oo(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:pt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:Ct.UNSIGNED_SHORT_5_6_5,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new hr(r,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,g=4,y=new Float32Array(f*g*l*c);let v=0;for(let b=0;b<l;b++)for(let w=0;w<c;w++)y[v+0]=(w-.5)*p*2-1,y[v+1]=(b-.5)*h*2-1,y[v+2]=w*p,y[v+3]=b*h,y[v+4]=(w+.5)*p*2-1,y[v+5]=(b-.5)*h*2-1,y[v+6]=w*p,y[v+7]=b*h,y[v+8]=(w-.5)*p*2-1,y[v+9]=(b+.5)*h*2-1,y[v+10]=w*p,y[v+11]=b*h,y[v+12]=(w-.5)*p*2-1,y[v+13]=(b+.5)*h*2-1,y[v+14]=w*p,y[v+15]=b*h,y[v+16]=(w+.5)*p*2-1,y[v+17]=(b-.5)*h*2-1,y[v+18]=w*p,y[v+19]=b*h,y[v+20]=(w+.5)*p*2-1,y[v+21]=(b+.5)*h*2-1,y[v+22]=w*p,y[v+23]=b*h,v+=f*g;s.vao&&s.vao.dispose(!0),s.vao=new Os(r,Ri,{geometry:tM},{geometry:si.createVertex(r,mi.STATIC_DRAW,y)})}}_gridComputeMipmap(t){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,t);i.bindVAO(this.quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,Li(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t),i.setViewport(0,0,o,a),i.drawArrays(Dt.TRIANGLE_STRIP,0,oo(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(_(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(_(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)t+=i.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const Olt={dataType:Ct.UNSIGNED_BYTE,internalFormat:ze.RGBA},Mlt={};class Plt{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const i=t.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(t,i){const r=t.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),t.delete(i))}getDepthTexture(t,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(t.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null),r||(r=new ot(this.rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:Ct.UNSIGNED_INT_24_8,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(t.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new Vx(this.rctx,L({internalFormat:la.DEPTH_STENCIL},i)),this._depthBuffers.set(t.id,r),this._activeTargets.add(t.id)),r}getColorTexture(t,i){let r=this._colorTextures.get(t.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null)),r||(r=new ot(this.rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return L(L({id:Xa()},Mlt),t)}registerColorTarget(t={}){return L(L({id:Xa()},Olt),t)}getFramebuffer(t,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,t);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=_(r)?new hr(this.rctx,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.DEPTH_STENCIL_TEXTURE},o,l):new hr(this.rctx,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new hr(this.rctx,{colorTarget:Gr.TEXTURE,depthStencilTarget:r?_i.DEPTH_STENCIL_RENDER_BUFFER:_i.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,i){return`${t.id}_${i?i.id:"X"}_${t.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let t=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),t+=R0(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),t}}class Ilt{constructor(t,i){this._rctx=t,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const r=t.type===xi.WEBGL2;this._renderTargetHelper=new Plt(t);const s=this._renderTargetHelper;this.mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:Ct.FLOAT,internalFormat:r?mt.RGBA32F:ze.RGBA,samplingMode:Je.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:Je.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?mt.RGBA4:ze.RGBA,dataType:Ct.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?mt.RGBA4:ze.RGBA,dataType:Ct.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const i=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(ki.COLOR_BUFFER_BIT|ki.DEPTH_BUFFER_BIT|ki.STENCIL_BUFFER_BIT)}composite(t){_(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,ro.None)}renderTmpAndCompositeToMain(t,i,r,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,$lt),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(t,i=!1){this.renderToTargets(t,this.hudVisibility,i?this.tmpDepth:this.mainDepth,Dlt)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),ro.None,1,Ul.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,i,r){let s,n;switch(i){case gt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case gt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case gt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),ro.PremultipliedAlpha)}compositeOccludedOntoMain(t,i){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),ro.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(t,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(ki.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,i,r,s,n=!1,o=!1){const a=this._rctx,l=this.bindTarget(i,r);let c=0;if(s){const p=Math.max(1e-13,s[3]);a.setClearColor(s[0],s[1],s[2],p),c|=ki.COLOR_BUFFER_BIT}return n&&(c|=ki.DEPTH_BUFFER_BIT),o===!1?o=0:(o===!0&&(o=255),c|=ki.STENCIL_BUFFER_BIT),c&&a.clearSafe(c,o),t(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),l}bindTarget(t,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,t,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const $lt=[0,0,0,0],Dlt=[0,1,0,1];class Llt{constructor(t){this.context=t,this.renderPlugins=new Array,this.slots=[];for(let i=0;i<we.MAX_SLOTS;++i)this.slots[i]=[]}add(t,i,r){const s=()=>{if(r!=null&&r.aborted)throw i.uninitializeRenderContext(),gi();this.renderPlugins.push(i);for(const o of t)this.slots[o].push(i);this.context.requestRender()},n=i.initializeRenderContext(this.context,r);if(Jc(n))return n.then(s);s()}remove(t){const i=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(r=>r!==t),ht(this.renderPlugins.length<i,"Removing non-added render plugin");for(let r=0;r<this.slots.length;++r)this.slots[r]=this.slots[r].filter(s=>s!==t);t.uninitializeRenderContext(),this.context.requestRender()}has(t){return this.renderPlugins.includes(t)}prepareRender(t,i){for(const r of this.renderPlugins)r.prepareRender&&r.prepareRender(t,i)}updateAnimation(t){let i=!1;return this.renderPlugins.forEach(r=>{r.updateAnimation&&(i=r.updateAnimation(t)||i)}),i}render(){const t=this.slots[this.context.renderContext.bindParameters.slot],i=new Array;t.filter(r=>{if(!r.canRender)return!1;if(Nlt(r)){const s=r.prepareTechnique(this.context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this.context.renderContext,i[s]))}queryDepthRange(t){const i=Flt;i.near=1/0,i.far=-1/0;for(const r of this.renderPlugins)if(r.queryDepthRange){const s=r.queryDepthRange(t);s&&o2(i,s,i)}return i}get needsTransparentPass(){return this.renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this.renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this.renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[we.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){let t=0;return this.renderPlugins.forEach(i=>{i.renderOccludedFlags&&(t|=i.renderOccludedFlags)}),t}}function Nlt(e){return"prepareTechnique"in e}const Flt={near:0,far:0};class Obe extends n_e{}const b5=255,Ult=1/b5;function zlt(){const e=new Fi,t=e.fragment;return t.include(mh),t.include(Zc),e.include(k4),e.include(uv),e.include(N4,{receiveShadows:!0}),t.uniforms.add([new et("depthMap",F.Pass,i=>i.linearDepthTexture),new li("inverseViewMatrix",F.Pass,(i,r)=>jr(Hse,ga(Hse,r.camera.viewMatrix,r.camera.center))),new Ft("nearFar",F.Pass,(i,r)=>r.camera.nearFar)]),t.constants.add("sampleValue","float",Ult),t.code.add(T`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const Hse=Ae(),klt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:Obe,shadowCastMaxSamples:b5,build:zlt},Symbol.toStringTag,{value:"Module"}));var Fb;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(Fb||(Fb={}));class t7 extends _a{constructor(){super(...arguments),this.visualization=Fb.Gradient,this.bandsEnabled=!1}}u([B({count:Fb.COUNT})],t7.prototype,"visualization",void 0),u([B()],t7.prototype,"bandsEnabled",void 0);function Blt(e){const t=new Fi,i=t.fragment;i.include(mh),i.include(Zc),t.include(k4),t.include(uv);const{visualization:r,bandsEnabled:s}=e;i.constants.add("inverseSampleValue","float",b5),i.uniforms.add([new et("shadowCastMap",F.Pass,a=>a.shadowCastMap),new ye("sampleScale",F.Pass,a=>a.sampleScale),new ye("opacityFromElevation",F.Pass,a=>a.opacityFromElevation),new dt("uColor",F.Pass,a=>a.color)]);const n=r===Fb.Gradient,o=r===Fb.Threshold;return n&&s?i.uniforms.add(new ye("bandSize",F.Pass,a=>a.bandSize)):o&&i.uniforms.add(new ye("threshold",F.Pass,a=>a.threshold)),i.code.add(T`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?T`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?T`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?T`* strength`:""});
      }
    `),t}const Vlt=Object.freeze(Object.defineProperty({__proto__:null,build:Blt},Symbol.toStringTag,{value:"Module"}));class w5 extends Ki{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=w5.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({blending:jc,colorWrite:Qt,depthTest:null,depthWrite:null})}get primitiveType(){return Dt.TRIANGLE_STRIP}}w5.shader=new Vi(Vlt,()=>import("./ShadowCastVisualize.glsl.6412a3d4.js"));const Glt=ri(.01,0,.25,1),jlt=4e4,Hlt=5e4,Mbe=1/512;let hD=class extends be{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:Glt,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new t7,this._enabled=!1,this._vao=ba(t),this._techniqueConfig.visualization=Fb.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=it(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(w5,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,oo(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>Mbe}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;Z1(e,t)||(Dc(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],hD.prototype,"opacityFromElevation",null),hD=u([P("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],hD);class x5 extends Ki{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=x5.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({blending:po(Me.ONE,Me.ONE,Me.ONE,Me.ONE),colorWrite:Qt,depthTest:null,depthWrite:null})}get primitiveType(){return Dt.TRIANGLE_STRIP}}x5.shader=new Vi(klt,()=>import("./ShadowCastAccumulate.glsl.84f70278.js"));var vC;let To=vC=class extends be{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new Obe,this._contentCamera=new Di,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=QG,this._previewing=!1,this._handles=new Jt,this._cameraForcedForScreenshot=!1,this._bindParameters=new o4(new NW(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new Di,this._vao=ba(e);const o={colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE,width:0,height:0},a={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new hr(e,o,a),this._accumulationRenderer=new hD(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(yt.SHADOW_ACCUMULATOR,this)),this._handles.add(xe(()=>i.renderView,c=>{this._handles.remove(vC.renderViewHandleKey),C(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),vC.renderViewHandleKey)},xs))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(C(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new x5(e,new _a)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==QG&&this._opacityFromElevation>Mbe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(I0(t,e,sS))return;const i=e.length;t.length=i,this._sampleCount=Math.min(b5,i);for(let r=0;r<i;++r){const s=e[r],n=t[r]||M();ne(n,s),t[r]=n}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters.camera,this._contentCamera);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._contentCamera=r,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(vC.previewSamples,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=it(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=it(this._fbo),this._vao=it(this._vao),this._accumulationTechnique=$i(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.previewing!==void 0&&(this.previewing=e.previewing),e.lightDirections!==void 0&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=qlt;return this._fbo.readPixels(e,t,1,1,ze.RGBA,Ct.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ki.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters.shadowMap,e,this._bindParameters.camera,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,oo(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-aS(jlt,Hlt,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){return{lightDirections:this._lightDirections,isDone:()=>this._isDoneAccumulating,isActive:()=>this._isActive}}};To.previewSamples=6,To.renderViewHandleKey="renderView",u([d()],To.prototype,"_progress",void 0),u([d()],To.prototype,"_sampleCount",void 0),u([d()],To.prototype,"_enabled",void 0),u([d()],To.prototype,"_depthRange",void 0),u([d()],To.prototype,"_previewing",void 0),u([d()],To.prototype,"_accumulationRenderer",void 0),u([d()],To.prototype,"_isRefining",null),u([d()],To.prototype,"_isActive",null),u([d()],To.prototype,"canAccumulate",null),u([d()],To.prototype,"_isDoneAccumulating",null),u([d()],To.prototype,"_opacityFromElevation",null),u([d()],To.prototype,"running",null),To=vC=u([P("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],To);const qlt=new Uint8Array(4),qse={highlightedThreshold:.99999,selfShadowThreshold:.025};function Wlt(){const e=new Fi;e.include(Pb,{receiveShadows:!0});const t=e.fragment;return t.include(mh),t.include(Zc),e.include(k4),e.include(uv),t.uniforms.add([new et("defaultDepthTex",F.Pass,(i,r)=>r.shadowMap.getSnapshot(i2.Default)),new et("highlightDepthTex",F.Pass,(i,r)=>r.shadowMap.getSnapshot(i2.Highlight)),new et("depthMap",F.Pass,(i,r)=>r.ssr.linearDepthTexture),new et("highlightMap",F.Pass,(i,r)=>r.highlightColorTexture),new dt("uColor",F.Pass,i=>i.shadowColor),new Ft("nearFar",F.Pass,(i,r)=>r.camera.nearFar),new ye("opacity",F.Pass,i=>i.shadowOpacity),new ye("occludedOpacity",F.Pass,i=>i.occludedShadowOpacity),new ye("terminationFactor",F.Pass,i=>i.opacityElevation*i.dayNightTerminator),new ke("lightingMainDirectionView",F.Pass,(i,r)=>Te(Xse,Fe(Xse,r.lighting.lightingMainDirection,r.camera.viewInverseTransposeMatrix))),new Ft("texelSize",F.Pass,(i,r)=>_(r.ssr.linearDepthTexture)?Li(Xlt,1/r.ssr.linearDepthTexture.descriptor.width,1/r.ssr.linearDepthTexture.descriptor.height):sg),new li("inverseViewMatrix",F.Pass,(i,r)=>jr(Wse,ga(Wse,r.camera.viewMatrix,r.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",Z0e).add("highlightedThreshold","float",qse.highlightedThreshold).add("selfShadowThreshold","float",qse.selfShadowThreshold),t.code.add(T`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(T`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Wse=Ae(),Xse=M(),Xlt=lt(),Ylt=Object.freeze(Object.defineProperty({__proto__:null,build:Wlt},Symbol.toStringTag,{value:"Module"}));class Zlt extends qs{constructor(){super(...arguments),this.shadowColor=ri(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class T5 extends Ki{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=T5.shader.get().build();return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({blending:po(Me.SRC_ALPHA,Me.ONE,Me.ONE_MINUS_SRC_ALPHA,Me.ONE_MINUS_SRC_ALPHA),colorWrite:Qt,depthTest:null,depthWrite:null})}get primitiveType(){return Dt.TRIANGLE_STRIP}}T5.shader=new Vi(Ylt,()=>import("./ShadowHighlight.glsl.21c50bf3.js"));const Qlt=.001953125,Jlt=4e4,Klt=5e4;class ect{constructor(t,i){this._rctx=t,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new Zlt,this._drawParameters=new n_e,this._vao=ba(this._rctx)}get technique(){return C(this._technique)&&(this._technique=new T5({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,i){if(!t.shadowMap.enabled||!t.ssr.linearDepthTexture||!this.isVisible)return;const r=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,oo(this._vao,"geometry"))}get gpuMemoryUsage(){var t,i;return(t=(i=this._vao)==null?void 0:i.size)!=null?t:0}setDefaultOptions(t){this._passParameters=L(L({},this._passParameters),t),this._updateMaxOpacity()}updateParameters(t,i){this._passParameters.opacityElevation=1-aS(Jlt,Klt,t.relativeElevation);const r=this._viewingMode===je.Global?Te(Yse,t.center):se(Yse,0,0,1),s=Se(r,i);this._passParameters.dayNightTerminator=aS(0,1,He(30*s,0,1))}dispose(){this._vao=it(this._vao),this._technique=$i(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*t*i>=Qlt}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const Yse=M(),Zse=av();class tct{constructor(){this._plane=av()}get isEnabled(){return!che(this.plane,Zse)}get plane(){return this._plane}set plane(t){Xb(t||Zse,this._plane)}}var Yp;(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(Yp||(Yp={}));class Pbe extends _a{constructor(){super(...arguments),this.output=Yp.EdgeDetector}}u([B({count:Yp.COUNT})],Pbe.prototype,"output",void 0);const ry={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function ict(e){const t=new Fi;return e.output===Yp.EdgeDetector&&(t.attributes.add(A.POSITION,"vec2"),t.vertex.uniforms.add(new dt("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(T`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new et("tColor")),t.fragment.code.add(T`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${T.float(ry.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${T.float(ry.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===Yp.BlendWeight&&(t.attributes.add(A.POSITION,"vec2"),t.vertex.uniforms.add(new dt("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(T`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${T.int(ry.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new et("tEdges")),t.fragment.uniforms.add(new et("tArea")),t.fragment.uniforms.add(new et("tSearch")),t.fragment.uniforms.add(new et("tColor")),t.fragment.uniforms.add(new dt("resolution")),t.fragment.code.add(T`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${T.int(ry.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${T.int(ry.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${T.int(ry.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${T.int(ry.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${T.int(ry.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===Yp.Blur&&(t.attributes.add(A.POSITION,"vec2"),t.vertex.uniforms.add(new dt("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(T`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new et("tBlendWeights")),t.fragment.uniforms.add(new et("tColor")),t.fragment.uniforms.add(new dt("resolution")),t.fragment.code.add(T`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const rct=Object.freeze(Object.defineProperty({__proto__:null,build:ict},Symbol.toStringTag,{value:"Module"}));class S5 extends Ki{initializeProgram(t){const i=S5.shader.get().build(this.configuration);return new Gi(t.rctx,i,Ri)}initializePipeline(){return Ut({colorWrite:Qt})}}S5.shader=new Vi(rct,()=>import("./SMAA.glsl.bb98b6b7.js"));let _C=class extends be{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=rh(this._abortController),this.disable()}_loadResources(e){if(_(this._abortController))return!1;if(_(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return import("./SmaaRenderPassData.e07ab82b.js").then(i=>this._loadTextures(i,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return qt(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,Je.LINEAR,ze.RGB),this._loadTextureFromBase64(e.searchTexure,Je.NEAREST,ze.LUMINANCE)]).then(([i,r])=>{Ts(t)?(i.dispose(),r.dispose(),qt(t)):(this._areaTexture=i,this._searchTexture=r)})}get updating(){return _(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new Pbe,i=(r,s)=>this._techniqueRep.releaseAndAcquire(S5,r,s);t.output=Yp.EdgeDetector,this._edgeDetectTechnique=i(t,this._edgeDetectTechnique),t.output=Yp.BlendWeight,this._blendWeightsTechnique=i(t,this._blendWeightsTechnique),t.output=Yp.Blur,this._blurTechnique=i(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=rVe(this.rctx),this._edges=new hr(this.rctx,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE},{target:pt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new hr(this.rctx,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE},{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=it(this._vao),this._areaTexture=it(this._areaTexture),this._searchTexture=it(this._searchTexture),this._blend=it(this._blend),this._edges=it(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(ki.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays(Dt.TRIANGLES,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(ki.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture("tSearch",this._searchTexture),n.bindTexture("tArea",this._areaTexture),n.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays(Dt.TRIANGLES,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(ki.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blurTechnique);o.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),o.bindTexture("tColor",e),o.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays(Dt.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){return ch(e).then(r=>new ot(this.rctx,{pixelFormat:i,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,width:r.width,height:r.height,samplingMode:t},r))}};u([d()],_C.prototype,"_abortController",void 0),u([d({readOnly:!0})],_C.prototype,"updating",null),_C=u([P("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],_C);function sct(e,t){const i=t,r=-e[0],s=-e[1],n=-e[2],o=i[3],a=i[7],l=i[11],c=i[15];i[0]+=o*r,i[1]+=o*s,i[2]+=o*n,i[4]+=a*r,i[5]+=a*s,i[6]+=a*n,i[8]+=l*r,i[9]+=l*s,i[10]+=l*n,i[12]+=c*r,i[13]+=c*s,i[14]+=c*n}function nct(e,t){const i=t,r=e[0],s=e[1],n=e[2];i[12]+=r*i[0]+s*i[4]+n*i[8],i[13]+=r*i[1]+s*i[5]+n*i[9],i[14]+=r*i[2]+s*i[6]+n*i[10],i[14]+=r*i[3]+s*i[7]+n*i[11]}class oct{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const i=this.originData.get(t.id);return i?(i.refCount++,i.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:Ae(),origin:t}),t)}release(t){const i=this.originData.get(t.id);i&&(i.refCount--,i.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(i=>{os(i.viewMatrix,t),nct(i.origin.vec3,i.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}const RN=ls().vec3f(A.POSITION).u16(A.COMPONENTINDEX).u16(A.U16PADDING),Ibe=ls().vec2u8(A.SIDENESS),Qse=Zl(Ibe),$be=ls().vec3f(A.POSITION0).vec3f(A.POSITION1).u16(A.COMPONENTINDEX).u8(A.VARIANTOFFSET,{glNormalized:!0}).u8(A.VARIANTSTROKE).u8(A.VARIANTEXTENSION,{glNormalized:!0}).u8(A.U8PADDING,{glPadding:!0}).u16(A.U16PADDING,{glPadding:!0}),i7=$be.clone().vec3f(A.NORMAL),r7=$be.clone().vec3f(A.NORMALA).vec3f(A.NORMALB),s7=new Map([[A.POSITION0,0],[A.POSITION1,1],[A.COMPONENTINDEX,2],[A.VARIANTOFFSET,3],[A.VARIANTSTROKE,4],[A.VARIANTEXTENSION,5],[A.NORMAL,6],[A.NORMALA,6],[A.NORMALB,7],[A.SIDENESS,8]]);class Dbe{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?lct:act}write(t,i,r){const s=this.edgeHashFunction(r);mI.seed=s;const n=mI.getIntRange(0,255),o=mI.getIntRange(0,this.settings.variants-1),a=.7,l=mI.getFloat(),c=255*(.5*cct(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex),t.variantOffset.set(i,n),t.variantStroke.set(i,o),t.variantExtension.set(i,c)}trim(t,i){return t.slice(0,i)}}const _X=new Float32Array(6),ON=new Uint32Array(_X.buffer),b0=new Uint32Array(1);function act(e){const t=_X;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],b0[0]=5381;for(let i=0;i<ON.length;i++)b0[0]=31*b0[0]+ON[i];return b0[0]}function lct(e){const t=_X;t[0]=rx(e.position0[0]),t[1]=rx(e.position0[1]),t[2]=rx(e.position0[2]),t[3]=rx(e.position1[0]),t[4]=rx(e.position1[1]),t[5]=rx(e.position1[2]),b0[0]=5381;for(let i=0;i<ON.length;i++)b0[0]=31*b0[0]+ON[i];return b0[0]}const Jse=1e4;function rx(e){return Math.round(e*Jse)/Jse}function cct(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class MN{constructor(){this.commonWriter=new Dbe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return i7.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),fe(fI,r.faceNormal0,r.faceNormal1),Te(fI,fI),t.normal.setVec(i,fI)}trim(t,i){return this.commonWriter.trim(t,i)}}MN.Layout=i7,MN.glLayout=Zl(i7,1);class PN{constructor(){this.commonWriter=new Dbe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return r7.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),t.normalA.setVec(i,r.faceNormal0),t.normalB.setVec(i,r.faceNormal1)}trim(t,i){return this.commonWriter.trim(t,i)}}PN.Layout=r7,PN.glLayout=Zl(r7,1);const fI=M(),mI=new Uu,W_=-1;var IN;function uct(e,t,i,r=gct){const s=e.vertices.position,n=e.vertices.componentIndex,o=$t(r.anglePlanar),a=$t(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=n7.edge,p=h.position0,f=h.position1,g=h.faceNormal0,y=h.faceNormal1,v=mct(e),b=fct(e),w=b.length/4,S=t.allocate(w);let x=0;const E=w,R=i.allocate(E);let O=0,I=0,U=0;const N=zwe(0,w),V=new Float32Array(w);Gwe(V,(he,le,$)=>{s.getVec(b[4*le+0],p),s.getVec(b[4*le+1],f),$[le]=Yi(p,f)}),N.sort((he,le)=>V[le]-V[he]);const j=new Array,H=new Array;for(let he=0;he<w;he++){const le=N[he],$=V[le],z=b[4*le+0],k=b[4*le+1],G=b[4*le+2],W=b[4*le+3],ee=W===W_;if(s.getVec(z,p),s.getVec(k,f),ee)se(g,v[3*G+0],v[3*G+1],v[3*G+2]),ne(y,g),h.componentIndex=n.get(z),h.cosAngle=Se(g,y);else{if(se(g,v[3*G+0],v[3*G+1],v[3*G+2]),se(y,v[3*W+0],v[3*W+1],v[3*W+2]),h.componentIndex=n.get(z),h.cosAngle=Se(g,y),dct(h,c))continue;h.cosAngle<-.9999&&ne(y,g)}I+=$,U++,ee||hct(h,l)?(t.write(S,x++,h),j.push($)):pct(h,o)&&(i.write(R,O++,h),H.push($))}const J=new Float32Array(j.reverse()),K=new Float32Array(H.reverse());return{regular:{instancesData:t.trim(S,x),lodInfo:{lengths:J}},silhouette:{instancesData:i.trim(R,O),lodInfo:{lengths:K}},averageEdgeLength:I/U}}function hct(e,t){return e.cosAngle<t}function dct(e,t){return e.cosAngle>t}function pct(e,t){const i=Hs(e.cosAngle),r=n7.fwd,s=n7.ortho;return dg(r,e.position1,e.position0),i*(Se(_t(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function fct(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],g=i[3*a+2];s+=l===W_||p<f?1:0,s+=c===W_||f<g?1:0,s+=h===W_||g<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],g=i[3*a+2];(l===W_||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===W_||f<g)&&(n[o++]=f,n[o++]=g,n[o++]=a,n[o++]=c),(h===W_||g<p)&&(n[o++]=g,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function mct(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=c6.v0,n=c6.v1,o=c6.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(p,o),de(n,n,s),de(o,o,s),_t(s,n,o),Te(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(IN||(IN={}));const n7={edge:{position0:M(),position1:M(),faceNormal0:M(),faceNormal1:M(),componentIndex:0,cosAngle:0},ortho:M(),fwd:M()},c6={v0:M(),v1:M(),v2:M()},gct={anglePlanar:4,angleSignificantEdge:35};class yct extends Kve{constructor(t,i,r){super(),this.distanceFalloffFactor=t,this.minimumEdgeLength=i,this.transparency=r,this.transformNormalViewFromGlobal=Qi()}}class vct extends e_e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Qi(),this.slicePlaneLocalOrigin=M(),this.transformNormalGlobalFromModel=Qi()}}function _ct(e){const t=T`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const bct=Oi(.5,-4e-4);function wct(e,t){const i=e.vertex;i.include(_ct),i.constants.add("depthBias","vec2",bct),i.uniforms.add(new Ft("inverseViewport",F.Pass,(r,s)=>s.inverseViewport)),t.legacy?(i.uniforms.add(new li("localView")),i.uniforms.add(new li("proj",F.Pass,(r,s)=>s.camera.projectionMatrix)),i.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new qp("transformNormalViewFromGlobal",F.Pass,r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new li("transformProjFromView",F.Pass,r=>r.transformProjFromView)),i.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(T`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function xct(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(T`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(T`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Tct(e,t){const i=e.vertex;t.silhouette?(i.code.add(T`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Sct(e,t){const i=e.vertex;i.uniforms.add(new ye("distanceFalloffFactor",F.Pass,r=>r.distanceFalloffFactor)),i.code.add(T`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new et("componentDataTex")),i.uniforms.add(new Ft("componentDataTexInvDim")),e.attributes.add(A.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentFieldCount","float",2),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.code.add(T`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5
);
}`),t.legacy?i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new qp("transformNormalGlobalFromModel",F.Draw,r=>r.transformNormalGlobalFromModel)),i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(A.NORMALA,"vec3"),e.attributes.add(A.NORMALB,"vec3"),i.code.add(T`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(A.NORMAL,"vec3"),i.code.add(T`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?(i.uniforms.add(new li("proj",F.Pass,(r,s)=>s.camera.projectionMatrix)),i.code.add(T`vec3 worldFromModelPosition(vec3 position) {
return (model * vec4(position, 1.0)).xyz;
}
vec3 viewFromModelPosition(vec3 position) {
return (localView * vec4(worldFromModelPosition(position), 1.0)).xyz;
}
vec4 projFromViewPosition(vec3 position) {
return proj * vec4(position, 1.0);
}`)):(i.include(dN,t),i.include(dN,t),i.uniforms.add([new li("transformProjFromView",F.Pass,r=>r.transformProjFromView),new qp("transformViewFromCameraRelativeRS",F.Pass,r=>r.transformViewFromCameraRelativeRS),new qp("transformWorldFromModelRS",F.Draw,r=>r.transformWorldFromModelRS),new ke("transformWorldFromModelTL",F.Draw,r=>r.transformWorldFromModelTL),new ke("transformWorldFromModelTH",F.Draw,r=>r.transformWorldFromModelTH),new ke("transformWorldFromViewTL",F.Pass,r=>r.transformWorldFromViewTL),new ke("transformWorldFromViewTH",F.Pass,r=>r.transformWorldFromViewTH)]),i.code.add(T`vec3 worldFromModelPosition(vec3 position) {
vec3 rotatedModelPosition = transformWorldFromModelRS * position;
vec3 transformCameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transformCameraRelativeFromModel + rotatedModelPosition;
}
vec3 viewFromModelPosition(vec3 position) {
return transformViewFromCameraRelativeRS * worldFromModelPosition(position);
}
vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`)),i.code.add(T`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Lbe(e){return e.mode===Ss.SKETCH||e.mode===Ss.MIXED}var Ss;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(Ss||(Ss={}));function Ect(e,t){const i=e.vertex;switch(t.mode){case Ss.SKETCH:i.code.add(T`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Ss.MIXED:i.code.add(T`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Ss.SOLID:i.code.add(T`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function bX(e,t){const i=e.vertex;switch(e.attributes.add(A.SIDENESS,"vec2"),t.mode===Ss.MIXED?i.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case Ss.MIXED:i.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Ss.SKETCH:i.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Ss.SOLID:i.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Ss.COUNT:break;default:t.mode}}function Act(e,t){const i=e.vertex;switch(e.include(bX,t),Lbe(t)&&i.uniforms.add(new ye("strokesAmplitude")),t.mode){case Ss.SOLID:i.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Ss.SKETCH:i.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Ss.MIXED:i.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Cct(e,t){const i=e.vertex;e.include(bX,t);const r=e.fragment;switch(Lbe(t)&&(i.uniforms.add(new Ft("strokesTextureScale")),i.uniforms.add(new ye("strokesLog2Resolution")),i.uniforms.add(new ye("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new et("strokesTexture")),r.uniforms.add(new ye("strokesNormalizationScale")),i.code.add(T`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(mh),r.code.add(T`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case Ss.SOLID:i.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(T`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Ss.SKETCH:i.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(T`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Ss.MIXED:e.varyings.add("vType","float"),i.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(T`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Rct(e){const t=new Fi,i=t.vertex,r=t.fragment;return e.legacy&&i.uniforms.add(new li("model")),e.antialiasing&&(i.code.add(T`#define ANTIALIASING 1`),r.code.add(T`#define ANTIALIASING 1`)),t.include(wct,e),t.include(Sct,e),t.include(Act,e),t.include(bX,e),t.include(Cct,e),t.include(es,e),t.include(Tct,e),t.include(xct,e),t.include(Ect,e),t.include(Qc,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new Ft("pixelToNDC",F.Pass,(s,n)=>[2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]])),i.uniforms.add(new dt("viewport",F.Pass,(s,n)=>n.camera.fullViewport)),i.uniforms.add(new ye("pixelRatio",F.Pass,(s,n)=>n.camera.pixelRatio)),t.attributes.add(A.POSITION0,"vec3"),t.attributes.add(A.POSITION1,"vec3"),t.attributes.add(A.VARIANTOFFSET,"float"),t.attributes.add(A.VARIANTSTROKE,"float"),t.attributes.add(A.VARIANTEXTENSION,"float"),i.code.add(T`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0 = worldFromModelPosition(position0);
vec3 worldPosV1 = worldFromModelPosition(position1);
vec3 viewPosV0 = viewFromModelPosition(position0);
vec3 viewPosV1 = viewFromModelPosition(position1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(T`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const Oct=Object.freeze(Object.defineProperty({__proto__:null,build:Rct},Symbol.toStringTag,{value:"Module"}));class E5 extends Ki{initializeProgram(t){const i=E5.shader.get().build(this.configuration);return new Gi(t.rctx,i,s7)}initializePipeline(t){return t.blendMinMax?Ut({blending:po(Me.ONE,Me.ONE,Me.ZERO,Me.ONE,og.ADD,t.blendMinMax.MAX),depthTest:{func:Ji.LEQUAL},colorWrite:Qt}):Ut({depthTest:{func:Ji.LEQUAL},depthWrite:ol,colorWrite:Qt})}}E5.shader=new Vi(Oct,()=>import("./EdgeShader.glsl.17a37d2e.js"));class mm extends Io{constructor(){super(...arguments),this.mode=Ss.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([B({count:Ss.COUNT})],mm.prototype,"mode",void 0),u([B()],mm.prototype,"hasSlicePlane",void 0),u([B()],mm.prototype,"silhouette",void 0),u([B()],mm.prototype,"legacy",void 0),u([B()],mm.prototype,"antialiasing",void 0),u([B()],mm.prototype,"doublePrecisionRequiresObfuscation",void 0),u([B()],mm.prototype,"hasMultipassTerrain",void 0),u([B()],mm.prototype,"cullAboveGround",void 0);const Mct=8,u6=128,Pct={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0};class Ict{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const $ct={solid:Ss.SOLID,sketch:Ss.SKETCH,uber:Ss.MIXED};class aR{constructor(t,i,r){this.rctx=t,this.shaderTechniqueRepository=i,this._configuration=new mm,this.refCount=new Ict,this.renderables=new Set,this.sortedRenderables={[Nt.TRANSPARENT]:{[Nt.TRANSPARENT]:new Vt,[Nt.OPAQUE]:new Vt},[Nt.OPAQUE]:{[Nt.TRANSPARENT]:new Vt,[Nt.OPAQUE]:new Vt}},this._renderablesDirty=!1,this._drawParameters=new vct,this._settings=L(L({},Pct),r),this.key=aR.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Ni.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=$ct[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=fM(t)}dispose(){this._technique=$i(this._technique)}addRenderable(t){this.renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,i){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[i][Nt.TRANSPARENT].forAll(t),this.sortedRenderables[i][Nt.OPAQUE].forAll(t)}updateTechnique(t,i){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(E5,this._configuration,this._technique),this._technique}bindRegularEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!1),t,i)}bindSilhouetteEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!0),t,i)}renderRegularEdges(t,i,r,s,n){this._render(t,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(t,i,r,s,n){this._render(t,i,i.silhouette.vao,r,s,n)}_render(t,i,r,s,n,o){this._bindDraw(t,i,s,o),this.rctx.bindVAO(r),this.rctx.capabilities.instancing.drawArraysInstanced(Dt.TRIANGLE_FAN,0,4,n)}_bindDraw(t,i,r,s){if(i.components.buffer.textureBuffer.bind(t,Dct,Lct),"origin"in i.transform)t.setUniformMatrix4fv("localView",s),t.setUniformMatrix4fv("model",i.transform.modelMatrix),ne(this._drawParameters.slicePlaneLocalOrigin,i.transform.origin.vec3);else{const n=new g5(i.transform.position),o=lh(Kse,ew(Kse,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=r.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,r),this._settings.type!=="uber"&&this._settings.type!=="sketch"||this._setSketchUniforms(t)}_setSketchUniforms(t){const i=this._settings.strokesTexture,r=i.texture;C(r)||(t.bindTexture("strokesTexture",r),t.setUniform2f("strokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(i.resolution)),t.setUniform1f("strokesNormalizationScale",i.normalizationScale),t.setUniform1f("strokesAmplitude",i.amplitude),t.setUniform1f("strokeVariants",i.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[Nt.TRANSPARENT][Nt.TRANSPARENT].clear(),this.sortedRenderables[Nt.TRANSPARENT][Nt.OPAQUE].clear(),this.sortedRenderables[Nt.OPAQUE][Nt.TRANSPARENT].clear(),this.sortedRenderables[Nt.OPAQUE][Nt.OPAQUE].clear(),this.renderables.forEach(i=>{i.objectTransparency!==Nt.INVISIBLE&&i.edgeTransparency!==Nt.INVISIBLE&&this.sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const t=(i,r)=>"origin"in i.transform&&"origin"in r.transform?i.transform.origin.id<r.transform.origin.id?-1:i.transform.origin.id>r.transform.origin.id?1:0:0;this.sortedRenderables[Nt.TRANSPARENT][Nt.TRANSPARENT].sort(t),this.sortedRenderables[Nt.TRANSPARENT][Nt.OPAQUE].sort(t),this.sortedRenderables[Nt.OPAQUE][Nt.TRANSPARENT].sort(t),this.sortedRenderables[Nt.OPAQUE][Nt.OPAQUE].sort(t)}static getKey(t,i,r){return`edges-t:${t}:${i}:${r}`}}const Dct="componentDataTex",Lct="componentDataTexInvDim",Kse=Xm();function ene(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:Nct(e.layout)}}function tne(e){return Fct(e.layout).createView(e.buffer)}function Nct(e){const t=new Array;return e.fields.forEach((i,r)=>{const s=ge(L({},i),{constructor:Nbe(i.constructor)});t.push([r,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function Fct(e){const t=ls();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(i=>t.fields.set(i[0],ge(L({},i[1]),{constructor:zct(i[1].constructor)}))),t}const Uct=[rM,uh,pi,yn,Pd,BS,VS,GS,yr,bb,j0,H0,cg,wb,q0,al,xb,jS,Tb,W0,Sb,HS,HR,qR,qS,Eb,WR,XR,YR,Ab,ZR,QR,JR,KR,eO,tO];function Nbe(e){return`${e.ElementType}_${e.ElementCount}`}function zct(e){return Fbe.get(e)}const Fbe=new Map;Uct.forEach(e=>Fbe.set(Nbe(e),e));function ine(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(w,S)=>{w<S?s[w+1]++:n[S+1]++};for(let w=0;w<r;w++){const S=e[3*w],x=e[3*w+1],E=e[3*w+2];o(S,x),o(x,E),o(E,S)}let a=0,l=0;for(let w=0;w<i;w++){const S=s[w+1],x=n[w+1];s[w+1]=a,n[w+1]=l,a+=S,l+=x}const c=new Uint32Array(6*r),h=s[i],p=(w,S,x)=>{if(w<S){const E=s[w+1]++;c[2*E]=S,c[2*E+1]=x}else{const E=n[S+1]++;c[2*h+2*E]=w,c[2*h+2*E+1]=x}};for(let w=0;w<r;w++){const S=e[3*w],x=e[3*w+1],E=e[3*w+2];p(S,x,w),p(x,E,w),p(E,S,w)}const f=(w,S)=>{const x=2*w,E=S-w;for(let R=1;R<E;R++){const O=c[x+2*R],I=c[x+2*R+1];let U=R-1;for(;U>=0&&c[x+2*U]>O;U--)c[x+2*U+2]=c[x+2*U],c[x+2*U+3]=c[x+2*U+1];c[x+2*U+2]=O,c[x+2*U+3]=I}};for(let w=0;w<i;w++)f(s[w],s[w+1]),f(h+n[w],h+n[w+1]);const g=new Int32Array(3*r),y=(w,S)=>w===e[3*S]?0:w===e[3*S+1]?1:w===e[3*S+2]?2:-1,v=(w,S)=>{const x=y(w,S);g[3*S+x]=-1},b=(w,S,x,E)=>{const R=y(w,S);g[3*S+R]=E;const O=y(x,E);g[3*E+O]=S};for(let w=0;w<i;w++){let S=s[w];const x=s[w+1];let E=n[w];const R=n[w+1];for(;S<x&&E<R;){const O=c[2*S],I=c[2*h+2*E];O===I?(b(w,c[2*S+1],I,c[2*h+2*E+1]),S++,E++):O<I?(v(w,c[2*S+1]),S++):(v(I,c[2*h+2*E+1]),E++)}for(;S<x;)v(w,c[2*S+1]),S++;for(;E<R;)v(c[2*h+2*E],c[2*h+2*E+1]),E++}return g}async function kct(e){const t=Bct(e),i=wX(t),r=[t.data.buffer];return{result:Vct(i,r),transferList:r}}function wX(e){const t=Gct(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return rne.updateSettings(e.writerSettings),sne.updateSettings(e.writerSettings),uct(t,rne,sne)}function Bct(e){return{data:RN.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function Vct(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:ene(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:ene(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function Gct(e,t,i,r){if(t)return{faces:i,facesLength:r,neighbors:ine(i,r,e.count),vertices:e};const s=Lve(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:r}),n=ine(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:RN.createView(s.buffer)}}const rne=new MN,sne=new PN;var jct=Object.freeze(Object.defineProperty({__proto__:null,work:wX,wrappedWork:kct},Symbol.toStringTag,{value:"Module"}));class Hct extends F1e{constructor(t){super("EdgeProcessingWorker","wrappedWork",t)}async process(t,i,r){if(r)return wX(t);const s=this._packInput(t),n=await this.invoke(s,i);return this._unpackOutput(n)}getTransferList(t){return[t.dataBuffer]}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:yD(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:tne(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:tne(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function qct(e){const i=eA.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=eA.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=eA.strokes.length;let p=(c-1)*h*l;for(const{distance:g,pressure:y}of eA.strokes){let v=g,b=y,w=p;for(let S=0;S<c;S++){S!==0&&(v=nne(v,CO.DISTANCE),b=nne(b,CO.PRESSURE));for(let x=0;x<eA.resolution;x++){const E=.5+(v?v[x%v.length]/a:0),R=b?b[x%b.length]:1;iN(E,s,w),iN(R,s,w+n),w+=4}w-=l*(h+1)}p+=l}const f=new ot(e,{pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:Je.LINEAR,width:i,height:i,wrapMode:bt.REPEAT},s);return new Xct(i,a,o,h,f)}function nne(e,t){if(!e)return null;const i=e.length/2,r=Wct*i,s=new Array(i);let n=0;const o=t===CO.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*one):Math.min(r,l*one)}return s}var CO;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(CO||(CO={}));const Wct=.1,one=.5;class Xct{constructor(t,i,r,s,n){this.resolution=t,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=it(this.texture)}}const eA={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function ane(e){let t=null;for(const i of e){const r=i.type;if(Yct(i)){if(C(t))t=r;else if(t!==r)return"uber"}}return _(t)?t:"uber"}function h6(e){let t=Nt.INVISIBLE;for(const{material:i}of e)if(Ube(i)){if(i.color[3]*i.opacity<1)return Nt.TRANSPARENT;t=Nt.OPAQUE}return t}function d6(e){let t=Nt.INVISIBLE;for(const{material:i}of e)if(Ube(i)){switch(i.objectTransparency){case Nt.TRANSPARENT:case Nt.INVISIBLE:return Nt.TRANSPARENT;case Nt.OPAQUE:if(i.opacity<1)return Nt.TRANSPARENT}t=Nt.OPAQUE}return t}function Ube(e){return e.size*e.color[3]*e.opacity>0}function Yct(e){return e.size*e.color[3]>0}function Zct(e,t){const i=kwe(e,t,!0);return i===-1?t<e[0]?0:e.length:i}function lne(e,t,i){return e.length-Zct(e,t*i.minimumEdgeLength)}function cne(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}const Qct=pe.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let xp=class extends be{constructor(e){super(e),this.updatingHandles=new jp,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[Nt.TRANSPARENT]:0,[Nt.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=M(),this.localOrigins=new oct(new LW(e.renderSR))}initialize(){this.worker=new Hct(this.schedule),this.componentColorManager=new Sbe(this.rctx,2);const e=Ibe.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=si.createVertex(this.rctx,mi.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=it(this.strokesTexture),this.componentColorManager=ct(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=it(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[Nt.TRANSPARENT]+this.numberOfRenderedEdges[Nt.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new une(new Promise(p=>l=p),i.center,i.radius);this.perObjectData.set(e,c);const h=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void Qct.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this.perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new une(new Promise(c=>n=c),Yc(o),wF(o));this.perObjectData.set(e,a);const l=new Array;if(i.mergeGeometries&&e.geometries.length>1&&Kct(e))l.push(this._addObjectMergedGeometries(e,a,t,i,r));else for(let c=0;c<e.geometries.length;c++){const h=e.geometryRecords[c];if(!h.material.supportsEdges)continue;const p=e.geometries[c];l.push(this._addGeometry(e,a,p,h,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?r=>t[r]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{const s=r.components.meta.length;for(let n=0;n<s;n++){const o=i(n),a=r.components.meta[n],l=a.index;a.material.opacity=o,r.components.buffer.textureBuffer.setDataElement(l,1,3,255*o)}this._updateTransparency(r)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,i)=>t+i.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof Eg,n=!!i.hasSlicePlane,o=ane(t),a=aR.getKey(o,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(l=>{if(a!==l.rendererKey){const c=this.renderers.get(l.rendererKey),h=this._acquireRenderer(o,n,s);c.removeRenderable(l),c.refCount.decrement(),l.rendererKey=a,h.addRenderable(l)}for(let c=0;c<t.length;c++)l.components.meta[c].material=t[c];r&&this._updateComponentBuffer(l.components),this._updateTransparency(l)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>i.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";return await t.loaded,t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,C(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=M(),s=new g5;let n=0,o=0;if(this.renderers.forEach(h=>{h.refCount.value===0?(this.renderers.delete(h.key),h.dispose()):h.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,p.regular&&h.updateTechnique(e,!1),p.silhouette&&h.updateTechnique(e,!0))},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),o===0)return;const a=40*n/o,l=e.camera.perScreenPixelRatio,c=new yct(a,l,t);se(r,i[3],i[7],i[11]),s.set(r),ne(c.transformWorldFromViewTH,s.high),ne(c.transformWorldFromViewTL,s.low),Wl(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),lh(hne,c.transformViewFromCameraRelativeRS),ew(c.transformNormalViewFromGlobal,hne),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach(h=>{this._renderRegularEdges(h,e,c),this._renderSilhouetteEdges(h,e,c)})}_updateTransparency(e){const t=h6(e.components.meta),i=d6(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),_(t.origin))this.localOrigins.register(t.origin);else{const r=se(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(r)}return sct(t.origin.vec3,i),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:i}=e;for(let r=0;r<t.length;r++){const s=t[r].material,n=t[r].index,o=He(Math.round(s.size*Mct),0,255),a=He(s.extensionLength,-u6,255-u6)+u6,l=s.type==="solid"?IN.SOLID:IN.SKETCH,c=255*s.opacity,h=s.color,p=255*h[0],f=255*h[1],g=255*h[2],y=255*h[3];i.textureBuffer.setData(n,0,p,f,g,y),i.textureBuffer.setData(n,1,o,a,l,c)}}_createComponentBuffers(e){if(C(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=i.acquireIndex();t.push({index:o,material:n})}const r={meta:t,buffer:i};return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}_createEdgeResources(e){const t={};if(C(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new Os(this.rctx,s7,{vertices:Qse,instances:MN.glLayout},{vertices:this.verticesBufferObject,instances:si.createVertex(this.rctx,mi.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new Os(this.rctx,s7,{vertices:Qse,instances:PN.glLayout},{vertices:this.verticesBufferObject,instances:si.createVertex(this.rctx,mi.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,i,r,s,n,o){const a=i.vertexAttributes.get(A.POSITION),l=i.indices.get(A.POSITION),c=Ae(),h={position:a,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,r,c)};return this._addPositionData(t,h,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,i,r,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([r]);if(C(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,f=p.data.length/p.size,g=RN.createBuffer(f);for(let x=0;x<f;x++)g.position.set(x,0,p.data[x*p.size+0]),g.position.set(x,1,p.data[x*p.size+1]),g.position.set(x,2,p.data[x*p.size+2]);cne(o.meta,[0,g.componentIndex.count],g.componentIndex);const y=await this.updatingHandles.addPromise(this._extractEdges(a.writerSettings,g,!1,n,h,i));if(e.loaded==null)return;const{regular:v,silhouette:b}=this._createEdgeResources(y),w=(v?v.vao.size:0)+(b?b.vao.size:0),S={regular:v,silhouette:b,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:w,externalMemoryUsage:!1,averageEdgeLength:y.averageEdgeLength},components:o,visible:!0,edgeTransparency:h6(o.meta),objectTransparency:d6(o.meta),distanceToCamera:0,rendererKey:a.key};e.renderables.push(S),a.addRenderable(S),this.gpuMemoryUsage+=w}async _addComponentGeometry(e,t,i,r,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(C(a))return 0;const l=ane(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=RN.createBuffer(i.count);e5(h.position,i),cne(a.meta,s,h.componentIndex,r);const p=!0,f=c.writerSettings,g=await this.updatingHandles.addPromise(this._extractEdges(f,h,p,!1,r));if(t.loaded==null)return 0;const{regular:y,silhouette:v}=this._createEdgeResources(g),b=(y?y.vao.size:0)+(v?v.vao.size:0),w={regular:y,silhouette:v,transform:e,statistics:{gpuMemoryUsage:b,externalMemoryUsage:!0,averageEdgeLength:g.averageEdgeLength},components:a,visible:!0,edgeTransparency:h6(a.meta),objectTransparency:d6(a.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(w),c.addRenderable(w),b}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let w=0;w<e.geometries.length;w++){const S=e.geometries[w],x=e.geometryRecords[w];if(!x.material.supportsEdges)continue;!a&&x.origin&&(a=x);const E=S.vertexAttributes.get(A.POSITION);l+=E.data.length/E.size,o+=S.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let w=0;w<e.geometries.length;w++){const S=e.geometries[w];if(!e.geometryRecords[w].material.supportsEdges)continue;const x=S.vertexAttributes.get(A.POSITION),E=S.indices.get(A.POSITION);let R=n.get(x.data);if(R==null){R=p.length/3;for(let O=0;O<x.data.length;O+=x.size)p.push(x.data[O+0]),p.push(x.data[O+1]),p.push(x.data[O+2]);n.set(x.data,R)}if(E)for(let O=0;O<S.edgeIndicesLength;O++)h[f++]=R+E[O]}const g=a||e.geometryRecords[0],y=Ae(),v=this._computeModelTransformWithLocalOrigin(e,g,y);for(let w=0;w<e.geometryRecords.length;w++)e.geometryRecords[w].origin=v;const b={position:{data:p,size:3},indices:h,modelTransform:y,origin:v};await this.updatingHandles.addPromise(this._addPositionData(t,b,h.length,i[0],r,s))}_acquireRenderer(e,t,i){const r=aR.getKey(e,t,i);let s=this.renderers.get(r);return C(this.strokesTexture)&&(this.strokesTexture=qct(this.rctx)),s||(s=new aR(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:i}),this.renderers.set(r,s)),s.refCount.increment(),s}_removeRenderable(e){Jct(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=M(),s=n=>{const{center:o,radius:a}=n;Qp(r,o,t);const l=Se(r,i),c=l<-a?1/0:l<a?0:l-a;n.renderables.forEach(h=>h.distanceToCamera=c)};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){const r=e.bindRegularEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.regular)return;const o=lne(n.regular.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Es;e.renderRegularEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}_renderSilhouetteEdges(e,t,i){const r=e.bindSilhouetteEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.silhouette)return;const o=lne(n.silhouette.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Es;e.renderSilhouetteEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}};function Jct(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function Kct(e){let t=null,i=null;for(let s=0;s<e.geometries.length;s++){var r;const n=e.geometryRecords[s];if(n.material.supportsEdges){if(t){if(!I0(t,n.transformation))return!1}else t=n.transformation;if(!i&&_(n.origin))i=n;else if(_((r=i)==null?void 0:r.origin)&&_(n.origin)&&i.origin.id!==n.origin.id)return!1}}return!0}u([d({constructOnly:!0})],xp.prototype,"rctx",void 0),u([d({constructOnly:!0})],xp.prototype,"renderSR",void 0),u([d({constructOnly:!0})],xp.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],xp.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],xp.prototype,"schedule",void 0),u([d({readOnly:!0})],xp.prototype,"updatingHandles",void 0),u([d({readOnly:!0})],xp.prototype,"updating",null),xp=u([P("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],xp);class une{constructor(t,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}const hne=Qi();function eut(e){const t=e.capabilities.disjointTimerQuery;return C(t)?null:t.timestampBits()>0?new tut(t):o7?null:new iut(t)}class tut{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,i=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,i)}_checkQueryResult(t,i){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,i),i);if(this.timer.disjoint())return void t(null);const r=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-r)/1e6)}}class iut{constructor(t){this.timer=t,this.query=t.createQuery(),o7=!0,this.timer.beginTimeElapsed(this.query)}stop(t,i=50){this.timer.endTimeElapsed(),o7=!1,this._checkQueryResult(t,i)}_checkQueryResult(t,i){const r=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!r||s)s?t(null):setTimeout(()=>this._checkQueryResult(t,i),i);else{const n=this.timer.getResult(this.query);t(n/1e6)}}}let o7=!1;var fs;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})(fs||(fs={}));const rut=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class sut extends w0{constructor(){super("total"),this.total=0,this.frameCount=0}}class nut{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new sut,this.gpuTime=new w0("gpu",9),this.renderPassTimings=rut.map(t=>new w0(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:m7(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=eut(t))}advance(t){const i=performance.now();this.renderPassTimings[t].record(i-this._lastSample),this._lastSample=i}postrender(){_(this._gpuTimer)&&(this._gpuTimer.stop(i=>_(i)&&this.gpuTime.record(i),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const dne=.9;let gm=class extends be{constructor(e,t,i,r,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new nut,this._antialiasing=l1.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new Jt,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new _C(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new Ilt(this._rctx,this._compositingHelper),this._sliceHelper=new tct,this._shadowMap=new NW(this._rctx,l.viewingMode,2),this._ssaoHelper=new f_e(i,this._rctx,()=>this._requestRender()),this._highlight=new Rlt(i,this._rctx),this._shadowHighlight=new ect(this._rctx,l.viewingMode),this._shadowAccumulator=new To(this._rctx,i,l,(c,h)=>{const p=this.shadowsEnabled;this._shadowMap.enabled=!0,this._renderPlugins.prepareRender(c,h),this._shadowMap.enabled=p},(c,h,p,f)=>{c.start(p,h,f),this._renderShadowCascades(Ue.MATERIAL_DEPTH_SHADOWMAP_ALL,c),p.setGLViewport(this._rctx),this._ensureCameraBindParameters(p)},()=>this._requestRender()),this._renderContext=new bYe(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new Llt({renderContext:this._renderContext,shaderTechniqueRepository:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new ylt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([xe(()=>this._stage.state.camera,()=>this._requestRender(),xs),xe(()=>Ni.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Nt.TRANSPARENT):()=>{},this._requestRender()},Bi)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=ct(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=it(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),a4.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===l1.SMAA&&this._smaaPass.updating||_(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return C(this._edgeView)&&(this._edgeView=new xp({rctx:this._rctx,renderSR:this._stage.renderSR,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(xe(()=>Ks(this._edgeView,e=>e.updating),()=>this._requestRender(),Qr)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return Dj(this._bindParameters.ssr.reprojectionMatrix,Es)}set _reprojectionMatrix(e){d7(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!((e=this._shadowMap)==null||!e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:i,_bindParameters:r}=this;e.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.enableFillLights!==void 0&&r.enableFillLights!==e.enableFillLights&&(r.enableFillLights=e.enableFillLights,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.ssao!==void 0&&i.enabled!==e.ssao&&(i.enabled=e.ssao,this._requestRender()),e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?l1.SMAA:l1.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.waterReflectionEnabled&&(this._waterReflectionEnabled=e.waterReflectionEnabled,this._requestRender()),e.enableFillLights!==void 0&&r.enableFillLights!==e.enableFillLights&&(r.enableFillLights=e.enableFillLights,this._requestRender()),e.transparentTerrain!==void 0&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(t.length===0&&i.length===0&&r.length===0)return;i.forAll(({id:o})=>this._content.delete(o)),t.forAll(o=>this._content.set(o.id,o));const s=Jve(e);let n=!1;s.forEach((o,a)=>{let l=this._materialRenderers.get(a);if(!l){if(!(o.adds.length>0))return;l=new h_e(this._rctx,this._materialRepository,a),this._materialRenderers.set(a,l)}l.modify(o),l.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((o,a)=>{o.isEmpty&&(this._materialRenderers.delete(a),o.dispose())}),this._hasHighlights=Us(this._materialRenderers,o=>o.hasHighlights),this._bindParameters.hasOccludees=Us(this._materialRenderers,o=>o.hasOccludees),this._hasWater=Us(this._materialRenderers,o=>o.hasWater),this._needsTransparentPass=Us(this._materialRenderers,o=>o.requiresSlot(we.TRANSPARENT_MATERIAL,Ue.MATERIAL)),this._hasHUDElements=Us(this._materialRenderers,o=>o.requiresSlot(we.LINE_CALLOUTS_HUD_DEPTH,Ue.MATERIAL)||o.requiresSlot(we.HUD_MATERIAL,Ue.MATERIAL)||o.requiresSlot(we.LABEL_MATERIAL,Ue.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,i){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=i,this._bindParameters.lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=gt.NONE;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=av(this._sliceHelper.plane);r===vb.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._renderPlugins.prepareRender(t,i),this.performanceInfo.advance(fs.Prepare);const o=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,o),this.performanceInfo.advance(fs.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t),this._renderLinearDepth(),this.performanceInfo.advance(fs.Lineardepth),this._accumulateShadows(o,t,i),this._renderNormal(),this.performanceInfo.advance(fs.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance(fs.SSAO),this._renderContext.pass=Ue.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(fs.Opaque);const a=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(a),this._setMultipassEnabled(a),this._setTerrainCulling(a),this._renderEdges(Nt.OPAQUE),this.performanceInfo.advance(fs.OpaqueEdges),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(fs.Transparent),this._renderGeometryLinearDepth(a);const c=this._renderHUDVisibility();a||this._renderInternalSlot(we.LINE_CALLOUTS),this.performanceInfo.advance(fs.Hudvisibility),this._renderEdges(Nt.TRANSPARENT,a),this.performanceInfo.advance(fs.TransparentEdges),this._renderSlot(we.VOXEL),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(a?this._renderLineCallouts(Lu.Occluded):s.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Lu.Occluded,s.framebuffer),this.performanceInfo.advance(fs.HudOccluded)),this.performanceInfo.advance(fs.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(s.compositeTransparentTerrainOntoMain(this._bindParameters),a&&(this._renderEdges(Nt.OPAQUE),this.performanceInfo.advance(fs.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(fs.Transparent),this._renderEdges(Nt.TRANSPARENT),this.performanceInfo.advance(fs.TransparentEdges))),a&&this._renderLineCallouts(Lu.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.renderToTargets(()=>{this._renderInternalSlot(we.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(we.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(we.LASERLINES)},s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(fs.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain(()=>this._renderSlot(we.LASERLINES_CONTRAST_CONTROL),this._bindParameters,ro.PremultipliedAlpha),this.performanceInfo.advance(fs.Laserline),this._renderOccluded(),this.performanceInfo.advance(fs.Occluded);const h=r===vb.ON&&this._magnifierHelper.enabled,p=h&&C(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(p);const f=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,f)&&_(f)&&this._compositingHelper.composite(this._bindParameters,f,ro.None),this.performanceInfo.advance(fs.Antialiasing),this._renderHUD(Lu.NotOccluded,p),this.performanceInfo.advance(fs.HudNotoccluded),this._renderHighlights(p,this._bindParameters),this.performanceInfo.advance(fs.Highlights),h&&this._magnifierHelper.render(this._rctx,this._bindParameters),p!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,ro.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===bs.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/mlt;this._animationTimestep=Math.max(this._animationTimestep*dne+t*(1-dne),glt)}}readDepthPixels(e,t,i,r,s,n){const o=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const a=ki.COLOR_BUFFER_BIT|ki.DEPTH_BUFFER_BIT|ki.STENCIL_BUFFER_BIT;this._rctx.clearSafe(a),this._renderGeometryAndTransparentTerrainPass(Ue.MATERIAL_DEPTH)}o.readPixels(t,i,r,s,ze.RGBA,Ct.UNSIGNED_BYTE,n)}readHUDVisibility(e,t,i,r,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,i,r,ze.RGBA,Ct.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;_(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,ro.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&(s.start(t,i,r),this._shadowHighlight.updateParameters(t,i),this.needsShadowHighlight?(this._renderShadowCascades(Ue.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,i2.Highlight)),s.clear(),this._renderShadowCascades(Ue.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,i2.Default),this._renderGeometryAndTransparentTerrainPass(Ue.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(Ue.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=r=>{}){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(Ue.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.ssr.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=Ue.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(Ue.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(Ue.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return QG;const t=rlt(e,this._content,this._stage.layers);return o2(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(we.INTEGRATED_MESH),this._renderSlot(we.OPAQUE_TERRAIN),this._renderInternalSlot(we.OPAQUE_MATERIAL),this._renderSlot(we.OPAQUE_MATERIAL),this._renderSlot(we.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(we.TRANSPARENT_MATERIAL),this._renderSlot(we.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(we.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(we.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Lu.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(we.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(we.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,ro.PremultipliedAlpha)):e===Lu.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(Lu.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(we.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(we.HUD_MATERIAL),this._renderInternalSlot(we.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlight,r=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(Ue.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(ki.DEPTH_BUFFER_BIT),this._renderHUDElements(Lu.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),i.render(this._bindParameters,r,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,i)}_renderOrderIndependentTransparency(e,t){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreenRendering.renderOITPass(()=>e(),s,t)},r=this._renderContext.pass;this._renderContext.pass=Ue.MATERIAL_ALPHA,i(gt.Alpha),this._renderContext.pass=Ue.MATERIAL,i(gt.Color),i(gt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=gt.NONE,this._renderContext.pass=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&o.renderOccluded===wr.OccludeAndTransparentStencil&&(e|=o.renderOccluded,iA.push(o))});const t=this._offscreenRendering,i=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};iA.length!==0&&(this._renderInternalSlot(we.OCCLUDER_MATERIAL,iA),i(.5,wr.OccludeAndTransparentStencil,()=>this._renderInternalSlot(we.TRANSPARENT_OCCLUDER_MATERIAL,iA),!1,!1),iA.length=0),this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&(o.renderOccluded===wr.OccludeAndTransparent||o.renderOccluded===wr.Transparent||o.renderOccluded===wr.Opaque)&&(e|=o.renderOccluded,tA.push(o))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>wr.Occlude&&this._renderSlot(we.OCCLUDED_TERRAIN),this._renderInternalSlot(we.OPAQUE_MATERIAL,tA),this._renderInternalSlot(we.TRANSPARENT_MATERIAL,tA),this._renderInternalSlot(we.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,tA),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=Ue.MATERIAL,i(.5,wr.OccludeAndTransparent,()=>s(wr.OccludeAndTransparent),!0,Za.OutlineVisualElementMask),i(.5,wr.Transparent,()=>s(wr.Transparent),!0,Za.OutlineVisualElementMask),i(1,wr.Opaque,()=>s(wr.Opaque),!0,Za.OutlineVisualElementMask),tA.length=0}_renderAntiAliasing(e,t){if(e===l1.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&_(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e){this._bindParameters.camera=e}_ensureBindParameters(e){var t;this._ensureCameraBindParameters(e);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(t=i.depthTexture)!=null?t:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Es:(jr(fne,this._bindParameters.camera.viewMatrix),jr(pne,this._bindParameters.camera.projectionMatrix),xr(sx,fne,pne),xr(sx,this._renderContext.lastFrameCamera.viewMatrix,sx),xr(sx,this._renderContext.lastFrameCamera.projectionMatrix,sx),this._reprojectionMatrix=sx),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,_(t)?t.forEach(r=>{if(!r.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(r);_(s)&&(i=s.render(this._renderContext.pass,this._bindParameters)||i)}):this._materialRenderers.forEach((r,s)=>{s.shouldRender(this._renderContext)&&r.render(this._renderContext.pass,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=Sge(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,s,n,o,a,l,c;return{offscreen:(e=(t=this._offscreenRendering)==null?void 0:t.gpuMemoryUsage)!=null?e:0,highlights:((i=(r=this._highlight)==null?void 0:r.gpuMemoryUsage)!=null?i:0)+((s=(n=this._shadowHighlight)==null?void 0:n.gpuMemoryUsage)!=null?s:0),shadows:(o=(a=this._shadowMap)==null?void 0:a.gpuMemoryUsage)!=null?o:0,ssao:(l=(c=this._ssaoHelper)==null?void 0:c.gpuMemoryUsage)!=null?l:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case Zy.Color:return e._offscreenRendering.colorTexture;case Zy.LinearDepth:return e._offscreenRendering.linearDepthTexture;case Zy.Normals:return e._offscreenRendering.normalTexture;case Zy.ShadowMap:return e._shadowMap.depthTexture;case Zy.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case Zy.Highlight:return e._offscreenRendering.highlightTexture}}}}};var Zy;u([d()],gm.prototype,"_shadowAccumulator",void 0),u([d()],gm.prototype,"_smaaPass",void 0),u([d()],gm.prototype,"_antialiasing",void 0),u([d()],gm.prototype,"_edgeView",void 0),u([d()],gm.prototype,"updating",null),u([d()],gm.prototype,"isCameraFinal",null),gm=u([P("esri.views.3d.webgl-engine.lib.Renderer")],gm),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(Zy||(Zy={}));const tA=[],iA=[],pne=Ae(),fne=Ae(),sx=Ae();class mne{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Me.ONE,dstRGB:Me.ZERO,srcAlpha:Me.ONE,dstAlpha:Me.ZERO},this.blendEquation={mode:og.ADD,modeAlpha:og.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=qa.BACK,this.frontFace=ES.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Ji.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:qa.FRONT_AND_BACK,func:Ji.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:qa.FRONT_AND_BACK,fail:tr.KEEP,zFail:tr.KEEP,zPass:tr.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class out{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(i=>{var r;t.set(i,((r=t.get(i))!=null?r:0)+1)}),t.forEach((i,r)=>{const s=r.split(`
`);s.shift(),s.shift(),console.log(`${i}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}const aut={RECORD_ALLOCATIONS:!1};class lut{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new out(aut.RECORD_ALLOCATIONS);this._current.length<en.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,i){const r=++this._current[t];this._max[t]=Math.max(r,this._max[t]),this._allocations.add(i)}decrement(t,i){--this._current[t],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,i)=>t+i,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<en.COUNT;++t){const i=this._current[t];i>0&&console.log(`${en[t]}: ${i}`)}}this._allocations.print()}}const cut=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var gne,zbe={exports:{}};(gne=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(zbe.exports=gne);const uut=zbe.exports;var yne,kbe={exports:{}};yne=kbe,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(yne.exports=t)}();const vne=kbe.exports;var Bbe={exports:{}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();i!==void 0&&(e.exports=i)})()})(Bbe);const hut=Bbe.exports;var Rh=999,_ne=9999,p6=0,f6=1,bne=2,wne=3,xne=4,gI=5,dut=6,put=7,fut=8,Tne=9,mut=10,Sne=11,gut=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function yut(){var e,t,i,r=0,s=0,n=Rh,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,g="";return function(H){return a=[],H!==null?v(H.replace?H.replace(/\r\n/g,`
`):H):b()};function y(H){H.length&&a.push({type:gut[n],data:H,position:h,line:l,column:c})}function v(H){var J;for(r=0,i=(g+=H).length;e=g[r],r<i;){switch(J=r,n){case p6:r=R();break;case f6:r=E();break;case bne:r=x();break;case wne:r=O();break;case xne:r=N();break;case Sne:r=U();break;case gI:r=V();break;case _ne:r=j();break;case Tne:r=S();break;case Rh:r=w()}J!==r&&(g[J]===`
`?(c=0,++l):++c)}return s+=r,g=g.slice(r),a}function b(H){return o.length&&y(o.join("")),n=mut,y("(eof)"),a}function w(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+r-1,n=p6,t=e,r+1):t==="/"&&e==="/"?(h=s+r-1,n=f6,t=e,r+1):e==="#"?(n=bne,h=s+r,r):/\s/.test(e)?(n=Tne,h=s+r,r):(p=/\d/.test(e),f=/[^\w_]/.test(e),h=s+r,n=p?xne:f?wne:_ne,r)}function S(){return/[^\s]/g.test(e)?(y(o.join("")),n=Rh,r):(o.push(e),t=e,r+1)}function x(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,r+1):(y(o.join("")),n=Rh,r)}function E(){return x()}function R(){return e==="/"&&t==="*"?(o.push(e),y(o.join("")),n=Rh,r+1):(o.push(e),t=e,r+1)}function O(){if(t==="."&&/\d/.test(e))return n=gI,r;if(t==="/"&&e==="*")return n=p6,r;if(t==="/"&&e==="/")return n=f6,r;if(e==="."&&o.length){for(;I(o););return n=gI,r}if(e===";"||e===")"||e==="("){if(o.length)for(;I(o););return y(e),n=Rh,r+1}var H=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||H){for(;I(o););return n=Rh,r}return o.push(e),t=e,r+1}function I(H){for(var J,K,he=0;;){if(J=vne.indexOf(H.slice(0,H.length+he).join("")),K=vne[J],J===-1){if(he--+H.length>0)continue;K=H.slice(0,1).join("")}return y(K),h+=K.length,(o=o.slice(K.length)).length}}function U(){return/[^a-fA-F0-9]/.test(e)?(y(o.join("")),n=Rh,r):(o.push(e),t=e,r+1)}function N(){return e==="."||/[eE]/.test(e)?(o.push(e),n=gI,t=e,r+1):e==="x"&&o.length===1&&o[0]==="0"?(n=Sne,o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=Rh,r):(o.push(e),t=e,r+1)}function V(){return e==="f"&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=Rh,r):(o.push(e),t=e,r+1)}function j(){if(/[^\d\w_]/.test(e)){var H=o.join("");return n=uut.indexOf(H)>-1?fut:hut.indexOf(H)>-1?put:dut,y(o.join("")),n=Rh,r}return o.push(e),t=e,r+1}}function vut(e){var t=yut(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function _ut(e){return vut(e)}function but(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const m6=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function wut(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function xut(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function bC(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,bC(e,t,r+"_"+t[r],r);return i}function Vbe(e,t,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const g=l[f];if(g.type==="preprocessor"&&(g.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:g.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||g.type==="preprocessor"&&/^#version/.test(g.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&g.type==="keyword"&&g.data==="precision"){const y=r(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function Tut(e,t,i,r="lowp"){Vbe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function Sut(e,t,i,r,s="lowp"){Vbe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function Eut(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&e.splice(i,r-i+1),s}function Ene(e,t){const i=Aut();if(_(i))return i;const r=_ut(e);if(wut(r,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":t===Mc.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===Mc.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===Mc.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=bC(r,o,"fragColor"),Tut(r,s,"vec4")),c.data=s),t===Mc.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=Eut(r,l+1),p=bC(r,o,"fragData");Sut(r,p,"vec4",h,"mediump"),c.data=p}else t===Mc.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=bC(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if(cut.includes(c.data)){if(t===Mc.VERTEX_SHADER&&xut(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=bC(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&m6.includes(h[1].trim())){const g=r[l+1];r.splice(l,g&&g.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&m6.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&m6.includes(f[1].trim())&&(c.data="#if 0")}}return Cut(e,but(r))}function Aut(e){return null}function Cut(e,t){return t}const Rut=4294967295;class Out{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===xi.WEBGL2&&(i=Ene(i,Mc.VERTEX_SHADER),r=Ene(r,Mc.FRAGMENT_SHADER)),this._vShader=Ane(this._context,Mc.VERTEX_SHADER,i),this._fShader=Ane(this._context,Mc.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(en.Shader,this),kR()&&(this.vertexShader=i,this.fragmentShader=r)}get glName(){if(_(this._glName))return this._glName;if(C(this._vShader))return null;const t=this._context.gl,i=t.createProgram();if(t.attachShader(i,this._vShader),t.attachShader(i,this._fShader),this._locations.forEach((r,s)=>t.bindAttribLocation(i,r,s)),t.linkProgram(i),kR()&&!t.getProgramParameter(i,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(i,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(i)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===xi.WEBGL2){const r=t;for(const[s,n]of this._uniformBlockBindings){const o=r.getUniformBlockIndex(i,s);o<Rut&&r.uniformBlockBinding(i,o,n)}}return this._glName=i,this._context.instanceCounter.increment(en.Program,this),i}get hasGLName(){return _(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(en.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(en.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){ip(this._nameToUniform1v,t,i)&&this._context.gl.uniform1iv(this._getUniformLocation(t),i)}setUniform2iv(t,i){ip(this._nameToUniform2,t,i)&&this._context.gl.uniform2iv(this._getUniformLocation(t),i)}setUniform3iv(t,i){ip(this._nameToUniform3,t,i)&&this._context.gl.uniform3iv(this._getUniformLocation(t),i)}setUniform4iv(t,i){ip(this._nameToUniform4,t,i)&&this._context.gl.uniform4iv(this._getUniformLocation(t),i)}setUniform1f(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){ip(this._nameToUniform1v,t,i)&&this._context.gl.uniform1fv(this._getUniformLocation(t),i)}setUniform2f(t,i,r){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),this._nameToUniform2.set(t,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s[0]=i,s[1]=r)}setUniform2fv(t,i){ip(this._nameToUniform2,t,i)&&this._context.gl.uniform2fv(this._getUniformLocation(t),i)}setUniform3f(t,i,r,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),this._nameToUniform3[t]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(t,i){ip(this._nameToUniform3,t,i)&&this._context.gl.uniform3fv(this._getUniformLocation(t),i)}setUniform4f(t,i,r,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),this._nameToUniform4.set(t,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(t,i){ip(this._nameToUniform4,t,i)&&this._context.gl.uniform4fv(this._getUniformLocation(t),i)}setUniformMatrix3fv(t,i,r=!1){ip(this._nameToUniformMatrix3,t,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i)}setUniformMatrix4fv(t,i,r=!1){ip(this._nameToUniformMatrix4,t,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i)}stop(){}}function Ane(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),kR()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===Mc.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(Mut(i))),s}function Mut(e){let t=2;return e.replace(/\n/g,()=>`
`+Put(t++)+":")}function Put(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function ip(e,t,i){const r=e.get(t);return r?d7(r,i):(e.set(t,Array.from(i)),!0)}class Iut{constructor(t){this._rctx=t,this._store=new IW}dispose(){this._store.forEach(t=>t.forEach(i=>i.dispose())),this._store.clear()}acquire(t,i,r,s){const n=this._store.get(t,i);if(_(n))return n.ref(),n;const o=new Out(this._rctx,t,i,r,s);return o.ref(),this._store.set(t,i,o),o}get test(){let t=0;return this._store.forEach(i=>i.forEach(r=>t+=r.hasGLName?2:1)),{cachedWebGLObjects:t}}}function Cne(e,t){const i=new hr(e,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE},{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1});function r(w,S){const x=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,E=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,R=e.programCache.acquire(x,E,new Map([["position",0]])),O=new Float32Array(6);aG(w,O,3);const I=new Float32Array(6);return aG(S,I,3),e.useProgram(R),R.setUniform3f("u_highA",O[0],O[2],O[4]),R.setUniform3f("u_lowA",O[1],O[3],O[5]),R.setUniform3f("u_highB",I[0],I[2],I[4]),R.setUniform3f("u_lowB",I[1],I[3],I[5]),R}const s=si.createVertex(e,mi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new Os(e,new Map([["position",0]]),{geometry:[new Un("position",2,ut.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Le(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Le(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=r(o,a),c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:g}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(Dt.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);i.readPixels(0,0,1,1,ze.RGBA,Ct.UNSIGNED_BYTE,y),l.dispose(),n.dispose(!1),s.dispose(),i.dispose(),e.setViewport(h,p,f,g),e.bindFramebuffer(c);const v=(o[2]-a[2])/25,b=gW(y);return Math.abs(v-b)}var Rne,One,Mne,Gbe={exports:{}};function $ut(e){var t,i,r,s,n;if(!e.gl)return!1;if(e.type===xi.WEBGL1)return!((s=e.capabilities.textureFloat)==null||!s.textureFloat||(n=e.capabilities.colorBufferFloat)==null||!n.textureFloat);if(!(((t=e.capabilities.textureFloat)==null?void 0:t.textureFloat)&&((i=e.capabilities.colorBufferFloat)==null?void 0:i.textureFloat)&&((r=e.capabilities.colorBufferFloat)==null?void 0:r.floatBlend)))return!1;const o=new hr(e,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE},{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.FLOAT,internalFormat:mt.RGBA32F,samplingMode:Je.NEAREST,width:1,height:1}),a=si.createVertex(e,mi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),l=new Os(e,new Map([["a_pos",0]]),{geometry:[new Un("a_pos",2,ut.UNSIGNED_SHORT,0,4)]},{geometry:a}),c=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,h=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,p=e.programCache.acquire(c,h,new Map([["a_pos",0]]));e.useProgram(p);const f=e.getBoundFramebufferObject(),{x:g,y,width:v,height:b}=e.getViewport();e.bindFramebuffer(o),e.setViewport(0,0,1,1),e.bindVAO(l),e.drawArrays(Dt.TRIANGLE_STRIP,0,4);const w=Ut({blending:J0e});e.setPipelineState(w),e.drawArrays(Dt.TRIANGLE_STRIP,0,4),Gbe.exports.init(e);const S=e.gl.getError();return e.setViewport(g,y,v,b),e.bindFramebuffer(f),p.dispose(),l.dispose(!1),a.dispose(),o.dispose(),S!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}Rne=Gbe,One=function(){var e=function(v){window.console&&window.console.log&&window.console.log(v)},t=function(v){window.console&&window.console.error?window.console.error(v):e(v)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(v){if(r==null)for(var b in r={},s={},v)typeof v[b]=="number"&&(r[v[b]]=b,s[b]=v[b])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(v){return o(),r[v]!==void 0}function l(v){o();var b=r[v];return b!==void 0?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+v.toString(16)}function c(v,b,w,S){var x;if((x=i[v])!==void 0&&(x=x[b])!==void 0&&x[w]){if(typeof x[w]=="object"&&x[w].enumBitwiseOr!==void 0){for(var E=x[w].enumBitwiseOr,R=0,O=[],I=0;I<E.length;++I){var U=s[E[I]];(S&U)!=0&&(R|=U,O.push(l(U)))}return R===S?O.join(" | "):l(S)}return l(S)}return S===null?"null":S===void 0?"undefined":S.toString()}function h(v,b){for(var w="",S=b.length,x=0;x<S;++x)w+=(x==0?"":", ")+c(v,S,x,b[x]);return w}function p(v,b,w){v.__defineGetter__(w,function(){return b[w]}),v.__defineSetter__(w,function(S){b[w]=S})}function f(v,b,w,S){S=S||v,n(v),b=b||function(U,N,V){for(var j="",H=V.length,J=0;J<H;++J)j+=(J==0?"":", ")+c(N,H,J,V[J]);t("WebGL error "+l(U)+" in "+N+"("+j+")")};var x={};function E(U,N){return function(){w&&w(N,arguments);var V=U[N].apply(U,arguments),j=S.getError();return j!=0&&(x[j]=!0,b(j,N,arguments)),V}}var R={};for(var O in v)if(typeof v[O]=="function")if(O!="getExtension")R[O]=E(v,O);else{var I=E(v,O);R[O]=function(){return f(I.apply(v,arguments),b,w,S)}}else p(R,v,O);return R.getError=function(){for(var U in x)if(x.hasOwnProperty(U)&&x[U])return x[U]=!1,U;return v.NO_ERROR},R}function g(v){var b=v.getParameter(v.MAX_VERTEX_ATTRIBS),w=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,w);for(var S=0;S<b;++S)v.disableVertexAttribArray(S),v.vertexAttribPointer(S,4,v.FLOAT,!1,0,0),v.vertexAttrib1f(S,0);v.deleteBuffer(w);var x=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);for(S=0;S<x;++S)v.activeTexture(v.TEXTURE0+S),v.bindTexture(v.TEXTURE_CUBE_MAP,null),v.bindTexture(v.TEXTURE_2D,null);for(v.activeTexture(v.TEXTURE0),v.useProgram(null),v.bindBuffer(v.ARRAY_BUFFER,null),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.disable(v.BLEND),v.disable(v.CULL_FACE),v.disable(v.DEPTH_TEST),v.disable(v.DITHER),v.disable(v.SCISSOR_TEST),v.blendColor(0,0,0,0),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.ONE,v.ZERO),v.clearColor(0,0,0,0),v.clearDepth(1),v.clearStencil(-1),v.colorMask(!0,!0,!0,!0),v.cullFace(v.BACK),v.depthFunc(v.LESS),v.depthMask(!0),v.depthRange(0,1),v.frontFace(v.CCW),v.hint(v.GENERATE_MIPMAP_HINT,v.DONT_CARE),v.lineWidth(1),v.pixelStorei(v.PACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1),v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),v.UNPACK_COLORSPACE_CONVERSION_WEBGL&&v.pixelStorei(v.UNPACK_COLORSPACE_CONVERSION_WEBGL,v.BROWSER_DEFAULT_WEBGL),v.polygonOffset(0,0),v.sampleCoverage(1,!1),v.scissor(0,0,v.canvas.width,v.canvas.height),v.stencilFunc(v.ALWAYS,0,4294967295),v.stencilMask(4294967295),v.stencilOp(v.KEEP,v.KEEP,v.KEEP),v.viewport(0,0,v.canvas.width,v.canvas.height),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT);v.getError(););}function y(v){var b,w,S=[],x=[],E={},R=1,O=!1,I=[],U=0,N=0,V=!1,j=0,H={};function J(q){return typeof q=="function"?q:function(te){q.handleEvent(te)}}v.getContext=(w=v.getContext,function(){var q=w.apply(v,arguments);if(q instanceof WebGLRenderingContext){if(q!=b){if(b)throw"got different context";E=ee(b=q)}return E}return q});var K=function(q){S.push(J(q))},he=function(q){x.push(J(q))};function le(q){var te=q.addEventListener;q.addEventListener=function(Ee,ve,qe){switch(Ee){case"webglcontextlost":K(ve);break;case"webglcontextrestored":he(ve);break;default:te.apply(q,arguments)}}}function $(){for(var q=Object.keys(H),te=0;te<q.length;++te)delete H[q]}function z(){++N,O||U==N&&v.loseContext()}function k(q,te){var Ee=q[te];return function(){if(z(),!O)return Ee.apply(q,arguments)}}function G(){for(var q=0;q<I.length;++q){var te=I[q];te instanceof WebGLBuffer?b.deleteBuffer(te):te instanceof WebGLFramebuffer?b.deleteFramebuffer(te):te instanceof WebGLProgram?b.deleteProgram(te):te instanceof WebGLRenderbuffer?b.deleteRenderbuffer(te):te instanceof WebGLShader?b.deleteShader(te):te instanceof WebGLTexture&&b.deleteTexture(te)}}function W(q){return{statusMessage:q,preventDefault:function(){V=!0}}}return le(v),v.loseContext=function(){if(!O){for(O=!0,U=0,++R;b.getError(););$(),H[b.CONTEXT_LOST_WEBGL]=!0;var q=W("context lost"),te=S.slice();setTimeout(function(){for(var Ee=0;Ee<te.length;++Ee)te[Ee](q);j>=0&&setTimeout(function(){v.restoreContext()},j)},0)}},v.restoreContext=function(){O&&x.length&&setTimeout(function(){if(!V)throw"can not restore. webglcontestlost listener did not call event.preventDefault";G(),g(b),O=!1,N=0,V=!1;for(var q=x.slice(),te=W("context restored"),Ee=0;Ee<q.length;++Ee)q[Ee](te)},0)},v.loseContextInNCalls=function(q){if(O)throw"You can not ask a lost contet to be lost";U=N+q},v.getNumCalls=function(){return N},v.setRestoreTimeout=function(q){j=q},v;function ee(q){for(var te in q)typeof q[te]=="function"?E[te]=k(q,te):p(E,q,te);E.getError=function(){if(z(),!O)for(;Oe=b.getError();)H[Oe]=!0;for(var Oe in H)if(H[Oe])return delete H[Oe],Oe;return E.NO_ERROR};for(var Ee=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],ve=0;ve<Ee.length;++ve){var qe=Ee[ve];E[qe]=function(Oe){return function(){if(z(),O)return null;var Ve=Oe.apply(q,arguments);return Ve.__webglDebugContextLostId__=R,I.push(Ve),Ve}}(q[qe])}var Ce=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(ve=0;ve<Ce.length;++ve)qe=Ce[ve],E[qe]=function(Oe){return function(){return z(),O?null:Oe.apply(q,arguments)}}(E[qe]);var Re=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(ve=0;ve<Re.length;++ve)qe=Re[ve],E[qe]=function(Oe){return function(){return z(),!O&&Oe.apply(q,arguments)}}(E[qe]);return E.checkFramebufferStatus=function(Oe){return function(){return z(),O?E.FRAMEBUFFER_UNSUPPORTED:Oe.apply(q,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Oe){return function(){return z(),O?-1:Oe.apply(q,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Oe){return function(){return z(),O?0:Oe.apply(q,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return O},E}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:y,resetToInitialState:g}},(Mne=One())!==void 0&&(Rne.exports=Mne);const Dut=pe.getLogger("esri.views.WebGLDriverTest");function Lut(e){const t=new hr(e,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE},{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1}),i=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,r=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=si.createVertex(e,mi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Os(e,new Map([["a_position",0]]),{geometry:[new Un("a_position",2,ut.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire(i,r,new Map([["a_pos",0]]));e.useProgram(a);const l=new ot(e,{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);const{x:h,y:p,width:f,height:g}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(o),e.drawArrays(Dt.TRIANGLE_STRIP,0,4),e.setViewport(h,p,f,g),t.readPixels(0,0,1,1,ze.RGBA,Ct.UNSIGNED_BYTE,s),a.dispose(),o.dispose(!1),n.dispose(),t.dispose();const y=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return y&&Dut.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(c),y}new Un("a_pos",2,ut.BYTE,0,2);new Un("a_pos",2,ut.BYTE,0,4),new Un("a_tex",2,ut.BYTE,2,4);const Nut={geometry:[new Un("a_pos",2,ut.UNSIGNED_SHORT,0,4)]};async function Fut(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new hr(e,{colorTarget:Gr.TEXTURE,depthStencilTarget:_i.NONE},{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1}),r=si.createVertex(e,mi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Os(e,new Map([["a_pos",0]]),Nut,{geometry:r}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,o=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,a=e.programCache.acquire(n,o,new Map([["a_pos",0]]));e.useProgram(a);const l=new ot(e,{dataType:Ct.UNSIGNED_BYTE,pixelFormat:ze.RGBA,preMultiplyAlpha:!1,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR},t);e.bindTexture(l,0),a.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:g}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(ki.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays(Dt.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return i.readPixels(0,0,1,1,ze.RGBA,Ct.UNSIGNED_BYTE,y),a.dispose(),s.dispose(!1),r.dispose(),i.dispose(),l.dispose(),e.setViewport(h,p,f,g),e.bindFramebuffer(c),t.src="",y[0]===255}class Uut{constructor(t){this.context=t,this._floatBufferBlendWorking=$ut(t),Fut(t).then(i=>this._svgAlwaysPremultipliesAlpha=!i)}get floatBufferBlendWorking(){if(C(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(C(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(C(this._doublePrecisionRequiresObfuscation)){const t=Cne(this.context,!1),i=Cne(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(i===0||t/i>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return C(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=Lut(this.context)),this._ignoresSamplerPrecision}}class Pne{constructor(t,i,r,s,n,o,a,l){this.createQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=s,this.beginTimeElapsed=n,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}function zut(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&fn(e)?new Pne(()=>e.createQuery(),r=>e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),r=>e.getQueryParameter(r,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>e.beginQuery(i.TIME_ELAPSED_EXT,r),()=>e.endQuery(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new Pne(()=>i.createQueryEXT(),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,r),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function kut(e,t){if(t.disjointTimerQuery)return null;if(fn(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function But(e){if(fn(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function Vut(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Gut(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function jut(e,t){if(fn(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function Hut(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function qut(e,t){if(fn(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function Wut(e,t){if(fn(e)){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function yI(e,t,i,r,s){if(r&&fn(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function Xut(e,t){if(!fn(e)||t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function Yut(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function Zut(e,t){if(fn(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class Qut{constructor(t,i){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=kut(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=But(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=Zut(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=Vut(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=Gut(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=Hut(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=zut(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=qut(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=Wut(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=jut(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=yI(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=yI(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=yI(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=yI(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=Yut(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=Xut(this.gl,this._disabledExtensions)),this._textureNorm16}enable(t){return this[t]}}class Jut{constructor(t,i){this.gl=t,this.instanceCounter=new lut,this.programCache=new Iut(this),this._state=new mne,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=fn(t)?xi.WEBGL2:xi.WEBGL1,this._loadExtensions(),this.configure(i)}configure(t){this._capabilities=new Qut(this.gl,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new mne,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new QBe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new Uut(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),fn(this.gl)&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,$u()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,i){for(let r=0;r<t.length;++r)this._state.textureUnitMap[t[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,i,r,s){t===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,i,r,s),this._state.blendColor.r=t,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,i){t===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,i),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,i,r,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,i,r,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,i){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(t,i),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(t,i,r,s){this._state.colorMask.r===t&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(t,i,r,s),this._state.colorMask.r=t,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,i,r,s){this._state.clearColor.r===t&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(t,i,r,s),this._state.clearColor.r=t,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,i){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=i,this.gl.polygonOffset(t,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,i,r,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(t,i,r,s),this._state.scissorRect.x=t,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,i){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===i||(this.gl.depthRange(t,i),this._state.depthRange.zNear=t,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,i,r){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(t,i,r),this._state.stencilFunction.face=qa.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,i,r,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,i,r,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,i,r){this._state.stencilOperation.face===qa.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(t,i,r),this._state.stencilOperation.face=qa.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,i,r,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,i,r,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,i=!1){const r=this._state.activeTexture;return t>=0&&(i||t!==this._state.activeTexture)&&(this.gl.activeTexture(nU+t),this._state.activeTexture=t),r}clear(t){t&&this.gl.clear(t)}clearSafe(t,i=255){t&&(t&ki.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&ki.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&ki.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(t))}drawArrays(t,i,r){if($u()&&(this._numOfDrawCalls++,this._numOfTriangles+=Ine(t,r)),this.gl.drawArrays(t,i,r),$u()){const s=see(this);s&&console.error("drawArrays:",s)}}drawElements(t,i,r,s){if($u()&&(this._numOfDrawCalls++,this._numOfTriangles+=Ine(t,i)),this.gl.drawElements(t,i,r,s),$u()){const o=see(this);if(o){var n;const a=this.getBoundVAO(),l=a==null?void 0:a.indexBuffer,c={indexBuffer:l,vertexBuffers:a==null?void 0:a.vertexBuffers},h={mode:t,count:i,type:r,offset:s},p=(n=Ks(l,y=>y.size))!=null?n:0,f=s+i,g=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${o}${g}`,{args:h,vao:c})}}}logInfo(){$u()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){$u()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===i&&n.width===r&&n.height===s||(n.x=t,n.y=i,n.width=r,n.height=s,this.gl.viewport(t,i,r,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var i,r;this._state.program!==t&&((i=this._state.program)==null||i.stop(),this._state.program=t,this.gl.useProgram((r=t==null?void 0:t.glName)!=null?r:null))}bindTexture(t,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return C(t)||t.glName==null?(_(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==t?(this.setActiveTexture(i,r),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[i]=t,s):(t.isDirty&&(this.setActiveTexture(i,r),t.applyChanges()),s)}unbindTexture(t){if(!C(t))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===t&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(t,i=!1){if(i||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(C(t))return this.gl.bindFramebuffer(cn.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(cn.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,i,r=!1){const s=i===cn.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==t)&&(C(t)?this.gl.bindFramebuffer(i,null):t.initializeAndBind(i),s?this._state.readFramebuffer=Tt(t,null):this._state.drawFramebuffer=Tt(t,null))}blitFramebuffer(t,i,r=0,s=0,n=t.width,o=t.height,a=0,l=0,c=i.width,h=i.height,p=ki.COLOR_BUFFER_BIT,f=Je.NEAREST){this.bindFramebufferSeparate(t,cn.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,cn.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,p,f)}bindBuffer(t,i){if(t)switch(i!=null||(i=t.bufferType),i){case wt.ARRAY_BUFFER:this._state.vertexBuffer=ml(this.gl,t,i,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=ml(this.gl,t,i,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=ml(this.gl,t,i,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=ml(this.gl,t,i,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=ml(this.gl,t,i,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=ml(this.gl,t,i,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=ml(this.gl,t,i,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const i=this.gl;t||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(i.bindRenderbuffer(i.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return C(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(t,i,r){const s=this._getBufferBinding(t,i);C(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(t,i,r,s,n){const o=this._getBufferBinding(t,i);if(!C(o)&&!(o.buffer===r&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n}}bindUBO(t,i,r,s){C(i)?this.bindBufferBase(wt.UNIFORM_BUFFER,t,null):($u()&&(s!=null?s:i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(wt.UNIFORM_BUFFER,t,i.buffer,r,s):this.bindBufferBase(wt.UNIFORM_BUFFER,t,i.buffer))}unbindUBO(t){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];_(s)&&s.buffer===t.buffer&&this.bindBufferBase(wt.UNIFORM_BUFFER,i,null)}}unbindBuffer(t){switch(t){case wt.ARRAY_BUFFER:this._state.vertexBuffer=ml(this.gl,null,t,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=ml(this.gl,null,t,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=ml(this.gl,null,t,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=ml(this.gl,null,t,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=ml(this.gl,null,t,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=ml(this.gl,null,t,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=ml(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){C(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const i=this.gl,r=i.fenceSync(kV.SYNC_GPU_COMMANDS_COMPLETE,0);let s;this.instanceCounter.increment(en.Sync,r),i.flush();do await iS(t),s=i.clientWaitSync(r,0,0);while(s===sL.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(en.Sync,r),i.deleteSync(r),s===sL.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=cn.FRAMEBUFFER){return t===cn.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),fn(this.gl)&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(Me.ONE,Me.ZERO),this.setBlendEquation(og.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(qa.BACK),this.setFrontFace(ES.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Ji.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Ji.ALWAYS,0,0),this.setStencilOp(tr.KEEP,tr.KEEP,tr.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var t,i;const r=this.gl,s=this.capabilities.vao;s&&s.bindVertexArray(null);for(let c=0;c<this.parameters.maxVertexAttributes;c++)r.disableVertexAttribArray(c);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(wt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(wt.ELEMENT_ARRAY_BUFFER,null),fn(r)){var n,o;this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(wt.UNIFORM_BUFFER,null);for(let c=0;c<this._parameters.maxUniformBufferBindings;c++){const h=this._state.uniformBufferBindingPoints[c];if(_(h)){const{buffer:p,offset:f,size:g}=h;p!==null?f===0&&g===0?r.bindBufferBase(wt.UNIFORM_BUFFER,c,p.glName):r.bindBufferRange(wt.UNIFORM_BUFFER,c,p.glName,f,g):r.bindBufferBase(wt.UNIFORM_BUFFER,c,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(wt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(wt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(wt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(wt.COPY_WRITE_BUFFER,null),r.bindFramebuffer(cn.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(cn.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(_c.COLOR_ATTACHMENT0)),r.bindFramebuffer(cn.DRAW_FRAMEBUFFER,(n=(o=this._state.drawFramebuffer)==null?void 0:o.glName)!=null?n:null)}else{var a,l;this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(cn.FRAMEBUFFER,(a=(l=this._state.drawFramebuffer)==null?void 0:l.glName)!=null?a:null)}if(s&&this._state.vertexArrayObject){const c=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(c)}r.useProgram((t=(i=this._state.program)==null?void 0:i.glName)!=null?t:null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let c=0;c<this.parameters.maxTextureImageUnits;c++){r.activeTexture(nU+c),r.bindTexture(pt.TEXTURE_2D,null),r.bindTexture(pt.TEXTURE_CUBE_MAP,null),fn(r)&&(r.bindTexture(pt.TEXTURE_3D,null),r.bindTexture(pt.TEXTURE_2D_ARRAY,null));const h=this._state.textureUnitMap[c];_(h)&&r.bindTexture(h.descriptor.target,h.glName)}r.activeTexture(nU+this._state.activeTexture),r.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===xi.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var i;const r=this.capabilities.textureFilterAnisotropic,s=(i=t.maxAnisotropy)!=null?i:1/0,n=fn(this.gl),o=this.gl,a={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:r?Math.min(this.gl.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),s):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:n?o.getParameter(o.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:n?o.getParameter(o.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:n?o.getParameter(o.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:n?o.getParameter(o.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:n?o.getParameter(o.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:n?o.getParameter(o.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:n?o.getParameter(o.MAX_SAMPLES):1};return ot.TEXTURE_UNIT_FOR_UPDATES=a.maxTextureImageUnits-1,a}}function ml(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function Ine(e,t){switch(e){case Dt.POINTS:return 2*t;case Dt.TRIANGLES:return t/3;case Dt.TRIANGLE_STRIP:case Dt.TRIANGLE_FAN:return t-2;default:return 0}}class Kut extends Jut{constructor(t,i,r){super(t,i),this.newCache=r,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,i,r,s){this.useProgram(t.program);const n=_(r)?r.slot:null;return t.bindPipelineState(this,n,s),_(i)&&_(r)&&t.bindPass(i,r),t.program}get test(){return this.programCache.test}}const jbe=pe.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let Xx=class extends be{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new qr,this._frameTask=e.resourceController.scheduler.registerTask(yt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(Id.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return C(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(gM,new FW)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),Tt(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",bs.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(C(t))return ht(t!==void 0),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new eht(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),_(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,Tr(a)||jbe.error(a),null);return Jc(s)?s.then(n,o):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",bs.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],Xx.prototype,"_loadingCount",void 0),u([d()],Xx.prototype,"_frameTask",void 0),u([d()],Xx.prototype,"updating",null),Xx=u([P("esri.views.3d.webgl-engine.lib.TextureRepository")],Xx);class eht{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(jbe.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const tht=pe.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let wC=class extends be{constructor(){super(...arguments),this._data=new Array,this._state=Pl.NOT_LOADED}dispose(){this._state=Pl.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this._state===Pl.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[Ei("esri/images/materials/water/normals.jpg"),Ei("esri/images/materials/water/perturbation.jpg")];this._state=Pl.LOADING,Promise.all(t.map(i=>ch(i))).then(i=>{i.forEach(r=>this._data.push(new ot(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:Ct.UNSIGNED_BYTE,wrapMode:bt.REPEAT,samplingMode:Je.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:r.width,height:r.height},r))),this._state=Pl.LOADED}).catch(i=>{tht.error("Failed to load textures for water material.",i),this._state=Pl.NOT_LOADED})}bind(e){this._state===Pl.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};u([d()],wC.prototype,"_state",void 0),u([d({type:Boolean,readOnly:!0})],wC.prototype,"updating",null),wC=u([P("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],wC);class iht extends P4{constructor(t,i,r,s,n,o){super(),this._rctx=t,this._renderScene=i,this._requestRenderScene=r,this._renderOverlay=s,this._forceCameraHook=n,this._disposeOffscreenBuffers=o,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(bs.BACKGROUND);const i=Qm();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t){for(const i of this._screenshotQueue){if(this.isDisposed){i.resolver.reject();continue}const r=ge(L({},i.settings),{pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio}),s=this._renderScreenshot(t,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){if(C(this._renderOverlay))return i;t.width=i.width,t.height=i.height;const s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderOverlay(t,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(t,i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=gk(r,s,a);this._rctx.gl.readPixels(0,0,r,s,ze.RGBA,ut.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,ge(L({},t),{region:null}));const c=gk(n.width,n.height,a);return YQe(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){const{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=gk(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,ze.RGBA,ut.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,i){let r=null;const s=t.viewCamera,{framebufferWidth:n,framebufferHeight:o}=i;let a=!1;const l=i.disableDecorations&&t.frameHasDecorations,c=n!==s.fullWidth||o!==s.fullHeight,h=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,p=c||l||h;if(p){const y=s.clone();if(i.ignorePadding){const w=bF(y.padding);for(let S=0;S<4;S++)w[S]=Math.round(w[S]/y.pixelRatio*i.pixelRatio);y.padding=w}y.fullWidth=n,y.fullHeight=o,y.pixelRatio=i.pixelRatio;const v=s.fovX-y.fovX,b=s.fovY-y.fovY;v<0&&v<b?y.fovX=s.fovX:b<0&&b<v&&(y.fovY=s.fovY),this._forceCameraHook(y),a=!0,r=new hr(this._rctx,{width:y.fullWidth,height:y.fullHeight,colorTarget:Gr.TEXTURE,depthStencilTarget:_i.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(r,y,i.disableDecorations?vb.OFF:vb.ON),this._disposeOffscreenBuffers()}const f=()=>{this._rctx.bindFramebuffer(null),it(r)},g=this._readbackScreenshot(i,f);if(f(),p&&!this._rctx.contextAttributes.alpha)for(let y=3;y<g.data.length;y+=4)g.data[y]=255;return a&&this._forceCameraHook(s),g}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const $ne=pe.getLogger("esri.views.3d.webgl-engine.parts.View");let Jn=class extends M4(be){constructor(e){super({}),this.events=new qr,this.waterTextureRepository=new wC,this._magnifierHelper=new Wx,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._initializeContext(e),xe(()=>{var t;return(t=this.waterTextureRepository)==null?void 0:t.updating},()=>this.requestRender(),Bi),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new m_e(this._rctx),this._shaderTechniqueRepository=new Fve({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new Xx(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new Uve(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new Qat(this._rctx,this._shaderTechniqueRepository),this._renderer=new gm(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,i)=>e.schedule(t,i),e),this._screenshotManager=new iht(this._rctx,(t,i,r)=>this._renderer.render(t,i,i,r),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=mn(this._frameTask),this._shaderTechniqueRepository=it(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=bs.UPDATE){e===bs.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,i,r,s){this._renderer.readHUDVisibility(e,t,i,r,s)}getMinimalDepthForArea(e,t,i,r,s,n=s){const o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(r,o[0],o[1],o[2],o[3],a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=ilt(4*c,a,r.nearFar);l>h&&h!==r.nearFar[0]&&h!==r.nearFar[1]&&(l=h)}if(_(e)){const c=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);_(c)&&l>c&&c!==r.nearFar[0]&&c!==r.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(C(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){H1e(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1};let r=!1,s=bs.BACKGROUND,n=!1;const o={preRender:a=>{r=this.updating,s=this._needsUpdate?bs.UPDATE:bs.BACKGROUND,e.processSyncLayers();const l=a.time-this._lastAnimationUpdate;(l>this.animationTimestep||_(this.forcedAnimationTime)||r||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:l,forcedTime:this.forcedAnimationTime})&&this.requestRender(bs.BACKGROUND),this._lastAnimationUpdate=a.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,vb.ON),n=!0,a&&this._renderer.hasWaterReflection&&(this.requestRender(bs.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=Y1(o)}_initializeContext(e){const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance"},r=xMe("3d",this._canvas,i);if(C(r)){const s=ue("esri-force-webgl");$ne.error(s)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&$ne.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ue("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new Kut(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return C(this._componentObjectCollection)&&(this._componentObjectCollection=new Wat(this._renderer.renderPassManager)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],Jn.prototype,"updating",null),u([Kn()],Jn.prototype,"_rctx",void 0),u([Kn()],Jn.prototype,"_container",void 0),u([Kn()],Jn.prototype,"_canvas",void 0),u([Kn()],Jn.prototype,"_stippleTextureRepository",void 0),u([Kn(),d()],Jn.prototype,"waterTextureRepository",void 0),u([Kn(),d()],Jn.prototype,"_magnifierHelper",void 0),u([Kn(),d()],Jn.prototype,"_textureRepository",void 0),u([Kn()],Jn.prototype,"_compositingHelper",void 0),u([Kn()],Jn.prototype,"_renderer",void 0),u([Kn()],Jn.prototype,"_screenshotManager",void 0),u([Kn()],Jn.prototype,"componentObjectCollection",null),u([Kn()],Jn.prototype,"_componentObjectCollection",void 0),u([d()],Jn.prototype,"_needsUpdate",void 0),u([d()],Jn.prototype,"_needsWaterReflectionUpdate",void 0),Jn=u([P("esri.views.3d.webgl-engine.parts.RenderView")],Jn);var dD;let La=dD=class extends M4(be){constructor(e){super(e),this._handles=new Jt,this._model=new aD,this._layers=new Vt,this._changeSet=new Qve,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Jn(this)),this._frameTask=this.resourceController.scheduler.registerTask(yt.STAGE,this),this._handles.add(this._frameTask)}destroy(){Ob.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),cN(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){C(e)||(this.renderView.requestRender(),this._model.remove(e),cN(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){_(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){_(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){C(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>C(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;dD.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),dD.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===FS.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),s=()=>{Vre(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(Jc(r))return r.then(s);s()}removeRenderPlugin(e){Vre(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}hasRenderPlugin(e){return this.renderView.renderPlugins.has(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(i=>i.type===t).length,model:e._model}}};La.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},u([d({constructOnly:!0})],La.prototype,"resourceController",void 0),u([d({constructOnly:!0})],La.prototype,"options",void 0),u([d({constructOnly:!0})],La.prototype,"state",void 0),u([d({constructOnly:!0})],La.prototype,"sceneIntersectionHelper",void 0),u([d({readOnly:!0})],La.prototype,"viewingMode",null),u([d({constructOnly:!0})],La.prototype,"container",void 0),u([d({constructOnly:!0})],La.prototype,"renderSR",void 0),u([d({constructOnly:!0})],La.prototype,"_handles",void 0),u([d({readOnly:!0})],La.prototype,"updating",null),u([d({constructOnly:!0})],La.prototype,"_model",void 0),u([Kn(),d()],La.prototype,"renderView",void 0),La=dD=u([P("esri.views.3d.webgl-engine.Stage")],La);function Hbe(e){return xf(e)&&e.intersector===Rr.PCL&&!!e.target}function qbe(e){return xf(e)&&e.intersector===Rr.I3S&&!!e.target}function rht(e){return xf(e)&&e.intersector===Rr.TERRAIN&&!!e.target}function Wbe(e){return xf(e)&&e.intersector===Rr.OVERLAY&&!!e.target}function sht(e){return xf(e)&&e.intersector===Rr.LOD&&!!e.target}function Dne(e,t){return uye(e)||hye(e)?$N(e.target.object.metadata,t):rht(e)?(i=t.map)==null?void 0:i.ground:Hbe(e)||qbe(e)||Wbe(e)?$N(e.target,t):null;var i}function Lne(e,t){return uye(e)||hye(e)?Nne(e.target.object.metadata,t):Hbe(e)?e.target.createGraphic():Wbe(e)||sht(e)?Nne(e.target,t):qbe(e)?nht(e.target,t):null}function Nne(e,t){if(C(e)||C(e.graphicUid))return null;const i=$N(e,t);if(C(i))return null;if(i===t.graphics)return _(t.graphicsView)?t.graphicsView.getGraphicFromGraphicUid(e.graphicUid):null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromGraphicUid"in r&&_(e.graphicUid)?r.getGraphicFromGraphicUid(e.graphicUid):null}function nht(e,t){const i=$N(e,t);if(C(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?r.getGraphicFromIntersectorTarget(e):null}function $N(e,t){return C(e.layerUid)?null:_(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}async function oht(e,t){if(e.type==="2d")return e.hitTest(t);const i=await e.hitTest(t);if(i.results.length===0)return i;const r=i.results[0],s=_(r.distance)?r.distance*(1+aht):r.distance,n=i.results.findIndex(o=>o.distance>s);return n!==-1&&(i.results=i.results.slice(0,n)),i}const aht=.05;let g6,y6;function lht(e){const t=_he(e);for(;t.length>1;){const i=Fne(t.shift());if(i.available)return i}return Fne(t.shift())}function Fne(e){switch(e){case xi.WEBGL1:return cht();case xi.WEBGL2:return uht()}}function cht(){return g6||(g6=pht()),g6}function uht(){return y6||(y6=fht()),y6}class Xbe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureFloatLinear=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsTextureHalfFloat=!1,this.supportsTextureHalfFloatLinear=!1,this.supportsColorBufferHalfFloat=!1,this.supportsColorBufferHalfFloatBlend=!1}}class hht extends Xbe{constructor(){super(...arguments),this.type=xi.WEBGL1}}class dht extends Xbe{constructor(){super(...arguments),this.type=xi.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0,this.supportsTextureHalfFloatLinear=!0}}function Ybe(e,t){if(e===xi.WEBGL1&&typeof WebGLRenderingContext===void 0||e===xi.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const i=document.createElement("canvas");if(!i)return null;let r=rL(i,e,{failIfMajorPerformanceCaveat:!0});if(C(r)&&(r=rL(i,e),_(r)&&(t.majorPerformanceCaveat=!0)),C(r))return r;if(e===xi.WEBGL1){const n=r.getParameter(r.VERSION),o=n==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),r}function pht(){const e=new hht,t=Ybe(xi.WEBGL1,e);return C(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureFloatLinear=t.getExtension("OES_texture_float_linear")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsTextureHalfFloatLinear=t.getExtension("OES_texture_half_float_linear")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null,e.supportsColorBufferHalfFloatBlend=e.supportsColorBufferHalfFloat),e}function fht(){const e=new dht,t=Ybe(xi.WEBGL2,e);return C(t)||(e.supportsTextureFloatLinear=t.getExtension("OES_texture_float_linear")!==null,e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null,e.supportsColorBufferHalfFloatBlend=e.supportsColorBufferHalfFloat),e}function mht(e){const t=lht(e);if(!t.available)return new Y("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new Y("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new Y("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new Y("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===xi.WEBGL1){if(!t.supportsElementIndexUint)return new Y("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new Y("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new Y("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function ght(e){return e&&"nodeType"in e}function yht(e){return e&&typeof e.render=="function"}const Une={component:"esri-component"};let X_=class extends be{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Une.component),t&&t.classList.remove(Une.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||ght(e)?(this._set("widget",null),fF(e)):(yht(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],X_.prototype,"id",null),u([d()],X_.prototype,"node",null),u([Bt("node")],X_.prototype,"castNode",null),u([d({readOnly:!0})],X_.prototype,"widget",void 0),X_=u([P("esri.views.ui.Component")],X_);const pD=X_,vht={left:0,top:0,bottom:0,right:0},Zbe={bottom:30,top:15,right:15,left:15},v6="manual",Oa={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function _ht(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function _6(e){const t=e,i=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(i===null||i===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function b6(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let ym=class extends qr.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Jt,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&b6(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&b6(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([xe(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Bi),xe(()=>this.padding,this._applyUIPadding,Bi)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(Oa.ui),e.classList.add(a$e()),this._attachContainers(e)),t&&(t.classList.remove(Oa.ui),b6(t,{top:"",bottom:"",left:"",right:""}),Rce(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:L(L({},Zbe),e)}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=_6(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,i)=>t.concat(i)):(e=e||v6)===v6?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(Oa.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i;const r=_6(e)||_6(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof pD||(e=new pD({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof pD?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||vht}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Oa.innerContainer),e.classList.add(Oa.cornerContainer);const t=document.createElement("div");t.classList.add(Oa.innerContainer),t.classList.add(Oa.manualContainer);const i=document.createElement("div");i.classList.add(Oa.topLeft),i.classList.add(Oa.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(Oa.topRight),r.classList.add(Oa.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(Oa.bottomLeft),s.classList.add(Oa.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Oa.bottomRight),n.classList.add(Oa.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=d0();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup=L({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||v6,r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if(_ht(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(r===0)return void(s.firstChild?VY(t.node,s.firstChild):s.appendChild(t.node));r>=o.length?s.appendChild(t.node):VY(t.node,o[r])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some(r=>(t=r===e,t&&(i=r),t)),i}_findById(e){let t,i=null;return this._components.some(r=>(t=r.id===e,t&&(i=r),t)),i}_findByNode(e){let t,i=null;return this._components.some(r=>(t=r.node===e,t&&(i=r),t)),i}};u([d()],ym.prototype,"container",null),u([d()],ym.prototype,"height",null),u([d({value:Zbe})],ym.prototype,"padding",null),u([Bt("padding")],ym.prototype,"castPadding",null),u([d()],ym.prototype,"view",void 0),u([d()],ym.prototype,"width",null),ym=u([P("esri.views.ui.UI")],ym);const bht=ym;function zne(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function wht(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function vI(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function xht(e){return e.type==="bing-maps"}const sy=[];let Yx=class extends vS{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new St,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>r.watch(["suspended","attributionVisible"],this._updateAttributionItems)),"suspension"),t&&t.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this._updateAttributionItems=()=>{const t=this.get("view.allLayerViews");sy.length=0,t?(t.forEach(i=>{if(i.suspended||!i.get("layer.attributionVisible"))return;const r=i.layer;if(zne(r,"user"))return void vI(sy,i,r.copyright);if(r.hasAttributionData){if(this._fetchedAttributionData.has(i)){const n=this._fetchedAttributionData.get(i);return void(n?vI(sy,i,this._getDynamicAttribution(n,this.view,r)):zne(r)&&vI(sy,i,r.copyright))}return void this._fetchAttributionData(i)}const s=r.get("portalItem.accessInformation");vI(sy,i,s||r.copyright)}),wht(this.items,sy)&&(this.items.removeAll(),this.items.addMany(sy)),sy.length=0,this.notifyChange("state")):this._clear()},this.handles.add([aH(this,"view.allLayerViews","change",this._allLayerViewsChange,this._allLayerViewsChange,this._clear),e3e(this,"view.stationary",()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Ad(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,xht(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ke.WGS84},f={extent:Bm(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let g=c;g<=h;g++)r[g]=r[g]||[],r[g].push(f)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||n==null||n<=-1)return"";const o=e[n],a=Ub(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(c=>{const h=!l[c.id]&&a&&q7(c.extent,a);return h&&(l[c.id]=!0),h}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:St})],Yx.prototype,"items",void 0),u([d({readOnly:!0})],Yx.prototype,"state",null),u([d()],Yx.prototype,"view",void 0),Yx=u([P("esri.widgets.Attribution.AttributionViewModel")],Yx);const Qbe=Yx,ny={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Na=class extends va{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.iconClass=ny.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Qbe}initialize(){this.own(ma(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[ny.open]:this._isOpen};return ae("div",{bind:this,class:this.classes(ny.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return ae("div",{class:ny.poweredBy},"Powered by"," ",ae("a",{class:ny.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?"0":"",{attributionText:r}=this,s=t?"button":void 0,n={[ny.sourcesOpen]:e,[ny.interactive]:t};return ae("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(ny.sources,n),innerHTML:r,role:s,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],Na.prototype,"_isOpen",void 0),u([d()],Na.prototype,"_isInteractive",null),u([d()],Na.prototype,"_attributionTextOverflowed",void 0),u([d()],Na.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Na.prototype,"attributionText",null),u([d()],Na.prototype,"iconClass",void 0),u([d()],Na.prototype,"itemDelimiter",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Na.prototype,"label",void 0),u([d(),Bl("esri/widgets/Attribution/t9n/Attribution")],Na.prototype,"messages",void 0),u([xt("viewModel.view")],Na.prototype,"view",void 0),u([d({type:Qbe})],Na.prototype,"viewModel",void 0),u([Iu()],Na.prototype,"_toggleState",null),Na=u([P("esri.widgets.Attribution")],Na);const Tht=Na,Sht="esri.widgets.CompassViewModel";let Y_=class extends Sme(be){constructor(e){super(e),this._handles=new Jt,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(uo(this,"view",this._updateRotationWatcher))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&(e.type==="2d"?this._handles.add(uo(this,"view.rotation",this._updateForRotation)):this._handles.add(uo(this,"view.camera",this._updateForCamera)))}};u([d({readOnly:!0})],Y_.prototype,"canShowNorth",null),u([d()],Y_.prototype,"orientation",void 0),u([d({readOnly:!0})],Y_.prototype,"state",null),u([d()],Y_.prototype,"view",void 0),Y_=u([P(Sht)],Y_);const Jbe=Y_,oy={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Tp=class extends va{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=oy.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Jbe}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i=t==="disabled",r=(t==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,n={[oy.disabled]:i,[oy.interactive]:!i},o={[oy.northIcon]:r,[oy.rotationIcon]:!r},{messages:a}=this;return ae("div",{bind:this,class:this.classes(oy.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},ae("span",{"aria-hidden":"true",class:this.classes(oy.icon,o),styles:this._toRotationTransform(e)}),ae("span",{class:oy.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([xt("viewModel.goToOverride")],Tp.prototype,"goToOverride",void 0),u([d()],Tp.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Tp.prototype,"label",void 0),u([d(),Bl("esri/widgets/Compass/t9n/Compass")],Tp.prototype,"messages",void 0),u([xt("viewModel.view")],Tp.prototype,"view",void 0),u([d({type:Jbe})],Tp.prototype,"viewModel",void 0),u([Iu()],Tp.prototype,"_reset",null),Tp=u([P("esri.widgets.Compass")],Tp);const Eht=Tp;let Zx=class extends be{constructor(e){super(e),this._handles=new Jt,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(KPe(this,"view.inputManager",this._setNavigationMode.bind(this)))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],Zx.prototype,"state",null),u([d()],Zx.prototype,"navigationMode",void 0),u([d()],Zx.prototype,"view",void 0),Zx=u([P("esri.widgets.NavigationToggleViewModel")],Zx);const Kbe=Zx,gu={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let Sp=class extends va{constructor(e,t){super(e,t),this.iconClass=gu.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new Kbe}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",i={[gu.disabled]:e,[gu.isLayoutHorizontal]:this.layout==="horizontal"},r={[gu.activeButton]:t},s={[gu.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return ae("div",{bind:this,class:this.classes(gu.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},ae("div",{class:this.classes(gu.button,gu.panButton,r)},ae("span",{class:gu.panIcon})),ae("div",{class:this.classes(gu.button,gu.rotateButton,s)},ae("span",{class:gu.rotationIcon})))}_toggle(){this.toggle()}};u([d()],Sp.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Sp.prototype,"label",void 0),u([d({value:"vertical"})],Sp.prototype,"layout",null),u([d(),Bl("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Sp.prototype,"messages",void 0),u([xt("viewModel.view")],Sp.prototype,"view",void 0),u([d({type:Kbe})],Sp.prototype,"viewModel",void 0),u([Iu()],Sp.prototype,"_toggle",null),Sp=u([P("esri.widgets.NavigationToggle")],Sp);const Aht=Sp,rA={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Ly=class extends va{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[rA.disabled]:!this.enabled,[rA.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return ae("div",{bind:this,class:this.classes(rA.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},ae("span",{"aria-hidden":"true",role:"presentation",class:this.classes(rA.icon,i)}),ae("span",{class:rA.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],Ly.prototype,"action",void 0),u([d()],Ly.prototype,"enabled",void 0),u([d()],Ly.prototype,"iconClass",void 0),u([d()],Ly.prototype,"title",void 0),u([Iu()],Ly.prototype,"_triggerAction",null),Ly=u([P("esri.widgets.IconButton")],Ly);const kne=Ly;let Qx=class extends be{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([d({readOnly:!0})],Qx.prototype,"canZoomIn",null),u([d({readOnly:!0})],Qx.prototype,"canZoomOut",null),u([d()],Qx.prototype,"view",void 0),Qx=u([P("esri.widgets.Zoom.ZoomConditions2D")],Qx);const Cht=Qx;let Jx=class extends be{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};u([d({readOnly:!0})],Jx.prototype,"canZoomIn",null),u([d({readOnly:!0})],Jx.prototype,"canZoomOut",null),u([d()],Jx.prototype,"view",void 0),Jx=u([P("esri.widgets.Zoom.ZoomConditions3D")],Jx);const Rht=Jx;let Ny=class extends be{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Cht({view:e}):e.type==="3d"&&(this._zoomConditions=new Rht({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():R6(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():R6(e.goTo({zoomFactor:.5}))}};u([d()],Ny.prototype,"_zoomConditions",void 0),u([d({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],Ny.prototype,"canZoomIn",void 0),u([d({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],Ny.prototype,"canZoomOut",void 0),u([d({readOnly:!0})],Ny.prototype,"state",null),u([d()],Ny.prototype,"view",null),Ny=u([P("esri.widgets.Zoom.ZoomViewModel")],Ny);const ewe=Ny,sA={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let vm=class extends va{constructor(e,t){super(e,t),this.iconClass=sA.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new ewe}initialize(){this._zoomInButton=new kne({action:this.zoomIn.bind(this),iconClass:sA.zoomInIcon}),this._zoomOutButton=new kne({action:this.zoomOut.bind(this),iconClass:sA.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[sA.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,ae("div",{class:this.classes(sA.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],vm.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],vm.prototype,"label",void 0),u([d({value:"vertical"})],vm.prototype,"layout",null),u([d(),Bl("esri/widgets/Zoom/t9n/Zoom")],vm.prototype,"messages",void 0),u([xt("viewModel.view")],vm.prototype,"view",void 0),u([d({type:ewe})],vm.prototype,"viewModel",void 0),vm=u([P("esri.widgets.Zoom")],vm);const Oht=vm,twe="esri.views.ui.DefaultUI";function Mht(e){return e&&e.view!==void 0}pe.getLogger(twe);let fD=class extends bht{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},this.components=[]}initialize(){this._handles.add([xe(()=>this.components,this._componentsWatcher.bind(this),Bi),xe(()=>this.view,this._updateViewAwareWidgets.bind(this),Bi)])}_add(e,t,i,r){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const i=this._find(t),r=i&&i.widget;Mht(r)&&(r.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new pD({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new Tht({view:this.view})}_createCompass(){return new Eht({view:this.view})}_createNavigationToggle(){return new Aht({view:this.view})}_createZoom(){return new Oht({view:this.view})}};u([d()],fD.prototype,"components",void 0),fD=u([P(twe)],fD);const Pht=fD;let mD=class extends Pht{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],mD.prototype,"components",void 0),mD=u([P("esri.views.ui.3d.DefaultUI3D")],mD);const iwe=mD,ac=pe.getLogger("esri.views.SceneView");let at=class extends MMe(Eke(kke(P6e))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new sv({slicePlane:ihe},this),this._resourceController=grt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new xG({view:this}),this.labeler=new V_({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new AS,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new a1,this.environmentManager=new Hh,this.extent=null,this.floors=new St,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new D6e({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new lit,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new iwe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new zG,JCe(),e&&e.environment||(this._defaults.environment=new kx,this.environment=this._defaults.environment);const t=(i=null)=>{_(i)&&i.type===Ui.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([ma(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),this.watch("map",i=>{i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new bHe({view:this}),this.stateManager=new Dit({view:this})}initialize(){this.groundView=new zke({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(ma(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},Bi),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},Bi),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>Mxe(t>0?1e3/Math.ceil(t):0),Bi),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,xs),this.updatingHandles.add(()=>{var t,i;return(t=this.map)==null||(i=t.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),xs),this.handles.add(this.watch("spatialReference",()=>this.notifyChange("clippingArea"),!0))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=ct(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=ct(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=ct(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||C(e)?(this._clippingArea=null,null):e instanceof ni?this.spatialReference&&(e=_I(e,this.spatialReference),C(e))?(ac.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),C(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(ac.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&_(e)?ac.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===je.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return C(t)||C(e)||t.spatialReference.equals(e)?t:_I(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||Ke.WGS84,i=_I(this.clippingArea,t);_(i)&&(e=_(e)?e.intersection(i):i);const r=this._get("dataExtent");return _(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||Ke.WGS84;let t;const i=n=>{const o=_I(n,e);C(o)||(_(t)?t.union(o):t=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;i(new ni({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{!_(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(C(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof kx?e:e instanceof ige?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):kx.fromWebsceneEnvironment(e):As(kx,e):new kx}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||_(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(C(this.state)||this.state.stationary)}set qualityProfile(e){tD.isValidProfile(e)&&(tD.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||tD.getDefaultProfile()}set slicePlane(e){if(_(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),C(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");Xb(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?vhe(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?qb.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var e,t,i;if(this.destroyed)return!1;let r=0,s=this.layerViewManager.updating,n=s?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(s=!0,o.suspended||jT(o))return;++n,r+=o.updatingProgress}}else++n});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])_(o)&&o.updating&&(n+=.1,r+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])_(o)&&o.updating&&(++n,r+=o.updatingProgress);if(s=!!(s||n>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||(e=this.inputManager)!=null&&e.hasPendingInputs||(t=this.map)!=null&&(i=t.allLayers)!=null&&i.some(o=>!o.isFulfilled())),s?(this._numUpdating=Math.max(n,this._numUpdating),r+=this._numUpdating-n):this._numUpdating=0,this._numUpdating>0?r/=this._numUpdating:r=s?0:1,this._get("updatingProgress")!==r){const o=this._resourceController.scheduler.now;if(r<1){const a=Math.min((o-this._lastUpdateTime)/2e3,1);r=this.updatingProgress*(1-a)+r*a}this._set("updatingProgress",r),this._lastUpdateTime=s&&r<1?o:0}return s}get viewingMode(){var e;const t=this._predeterminedViewingMode;if(_(t))return rz(t);const i=this.spatialReference;return i?_((e=this.defaultsFromMap)==null?void 0:e.viewingMode)&&i.equals(this.defaultsFromMap.spatialReference)?rz(this.defaultsFromMap.viewingMode):QL(i,je.Global)?"global":"local":"global"}set viewingMode(e){this.ready?ac.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new Urt(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return ac.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=_(i.graphics)&&(_(i.graphics.include)||_(i.graphics.exclude)),s=zK(e)?UK(this,e):e,n=Mm(s);i.enableDraped=i.include&&!i.include.has(c1)||i.exclude&&i.exclude.has(c1);const o=this.sceneIntersectionHelper,a=hh(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?zn.ALL:zn.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=Lne(l,this);if(C(c))return this._intersectResultToMapPoint(l);if(this._testGraphicUidFilter(i.graphics,c))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return ac.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=Tt(e.z==null&&Vp(this.elevationProvider,e),0);return Mr(e,nx,this.renderSpatialReference,t),this.state.camera.projectToScreen(nx,w6),Ed(w6[0],w6[1])}pixelSizeAt(e){return this.ready?e?(Mr(e,nx,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(nx)):0:(ac.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return ac.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=zK(e)?UK(this,e):e,r=Vr(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=hh(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=zn.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Dne(a,this),c=_(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:xf(a)?a.distanceInRenderSpace:0,layer:c}};return Ni.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}popupHitTest(e){return oht(this,e).then(({results:t,ground:i})=>{let r=null;return!(t.length===0||Math.abs(Tt(t[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}})}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(await this.whenReady(),C(e.parent))throw new Y("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="analysis"?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return jQe(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return HQe(i,this._pixelFormat())}_completeSettings(e){const t=GQe(e,this);return t.pixelRatio/=this.state.pixelRatio,ZQe(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return XK.importLayerView(e)}hasLayerViewModule(e){return XK.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&((e=this.map)==null||(t=e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=mht(this.type);if(ue("safari")&&ue("safari")<9&&(e=new Y("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:ue("safari")})),_(e))throw ac.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var e,t;const i=this._isOverridden("viewingMode")?this._get("viewingMode"):(e=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?e:null;return _(i)?HK(i):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(_(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,je.Local),s=this._validateSpatialReferenceForViewingMode(e,t,je.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,je.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,je.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!QL(e,i)&&(!!C(t)||!!RZ(t)||(!NC(t)||!C(l5(t,e,i)))&&(!CZ(t)||i!==je.Global))}_makeSpatialReferenceConstraints(e,t,i){if(C(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return RZ(t)&&(r||s)?!s||i===je.Local||a5(t.tileInfo,t.fullExtent,e,je.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:Ke.WebMercator,viewingMode:i}]:[{spatialReference:r?Ke.WGS84:Ke.WebMercator,viewingMode:i}]:NC(t)||CZ(t)||!r&&!s?NC(t)&&r&&i!==je.Global?[{spatialReference:e,viewingMode:i},{spatialReference:Ke.WGS84,viewingMode:je.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?Ke.WGS84:Ke.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=_(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(_(i)?ac.warnOnce(`Spatial reference defined on view not supported in ${rz(i)} viewing mode.`):e.isGeographic&&ac.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||Ke.WGS84;return kn(e,this.renderSpatialReference,e,i)||(i=Ke.WGS84,kn(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new We(e,i),t}trackGraphicState(e){if(!e.graphic)return ac.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=n=>{var o;!r&&_(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return _(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return eS(e.map(i=>this.highlight(i)));if(St.isCollection(e))return eS(e.toArray().map(i=>this.highlight(i)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):sh()}maskOccludee(e){if(!e)return ac.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=n=>{!r&&_(n)&&cke(n)&&(i=n.maskOccludee(e))};return _(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){_(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await ab(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new Y("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,lR.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,lR.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(nx)?(t=this.computeMapPointFromVec3d(nx,t),e.intersector===Rr.TERRAIN&&this.basemapTerrain&&(t.z=Tt(Vp(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=Dne(n,this);if(_(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=Lne(n,this);if(C(a))continue;if(C(r)&&s!==e.length-1&&(r=new Set),_(r)){const h=this._getGraphicFilterUid(a);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(t,a))continue;const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push({graphic:a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return C(e)||(C(e.include)||e.include.has(i))&&(C(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof ho)Iht(i,this._getGraphicFilterUid(e)),t===lR.INCLUDE&&(_(this.graphicsView)&&e.layer===this?nA(i,this.graphicsView.processor.layer.id):e.layer&&nA(i,e.layer.uid));else if(Kne(e))for(const r of e)r===this.graphics&&_(this.graphicsView)?nA(i,this.graphicsView.processor.layer.id):r instanceof TR?r===this.map.ground&&nA(i,c1):this._externalToInternalRenderItems(r,t,i);else nA(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new Bot({view:this})),this._set("elevationProvider",new dC({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Eo({view:this})),this._set("featureTiles",new Rn({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{const t=this.basemapTerrain&&this.basemapTerrain.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const i=_(this.basemapTerrain.extent)?BO(sF(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;_(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Ni.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(import("./FeatureTileTree3DDebugger.f134b7ff.js")).then(({FeatureTileTree3DDebugger:i})=>{!this.featureTreeDebugger&&Ni.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new i({view:this}))}):t||!this.featureTreeDebugger||Ni.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},xs),this.updatingHandles.add(()=>this.clippingArea,e,xs),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,xs)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new trt(this.map,e));const t=this.state.isGlobal,i=ghe(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",SN.create(this.state.viewingMode,i)),t||this.handles.add(this.watch("basemapTerrain.extent",r=>{const s=this.renderCoordsHelper.spatialReference;r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!vF(r,this.basemapTerrain.spatialReference,Bne,s)||(this.renderCoordsHelper.extent=Bne)},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(XS/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){_(e)&&e.type===Ui.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add([t.watch(["updating","updatingProgress"],()=>this._updatingChanged(),!0)],"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(a,l)=>this._renderScreenshotOverlay(a,l)}},t=new zit(this.state.viewingMode,a=>this._stage.layers.forAll(a),this);this._set("sceneIntersectionHelper",t);const i=fF(this.surface),{resourceController:r,state:s,renderSpatialReference:n}=this;this._stage=new La({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=MO(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new Y("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Bi),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),Bi),xe(()=>this.magnifier,a=>this._stage.renderView.magnifier=a,xs)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:zG.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(XS/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new krt({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Gtt})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await import("./GraphicsView3D.b0c94401.js")).default;qt(e),await ab(()=>{var i;return((i=this.basemapTerrain)==null?void 0:i.ready)===!0},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),_(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=HK(this.viewingMode);if(e===je.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(ma(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(c1);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(c1);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}getVoxelWasmPerSceneView(){return iT.getInstance().getVoxelWasmPerSceneView(this)}};function nA(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function Iht(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function _I(e,t){return _(e)&&wS(e.spatialReference,t)?BO(e,t):null}var lR;u([d()],at.prototype,"_userClippingArea",void 0),u([d()],at.prototype,"_resourceController",void 0),u([d()],at.prototype,"_stage",void 0),u([d({readOnly:!0})],at.prototype,"deconflictor",void 0),u([d({readOnly:!0})],at.prototype,"labeler",void 0),u([d(HD(AS,"analyses"))],at.prototype,"analyses",void 0),u([d({type:DS,readOnly:!0,aliasOf:"state.animation"})],at.prototype,"animation",void 0),u([d({readOnly:!0})],at.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],at.prototype,"elevationProvider",void 0),u([d({type:il,aliasOf:"stateManager.camera"})],at.prototype,"camera",void 0),u([d({type:il,aliasOf:"stateManager.contentCamera"})],at.prototype,"contentCamera",void 0),u([d({readOnly:!0})],at.prototype,"canvas",void 0),u([d({type:We,aliasOf:"stateManager.center"})],at.prototype,"center",void 0),u([d({type:ni})],at.prototype,"clippingArea",null),u([d({type:a1})],at.prototype,"constraints",void 0),u([d({type:ni,readOnly:!0})],at.prototype,"renderDataExtent",null),u([d({type:ni,readOnly:!0})],at.prototype,"dataExtent",null),u([d({type:ni,readOnly:!0})],at.prototype,"groundAndLayersExtent",null),u([d({value:null,type:kx})],at.prototype,"environment",null),u([Bt("environment")],at.prototype,"castEnvironment",null),u([d({readOnly:!0})],at.prototype,"environmentManager",void 0),u([d({type:ni,aliasOf:"stateManager.extent"})],at.prototype,"extent",void 0),u([d()],at.prototype,"floors",void 0),u([d({readOnly:!0,aliasOf:"stateManager.screenCenter"})],at.prototype,"screenCenter",void 0),u([d({aliasOf:"stateManager.frustum"})],at.prototype,"frustum",void 0),u([d({type:Number,readOnly:!0})],at.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],at.prototype,"graphicsView",void 0),u([d({readOnly:!0})],at.prototype,"analysisViewManager",void 0),u([d()],at.prototype,"groundView",void 0),u([d({type:Boolean})],at.prototype,"initialExtentRequired",null),u([d()],at.prototype,"_defaultsFromMapSettings",null),u([d({type:Boolean,readOnly:!0})],at.prototype,"interacting",null),u([d()],at.prototype,"stationary",null),u([d({aliasOf:"state.navigating"})],at.prototype,"navigating",void 0),u([d()],at.prototype,"map",void 0),u([d({readOnly:!0})],at.prototype,"mapCoordsHelper",void 0),u([d({aliasOf:"stateManager.padding"})],at.prototype,"padding",void 0),u([d({type:Eo,readOnly:!0})],at.prototype,"pointsOfInterest",void 0),u([d({type:Rn,readOnly:!0})],at.prototype,"featureTiles",void 0),u([d()],at.prototype,"featureTreeDebugger",void 0),u([d({type:Boolean})],at.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],at.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],at.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],at.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],at.prototype,"state",void 0),u([d({readOnly:!0})],at.prototype,"inputManager",void 0),u([d({readOnly:!0})],at.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],at.prototype,"qualityProfile",null),u([d({type:jre,get(){let e=this._get("qualitySettings");return e||(e=new jre,tD.apply(this.qualityProfile,e)),e}})],at.prototype,"qualitySettings",void 0),u([d()],at.prototype,"slicePlane",null),u([d({readOnly:!0})],at.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],at.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],at.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],at.prototype,"resolution",null),u([d({type:Number,aliasOf:"stateManager.scale"})],at.prototype,"scale",void 0),u([d()],at.prototype,"heightModelInfo",null),u([d()],at.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],at.prototype,"alphaCompositingEnabled",void 0),u([d({type:Boolean})],at.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],at.prototype,"type",void 0),u([d({type:iwe})],at.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],at.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],at.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],at.prototype,"viewingMode",null),u([d({type:Cd,aliasOf:"stateManager.viewpoint"})],at.prototype,"viewpoint",void 0),u([d({type:Number,aliasOf:"stateManager.zoom"})],at.prototype,"zoom",void 0),u([d({type:zG})],at.prototype,"highlightOptions",void 0),at=u([P("esri.views.SceneView")],at),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(lR||(lR={}));const nx=M(),w6=Vr(),Bne=Gt(),$ht=at;let _m=class extends qfe(sme(QO)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new G1,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};u([d({type:Wfe})],_m.prototype,"elevationInfo",void 0),u([d(HD(G1,"graphics"))],_m.prototype,"graphics",void 0),u([d({type:["show","hide"]})],_m.prototype,"listMode",void 0),u([d()],_m.prototype,"screenSizePerspectiveEnabled",void 0),u([d({readOnly:!0})],_m.prototype,"type",void 0),u([d({constructOnly:!0})],_m.prototype,"internal",void 0),_m=u([P("esri.layers.GraphicsLayer")],_m);const Dht=_m;function Lht(e){const t=e.map(({color:i})=>typeof i=="string"?Nht(i):i);return i=>{for(let r=0;r<e.length;r++){const s=e[r],n=t[r];if(i<=s.offset){if(r===0)return t[0];const o=e[r-1],a=(i-o.offset)/(s.offset-o.offset),l=t[r-1],c=n,h=[0,0,0];for(let p=0;p<3;p++)h[p]=l[p]*(1-a)+c[p]*a;return h}}return t[t.length-1]}}function Nht(e){return[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)]}let Dd=class extends be{constructor(){super(...arguments),this.sourceArea=new ni({xmin:840103.5041,xmax:874366.7884,ymin:57635160728e-4,ymax:57934100282e-4,spatialReference:Ke.WebMercator}),this.displayArea=new ni({xmin:0,xmax:100,ymin:0,ymax:100,zmin:0,zmax:20,spatialReference:Ke.WebMercator}),this.samplingResolutionPixels=1024,this.elevationMeshResolutionPixels=1024,this.colorTextureResolution=512,this.terrainColorSaturation=2,this.surfacePaddingBottom=.01,this.colorRamp=Lht([{offset:0,color:"#607d5f"},{offset:.4,color:"#786738"},{offset:.7,color:"#f0ead8"},{offset:1,color:"#FFFFFF"}])}};Hr([d()],Dd.prototype,"sourceArea",void 0);Hr([d()],Dd.prototype,"displayArea",void 0);Hr([d()],Dd.prototype,"samplingResolutionPixels",void 0);Hr([d()],Dd.prototype,"elevationMeshResolutionPixels",void 0);Hr([d()],Dd.prototype,"colorTextureResolution",void 0);Hr([d()],Dd.prototype,"terrainColorSaturation",void 0);Hr([d()],Dd.prototype,"surfacePaddingBottom",void 0);Hr([d()],Dd.prototype,"colorRamp",void 0);Dd=Hr([P("Configuration")],Dd);function cf(e=Uht){return[e[0],e[1],e[2],e[3]]}function x6(e,t,i=cf()){return ne(i,e),i[3]=t,i}function a7(e,t,i=cf()){return DL(bI,e,DN(e)),DL(Vne,t,DN(t)),bq(bI,Vne,bI),Fht(i,el(_q(i,bI)))}function DN(e){return $t(e[3])}function Fht(e,t){return e[3]=t,e}const Uht=[0,0,1,0],bI=vf(),Vne=vf();cf();var l7;let Ep=l7=class extends _e{constructor(e){super(e),this.origin=M(),this.translation=M(),this.rotation=cf(),this.scale=Le(1,1,1),this.geographic=!0}get localMatrix(){const e=Ae();return Qce(e,this.scale),Ha(e,e,DN(this.rotation),this.rotation),ga(e,e,this.translation),e}get localMatrixInverse(){return jr(Ae(),this.localMatrix)}applyLocal(e,t){return Fe(t,e,this.localMatrix)}applyLocalInverse(e,t){return Fe(t,e,this.localMatrixInverse)}project(e,t){const i=new Float64Array(e.length),r=yr.fromTypedArray(i),s=yr.fromTypedArray(e);if(this.geographic){const a=fg(t),l=Ae();return nl(t,this.origin,l,a),xr(l,l,this.localMatrix),hg(r,s,l),Pr(i,a,0,i,t,0,i.length/3),i}const{localMatrix:n,origin:o}=this;Dj(n,Es)?e5(r,s):hg(r,s,n);for(let a=0;a<i.length;a+=3)i[a+0]+=o[0],i[a+1]+=o[1],i[a+2]+=o[2];return i}getOriginPoint(e){const[t,i,r]=this.origin;return new We({x:t,y:i,z:r,spatialReference:e})}equals(e){return _(e)&&this.geographic===e.geographic&&da(this.origin,e.origin)&&sue(this.localMatrix,e.localMatrix)}clone(){const e={origin:ts(this.origin),translation:ts(this.translation),rotation:cf(this.rotation),scale:ts(this.scale),geographic:this.geographic};return new l7(e)}};u([d({type:[Number],nonNullable:!0,json:{write:!0}})],Ep.prototype,"origin",void 0),u([d({type:[Number],nonNullable:!0,json:{write:!0}})],Ep.prototype,"translation",void 0),u([d({type:[Number],nonNullable:!0,json:{write:!0}})],Ep.prototype,"rotation",void 0),u([d({type:[Number],nonNullable:!0,json:{write:!0}})],Ep.prototype,"scale",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0}})],Ep.prototype,"geographic",void 0),u([d()],Ep.prototype,"localMatrix",null),u([d()],Ep.prototype,"localMatrixInverse",null),Ep=l7=u([P("esri.geometry.support.MeshTransform")],Ep);const LN=Ep;function fv(e,t){var i;return e.isGeographic||e.isWebMercator&&((i=t==null?void 0:t.geographic)==null||i)}function xX(e,t,i){return fv(t.spatialReference,i)?Vht(e,t,i):Bht(e,t,i)}function zht(e,t,i){const{position:r,normal:s,tangent:n}=e;if(C(t))return{position:r,normal:s,tangent:n};const o=t.localMatrix;return xX({position:G_e(r,new Float64Array(r.length),o),normal:_(s)?j_e(s,new Float32Array(s.length),o):null,tangent:_(n)?H_e(n,new Float32Array(n.length),o):null},t.getOriginPoint(i),{geographic:t.geographic})}function kht(e,t,i){if(i!=null&&i.useTransform){var r;const{position:s,normal:n,tangent:o}=e;return{vertexAttributes:{position:s,normal:n,tangent:o},transform:new LN({origin:[t.x,t.y,(r=t.z)!=null?r:0],geographic:fv(t.spatialReference,i)})}}return{vertexAttributes:xX(e,t,i),transform:null}}function rwe(e,t,i){return fv(t.spatialReference,i)?swe(e,t,i):c7(e,t,i)}function Sgt(e,t,i,r){if(C(t))return rwe(e,i,r);const s=zht(e,t,i.spatialReference);return i.equals(t.getOriginPoint(i.spatialReference))?c7(s,i,r):fv(i.spatialReference,r)?swe(s,i,r):c7(s,i,r)}function Bht(e,t,i){const r=new Float64Array(e.position.length),s=e.position,n=t.x,o=t.y,a=t.z||0,{horizontal:l,vertical:c}=TX(i?i.unit:null,t.spatialReference);for(let h=0;h<s.length;h+=3)r[h+0]=s[h+0]*l+n,r[h+1]=s[h+1]*l+o,r[h+2]=s[h+2]*c+a;return{position:r,normal:e.normal,tangent:e.tangent}}function Vht(e,t,i){const r=t.spatialReference,s=nwe(t,i,u7),n=new Float64Array(e.position.length),o=Ght(e.position,s,r,n),a=G0(owe,s);return{position:o,normal:jht(o,n,e.normal,a,r),tangent:Hht(o,n,e.tangent,a,r)}}function Ght(e,t,i,r){hg(yr.fromTypedArray(r),yr.fromTypedArray(e),t);const s=new Float64Array(e.length);return Y4(r,s,i)}function jht(e,t,i,r,s){if(C(i))return null;const n=new Float32Array(i.length);return $d(pi.fromTypedArray(n),pi.fromTypedArray(i),r),W4(n,e,t,s,n),n}function Hht(e,t,i,r,s){if(C(i))return null;const n=new Float32Array(i.length);$d(pi.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),pi.fromTypedArray(i,4*Float32Array.BYTES_PER_ELEMENT),r);for(let o=3;o<n.length;o+=4)n[o]=i[o];return Z4(n,e,t,s,n),n}function c7(e,t,i){const r=new Float64Array(e.position.length),s=e.position,n=t.x,o=t.y,a=t.z||0,{horizontal:l,vertical:c}=TX(i?i.unit:null,t.spatialReference);for(let h=0;h<s.length;h+=3)r[h+0]=(s[h+0]-n)/l,r[h+1]=(s[h+1]-o)/l,r[h+2]=(s[h+2]-a)/c;return{position:r,normal:e.normal,tangent:e.tangent}}function swe(e,t,i){const r=t.spatialReference;nwe(t,i,u7);const s=jr(Yht,u7),n=new Float64Array(e.position.length),o=qht(e.position,r,s,n),a=G0(owe,s);return{position:o,normal:Wht(e.normal,e.position,n,r,a),tangent:Xht(e.tangent,e.position,n,r,a)}}function nwe(e,t,i){nl(e.spatialReference,[e.x,e.y,e.z||0],i,fg(e.spatialReference));const{horizontal:r,vertical:s}=TX(t?t.unit:null,e.spatialReference);return kO(i,i,[r,r,s]),i}function qht(e,t,i,r){const s=X4(e,t,r),n=yr.fromTypedArray(s),o=new Float64Array(s.length),a=yr.fromTypedArray(o);return hg(a,n,i),o}function Wht(e,t,i,r,s){if(C(e))return null;const n=_M(e,t,i,r,new Float32Array(e.length)),o=pi.fromTypedArray(n);return $d(o,o,s),n}function Xht(e,t,i,r,s){if(C(e))return null;const n=bM(e,t,i,r,new Float32Array(e.length)),o=pi.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT);return $d(o,o,s),n}function TX(e,t){if(C(e))return Zht;const i=t.isGeographic?1:Gce(t),r=t.isGeographic?1:lb(t),s=ys(1,e,"meters");return{horizontal:s*i,vertical:s*r}}const u7=Ae(),Yht=Ae(),owe=Qi(),Zht={horizontal:1,vertical:1},h7=pe.getLogger("esri.geometry.support.meshUtils.centerAt");function Qht(e,t,i){var r;if(!e.vertexAttributes||!e.vertexAttributes.position)return;const s=(r=i==null?void 0:i.origin)!=null?r:e.origin;_(e.transform)?((i==null?void 0:i.geographic)!=null&&i.geographic!==e.transform.geographic&&h7.warn(`Specifying the 'geographic' parameter (${i.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),Jht(e.transform,t,s)):fv(e.spatialReference,i)?Kht(e,t,s):edt(e,t,s)}function Jht(e,t,i){const r=t.x-i.x,s=t.y-i.y,n=t.hasZ&&i.hasZ?t.z-i.z:0,o=e.origin;e.origin=[o[0]+r,o[1]+s,o[2]+n]}function Kht(e,t,i){const r=rwe(e.vertexAttributes,i,{geographic:!0}),{position:s,normal:n,tangent:o}=xX(r,t,{geographic:!0});e.vertexAttributes.position=s,e.vertexAttributes.normal=n,e.vertexAttributes.tangent=o,e.vertexAttributesChanged()}function edt(e,t,i){const r=rdt,s=idt;if(Mr(t,s,e.spatialReference)){if(!Mr(i,r,e.spatialReference)){const n=e.origin;r[0]=n.x,r[1]=n.y,r[2]=n.z,h7.error(`Failed to project specified origin (wkid:${i.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}tdt(e.vertexAttributes.position,s,r),e.vertexAttributesChanged()}else h7.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid})`)}function tdt(e,t,i){if(e)for(let r=0;r<e.length;r+=3)for(let s=0;s<3;s++)e[r+s]+=t[s]-i[s]}const idt=M(),rdt=M();async function sdt(e,t,i){const{loadGLTFMesh:r}=await qN(import("./loadGLTFMesh.b6a085c4.js"),i),s=await awe(t,i),n=r(new We({x:0,y:0,z:0,spatialReference:e.spatialReference}),s.url,{resolveFile:ndt(s),useTransform:!0,signal:_(i)?i.signal:null});n.then(()=>s.dispose(),()=>s.dispose());const{vertexAttributes:o,components:a}=await n;e.vertexAttributes=o,e.components=a}function ndt(e){const t=Yle(e.url);return i=>{var r;const s=uF(i,t,t),n=s?s.replace(/^ *\.\//,""):null;return(r=e.files.get(n))!=null?r:i}}async function awe(e,t){return e instanceof Blob?a2.fromBlob(e):typeof e=="string"?new a2(e):Array.isArray(e)?odt(e,t):adt(e,t)}async function odt(e,t){const i=new Map;let r=null;const s=await Aoe(e.map(async o=>({name:o.name,source:await awe(o instanceof Blob?o:o.source,t)}))),n=[];for(const o of s)o&&(Ts(t)?o.source.dispose():n.push(o));qt(t);for(const{name:o,source:a}of n)(C(r)||/\.(gltf|glb)/i.test(o))&&(r=a.url),i.set(o,a.url),a.files&&a.files.forEach((l,c)=>i.set(c,l));if(C(r))throw new Y("mesh-load-external:missing-files","Missing files to load external mesh source");return new a2(r,()=>n.forEach(({source:o})=>o.dispose()),i)}async function adt(e,t){const{default:i}=await qN(Promise.resolve().then(function(){return nce}),t),r=typeof e.multipart[0]=="string"?await Promise.all(e.multipart.map(async s=>(await i(s,{responseType:"array-buffer"})).data)):e.multipart;return a2.fromBlob(new Blob(r))}class a2{constructor(t,i=()=>{},r=new Map){this.url=t,this.dispose=i,this.files=r}static fromBlob(t){const i=URL.createObjectURL(t);return new a2(i,()=>URL.revokeObjectURL(i))}}const ldt=pe.getLogger("esri.geometry.support.meshUtils.offset");function cdt(e,t,i){e.vertexAttributes&&e.vertexAttributes.position&&(_(e.transform)?((i==null?void 0:i.geographic)!=null&&i.geographic!==e.transform.geographic&&ldt.warn(`Specifying the 'geographic' parameter (${i.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),udt(e.transform,t)):fv(e.spatialReference,i)?hdt(e,t):ddt(e,t))}function udt(e,t){const i=e.origin;e.origin=fe(M(),i,t)}function hdt(e,t){const i=e.spatialReference,r=e.vertexAttributes.position,s=e.vertexAttributes.normal,n=e.vertexAttributes.tangent,o=new Float64Array(r.length),a=_(s)?new Float32Array(s.length):null,l=_(n)?new Float32Array(n.length):null,c=e.extent.center,h=pdt;nl(i,[c.x,c.y,c.z],Gne,fg(i)),Wl(jne,Gne),so(h,t,jne),X4(r,i,o),_(s)&&_M(s,r,o,i,a),_(n)&&bM(n,r,o,i,l),lwe(o,h),Y4(o,r,i),_(s)&&W4(a,r,o,i,s),_(n)&&Z4(l,r,o,i,n),e.vertexAttributesChanged()}function ddt(e,t){lwe(e.vertexAttributes.position,t),e.vertexAttributesChanged()}function lwe(e,t){if(e)for(let i=0;i<e.length;i+=3)for(let r=0;r<3;r++)e[i+r]+=t[r]}const pdt=M(),Gne=Ae(),jne=Qi();function fdt(){const{faceDescriptions:e,faceVertexOffsets:t,uvScales:i}=xdt,r=4*e.length,s=new Float64Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Uint32Array(2*e.length*3);let l=0,c=0,h=0,p=0;for(let f=0;f<e.length;f++){const g=e[f],y=l/3;for(const b of t)a[p++]=y+b;const v=g.corners;for(let b=0;b<4;b++){const w=v[b];let S=0;o[h++]=.25*i[b][0]+g.uvOrigin[0],o[h++]=g.uvOrigin[1]-.25*i[b][1];for(let x=0;x<3;x++)g.axis[x]!==0?(s[l++]=.5*g.axis[x],n[c++]=g.axis[x]):(s[l++]=.5*w[S++],n[c++]=0)}}return{position:s,normal:n,uv:o,faces:a}}function mdt(e,t){const i=e.components[0],r=i.faces,s=Tdt[t],n=6*s,o=new Uint32Array(6),a=new Uint32Array(r.length-6);let l=0,c=0;for(let h=0;h<r.length;h++)h>=n&&h<n+6?o[l++]=r[h]:a[c++]=r[h];if(_(e.vertexAttributes.uv)){const h=new Float32Array(e.vertexAttributes.uv),p=4*s*2,f=[0,1,1,1,1,0,0,0];for(let g=0;g<f.length;g++)h[p+g]=f[g];e.vertexAttributes.uv=h}return e.components=[new rv({faces:o,material:i.material}),new rv({faces:a})],e}function gdt(e=0){const t=Math.round(8*2**e),i=2*t,r=(t-1)*(i+1)+2*i,s=new Float64Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Uint32Array(3*((t-1)*i*2));let l=0,c=0,h=0,p=0;for(let f=0;f<=t;f++){const g=f/t*Math.PI+.5*Math.PI,y=Math.cos(g),v=Math.sin(g);dn[2]=v;const b=f===0||f===t,w=b?i-1:i;for(let S=0;S<=w;S++){const x=S/w*2*Math.PI;dn[0]=-Math.sin(x)*y,dn[1]=Math.cos(x)*y;for(let E=0;E<3;E++)s[l]=.5*dn[E],n[l]=dn[E],++l;o[c++]=(S+(b?.5:0))/i,o[c++]=f/t,f!==0&&S!==i&&(f!==t&&(a[h++]=p,a[h++]=p+1,a[h++]=p-i),f!==1&&(a[h++]=p,a[h++]=p-i,a[h++]=p-i-1)),p++}}return{position:s,normal:n,uv:o,faces:a}}function ydt(e=0){const i=Math.round(16*2**e),r=(5-1)*(i+1)+2*i,s=new Float64Array(3*r),n=new Float32Array(3*r),o=new Float32Array(2*r),a=new Uint32Array(3*(4*i));let l=0,c=0,h=0,p=0,f=0;for(let g=0;g<=5;g++){const y=g===0||g===5,v=g<=1||g>=5-1,b=g===2||g===4,w=y?i-1:i;for(let S=0;S<=w;S++){const x=S/w*2*Math.PI,E=y?0:.5;dn[0]=E*Math.sin(x),dn[1]=E*-Math.cos(x),dn[2]=g<=2?.5:-.5;for(let R=0;R<3;R++)s[l++]=dn[R],n[c++]=v?R===2?g<=1?1:-1:0:R===2?0:dn[R]/E;o[h++]=(S+(y?.5:0))/i,o[h++]=g<=1?1*g/3:g<=3?1*(g-2)/3+1/3:1*(g-4)/3+2/3,b||g===0||S===i||(g!==5&&(a[p++]=f,a[p++]=f+1,a[p++]=f-i),g!==1&&(a[p++]=f,a[p++]=f-i,a[p++]=f-i-1)),f++}}return{position:s,normal:n,uv:o,faces:a}}function vdt(e,t){const i=typeof t=="number"?t:t!=null?t.width:1,r=typeof t=="number"?t:t!=null?t.height:1;switch(e){case"up":case"down":return{width:i,depth:r};case"north":case"south":return{width:i,height:r};case"east":case"west":return{depth:i,height:r}}}function _dt(e){const t=oA.facingAxisOrderSwap[e],i=oA.position,r=oA.normal,s=new Float64Array(i.length),n=new Float32Array(r.length);let o=0;for(let a=0;a<4;a++){const l=o;for(let c=0;c<3;c++){const h=t[c],p=Math.abs(h)-1,f=h>=0?1:-1;s[o]=i[l+p]*f,n[o]=r[l+p]*f,o++}}return{position:s,normal:n,uv:new Float32Array(oA.uv),faces:new Uint32Array(oA.faces),isPlane:!0}}const ox=1,ax=2,lx=3,oA={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[lx,ox,ax],west:[-lx,-ox,ax],north:[-ox,lx,ax],south:[ox,-lx,ax],up:[ox,ax,lx],down:[ox,-ax,-lx]}};function wI(e,t,i){e.isPlane||bdt(e),wdt(e,i&&i.size);const{vertexAttributes:r,transform:s}=kht(e,t,i);return{vertexAttributes:new aa(ge(L({},r),{uv:e.uv})),transform:s,components:[new rv({faces:e.faces,material:i&&i.material||null})],spatialReference:t.spatialReference}}function bdt(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}function wdt(e,t){if(t==null)return;const i=typeof t=="number"?[t,t,t]:[t.width!=null?t.width:1,t.depth!=null?t.depth:1,t.height!=null?t.height:1];ay[0]=i[0],ay[4]=i[1],ay[8]=i[2];for(let r=0;r<e.position.length;r+=3){for(let s=0;s<3;s++)dn[s]=e.position[r+s];so(dn,dn,ay);for(let s=0;s<3;s++)e.position[r+s]=dn[s]}if(i[0]!==i[1]||i[1]!==i[2]){ay[0]=1/i[0],ay[4]=1/i[1],ay[8]=1/i[2];for(let r=0;r<e.normal.length;r+=3){for(let s=0;s<3;s++)dn[s]=e.normal[r+s];so(dn,dn,ay),Te(dn,dn);for(let s=0;s<3;s++)e.normal[r+s]=dn[s]}}}const xdt={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},Tdt={south:0,east:1,north:2,west:3,up:4,down:5},dn=M(),ay=Qi(),cwe=pe.getLogger("esri.geometry.support.meshUtils.rotate");function Sdt(e,t,i){if(!e.vertexAttributes||!e.vertexAttributes.position||t[3]===0)return;const r=e.spatialReference;if(_(e.transform)){var s;(i==null?void 0:i.geographic)!=null&&i.geographic!==e.transform.geographic&&cwe.warn(`Specifying the 'geographic' parameter (${i.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const o=(s=i==null?void 0:i.origin)!=null?s:e.transform.getOriginPoint(r);Edt(e.transform,t,o)}else{var n;const o=(n=i==null?void 0:i.origin)!=null?n:e.origin;fv(e.spatialReference,i)?Adt(e,t,o):Cdt(e,t,o)}}function Edt(e,t,i){const r=se(xT,i.x,i.y,i.z),s=de(xT,r,e.origin);e.applyLocalInverse(s,Hne),e.rotation=a7(e.rotation,t,cf()),e.applyLocalInverse(s,s),de(s,s,Hne),e.translation=fe(M(),e.translation,s)}function Adt(e,t,i){const r=e.spatialReference,s=fg(r),n=uwe;Mr(i,n,s)||Mr(e.origin,n,s);const o=e.vertexAttributes.position,a=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(o.length),h=_(a)?new Float32Array(a.length):null,p=_(l)?new Float32Array(l.length):null;nl(s,n,NN,s),Wl(Wne,NN);const f=qne;so(qne,t,Wne),f[3]=t[3],X4(o,r,c),_(a)&&_M(a,o,c,r,h),_(l)&&bM(l,o,c,r,p),JT(c,f,3,n),Y4(c,o,r),_(a)&&(JT(h,f,3),W4(h,o,c,r,a)),_(l)&&(JT(p,f,4),Z4(p,o,c,r,l)),e.vertexAttributesChanged()}function Cdt(e,t,i){const r=uwe;if(!Mr(i,r,e.spatialReference)){const s=e.origin;r[0]=s.x,r[1]=s.y,r[2]=s.z,cwe.error(`Failed to project specified origin (wkid:${i.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}JT(e.vertexAttributes.position,t,3,r),JT(e.vertexAttributes.normal,t,3),JT(e.vertexAttributes.tangent,t,4),e.vertexAttributesChanged()}function JT(e,t,i,r=pa){if(!C(e)){sl(NN,DN(t),t);for(let s=0;s<e.length;s+=i){for(let n=0;n<3;n++)xT[n]=e[s+n]-r[n];Fe(xT,xT,NN);for(let n=0;n<3;n++)e[s+n]=xT[n]+r[n]}}}const xT=M(),Hne=M(),qne=cf(),NN=Ae(),Wne=Qi(),uwe=M(),hwe=pe.getLogger("esri.geometry.support.meshUtils.scale");function Rdt(e,t,i){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const r=e.spatialReference;if(_(e.transform)){var s;(i==null?void 0:i.geographic)!=null&&i.geographic!==e.transform.geographic&&hwe.warn(`Specifying the 'geographic' parameter (${i.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const n=(s=i==null?void 0:i.origin)!=null?s:e.transform.getOriginPoint(r);Odt(e.transform,t,n)}else{const n=fv(e.spatialReference,i),o=i&&i.origin||e.origin;n?Mdt(e,t,o):Pdt(e,t,o)}}function Odt(e,t,i){const r=se(TT,i.x,i.y,i.z),s=de(TT,r,e.origin);e.applyLocalInverse(s,Xne);const n=oe(M(),e.scale,t);e.scale=n,e.applyLocalInverse(s,s),de(s,s,Xne),e.translation=fe(M(),e.translation,s)}function Mdt(e,t,i){const r=e.spatialReference,s=fg(r),n=pwe;Mr(i,n,s)||Mr(e.origin,n,s);const o=e.vertexAttributes.position,a=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(o.length),h=_(a)?new Float32Array(a.length):null,p=_(l)?new Float32Array(l.length):null;X4(o,r,c),_(a)&&_M(a,o,c,r,h),_(l)&&bM(l,o,c,r,p),dwe(c,t,n),Y4(c,o,r),_(a)&&W4(h,o,c,r,a),_(l)&&Z4(p,o,c,r,l),e.vertexAttributesChanged()}function Pdt(e,t,i){const r=pwe;if(!Mr(i,r,e.spatialReference)){const s=e.origin;r[0]=s.x,r[1]=s.y,r[2]=s.z,hwe.error(`Failed to project specified origin (wkid:${i.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}dwe(e.vertexAttributes.position,t,r),e.vertexAttributesChanged()}function dwe(e,t,i=pa){if(e)for(let r=0;r<e.length;r+=3){for(let s=0;s<3;s++)TT[s]=e[r+s]-i[s];oe(TT,TT,t);for(let s=0;s<3;s++)e[r+s]=TT[s]+i[s]}}const TT=M(),Xne=M(),pwe=M();var Xh;const yu=pe.getLogger("esri.geometry.Mesh");let xl=Xh=class extends Fd(rf.LoadableMixin(v2(tl))){constructor(e){super(e),this.components=null,this.transform=null,this.external=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new aa,this.type="mesh"}initialize(){(C(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(xe(()=>{var e;return{vertexAttributes:this.vertexAttributes,components:(e=this.components)==null?void 0:e.map(t=>t.clone()),transform:_(this.transform)?this.transform.clone():null}},()=>this._set("external",null),{once:!0,sync:!0}))})}get hasExtent(){return!this.loaded&&_(this.external)&&_(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}get boundingInfo(){const e=this.vertexAttributes.position,t=this.spatialReference;if(e.length===0||this.components&&this.components.length===0)return{extent:new ni({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:t}),center:new We({x:0,y:0,z:0,spatialReference:t})};const i=_(this.transform)?this.transform.project(e,t):e;let r=1/0,s=1/0,n=1/0,o=-1/0,a=-1/0,l=-1/0,c=0,h=0,p=0;const f=i.length,g=1/(f/3);let y=0;for(;y<f;){const v=i[y++],b=i[y++],w=i[y++];r=Math.min(r,v),s=Math.min(s,b),n=Math.min(n,w),o=Math.max(o,v),a=Math.max(a,b),l=Math.max(l,w),c+=g*v,h+=g*b,p+=g*w}return{extent:new ni({xmin:r,ymin:s,zmin:n,xmax:o,ymax:a,zmax:l,spatialReference:t}),center:new We({x:c,y:h,z:p,spatialReference:t})}}get anchor(){if(_(this.transform))return this.transform.getOriginPoint(this.spatialReference);const e=this.boundingInfo;return new We({x:e.center.x,y:e.center.y,z:e.extent.zmin,spatialReference:this.spatialReference})}get origin(){return _(this.transform)?this.transform.getOriginPoint(this.spatialReference):this.boundingInfo.center}get extent(){return!this.loaded&&_(this.external)&&_(this.external.extent)?this.external.extent.clone():this.boundingInfo.extent}addComponent(e){this.loaded?(this.components||(this.components=[]),this.components.push(rv.from(e)),this.notifyChange("components")):yu.error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(e){if(this.loaded){if(this.components){const t=this.components.indexOf(e);if(t!==-1)return this.components.splice(t,1),void this.notifyChange("components")}yu.error("removeComponent()","Provided component is not part of the list of components")}else yu.error("removeComponent()","Mesh must be loaded before applying operations")}rotate(e,t,i,r){return x6(T6.x,e,cx),x6(T6.y,t,Yne),x6(T6.z,i,Zne),a7(cx,Yne,cx),a7(cx,Zne,cx),Sdt(this,cx,r),this}offset(e,t,i,r){return this.loaded?(xI[0]=e,xI[1]=t,xI[2]=i,cdt(this,xI,r),this):(yu.error("offset()","Mesh must be loaded before applying operations"),this)}scale(e,t){return this.loaded?(Rdt(this,e,t),this):(yu.error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(e,t){return this.loaded?(Qht(this,e,t),this):(yu.error("centerAt()","Mesh must be loaded before applying operations"),this)}load(e){return _(this.external)&&this.addResolvingPromise(sdt(this,this.external.source,e)),Promise.resolve(this)}clone(){const e=this.components?new Map:null,t=this.components?new Map:null,i={components:this.components?this.components.map(r=>r.cloneWithDeduplication(e,t)):null,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:_(this.transform)?this.transform.clone():null,external:_(this.external)?{source:this.external.source,extent:_(this.external.extent)?this.external.extent.clone():null}:null};return new Xh(i)}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(e){const{toBinaryGLTF:t}=await import("./gltfexport.f399b11d.js");return t(this,e)}static createBox(e,t){if(!(e instanceof We))return yu.error(".createBox()","expected location to be a Point instance"),null;const i=new Xh(wI(fdt(),e,t));return t&&t.imageFace&&t.imageFace!=="all"?mdt(i,t.imageFace):i}static createSphere(e,t){return e instanceof We?new Xh(wI(gdt(t&&t.densificationFactor||0),e,t)):(yu.error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(e,t){return e instanceof We?new Xh(wI(ydt(t&&t.densificationFactor||0),e,t)):(yu.error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(e,t){var i;if(!(e instanceof We))return yu.error(".createPlane()","expected location to be a Point instance"),null;const r=(i=t==null?void 0:t.facing)!=null?i:"up",s=vdt(r,t==null?void 0:t.size);return new Xh(wI(_dt(r),e,ge(L({},t),{size:s})))}static createFromPolygon(e,t){if(!(e instanceof jl))return yu.error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const i=zXe(e);return new Xh({vertexAttributes:new aa({position:i.position}),components:[new rv({faces:i.faces,shading:"flat",material:t&&t.material||null})],spatialReference:e.spatialReference})}static async createFromGLTF(e,t,i){if(!(e instanceof We))throw yu.error(".createfromGLTF()","expected location to be a Point instance"),new Y("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:r}=await qN(import("./loadGLTFMesh.b6a085c4.js"),i);return new Xh(await r(e,t,i))}static createWithExternalSource(e,t,i){var r,s,n;const o=(r=i==null?void 0:i.extent)!=null?r:null,a=(s=i==null?void 0:i.transform.clone())!=null?s:new LN;a.origin=[e.x,e.y,(n=e.z)!=null?n:0];const l=e.spatialReference;return new Xh({external:{source:t,extent:o},transform:a,spatialReference:l})}static createIncomplete(e,t){var i,r;const s=(i=t==null?void 0:t.transform.clone())!=null?i:new LN;s.origin=[e.x,e.y,(r=e.z)!=null?r:0];const n=e.spatialReference,o=new Xh({transform:s,spatialReference:n});return o.addResolvingPromise(Promise.reject(new Y("mesh-incomplete","Mesh resources are not complete"))),o}};u([d({type:[rv],json:{write:!0}})],xl.prototype,"components",void 0),u([d({type:LN,json:{write:!0}})],xl.prototype,"transform",void 0),u([d({constructOnly:!0})],xl.prototype,"external",void 0),u([d({readOnly:!0})],xl.prototype,"hasExtent",null),u([d({readOnly:!0})],xl.prototype,"boundingInfo",null),u([d({readOnly:!0})],xl.prototype,"anchor",null),u([d({readOnly:!0})],xl.prototype,"origin",null),u([d({readOnly:!0,json:{read:!1}})],xl.prototype,"extent",null),u([d({readOnly:!0,json:{read:!1,write:!0,default:!0}})],xl.prototype,"hasZ",void 0),u([d({readOnly:!0,json:{read:!1,write:!0,default:!1}})],xl.prototype,"hasM",void 0),u([d({type:aa,nonNullable:!0,json:{write:!0}})],xl.prototype,"vertexAttributes",void 0),xl=Xh=u([P("esri.geometry.Mesh")],xl);const T6={x:Le(1,0,0),y:Le(0,1,0),z:Le(0,0,1)},cx=cf(),Yne=cf(),Zne=cf(),xI=M(),Idt=xl;let Ld=class extends be{constructor(t){super(t),this.sourceZmin=0,this.sourceZmax=0}get demResolution(){return this.sampler.demResolution}get extent(){return this.sampler.extent}get spatialReference(){return this.sampler.spatialReference}get noDataValue(){return this.sampler.noDataValue}initialize(){let t=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;for(const n of this.sampler.samplers)for(const o of n.tile.samplerData.pixelData)t=Math.min(t,o),i=Math.max(i,o);this.sourceZmin=t,this.sourceZmax=i;const r=i-t,s=this.config.displayArea.zmax-this.config.displayArea.zmin;this.scale=s/r,this.offset=this.config.displayArea.zmin-t}elevationAt(t,i){const r=this.sampler.elevationAt(t,i);return r===this.sampler.noDataValue?r:this.scaleValue(r)}on(t,i){return this.sampler.on(t,i)}queryElevation(t){const i=this.sampler.queryElevation(t);switch(i.type){case"multipoint":this.scaleCoords(i.points);break;case"polyline":for(const r of i.paths)this.scaleCoords(r);break;case"point":i.z=this.scaleValue(i.z);break}return i}scaleValue(t){return(t+this.offset)*this.scale}scaleCoords(t){for(const i of t)i[2]=this.scaleValue(i[2])}};Hr([d()],Ld.prototype,"config",void 0);Hr([d()],Ld.prototype,"sampler",void 0);Hr([d()],Ld.prototype,"demResolution",null);Hr([d()],Ld.prototype,"extent",null);Hr([d()],Ld.prototype,"spatialReference",null);Hr([d()],Ld.prototype,"noDataValue",null);Hr([d()],Ld.prototype,"sourceZmin",void 0);Hr([d()],Ld.prototype,"sourceZmax",void 0);Ld=Hr([P("ExaggeratedElevationSampler")],Ld);const $dt={type:Fm,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:Ddt}}}}};function Ddt(e,t,i,r){if(!e)return null;const{minScale:s,maxScale:n,minLOD:o,maxLOD:a}=t;if(o!=null&&a!=null)return r&&r.ignoreMinMaxLOD?Fm.fromJSON(e):Fm.fromJSON(ge(L({},e),{lods:e.lods.filter(({level:l})=>l!=null&&l>=o&&l<=a)}));if(s!==0&&n!==0){const l=p=>Math.round(1e4*p)/1e4,c=s?l(s):1/0,h=n?l(n):-1/0;return Fm.fromJSON(ge(L({},e),{lods:e.lods.filter(p=>{const f=l(p.scale);return f<=c&&f>=h})}))}return Fm.fromJSON(e)}class KT{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}getAvailability(t,i){if(this._allAvailability!=="unknown")return this._allAvailability;const r=(t-this.location.top)*this.location.width+(i-this.location.left),s=r%8,n=r>>3,o=this._tileAvailabilityBitSet;return n<0||n>o.length?"unknown":o[n]&1<<s?"available":"unavailable"}_updateFromData(t){const i=this.location.width,r=this.location.height;let s=!0,n=!0;const o=Math.ceil(i*r/8),a=new Uint8Array(o);let l=0;for(let c=0;c<t.length;c++){const h=c%8;t[c]?(n=!1,a[l]|=1<<h):s=!1,h===7&&++l}n?this._allAvailability="unavailable":s?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=a,this.byteSize+=a.length)}static fromDefinition(t,i){const r=t.service.request||Pi,{row:s,col:n,width:o,height:a}=t,l={query:{f:"json"}};return i=i?L(L({},l),i):l,r(Ldt(t),i).then(c=>c.data).catch(c=>{if(c&&c.details&&c.details.httpStatus===422)return{location:{top:s,left:n,width:o,height:a},valid:!0,data:Uwe(o*a,0)};throw c}).then(c=>{if(c.location&&(c.location.top!==s||c.location.left!==n||c.location.width!==o||c.location.height!==a))throw new Y("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:s,left:n,width:o,height:a}});return KT.fromJSON(c)})}static fromJSON(t){KT._validateJSON(t);const i=new KT;return i.location=Object.freeze(re(t.location)),i._updateFromData(t.data),Object.freeze(i)}static _validateJSON(t){if(!t||!t.location)throw new Y("tilemap:missing-location","Location missing from tilemap response");if(t.valid===!1)throw new Y("tilemap:invalid","Tilemap response was marked as invalid");if(!t.data)throw new Y("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(t.data))throw new Y("tilemap:data-mismatch","Data must be an array of numbers");if(t.data.length!==t.location.width*t.location.height)throw new Y("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}function Qne(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}function Ldt(e){let t;if(e.service.type==="vector-tile")t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;else{const r=e.service.tileServers;t=`${r&&r.length?r[e.row%r.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const i=e.service.query;return i&&(t=`${t}?${i}`),t}var f1;const Ndt=pe.getLogger("esri.layers.support.TilemapCache");let Yh=f1=class extends Fd(be){constructor(e){super(e),this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2*db.MEGABYTES,this.request=Pi,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new Ofe(this.cacheByteSize),this.handles.add([this.watch(["layer.parsedUrl","layer.tileServers?","layer.apiKey?","layer.customParameters?"],()=>this._initializeTilemapDefinition()),xe(()=>{var e,t;return(e=this.layer)==null||(t=e.tileInfo)==null?void 0:t.lods},e=>this._initializeAvailableLevels(e),xs)]),this._initializeTilemapDefinition()}castLevels(e){return e<=2?(Ndt.error("Minimum levels for Tilemap is 3, but got ",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,r){if(!this._availableLevels[e])return Promise.reject(new Y("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const s=this._tmpTilemapDefinition,n=this._tilemapFromCache(e,t,i,s);if(n)return Promise.resolve(n);const o=r&&r.signal;return r=ge(L({},r),{signal:null}),new Promise((a,l)=>{Lo(o,()=>l(gi()));const c=Qne(s);let h=this._pendingTilemapRequests[c];if(!h){h=KT.fromDefinition(s,r).then(f=>(this._tilemapCache.put(c,f,f.byteSize),f));const p=()=>delete this._pendingTilemapRequests[c];this._pendingTilemapRequests[c]=h,h.then(p,p)}h.then(a,l)})}getAvailability(e,t,i){if(!this._availableLevels[e])return"unavailable";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"}fetchAvailability(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch(s=>s).then(s=>{if(s instanceof KT){const n=s.getAvailability(t,i);if(n==="unavailable")throw new Y("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i});return n}if(Tr(s))throw s;return"unknown"}):Promise.reject(new Y("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,r,s){r.level=e,r.row=t,r.col=i;const n=this.layer.tileInfo;n.updateTileInfo(r);const o=this.fetchAvailability(e,t,i,s).catch(a=>{if(Tr(a))throw a;if(n.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw a});return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,s,o),o}async _fetchAvailabilityUpsamplePrefetch(e,t,i,r,s,n){if(!this._prefetchingEnabled)return;const o=`prefetch-${e}`;if(this.handles.has(o))return;const a=new AbortController;n.then(()=>a.abort(),()=>a.abort());let l=!1;const c={remove(){l||(l=!0,a.abort())}};if(this.handles.add(c,o),await Ixe(10,a.signal).catch(()=>{}),l||(l=!0,this.handles.remove(o)),Ts(a))return;const h={id:e,level:t,row:i,col:r},p=ge(L({},s),{signal:a.signal}),f=this.layer.tileInfo;for(let g=0;f1._prefetches.length<f1._maxPrefetch&&f.upsampleTile(h);++g){const y=this.fetchAvailability(h.level,h.row,h.col,p);f1._prefetches.push(y);const v=()=>{f1._prefetches.removeUnordered(y)};y.then(v,v)}}_initializeTilemapDefinition(){var e;if(!this.layer.parsedUrl)return;const{parsedUrl:t,apiKey:i,customParameters:r}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:t.path,query:rb(ge(L(L({},t.query),r),{token:i!=null?i:(e=t.query)==null?void 0:e.token})),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const s=Qne(r);return this._tilemapCache.get(s)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach(t=>this._availableLevels[t.level]=!0)}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}};Yh._maxPrefetch=4,Yh._prefetches=new Vt({initialSize:f1._maxPrefetch}),u([d({constructOnly:!0,type:Number})],Yh.prototype,"levels",void 0),u([Bt("levels")],Yh.prototype,"castLevels",null),u([d({readOnly:!0,type:Number})],Yh.prototype,"size",null),u([d({constructOnly:!0,type:Number})],Yh.prototype,"cacheByteSize",void 0),u([d({constructOnly:!0})],Yh.prototype,"layer",void 0),u([d({constructOnly:!0})],Yh.prototype,"request",void 0),Yh=f1=u([P("esri.layers.support.TilemapCache")],Yh);const Fdt=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(i,r){return r.minLOD!=null&&r.maxLOD!=null?i:0}readMaxScale(i,r){return r.minLOD!=null&&r.maxLOD!=null?i:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(i,r){return r.capabilities&&r.capabilities.includes("Tilemap")?new Yh({layer:this}):null}};return u([d({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([d()],t.prototype,"minScale",void 0),u([Ne("service","minScale")],t.prototype,"readMinScale",null),u([d()],t.prototype,"maxScale",void 0),u([Ne("service","maxScale")],t.prototype,"readMaxScale",null),u([d({type:Ke})],t.prototype,"spatialReference",void 0),u([d({readOnly:!0})],t.prototype,"supportsBlankTile",null),u([d($dt)],t.prototype,"tileInfo",void 0),u([d()],t.prototype,"tilemapCache",void 0),u([Ne("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),u([d()],t.prototype,"version",void 0),t=u([P("esri.layers.mixins.ArcGISCachedService")],t),t},Jne=pe.getLogger("esri.layers.ElevationLayer");let So=class extends Fdt(Vfe(Jfe(tme(XH(QO))))){constructor(...e){super(...e),this.copyright=null,this.heightModelInfo=null,this.path=null,this.opacity=1,this.operationalLayerType="ArcGISTiledElevationServiceLayer",this.sourceJSON=null,this.type="elevation",this.url=null,this.version=null,this._lercDecoder=U1e()}normalizeCtorArgs(e,t){return typeof e=="string"?L({url:e},t):e}destroy(){this._lercDecoder=$i(this._lercDecoder)}set minScale(e){this.constructed&&Jne.warn(`${this.declaredClass}.minScale support has been removed (since 4.5)`)}get minScale(){}set maxScale(e){this.constructed&&Jne.warn(`${this.declaredClass}.maxScale support has been removed (since 4.5)`)}get maxScale(){}readVersion(e,t){let i=t.currentVersion;return i||(i=9.3),i}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:i=>{for(let r=0;r<i.typeKeywords.length;r++)if(i.typeKeywords[r].toLowerCase()==="elevation 3d layer")return!0;throw new Y("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).catch(hf).then(()=>this._fetchImageService(t))),Promise.resolve(this)}fetchTile(e,t,i,r){const s=_((r=r||{signal:null}).signal)?r.signal:r.signal=new AbortController().signal,n={responseType:"array-buffer",signal:s},o={noDataValue:r.noDataValue,returnFileInfo:!0};return this.load().then(()=>this._fetchTileAvailability(e,t,i,r)).then(()=>Pi(this.getTileUrl(e,t,i),n)).then(a=>this._lercDecoder.decode(a.data,o,s)).then(a=>({values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}))}getTileUrl(e,t,i){const r=!this.tilemapCache&&this.supportsBlankTile,s=rb(ge(L({},this.parsedUrl.query),{blankTile:!r&&null}));return`${this.parsedUrl.path}/tile/${e}/${t}/${i}${s?"?"+s:""}`}async queryElevation(e,t){const{ElevationQuery:i}=await import("./ElevationQuery.ac501639.js");return qt(t),new i().query(this,e,t)}async createElevationSampler(e,t){const{ElevationQuery:i}=await import("./ElevationQuery.ac501639.js");return qt(t),new i().createSampler(this,e,t)}_fetchTileAvailability(e,t,i,r){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,i,r):Promise.resolve("unknown")}async _fetchImageService(e){if(this.sourceJSON)return this.sourceJSON;const t={query:L({f:"json"},this.parsedUrl.query),responseType:"json",signal:e},i=await Pi(this.parsedUrl.path,t);i.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=i.data,this.read(i.data,{origin:"service",url:this.parsedUrl})}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};u([d({json:{read:{source:"copyrightText"}}})],So.prototype,"copyright",void 0),u([d({readOnly:!0,type:qb})],So.prototype,"heightModelInfo",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],So.prototype,"path",void 0),u([d({type:["show","hide"]})],So.prototype,"listMode",void 0),u([d({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],So.prototype,"minScale",null),u([d({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],So.prototype,"maxScale",null),u([d({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],So.prototype,"opacity",void 0),u([d({type:["ArcGISTiledElevationServiceLayer"]})],So.prototype,"operationalLayerType",void 0),u([d()],So.prototype,"sourceJSON",void 0),u([d({json:{read:!1},value:"elevation",readOnly:!0})],So.prototype,"type",void 0),u([d(Zfe)],So.prototype,"url",void 0),u([d()],So.prototype,"version",void 0),u([Ne("version",["currentVersion"])],So.prototype,"readVersion",null),So=u([P("esri.layers.ElevationLayer")],So),So.prototype.fetchTile.__isDefault__=!0;const fwe=So;var Udt=Object.freeze(Object.defineProperty({__proto__:null,default:fwe},Symbol.toStringTag,{value:"Module"}));pe.getLogger("esri.geometry.support.triangleMeshMerge");async function zdt(e,t,i){const r=await import("./elevation.ae0675c8.js");return qt(i),r.create(e,t,i)}function kdt(e,t,i){const r=e.length/3,s=new Float64Array(r*6),n=new Float32Array(r*4);let o=0,a=0,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(let y=0;y<r;y++){const v=e[y*3+0],b=e[y*3+1],w=e[y*3+2];s[o++]=v,s[o++]=b,s[o++]=w,s[o++]=v,s[o++]=b;const S=w+i(v,b,w);s[o++]=S,l=Math.min(l,w,S),c=Math.max(c,w,S),n[a++]=t?t[y]:0,n[a++]=0,n[a++]=t?t[y]:0,n[a++]=0}o=0,a=0;const h=c-l;for(let y=0;y<r;y++){const v=s[o+2];n[++a]=(v-l)/h,++a;const b=s[o+5];n[++a]=(b-l)/h,++a,o+=6}const p=r-1,f=new Uint32Array(p*6);let g=0;for(let y=0;y<p;y++){const v=y*2;f[g++]=v+2,f[g++]=v,f[g++]=v+1,f[g++]=v+2,f[g++]=v+1,f[g++]=v+3}return{position:s,uv:n,faces:f}}function Bdt(e,t,i,r){let s=0;const n=(e+2)*2+(t+2)*2,o=new Float64Array(n*3),a=new Float32Array(n),l=[0,0,0];let c=0;const h=(f,g,y,v)=>{let b=f,w=y;const S=Math.sign(g-f),x=Math.sign(v-y);for(;Math.sign(b-g)!==S||Math.sign(w-v)!==x;)i(l,b,w),o[s++]=l[0],o[s++]=l[1],o[s++]=l[2],a[c++]=S?(b-f)/(g-f):(w-y)/(v-y),b+=S,w+=x;let E=s-3;o[s++]=o[E++],o[s++]=o[E++],o[s++]=o[E++],a[c++]=1};h(0,e,0,0),h(e,e,0,t),h(e,0,t,t),h(0,0,t,0);const p=kdt(o,a,typeof r=="number"?(f,g,y)=>r-y:(f,g,y)=>r(f,g,y));return{position:p.position,faces:p.faces,uv:p.uv,numVertices:{x:(e+2)*2,y:(t+2)*2}}}let uf=class extends va{constructor(){super(...arguments),this.config=new Dd,this.poisLayer=new RL({url:"https://services9.arcgis.com/FF3qnCUixr5w9JQi/arcgis/rest/services/POIZermatt/FeatureServer"}),this.lineLayer=new RL({url:"https://services9.arcgis.com/FF3qnCUixr5w9JQi/arcgis/rest/services/Border/FeatureServer"}),this.initialCamera=new il({position:{x:-31596e-8,y:-9565e-7,z:181.93342},heading:28,tilt:45}),this.view=new $ht({map:new Nme({ground:{opacity:0,surfaceColor:[255,255,255]},layers:[this.poisLayer,this.lineLayer]}),camera:this.initialCamera,alphaCompositingEnabled:!0,environment:{atmosphereEnabled:!1,starsEnabled:!1,background:{type:"color",color:[255,255,255,0]},lighting:{date:"Tue Mar 15 2022 08:05:00 GMT-0700 (Pacific Daylight Time)",directShadowsEnabled:!0}},spatialReference:Ke.WebMercator,qualityProfile:"high",viewingMode:"local"}),this.loader=null,this.sampler=null,this.zmin=Number.POSITIVE_INFINITY,this.zmax=Number.POSITIVE_INFINITY,this.layer=new Dht({elevationInfo:{mode:"absolute-height"}}),this.surfaceBoxGraphic=null}get terrainSurfaceVertexResolution(){const{sourceArea:t,elevationMeshResolutionPixels:i}=this.config,r=Math.max(t.width,t.height)/i,s=Math.ceil(t.width/r),n=Math.ceil(t.height/r);return{width:s,height:n,demResolution:r}}async createSampler({sourceArea:t,samplingResolutionPixels:i}){const r=Math.max(t.width,t.height)/i,s=new fwe({url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer"});this.sampler=new Ld({sampler:await s.createElevationSampler(t,{demResolution:r,noDataValue:1e-30}),config:this.config})}renormalizeTerrainSurface(t){const i=this.config.displayArea,r=this.config.sourceArea,s=t.vertexAttributes.position,n=new Float32Array(s.length/3*4);t.vertexAttributes.tangent=n;let o=0,a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const c=i.width/r.width,h=i.height/r.height;for(let p=0;p<s.length;p+=3){const f=s[p],g=s[p+1];s[p]=(f-r.xmin)*c+i.xmin,s[p+1]=(g-r.ymin)*h+i.ymin,n[o++]=1,n[o++]=0,n[o++]=0,n[o++]=1;const y=s[p+2];a=Math.min(a,y),l=Math.max(l,y)}this.zmin=a,this.zmax=l,t.vertexAttributesChanged()}async createMesh(){if(!this.sampler)return;const t=await zdt(this.sampler,this.config.sourceArea,{demResolution:this.terrainSurfaceVertexResolution.demResolution});this.renormalizeTerrainSurface(t);const i=await this.getTerrainSatelliteTexture();t.components[0].material=new vN({metallic:0,roughness:1,colorTexture:i}),console.log(t.components,t.components[0].faces.length);const r=new ho({geometry:t,symbol:new wR({symbolLayers:[new mS({material:{color:"white"}})]}),visible:!0});this.layer.add(r)}async getTerrainSatelliteTexture(){const{colorTextureResolution:t,sourceArea:i,colorRamp:r,terrainColorSaturation:s}=this.config,n=new ImageData(t,t);let o=0;const{zmin:a,zmax:l}=this;for(let g=0;g<t;g++)for(let y=0;y<t;y++){const v=i.xmin+y/t*i.width,b=i.ymin+g/t*i.height,S=(this.sampler.elevationAt(v,b)-a)/(l-a),x=r(S);n.data[o++]=x[0],n.data[o++]=x[1],n.data[o++]=x[2],n.data[o++]=255}const c=document.createElement("canvas");c.width=t,c.height=t;const h=c.getContext("2d");h.save(),h.putImageData(n,0,0),h.filter=`saturate(${s})`,h.drawImage(c,0,0),h.restore();const p=`https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/export?bbox=${i.xmin},${i.ymin},${i.xmax},${i.ymax}&bboxSR=102100&size=${t},${t}&format=png&rotation=180&transparent=false&f=image&dpi=800`,f=await Pi(p,{responseType:"image"});return h.scale(-1,1),h.globalCompositeOperation="soft-light",h.drawImage(f.data,0,0,-t,t),new GT({data:h.getImageData(0,0,t,t)})}createSurfaceBoxMesh(){if(!this.sampler||!Number.isFinite(this.zmin))return;const{sourceArea:t,displayArea:i,surfacePaddingBottom:r}=this.config,{width:s,height:n}=this.terrainSurfaceVertexResolution,{position:o,faces:a,uv:l}=Bdt(s,n,(h,p,f)=>{const g=t.xmin+p/s*t.width,y=t.ymin+f/n*t.height;h[0]=i.xmin+p/s*i.width,h[1]=i.ymin+f/n*i.height,h[2]=this.sampler.elevationAt(g,y)},this.zmin-r*(this.zmax-this.zmin)),c=new Idt({spatialReference:Ke.WebMercator,vertexAttributes:{position:o,uv:l},components:[new rv({faces:a,material:new vN({color:"#faf2dc",roughness:.25,metallic:0})})]});this.surfaceBoxGraphic=new ho({geometry:c,symbol:new wR({symbolLayers:[new mS({material:{color:"white"},edges:new wle({size:"7px",color:"#786738"})})]})}),this.layer.add(this.surfaceBoxGraphic)}stylePoiFeatures(){this.poisLayer.labelingInfo=[new NR({where:"category = 'village'",labelExpressionInfo:{expression:"$feature.title"},symbol:new yS({symbolLayers:[new rg({material:{color:[255,255,255]},font:{size:11,family:"sans-serif"}})]})}),new NR({where:"category = 'peak'",labelExpressionInfo:{expression:"$feature.title + TextFormatting.NewLine + Text($feature.height, '#,### m')"},symbol:new yS({symbolLayers:[new rg({material:{color:[255,255,255]},background:{color:[0,0,0]},font:{size:11,family:"sans-serif"},horizontalAlignment:"left",lineHeight:1.1})],verticalOffset:{screenLength:40,maxWorldLength:5e5,minWorldLength:0},callout:{type:"line",size:3,color:[0,0,0],border:{color:[0,0,0,0]}}})})],this.poisLayer.labelsVisible=!0,this.poisLayer.renderer=new GF({field:"category",defaultSymbol:new Ju({symbolLayers:[new Ic({resource:{primitive:"circle"},material:{color:[255,255,255,0]},outline:{color:[255,255,255],size:2},size:0})]}),uniqueValueInfos:[{value:"village",symbol:new Ju({symbolLayers:[new Ic({resource:{primitive:"circle"},material:{color:[255,255,255,0]},outline:{color:[255,255,255],size:2},size:20}),new Ic({resource:{primitive:"circle"},material:{color:[255,255,255]},size:7})]})},{value:"switzerland",symbol:new Ju({symbolLayers:[new Ic({resource:{href:"./ch-flag.png"},material:{color:[255,255,255]},size:30})]})},{value:"italy",symbol:new Ju({symbolLayers:[new Ic({resource:{href:"./it-flag.png"},material:{color:[255,255,255]},size:30})]})}]})}styleLineFeatures(){this.lineLayer.renderer=new VF({symbol:new UO({symbolLayers:[new _2({material:{color:[255,0,0,.8]},size:2,pattern:new rF({style:"dash"})})]})})}async initialize(){this.view.map.add(this.layer),await this.createSampler(this.config),await this.createMesh(),this.view.basemapTerrain.suspended=!0,this.loader.classList.add("fade-out"),this.createSurfaceBoxMesh(),this.stylePoiFeatures(),this.styleLineFeatures()}render(){return ae("div",null,ae("div",{id:"viewDiv",afterCreate:t=>this.onAfterCreate(t)}),ae("div",{class:"loader",afterCreate:t=>this.loader=t},"Matterhorn area"))}onAfterCreate(t){this.view.container=t,window.view=this.view}};Hr([d()],uf.prototype,"lineLayer",void 0);Hr([d()],uf.prototype,"sampler",void 0);Hr([d()],uf.prototype,"zmin",void 0);Hr([d()],uf.prototype,"zmax",void 0);Hr([d()],uf.prototype,"layer",void 0);Hr([d()],uf.prototype,"surfaceBoxGraphic",void 0);Hr([d()],uf.prototype,"terrainSurfaceVertexResolution",null);uf=Hr([P("App")],uf);const Vdt=new uf({container:"app"});window.app=Vdt;export{ql as $,Tr as A,bWe as B,lg as C,Np as D,St as E,sh as F,Hmt as G,egt as H,Y as I,u4e as J,vmt as K,Qr as L,UO as M,_mt as N,zO as O,Bi as P,bmt as Q,wR as R,Gb as S,mS as T,xs as U,ame as V,wle as W,ymt as X,qr as Y,Gmt as Z,qRe as _,KN as a,wW as a$,nf as a0,Att as a1,EXe as a2,Ad as a3,qt as a4,p7 as a5,ue as a6,Npt as a7,pe as a8,hh as a9,mn as aA,Bve as aB,Ka as aC,Us as aD,lpt as aE,$c as aF,$n as aG,$0 as aH,Bs as aI,ud as aJ,ab as aK,se as aL,kn as aM,fe as aN,oe as aO,We as aP,Cc as aQ,yP as aR,Vmt as aS,uZ as aT,Fmt as aU,CXe as aV,yS as aW,wS as aX,Wdt as aY,Hb as aZ,Ctt as a_,zn as aa,lb as ab,K5e as ac,Tt as ad,ir as ae,pj as af,ne as ag,ef as ah,nh as ai,M as aj,Rs as ak,sv as al,ni as am,$S as an,Vt as ao,Qmt as ap,Zmt as aq,ngt as ar,LW as as,Ymt as at,Xmt as au,TI as av,Rd as aw,ma as ax,P2 as ay,yt as az,ct as b,Qi as b$,Jp as b0,GF as b1,js as b2,IO as b3,Gt as b4,x1e as b5,Fpt as b6,Pr as b7,vF as b8,xmt as b9,bt as bA,vf as bB,dVe as bC,Vpt as bD,i1e as bE,Pi as bF,s1e as bG,GT as bH,Ks as bI,d1 as bJ,kht as bK,aa as bL,yr as bM,pi as bN,yn as bO,al as bP,uh as bQ,ri as bR,Vw as bS,Le as bT,rv as bU,hg as bV,G0 as bW,$d as bX,ppt as bY,PW as bZ,kJe as b_,ig as ba,Ppt as bb,S0 as bc,SY as bd,Ple as be,Wtt as bf,Ci as bg,Kdt as bh,ioe as bi,eoe as bj,ut as bk,de as bl,_t as bm,Te as bn,gf as bo,hF as bp,da as bq,pa as br,ts as bs,xVe as bt,pOe as bu,hOe as bv,kp as bw,Sgt as bx,vN as by,Uoe as bz,jp as c,kUe as c$,Q_e as c0,DJe as c1,t1e as c2,K_e as c3,zJe as c4,$G as c5,e1e as c6,W0 as c7,LJe as c8,q0 as c9,Nde as cA,X$e as cB,kpt as cC,Wpt as cD,mIe as cE,kde as cF,QV as cG,Q$e as cH,b8 as cI,DF as cJ,sb as cK,u2 as cL,p8 as cM,ya as cN,sP as cO,ed as cP,nDe as cQ,yi as cR,rf as cS,Coe as cT,Q4e as cU,_f as cV,Gl as cW,Ke as cX,Km as cY,UUe as cZ,zUe as c_,TG as ca,e5 as cb,Tb as cc,PXe as cd,Dt as ce,fKe as cf,pKe as cg,dKe as ch,Pmt as ci,nft as cj,BO as ck,Emt as cl,Mle as cm,Yl as cn,qN as co,hf as cp,zb as cq,Nc as cr,TR as cs,Idt as ct,re as cu,zde as cv,cue as cw,Xpt as cx,AQ as cy,bDe as cz,d,opt as d$,Z$e as d0,Y$e as d1,Hl as d2,Lwe as d3,RL as d4,AL as d5,JO as d6,s5e as d7,Gpt as d8,uA as d9,nze as dA,yst as dB,mst as dC,vst as dD,PO as dE,rh as dF,Lp as dG,F0 as dH,Rl as dI,nF as dJ,Ar as dK,A as dL,Tf as dM,x4 as dN,y4 as dO,we as dP,Mb as dQ,Q as dR,z4 as dS,DYe as dT,Sq as dU,U2 as dV,Zi as dW,I1 as dX,pF as dY,Ni as dZ,gi as d_,Bl as da,va as db,ae as dc,Qf as dd,VV as de,Mde as df,_e as dg,Vs as dh,noe as di,RT as dj,Qm as dk,Lo as dl,Ts as dm,kD as dn,Gle as dp,Bpt as dq,MO as dr,rb as ds,rr as dt,yd as du,cF as dv,l2 as dw,Qu as dx,MY as dy,qpt as dz,u as e,qwe as e$,Yt as e0,vs as e1,gs as e2,r2 as e3,Tmt as e4,GI as e5,Ub as e6,Kit as e7,Fi as e8,Gc as e9,Qt as eA,lf as eB,tv as eC,pv as eD,S4 as eE,v2 as eF,Fd as eG,KWe as eH,zs as eI,bF as eJ,Zae as eK,_pt as eL,U2e as eM,q5e as eN,eS as eO,B1e as eP,Hc as eQ,fCe as eR,nl as eS,Ae as eT,eXe as eU,Hot as eV,ybe as eW,cft as eX,kwe as eY,tpt as eZ,ept as e_,ao as ea,Ft as eb,F as ec,Lue as ed,T as ee,es as ef,Qc as eg,et as eh,ye as ei,nN as ej,wf as ek,gt as el,ah as em,Me as en,B as eo,Io as ep,Vi as eq,Ki as er,Gi as es,Ri as et,Ut as eu,Tg as ev,e4 as ew,hv as ex,ol as ey,w4 as ez,vS as f,bfe as f$,Wwe as f0,fg as f1,lZe as f2,Sae as f3,Age as f4,Pq as f5,mgt as f6,wgt as f7,bq as f8,iM as f9,UN as fA,Y1 as fB,CRe as fC,Rr as fD,Imt as fE,bgt as fF,jq as fG,db as fH,BV as fI,L0e as fJ,Zl as fK,Pat as fL,H2 as fM,oft as fN,aat as fO,ZT as fP,N1 as fQ,xr as fR,xRe as fS,Wl as fT,Xm as fU,uft as fV,Gs as fW,Wi as fX,b2 as fY,Nt as fZ,_fe as f_,Qp as fa,D0 as fb,jr as fc,ii as fd,Fe as fe,cj as ff,Ne as fg,Dr as fh,fmt as fi,AJ as fj,ZUe as fk,lze as fl,Wfe as fm,$4e as fn,Xfe as fo,tF as fp,vt as fq,JUe as fr,voe as fs,oF as ft,AY as fu,Fc as fv,Lle as fw,so as fx,Sg as fy,F1e as fz,ho as g,Apt as g$,qmt as g0,Hce as g1,OV as g2,wEe as g3,j5 as g4,He as g5,ai as g6,Spt as g7,jj as g8,Ie as g9,Ypt as gA,tg as gB,aOe as gC,lOe as gD,Xe as gE,aft as gF,Ei as gG,f7 as gH,Kx as gI,TC as gJ,Kc as gK,T0 as gL,Q1 as gM,cZ as gN,qc as gO,Uze as gP,vpt as gQ,xae as gR,RSe as gS,EQ as gT,Pft as gU,zft as gV,Bft as gW,Kde as gX,tpe as gY,Qde as gZ,_De as g_,Jc as ga,$i as gb,xgt as gc,Mmt as gd,oS as ge,Xi as gf,Zpt as gg,HN as gh,sO as gi,tu as gj,Wmt as gk,Tye as gl,Dc as gm,MWe as gn,_gt as go,m0 as gp,OOe as gq,fa as gr,Yi as gs,Se as gt,ua as gu,M$ as gv,zp as gw,xEe as gx,Smt as gy,rrt as gz,Ju as h,Ct as h$,Lmt as h0,Gae as h1,QSe as h2,mpt as h3,BSe as h4,WSe as h5,P1 as h6,ipe as h7,qae as h8,q7 as h9,mmt as hA,spt as hB,Ept as hC,bpt as hD,xpt as hE,wpt as hF,Tpt as hG,fR as hH,th as hI,F2e as hJ,hve as hK,yWe as hL,kmt as hM,Dpt as hN,ipt as hO,dgt as hP,Mpt as hQ,sF as hR,je as hS,iDe as hT,Bmt as hU,br as hV,qde as hW,Bfe as hX,pt as hY,ze as hZ,mt as h_,fpt as ha,HH as hb,p4e as hc,fS as hd,qdt as he,gpt as hf,jpt as hg,joe as hh,wj as hi,nb as hj,bR as hk,r0 as hl,kc as hm,_Ae as hn,gS as ho,kN as hp,n3e as hq,Hpt as hr,Xl as hs,LFe as ht,NFe as hu,jO as hv,E2 as hw,jde as hx,zmt as hy,W5e as hz,JC as i,KO as i$,Je as i0,ot as i1,og as i2,it as i3,ls as i4,Ue as i5,cv as i6,v4 as i7,$mt as i8,uv as i9,amt as iA,Kle as iB,ob as iC,SG as iD,Mn as iE,gft as iF,hmt as iG,kb as iH,rS as iI,mY as iJ,v$e as iK,y$e as iL,wi as iM,fgt as iN,ggt as iO,Lpt as iP,PEe as iQ,q_ as iR,pgt as iS,lN as iT,li as iU,ke as iV,mh as iW,xg as iX,Ji as iY,Un as iZ,Upt as i_,hZe as ia,_a as ib,jc as ic,Cp as id,Gr as ie,_i as ig,hr as ih,ba as ii,ki as ij,oo as ik,Cue as il,hft as im,vhe as io,ZN as ip,Ift as iq,Zdt as ir,Mr as is,UW as it,Qa as iu,CI as iv,Hae as iw,npt as ix,DB as iy,kft as iz,rg as j,ej as j$,vi as j0,fi as j1,Do as j2,Ile as j3,ygt as j4,vgt as j5,dj as j6,xOe as j7,gF as j8,Dmt as j9,Zr as jA,xV as jB,EV as jC,JD as jD,HRe as jE,U1 as jF,Nce as jG,$p as jH,lgt as jI,hgt as jJ,z1e as jK,tse as jL,agt as jM,cgt as jN,ogt as jO,CN as jP,f$ as jQ,ist as jR,ph as jS,upt as jT,MW as jU,Bu as jV,Kre as jW,Lrt as jX,Nrt as jY,Bt as jZ,as as j_,Os as ja,si as jb,mi as jc,qs as jd,sgt as je,Ide as jf,NA as jg,Kue as jh,Aoe as ji,LL as jj,RM as jk,$o as jl,Uo as jm,LT as jn,VFe as jo,xi as jp,iT as jq,IS as jr,Zm as js,WN as jt,NSe as ju,iS as jv,lse as jw,lht as jx,uue as jy,TV as jz,FS as k,ift as k$,J7 as k0,K7 as k1,iN as k2,Sd as k3,CMe as k4,QRe as k5,Omt as k6,ZRe as k7,hb as k8,lt as k9,mr as kA,zR as kB,Ls as kC,DC as kD,xF as kE,fft as kF,sS as kG,mft as kH,lBe as kI,dBe as kJ,sft as kK,dt as kL,po as kM,wr as kN,Z1 as kO,tgt as kP,B2e as kQ,hpt as kR,ys as kS,Kpt as kT,Jpt as kU,lRe as kV,oRe as kW,Dce as kX,eft as kY,wV as kZ,rft as k_,Bc as ka,lft as kb,Amt as kc,Li as kd,Cmt as ke,NT as kf,W6 as kg,KS as kh,$t as ki,Vp as kj,Uce as kk,KCe as kl,Oi as km,Bx as kn,fOe as ko,Bn as kp,Cs as kq,za as kr,U7 as ks,x0 as kt,I0 as ku,Up as kv,iBe as kw,dg as kx,Xj as ky,SS as kz,rt as l,Yle as l$,tft as l0,no as l1,MF as l2,Eft as l3,Aft as l4,Tft as l5,Sft as l6,id as l7,Fl as l8,fq as l9,I7 as lA,$pt as lB,Ipt as lC,i_ as lD,R6 as lE,df as lF,k7 as lG,zu as lH,nv as lI,Md as lJ,co as lK,T4 as lL,FK as lM,SN as lN,el as lO,COe as lP,av as lQ,AR as lR,rMe as lS,ng as lT,SF as lU,Qce as lV,qj as lW,Vm as lX,P4e as lY,lmt as lZ,smt as l_,pq as la,lEe as lb,Vr as lc,Ge as ld,Rmt as le,N6e as lf,os as lg,Eg as lh,tX as li,Git as lj,yT as lk,OG as ll,Db as lm,dpt as ln,_re as lo,kO as lp,Ydt as lq,pft as lr,Ln as ls,Mm as lt,dft as lu,Rye as lv,qbe as lw,eL as lx,rht as ly,Lne as lz,w2 as m,T7 as m$,M4e as m0,y2 as m1,cmt as m2,igt as m3,PJe as m4,xR as m5,MC as m6,sV as m7,umt as m8,ka as m9,afe as mA,Uc as mB,yFe as mC,dFe as mD,Zb as mE,X7 as mF,_Fe as mG,bFe as mH,wFe as mI,UH as mJ,TFe as mK,xFe as mL,SFe as mM,ece as mN,MR as mO,ZNe as mP,mFe as mQ,pFe as mR,lFe as mS,$Fe as mT,MFe as mU,OFe as mV,Kft as mW,PFe as mX,IFe as mY,cFe as mZ,uFe as m_,Ba as ma,Ro as mb,tl as mc,bf as md,o$ as me,PR as mf,kH as mg,wL as mh,Exe as mi,lA as mj,ms as mk,vFe as ml,E0 as mm,ca as mn,gFe as mo,oh as mp,hFe as mq,aFe as mr,oFe as ms,mb as mt,Ac as mu,lfe as mv,HDe as mw,eFe as mx,rFe as my,Zt as mz,P as n,xft as n$,fFe as n0,CFe as n1,CH as n2,XX as n3,rmt as n4,sFe as n5,nFe as n6,iFe as n7,tFe as n8,sT as n9,Hde as nA,Uft as nB,ACe as nC,omt as nD,_V as nE,vU as nF,_U as nG,C6 as nH,Uu as nI,Iwe as nJ,Qdt as nK,Jdt as nL,Rc as nM,Cft as nN,Dl as nO,Lft as nP,$F as nQ,Ai as nR,o0 as nS,Hdt as nT,jdt as nU,oAe as nV,_j as nW,ugt as nX,Il as nY,y7 as nZ,ese as n_,YNe as na,E2e as nb,zht as nc,Rft as nd,Fft as ne,Nft as nf,Fm as ng,nme as nh,p$e as ni,rpe as nj,Dft as nk,$ft as nl,Cpt as nm,Rpt as nn,Opt as no,lSe as np,Umt as nq,Nmt as nr,Xa as ns,W$e as nt,S4e as nu,g2e as nv,M$e as nw,Vft as nx,B$e as ny,fQ as nz,xY as o,qet as o$,_ft as o0,bft as o1,yft as o2,Qhe as o3,E3e as o4,wft as o5,vft as o6,cbe as o7,Mot as o8,OBe as o9,FZe as oA,tZe as oB,Hst as oC,jst as oD,u5 as oE,qst as oF,uN as oG,aYe as oH,xbe as oI,Fat as oJ,blt as oK,Cbe as oL,Tlt as oM,Rbe as oN,Elt as oO,Obe as oP,zlt as oQ,b5 as oR,Wlt as oS,ict as oT,PYe as oU,Blt as oV,Rct as oW,CQe as oX,pJe as oY,Met as oZ,Jet as o_,zge as oa,UVe as ob,jge as oc,g8e as od,L8e as oe,Lq as of,U8e as og,r9e as oh,p9e as oi,Q0e as oj,Mqe as ok,oN as ol,fZe as om,_Ze as on,rZe as oo,Ant as op,Ebe as oq,Yat as or,zM as os,q5 as ot,FEe as ou,u8e as ov,$ve as ow,gXe as ox,eT as oy,NO as oz,E4e as p,cpt as p$,LN as p0,x6 as p1,qfe as p2,sme as p3,Jfe as p4,tme as p5,n6e as p6,r6e as p7,XH as p8,e6e as p9,gY as pA,Yae as pB,XUe as pC,Yfe as pD,NR as pE,eK as pF,x$ as pG,Ife as pH,iUe as pI,nq as pJ,hme as pK,Sfe as pL,xt as pM,O6 as pN,yU as pO,rTe as pP,sze as pQ,YO as pR,sr as pS,kFe as pT,gfe as pU,Qze as pV,i4e as pW,Jze as pX,wfe as pY,Rfe as pZ,SL as p_,TK as pa,Cce as pb,Ja as pc,_Ue as pd,xle as pe,Vfe as pf,t5e as pg,gmt as ph,sUe as pi,oUe as pj,qb as pk,Zfe as pl,n5e as pm,ZH as pn,a5e as po,l5e as pp,U0 as pq,pR as pr,rUe as ps,Nd as pt,dF as pu,jb as pv,hUe as pw,H5e as px,X5e as py,xUe as pz,xe as q,sbe as q$,dfe as q0,EL as q1,o5e as q2,Ddt as q3,Yh as q4,LO as q5,ypt as q6,As as q7,rpt as q8,Lb as q9,pmt as qA,_Se as qB,apt as qC,D as qD,Qpt as qE,emt as qF,Jft as qG,oJ as qH,jft as qI,nJ as qJ,AFe as qK,Qft as qL,imt as qM,tmt as qN,qft as qO,Hft as qP,Wft as qQ,Xft as qR,Zft as qS,KNe as qT,lJ as qU,Yft as qV,EFe as qW,kF as qX,ufe as qY,hfe as qZ,$nt as q_,E7 as qa,wx as qb,ize as qc,bD as qd,Dht as qe,Pme as qf,tf as qg,Zp as qh,fle as qi,$1 as qj,Zle as qk,Xdt as ql,L4e as qm,B1 as qn,XJ as qo,_R as qp,VF as qq,lUe as qr,aUe as qs,c2 as qt,Ece as qu,Fdt as qv,dmt as qw,g2 as qx,zpt as qy,nUe as qz,_ as r,tbe as r0,F_ as r1,pX as r2,dX as r3,Wnt as r4,Gft as r5,fX as r6,VUe as r7,GUe as r8,jUe as r9,Ofe as ra,nce as rb,Oft as rc,Mft as rd,nmt as re,wmt as rf,jmt as rg,rgt as rh,Udt as ri,ti as s,C as t,Jt as u,jl as v,Jmt as w,Kmt as x,be as y,QO as z};
